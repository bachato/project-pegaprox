<!DOCTYPE html>
<!--
    PegaProx - Cluster Management for Proxmox VE
    Version: 0.9.0.1 Beta
    Website: https://pegaprox.com
    GitHub:  https://github.com/PegaProx/project-pegaprox
    
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    Copyright (C) 2025-2026 PegaProx Team
    
    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program. If not, see <https://www.gnu.org/licenses/>.
    
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    Development Team: 
      - Nico Schmidt (NS) - Lead Developer & Founder
      - Marcus Kellermann (MK) - Backend Developer
      - Laura Weber (LW) - Frontend Developer
    
    Contributors:
      - Florian Paul Azim Hoberg @gyptazy
      - Alexandre Derumier @aderumier (Performance chart styling)
    
    Started: September 2025
    Last major refactor: January 2026
    License: AGPL-3.0
    
    Tech Stack: React 18 + Tailwind CSS (single-file SPA)
    Yeah I know, single file is weird but it actually works great
    for our deployment scenario. Makes updates super easy. - NS
    
    Credits:
      - ProxLB by gyptazy (https://github.com/gyptazy/ProxLB)
        Load balancing logic is based on this project. Thanks!
      - ProxSnap by gyptazy (https://github.com/gyptazy/ProxSnap)
        Inspiration for the snapshot overview feature. Great tool!
    
    Some parts were optimized with AI assistance (Claude/ChatGPT).
    We've marked those sections. Most of the core logic is hand-written.
    
    Contact: sponsor@pegaprox.com (for sponsorship inquiries)
    
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    TODO (NS): Split into proper components when we have time
    TODO (MK): The API could use some cleanup too tbh
    TODO (LW): Dark mode is the only mode rn, maybe add light theme?
    FIXME (NS): Memory leak somewhere in the console component, low prio
    FIXED (LW): mobile layout works now (Jan 2026)
    
    git log --oneline (for reference):
    - b3f7a1d feat(MK): disk bus type editing
    - a2c8e4f feat(LW): EFI disk and TPM management
    - 9e4f3c2 feat: rolling update manager
    - 8f3a2b1 fix: ISO detection in migrate modal
    - 7c91ef4 feat: cross-cluster migration
    - 6d82ab3 fix: websocket reconnect issue (#247)
    - 5e73cd2 refactor: auth system
    
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PegaProx â€¢ Cluster Management for Proxmox VE</title>
    <meta name="google" content="notranslate">
    
    <!-- NS: Preconnect - DNS resolution starts early = faster loading -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    
    <!-- NS: Preload removed - was causing credential mode mismatch warnings -->
    <!-- Scripts are loaded via loadScriptWithFallback which handles this better -->
    
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
    
    <!-- 
    OFFLINE MODE: For jumphosts without internet access:
    1. Run: python3 pegaprox_server.py --download-static (on machine WITH internet)
    2. Copy 'static' folder to jumphost
    3. The UI will use local files automatically
    
    Downloads: React, Babel, xterm.js, noVNC, + generates Tailwind CSS subset
    -->
    
    <!-- Smart Script Loader - CDN first, local fallback for offline -->
    <!-- SRI Hashes for supply chain security - verify these match official releases -->
    <script>
        // NS: Global flag to know when libs are ready
        window.pegaproxLibsReady = false;
        
        // SRI Hashes for supply chain security - verify CDN scripts haven't been tampered with
        // IMPORTANT: Update these hashes when upgrading library versions!
        // Generate hashes at: https://www.srihash.org/ or use jsDelivr's ?integrity query
        // Example: curl -s https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js | openssl dgst -sha384 -binary | openssl base64 -A
        // Empty string = skip SRI check (use during development, fill in for production)
        const SRI_HASHES = {
            // React 18.2.0 - https://unpkg.com/react@18.2.0/umd/react.production.min.js
            'react@18': '',
            // React-DOM 18.2.0
            'react-dom@18': '',
            // Babel Standalone 7.x
            'babel@7': '',
            // noVNC 1.4.0
            'novnc@1.4.0': '',
            // xterm.js 5.3.0
            'xterm@5.3.0': '',
            // xterm-addon-fit 0.8.0
            'xterm-addon-fit@0.8.0': ''
        };
        
        function loadScriptWithFallback(cdnUrl, localUrl, integrityKey) {
            return new Promise(function(resolve) {
                var script = document.createElement('script');
                script.src = cdnUrl;
                
                // Add SRI hash if available (supply chain protection)
                if (integrityKey && SRI_HASHES[integrityKey]) {
                    script.integrity = SRI_HASHES[integrityKey];
                    script.crossOrigin = 'anonymous';
                }
                
                script.onload = resolve;
                script.onerror = function() {
                    // CDN failed (offline or integrity check failed) - try local
                    console.log('CDN unavailable or integrity check failed, trying local:', localUrl);
                    var local = document.createElement('script');
                    local.src = localUrl;
                    local.onload = resolve;
                    local.onerror = function() {
                        console.error('Failed to load from both CDN and local');
                        resolve();
                    };
                    document.head.appendChild(local);
                };
                document.head.appendChild(script);
            });
        }
        
        // Load in sequence - JSX pre-compiled, Babel loads but skips
        // Edit web/src/*.js, then run web/Dev/build.sh
        loadScriptWithFallback(
            'https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js',
            '/static/js/react.production.min.js',
            'react@18'
        ).then(function() {
            return loadScriptWithFallback(
                'https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js',
                '/static/js/react-dom.production.min.js',
                'react-dom@18'
            );
        }).then(function() {
            return loadScriptWithFallback(
                'https://cdn.jsdelivr.net/npm/@babel/standalone@7/babel.min.js',
                '/static/js/babel.min.js',
                'babel@7'
            );
        }).then(function() {
            return loadScriptWithFallback(
                'https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js',
                '/static/js/chart.umd.min.js',
                'chart.js@4'
            );
        }).then(function() {
            // All libs loaded - transform babel scripts
            window.pegaproxLibsReady = true;
            // Babel loaded but skipped - JSX pre-compiled by build.sh
        });
    </script>
    
    <!-- Tailwind CSS - CDN with offline fallback -->
    <script src="https://cdn.tailwindcss.com" onerror="
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = '/static/css/tailwind.min.css';
        document.head.appendChild(link);
    "></script>
    
    <!-- noVNC - lazy loaded when needed -->
    <script>
        window.loadNoVNC = function() {
            return new Promise((resolve, reject) => {
                if (window.RFB) { resolve(); return; }
                var script = document.createElement('script');
                script.type = 'module';
                script.src = '/static/js/rfb.js';
                script.onerror = function() {
                    this.src = 'https://cdn.jsdelivr.net/npm/@novnc/novnc@1.4.0/core/rfb.js';
                    if (SRI_HASHES['novnc@1.4.0']) {
                        this.integrity = SRI_HASHES['novnc@1.4.0'];
                        this.crossOrigin = 'anonymous';
                    }
                };
                script.onload = resolve;
                document.head.appendChild(script);
            });
        };
    </script>
    
    <!-- Fonts -->
    <style>
        :root {
            --font-sans: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            --font-mono: 'JetBrains Mono', 'SF Mono', 'Fira Code', 'Fira Mono', 'Roboto Mono', monospace;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        // ============================================
        // THEME SYSTEM - NS Jan 2026
        // ============================================
        // Available themes with full color definitions
        // To add a new theme: add entry here + it auto-appears in Settings
        
        const PEGAPROX_THEMES = {
            proxmoxDark: {
                name: 'Proxmox Dark',
                icon: 'ðŸŒ™',
                description: 'Official Proxmox inspired dark theme',
                colors: {
                    primary: '#E57000',      // Official Proxmox orange
                    primaryHover: '#FF8C00',
                    dark: '#0F1419',
                    darker: '#080B0E',
                    card: '#161B22',
                    border: '#30363D',
                    hover: '#1C2128',
                    text: '#FFFFFF',
                    textMuted: '#8B949E',
                    success: '#3FB950',
                    warning: '#D29922',
                    error: '#F85149',
                    info: '#58A6FF'
                }
            },
            proxmoxLight: {
                name: 'Proxmox Light',
                icon: 'â˜€ï¸',
                description: 'Clean light theme for daytime use',
                colors: {
                    primary: '#E57000',
                    primaryHover: '#CC6400',
                    dark: '#F6F8FA',
                    darker: '#FFFFFF',
                    card: '#FFFFFF',
                    border: '#D0D7DE',
                    hover: '#F3F4F6',
                    text: '#1F2328',
                    textMuted: '#656D76',
                    success: '#1A7F37',
                    warning: '#9A6700',
                    error: '#CF222E',
                    info: '#0969DA'
                }
            },
            midnight: {
                name: 'Midnight Blue',
                icon: 'ðŸŒŒ',
                description: 'Deep blue for night owls',
                colors: {
                    primary: '#6366F1',
                    primaryHover: '#818CF8',
                    dark: '#0F172A',
                    darker: '#020617',
                    card: '#1E293B',
                    border: '#334155',
                    hover: '#1E3A5F',
                    text: '#F1F5F9',
                    textMuted: '#94A3B8',
                    success: '#22C55E',
                    warning: '#EAB308',
                    error: '#EF4444',
                    info: '#3B82F6'
                }
            },
            forest: {
                name: 'Forest',
                icon: 'ðŸŒ²',
                description: 'Nature-inspired green theme',
                colors: {
                    primary: '#10B981',
                    primaryHover: '#34D399',
                    dark: '#0D1117',
                    darker: '#010409',
                    card: '#161B22',
                    border: '#21262D',
                    hover: '#1C2128',
                    text: '#C9D1D9',
                    textMuted: '#8B949E',
                    success: '#3FB950',
                    warning: '#D29922',
                    error: '#F85149',
                    info: '#58A6FF'
                }
            },
            rose: {
                name: 'Rose',
                icon: 'ðŸŒ¸',
                description: 'Soft pink accent theme',
                colors: {
                    primary: '#F43F5E',
                    primaryHover: '#FB7185',
                    dark: '#18181B',
                    darker: '#09090B',
                    card: '#27272A',
                    border: '#3F3F46',
                    hover: '#2D2D33',
                    text: '#FAFAFA',
                    textMuted: '#A1A1AA',
                    success: '#22C55E',
                    warning: '#EAB308',
                    error: '#EF4444',
                    info: '#3B82F6'
                }
            },
            ocean: {
                name: 'Ocean',
                icon: 'ðŸŒŠ',
                description: 'Cool blue ocean vibes',
                colors: {
                    primary: '#0EA5E9',
                    primaryHover: '#38BDF8',
                    dark: '#0C1222',
                    darker: '#060A10',
                    card: '#132337',
                    border: '#1E3A5F',
                    hover: '#1A3550',
                    text: '#E2E8F0',
                    textMuted: '#94A3B8',
                    success: '#22C55E',
                    warning: '#F59E0B',
                    error: '#EF4444',
                    info: '#3B82F6'
                }
            },
            highContrast: {
                name: 'High Contrast',
                icon: 'â—',
                description: 'Maximum visibility for accessibility',
                colors: {
                    primary: '#FFD700',
                    primaryHover: '#FFED4A',
                    dark: '#000000',
                    darker: '#000000',
                    card: '#0A0A0A',
                    border: '#FFFFFF',
                    hover: '#1A1A1A',
                    text: '#FFFFFF',
                    textMuted: '#CCCCCC',
                    success: '#00FF00',
                    warning: '#FFFF00',
                    error: '#FF0000',
                    info: '#00FFFF'
                }
            },
            // extra skins - LW wanted more variety
            dracula: {
                name: 'Dracula',
                icon: 'ðŸ§›',
                description: 'Popular Dracula color scheme',
                colors: {
                    primary: '#BD93F9',
                    primaryHover: '#D4B8FF',
                    dark: '#282A36',
                    darker: '#1E1F29',
                    card: '#343746',
                    border: '#44475A',
                    hover: '#3D4051',
                    text: '#F8F8F2',
                    textMuted: '#6272A4',
                    success: '#50FA7B',
                    warning: '#F1FA8C',
                    error: '#FF5555',
                    info: '#8BE9FD'
                }
            },
            nord: {
                name: 'Nord',
                icon: 'â„ï¸',
                description: 'Arctic, north-bluish color palette',
                colors: {
                    primary: '#88C0D0',
                    primaryHover: '#8FBCBB',
                    dark: '#2E3440',
                    darker: '#242933',
                    card: '#3B4252',
                    border: '#4C566A',
                    hover: '#434C5E',
                    text: '#ECEFF4',
                    textMuted: '#D8DEE9',
                    success: '#A3BE8C',
                    warning: '#EBCB8B',
                    error: '#BF616A',
                    info: '#81A1C1'
                }
            },
            monokai: {
                name: 'Monokai',
                icon: 'ðŸŽ¨',
                description: 'Classic code editor theme',
                colors: {
                    primary: '#F92672',
                    primaryHover: '#FF79C6',
                    dark: '#272822',
                    darker: '#1E1F1C',
                    card: '#3E3D32',
                    border: '#49483E',
                    hover: '#3E3D32',
                    text: '#F8F8F2',
                    textMuted: '#75715E',
                    success: '#A6E22E',
                    warning: '#E6DB74',
                    error: '#F92672',
                    info: '#66D9EF'
                }
            },
            matrix: {
                name: 'Matrix',
                icon: 'ðŸ’Š',
                description: 'Enter the Matrix',
                colors: {
                    primary: '#00FF41',
                    primaryHover: '#00CC33',
                    dark: '#0D0208',
                    darker: '#000000',
                    card: '#0D0D0D',
                    border: '#003B00',
                    hover: '#001A00',
                    text: '#00FF41',
                    textMuted: '#008F11',
                    success: '#00FF41',
                    warning: '#ADFF2F',
                    error: '#FF0000',
                    info: '#39FF14'
                }
            },
            sunset: {
                name: 'Sunset',
                icon: 'ðŸŒ…',
                description: 'Warm orange and purple gradients',
                colors: {
                    primary: '#FF6B35',
                    primaryHover: '#FF8C5A',
                    dark: '#1A1423',
                    darker: '#0F0A14',
                    card: '#2D2137',
                    border: '#4A3B5C',
                    hover: '#3D2F4A',
                    text: '#FFF4E6',
                    textMuted: '#B8A9C9',
                    success: '#7CB518',
                    warning: '#FFB627',
                    error: '#E63946',
                    info: '#A855F7'
                }
            },
            cyberpunk: {
                name: 'Cyberpunk',
                icon: 'ðŸ¤–',
                description: 'Neon lights of Night City',
                colors: {
                    primary: '#00D9FF',
                    primaryHover: '#00FFFF',
                    dark: '#0A0A0F',
                    darker: '#050508',
                    card: '#12121A',
                    border: '#FF00FF',
                    hover: '#1A1A25',
                    text: '#FFFFFF',
                    textMuted: '#8888AA',
                    success: '#00FF9F',
                    warning: '#FFFF00',
                    error: '#FF0055',
                    info: '#00D9FF'
                }
            },
            github: {
                name: 'GitHub Dark',
                icon: 'ðŸ™',
                description: 'GitHub dark mode colors',
                colors: {
                    primary: '#238636',
                    primaryHover: '#2EA043',
                    dark: '#0D1117',
                    darker: '#010409',
                    card: '#161B22',
                    border: '#30363D',
                    hover: '#1F2428',
                    text: '#C9D1D9',
                    textMuted: '#8B949E',
                    success: '#238636',
                    warning: '#D29922',
                    error: '#F85149',
                    info: '#58A6FF'
                }
            },
            solarizedDark: {
                name: 'Solarized Dark',
                icon: 'ðŸ”†',
                description: 'Precision colors for machines and people',
                colors: {
                    primary: '#B58900',
                    primaryHover: '#CB4B16',
                    dark: '#002B36',
                    darker: '#001F27',
                    card: '#073642',
                    border: '#586E75',
                    hover: '#094552',
                    text: '#FDF6E3',
                    textMuted: '#93A1A1',
                    success: '#859900',
                    warning: '#B58900',
                    error: '#DC322F',
                    info: '#268BD2'
                }
            },
            gruvbox: {
                name: 'Gruvbox',
                icon: 'ðŸ“¦',
                description: 'Retro groove color scheme',
                colors: {
                    primary: '#FE8019',
                    primaryHover: '#FABD2F',
                    dark: '#1D2021',
                    darker: '#0D1011',
                    card: '#282828',
                    border: '#3C3836',
                    hover: '#32302F',
                    text: '#EBDBB2',
                    textMuted: '#A89984',
                    success: '#B8BB26',
                    warning: '#FABD2F',
                    error: '#FB4934',
                    info: '#83A598'
                }
            },
            // Corporate/Enterprise style themes
            corporateDark: {
                name: 'Corporate Dark',
                icon: 'ðŸ–¥ï¸',
                description: 'Modern corporate dark theme',
                colors: {
                    primary: '#1A73E8',       // Corporate blue
                    primaryHover: '#4285F4',
                    dark: '#1E1E1E',          // Dark sidebar
                    darker: '#121212',        // Darkest background
                    card: '#252525',          // Card background
                    border: '#3D3D3D',        // Subtle borders
                    hover: '#2D2D2D',         // Hover state
                    text: '#FFFFFF',
                    textMuted: '#9E9E9E',
                    success: '#34A853',
                    warning: '#FBBC04',
                    error: '#EA4335',
                    info: '#4285F4'
                }
            },
            corporateLight: {
                name: 'Corporate Light',
                icon: 'ðŸ’»',
                description: 'Modern corporate light theme',
                colors: {
                    primary: '#1A73E8',
                    primaryHover: '#1557B0',
                    dark: '#F5F5F5',
                    darker: '#FFFFFF',
                    card: '#FFFFFF',
                    border: '#DADCE0',
                    hover: '#E8EAED',
                    text: '#202124',
                    textMuted: '#5F6368',
                    success: '#137333',
                    warning: '#EA8600',
                    error: '#C5221F',
                    info: '#1967D2'
                }
            },
            enterpriseBlue: {
                name: 'Enterprise Blue',
                icon: 'ðŸ”·',
                description: 'Classic enterprise blue theme',
                colors: {
                    primary: '#005EB8',       // Classic enterprise blue
                    primaryHover: '#0073D1',
                    dark: '#2C3E50',          // Dark blue-gray
                    darker: '#1A252F',
                    card: '#34495E',
                    border: '#4A6278',
                    hover: '#3D5266',
                    text: '#ECF0F1',
                    textMuted: '#95A5A6',
                    success: '#27AE60',
                    warning: '#F39C12',
                    error: '#E74C3C',
                    info: '#3498DB'
                }
            }
        };
        
        // Apply theme by setting CSS variables
        function applyTheme(themeName) {
            const theme = PEGAPROX_THEMES[themeName] || PEGAPROX_THEMES.proxmoxDark;
            const root = document.documentElement;
            
            Object.entries(theme.colors).forEach(([key, value]) => {
                root.style.setProperty(`--color-${key}`, value);
            });
            
            // Special handling for light theme - only if body exists
            if (document.body) {
                const lightThemes = ['proxmoxLight', 'corporateLight'];
                if (lightThemes.includes(themeName)) {
                    document.body.classList.add('light-theme');
                    document.body.classList.remove('dark-theme');
                } else {
                    document.body.classList.add('dark-theme');
                    document.body.classList.remove('light-theme');
                }
            }
            
            localStorage.setItem('pegaprox-theme', themeName);
            console.log(`Theme applied: ${theme.name}`);
        }
        
        // Load saved theme on page load - apply CSS vars immediately, body classes after DOM ready
        (function() {
            const saved = localStorage.getItem('pegaprox-theme') || 'proxmoxDark';
            console.log('[Theme] Initial load from localStorage:', saved);
            // Apply CSS variables immediately (works on documentElement)
            const theme = PEGAPROX_THEMES[saved] || PEGAPROX_THEMES.proxmoxDark;
            Object.entries(theme.colors).forEach(([key, value]) => {
                document.documentElement.style.setProperty(`--color-${key}`, value);
            });
            // Apply body classes after DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', () => applyTheme(saved));
            } else {
                applyTheme(saved);
            }
        })();
        
        // ============================================
        // TAILWIND CONFIG
        // ============================================
        // LW: Custom Proxmox-inspired color palette
        // Now uses CSS variables for dynamic theming
        if (typeof tailwind !== 'undefined') {
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        proxmox: {
                            // These now reference CSS variables for theme support
                            orange: 'var(--color-primary, #E57000)',
                            dark: 'var(--color-dark, #0F1419)',
                            darker: 'var(--color-darker, #080B0E)',
                            card: 'var(--color-card, #161B22)',
                            border: 'var(--color-border, #30363D)',
                            hover: 'var(--color-hover, #1C2128)',
                        },
                        // Semantic colors
                        theme: {
                            primary: 'var(--color-primary, #E57000)',
                            success: 'var(--color-success, #3FB950)',
                            warning: 'var(--color-warning, #D29922)',
                            error: 'var(--color-error, #F85149)',
                            info: 'var(--color-info, #58A6FF)',
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'gradient': 'gradient 8s ease infinite',
                        'slide-up': 'slideUp 0.5s ease-out',
                        'slide-in': 'slideIn 0.3s ease-out',
                        'fade-in': 'fadeIn 0.4s ease-out',
                        'scale-in': 'scaleIn 0.3s ease-out',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                    },
                    keyframes: {
                        gradient: {
                            '0%, 100%': { backgroundPosition: '0% 50%' },
                            '50%': { backgroundPosition: '100% 50%' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideIn: {
                            '0%': { opacity: '0', transform: 'translateX(-10px)' },
                            '100%': { opacity: '1', transform: 'translateX(0)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        scaleIn: {
                            '0%': { opacity: '0', transform: 'scale(0.95)' },
                            '100%': { opacity: '1', transform: 'scale(1)' },
                        },
                        glow: {
                            '0%': { boxShadow: '0 0 20px var(--color-primary, rgba(229, 112, 0, 0.3))' },
                            '100%': { boxShadow: '0 0 40px var(--color-primary, rgba(229, 112, 0, 0.6))' },
                        },
                    }
                }
            }
        };
        } // end if (typeof tailwind !== 'undefined')
    </script>
    <style>
        * {
            scrollbar-width: thin;
            scrollbar-color: #30363D #161B22;
        }
        *::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        *::-webkit-scrollbar-track {
            background: #161B22;
        }
        *::-webkit-scrollbar-thumb {
            background: #30363D;
            border-radius: 4px;
        }
        *::-webkit-scrollbar-thumb:hover {
            background: #484F58;
        }

        /* Global dark mode for form elements */
        input, select, textarea {
            background-color: var(--color-dark, #0F1419);
            color: var(--color-text, #E6EDF3);
            border-color: var(--color-border, #30363D);
        }
        input::placeholder, textarea::placeholder {
            color: #6B7280;
        }
        input[type="checkbox"], input[type="radio"] {
            accent-color: var(--color-primary, #E57000);
        }
        input[type="range"] {
            background: transparent;
        }
        select option {
            background-color: var(--color-dark, #0F1419);
            color: var(--color-text, #E6EDF3);
        }
        /* Fix focus outline */
        *:focus {
            outline-color: var(--color-primary, #E57000);
        }
        /* Reset potential white backgrounds */
        button, fieldset, legend {
            background-color: transparent;
        }
        hr {
            border-color: var(--color-border, #30363D);
        }
        /* GLOBAL BORDER FIX - prevent white borders from Tailwind default */
        *, *::before, *::after {
            border-color: var(--color-border, #30363D);
        }
        /* Fix table borders */
        table {
            border-collapse: collapse;
            border-spacing: 0;
            border-color: var(--color-border, #30363D);
            background-color: transparent;
        }
        tbody {
            background-color: var(--color-card, #161B22);
        }
        tr, td, th {
            border-color: var(--color-border, #30363D) !important;
            background-color: inherit;
        }
        tbody tr {
            border-color: rgba(48, 54, 61, 0.5) !important;
        }
        /* Force dark borders on all elements */
        .border-gray-700\/50 {
            border-color: rgba(55, 65, 81, 0.5) !important;
        }

        /* Gradient backgrounds */
        .gradient-mesh {
            background: 
                radial-gradient(at 40% 20%, rgba(229, 112, 0, 0.15) 0px, transparent 50%),
                radial-gradient(at 80% 0%, rgba(229, 112, 0, 0.1) 0px, transparent 50%),
                radial-gradient(at 0% 50%, rgba(229, 112, 0, 0.08) 0px, transparent 50%),
                radial-gradient(at 80% 100%, rgba(229, 112, 0, 0.05) 0px, transparent 50%);
        }

        /* Gauge styles */
        .gauge-container {
            position: relative;
            width: 120px;
            height: 120px;
        }
        .gauge-bg {
            fill: none;
            stroke: #30363D;
            stroke-width: 10;
        }
        .gauge-fill {
            fill: none;
            stroke-width: 10;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: center;
            transition: stroke-dashoffset 0.8s cubic-bezier(0.4, 0, 0.2, 1), stroke 0.3s ease;
        }
        .gauge-text {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            fill: currentColor;
        }

        /* Card hover effects */
        /* NS: removed transform because it breaks fixed modal positioning */
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card-hover:hover {
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(229, 112, 0, 0.2);
        }

        /* Slider styles */
        .custom-slider {
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            border-radius: 4px;
            outline: none;
            transition: all 0.2s;
            background: transparent;
        }
        .custom-slider::-webkit-slider-runnable-track {
            height: 8px;
            border-radius: 4px;
            background: transparent;
        }
        .custom-slider::-moz-range-track {
            height: 8px;
            border-radius: 4px;
            background: transparent;
        }
        .custom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #E57000;
            cursor: grab;
            box-shadow: 0 2px 10px rgba(229, 112, 0, 0.5);
            transition: all 0.2s;
        }
        .custom-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 20px rgba(229, 112, 0, 0.7);
        }
        .custom-slider::-webkit-slider-thumb:active {
            cursor: grabbing;
        }
        .custom-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #E57000;
            cursor: grab;
            border: none;
            box-shadow: 0 2px 10px rgba(229, 112, 0, 0.5);
        }

        /* Status indicator pulse */
        .status-online {
            animation: pulse-online 2s ease-in-out infinite;
        }
        @keyframes pulse-online {
            0%, 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            50% { box-shadow: 0 0 0 8px rgba(34, 197, 94, 0); }
        }

        /* Noise texture overlay */
        .noise-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.03;
            z-index: 1000;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
        }

        /* Modal backdrop blur */
        .modal-backdrop {
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        /* Timeline styles */
        .timeline-line {
            position: absolute;
            left: 19px;
            top: 40px;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #E57000, transparent);
        }

        /* Toggle switch */
        .toggle-switch {
            position: relative;
            width: 48px;
            height: 26px;
            background: #30363D;
            border-radius: 13px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .toggle-switch.active {
            background: #E57000;
        }
        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .toggle-switch.active::after {
            left: 25px;
        }

        /* Glow effect for active elements */
        .glow-orange {
            box-shadow: 0 0 30px rgba(229, 112, 0, 0.4);
        }

        /* Table row hover */
        .table-row-hover {
            transition: all 0.2s;
        }
        .table-row-hover:hover {
            background: rgba(229, 112, 0, 0.1);
        }

        /* Notification toast */
        .toast-enter {
            animation: toastEnter 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        @keyframes toastEnter {
            0% { opacity: 0; transform: translateX(100%); }
            100% { opacity: 1; transform: translateX(0); }
        }

        /* Sparkline */
        .sparkline-path {
            fill: none;
            stroke: #E57000;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        .sparkline-area {
            fill: url(#sparklineGradient);
        }

        /* LW: Feb 2026 - Corporate layout overrides (experimental) */
        /* Override CSS variables to Clarity dark theme palette */
        body[data-layout="corporate"] {
            --color-dark: #1b2a32;
            --color-darker: #17242b;
            --color-card: #22343c;
            --color-border: #485764;
            --color-hover: #29414e;
            --color-primary: #49afd9;
            --color-text: #e9ecef;
            --color-success: #60b515;
            --color-warning: #efc006;
            --color-error: #f54f47;
            --color-info: #49afd9;
            --corp-accent: #49afd9;
            --corp-selection: #324f61;
            --corp-text-secondary: #adbbc4;
            --corp-text-muted: #728b9a;
            --corp-divider: #37474f;
        }

        /* Kill all decorative effects */
        body[data-layout="corporate"] .gradient-mesh,
        body[data-layout="corporate"] .noise-overlay { display: none !important; }
        body[data-layout="corporate"] .glow-orange { box-shadow: none !important; }
        body[data-layout="corporate"] .backdrop-blur-xl,
        body[data-layout="corporate"] .backdrop-blur-sm,
        body[data-layout="corporate"] .backdrop-blur { backdrop-filter: none !important; -webkit-backdrop-filter: none !important; }

        /* Kill all animations except spin (loading spinners need it) */
        body[data-layout="corporate"] .animate-slide-up,
        body[data-layout="corporate"] .animate-fade-in,
        body[data-layout="corporate"] .animate-scale-in,
        body[data-layout="corporate"] .animate-pulse,
        body[data-layout="corporate"] .animate-bounce { animation: none !important; }
        body[data-layout="corporate"] .status-online { animation: none !important; }
        body[data-layout="corporate"] .card-hover { transform: none !important; }
        body[data-layout="corporate"] * { transition-duration: 0.05s !important; }

        /* Sharp corners everywhere - corporate has no rounded corners */
        body[data-layout="corporate"] .rounded,
        body[data-layout="corporate"] .rounded-md,
        body[data-layout="corporate"] .rounded-lg,
        body[data-layout="corporate"] .rounded-xl,
        body[data-layout="corporate"] .rounded-2xl,
        body[data-layout="corporate"] .rounded-3xl,
        body[data-layout="corporate"] .rounded-full:not(.w-2):not(.w-1\.5):not(.h-2):not(.h-1\.5):not(.w-1):not(.h-1) { border-radius: 2px !important; }

        /* Kill all gradients - flat solid colors only */
        body[data-layout="corporate"] [class*="bg-gradient"],
        body[data-layout="corporate"] [class*="from-"],
        body[data-layout="corporate"] .bg-gradient-to-r,
        body[data-layout="corporate"] .bg-gradient-to-br,
        body[data-layout="corporate"] .bg-gradient-to-b { background-image: none !important; }

        /* Kill all box shadows except very subtle ones */
        body[data-layout="corporate"] .shadow-lg,
        body[data-layout="corporate"] .shadow-xl,
        body[data-layout="corporate"] .shadow-2xl { box-shadow: 0 1px 3px rgba(0,0,0,0.3) !important; }
        body[data-layout="corporate"] [class*="hover:shadow"] { box-shadow: none !important; }

        /* Corporate sidebar - tree-view with border separator */
        body[data-layout="corporate"] .corporate-sidebar {
            border-right: 1px solid var(--color-border);
            background: var(--color-darker);
        }

        /* Override orange accent to Clarity blue in corporate */
        body[data-layout="corporate"] .text-proxmox-orange { color: var(--corp-accent) !important; }
        body[data-layout="corporate"] .bg-proxmox-orange { background-color: var(--corp-accent) !important; }
        body[data-layout="corporate"] .border-proxmox-orange\/30 { border-color: rgba(73, 175, 217, 0.3) !important; }
        body[data-layout="corporate"] .hover\:bg-proxmox-orange:hover { background-color: #3d9bc2 !important; }
        body[data-layout="corporate"] .bg-proxmox-orange\/20 { background-color: rgba(73, 175, 217, 0.2) !important; }
        body[data-layout="corporate"] .bg-proxmox-orange\/30 { background-color: rgba(73, 175, 217, 0.3) !important; }
        body[data-layout="corporate"] .ring-proxmox-orange\/50 { --tw-ring-color: rgba(73, 175, 217, 0.5) !important; }
        body[data-layout="corporate"] .focus-within\:border-proxmox-orange\/50:focus-within { border-color: rgba(73, 175, 217, 0.5) !important; }

        /* Dense corporate tables */
        body[data-layout="corporate"] table td,
        body[data-layout="corporate"] table th { padding: 4px 8px !important; font-size: 13px !important; }

        /* Kill hover scale effects */
        body[data-layout="corporate"] .hover\:scale-105:hover,
        body[data-layout="corporate"] .hover\:scale-110:hover { transform: none !important; }

        /* Compact form inputs */
        body[data-layout="corporate"] input,
        body[data-layout="corporate"] select,
        body[data-layout="corporate"] textarea { border-radius: 2px !important; }

        /* Modal overrides */
        body[data-layout="corporate"] .modal-backdrop { backdrop-filter: none !important; }

        /* Scrollbar styling for corporate (thin scrollbars) */
        body[data-layout="corporate"] ::-webkit-scrollbar { width: 8px; height: 8px; }
        body[data-layout="corporate"] ::-webkit-scrollbar-track { background: var(--color-darker); }
        body[data-layout="corporate"] ::-webkit-scrollbar-thumb { background: var(--color-border); border-radius: 0; }
        body[data-layout="corporate"] ::-webkit-scrollbar-thumb:hover { background: var(--corp-text-muted); }

        /* LW: Feb 2026 - Corporate VM Detail property grid (Clarity dark theme) */
        .corp-property-grid { width: 100%; border-collapse: collapse; }
        .corp-property-grid td { padding: 5px 12px 5px 0; font-size: 13px; border-bottom: 1px solid var(--corp-divider, #37474f); }
        .corp-property-grid td:first-child { color: var(--corp-text-secondary, #adbbc4); white-space: nowrap; width: 150px; }
        .corp-property-grid td:last-child { color: var(--color-text, #e9ecef); }
        .corp-property-grid tr:last-child td { border-bottom: none; }

        /* Corporate toolbar buttons (Clarity flat buttons) */
        .corp-toolbar button {
            padding: 4px 10px; font-size: 13px; border: 1px solid var(--color-border, #485764);
            background: transparent; color: var(--corp-text-secondary, #adbbc4); cursor: pointer; display: inline-flex;
            align-items: center; gap: 4px; border-radius: 2px !important;
        }
        .corp-toolbar button:hover { background: rgba(73, 175, 217, 0.12); border-color: var(--corp-accent, #49afd9); color: #fff; }
        .corp-toolbar button:disabled { opacity: 0.4; cursor: not-allowed; }
        .corp-toolbar button:disabled:hover { background: transparent; border-color: var(--color-border, #485764); color: var(--corp-text-secondary, #adbbc4); }

        /* Corporate node compact row */
        .corp-node-row { border-bottom: 1px solid var(--corp-divider, #37474f); }
        .corp-node-row:hover { background: var(--color-hover, #29414e); }
        .corp-node-row:last-child { border-bottom: none; }

        /* Corporate tab strip (Clarity tabs) */
        .corp-tab-strip { border-bottom: 1px solid var(--color-border, #485764); display: flex; gap: 0; }
        .corp-tab-strip button { padding: 8px 16px; font-size: 13px; color: var(--corp-text-secondary, #adbbc4); border: none; background: none;
            border-bottom: 2px solid transparent; cursor: pointer; margin-bottom: -1px; }
        .corp-tab-strip button:hover { color: var(--color-text, #e9ecef); }
        .corp-tab-strip button.active { color: var(--color-text, #e9ecef); border-bottom-color: var(--corp-accent, #49afd9); font-weight: 500; }

        /* Corporate section headers */
        .corp-section-header { font-size: 11px; font-weight: 600; color: var(--corp-text-muted, #728b9a); text-transform: uppercase;
            letter-spacing: 0.08em; padding: 8px 0 4px; border-bottom: 1px solid var(--corp-divider, #37474f); margin-bottom: 4px; }

        /* Corporate action dropdown */
        .corp-dropdown { background: var(--color-card, #22343c); border: 1px solid var(--color-border, #485764); box-shadow: 0 4px 12px rgba(0,0,0,0.4); }
        .corp-dropdown button:hover { background: var(--color-hover, #29414e); }

        /* Corporate selection highlight (sidebar tree items) */
        .corp-selected { background: var(--corp-selection, #324f61) !important; color: #fff !important; }

        /* Corporate status badges */
        .corp-badge { padding: 1px 6px; font-size: 11px; font-weight: 500; border-radius: 2px; }
        .corp-badge-running { background: rgba(96, 181, 21, 0.15); color: #60b515; border: 1px solid rgba(96, 181, 21, 0.3); }
        .corp-badge-stopped { background: rgba(114, 139, 154, 0.15); color: #728b9a; border: 1px solid rgba(114, 139, 154, 0.3); }
        .corp-badge-ha { background: rgba(73, 175, 217, 0.15); color: #49afd9; border: 1px solid rgba(73, 175, 217, 0.3); }
        .corp-badge-locked { background: rgba(239, 192, 6, 0.15); color: #efc006; border: 1px solid rgba(239, 192, 6, 0.3); }

        /* LW: Feb 2026 - Corporate Node Detail sub-navigation */
        .corp-subnav { width: 200px; border-right: 1px solid var(--corp-divider, #37474f); flex-shrink: 0; }
        .corp-subnav-item { padding: 5px 12px; font-size: 13px; color: var(--corp-text-secondary, #adbbc4); cursor: pointer; display: block; width: 100%; text-align: left; border: none; background: none; border-left: 2px solid transparent; }
        .corp-subnav-item:hover { color: var(--color-text, #e9ecef); background: rgba(73, 175, 217, 0.06); }
        .corp-subnav-item.active { background: var(--corp-selection, #324f61); border-left-color: var(--corp-accent, #49afd9); color: var(--color-text, #e9ecef); }
        .corp-subnav-header { padding: 8px 12px 4px; font-size: 11px; font-weight: 600; color: var(--corp-text-muted, #728b9a); text-transform: uppercase; letter-spacing: 0.05em; }
        .corp-capacity-bar { height: 6px; background: #1b2a32; overflow: hidden; }
        .corp-capacity-bar > div { height: 100%; transition: width 0.3s ease; }
        .corp-badge-online { background: rgba(96, 181, 21, 0.15); color: #60b515; border: 1px solid rgba(96, 181, 21, 0.3); }
        .corp-badge-offline { background: rgba(245, 79, 71, 0.15); color: #f54f47; border: 1px solid rgba(245, 79, 71, 0.3); }
        .corp-badge-maintenance { background: rgba(239, 192, 6, 0.15); color: #efc006; border: 1px solid rgba(239, 192, 6, 0.3); }

        /* LW: Feb 2026 - Corporate data-grid (dense table) */
        body[data-layout="corporate"] .corp-datagrid { border-collapse: collapse; width: 100%; }
        body[data-layout="corporate"] .corp-datagrid th { background: #22343c; color: #adbbc4; font-size: 12px; text-transform: uppercase;
            letter-spacing: 0.05em; font-weight: 600; padding: 6px 8px; border-bottom: 1px solid #485764; }
        body[data-layout="corporate"] .corp-datagrid td { padding: 4px 8px; font-size: 13px; border-bottom: 1px solid #37474f; color: #e9ecef; }
        body[data-layout="corporate"] .corp-datagrid tr:hover td { background: #29414e; }
        body[data-layout="corporate"] .corp-datagrid tr.corp-row-selected td { background: #324f61; }
        body[data-layout="corporate"] .corp-datagrid .sort-indicator { color: #49afd9; }

        /* LW: Feb 2026 - Corporate modal overrides (Clarity flat inputs) */
        body[data-layout="corporate"] .fixed.inset-0 > div > div { border-radius: 2px !important; }
        body[data-layout="corporate"] input:focus, body[data-layout="corporate"] select:focus,
        body[data-layout="corporate"] textarea:focus { border-color: #49afd9 !important; outline-color: #49afd9 !important; }

        /* LW: Feb 2026 - Corporate badge color overrides (Clarity palette) */
        body[data-layout="corporate"] .bg-blue-500\/20 { background: rgba(73,175,217,0.12) !important; }
        body[data-layout="corporate"] .text-blue-400 { color: #49afd9 !important; }
        body[data-layout="corporate"] .text-blue-300 { color: #6dc0e0 !important; }
        body[data-layout="corporate"] .bg-blue-500 { background: #49afd9 !important; }
        body[data-layout="corporate"] .bg-blue-600 { background: #3d9bc2 !important; }
        body[data-layout="corporate"] .bg-purple-500\/20 { background: rgba(161,120,217,0.12) !important; }
        body[data-layout="corporate"] .text-purple-400 { color: #a178d9 !important; }
        body[data-layout="corporate"] .bg-emerald-500 { background: #49afd9 !important; }
        body[data-layout="corporate"] .bg-emerald-600 { background: #3d9bc2 !important; }
        body[data-layout="corporate"] .hover\:bg-emerald-600:hover { background: #3d9bc2 !important; }
        body[data-layout="corporate"] .text-emerald-400 { color: #60b515 !important; }
        body[data-layout="corporate"] .bg-green-500\/20 { background: rgba(96,181,21,0.12) !important; }
        body[data-layout="corporate"] .text-green-400 { color: #60b515 !important; }
        body[data-layout="corporate"] .bg-red-500\/20 { background: rgba(245,79,71,0.12) !important; }
        body[data-layout="corporate"] .bg-yellow-500\/20 { background: rgba(239,192,6,0.12) !important; }

        /* LW: Feb 2026 - Corporate sidebar tree (indentation only, no connector lines) */

        /* LW: Feb 2026 - Corporate header darker */
        body[data-layout="corporate"] header.sticky { background: #0F171C !important; }

        /* LW: Feb 2026 - Corporate table row hover override */
        body[data-layout="corporate"] .table-row-hover:hover { background: #29414e !important; }
        body[data-layout="corporate"] .table-row-hover.corp-row-selected { background: #324f61 !important; }



        /* LW: Feb 2026 - Corporate sidebar resize handle */
        .corp-resize-handle { width: 4px; cursor: col-resize; background: transparent; flex-shrink: 0;
            border-left: 1px solid #485764; transition: background 0.15s; }
        .corp-resize-handle:hover, .corp-resize-handle.active { background: rgba(73,175,217,0.3); border-left-color: #49afd9; }

        /* LW: Feb 2026 - System fonts for corporate layout */
        body[data-layout="corporate"] {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Arial, sans-serif !important;
        }
        body[data-layout="corporate"] * {
            font-family: inherit !important;
        }
        body[data-layout="corporate"] code, body[data-layout="corporate"] .font-mono,
        body[data-layout="corporate"] pre, body[data-layout="corporate"] kbd {
            font-family: 'Consolas', 'JetBrains Mono', monospace !important;
        }

        /* LW: Feb 2026 - Tree items (indentation only) */
        body[data-layout="corporate"] .corp-tree-child { padding-left: 4px; }
        /* LW: Feb 2026 - Keyboard focus for sidebar tree items */
        body[data-layout="corporate"] .corp-tree-child:focus-visible,
        body[data-layout="corporate"] .corp-tree-item:focus-visible {
            outline: 1px solid #49afd9; outline-offset: -1px;
        }

        /* LW: Feb 2026 - Warning banner (yellow bar) */
        .corp-warning-banner {
            background: rgba(239,192,6,0.12); color: #efc006; border: 1px solid rgba(239,192,6,0.3);
            padding: 6px 16px; font-size: 13px; display: flex; align-items: center; justify-content: space-between;
        }
        .corp-warning-banner .corp-warning-dismiss {
            background: none; border: 1px solid rgba(239,192,6,0.3); color: #efc006; padding: 2px 8px;
            font-size: 11px; cursor: pointer; text-transform: uppercase; letter-spacing: 0.05em;
        }
        .corp-warning-banner .corp-warning-dismiss:hover { background: rgba(239,192,6,0.2); }

        /* LW: Feb 2026 - Thinner scrollbars */
        body[data-layout="corporate"] * { scrollbar-width: thin; }
        body[data-layout="corporate"] ::-webkit-scrollbar { width: 6px !important; height: 6px !important; }

        /* LW: Feb 2026 - No rounded-full for status badges (exclude small dots) */
        body[data-layout="corporate"] .rounded-full:not(.w-2):not(.w-1\.5):not(.h-2):not(.h-1\.5):not(.w-1):not(.h-1) {
            border-radius: 2px !important;
        }
    </style>
</head>
<body class="dark notranslate">
    <div class="noise-overlay"></div>
    
    <!-- NS: Loading screen - shows immediately while Babel compiles -->
    <div id="loading-screen" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1a 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    ">
        <div style="
            width: 80px;
            height: 80px;
            border: 3px solid rgba(226, 109, 65, 0.2);
            border-top-color: #e26d41;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        "></div>
        <div style="color: #e26d41; font-size: 24px; font-weight: 600; margin-top: 24px;">
            PegaProx
        </div>
        <div style="color: #888; font-size: 14px; margin-top: 8px;">
            Loading...
        </div>
    </div>
    <style>
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
    
    <div id="root"></div>


<script>
(function waitForReact() {
    if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
        setTimeout(waitForReact, 10);
        return;
    }
    // React is ready, run the app
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// React Setup - LW
// Using production build for performance
// Babel transpiles on-the-fly (fine for our use case)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const{useState,useEffect,useRef,useCallback,useMemo,createContext,useContext}=React;// NS: API runs on same origin, Flask serves both frontend and API
// This makes deployment super easy - just one process
const API_URL=window.location.origin+'/api';// const API_URL = 'http://localhost:5000/api';  // local dev
// const API_URL = 'https://pegaprox.internal/api' // old staging
// NS: Central version constant - keep in sync with backend PEGAPROX_VERSION
const PEGAPROX_VERSION="Beta 0.9.0.1";const DEBUG=false;// set true for verbose logging
// =====================================================
// TRANSLATION SYSTEM
// LW: German first because thats what we started with
// English added later. Some keys might still be missing
// TODO: Maybe add French/Spanish someday?
// FIXME: some keys are definetly duplicated, cleanup needed
// =====================================================
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PegaProx - Translations
// DE/EN i18n strings
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const translations={de:{// General
loading:'Laden...',save:'Speichern',cancel:'Abbrechen',delete:'LÃ¶schen',edit:'Bearbeiten',add:'HinzufÃ¼gen',close:'SchlieÃŸen',yes:'Ja',no:'Nein',ok:'OK',// added later
enabled:'Aktiviert',disabled:'Deaktiviert',enable:'Aktivieren',disable:'Deaktivieren',actions:'Aktionen',status:'Status',name:'Name',type:'Typ',// type: 'Type',  // english version, remove later - LW
online:'Online',offline:'Offline',running:'LÃ¤uft',stopped:'Gestoppt',active:'Aktiv',all:'Alle',id:'ID',cores:'Kerne',search:'Suche',searchByNameOrId:'Suche nach Name oder ID...',searchAllClusters:'Alle Cluster durchsuchen...',pressEnterToOpen:'Enter drÃ¼cken um zur VM zu springen',toggleFavorite:'Favorit umschalten',results:'Ergebnisse',noResults:'Keine Ergebnisse',target:'Ziel',source:'Quelle',rules:'Regeln',default:'Standard',none:'Keine',of:'von',since:'Seit',uptime:'Betriebszeit',sinceStart:'Seit Start',osVersion:'OS-Version',guestAgentNotInstalled:'QEMU Guest Agent nicht installiert',guestAgentInstallHint:'Installiere qemu-guest-agent um Hostname, OS und Kernel anzuzeigen',// LW: Feb 2026 - Corporate VM Detail View
vmSummary:'VM-Zusammenfassung',generalInfo:'Allgemein',hardwareInfo:'Hardware',guestAgentInfo:'Guest Agent',backToList:'ZurÃ¼ck zur Liste',configure:'Konfigurieren',summary:'Zusammenfassung',console:'Konsole',sockets:'Sockets',machine:'Maschine',biosType:'BIOS',scsiController:'SCSI-Controller',networkAdapter:'Netzwerkadapter',cpuModel:'CPU-Modell',hostname:'Hostname',kernel:'Kernel',haStatus:'HA-Status',lockStatus:'Sperrstatus',notLocked:'Nicht gesperrt',locked:'Gesperrt',cpuUsage:'CPU-Auslastung',ramUsage:'RAM-Auslastung',vmid:'VMID',node:'Node',score:'Score',consoleAvailable:'Konsole verfÃ¼gbar',vmPoweredOff:'VM ist ausgeschaltet',launchWebConsole:'Web-Konsole Ã¶ffnen',qemuAgent:'QEMU Agent',installGuestAgent:'QEMU Guest Agent installieren...',vmHardware:'VM Hardware',relatedObjects:'ZugehÃ¶rige Objekte',network:'Netzwerk',// LW: Feb 2026 - Corporate Node Detail View
hostDetails:'Hostdetails',capacityUsage:'KapazitÃ¤t und Nutzung',monitor:'Ãœberwachen',logicalProcessors:'Logische Prozessoren',networkInterfaces:'Netzwerkschnittstellen',certificates:'Zertifikate',timeConfig:'Zeitkonfiguration',hostsFile:'Hosts-Datei',vmsOnNode:'VMs auf diesem Node',nodeShell:'Node-Shell',subscriptionInfo:'Abonnement',pveVersion:'PVE-Version',kernelVersion:'Kernel-Version',cpuSockets:'CPU-Sockets',totalRam:'Gesamt-RAM',rootFilesystem:'Root-Dateisystem',swapUsage:'Swap-Nutzung',systemInfo:'Systeminformationen',storage:'Speicher',repositories:'Repositories',performance:'Leistung',tasks:'Aufgaben',rebootNode:'Node neustarten',shutdownNode:'Node herunterfahren',nodeSettings:'Node-Einstellungen',dns:'DNS',syslog:'Syslog',disks:'Festplatten',lvmStorage:'LVM',lvmThinStorage:'LVM-Thin',zfsStorage:'ZFS',// Auth
login:'Anmelden',logout:'Abmelden',loginTitle:'Bei PegaProx anmelden',loginSubtitle:'PegaProx Cluster Management for Proxmox VE',usernameLabel:'Benutzername',passwordLabel:'Passwort',passwordPolicyHint:'Min. 8 Zeichen, GroÃŸ-, Kleinbuchstaben & Zahl erforderlich',minChars:'Min.',characters:'Zeichen',uppercase:'GroÃŸbuchstaben',lowercase:'Kleinbuchstaben',numbers:'Zahl',specialChar:'Sonderzeichen',loginButton:'Anmelden',loggingIn:'Anmeldung...',loginError:'Anmeldung fehlgeschlagen',invalidCredentials:'UngÃ¼ltige Anmeldedaten',sessionExpired:'Sitzung abgelaufen',welcomeBack:'Willkommen zurÃ¼ck',changePassword:'Passwort Ã¤ndern',currentPassword:'Aktuelles Passwort',newPassword:'Neues Passwort',confirmPassword:'Passwort bestÃ¤tigen',passwordChanged:'Passwort geÃ¤ndert',passwordMismatch:'PasswÃ¶rter stimmen nicht Ã¼berein',userManagement:'Benutzerverwaltung',users:'Benutzer',addUser:'Benutzer hinzufÃ¼gen',editUser:'Benutzer bearbeiten',deleteUser:'Benutzer lÃ¶schen',deleteUserConfirm:'Benutzer wirklich lÃ¶schen?',role:'Rolle',roleAdmin:'Administrator',roleUser:'Benutzer',roleViewer:'Betrachter',displayName:'Anzeigename',user:'Benutzer',email:'E-Mail',userEnabled:'Aktiviert',lastLogin:'Letzte Anmeldung',never:'Nie',profile:'Profil',// PegaProx Settings
pegaproxSettings:'PegaProx Einstellungen',serverSettings:'Server',networkSettings:'Netzwerk-Einstellungen',domain:'Domain',domainHint:'Ã–ffentliche Domain fÃ¼r den Zugriff auf PegaProx',port:'Port',portHint:'Standard: 5000, HTTPS typischerweise 443',httpRedirectPort:'HTTP Redirect Port (zusÃ¤tzlich)',httpRedirectPortHint:'FÃ¼r Port 80 Redirect. -1 = aus (Standard), 0 = auto, 80 = aktiviert. HTTP auf gleichem Port wird automatisch umgeleitet.',sslSettings:'SSL/TLS Zertifikat',enableSsl:'SSL aktivieren',sslCertificate:'SSL Zertifikat',sslKey:'Privater SchlÃ¼ssel',noCertSelected:'Kein Zertifikat ausgewÃ¤hlt',noKeySelected:'Kein SchlÃ¼ssel ausgewÃ¤hlt',browse:'Durchsuchen',sslWarning:'Nach dem Aktivieren von SSL muss der Server neu gestartet werden. Stellen Sie sicher, dass Zertifikat und SchlÃ¼ssel gÃ¼ltig sind!',sslHint:'FÃ¼r Let\'s Encrypt: Verwenden Sie fullchain.pem als Zertifikat und privkey.pem als SchlÃ¼ssel.',saveSettings:'Einstellungen speichern',serverSettingsSaved:'Server-Einstellungen gespeichert',restartRequired:'Server-Neustart erforderlich um Ã„nderungen anzuwenden',restartInfo:'Hinweis zu Ã„nderungen',restartInfoDesc:'Ã„nderungen an Port oder SSL-Einstellungen erfordern einen Neustart des PegaProx-Servers.',errorSavingSettings:'Fehler beim Speichern der Einstellungen',restartServer:'Server neu starten',restartServerDesc:'Startet den PegaProx-Server neu um Ã„nderungen anzuwenden',restartNow:'Jetzt neu starten',confirmRestart:'Server neu starten?',restartWarning:'Der Server wird kurzzeitig nicht erreichbar sein',restartConfirmText:'MÃ¶chten Sie den PegaProx-Server wirklich neu starten?',restartEffect1:'Alle aktiven Verbindungen werden getrennt',restartEffect2:'Die WeboberflÃ¤che ist fÃ¼r ca. 5-10 Sekunden nicht erreichbar',restartEffect3:'Nicht gespeicherte Ã„nderungen gehen verloren',yesRestart:'Ja, neu starten',restarting:'Wird neu gestartet...',restartInitiated:'Server-Neustart wurde eingeleitet',reconnecting:'Verbindung wird wiederhergestellt...',restartFailed:'Server-Neustart fehlgeschlagen',// Tenants & Permissions
// Feature request from r/selfhosted - MSPs wanted multi-tenant support
// Took a weekend to implement but people seem to like it
tenants:'Mandanten',tenant:'Mandant',addTenant:'Mandant hinzufÃ¼gen',editTenant:'Mandant bearbeiten',deleteTenant:'Mandant lÃ¶schen',tenantSaved:'Mandant gespeichert',tenantClustersHint:'WÃ¤hlen Sie aus, auf welche Cluster dieser Mandant zugreifen kann (leer = alle)',noVmsInCluster:'Keine VMs in diesem Cluster gefunden',tenantsDesc:'Mandanten ermÃ¶glichen die Trennung von Benutzern und die EinschrÃ¤nkung des Zugriffs auf bestimmte Cluster.',tenantAutoHint:'Wird automatisch gesetzt bei Mandanten-Rolle',defaultTenant:'Standard-Mandant',tenantClusters:'Cluster fÃ¼r diesen Mandanten',allClusters:'Alle Cluster',// Cluster Groups - NS Jan 2026
clusterGroups:'Cluster-Gruppen',clusterGroup:'Cluster-Gruppe',addGroup:'Gruppe hinzufÃ¼gen',editGroup:'Gruppe bearbeiten',deleteGroup:'Gruppe lÃ¶schen',groupName:'Gruppenname',groupDescription:'Beschreibung',groupColor:'Farbe',assignToGroup:'Gruppe zuweisen',ungrouped:'Nicht gruppiert',noGroup:'Keine Gruppe',removeFromGroup:'Aus Gruppe entfernen',groupCreated:'Gruppe erstellt',groupDeleted:'Gruppe gelÃ¶scht',groupUpdated:'Gruppe aktualisiert',manageGroups:'Gruppen verwalten',clusterGroupsDesc:'Organisieren Sie Cluster in Gruppen und weisen Sie sie Mandanten zur Zugriffskontrolle zu.',noGroupsYet:'Noch keine Gruppen erstellt',createGroupFirst:'Erstellen Sie zuerst eine Gruppe',assignTenant:'Mandant zuweisen (optional)',noTenantAllVisible:'Kein Mandant (fÃ¼r alle sichtbar)',groupTenantHint:'Wenn zugewiesen, sieht nur dieser Mandant die Cluster in dieser Gruppe',groupsTip:'Tipp: Weisen Sie Gruppen Mandanten in Einstellungen â†‘ Cluster-Gruppen zu fÃ¼r Zugriffskontrolle',permissions:'Berechtigungen',permission:'Berechtigung',permissionsDesc:'Konfigurieren Sie granulare Berechtigungen fÃ¼r Benutzer. Rollenbasierte Standardwerte kÃ¶nnen pro Benutzer Ã¼berschrieben werden.',selectUser:'Benutzer auswÃ¤hlen',selectUserToEdit:'WÃ¤hlen Sie einen Benutzer aus, um die Berechtigungen zu bearbeiten',effectivePermissions:'Effektive Berechtigungen',extraPermissions:'ZusÃ¤tzliche Berechtigungen',deniedPermissions:'Verweigerte Berechtigungen',grantedByRole:'Von Rolle gewÃ¤hrt',permissionSaved:'Berechtigungen gespeichert',tenantCreated:'Mandant erstellt',tenantDeleted:'Mandant gelÃ¶scht',tenantUpdated:'Mandant aktualisiert',cannotDeleteDefaultTenant:'Standard-Mandant kann nicht gelÃ¶scht werden',reassignUsersFirst:'Benutzer mÃ¼ssen zuerst neu zugewiesen werden',// Custom Roles section
roles:'Rollen',customRoles:'Benutzerdefinierte Rollen',createRole:'Rolle erstellen',roleId:'Rollen-ID',roleName:'Anzeigename',rolesDesc:'Erstellen Sie benutzerdefinierte Rollen mit bestimmten Berechtigungen. Rollen kÃ¶nnen global oder mandantenspezifisch sein.',scope:'Geltungsbereich',global:'Global',roleCreated:'Rolle erstellt',roleSaved:'Rolle gespeichert',roleDeleted:'Rolle gelÃ¶scht',confirmDeleteRole:'Diese Rolle wirklich lÃ¶schen?',builtinRole:'Eingebaute Rolle',tenantSpecific:'Mandantenspezifisch',roleTemplates:'Rollen-Vorlagen',roleTemplatesDesc:'Schnellstart-Vorlagen fÃ¼r gÃ¤ngige Rollenkonfigurationen',createFromTemplate:'Aus Vorlage erstellen',includedPermissions:'Enthaltene Berechtigungen',roleCreatedFromTemplate:'Rolle aus Vorlage erstellt',vmAcl:'VM-Zugriffskontrolle',vmAclDesc:'Berechtigungen fÃ¼r einzelne VMs festlegen',addVmAcl:'VM-Berechtigung hinzufÃ¼gen',editVmAcl:'VM-Berechtigung bearbeiten',vmPermissions:'VM-Berechtigungen',noVmAcls:'Keine VM-spezifischen Berechtigungen konfiguriert. Alle VMs folgen rollenbasierten Zugriffsrechten.',selectClusterFirst:'WÃ¤hlen Sie zuerst einen Cluster aus',selectVm:'VM auswÃ¤hlen',usersWithAccess:'Benutzer mit Zugriff',inheritRolePerms:'Voller VM-Zugriff (Start, Stop, Console, etc.)',customPermissions:'Benutzerdefinierte Berechtigungen',vmAclSaved:'VM-Berechtigungen gespeichert',vmAclDeleted:'VM-Berechtigungen entfernt',confirmDeleteVmAcl:'Benutzerdefinierte Berechtigungen fÃ¼r diese VM entfernen?',// Pool Permissions - MK Jan 2026
poolPermissions:'Pool-Berechtigungen',poolPermissionsDesc:'GewÃ¤hren Sie Benutzern oder Gruppen Zugriff auf Proxmox Resource Pools. Berechtigungen gelten fÃ¼r alle VMs im Pool.',managePools:'Pools verwalten',poolManagerDesc:'Erstellen, bearbeiten und lÃ¶schen Sie Resource Pools. Weisen Sie VMs zu Pools fÃ¼r organisierte Berechtigungsverwaltung zu.',createPool:'Pool erstellen',editPool:'Pool bearbeiten',deletePool:'Pool lÃ¶schen',poolId:'Pool-ID',poolIdRequired:'Pool-ID ist erforderlich',poolIdHint:'Nur Buchstaben, Zahlen, Bindestriche und Unterstriche',poolIdCannotChange:'Pool-ID kann nicht geÃ¤ndert werden',poolCreated:'Pool erfolgreich erstellt',poolUpdated:'Pool erfolgreich aktualisiert',poolDeleted:'Pool erfolgreich gelÃ¶scht',confirmDeletePool:'Sind Sie sicher, dass Sie diesen Pool lÃ¶schen mÃ¶chten? Dies kann nicht rÃ¼ckgÃ¤ngig gemacht werden.',noPoolsYet:'Noch keine Pools',createFirstPool:'Erstellen Sie Ihren ersten Pool, um VMs zu organisieren',poolMembers:'Mitglieder',members:'Mitglieder',addVmToPool:'VM zum Pool hinzufÃ¼gen',removeFromPool:'Aus Pool entfernen',vmAddedToPool:'VM zum Pool hinzugefÃ¼gt',vmRemovedFromPool:'VM aus Pool entfernt',confirmRemoveVmFromPool:'VM aus diesem Pool entfernen?',selectVmToAdd:'WÃ¤hlen Sie eine VM zum HinzufÃ¼gen aus',allVmsInPools:'Alle VMs sind bereits in Pools',optionalDescription:'Optionale Beschreibung...',userPermissions:'Benutzer-Berechtigungen',selectPool:'Pool auswÃ¤hlen',noPools:'Keine Resource Pools in diesem Cluster gefunden',noPoolPerms:'Keine Berechtigungen fÃ¼r diesen Pool konfiguriert',selectPoolFirst:'WÃ¤hlen Sie einen Cluster und Pool zur Verwaltung',addPoolPerm:'Pool-Berechtigung hinzufÃ¼gen',editPoolPerm:'Pool-Berechtigung bearbeiten',poolPermSaved:'Pool-Berechtigung gespeichert',poolPermDeleted:'Pool-Berechtigung entfernt',refreshPools:'Pools von Proxmox aktualisieren',poolCacheRefreshed:'Pool-Cache aktualisiert',confirmDeletePoolPerm:'Berechtigung entfernen?',subjectType:'Typ',permissionsFor:'Berechtigungen fÃ¼r',addPermission:'Berechtigung hinzufÃ¼gen',groupName:'Gruppenname',auditLog:'Audit Log',auditLogDescription:'Alle Benutzeraktionen der letzten 90 Tage',noAuditLogs:'Keine Audit-EintrÃ¤ge vorhanden',action:'Aktion',details:'Details',timestamp:'Zeitstempel',ipAddress:'IP-Adresse',userCreated:'Benutzer erstellt',userUpdated:'Benutzer aktualisiert',userDeleted:'Benutzer gelÃ¶scht',userLogin:'Anmeldung',userLogout:'Abmeldung',passwordChanged:'Passwort geÃ¤ndert',clusterAdded:'Cluster hinzugefÃ¼gt',apiTokenWarningTitle:'API Token Authentifizierung',apiTokenWarningDesc:'Die Verwendung von API Tokens wird unterstÃ¼tzt, aber nicht alle Funktionen werden korrekt funktionieren. Features die SSH-Zugriff benÃ¶tigen (SMBIOS Auto-Config, Rolling Updates, 2-Node HA, Node Shell) erfordern Passwort-Authentifizierung. PegaProx empfiehlt einen dedizierten privilegierten Benutzer oder root mit Passwort fÃ¼r volle FunktionalitÃ¤t.',clusterDeleted:'Cluster gelÃ¶scht',clusterConfigChanged:'Cluster-Konfiguration geÃ¤ndert',vmStarted:'VM gestartet',vmStopped:'VM gestoppt',vmRestarted:'VM neu gestartet',vmCreated:'VM erstellt',vmDeleted:'VM gelÃ¶scht',vmCloned:'VM geklont',vmMigrated:'VM migriert',vmUnlocked:'VM entsperrt',vmLocked:'VM gesperrt',unlockVm:'VM entsperren',lockReason:'Sperrgrund',unlockWarning:'Warnung: Das Entsperren einer VM wÃ¤hrend einer aktiven Operation kann zu Datenverlust oder anderen Problemen fÃ¼hren. Nur fortfahren wenn die Operation fehlgeschlagen oder abgebrochen wurde.',vmBulkMigrated:'Massen-Migration',vmConfigChanged:'VM-Konfiguration geÃ¤ndert',vmSuspended:'VM angehalten',vmResumed:'VM fortgesetzt',vmDiskAdded:'Festplatte hinzugefÃ¼gt',vmDiskRemoved:'Festplatte entfernt',vmDiskResized:'Festplatte vergrÃ¶ÃŸert',vmDiskMoved:'Festplatte verschoben',vmNetworkAdded:'Netzwerk hinzugefÃ¼gt',vmNetworkRemoved:'Netzwerk entfernt',vmNetworkUpdated:'Netzwerk aktualisiert',removeDiskConfirm:'Festplatte wirklich entfernen',detachDisk:'Abklemmen',importDisk:'Festplatte importieren',importDiskDesc:'Vorhandenes Disk-Image von Storage importieren',selectImportStorage:'Quell-Storage auswÃ¤hlen',selectDiskImage:'Disk-Image auswÃ¤hlen',targetBus:'Ziel-Bus',reassignOwner:'Besitzer Ã¤ndern',reassignOwnerDesc:'Festplatte einer anderen VM zuweisen',targetVm:'Ziel-VM',diskReassigned:'Festplatte neu zugewiesen',diskImported:'Festplatte importiert',noImportableDisks:'Keine importierbaren Disk-Images gefunden',reassign:'Neu zuweisen',import:'Importieren',detachDiskConfirm:'Festplatte wirklich abklemmen? Sie wird zu einer ungenutzten Festplatte.',diskDetached:'Festplatte abgeklemmt',diskDeleted:'Festplatte gelÃ¶scht',diskAdded:'Festplatte hinzugefÃ¼gt',dataWillBeDeleted:'Daten werden dauerhaft gelÃ¶scht!',removeNetworkConfirm:'Netzwerk wirklich entfernen',snapshotCreated:'Snapshot erstellt',snapshotDeleted:'Snapshot gelÃ¶scht',snapshotRestored:'Snapshot wiederhergestellt',rollbackConfirm:'Wirklich zu diesem Snapshot zurÃ¼ckrollen? Dies kann nicht rÃ¼ckgÃ¤ngig gemacht werden!',replicationCreated:'Replikation erstellt',replicationDeleted:'Replikation gelÃ¶scht',replicationTriggered:'Replikation manuell gestartet',haEnabled:'HA aktiviert',haDisabled:'HA deaktiviert',noFallbackHosts:'Keine Fallback-Hosts gefunden (Single-Node Cluster?)',haVmAdded:'VM zu HA hinzugefÃ¼gt',haVmRemoved:'VM aus HA entfernt',nodeMaintenanceEntered:'Wartungsmodus aktiviert',nodeMaintenanceExited:'Wartungsmodus beendet',nodeUpdateStarted:'Node-Update gestartet',twoFactorAuth:'2-Faktor-Authentifizierung',twoFactorEnabled:'2FA aktiviert',twoFactorDisabled:'2FA deaktiviert',enable2FA:'2FA aktivieren',disable2FA:'2FA deaktivieren',setup2FA:'2FA einrichten',scan2FACode:'QR-Code mit Authenticator-App scannen',enter2FACode:'6-stelligen Code eingeben',verify2FA:'Verifizieren',secretKey:'Geheimer SchlÃ¼ssel',twoFARequired:'2FA-Code erforderlich',invalid2FACode:'UngÃ¼ltiger 2FA-Code',force2FA:'2FA erzwingen',force2FADesc:'Alle Benutzer mÃ¼ssen Zwei-Faktor-Authentifizierung einrichten bevor sie PegaProx verwenden kÃ¶nnen.',force2FAHint:'OIDC/Entra-Benutzer sind ausgenommen (nutzen MFA ihres Identity Providers). Benutzer ohne 2FA sehen beim Login einen Einrichtungs-Dialog.',force2FAExcludeAdmins:'Admin-Konten ausschlieÃŸen',force2FAExcludeAdminsDesc:'Admins kÃ¶nnen PegaProx ohne 2FA nutzen',force2FASetupTitle:'2FA-Einrichtung erforderlich',force2FASetupDesc:'Ihr Administrator hat Zwei-Faktor-Authentifizierung fÃ¼r alle Benutzer verpflichtend gemacht. Bitte richten Sie 2FA ein um fortzufahren.',resetPassword:'Passwort zurÃ¼cksetzen',newPassword:'Neues Passwort',confirmPassword:'Passwort bestÃ¤tigen',currentPassword:'Aktuelles Passwort',passwordsDoNotMatch:'PasswÃ¶rter stimmen nicht Ã¼berein',passwordTooShort:'Passwort muss mindestens 4 Zeichen haben',passwordResetSuccess:'Passwort erfolgreich geÃ¤ndert',myProfile:'Mein Profil',security:'Sicherheit',snapshotNotSupported:'Snapshots werden nicht unterstÃ¼tzt',snapshotWarnings:'Snapshot-Warnungen',filterByUser:'Nach Benutzer filtern',filterByAction:'Nach Aktion filtern',allUsers:'Alle Benutzer',allActions:'Alle Aktionen',exportAuditLog:'Exportieren',refreshAuditLog:'Aktualisieren',// Header
addCluster:'Cluster hinzufÃ¼gen',pveClusterDesc:'Virtuelle Maschinen & Container',pbsDesc:'Backup-Verwaltung',vmwareDesc:'ESXi-Infrastruktur',addConnection:'Verbindung hinzufÃ¼gen',connectionType:'Verbindungstyp',clusterManagement:'PegaProx Cluster Management for Proxmox VE',// Tabs
overview:'Ãœbersicht',resources:'Ressourcen',datacenter:'Datacenter',settings:'Einstellungen',of:'von',showing:'Zeige',perPage:'Pro Seite',loadingDatacenter:'Lade Datacenter Daten...',// Cluster
clusters:'Cluster',noClusterSelected:'Kein Cluster ausgewÃ¤hlt',allClustersOverview:'Alle Cluster Ãœbersicht',allClusters:'Alle Cluster',multiClusterSummary:'Zusammenfassung aller verwalteten Cluster',clustersConnected:'Cluster verbunden',clusterOverview:'Cluster Ãœbersicht',vmsRunning:'VMs laufend',vmsStopped:'VMs gestoppt',noClustersConfigured:'Keine Cluster konfiguriert',addClusterToStart:'FÃ¼ge einen Cluster hinzu um zu beginnen',clickClusterTip:'Klicke auf eine Cluster-Zeile oder wÃ¤hle aus der Sidebar um Details anzuzeigen und Ressourcen zu verwalten.',health:'Zustand',average:'Durchschnitt',noDataAvailable:'Keine Daten verfÃ¼gbar',clickToManage:'Klicken zum Verwalten',sortBy:'Sortieren nach',ungrouped:'Nicht gruppiert',alerts:'Warnungen',updated:'Aktualisiert',justNow:'gerade eben',topResources:'Top Ressourcen',highestCpuUsage:'HÃ¶chste CPU- und RAM-Auslastung Ã¼ber alle Cluster',clickToOpenVm:'Klicken um VM zu Ã¶ffnen',selectCluster:'WÃ¤hle einen Cluster aus der Liste aus',addFirstCluster:'Ersten Cluster hinzufÃ¼gen',connectCluster:'Verbinde einen Proxmox Cluster mit PegaProx',clusterName:'Cluster Name',host:'Host',username:'Benutzername',password:'Passwort',passwordOrToken:'Passwort / Token',apiTokenHint:'FÃ¼r API Tokens: user@realm!tokenid',sslVerification:'SSL Verifizierung',connecting:'Verbinde...',addNewCluster:'Neuen Cluster hinzufÃ¼gen',testConnection:'Verbindung testen',deleteCluster:'Cluster lÃ¶schen',deleteClusterConfirm:'Cluster wirklich lÃ¶schen?',clusterHealth:'Cluster Gesundheit',excellent:'Ausgezeichnet',good:'Gut',warning:'Warnung',critical:'Kritisch',nodesOnline:'Nodes Online',nodeJoinHint:'Um einen neuen Node hinzuzufÃ¼gen, fÃ¼hre auf dem neuen Node aus:',avgScore:'Avg. Score',avgCpu:'Avg. CPU',avgRam:'Avg. RAM',// Nodes
nodes:'Nodes',node:'Node',loadingMetrics:'Lade Metriken...',connectionError:'Verbindungsfehler',retry:'Erneut versuchen',checkConnectionAndRetry:'Bitte Ã¼berprÃ¼fen Sie Ihre Verbindung und versuchen Sie es erneut.',connectionTimeout:'ZeitÃ¼berschreitung - Proxmox nicht erreichbar',maintenance:'Wartung',enterMaintenance:'Wartungsmodus aktivieren',exitMaintenance:'Wartungsmodus beenden',maintenanceMode:'Wartungsmodus',update:'Update',startUpdate:'Update starten',nodeConfig:'Node Konfiguration',cpuHistory:'CPU Verlauf',ramHistory:'RAM Verlauf',ramUsage:'RAM Nutzung',cpuUsage:'CPU Nutzung',diskUsage:'Disk Nutzung',showMore:'Mehr anzeigen',showLess:'Weniger anzeigen',// VMs & Resources
virtualMachines:'Virtuelle Maschinen',containers:'Container',vm:'VM',lxc:'LXC',lxcContainer:'LXC Container',container:'Container',guests:'Guests',start:'Starten',stop:'Stoppen',shutdown:'Herunterfahren',reboot:'Neustarten',forceStop:'Force Stop',forceReset:'Force Reset',forceStopConfirm:'wirklich hart ausschalten? Dies kann zu Datenverlust fÃ¼hren!',migrate:'Migrieren',migrateVm:'VM migrieren',crossClusterMigration:'Cross-Cluster Migration',crossClusterMigrateDesc:'VM zu anderem Proxmox-Cluster migrieren',crossClusterMigrate:'Cross-Cluster migrieren',crossClusterStarted:'Cross-Cluster Migration gestartet',crossClusterFailed:'Cross-Cluster Migration fehlgeschlagen',crossClusterLB:'Cross-Cluster Lastverteilung',crossClusterLBEnabled:'Cross-Cluster LB aktiviert',crossClusterLBDisabled:'Cross-Cluster LB deaktiviert',crossClusterLBThreshold:'Score-Schwellenwert',crossClusterLBInterval:'PrÃ¼fintervall',crossClusterLBDryRun:'Simulation (Dry Run)',crossClusterLBLastRun:'Letzter Lauf',crossClusterReplication:'Cross-Cluster Replikation',crossClusterReplicationDesc:'VM-Snapshots zu anderem Cluster replizieren (DR)',groupOverview:'GruppenÃ¼bersicht',groupSettings:'Gruppeneinstellungen',groupSettingsSaved:'Gruppeneinstellungen gespeichert',replicationSchedule:'Zeitplan',replicationRetention:'Aufbewahrung',maxMigrations:'Max. Migrationen pro Zyklus',lbHistory:'LB-Verlauf',clusterScore:'Cluster-Score',noReplicationJobs:'Keine Cross-Cluster Replikationsjobs',createReplicationJob:'DR-Job erstellen',replicationStarted:'Replikation gestartet',replicationJobCreated:'Replikationsjob erstellt',replicationJobDeleted:'Replikationsjob gelÃ¶scht',recentLbActions:'Letzte Cross-Cluster LB-Aktionen',noLbEvents:'Noch keine Cross-Cluster LB-Ereignisse',enableCrossClusterLB:'Cross-Cluster Lastverteilung aktivieren',lbDescription:'VMs automatisch zwischen Clustern migrieren, wenn Ressourcen-Schwellenwerte Ã¼berschritten werden',dryRunMode:'Dry Run / Simulationsmodus',cpuThreshold:'CPU-Schwellenwert (%)',lbStatus:'Lastverteilungs-Status',lbExplanation:'Die Cross-Cluster Lastverteilung Ã¼berwacht CPU- und RAM-Auslastung Ã¼ber alle Cluster in dieser Gruppe. Wenn ein Cluster den konfigurierten Schwellenwert Ã¼berschreitet, werden VMs automatisch zu einem weniger ausgelasteten Cluster migriert.',lbDryRunExplanation:'Aktivieren Sie zuerst den Dry Run-Modus, um geplante Aktionen zu prÃ¼fen, bevor Sie Live-Migrationen aktivieren.',neverRun:'Noch nie ausgefÃ¼hrt',newCrossClusterReplication:'Neue Cross-Cluster Replikation',confirmDeleteXRepl:'Diesen Cross-Cluster Replikationsjob wirklich lÃ¶schen?',addDrJob:'DR-Job hinzufÃ¼gen',scheduleCron:'Zeitplan (Cron)',targetStorageHint:'Storage-Name auf dem Ziel-Cluster',maxMigrationsHint:'Maximale Anzahl VMs pro PrÃ¼fzyklus (1-5)',proxlbCredit:'ProxLB von gyptazy',proxlbCreditDesc:'Unsere LastverteilungsfunktionalitÃ¤t basiert auf der hervorragenden Arbeit von ProxLB. Besonderer Dank an gyptazy fÃ¼r die Erstellung und Open-Source-Bereitstellung dieses groÃŸartigen Tools!',xReplCreated:'Cross-Cluster Replikation erstellt',xReplDeleted:'Cross-Cluster Replikation gelÃ¶scht',xReplStarted:'Cross-Cluster Replikation gestartet',xReplCreateFailed:'Job-Erstellung fehlgeschlagen',xReplDeleteFailed:'LÃ¶schen fehlgeschlagen',xReplStartFailed:'Start fehlgeschlagen',lastRunPrefix:'Zuletzt',runNow:'Jetzt ausfÃ¼hren',loadingCrossClusterResources:'Lade Storage/Netzwerk fÃ¼r alle Cluster...',noCommonStorages:'Kein gemeinsamer Storage Ã¼ber alle Cluster gefunden',noCommonBridges:'Keine gemeinsame Bridge Ã¼ber alle Cluster gefunden',selectBridge:'Bridge auswÃ¤hlen...',crossClusterThresholdDesc:'CPU-Schwellenwert fÃ¼r Cluster-Imbalance (10-80%)',crossClusterIntervalDesc:'Zeit zwischen PrÃ¼fzyklen',crossClusterMaxMigrationsDesc:'Maximale Migrationen pro PrÃ¼fzyklus',commonStorageHint:'Nur Storages, die auf allen Clustern in der Gruppe verfÃ¼gbar sind',commonBridgeHint:'Nur Bridges, die auf allen Clustern in der Gruppe verfÃ¼gbar sind',includeContainers:'Container einbeziehen',includeContainersDesc:'Container (LXC) beim Cross-Cluster-Balancing berÃ¼cksichtigen',containerMigrationWarning:'Container werden beim Migrieren neu gestartet (Downtime)',excludedVMsCrossCluster:'Ausgeschlossene VMs/Container',excludedVMsCrossClusterDesc:'VMs und Container, die vom automatischen Cross-Cluster-Balancing ausgeschlossen sind',clusterExcludedVMs:'Ausgeschlossene VMs',noExcludedVMsInGroup:'Keine VMs ausgeschlossen',selectCluster:'Cluster auswÃ¤hlen...',selectClusterFirst:'Bitte zuerst einen Ziel-Cluster auswÃ¤hlen',simulationMode:'Simulationsmodus',sourceVm:'Quell-VM',targetCluster:'Ziel-Cluster',targetNode:'Ziel-Node',targetStorage:'Ziel-Storage',targetBridge:'Ziel-Netzwerk (Bridge)',moveDisk:'Festplatte verschieben',resizeDisk:'Festplatte vergrÃ¶ÃŸern',diskResized:'Festplatte vergrÃ¶ÃŸert',deleteSourceDisk:'Quelle nach Verschieben lÃ¶schen',deleteSourceDiskWarning:'Die Original-Festplatte bleibt auf dem Quell-Storage. Sie kÃ¶nnen sie spÃ¤ter manuell entfernen.',move:'Verschieben',from:'von',noNetworkInterfaces:'Keine Netzwerk-Interfaces',nameRequired:'Name erforderlich',newVmid:'Neue VMID (optional)',sameIdPlaceholder:'Leer = gleiche ID',liveMigrationOption:'Live-Migration (VM lÃ¤uft weiter)',deleteSourceAfter:'Quell-VM nach Migration lÃ¶schen',largeDiskWarning:'GroÃŸe Disk erkannt',largeDiskExplanation:'Live-Migration bei Disks >100GB kann mit "401 Unauthorized" fehlschlagen (Proxmox WebSocket-Ticket Timeout). Der Server wechselt automatisch auf Offline-Migration, es sei denn, Sie erzwingen Online.',forceOnlineMigration:'Online-Migration trotzdem erzwingen (kann fehlschlagen)',autoTokenInfo:'PegaProx erstellt temporÃ¤re API-Tokens fÃ¼r die Migration und lÃ¶scht diese automatisch nach Abschluss.',clusterReachableInfo:'Die Cluster mÃ¼ssen sich gegenseitig Ã¼ber das Netzwerk erreichen kÃ¶nnen. Der konfigurierte Benutzer muss Rechte zum Erstellen von API-Tokens haben.',selectCluster:'Cluster auswÃ¤hlen...',selectNode:'Node auswÃ¤hlen',selectStorage:'Storage auswÃ¤hlen...',loadingNodes:'Lade Ziel-Nodes...',loadingStorageNetwork:'Lade Storage/Netzwerk...',liveMigration:'Live-Migration (ohne Downtime)',on:'auf',targetStorage:'Ziel-Storage',sameAsSource:'Gleich wie Quelle',loadingStorages:'Lade Storages',free:'frei',withLocalDisks:'Mit lokalen Disks',withLocalDisksDesc:'Lokale Disks zum Ziel-Storage migrieren',localDisksDetected:'Diese VM hat lokale Disks. Migration erfordert Kopieren der Disk-Daten.',requiredForThisVm:'Erforderlich fÃ¼r diese VM',cdDvdMounted:'CD/DVD eingelegt',cdDvdMigrationWarning:'Live-Migration ist mit eingelegter CD/DVD nicht mÃ¶glich. Bitte zuerst die CD/DVD auswerfen oder Offline-Migration verwenden.',isoMounted:'ISO/CD-ROM eingelegt',isoEjected:'CD-ROM ausgeworfen',isoMigrationWarning:'Migration kann fehlschlagen wenn die ISO auf dem Ziel-Node nicht verfÃ¼gbar ist. CD/DVD auswerfen oder ISO auf Shared Storage sicherstellen.',localStorage:'Lokal',bootOrderIssue:'Boot Order Problem',bootOrderWarning:'Boot Order referenziert nicht-existierende Disks',bootOrder:'Boot-Reihenfolge',dragToReorder:'Klicken zum Umschalten, Pfeile zum Sortieren',noBootDevices:'Keine Boot-GerÃ¤te gefunden',resizeDiskHint:'ErhÃ¶hen um (z.B. +10G) oder neue GrÃ¶ÃŸe',// SMBIOS Settings
smbiosSettings:'SMBIOS Einstellungen',smbiosHint:'System Management BIOS - nÃ¼tzlich fÃ¼r Windows-Lizenzierung und VM-Identifikation',applySmbiosFromClusterConfig:'SMBIOS-Einstellungen aus Cluster-Konfiguration anwenden',requiresRestart:'NEUSTART',readOnly:'schreibgeschÃ¼tzt',autoGenerated:'auto-generiert',smbiosFormatHint:'Nur Buchstaben und Zahlen erlaubt (A-Za-z0-9)',preview:'Vorschau',currentValue:'Aktueller Wert',managedByProxmox:'von Proxmox verwaltet',willBeAutoGenerated:'Wird beim Speichern automatisch generiert',forceConntrack:'Force (Conntrack State)',forceConntrackDesc:'Erzwingt Migration auch wenn Conntrack-EintrÃ¤ge existieren',containerNoLiveMigration:'Container unterstÃ¼tzen keine echte Live-Migration',startingMigration:'Starte Migration von',migrationStarted:'Migration gestartet:',migrationFailed:'Migration fehlgeschlagen',clone:'Klonen',console:'Konsole',openConsole:'Konsole Ã¶ffnen',metrics:'Metriken',config:'Konfiguration',configuration:'Konfiguration',createVm:'Neue VM erstellen',createContainer:'Neuen Container erstellen',noNodesAvailable:'Keine Nodes verfÃ¼gbar. Bitte warten Sie bis die Cluster-Daten geladen sind.',loadingStorage:'Lade Storage-Liste...',noIsoAvailable:'Keine ISO-Images gefunden',noTemplateAvailable:'Keine Templates gefunden',noStorageAvailable:'Keine Storage verfÃ¼gbar',noIsoStorage:'Kein Storage mit ISO-Inhalt gefunden',ram:'RAM',cpu:'CPU',disk:'Disk',network:'Netzwerk',// VM Creation Wizard
node:'Node',next:'NÃ¤chste',guestOs:'Gastbetriebssystem',isoImage:'ISO Image',noIso:'Kein ISO',virtioDrivers:'VirtIO Treiber ISO (Windows)',noVirtioDrivers:'Keine VirtIO Treiber',allIsos:'Alle ISOs',virtioDriversHint:'Wird als zusÃ¤tzliches CD-ROM eingebunden fÃ¼r Windows Treiberinstallation',// MK: New wizard translations
advancedCpu:'Erweiterte CPU-Einstellungen',cpuAffinity:'CPU-AffinitÃ¤t',cpuAffinityHint:'VCPUs an bestimmte Host-CPUs binden',enableNuma:'NUMA aktivieren',advancedMemory:'Erweiterte Arbeitsspeicher-Einstellungen',minimumMemory:'Minimaler Arbeitsspeicher',sameAsMemory:'Gleich wie Speicher (kein Ballooning)',minimumMemoryHint:'Untere Grenze fÃ¼r Speicher-Ballooning',ballooningDevice:'Ballooning-GerÃ¤t',memoryShares:'Speicher-Anteile',memorySharesHint:'Gewichtung fÃ¼r automatisches Speicher-Ballooning (0-50000, Standard: 1000)',primaryDisk:'PrimÃ¤re Festplatte',additionalDisk:'ZusÃ¤tzliche Festplatte',addDisk:'Festplatte hinzufÃ¼gen',macAddress:'MAC-Adresse',autoGenerate:'Auto-generieren (leer lassen)',advancedNetwork:'Erweiterte Netzwerk-Einstellungen',inheritBridge:'Von Bridge erben',rateLimit:'Ratenbegrenzung',unlimited:'Unbegrenzt',noLinkOnStart:'Keine Netzwerkverbindung beim Start',highAvailability:'HochverfÃ¼gbarkeit',enableHa:'Zu Proxmox Native HA hinzufÃ¼gen',haGroup:'HA-Gruppe',defaultGroup:'Standardgruppe (leer lassen)',rootFilesystem:'Root-Dateisystem',mountPoint:'Mount-Point',addMountPoint:'Mount-Point hinzufÃ¼gen',path:'Pfad',busType:'Bus/Typ',size:'GrÃ¶ÃŸe',format:'Format',storageDefault:'Storage Default',bestPerformance:'beste Performance',free:'frei',bridge:'Bridge',model:'Modell',vlanTag:'VLAN Tag (optional)',vlanExample:'z.B. 100',enableFirewall:'Firewall aktivieren',cpuType:'CPU Typ',machineType:'Machine Type',efiSettings:'UEFI/EFI Einstellungen',efiDiskStorage:'EFI Disk Storage',preEnrollKeys:'Pre-enroll Microsoft Keys (SecureBoot)',tpmSettings:'TPM (Trusted Platform Module)',enableTpm:'TPM aktivieren',tpmStorage:'TPM Storage',tpmVersion:'TPM Version',recommended:'empfohlen',win11NeedsTpm:'Windows 11 benÃ¶tigt TPM 2.0',efiTpmSettings:'EFI & TPM Einstellungen',efiDisk:'EFI Disk',tpmChip:'TPM Chip',configured:'Konfiguriert',noEfiDisk:'Keine EFI Disk konfiguriert',addEfiDisk:'EFI Disk hinzufÃ¼gen',efiDiskRequired:'Erforderlich fÃ¼r UEFI-Boot. Wird automatisch beim ersten Start erstellt wenn nicht konfiguriert.',efiDiskInfo:'EFI Disk speichert UEFI Firmware-Variablen und ist fÃ¼r UEFI-Boot erforderlich. GrÃ¶ÃŸe wird automatisch auf 4MB gesetzt.',efiDiskAdded:'EFI Disk hinzugefÃ¼gt',noTpm:'Kein TPM konfiguriert',addTpm:'TPM hinzufÃ¼gen',tpmInfo:'TPM (Trusted Platform Module) ist fÃ¼r Windows 11 erforderlich und bietet hardwarebasierte Sicherheitsfunktionen wie BitLocker.',tpmAdded:'TPM hinzugefÃ¼gt',confirmDeleteEfiDisk:'EFI Disk lÃ¶schen? Die VM startet mÃ¶glicherweise nicht mehr.',confirmDeleteTpm:'TPM lÃ¶schen? Windows 11 und BitLocker funktionieren nicht mehr.',efiDiskDeleted:'EFI Disk gelÃ¶scht',tpmDeleted:'TPM gelÃ¶scht',enableQemuAgent:'QEMU Guest Agent aktivieren',startOnBoot:'Bei Host-Start automatisch starten',startAfterCreate:'Nach Erstellung sofort starten',rootPassword:'Root Passwort',sshPublicKeys:'SSH Public Keys',loadSshKeyFile:'SSH Key Datei laden',sshKeyHintMultiple:'Ein Key pro Zeile. EinfÃ¼gen oder aus Datei laden.',// SSH Shell Login
dropKeyFileHere:'Key-Datei hier ablegen oder klicken',keyLoaded:'Key geladen',lines:'Zeilen',keyPassphrase:'Key Passphrase',optional:'optional',ifKeyEncrypted:'Falls Key verschlÃ¼sselt ist...',connect:'Verbinden',dnsDomain:'DNS Domain',dnsServers:'DNS Server',useHostSettings:'Host-Einstellungen verwenden',dnsServersHint:'Leerzeichen-getrennte Liste von DNS Servern',disconnected:'Getrennt',manual:'Manuell',ipAddress:'IP Adresse',recommended:'empfohlen',dockerSupport:'Docker Support',free:'frei',used:'belegt',total:'gesamt',selectTemplate:'Template wÃ¤hlen...',cpuCoresLabel:'CPU Kerne',swapMemory:'Swap (MB)',unprivileged:'Unprivilegiert',unprivilegedHint:'Sicherer, aber eingeschrÃ¤nkte FunktionalitÃ¤t',nesting:'Nesting',nestingHint:'ErmÃ¶glicht Docker/LXC in LXC',ipConfig:'IP Konfiguration',useDhcp:'DHCP verwenden',gateway:'Gateway',lvmZfsIgnoreFormat:'LVM/ZFS ignorieren Format',targetNode:'Ziel-Node',sameNode:'selber Node',crossNodeCloneWarning:'Cross-Node Clone benÃ¶tigt Shared Storage (NFS, Ceph, etc.). Lokaler Storage funktioniert nicht!',willBeCloned:'wird geklont',newVmId:'Neue VM ID',cloneMode:'Clone-Modus',fullClone:'Full Clone',fullCloneDesc:'UnabhÃ¤ngige Kopie aller Daten',linkedClone:'Linked Clone',linkedCloneDesc:'Schneller, benÃ¶tigt Basis-Image',onlyForVms:'Nur fÃ¼r VMs verfÃ¼gbar',cloneNotes:'Notizen zum Clone...',optional:'optional',gridView:'Kachelansicht',listView:'Listenansicht',compactView:'Kompaktansicht',selectVmFromList:'WÃ¤hle eine VM aus der Liste',selectAll:'Alle auswÃ¤hlen',deselectAll:'Auswahl aufheben',selectedItems:'ausgewÃ¤hlt',bulkActions:'Massenaktionen',quickActions:'Schnellaktionen',moreActions:'Weitere Aktionen',xOfYResources:'von',resourcesLabel:'Ressourcen Verwaltung',startClone:'Klonen starten',vmStillRunning:'Die VM lÃ¤uft noch. Sie wird vor dem LÃ¶schen gestoppt.',ctStillRunning:'Der Container lÃ¤uft noch. Er wird vor dem LÃ¶schen gestoppt.',confirmDelete:'LÃ¶schen bestÃ¤tigen',reallyDelete:'Wirklich lÃ¶schen?',connectionFailed:'Verbindung fehlgeschlagen',smartNotAvailable:'SMART-Daten nicht verfÃ¼gbar',smartFetchError:'Fehler beim Abrufen der SMART-Daten',cloneFailed:'Clone fehlgeschlagen',forceStopFailed:'Force Stop fehlgeschlagen',forceStopping:'Wird hart ausgeschaltet...',bulkMigrationFailed:'Bulk-Migration fehlgeschlagen',bulkMigration:'Bulk-Migration',vmsSelected:'VMs ausgewÃ¤hlt',targetNode:'Ziel-Node',selectNode:'Node auswÃ¤hlen...',liveMigration:'Live-Migration (ohne Downtime)',migrateVms:'VMs migrieren',startingBulkMigration:'Starte Bulk-Migration von',creationFailed:'Erstellung fehlgeschlagen',actionFailed:'Aktion fehlgeschlagen',autoDetectionFailed:'Auto-Erkennung fehlgeschlagen',clusterOffline:'Cluster nicht erreichbar',connectionClosed:'Verbindung beendet',unexpectedDisconnect:'Verbindung unerwartet getrennt',serverError:'Server-Fehler',switchTabToReconnect:'Tab wechseln und zurÃ¼ck um neu zu verbinden',deleteInterfaceConfirm:'Interface wirklich lÃ¶schen?',noMigrationsYet:'Noch keine Migrationen',showMore:'Alle anzeigen',showLess:'Weniger anzeigen',olderMigrations:'Ã¤ltere Migrationen',paused:'Pausiert',performanceMetrics:'Performance-Metriken',hour:'Stunde',day:'Tag',week:'Woche',month:'Monat',year:'Jahr',// Detail View
hostname:'Hostname',tags:'Tags',description:'Beschreibung',changesRequireRestart:'Hinweis: Manche Ã„nderungen erfordern einen Neustart',// Tags - NS Jan 2026
manageTags:'Tags verwalten',noTags:'Keine Tags',newTag:'Neuer Tag...',existingTags:'Vorhandene Tags',// Schedules - MK Jan 2026
schedules:'ZeitplÃ¤ne',scheduledActions:'Geplante Aktionen',newSchedule:'Neuer Zeitplan',editSchedule:'Zeitplan bearbeiten',noSchedules:'Keine geplanten Aktionen',noSchedulesDesc:'Erstelle ZeitplÃ¤ne um VMs automatisch zu starten, stoppen oder zu snapshotten',createFirstSchedule:'Ersten Zeitplan erstellen',scheduleCreated:'Zeitplan erstellt',scheduleDeleted:'Zeitplan gelÃ¶scht',scheduleType:'Zeitplan-Typ',daily:'TÃ¤glich',weekdays:'Wochentags',weekends:'Wochenende',weekly:'WÃ¶chentlich',once:'Einmalig',forOnce:'fÃ¼r einmalig',forWeekly:'fÃ¼r wÃ¶chentlich',days:'Tage',lastRun:'Letzter Lauf',// Reports - NS Jan 2026
reports:'Berichte',reportsAnalytics:'Berichte & Analysen',lastHour:'Letzte Stunde',last24h:'Letzte 24h',lastWeek:'Letzte Woche',recentTasks:'Letzte Aufgaben',noRecentTasks:'Keine aktuellen Aufgaben',alarms:'Alarme',noAlarms:'Keine aktiven Alarme',severity:'Schweregrad',completionTime:'Abschluss',startTime:'Startzeit',dismiss:'VERWERFEN',searchAllInventories:'In allen Inventaren suchen...',initiator:'Initiator',object:'Objekt',noReportData:'Keine Berichtsdaten',noReportDataDesc:'Historische Daten werden gesammelt. Schau in ein paar Minuten wieder vorbei.',topVmsCpu:'HÃ¶chste CPU-Auslastung',topVmsMem:'HÃ¶chste Speicher-Auslastung',historicalRange:'Historischer Bereich',dataPoints:'Datenpunkte',vmsRunning:'VMs laufend',containersRunning:'Container laufend',clustersOnline:'Cluster online',nodesOnline:'Nodes online',datacenterOverview:'Datacenter Ãœbersicht',noRunningVms:'Keine laufenden VMs',// Automation Tab - NS Jan 2026
automation:'Automatisierung',schedulesDesc:'VMs automatisch starten, stoppen, neustarten oder snapshotten',tagsDesc:'VMs mit Tags organisieren. Klicke auf das Tag-Symbol bei einer VM.',noTagsInCluster:'Keine Tags in diesem Cluster',addTagHint:'Nutze den Tag-Button bei VMs im Ressourcen-Tab',tagsTotal:'Tags',clickVmTag:'Klicke auf Tag-Symbol bei VMs zum Verwalten',alertsDesc:'Benachrichtigungen wenn Ressourcen Schwellwerte Ã¼berschreiten',newAlert:'Neuer Alarm',noAlertsCluster:'Keine Alarme fÃ¼r diesen Cluster',alertCreated:'Alarm erstellt',targetType:'Anwenden auf',entireCluster:'Gesamter Cluster',specificNode:'Bestimmter Node',specificVm:'Bestimmte VM',targetId:'Ziel',optional:'optional',condition:'Bedingung',cluster:'Cluster',affinityDesc:'VMs/CTs zusammen oder getrennt auf Nodes halten',newRule:'Neue Regel',noAffinityCluster:'Keine AffinitÃ¤tsregeln fÃ¼r diesen Cluster',ruleCreated:'Regel erstellt',together:'Zusammen',separate:'Getrennt',enforced:'Erzwungen',// Config Modal Tabs
generalTab:'Allgemein',resourcesTab:'Ressourcen',storageTab:'Storage',networkTab:'Netzwerk',snapshotsTab:'Snapshots',backupsTab:'Backups',replicationTab:'Replication',historyTab:'Verlauf',proxmoxTasks:'Proxmox Tasks',pegaproxActions:'PegaProx Aktionen',optionsTab:'Optionen',// Datacenter
summary:'Zusammenfassung',cluster:'Cluster',options:'Optionen',storage:'Storage',backup:'Backup',replication:'Replikation',balancing:'Balancing',excludedNodes:'Ausgeschlossene Nodes',excludedNodesDesc:'Diese Nodes werden niemals als Ziel fÃ¼r automatisches VM-Balancing oder Migrationsempfehlungen verwendet.',selectNodeToExclude:'Node zum AusschlieÃŸen wÃ¤hlen...',exclude:'AusschlieÃŸen',excludedFromBalancing:'Vom Balancing ausgeschlossen',reincludedInBalancing:'wieder ins Balancing aufgenommen',excludeNode:'Node vom Balancing ausschlieÃŸen',noExcludedNodes:'Keine Nodes ausgeschlossen - alle Nodes nehmen am Balancing teil',confirmExcludeNode:'AusschlieÃŸen',excludedVMs:'Ausgeschlossene VMs',excludedVMsDesc:'Diese VMs werden niemals automatisch wÃ¤hrend des Load Balancing migriert.',selectVMToExclude:'VM zum AusschlieÃŸen wÃ¤hlen...',noExcludedVMs:'Keine VMs ausgeschlossen - alle VMs nehmen am Balancing teil',sourceCluster:'Quell-Cluster',selectVM:'VM auswÃ¤hlen...',fromBalancing:'vom Balancing',allNodesExcluded:'Alle Nodes sind ausgeschlossen - Balancing ist effektiv deaktiviert',howExclusionWorks:'Wie Node-Ausschluss funktioniert',exclusionRule1:'Ausgeschlossene Nodes werden NICHT als Ziel fÃ¼r automatisches VM-Balancing verwendet',exclusionRule2:'Ausgeschlossene Nodes erhalten keine VMs wÃ¤hrend Load-Balancing-Migrationen',exclusionRule3:'Ausgeschlossene Nodes sind weiterhin sichtbar und kÃ¶nnen manuelle Migrationen empfangen',exclusionRule4:'VMs auf ausgeschlossenen Nodes kÃ¶nnen trotzdem migriert werden, wenn der Node Ã¼berlastet ist',// NS: Backup translations - Dec 2025
createBackup:'Backup erstellen',noBackups:'Keine Backups gefunden',noBackupsHint:'Erstellen Sie ein Backup oder prÃ¼fen Sie die Backup-Storages',backupMode:'Backup-Modus',compression:'Kompression',backupStarted:'Backup gestartet',downloadStarted:'Download gestartet',downloadFailed:'Download fehlgeschlagen',restoreBackup:'Backup wiederherstellen',selectedBackup:'AusgewÃ¤hltes Backup',targetVmid:'Ziel VMID',targetStorage:'Ziel-Storage',originalStorage:'Original beibehalten',sameVmidWarning:'Gleiche VMID = VM wird Ã¼berschrieben!',startAfterRestore:'Nach Wiederherstellung starten',confirmRestore:'Backup wirklich wiederherstellen?',restoreStarted:'Wiederherstellung gestartet',confirmDeleteBackup:'Backup wirklich lÃ¶schen?',backupDeleted:'Backup gelÃ¶scht',// LW: backup mode options
backupModeSnapshot:'Snapshot (kein Stopp)',backupModeSuspend:'Suspend (kurzer Stopp)',backupModeStop:'Stop (VM wird gestoppt)',compressZstd:'ZSTD (empfohlen)',compressLzo:'LZO (schnell)',compressGzip:'GZIP',compressNone:'Keine',backupNotes:'Notizen (optional)',backupNotesPlaceholder:'z.B. Vor groÃŸem Update, wÃ¶chentliches Backup...',// HA
ha:'HA',haResources:'HA Ressourcen',haGroups:'HA Gruppen',haStatus:'HA Status',cpuCompatibility:'CPU KompatibilitÃ¤t',cpuCompatibilityMode:'CPU KompatibilitÃ¤tsmodus',cpuCompatibilityDesc:'Stellt Live-Migration KompatibilitÃ¤t zwischen verschiedenen CPU-Generationen sicher',whatIsCpuCompat:'Was ist der CPU KompatibilitÃ¤tsmodus?',cpuCompatExplain:'Wenn Sie Nodes mit unterschiedlichen CPU-Generationen haben (z.B. Haswell und Skylake), kann die Live-Migration fehlschlagen, da neuere CPUs Funktionen haben die Ã¤ltere nicht unterstÃ¼tzen.',cpuCompatSolution:'Durch das Setzen eines gemeinsamen CPU-Typs fÃ¼r alle VMs stellen Sie sicher, dass diese zwischen allen Nodes im Cluster migriert werden kÃ¶nnen.',recommendedSettings:'Empfohlene Einstellungen',broadCompatibility:'Breite KompatibilitÃ¤t - funktioniert mit den meisten CPUs ab 2008',modern:'Modern',haswell:'Haswell und neuer (ab 2013)',newest:'Neueste',skylakeAvx:'Skylake-X mit AVX-512 (ab 2017)',noMigration:'Keine Migration',hostDesc:'Host-CPU durchreichen - beste Performance, keine Migration',nodesCpuInfo:'CPU-Information der Cluster-Nodes',howToApply:'So wenden Sie es an',cpuStep1:'Gehen Sie zum Hardware-Tab jeder VM',cpuStep2:'Bearbeiten Sie die CPU-Einstellung',cpuStep3:'Ã„ndern Sie "Type" auf Ihr gewÃ¤hltes KompatibilitÃ¤tslevel',cpuStep4:'Starten Sie die VM neu damit die Ã„nderungen wirksam werden',autoDetectedRecommendation:'Automatisch erkannte Empfehlung',basedOnClusterCpus:'Basierend auf den erkannten CPUs in Ihrem Cluster empfehlen wir:',availableLevels:'VerfÃ¼gbare KompatibilitÃ¤tsstufen',safest:'Sicherste',detectedClusterCpus:'Erkannte Cluster-CPUs',loadingCpuInfo:'Lade CPU-Informationen...',copy:'Kopieren',criticalAlert:'KRITISCHER ALARM',haRecoveryMayStart:'HA-Wiederherstellung lÃ¤uft mÃ¶glicherweise...',dismiss:'Verwerfen',nodeOffline:'Node offline',nodeOnline:'Node online',nodeUnreachable:'Node nicht erreichbar',offlineSince:'Offline seit',firewall:'Firewall',// SDN translations - LW Feb 2026
sdn:'SDN',sdnNotAvailable:'SDN nicht verfÃ¼gbar',sdnNotConfigured:'Software Defined Networking ist auf diesem Cluster nicht konfiguriert.',sdnPendingChanges:'Es gibt ausstehende SDN-Ã„nderungen, die angewendet werden mÃ¼ssen.',sdnApplied:'SDN-Konfiguration angewendet',sdnConfigSynced:'SDN-Konfiguration ist mit allen Nodes synchronisiert.',applyingSDN:'SDN-Konfiguration wird auf alle Nodes angewendet...',sdnApplyReminder:'ðŸ’¡ Klicke "Apply / Reload" um Ã„nderungen zu deployen',applyChanges:'Ã„nderungen anwenden',sdnZones:'Zonen',sdnVnets:'VNets',sdnInfo:'SDN-Informationen',zones:'Zonen',vnets:'VNets',subnets:'Subnetze',controllers:'Controller',noZones:'Keine Zonen konfiguriert',noVnets:'Keine VNets konfiguriert',createZoneFirst:'Erstelle zuerst eine Zone',addZone:'Zone hinzufÃ¼gen',addVnet:'VNet hinzufÃ¼gen',addSubnet:'Subnetz hinzufÃ¼gen',zoneName:'Zonenname',vnetName:'VNet-Name',simpleZoneDesc:'Isolierte Zone mit einfachem Bridging',vlanZoneDesc:'VLAN-basierte Zone mit 802.1q Tagging',vxlanZoneDesc:'VXLAN Overlay-Netzwerk',evpnZoneDesc:'BGP EVPN mit VXLAN',zoneCreated:'Zone erstellt - Klicke "Ã„nderungen anwenden" um zu aktivieren',vnetCreated:'VNet erstellt - Klicke "Ã„nderungen anwenden" um zu aktivieren',subnetCreated:'Subnetz erstellt - Klicke "Ã„nderungen anwenden" um zu aktivieren',zoneDeleted:'Zone gelÃ¶scht - Klicke "Ã„nderungen anwenden" um zu aktivieren',vnetDeleted:'VNet gelÃ¶scht - Klicke "Ã„nderungen anwenden" um zu aktivieren',sdnConfigSynced:'SDN-Konfiguration ist mit allen Nodes synchron.',applyingSDN:'SDN-Konfiguration wird auf alle Nodes angewendet...',confirmDeleteZone:'Zone lÃ¶schen?',confirmDeleteVnet:'VNet lÃ¶schen?',zoneNameRequired:'Zonenname ist erforderlich',vnetNameZoneRequired:'VNet-Name und Zone sind erforderlich',subnetRequired:'Subnetz ist erforderlich',sourceNat:'Source NAT',noControllers:'Keine Controller konfiguriert. Controller werden fÃ¼r EVPN/VXLAN-Zonen benÃ¶tigt.',addController:'Controller hinzufÃ¼gen',noIpam:'Kein IPAM konfiguriert. IPAM verwaltet IP-Adressen fÃ¼r Subnetze.',addIpam:'IPAM hinzufÃ¼gen',noDns:'Kein DNS konfiguriert. DNS-Integration ermÃ¶glicht automatische DNS-Registrierung fÃ¼r VMs.',addDns:'DNS hinzufÃ¼gen',seconds:'Sekunden',smbiosAuto:'SMBIOS Auto',smbiosAutoDesc:'Konfiguriert automatisch SMBIOS-Daten (Hersteller, Produkt, Seriennummer) fÃ¼r neue VMs und VMs ohne SMBIOS-Konfiguration. NÃ¼tzlich fÃ¼r Windows-Lizenzierung.',deploySmbiosConfirm:'SMBIOS Auto-Config auf alle Nodes in diesem Cluster deployen?',rescanAllVms:'Alle VMs neu scannen',showLogs:'Logs anzeigen',deployToAllNodes:'Auf alle Nodes deployen',updateAllNodes:'Alle Nodes aktualisieren',nodeStatus:'Node-Status',clickDeployToStart:'Klicke "Auf alle Nodes deployen" um zu starten',smbiosRequiresSSH:'âš ï¸ BenÃ¶tigt SSH-Key in den Cluster-Verbindungseinstellungen',whySSH:'Warum SSH?',smbiosSSHExplanation:'Dieses Feature verwendet SSH um Hook-Skripte auf den Nodes zu installieren. SSH-Credentials kÃ¶nnen optional in den Cluster-Einstellungen konfiguriert werden.',deployed:'Deployed',notDeployed:'Nicht deployed',requiresSSH:'BenÃ¶tigt SSH',deploymentFailed:'Deployment fehlgeschlagen',clusterNodes:'Cluster Nodes',joinInformation:'Join Information',datacenterOptions:'Datacenter Optionen',quorate:'Quorate',votes:'Stimmen',link:'Link',resourceUsage:'Ressourcennutzung',memory:'Speicher',// Storage
addStorage:'Storage hinzufÃ¼gen',storageId:'Storage ID',directory:'Verzeichnis',path:'Pfad',server:'Server',content:'Inhalt',shared:'Geteilt',deleteStorageConfirm:'Storage wirklich lÃ¶schen?',deleteBackupJobConfirm:'Backup Job wirklich lÃ¶schen?',storageType:'Storage Typ',volumeGroup:'Volume Group',thinPool:'Thin Pool',export:'Export',share:'Share',datastore:'Datastore',pool:'Pool',portal:'Portal',skipCertVerification:'ZertifikatsprÃ¼fung Ã¼berspringen',// Backup
backupJobs:'Backup Jobs',noBackupJobs:'Keine Backup Jobs',createBackupJob:'Backup Job erstellen',selectStorage:'Storage auswÃ¤hlen',allNodes:'Alle Nodes',hourly:'StÃ¼ndlich',daily:'TÃ¤glich (02:00)',weekly:'WÃ¶chentlich (Sonntag 02:00)',monthly:'Monatlich (1. des Monats 02:00)',compression:'Komprimierung',notification:'Benachrichtigung',always:'Immer',onFailure:'Bei Fehler',never:'Nie',schedule:'Zeitplan',selection:'Auswahl',retention:'Aufbewahrung',// Replication
replicationJobs:'Replikationsjobs',noReplicationJobs:'Keine Replikationsjobs',guest:'Guest',job:'Job',// Firewall
firewallOptions:'Firewall Optionen',firewallRules:'Firewall Regeln',noFirewallRules:'Keine Firewall Regeln',policyIn:'Policy In',policyOut:'Policy Out',addRule:'Regel hinzufÃ¼gen',deleteRuleConfirm:'Regel wirklich lÃ¶schen?',action:'Aktion',protocol:'Protokoll',confirmDeleteRule:'Diese Firewall-Regel wirklich lÃ¶schen?',addFirewallRule:'Firewall Regel hinzufÃ¼gen',aliases:'Aliase',noAliases:'Keine Aliase konfiguriert',noIpsets:'Keine IP Sets konfiguriert',firewallLog:'Firewall Log',noLogEntries:'Keine Log-EintrÃ¤ge',fwEnable:'Firewall',fwDhcp:'DHCP',fwNdp:'NDP',fwRadv:'Router Adv.',fwMacFilter:'MAC Filter',fwLogLevel:'Log Level In',fwLogLevelOut:'Log Level Out',fwAddAlias:'Alias hinzufÃ¼gen',fwAddIpset:'IP Set hinzufÃ¼gen',// Ceph
ceph:'Ceph',cephStatus:'Ceph Status',cephHealth:'Cluster Gesundheit',cephCapacity:'KapazitÃ¤t',cephOsds:'OSDs',cephMons:'Monitore',cephPools:'Pools',cephMds:'Metadata Server',cephFs:'CephFS',cephCreatePool:'Pool erstellen',cephCreateMon:'Monitor erstellen',cephNotInstalled:'Ceph nicht installiert',cephNotInstalledDesc:'Kein Ceph-Cluster auf diesem Proxmox-Cluster konfiguriert.',cephNotInstalledOnNode:'Ceph ist auf diesem Node nicht konfiguriert.',cephInstallHint:'Um Ceph einzurichten, Ã¶ffne einen Node und nutze den Ceph-Tab zur Initialisierung.',cephInit:'Ceph initialisieren',// Settings
balancingConfig:'Balancing Konfiguration',migrationThreshold:'Migration Threshold',migrationThresholdDesc:'Score-Differenz ab der eine Migration ausgelÃ¶st wird',checkInterval:'Check Intervall',checkIntervalDesc:'Intervall zwischen Balance-Checks',autoMigrate:'Automatische Migration',autoMigrateDesc:'Automatische VM-Migration bei Ungleichgewicht',dryRun:'Dry Run Modus (keine echten Migrationen)',dryRunShort:'Dry Run',dryRunDesc:'Migrationen nur simulieren, nicht ausfÃ¼hren',balancingEnabled:'Balancing aktiviert',optionsTitle:'Optionen',intervalBetweenChecks:'Intervall zwischen Balance-Checks',// HA
highAvailability:'High Availability (HA)',haEnabled:'High Availability aktiviert',haMonitoring:'HA Monitoring',haMonitorActive:'HA Monitor aktiv',fallbackHosts:'Fallback Hosts',fallbackHostsAuto:'Fallback Hosts (automatisch erkannt)',proxmoxHa:'Proxmox HA',proxmoxNativeHa:'Proxmox Native HA',haGroups:'HA Gruppen',haResources:'HA Ressourcen',fencing:'Fencing',haInactive:'Proxmox HA inaktiv',haActivate:'HA aktivieren',enableNativeHa:'Natives Proxmox HA fÃ¼r diese VM aktivieren',haMonitorDesc:'Ãœberwacht Nodes alle 10 Sekunden. Bei Ausfall werden VMs automatisch auf anderen Nodes neu gestartet.',nativeHaDesc:'Das native Proxmox HA lÃ¤uft direkt auf dem Cluster und bietet Fencing & Quorum.',vmsWithHa:'VMs/CTs mit Proxmox HA',noVmsWithHa:'Keine VMs mit Proxmox HA konfiguriert. Aktiviere HA fÃ¼r einzelne VMs in der Detail-Ansicht.',removeFromHa:'Aus HA entfernen',deleteCannotBeUndone:'Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden!',purgeDisks:'Purge - Alle Disks komplett lÃ¶schen',destroyUnreferencedDisks:'Nicht-referenzierte Disks lÃ¶schen',enterToConfirm:'Eingeben um zu bestÃ¤tigen',deletePermanently:'EndgÃ¼ltig lÃ¶schen',updateNode:'Node aktualisieren',updateCommand:'Es wird apt update && apt dist-upgrade ausgefÃ¼hrt.',rebootAfterUpdate:'Nach Update neustarten',recommendedForKernel:'Empfohlen fÃ¼r Kernel-Updates',startUpdate:'Update starten',started:'gestartet',stopped:'gestoppt',restarted:'neu gestartet',created:'erstellt',deleted:'gelÃ¶scht',cloned:'geklont',migrated:'migriert',vmStillRunning:'Die VM lÃ¤uft noch. Sie wird vor dem LÃ¶schen gestoppt.',ctStillRunning:'Der Container lÃ¤uft noch. Er wird vor dem LÃ¶schen gestoppt.',primary:'Primary',fallbacks:'Fallbacks',// Messages
connectionError:'Verbindungsfehler',// Task Bar
tasks:'Tasks',taskMigrate:'Migration',taskStart:'Starten',taskStop:'Stoppen',taskReboot:'Neustart',taskCreate:'Erstellen',taskDelete:'LÃ¶schen',taskClone:'Klonen',taskSnapshot:'Snapshot',taskDiskMove:'Disk verschieben',taskDiskResize:'Disk vergrÃ¶ÃŸern',taskFailed:'Task fehlgeschlagen',taskCancelled:'Task abgebrochen',taskCancelFailed:'Task konnte nicht abgebrochen werden',cancelTask:'Task abbrechen',allTasks:'Alle Tasks',runningTasks:'Laufende Tasks',failedTasks:'Fehlgeschlagene Tasks',todaysTasks:'Heutige Tasks',tasksShown:'Tasks angezeigt',taskOutput:'Task-Ausgabe',errorLoadingLog:'Fehler beim Laden des Logs',duration:'Dauer',description:'Beschreibung',clearCompleted:'Abgeschlossene lÃ¶schen',startTime:'Startzeit',endTime:'Endzeit',output:'Ausgabe',noOutput:'Keine Ausgabe',noTasks:'Keine Tasks vorhanden',completed:'abgeschlossen',success:'Erfolgreich',error:'Fehler',unsavedChanges:'Ungespeicherte Ã„nderungen',discardUnappliedChanges:'Alle nicht angewendeten Ã„nderungen verwerfen?',migrationStarted:'Migration gestartet',configSaved:'Konfiguration gespeichert',operationFailed:'Operation fehlgeschlagen',confirmAction:'Aktion bestÃ¤tigen',// Misc
lastCheck:'Letzter Check',clusterInfo:'Cluster Info',primaryHost:'Primary Host',connectedTo:'Verbunden mit',fallback:'Fallback',configured:'konfiguriert',noRestrictions:'Keine EinschrÃ¤nkungen',general:'Allgemein',advanced:'Erweitert',os:'Betriebssystem',template:'Template',help:'Hilfe',lastMigrations:'Letzte Migrationen',noMigrations:'Keine Migrationen',// Options labels
keyboardLayout:'Tastaturlayout',httpProxy:'HTTP Proxy',consoleViewer:'Konsole Viewer',emailFrom:'E-Mail Absender',macPrefix:'MAC PrÃ¤fix',migrationSettings:'Migrations-Einstellungen',replicationSettings:'Replikations-Einstellungen',haSettings:'HA Einstellungen',haSettingsSaved:'HA-Einstellungen gespeichert',haEnabled:'HA aktiviert',haDisabled:'HA deaktiviert',haActive:'HA Aktiv',haInactive:'HA Inaktiv',clusterType:'Cluster-Typ',quorum:'Quorum',quorumYes:'Ja',quorumNo:'Nein',healthy:'Gesund',degraded:'Degraded',critical:'Kritisch',splitBrainPrevention:'Split-Brain PrÃ¤vention',splitBrainInfo:'Bei 2-Node Clustern kann es zu "Split-Brain" kommen wenn beide Nodes denken der andere ist tot. Die Quorum-Hosts werden gepingt um zu entscheiden welcher Node handeln darf.',splitBrainTip:'Verwende IPs die beide Nodes erreichen kÃ¶nnen (Gateway, DNS-Server, oder externe IPs). FÃ¼r interne Netze ohne Internet: Nutze deinen Router/Gateway als Quorum-Host.',quorumSettings:'Quorum Einstellungen',enableQuorumCheck:'Quorum-Check aktivieren',quorumCheckDesc:'Verhindert Split-Brain durch externe ErreichbarkeitsprÃ¼fung',gatewayIp:'Gateway IP',gatewayIpHint:'Dein Router/Gateway fÃ¼r lokale Netze',requiredVotes:'BenÃ¶tigte Stimmen',additionalQuorumHosts:'ZusÃ¤tzliche Quorum-Hosts (kommagetrennt)',quorumHostsHint:'FÃ¼r isolierte Netze: Eigene DNS-Server, Router, oder andere stabile Hosts im Netzwerk',selfFencingRecovery:'Self-Fencing & Recovery',selfFencing:'Self-Fencing',selfFencingDesc:'Node ohne Quorum startet keine VMs',networkCheck:'Netzwerk-Check',networkCheckDesc:'PrÃ¼ft KonnektivitÃ¤t vor Recovery',recoveryDelay:'Recovery VerzÃ¶gerung (Sekunden)',recoveryDelayHint:'Wartezeit bevor VMs auf anderem Node gestartet werden',failureThreshold:'Fehler-Schwelle',failureThresholdHint:'Anzahl fehlgeschlagener Checks bevor Node als offline gilt',hardwareWatchdog:'Hardware Watchdog',watchdogWarning:'VORSICHT: Node rebootet automatisch bei Quorum-Verlust!',// Fencing Explanation - NS Jan 2026
fencingExplanation:'Wie Split-Brain verhindert wird',fencingStep1Title:'1. Quorum-Verlust Erkennung',fencingStep1Desc:'Der isolierte Node verliert Quorum (< 50% Stimmen) und /etc/pve wird READ-ONLY. Der pve-ha-lrm stoppt automatisch alle HA-VMs.',fencingStep2Title:'2. Self-Fencing (Selbst-Isolation)',fencingStep2Desc:'Der Node erkennt dass er isoliert ist und verweigert VM-Operationen. So kÃ¶nnen keine 2 Instanzen derselben VM gleichzeitig laufen.',fencingStep3Title:'3. Watchdog (Hardware-Timer)',fencingStep3Desc:'Falls aktiviert: Ein Hardware/Software-Timer wird regelmÃ¤ÃŸig zurÃ¼ckgesetzt. Bei Quorum-Verlust stoppt das ZurÃ¼cksetzen und der Node wird nach ~60s hart rebootet.',fencingStep4Title:'4. External Fencing (STONITH)',fencingStep4Desc:'Optionale Hardware: IPMI/iLO/iDRAC oder PDU schaltet den Node garantiert stromlos bevor VMs auf anderem Node gestartet werden.',fencingWarning:'WICHTIG: Ohne Fencing-Mechanismus kann Split-Brain zu Datenkorruption fÃ¼hren!',fencingRecommendation:'Empfehlung fÃ¼r 2-Node Cluster:',fencingRecList:'â€¢ Quorum-Hosts konfigurieren (Gateway, DNS-Server)\nâ€¢ Hardware Watchdog aktivieren wenn verfÃ¼gbar\nâ€¢ Recovery-Delay auf mindestens 30 Sekunden setzen',enableHA:'HA Aktivieren',disableHA:'HA Deaktivieren',changesAfterRestart:'Ã„nderungen nach Neustart aktiv',important2NodeCluster:'wichtig fÃ¼r 2-Node Cluster!',online:'Online',// 2-Node Cluster Mode - NS Jan 2026
twoNodeMode:'2-Node Cluster Modus',twoNodeWarning:'2-Node Cluster Limitierung',twoNodeExplanation:'In einem 2-Node Proxmox Cluster verliert der Ã¼berlebende Node das Quorum wenn ein Node ausfÃ¤llt und kann keine VMs starten. Dieser Modus erlaubt PegaProx automatisch das Quorum auf dem Ã¼berlebenden Node zu erzwingen.',enableTwoNodeMode:'2-Node Cluster Modus aktivieren',enableTwoNodeModeDesc:'Quorum automatisch erzwingen wenn ein Node ausfÃ¤llt',twoNodeReady:'Bereit fÃ¼r 2-Node HA',twoNodeCredentialsInfo:'PegaProx verwendet die Cluster-Zugangsdaten um sich per SSH auf den Ã¼berlebenden Node zu verbinden und "pvecm expected 1" auszufÃ¼hren.',twoNodeTip:'Tipp',twoNodeTipText:'FÃ¼r beste Ergebnisse installiere "sshpass" auf dem PegaProx Server: apt install sshpass',// Split-Brain Risk - 2-Node - NS Jan 2026
splitBrainRisk:'Split-Brain Risiko ohne Fencing!',splitBrainRiskDesc:'Wenn beide Nodes leben aber das Netzwerk dazwischen ausfÃ¤llt, kann das Erzwingen von Quorum dazu fÃ¼hren dass BEIDE Nodes dieselbe VM starten = Datenkorruption!',safeSolutions:'Sichere LÃ¶sungen fÃ¼r 2-Node Cluster:',qdeviceDesc:'FÃ¼ge eine 3. Stimme hinzu (Raspberry Pi reicht!)',ipmiDesc:'Anderen Node ausschalten vor Recovery',pduDesc:'Smarte Steckdosenleiste fÃ¼r Remote-Stromabschaltung',quorumHostsDesc2:'Externe IPs um zu bestimmen welcher Node isoliert ist',safetyChecklist:'Sicherheits-Checkliste',quorumHostsConfigured:'Quorum-Hosts konfiguriert',recoveryDelayCheck:'Recovery-VerzÃ¶gerung â‰¥ 30 Sekunden',selfFencingEnabled:'Self-Fencing aktiviert',// Storage-based Split-Brain Protection - NS Jan 2026
storageHeartbeat:'Storage-basierter Split-Brain Schutz',recommendedFor2Node:'Empfohlen fÃ¼r 2-Node Cluster!',storageHeartbeatDesc:'Nutzt Shared Storage (NFS/Ceph/iSCSI) zur Koordination zwischen Nodes. Wenn ein Node keine Heartbeats mehr schreibt, ist er bestÃ¤tigt tot. Ein "Poison Pill" Mechanismus teilt dem isolierten Node mit, dass er seine VMs stoppen muss bevor Recovery startet.',enableStorageHeartbeat:'Storage-basiertes Heartbeat aktivieren',enableStorageHeartbeatDesc:'Schreibt Heartbeats auf Shared Storage zur Node-GesundheitsprÃ¼fung',storageHeartbeatPath:'Shared Storage Pfad',storageHeartbeatPathHint:'Pfad zu Shared Storage der von allen Nodes erreichbar ist (z.B. Ceph, NFS, iSCSI)',heartbeatTimeout:'Heartbeat Timeout (s)',heartbeatTimeoutHint:'Node gilt als tot wenn kein Heartbeat in dieser Zeit',poisonPillEnabled:'Poison Pill Mechanismus aktivieren',poisonPillDesc:'Teilt isoliertem Node per Storage mit VMs zu stoppen vor Recovery',strictFencing:'Strenger Fencing Modus',strictFencingDesc:'Recovery ABBRECHEN wenn Node nicht als tot bestÃ¤tigt werden kann (sicherer aber mehr false positives)',howItWorks:'So funktioniert es',step1Heartbeat:'PegaProx schreibt alle 5 Sekunden Heartbeats auf Shared Storage',step2Check:'Bei Node-Ausfall wird Storage-Heartbeat geprÃ¼ft um Tod zu bestÃ¤tigen',step3Poison:'Eine "Poison Pill" Datei wird geschrieben die dem anderen Node sagt VMs zu stoppen',step4Recovery:'Erst nach BestÃ¤tigung/Timeout startet Recovery',nodeAgentRequired:'Node-Agent erforderlich!',nodeAgentRequiredDesc:'Damit dieses Feature funktioniert, musst du den PegaProx Node-Agent auf jedem Proxmox-Node installieren. Der Agent schreibt Heartbeats und reagiert auf Poison Pills.',// Automatic Split-Brain Protection - NS Jan 2026 - FULLY AUTOMATIC
splitBrainProtection:'Split-Brain Schutz',fullyAutomatic:'100% AUTOMATISCH',autoProtectionExplain:'PegaProx findet automatisch Shared Storage, installiert Node-Agents und schÃ¼tzt vor Split-Brain - keine Konfiguration nÃ¶tig!',sharedStoragesFound:'Shared Storages gefunden:',inUse:'AKTIV',fullProtectionActive:'Voller Dual-Network Schutz aktiv',nodeAgentsInstalled:'Node-Agents automatisch installiert',heartbeatsViaStorage:'Heartbeats Ã¼ber Storage-Netzwerk',sshOnlyMode:'SSH-Only Schutz Modus',noSharedStorageFound:'Kein Shared Storage (NFS/CephFS) gefunden. Schutz funktioniert Ã¼ber SSH-Verifizierung.',notSafeForDualNetwork:'Nicht sicher fÃ¼r Dual-Network Setups (getrennte Server/Storage Netzwerke)',// Block Storage Warning - NS Jan 2026
blockStorageOnly:'Nur Block-Storage gefunden',blockStorageExplain:'Block-Storage (LVM, iSCSI, RBD) kann keine Heartbeat-Dateien speichern. FÃ¼r vollen Dual-Network Schutz ein kleines NFS-Share hinzufÃ¼gen.',sshOnlyActive:'SSH-Only Schutz aktiv',sshOnlyRisk:'Funktioniert fÃ¼r Single-Network. FÃ¼r Dual-Network (getrennte Server/iSCSI) ein kleines NFS-Share hinzufÃ¼gen (100MB reichen).',// Multiple Storages - NS Jan 2026
clickToSelect:'Klicken zum AuswÃ¤hlen',selected:'AusgewÃ¤hlt',currentlyActive:'Aktuell aktiv',blockStoragesIgnored:'Block-Storages (nicht verwendbar)',// Self-Fence Protection - NS Jan 2026
selfFenceProtection:'Self-Fence Schutz',advancedSettings:'Erweiterte Einstellungen',selfFenceExplain:'Jeder Node prÃ¼ft ob er den Manager ODER einen anderen Node erreichen kann. Wenn niemand erreichbar â†‘ Node ist isoliert â†‘ stoppt seine eigenen VMs.',howItWorks:'So funktioniert es',nodeCanReachSomeone:'Node kann jemanden erreichen',everythingOk:'Alles OK, nichts tun',nodeCanReachNoone:'Node kann NIEMANDEN erreichen',nodeStopsOwnVms:'Isoliert! Stoppt eigene VMs',selfFenceActive:'Self-Fence Schutz aktiv',agentInstalledOnNodes:'Agent installiert auf',allNodes:'allen Nodes',selfFenceNotInstalled:'Self-Fence Agent nicht installiert',selfFenceInstallHint:'Klicke den Button um den Agent auf allen Nodes zu installieren. Der Agent prÃ¼ft alle 5 Sekunden die Erreichbarkeit.',installSelfFenceAgent:'Self-Fence Agent installieren',selfFenceInstalling:'Agent wird installiert...',noSharedStorageNeeded:'Kein Shared Storage nÃ¶tig',worksWithLvmIscsi:'Funktioniert mit LVM, iSCSI, allem',nodeDecidesItself:'Node entscheidet selbst = schnelle Reaktion',uninstall:'Deinstallieren',confirmUninstallAgent:'Self-Fence Agent wirklich von allen Nodes deinstallieren?',selfFenceUninstalling:'Agent wird deinstalliert...',enable2NodeMode:'2-Node Cluster Modus aktivieren',twoNodeModeDesc:'Erzwingt automatisch Quorum wenn ein Node ausfÃ¤llt',// Legacy translations (kept for compatibility)
autoSplitBrainProtection:'Automatischer Split-Brain Schutz',noSetupRequired:'KEINE EINRICHTUNG NÃ–TIG',autoProtectionDesc:'PegaProx verhindert Split-Brain automatisch mit deinen vorhandenen SSH-Zugangsdaten.',sshSucceeds:'SSH erfolgreich:',networkSplitDetected:'Netzwerk-Split! VMs werden zuerst auf dem isolierten Node gestoppt',sshFails:'SSH schlÃ¤gt fehl:',nodeConfirmedDead:'Node bestÃ¤tigt tot, sicheres Failover',advancedOptions:'Erweiterte Optionen',dualNetworkWarning:'Dual-Network Setup? (Server + iSCSI)',dualNetworkProblem:'Wenn Server-Netzwerk ausfÃ¤llt aber iSCSI noch geht, schlÃ¤gt SSH fehl aber Node schreibt noch auf Storage = DATENKORRUPTION!',enableDualNetworkProtection:'Storage-basierten Schutz aktivieren',dualNetworkProtectionDesc:'Voraussetzung: PegaProx Server kann Shared Storage mounten (NFS/CephFS)',sharedStoragePath:'Shared Storage Pfad',agentAutoInstall:'Node-Agent wird automatisch via SSH installiert',// Device Passthrough
devicePassthrough:'Device Passthrough',pciDevices:'PCI Devices',usbDevices:'USB Devices',serialPorts:'Serial Ports',addPci:'PCI hinzufÃ¼gen',addUsb:'USB hinzufÃ¼gen',addSerial:'Serial hinzufÃ¼gen',noPciDevices:'Keine PCI Devices',noUsbDevices:'Keine USB Devices',noSerialPorts:'Keine Serial Ports',availableDevices:'VerfÃ¼gbare Devices',selectDevice:'Device auswÃ¤hlen',pcie:'PCIe (empfohlen)',romBar:'ROM-Bar',usb3:'USB 3.0',serialType:'Typ',socketConsole:'Socket (Unix Socket Console)',deviceAdded:'Device hinzugefÃ¼gt',deviceRemoved:'Device entfernt',iommuGroup:'IOMMU Gruppe',vendor:'Hersteller',adding:'Wird hinzugefÃ¼gt...',bandwidthLimits:'Bandbreitenlimits',maxWorkers:'Max. Workers',nextVmid:'NÃ¤chste VMID',userTagAccess:'Benutzer-Tag Zugriff',registeredTags:'Registrierte Tags',// Subscription
subscriptionStatus:'Subscription Status',licensed:'Lizenziert',notLicensed:'Nicht lizenziert',product:'Produkt',licenseKey:'LizenzschlÃ¼ssel',validUntil:'GÃ¼ltig bis',supportLevel:'Support Level',noActiveSubscription:'Keine aktive Subscription',noSubscriptionDesc:'Dieser Node hat keine gÃ¼ltige Proxmox VE Subscription. Ohne Subscription erhalten Sie keine Enterprise-Updates und keinen Support.',enterLicenseKey:'LizenzschlÃ¼ssel eingeben',subscriptionKey:'Subscription Key',pleaseEnterLicenseKey:'Bitte LizenzschlÃ¼ssel eingeben',licenseActivated:'Lizenz erfolgreich aktiviert!',activationFailed:'Aktivierung fehlgeschlagen',activateLicense:'Lizenz aktivieren',refreshStatus:'Status aktualisieren',subscriptionBenefits:'Eine Proxmox VE Subscription bietet',subscriptionBenefit1:'Zugang zum Enterprise Repository mit stabilen Updates',subscriptionBenefit2:'Technischer Support durch Proxmox',subscriptionBenefit3:'Keine Subscription-Warnung beim Login',// Maintenance
maintenanceModeTitle:'Wartungsmodus aktivieren',maintenanceWarning:'Achtung: Alle laufenden VMs und Container auf diesem Node werden automatisch auf andere Nodes migriert.',maintenanceDesc:'Der Node wird aus dem Load Balancing ausgeschlossen bis der Wartungsmodus beendet wird.',startMaintenance:'Wartung starten',removeNodeFromCluster:'Node aus Cluster entfernen',moveNodeToCluster:'Node in anderen Cluster verschieben',targetCluster:'Ziel-Cluster',removeNodeWarning:'Der Node wird permanent aus dem Cluster entfernt. Alle VMs mÃ¼ssen vorher migriert werden.',removeNodeConfirm:'Node entfernen',removeNodeTypeName:'Node-Name eingeben zum BestÃ¤tigen',ready:'Bereit',completedWithErrors:'Fertig (mit Fehlern)',evacuating:'Evakuiert...',failed:'Fehlgeschlagen',starting:'Startet...',progress:'Fortschritt',migrating:'Migriere',vmsCouldNotMigrate:'VM(s) konnten nicht migriert werden',migrationIncomplete:'Migration unvollstÃ¤ndig',someVmsOnLocalStorage:'Einige VMs konnten nicht migriert werden, wahrscheinlich wegen lokalem Storage. Sie kÃ¶nnen:',proceedWithCaution:'Trotzdem fortfahren (VMs werden wÃ¤hrend des Neustarts gestoppt)',exitAndMigrateManually:'Wartung beenden und manuell migrieren',forceMaintenanceWarning:'âš ï¸ WARNUNG: Fortfahren wird die verbleibenden VMs auf diesem Node wÃ¤hrend des Neustarts stoppen. Fortfahren?',proceedAnyway:'Trotzdem fortfahren',failedToMigrate:'Migration fehlgeschlagen',vmsWillBeStopped:'VM(s) werden wÃ¤hrend des Neustarts gestoppt',updating:'Aktualisiert',nodeConfiguration:'Node Konfiguration',rebootNode:'Node neu starten',shutdownNode:'Node herunterfahren',rebootNodeWarning:'Der Node wird neu gestartet. Da er sich im Wartungsmodus befindet, sind keine VMs betroffen.',shutdownNodeWarning:'Der Node wird heruntergefahren. Sie mÃ¼ssen ihn manuell wieder einschalten!',rebootNow:'Jetzt neu starten',shutdownNow:'Jetzt herunterfahren',updateAndReboot:'Update & Reboot',sudoNotAvailable:'sudo ist auf diesem Node nicht verfÃ¼gbar',nodeActionFailed:'Node-Aktion fehlgeschlagen',startingUpdateFor:'Starte Update fÃ¼r',updateStartedFor:'Update gestartet fÃ¼r',errorStartingUpdate:'Fehler beim Starten des Updates',rebootInitiated:'Neustart eingeleitet',shutdownInitiated:'Herunterfahren eingeleitet',updateRunning:'Update lÃ¤uft',updateFailed:'Update fehlgeschlagen',failedNodes:'Fehlgeschlagene Nodes',maintenanceModeWarning:'Einige Nodes befinden sich mÃ¶glicherweise noch im Wartungsmodus. PrÃ¼fe den Nodes-Tab und beende den Wartungsmodus manuell falls nÃ¶tig.',viewLogs:'Logs anzeigen',updateCompleted:'Update abgeschlossen!',packagesUpdated:'Pakete aktualisiert.',waitingForNode:'Warte auf Node...',done:'Fertig',cancelAndExitMaintenance:'Abbrechen & Wartungsmodus beenden',sshSettings:'SSH-Einstellungen',sshSettingsDesc:'Wird fÃ¼r Node-Updates, Reboot und Shutdown benÃ¶tigt. Wenn leer, wird der Proxmox-Benutzer/Passwort verwendet.',sshKeyOptional:'SSH Key (Optional)',sshKeyExplanation:'SSH-Features (SMBIOS Auto-Config, Custom Scripts, 2-Node HA) verwenden automatisch deine Login-Daten. FÃ¼ge hier nur einen Key hinzu, wenn Password-Auth auf deinen Nodes deaktiviert ist.',// Common notifications
connectionError:'Verbindungsfehler',saveFailed:'Speichern fehlgeschlagen',deleteError:'Fehler beim LÃ¶schen',activationError:'Fehler beim Aktivieren',deactivationError:'Fehler beim Beenden',bulkMigrationNote:'Migrationen werden nacheinander durchgefÃ¼hrt. Dies kann einige Zeit dauern.',deleteFailed:'LÃ¶schen fehlgeschlagen',uploadFailed:'Upload fehlgeschlagen',uploadFailedNetwork:'Upload fehlgeschlagen - Netzwerkfehler',createFailed:'Erstellen fehlgeschlagen',configSaved:'Konfiguration gespeichert',failedToSaveSettings:'Einstellungen konnten nicht gespeichert werden',failedToUnlockIp:'IP konnte nicht entsperrt werden',failedToUnlockAllIps:'IPs konnten nicht entsperrt werden',snapshotFailed:'Snapshot fehlgeschlagen',rollbackFailed:'Rollback fehlgeschlagen',replicationCreated:'Replikation erstellt',replicationDeleted:'Replikation gelÃ¶scht',replicationStarted:'Replikation gestartet',startFailed:'Start fehlgeschlagen',unlockVm:'VM entsperren',vmLocked:'VM ist gesperrt',vmUnlocked:'VM entsperrt',// Security Settings
securitySettings:'Sicherheitseinstellungen',securityDashboard:'Security Dashboard',issuesFound:'Probleme gefunden',allSecure:'Alle Systeme sicher',securityUpdates:'Sicherheitsupdates',bannedIps:'Gebannte IPs',securityIssues:'Sicherheitsprobleme',recommendations:'Empfehlungen',enableClusterFirewall:'Cluster-Firewall aktivieren',installSecurityUpdates:'Ausstehende Sicherheitsupdates installieren',enable2fa:'Zwei-Faktor-Authentifizierung aktivieren',disableRootLogin:'SSH Root-Login deaktivieren',clusterFirewall:'Cluster-Firewall',nodeFirewalls:'Node-Firewalls',rules:'Regeln',noSecurityUpdates:'Keine Sicherheitsupdates ausstehend',systemUpToDate:'Alle Systeme sind aktuell',sshConfiguration:'SSH-Konfiguration pro Node',activeJails:'Aktive Jails',totalBanned:'Gesamt gebannt',installed:'Installiert',notInstalled:'Nicht installiert',optional:'Optional',refreshSecurityAudit:'Sicherheitsaudit aktualisieren',analyzingSecurity:'Analysiere Sicherheit...',bruteForceProtection:'Brute-Force Schutz',bruteForceProtectionDesc:'Konfigurieren Sie die Anzahl erlaubter Login-Versuche und Sperrzeiten um unbefugte Zugriffsversuche zu blockieren',loginProtection:'Anmeldeschutz',passwordPolicy:'Passwort-Richtlinie',minPasswordLength:'Minimale LÃ¤nge',requireUppercase:'GroÃŸbuchstaben',requireLowercase:'Kleinbuchstaben',requireNumbers:'Zahlen',requireSpecial:'Sonderzeichen',sessionTimeout:'Session-Timeout',hours:'Stunden',days:'Tage',securityRecommendations:'Sicherheitsempfehlungen',securityRecommendationsDesc:'VorschlÃ¤ge zur Verbesserung der PegaProx-Sicherheit',httpsEnabled:'Verbindung ist verschlÃ¼sselt',httpsDisabled:'HTTPS fÃ¼r sichere Verbindungen aktivieren',sessionTimeout:'Session-Timeout',currentlySetTo:'Aktuell eingestellt auf',adminAccounts:'Admin-Konten',adminAccountsActive:'Admin-Konto(en) aktiv',defaultCredentials:'Standard-Anmeldedaten',noDefaultPassword:'Keine StandardpasswÃ¶rter erkannt',defaultPasswordWarning:'Standard-Admin-Passwort wird noch verwendet!',lockAfter:'Sperre nach',failedAttempts:'fehlgeschlagenen Versuchen',auditLogging:'Audit-Protokollierung',auditLoggingEnabled:'Alle Aktionen werden protokolliert',secure:'Sicher',recommended:'Empfohlen',good:'Gut',considerLowering:'Verringern empfohlen',reviewRecommended:'ÃœberprÃ¼fung empfohlen',actionRequired:'Aktion erforderlich',maxLoginAttempts:'Max. Login-Versuche',maxLoginAttemptsDesc:'Anzahl fehlgeschlagener Versuche bevor gesperrt wird',lockoutTime:'Sperrzeit',attemptWindow:'Zeitfenster',lockedIps:'Gesperrte IPs',noLockedIps:'Keine IPs gesperrt',unlockAll:'Alle entsperren',unlockAllConfirm:'Wirklich alle IPs entsperren?',allIpsUnlocked:'Alle IPs entsperrt',unlock:'Entsperren',unlocked:'entsperrt',locked:'gesperrt',attempts:'Versuche',remaining:'verbleibend',// About page translations
about:'Ãœber',developmentTeam:'Entwicklungsteam',creditsAcknowledgments:'Credits & Danksagungen',links:'Links',// update Manager
updateManager:'Update Manager',updateManagerDesc:'PrÃ¼fen und installieren Sie Updates auf allen Cluster-Nodes',checkForUpdates:'Nach Updates suchen',checkingUpdates:'PrÃ¼fe Updates...',updatesAvailable:'Updates verfÃ¼gbar',noUpdatesAvailable:'Keine Updates verfÃ¼gbar',packagesAvailable:'Pakete verfÃ¼gbar',securityUpdates:'Sicherheitsupdates',lastChecked:'Zuletzt geprÃ¼ft',neverChecked:'Noch nie geprÃ¼ft',startRollingUpdate:'Rolling Update starten',updateThisNode:'Diesen Node updaten',rebootRequired:'Neustart erforderlich fÃ¼r Kernel',package:'Paket',currentVersion:'Aktuell',newVersion:'Neu',noUpdatesForNode:'Dieser Node ist aktuell',updateNode:'Node updaten',updateNodeDesc:'Dies fÃ¼hrt apt update && apt dist-upgrade auf dem Node aus.',kernelUpdateDetected:'Kernel-Update erkannt',rebootRecommended:'Ein Neustart wird empfohlen um Kernel-Ã„nderungen anzuwenden.',rebootAfterUpdate:'Nach Update neustarten',startUpdate:'Update starten',updateStarted:'Update gestartet',updates:'Updates',nodeNotInMaintenance:'Node ist nicht im Wartungsmodus.',forceUpdateWarning:'Laufende VMs auf diesem Node kÃ¶nnten beeintrÃ¤chtigt werden wenn ein Neustart durchgefÃ¼hrt wird.',continueAnyway:'Trotzdem fortfahren?',rollingUpdateDesc:'Aktualisiert alle Nodes nacheinander. Jeder Node wird in den Wartungsmodus versetzt, VMs werden migriert, Updates installiert und optional neu gestartet.',// PegaProx Auto-Update - NS Jan 2026
confirmUpdate:'Update wird heruntergeladen und installiert. Ein Backup wird erstellt. Der Server startet automatisch neu. Fortfahren?',downloadingUpdate:'Update wird heruntergeladen...',installingUpdate:'Update wird installiert...',serverRestarting:'Server startet neu...',reconnecting:'Verbindung wird wiederhergestellt...',updateSuccessRestarting:'Update installiert! Server startet neu...',updateComplete:'Update abgeschlossen! Bitte Seite aktualisieren.',alreadyUpToDate:'Bereits auf dem neuesten Stand!',installUpdate:'Update installieren',updateAvailable:'Update verfÃ¼gbar!',newVersionAvailable:'Neue Version verfÃ¼gbar!',updateTo:'Update auf',currentVersion:'Aktuelle Version',viewUpdate:'Update ansehen',later:'SpÃ¤ter',whatsNew:'Was ist neu',breakingChanges:'Wichtige Ã„nderungen',doNotCloseWindow:'Bitte dieses Fenster nicht schlieÃŸen...',rollback:'ZurÃ¼cksetzen',rollbackDesc:'Eine frÃ¼here Version aus einem Backup wiederherstellen',viewBackups:'Backups anzeigen',selectBackup:'Backup zum Wiederherstellen auswÃ¤hlen',noBackupsFound:'Keine Backups gefunden',confirmRollback:'PegaProx wird aus dem Backup wiederhergestellt. Der Server wird neu gestartet. Fortfahren?',restoringBackup:'Backup wird wiederhergestellt...',rollbackSuccess:'Wiederherstellung erfolgreich! Server startet neu...',rollbackWarning:'âš ï¸ Beim ZurÃ¼cksetzen wird der Server neu gestartet. Stellen Sie sicher, dass alle Arbeiten gespeichert sind.',// Security / Military Grade Encryption - NS Jan 2026
securityStatus:'Sicherheitsstatus',dataEncryption:'DatenverschlÃ¼sselung',passwordHashing:'Passwort-Hashing',compliance:'Compliance',complianceStatus:'Compliance-Status',auditLogIntegrity:'Audit-Log IntegritÃ¤t',encryptionKey:'VerschlÃ¼sselungsschlÃ¼ssel',corsConfiguration:'CORS-Konfiguration',verifyIntegrity:'IntegritÃ¤t prÃ¼fen',rotateKey:'SchlÃ¼ssel rotieren',rotating:'Rotiere...',recommendations:'Empfehlungen',totalEntries:'GesamteintrÃ¤ge',verified:'Verifiziert',unsigned:'Unsigniert (alt)',tampered:'MÃ¶glicherweise manipuliert',algorithm:'Algorithmus',keySize:'SchlÃ¼sselgrÃ¶ÃŸe',lastRotation:'Letzte Rotation',backups:'Backups',allowedOrigins:'Erlaubte Origins',// IP Whitelisting
ipWhitelisting:'IP-Whitelist',enableIPWhitelist:'IP-Whitelist aktivieren',ipWhitelistDesc:'Nur Zugriff von bestimmten IP-Adressen erlauben',yourIP:'Deine aktuelle IP',whitelist:'Whitelist',blacklist:'Blacklist',allowedIPs:'Erlaubte IPs',blockedIPs:'Immer blockiert',testIP:'IP-Zugriff testen',supportedFormats:'UnterstÃ¼tzte Formate',// Config Backup/Restore
configBackupRestore:'Konfigurations-Backup & Wiederherstellung',exportConfig:'Konfiguration exportieren',importConfig:'Konfiguration importieren',includeUsers:'Benutzerkonten einschlieÃŸen',includeSecrets:'PasswÃ¶rter & Geheimnisse einschlieÃŸen',includeAuditLog:'Audit-Log einschlieÃŸen',canBeLarge:'Kann groÃŸ sein',sensitive:'Sensibel',downloadBackup:'Backup herunterladen',exporting:'Exportiere...',merge:'ZusammenfÃ¼hren',overwrite:'Ãœberschreiben',keepExisting:'Bestehende behalten',replaceAll:'Alles ersetzen',restoreUsers:'Benutzerkonten wiederherstellen',notAdmin:'AuÃŸer Admin',dryRun:'Testlauf',validateOnly:'Nur validieren, nicht anwenden',selectBackupFile:'Backup-Datei auswÃ¤hlen',importing:'Importiere...',dryRunComplete:'Testlauf abgeschlossen - Ergebnisse unten prÃ¼fen',dryRunResults:'Testlauf-Ergebnisse',restoreComplete:'Konfiguration wiederhergestellt',restoreResults:'Wiederherstellungs-Ergebnisse',backupVersion:'Backup-Version',backupDate:'Backup-Datum',backupDownloaded:'Backup heruntergeladen',backupBy:'Erstellt von',restored:'Wiederhergestellt',skipped:'Ãœbersprungen',// Secure Backup
secureBackup:'Sicheres Backup',secureBackupDesc:'Backups werden mit AES-256-GCM verschlÃ¼sselt. Sie mÃ¼ssen Ihr Passwort und ein Backup-Passwort eingeben.',securityVerification:'SicherheitsÃ¼berprÃ¼fung',exportSecurityDesc:'Um ein verschlÃ¼sseltes Backup zu erstellen, bestÃ¤tigen Sie bitte Ihre IdentitÃ¤t und legen Sie ein Backup-Passwort fest.',importSecurityDesc:'Um ein Backup wiederherzustellen, bestÃ¤tigen Sie bitte Ihre IdentitÃ¤t und geben Sie das Backup-Passwort ein.',yourPassword:'Ihr Passwort',enterYourPassword:'Geben Sie Ihr Kontopasswort ein',backupPassword:'Backup-Passwort',backupPasswordPlaceholder:'Min. 8 Zeichen - merken Sie sich dieses!',confirmBackupPassword:'Backup-Passwort bestÃ¤tigen',repeatBackupPassword:'Backup-Passwort wiederholen',backupPasswordMin8:'Backup-Passwort muss mindestens 8 Zeichen haben',passwordsNoMatch:'PasswÃ¶rter stimmen nicht Ã¼berein',backupPasswordRequired:'Backup-Passwort erforderlich',rememberBackupPassword:'Merken Sie sich das Backup-Passwort! Ohne es kÃ¶nnen Sie das Backup nicht wiederherstellen.',createBackup:'Backup erstellen',restoreBackup:'Backup wiederherstellen',restoreFromBackup:'Aus Backup wiederherstellen',validateBackup:'Backup validieren',backupFile:'Backup-Datei',backupPasswordUsedWhenCreating:'Passwort das beim Erstellen verwendet wurde',autoMigration:'Auto-Migration',militaryGradeEncryption:'Military Grade VerschlÃ¼sselung',rollingUpdateInProgress:'Rolling Update lÃ¤uft',currentlyUpdating:'Aktualisiere gerade',waitingForReboot:'Warte auf Neustart',nodesCompleted:'Nodes abgeschlossen',nodesRemaining:'Nodes verbleibend',includeReboot:'Nach Update neu starten',includeRebootHint:'Empfohlen bei Kernel-Updates',skipNode:'Node Ã¼berspringen',retryNode:'Node erneut versuchen',cancelRollingUpdate:'Rolling Update abbrechen',confirmRollingUpdate:'Rolling Update bestÃ¤tigen',rollingUpdateWarning:'Alle Nodes werden nacheinander aktualisiert. VMs werden automatisch migriert.',skipUpToDate:'Aktuelle Nodes Ã¼berspringen',skipUpToDateHint:'Nodes ohne Updates werden Ã¼bersprungen',advancedOptions:'Erweiterte Optionen',evacuationTimeout:'Evakuierungs-Timeout',evacuationTimeoutHint:'Wartezeit fÃ¼r VM-Migration vor Timeout',skipEvacuation:'VM-Evakuierung Ã¼berspringen',skipEvacuationHint:'NICHT EMPFOHLEN - VMs bleiben auf dem Node wÃ¤hrend des Updates',skipEvacuationWarning:'âš ï¸ Warnung: VMs kÃ¶nnen bei Problemen wÃ¤hrend des Updates abstÃ¼rzen!',scheduleUpdates:'Automatische Updates',enableAutoUpdate:'Automatische Updates aktivieren',autoUpdateDesc:'Rolling Updates automatisch nach Zeitplan ausfÃ¼hren',updateDay:'Update-Tag',updateTime:'Update-Zeit',serverTimezone:'Server-Zeitzone',autoUpdateInfo:'Nodes werden nacheinander aktualisiert. VMs werden automatisch migriert. Aktuelle Nodes werden Ã¼bersprungen.',scheduleSaved:'Update-Zeitplan gespeichert',scheduledFor:'Geplant fÃ¼r',schedule:'Zeitplan',experimental:'EXPERIMENTELL',experimentalWarning:'Mit Vorsicht verwenden - dieses Feature ist derzeit experimentell. Zuerst in Nicht-Produktionsumgebungen testen.',runOnce:'Einmalig',recurring:'Wiederkehrend',runOnceInfo:'Das Update wird einmalig zur geplanten Zeit ausgefÃ¼hrt und deaktiviert sich dann selbst.',monday:'Montag',tuesday:'Dienstag',wednesday:'Mittwoch',thursday:'Donnerstag',friday:'Freitag',saturday:'Samstag',sunday:'Sonntag',daily:'TÃ¤glich',hour:'Stunde',hours:'Stunden',estimatedTime:'GeschÃ¤tzte Zeit',minutes:'Minuten',updateHistory:'Update-Verlauf',viewUpdateLog:'Update-Log anzeigen',checkingForUpdates:'PrÃ¼fe auf Updates',checkingNodes:'PrÃ¼fe Nodes auf verfÃ¼gbare Updates...',connectingToCluster:'Verbinde zum Cluster...',processingResults:'Verarbeite Ergebnisse...',// Repo management - MK
repoInfo:'APT-Repositories fÃ¼r diesen Node verwalten. Repositories aktivieren/deaktivieren um verfÃ¼gbare Pakete zu steuern.',repoProxmoxNotice:'Hinweis: Aufgrund von Proxmox\'s Umstellung auf neues Source-Format kann die Anzeige aktuell noch ungenau sein. Wir arbeiten daran.',requiresSubscription:'Erfordert Subscription',detected:'Erkannt',notConfigured:'Nicht konfiguriert',repoWarning:'Das Mischen von Enterprise und No-Subscription Repositories wird nicht empfohlen. Nach Ã„nderungen "apt update" ausfÃ¼hren.',noReposFound:'Keine Repositories gefunden',currentNode:'Aktueller Node',currentStep:'Aktueller Schritt',updateLogs:'Update-Logs',started:'Gestartet',sshUser:'SSH-Benutzer',sshPort:'SSH-Port',sshPrivateKey:'SSH Private Key',sshKeyHint:'Wird fÃ¼r Nodes benÃ¶tigt, die nur Public-Key-Authentifizierung erlauben',sshKeyRequired:'SSH-Key wird benÃ¶tigt. Bitte in den Cluster-Einstellungen konfigurieren.',balanceContainers:'Container balancieren',balanceLocalDisks:'VMs mit lokalen Disks balancieren',balanceLocalDisksDesc:'VMs mit lokalen Disks werden mit --with-local-disks migriert (kopiert Daten zum Ziel)',localDiskBalanceWarning:'Migration von VMs mit lokalen Disks kopiert alle Disk-Daten zum Ziel-Node. Dies kann lange dauern und erhÃ¶ht die Netzwerklast erheblich.',containerBalanceWarning:'Container kÃ¶nnen NICHT live migriert werden! Bei der Migration wird der Container gestoppt und neu gestartet, was zu Downtime fÃ¼hrt.',clusterSettings:'Cluster-Einstellungen',clusterSettingsDesc:'Konfiguriere Balancing-Einstellungen fÃ¼r jeden Cluster.',clusterSettingsSaved:'Cluster-Einstellungen gespeichert',noClustersConfigured:'Keine Cluster konfiguriert',collapse:'Einklappen',threshold:'Schwellwert',interval:'Intervall',saveSettings:'Einstellungen speichern',haEnabled:'HA aktiviert',// VM Detail buttons
console:'Konsole',configuration:'Konfiguration',// Config Modal
cpuCores:'CPU Kerne',cpuLimit:'CPU Limit',memory:'RAM',hardware:'Hardware',disks:'Festplatten',// Config Modal Tabs
mountIso:'ISO einbinden',noIsoEject:'Kein ISO (auswerfen)',device:'Device',target:'Ziel',cdrom:'CD-ROM',hardDisk:'Festplatte',existingCdrom:'Existierendes CD-ROM Laufwerk',hardDiskNotAvailable:'Festplatte - nicht verfÃ¼gbar!',freeSlot:'Freier Slot',mount:'Einbinden',eject:'Auswerfen',addDisk:'Festplatte hinzufÃ¼gen',freeSpace:'Frei',notEnoughSpace:'Nicht genug Speicherplatz!',usedSpace:'Belegt',resize:'VergrÃ¶ÃŸern',move:'Verschieben',remove:'Entfernen',editDiskType:'Bus-Typ Ã¤ndern',changeDiskBusType:'Festplatten-Bus-Typ Ã¤ndern',vmIsRunning:'VM lÃ¤uft noch',vmMustBeStopped:'VM muss gestoppt sein',vmMustBeStoppedForBusChange:'Die VM muss gestoppt sein, bevor der Festplatten-Bus-Typ geÃ¤ndert werden kann. Bitte fahren Sie die VM zuerst herunter.',currentDisk:'Aktuell',diskBusWarning:'Das Ã„ndern des Bus-Typs erfordert, dass die VM gestoppt ist. Das Gastbetriebssystem benÃ¶tigt mÃ¶glicherweise Treiber-Updates.',selectNewBusType:'Neuen Bus-Typ auswÃ¤hlen',scsiDesc:'Beste Performance mit VirtIO SCSI Controller',virtioDesc:'Legacy VirtIO, gute Performance',sataDesc:'Gute KompatibilitÃ¤t, mittlere Performance',ideDesc:'Maximale KompatibilitÃ¤t, niedrigste Performance',current:'Aktuell',changeBusType:'Bus-Typ Ã¤ndern',saving:'Speichern...',diskBusChanged:'Festplatten-Bus-Typ geÃ¤ndert',optionsWillBeRemoved:'Folgende Optionen werden nicht unterstÃ¼tzt und entfernt',noDisksConfigured:'Keine Festplatten konfiguriert',unusedDisks:'Ungenutzte Festplatten',unusedDisksDesc:'Diese Festplatten sind abgetrennt aber existieren noch. Sie kÃ¶nnen wieder angehÃ¤ngt oder gelÃ¶scht werden.',reattach:'AnhÃ¤ngen',reattachDisk:'Festplatte wieder anhÃ¤ngen',selectBusType:'Bus-Typ auswÃ¤hlen',diskId:'Festplatten-ID',nextAvailableId:'NÃ¤chste verfÃ¼gbare ID fÃ¼r gewÃ¤hlten Bus-Typ',diskOptions:'Festplatten-Optionen',ideLimitedOptions:'IDE hat eingeschrÃ¤nkte Optionen',preview:'Vorschau',attaching:'Wird angehÃ¤ngt...',volume:'Volume',diskReattached:'Festplatte wieder angehÃ¤ngt',deleteUnusedDiskConfirm:'Festplatte dauerhaft lÃ¶schen? Dies kann nicht rÃ¼ckgÃ¤ngig gemacht werden!',unusedDiskDeleted:'Ungenutzte Festplatte gelÃ¶scht',deletePermanently:'Dauerhaft lÃ¶schen',configLoadError:'Konfiguration konnte nicht geladen werden',networkInterfaces:'Netzwerk-Interfaces',addNetwork:'Netzwerk hinzufÃ¼gen',noNetworksConfigured:'Keine Netzwerke konfiguriert',networkDisconnected:'Netzwerk getrennt',disconnectNetwork:'Netzwerk trennen',disconnectNetworkHint:'Simuliert ein ausgestecktes Netzwerkkabel',connectNetwork:'Netzwerk verbinden',createSnapshot:'Snapshot erstellen',unknown:'Unbekannt',rollback:'Rollback',noSnapshots:'Keine Snapshots vorhanden',createReplication:'Replication erstellen',replicationNeedsTwoNodes:'Replication benÃ¶tigt mindestens 2 Nodes im Cluster',lastSync:'Letzte Sync',neverSynced:'Nie synchronisiert',syncNow:'Jetzt synchronisieren',startOnBoot:'Start bei Boot',protection:'Schutz (vor LÃ¶schen/Ã„ndern)',kvmVirtualization:'KVM Hardware-Virtualisierung',unprivilegedContainer:'Unprivilegierter Container',osType:'OS Typ',other:'Andere',hotplug:'Hotplug',hotplugHint:'GerÃ¤te die im laufenden Betrieb hinzugefÃ¼gt werden kÃ¶nnen',hotplugDisk:'Disk',hotplugNetwork:'Netzwerk',hotplugUsb:'USB',hotplugMemory:'Memory',hotplugCpu:'CPU',qemuGuestAgent:'QEMU Guest Agent',qemuGuestAgentHint:'ErmÃ¶glicht Shutdown, Freeze/Thaw fÃ¼r Snapshots',fstrim:'FSTRIM nach Clone/Migration',fstrimHint:'Automatisch TRIM nach Clone ausfÃ¼hren',// More modals
optional:'optional',snapshotDescription:'Beschreibung des Snapshots...',saveRamState:'RAM-Zustand speichern (Hibernate)',// NS: Feb 2026 - Efficient snapshot translations
spaceEfficientSnapshot:'Platzsparender Snapshot',spaceEfficientSnapshots:'Platzsparende Snapshots',snapshotMode:'Snapshot-Modus',normalMode:'Standard (Proxmox)',efficientMode:'Platzsparend (LVM COW)',spaceSavings:'Platzersparnis',normalSnapshotSize:'Normaler Snapshot',efficientSnapshotSize:'Platzsparend',guestAgentDetected:'Guest Agent erkannt (Dateisystem wird eingefroren)',noGuestAgent:'Kein Guest Agent (Snapshot ohne FS-Freeze)',managedByPegaprox:'Verwaltet von PegaProx (nicht in Proxmox sichtbar)',vmMustBeStopped:'VM muss gestoppt sein fÃ¼r Rollback',snapshotUsage:'Snapshot-Auslastung',snapshotOverflow:'Snapshot fast voll!',snapshotInvalidated:'Snapshot verloren â€“ Original-Daten sind sicher',efficientSnapshotCreated:'Platzsparender Snapshot erstellt',efficientSnapshotDeleted:'Platzsparender Snapshot gelÃ¶scht',efficientSnapshotRollback:'Rollback gestartet',cowSnapshot:'COW',fsFrozen:'FS eingefroren',recommended:'Empfohlen',snapshotSizeGb:'Snapshot-GrÃ¶ÃŸe (GB)',create:'Erstellen',createReplicationJob:'Replication Job erstellen',targetNode:'Ziel-Node',rateLimit:'Rate Limit (MB/s)',unlimited:'Unbegrenzt',comment:'Kommentar',commentPlaceholder:'z.B. DR-Replikation',every5min:'Alle 5 Minuten',every15min:'Alle 15 Minuten',every30min:'Alle 30 Minuten',hourly:'StÃ¼ndlich',every2hours:'Alle 2 Stunden',every4hours:'Alle 4 Stunden',every6hours:'Alle 6 Stunden',every12hours:'Alle 12 Stunden',daily:'TÃ¤glich (Mitternacht)',size:'GrÃ¶ÃŸe',enableFirewall:'Firewall aktivieren',editNetwork:'Netzwerk bearbeiten',enableNuma:'NUMA aktivieren',viommu:'vIOMMU (Virtualized IOMMU)',viommuInfo:'Erforderlich fÃ¼r verschachtelte Virtualisierung und bestimmte Passthrough-Szenarien',sockets:'Sockets',ballooningMinimum:'Ballooning Minimum',swap:'Swap',cpuType:'CPU Typ',scsiController:'SCSI Controller',machineType:'Maschinentyp',machineTypePlaceholder:'z.B. q35 oder i440fx (leer = Standard)',none:'Keine',compatible:'kompatibel',cache:'Cache',noCache:'Kein Cache',default:'Standard',unsafe:'unsicher',fastest:'schnellste',discard:'Discard',ioThread:'IO Thread',ssdEmulation:'SSD Emulation',cores:'Kerne',branding:'Branding',appName:'App-Name',customLogo:'Eigenes Logo',logoHint:'PNG, SVG oder GIF empfohlen. Max 500KB.',logoUploaded:'Logo hochgeladen',logoUploadFailed:'Logo-Upload fehlgeschlagen',logoDeleted:'Logo entfernt',remove:'Entfernen',upload:'Hochladen',thanksToSponsors:'Danke an unsere Sponsoren',sponsorSubtitle:'UnterstÃ¼tzung fÃ¼r Open-Source-Entwicklung',becomeSponsor:'Sponsor werden',madeWithLove:'Mit â¤ï¸ fÃ¼r die Proxmox-Community gemacht',settingsSaved:'Einstellungen gespeichert',saveError:'Fehler beim Speichern',dnsSaved:'DNS gespeichert',hostsSaved:'Hosts gespeichert',searchDomain:'Such-Domain',dnsServer:'DNS Server',time:'Zeit',timezone:'Zeitzone',localTime:'Lokale Zeit',sslCertificates:'SSL Zertifikate',uploadCustomCert:'Custom Zertifikat hochladen',issuer:'Aussteller',valid:'GÃ¼ltig',expired:'Abgelaufen',noCertificates:'Keine Zertifikate gefunden',certificate:'Zertifikat',privateKey:'Privater SchlÃ¼ssel',certChainHint:'Kann mehrere Zertifikate enthalten (Chain)',restartPveproxyAfterUpload:'pveproxy nach Upload neustarten',certAndKeyRequired:'Zertifikat und Key erforderlich',certUploaded:'Zertifikat hochgeladen!',uploadCertificate:'Zertifikat hochladen',deleteCertConfirm:'Custom Zertifikat lÃ¶schen und auf Self-Signed zurÃ¼cksetzen?',certDeleted:'Zertifikat gelÃ¶scht',deleteCustomCert:'Custom Cert lÃ¶schen',syslogLatest:'Syslog (neueste EintrÃ¤ge)',noLogEntries:'Keine Log-EintrÃ¤ge',datastore:'Datenspeicher',datastores:'Datenspeicher',esxiHosts:'ESXi Hosts',connectEsxi:'ESXi Host verbinden',esxiHostname:'ESXi Hostname/IP',esxiUsername:'Benutzername',esxiPassword:'Passwort',esxiConnected:'ESXi verbunden',esxiVms:'ESXi VMs',migrateToProxmox:'Zu Proxmox importieren',esxiMigrationHint:'VM muss auf ESXi ausgeschaltet sein!',esxiMigrating:'Import lÃ¤uft...',esxiMigrationStarted:'Import gestartet',esxiDisconnect:'Verbindung trennen',esxiNoVms:'Keine VMs auf diesem ESXi Host',esxiExperimental:'ESXi-Import nutzt native Proxmox-Funktion (PVE 8.1+)',noEsxiHosts:'Keine ESXi Hosts verbunden',fillAllFields:'Bitte alle Felder ausfÃ¼llen',confirmDisconnect:'ESXi Host wirklich trennen?',connect:'Verbinden',sharedStorage:'Gemeinsamer Speicher',selectStorage:'Speicher auswÃ¤hlen um Inhalte anzuzeigen',clickStorageToView:'Klicken Sie auf einen Speicher um dessen Inhalte anzuzeigen',storageEmpty:'Dieser Speicher ist leer',content:'Inhalt',format:'Format',browse:'Durchsuchen',storageDrsDesc:'Automatisches Balancing der Festplattennutzung Ã¼ber gemeinsamen Speicher',storageUsage:'Speichernutzung',currentImbalance:'Aktuelle Ungleichheit',threshold:'Schwellenwert',recommendations:'Empfehlungen',migrate:'Migrieren',storageBalanced:'Alle Speicher sind gut ausgelastet. Keine Aktion erforderlich.',experimentalFeature:'Experimentelles Feature',storageBalancingExperimental:'Storage Balancing ist noch experimentell. Wir freuen uns Ã¼ber Feedback!',uploadIso:'ISO hochladen',downloadFromUrl:'Von URL herunterladen',fromUrl:'Von URL',isoUrl:'ISO URL',isoUrlHint:'Direkter Link zur ISO-Datei (http/https)',autoDetect:'Automatisch aus URL ermitteln',startingDownload:'Download wird gestartet...',downloading:'Wird heruntergeladen...',downloadFailed:'Download fehlgeschlagen',selectFile:'Datei auswÃ¤hlen',confirmDelete:'LÃ¶schen bestÃ¤tigen',deleteConfirmText:'Sind Sie sicher, dass Sie lÃ¶schen mÃ¶chten',createStorageCluster:'Storage Cluster erstellen',noStorageClusters:'Keine Storage Cluster konfiguriert',createStorageClusterHint:'Erstellen Sie ein Cluster um Speicher Ã¼ber mehrere Volumes zu balancieren',selectCluster:'WÃ¤hlen Sie ein Storage Cluster',selectClusterToView:'WÃ¤hlen Sie ein Storage Cluster um den Status anzuzeigen',balancingThreshold:'Balancing Schwellenwert',thresholdDesc:'Balancing auslÃ¶sen wenn Ungleichheit diesen Wert Ã¼bersteigt',actionRecommended:'Aktion empfohlen',balanced:'Ausgeglichen',storagesInCluster:'Storages im Cluster',addStorage:'+ Storage hinzufÃ¼gen',clusterName:'Cluster Name',selectStorages:'Storages auswÃ¤hlen',minTwo:'mind. 2',noSharedStorages:'Keine gemeinsamen Storages verfÃ¼gbar',confirmDeleteCluster:'Dieses Storage Cluster lÃ¶schen?',minTwoStorages:'Mindestens 2 Storages erforderlich',needTwoStorages:'Mindestens 2 Storages erforderlich',migrationStarted:'Migration gestartet!',autoBalance:'Auto-Balance',autoBalanceActive:'Auto-Balance Aktiv',autoBalanceDesc:'Disks werden automatisch migriert wenn die Ungleichheit den Schwellenwert Ã¼berschreitet. VMs mit aktiven Snapshots/Backups werden Ã¼bersprungen.',dryRunShort:'Dry Run',connecting:'Verbinde...',needsRestart:'NEUSTART ERFORDERLICH',// NS: Alerts, Tasks, Tags, Affinity - Dec 2025
alerts:'Alarme',alertsDesc:'E-Mail-Benachrichtigungen bei Schwellwert-Ãœberschreitungen',createAlert:'Alarm erstellen',editAlert:'Alarm bearbeiten',alertName:'Alarm Name',alertMetric:'Metrik',alertThreshold:'Schwellenwert',alertOperator:'Bedingung',alertTarget:'Ziel',alertTargetType:'Ziel-Typ',noAlerts:'Keine Alarme konfiguriert',testEmail:'Test-Email senden',testEmailSuccess:'Test-Email gesendet!',testEmailFailed:'Test-Email konnte nicht gesendet werden',enterEmailAddress:'Bitte E-Mail-Adresse eingeben',saveSmtpSettings:'SMTP Einstellungen speichern',smtpSettingsSaved:'SMTP Einstellungen gespeichert!',enableSmtpHint:'Aktivieren Sie SMTP um E-Mail-Einstellungen zu konfigurieren',smtpHostRequired:'SMTP Server ist erforderlich',smtpFromEmailRequired:'Absender E-Mail ist erforderlich',emailRecipients:'E-Mail EmpfÃ¤nger',addRecipient:'EmpfÃ¤nger hinzufÃ¼gen',scheduledTasks:'Geplante Aufgaben',scheduledTasksDesc:'VM-Operationen automatisch planen',createTask:'Aufgabe erstellen',editTask:'Aufgabe bearbeiten',taskName:'Aufgaben-Name',taskAction:'Aktion',taskSchedule:'Zeitplan',scheduleType:'Zeitplan-Typ',scheduleTime:'Uhrzeit',scheduleDay:'Tag',noScheduledTasks:'Keine geplanten Aufgaben',runNow:'Jetzt ausfÃ¼hren',lastRun:'Letzte AusfÃ¼hrung',hourly:'StÃ¼ndlich',daily:'TÃ¤glich',weekly:'WÃ¶chentlich',monthly:'Monatlich',tagsLabels:'Tags & Labels',tagsDesc:'VMs kategorisieren und gruppieren',createTag:'Tag erstellen',tagName:'Tag Name',tagColor:'Farbe',noTags:'Keine Tags definiert',assignedVms:'Zugewiesene VMs',affinityRules:'AffinitÃ¤tsregeln',customScripts:'Eigene Skripte',scriptsDesc:'FÃ¼hre eigene .sh oder .py Skripte auf Cluster-Nodes aus',newScript:'Neues Skript',noScripts:'Keine Skripte konfiguriert',scriptsInfo:'Erstelle Skripte um Aufgaben auf deinen Cluster-Nodes zu automatisieren',runScript:'Skript ausfÃ¼hren',runScriptConfirm:'Skript ausfÃ¼hren?',scriptStarted:'SkriptausfÃ¼hrung gestartet',scriptDeleted:'Skript gelÃ¶scht',scriptCreated:'Skript erstellt',scriptUpdated:'Skript aktualisiert',scriptPermissions:'Skript-Berechtigungen',scriptPermissionsDesc:'Skripte benÃ¶tigen SSH-Zugriff auf Nodes. Konfiguriere den SSH-Key in den Cluster-Einstellungen.',scriptContent:'Skript-Inhalt',targetNodes:'Ziel-Nodes',scriptWarning:'Skripte werden mit SSH-Benutzerrechten ausgefÃ¼hrt. Stelle sicher dass Skripte sicher sind.',passwordRequiredForScripts:'Passwort-BestÃ¤tigung aus SicherheitsgrÃ¼nden erforderlich',viewOutput:'Ausgabe anzeigen',noOutput:'Keine Ausgabe verfÃ¼gbar',output:'Ausgabe',affinityDesc:'Bestimmen Sie welche VMs/CTs zusammen oder getrennt laufen sollen',createAffinityRule:'Regel erstellen',editAffinityRule:'Regel bearbeiten',ruleName:'Regel-Name',ruleType:'Regel-Typ',together:'Zusammen (gleicher Host)',separate:'Getrennt (verschiedene Hosts)',selectVms:'VMs auswÃ¤hlen',noAffinityRules:'Keine AffinitÃ¤tsregeln',enforceRule:'Regel erzwingen',enforceRuleHint:'Migration blockieren wenn Regel verletzt wÃ¼rde',// Console Settings - NS Jan 2026
consoleSettings:'Konsolen-Ports',vncPort:'VNC Port',shellPort:'Shell Port',consolePortHint:'VNC fÃ¼r VM-Konsolen, Shell fÃ¼r Node-Terminals. Server-Neustart erforderlich nach Ã„nderung!',nodeShellHint:'FÃ¼r Node-Shell oder detaillierte Performance nutze den Proxmox UI Button oben oder verbinde dich direkt zum Node.',selfSignedCertWarning:'Selbst-signierte Zertifikate',selfSignedCertHint:'VNC und Shell laufen auf separaten Ports. Bei selbst-signierten Zertifikaten mÃ¼ssen diese Ports im Browser einmalig akzeptiert werden.',openVncPort:'VNC Port Ã¶ffnen',openShellPort:'Shell Port Ã¶ffnen',certInstructions:'Bei selbst-signierten Zertifikaten:',certStep1:'1. Ã–ffne diesen Link in einem neuen Tab:',certStep2:'2. Akzeptiere das Zertifikat im Browser',certStep3:'3. Komm zurÃ¼ck und versuche es erneut',acceptCert:'Zertifikat akzeptieren',openInProxmox:'In Proxmox Ã¶ffnen',connectionError:'Verbindungsfehler',wsConnectionFailed:'WebSocket Verbindung fehlgeschlagen',checkServerLogs:'PrÃ¼fe die Server-Logs fÃ¼r Details',connectingWs:'Verbinde WebSocket',wsConnected:'WebSocket verbunden, warte auf Server...',ipFetchFailed:'IP-Ermittlung fehlgeschlagen',smtpSettings:'SMTP Einstellungen',smtpHost:'SMTP Server',smtpPort:'Port',smtpUser:'Benutzername',smtpPassword:'Passwort',smtpFromEmail:'Absender E-Mail',smtpFromName:'Absender Name',smtpTls:'TLS verwenden',smtpSsl:'SSL verwenden',alertCooldown:'Alarm-Cooldown (Sekunden)',migrationHistory:'Migrations-Verlauf',noMigrationHistory:'Keine Migrationen aufgezeichnet',// LW: Password expiry settings
passwordExpiry:'Passwort-Ablauf',passwordExpiryDesc:'Benutzer mÃ¼ssen ihr Passwort nach einer bestimmten Anzahl von Tagen Ã¤ndern.',passwordExpiryHint:'Benutzer erhalten E-Mail-Erinnerungen 14, 7, 3 und 1 Tag(e) vor Ablauf. Ein Warnbanner wird in der UI angezeigt. SMTP muss fÃ¼r E-Mails konfiguriert sein.',sendExpiryEmails:'E-Mail-Benachrichtigungen senden wenn Passwort bald ablÃ¤uft',expiryDays:'Passwort lÃ¤uft ab nach',warningDays:'Benutzer warnen vor',// LW: Password expiry banner
passwordExpired:'Ihr Passwort ist abgelaufen!',passwordExpiresIn:'Ihr Passwort lÃ¤uft in {days} Tagen ab',pleaseChangeNow:'Bitte Ã¤ndern Sie es jetzt.',pleaseChangeSoon:'Bitte Ã¤ndern Sie es rechtzeitig.',changePassword:'Passwort Ã¤ndern',dismissForNow:'SpÃ¤ter erinnern',// LW: Reset all passwords - Dec 2025
forcePasswordReset:'Passwort-Reset erzwingen',forcePasswordResetDesc:'Alle BenutzerpasswÃ¶rter sofort ablaufen lassen. Nach SicherheitsvorfÃ¤llen verwenden.',resetAllPasswords:'Alle zurÃ¼cksetzen',confirmPasswordReset:'Passwort-Reset bestÃ¤tigen',resetAllWarning:'Dies zwingt ALLE Benutzer, ihr Passwort bei der nÃ¤chsten Anmeldung zu Ã¤ndern. Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden.',includeAdmins:'Admin-Konten einschlieÃŸen',includeAdminsWarning:'Achtung: Sie mÃ¼ssen dann auch Ihr Passwort Ã¤ndern!',includeAdminsInExpiry:'Admin-Konten einschlieÃŸen',includeAdminsInExpiryDesc:'Auch Admins mÃ¼ssen ihr Passwort regelmÃ¤ÃŸig Ã¤ndern',// Theme System - NS Jan 2026
appearance:'Erscheinungsbild',themeDesc:'WÃ¤hle ein Farbthema fÃ¼r die OberflÃ¤che',themeNote:'Das Theme wird in deinem Account gespeichert und bleibt Ã¼ber Sitzungen hinweg erhalten.',chooseTheme:'WÃ¤hle dein Theme',themePersonal:'WÃ¤hle ein Theme das zu dir passt. Diese Einstellung ist persÃ¶nlich und betrifft nur deinen Account.',defaultTheme:'Standard-Theme',defaultThemeDesc:'Standard-Theme fÃ¼r neue Benutzer festlegen. Benutzer kÃ¶nnen ihr Theme in "Mein Profil" Ã¤ndern.',currentDefault:'Aktueller Standard',themeInProfile:'Ã„ndere dein Theme in "Mein Profil" (klicke auf deinen Benutzernamen oben rechts)',// UI Layout - LW Jan 2026
// LW: Feb 2026 - Layout Style (Modern vs Corporate)
layoutStyle:'Layout-Stil',layoutStyleDesc:'WÃ¤hle zwischen modernem Dashboard oder Corporate-Enterprise-Stil.',layoutModern:'Modern',layoutModernDesc:'Dashboard mit Karten, Animationen und FarbverlÃ¤ufen',layoutCorporate:'Corporate (Experimentell)',layoutCorporateDesc:'Klassischer Enterprise-Stil - experimentelles Feature, noch in Entwicklung',breadcrumbAll:'Alle',// TaskBar Settings - NS Feb 2026
taskbarAutoExpand:'TaskBar Auto-Aufklappen',taskbarAutoExpandDesc:'TaskBar automatisch Ã¶ffnen wenn neue Tasks starten',taskbarAutoExpandEnabled:'TaskBar Auto-Aufklappen aktiviert',taskbarAutoExpandDisabled:'TaskBar Auto-Aufklappen deaktiviert',dragToResize:'Zum Ã„ndern der GrÃ¶ÃŸe ziehen',userColumnHint:'Zeigt PegaProx-Benutzer falls verfÃ¼gbar, sonst Proxmox-Benutzer',// LW: Support Bundle translations - Feb 2026
support:'Support',supportBundle:'Support-Bundle',supportBundleDesc:'Erstellt ein Diagnose-Bundle mit Logs, Konfiguration und Systeminformationen fÃ¼r die Fehlerbehebung. Sensible Daten (PasswÃ¶rter, Tokens, Secrets) werden automatisch entfernt.',bundleContents:'Bundle-Inhalt',bundleSystemInfo:'Systeminformationen (Version, Plattform, Python)',bundleClusterStatus:'Cluster-Verbindungsstatus',bundleAuditLogs:'Aktuelle Audit-Log-EintrÃ¤ge (letzte 500)',bundleAppLogs:'Anwendungsprotokolle (letzte 1000 Zeilen)',bundleDbSchema:'Datenbankschema und Statistiken',bundleServerSettings:'Servereinstellungen (PasswÃ¶rter entfernt)',bundleUserList:'Benutzerliste (keine sensiblen Daten)',bundleRecentTasks:'Aktuelle Proxmox-Tasks',bundleSseStats:'SSE/SSH-Verbindungsstatistiken',generatingBundle:'Support-Bundle wird erstellt...',bundleDownloaded:'Support-Bundle erfolgreich heruntergeladen',bundleError:'Fehler beim Erstellen des Support-Bundles',downloadBundle:'Support-Bundle herunterladen',bundleSize:'Typische GrÃ¶ÃŸe: 50-500 KB',supportResources:'Support-Ressourcen',reportIssue:'Problem melden',discussions:'Diskussionen',documentation:'Dokumentation',releases:'Versionen',quickSystemInfo:'System-Schnellinfo',// MK: Storage Rescan translations - Feb 2026
rescan:'Rescan',rescanningStorage:'Scanne Storage neu...',storageRescanSuccess:'Storage-Rescan abgeschlossen',storageRescanError:'Storage-Rescan fehlgeschlagen',rescanStorageTooltip:'Storage neu scannen um neue LUNs/Volumes zu erkennen',deepRescanningStorage:'Deep Rescan lÃ¤uft (mit pvresize)...',rescanOptions:'Rescan Optionen',quickRescan:'Schneller Rescan',quickRescanDesc:'Status Ã¼ber API aktualisieren. FÃ¼r allgemeine Status-Updates.',deepRescan:'Deep Scan',deepRescanDesc:'SSH-basierter SCSI Rescan + Multipath Reconfigure + automatisches pvresize. Nach LUN-Erweiterung oder neuen LUNs.',deepRescanNote:'Erfordert SSH-Zugang zu den Nodes',rescanStorage:'Storage neu scannen',rescanStorageDesc:'Scanne Storage um Ã„nderungen zu erkennen.',recommended:'Empfohlen',scanning:'Scanne...',themeChanged:'Theme geÃ¤ndert zu',themeChangeFailed:'Theme konnte nicht gespeichert werden',uiLayout:'BenutzeroberflÃ¤che',layoutDesc:'WÃ¤hle zwischen verschiedenen Interface-Layouts.',inventory:'Inventar',selectItem:'WÃ¤hle ein Element aus dem Baum',summary:'Zusammenfassung',monitor:'Ãœberwachung',configure:'Konfiguration',console:'Konsole',snapshots:'Snapshots',snapshotsOverview:'Snapshot Ãœbersicht',snapshotsCleanUp:'Cleanup',snapshotsDesc:'Ãœbersicht der Ã¤ltesten Snapshots in diesem Cluster',snapshotsHint:'Ãœbersicht von allen Snapshots Ã¼ber alle GÃ¤ste und Nodes',snapshotsType:'Art',snapshotsDate:'Erstellt',snapshotsAge:'Alter',snapshotsAction:'Aktion',noSnapshots:'Keine Snapshots gefunden'},en:{// General
loading:'Loading...',save:'Save',cancel:'Cancel',delete:'Delete',edit:'Edit',add:'Add',close:'Close',yes:'Yes',no:'No',enabled:'Enabled',disabled:'Disabled',enable:'Enable',disable:'Disable',actions:'Actions',status:'Status',name:'Name',type:'Type',online:'Online',offline:'Offline',running:'Running',stopped:'Stopped',active:'Active',all:'All',id:'ID',cores:'Cores',search:'Search',searchByNameOrId:'Search by name or ID...',searchAllClusters:'Search all clusters...',pressEnterToOpen:'Press Enter to jump to VM',toggleFavorite:'Toggle favorite',results:'results',noResults:'No results',target:'Target',source:'Source',rules:'Rules',default:'Default',none:'None',of:'of',since:'Since',uptime:'Uptime',sinceStart:'Since Start',osVersion:'OS Version',guestAgentNotInstalled:'QEMU Guest Agent not installed',guestAgentInstallHint:'Install qemu-guest-agent to display hostname, OS and kernel info',// LW: Feb 2026 - Corporate VM Detail View
vmSummary:'VM Summary',generalInfo:'General',hardwareInfo:'Hardware',guestAgentInfo:'Guest Agent',backToList:'Back to List',configure:'Configure',summary:'Summary',console:'Console',sockets:'Sockets',machine:'Machine',biosType:'BIOS',scsiController:'SCSI Controller',networkAdapter:'Network Adapter',cpuModel:'CPU Model',hostname:'Hostname',kernel:'Kernel',haStatus:'HA Status',lockStatus:'Lock Status',notLocked:'Not locked',locked:'Locked',cpuUsage:'CPU Usage',ramUsage:'RAM Usage',vmid:'VMID',node:'Node',score:'Score',consoleAvailable:'Console available',vmPoweredOff:'VM is powered off',launchWebConsole:'Launch Web Console',qemuAgent:'QEMU Agent',installGuestAgent:'Install QEMU Guest Agent...',vmHardware:'VM Hardware',relatedObjects:'Related Objects',network:'Network',// LW: Feb 2026 - Corporate Node Detail View
hostDetails:'Host Details',capacityUsage:'Capacity & Usage',monitor:'Monitor',logicalProcessors:'Logical Processors',networkInterfaces:'Network Interfaces',certificates:'Certificates',timeConfig:'Time Configuration',hostsFile:'Hosts File',vmsOnNode:'VMs on this Node',nodeShell:'Node Shell',subscriptionInfo:'Subscription',pveVersion:'PVE Version',kernelVersion:'Kernel Version',cpuSockets:'CPU Sockets',totalRam:'Total RAM',rootFilesystem:'Root Filesystem',swapUsage:'Swap Usage',systemInfo:'System Information',storage:'Storage',repositories:'Repositories',performance:'Performance',tasks:'Tasks',rebootNode:'Reboot Node',shutdownNode:'Shutdown Node',nodeSettings:'Node Settings',dns:'DNS',syslog:'Syslog',disks:'Disks',lvmStorage:'LVM',lvmThinStorage:'LVM-Thin',zfsStorage:'ZFS',// Auth
login:'Login',logout:'Logout',loginTitle:'Sign in to PegaProx',loginSubtitle:'PegaProx Cluster Management for Proxmox VE',usernameLabel:'Username',passwordLabel:'Password',passwordPolicyHint:'Min. 8 characters, uppercase, lowercase & number required',minChars:'Min.',characters:'characters',uppercase:'uppercase',lowercase:'lowercase',numbers:'number',specialChar:'special char',loginButton:'Sign In',loggingIn:'Signing in...',loginError:'Login failed',invalidCredentials:'Invalid credentials',sessionExpired:'Session expired',welcomeBack:'Welcome back',changePassword:'Change Password',currentPassword:'Current Password',newPassword:'New Password',confirmPassword:'Confirm Password',passwordChanged:'Password changed',passwordMismatch:'Passwords do not match',userManagement:'User Management',users:'Users',addUser:'Add User',editUser:'Edit User',deleteUser:'Delete User',deleteUserConfirm:'Really delete this user?',role:'Role',roleAdmin:'Administrator',roleUser:'User',roleViewer:'Viewer',displayName:'Display Name',user:'User',email:'Email',userEnabled:'Enabled',lastLogin:'Last Login',never:'Never',profile:'Profile',// PegaProx Settings
pegaproxSettings:'PegaProx Settings',serverSettings:'Server',networkSettings:'Network Settings',domain:'Domain',domainHint:'Public domain to access PegaProx',port:'Port',portHint:'Default: 5000, HTTPS typically 443',httpRedirectPort:'HTTP Redirect Port (additional)',httpRedirectPortHint:'For port 80 redirect. -1 = off (default), 0 = auto, 80 = enabled. HTTP on same port redirects automatically.',sslSettings:'SSL/TLS Certificate',enableSsl:'Enable SSL',sslCertificate:'SSL Certificate',sslKey:'Private Key',noCertSelected:'No certificate selected',noKeySelected:'No key selected',browse:'Browse',sslWarning:'After enabling SSL, the server must be restarted. Make sure the certificate and key are valid!',sslHint:'For Let\'s Encrypt: Use fullchain.pem as certificate and privkey.pem as key.',saveSettings:'Save Settings',serverSettingsSaved:'Server settings saved',restartRequired:'Server restart required to apply changes',restartInfo:'Note about Changes',restartInfoDesc:'Changes to port or SSL settings require a restart of the PegaProx server.',errorSavingSettings:'Error saving settings',restartServer:'Restart Server',restartServerDesc:'Restarts the PegaProx server to apply changes',restartNow:'Restart Now',confirmRestart:'Restart Server?',restartWarning:'The server will be temporarily unavailable',restartConfirmText:'Do you really want to restart the PegaProx server?',restartEffect1:'All active connections will be disconnected',restartEffect2:'The web interface will be unavailable for about 5-10 seconds',restartEffect3:'Unsaved changes will be lost',yesRestart:'Yes, restart',restarting:'Restarting...',restartInitiated:'Server restart initiated',reconnecting:'Reconnecting...',restartFailed:'Server restart failed',// Tenants & Permissions
// Reddit feature request - MSPs needed this for customer isolation
tenants:'Tenants',tenant:'Tenant',addTenant:'Add Tenant',editTenant:'Edit Tenant',deleteTenant:'Delete Tenant',tenantSaved:'Tenant saved',tenantClustersHint:'Select which clusters this tenant can access (empty = all)',noVmsInCluster:'No VMs found in this cluster',tenantsDesc:'Tenants allow you to separate users and restrict access to specific clusters.',defaultTenant:'Default Tenant',tenantClusters:'Clusters for this tenant',allClusters:'All clusters',// Cluster Groups - NS Jan 2026
clusterGroups:'Cluster Groups',clusterGroup:'Cluster Group',addGroup:'Add Group',editGroup:'Edit Group',deleteGroup:'Delete Group',groupName:'Group Name',groupDescription:'Description',groupColor:'Color',assignToGroup:'Assign to Group',ungrouped:'Ungrouped',noGroup:'No Group',removeFromGroup:'Remove from Group',groupCreated:'Group created',groupDeleted:'Group deleted',groupUpdated:'Group updated',manageGroups:'Manage Groups',clusterGroupsDesc:'Organize clusters into groups and assign them to tenants for access control.',noGroupsYet:'No groups created yet',createGroupFirst:'Create a group first',assignTenant:'Assign to Tenant (optional)',noTenantAllVisible:'No tenant (visible to all)',groupTenantHint:'If assigned, only this tenant can see clusters in this group',groupsTip:'Tip: Assign groups to tenants in Settings â†‘ Cluster Groups for access control',permissions:'Permissions',permission:'Permission',permissionsDesc:'Configure granular permissions for users. Role-based defaults can be overridden per user.',selectUser:'Select User',selectUserToEdit:'Select a user to edit permissions',effectivePermissions:'Effective Permissions',extraPermissions:'Extra Permissions',deniedPermissions:'Denied Permissions',grantedByRole:'Granted by role',permissionSaved:'Permissions saved',tenantCreated:'Tenant created',tenantDeleted:'Tenant deleted',tenantUpdated:'Tenant updated',cannotDeleteDefaultTenant:'Cannot delete default tenant',reassignUsersFirst:'Users must be reassigned first',// Custom Roles section
roles:'Roles',customRoles:'Custom Roles',createRole:'Create Role',roleId:'Role ID',roleName:'Display Name',rolesDesc:'Create custom roles with specific permissions. Roles can be global or tenant-specific.',scope:'Scope',global:'Global',roleCreated:'Role created',roleSaved:'Role saved',roleDeleted:'Role deleted',confirmDeleteRole:'Delete this role?',builtinRole:'Builtin Role',tenantSpecific:'Tenant-specific',roleTemplates:'Role Templates',roleTemplatesDesc:'Quick-start templates for common role configurations',createFromTemplate:'Create from Template',includedPermissions:'Included Permissions',roleCreatedFromTemplate:'Role created from template',vmAcl:'VM Access Control',vmAclDesc:'Set permissions for individual VMs',addVmAcl:'Add VM Permission',editVmAcl:'Edit VM Permission',vmPermissions:'VM Permissions',noVmAcls:'No VM-specific permissions configured. All VMs follow role-based access.',selectClusterFirst:'Select a cluster first',selectVm:'Select VM',usersWithAccess:'Users with Access',inheritRolePerms:'Full VM access (start, stop, console, etc.)',customPermissions:'Custom Permissions',vmAclSaved:'VM permissions saved',vmAclDeleted:'VM permissions removed',confirmDeleteVmAcl:'Remove custom permissions for this VM?',// Pool Permissions - MK Jan 2026
poolPermissions:'Pool Permissions',poolPermissionsDesc:'Grant users or groups access to Proxmox resource pools. Permissions apply to all VMs within the pool.',managePools:'Manage Pools',poolManagerDesc:'Create, edit, and delete resource pools. Assign VMs to pools for organized permission management.',createPool:'Create Pool',editPool:'Edit Pool',deletePool:'Delete Pool',poolId:'Pool ID',poolIdRequired:'Pool ID is required',poolIdHint:'Letters, numbers, dashes and underscores only',poolIdCannotChange:'Pool ID cannot be changed',poolCreated:'Pool created successfully',poolUpdated:'Pool updated successfully',poolDeleted:'Pool deleted successfully',confirmDeletePool:'Are you sure you want to delete this pool? This cannot be undone.',noPoolsYet:'No pools yet',createFirstPool:'Create your first pool to organize VMs',poolMembers:'Members',members:'members',addVmToPool:'Add VM to Pool',removeFromPool:'Remove from pool',vmAddedToPool:'VM added to pool',vmRemovedFromPool:'VM removed from pool',confirmRemoveVmFromPool:'Remove VM from this pool?',selectVmToAdd:'Select a VM to add to this pool',allVmsInPools:'All VMs are already in pools',optionalDescription:'Optional description...',userPermissions:'User Permissions',selectPool:'Select Pool',noPools:'No resource pools found in this cluster',noPoolPerms:'No permissions configured for this pool',selectPoolFirst:'Select a cluster and pool to manage permissions',addPoolPerm:'Add Pool Permission',editPoolPerm:'Edit Pool Permission',poolPermSaved:'Pool permission saved',poolPermDeleted:'Pool permission removed',refreshPools:'Refresh pools from Proxmox',poolCacheRefreshed:'Pool cache refreshed',confirmDeletePoolPerm:'Remove permission?',subjectType:'Type',permissionsFor:'Permissions for',addPermission:'Add Permission',groupName:'Group Name',auditLog:'Audit Log',auditLogDescription:'All user actions from the last 90 days',noAuditLogs:'No audit entries available',action:'Action',details:'Details',timestamp:'Timestamp',ipAddress:'IP Address',userCreated:'User created',userUpdated:'User updated',userDeleted:'User deleted',userLogin:'Login',userLogout:'Logout',passwordChanged:'Password changed',clusterAdded:'Cluster added',apiTokenWarningTitle:'API Token Authentication',apiTokenWarningDesc:'Using API tokens is supported but not all features will work correctly. Features requiring SSH access (SMBIOS Auto-Config, Rolling Updates, 2-Node HA, Node Shell) need password authentication. PegaProx recommends using a dedicated privileged user or root with password for full functionality.',clusterDeleted:'Cluster deleted',clusterConfigChanged:'Cluster config changed',vmStarted:'VM started',vmStopped:'VM stopped',vmRestarted:'VM restarted',vmCreated:'VM created',vmDeleted:'VM deleted',vmCloned:'VM cloned',vmMigrated:'VM migrated',vmUnlocked:'VM unlocked',vmLocked:'VM locked',unlockVm:'Unlock VM',lockReason:'Lock Reason',unlockWarning:'Warning: Unlocking a VM during an active operation may cause data corruption or other issues. Only proceed if you are sure the operation has failed or been cancelled.',vmBulkMigrated:'Bulk migration',vmConfigChanged:'VM config changed',vmSuspended:'VM suspended',vmResumed:'VM resumed',vmDiskAdded:'Disk added',vmDiskRemoved:'Disk removed',vmDiskResized:'Disk resized',vmDiskMoved:'Disk moved',vmNetworkAdded:'Network added',vmNetworkRemoved:'Network removed',vmNetworkUpdated:'Network updated',removeDiskConfirm:'Really remove disk',detachDisk:'Detach',importDisk:'Import Disk',importDiskDesc:'Import existing disk image from storage',selectImportStorage:'Select Source Storage',selectDiskImage:'Select Disk Image',targetBus:'Target Bus',reassignOwner:'Reassign Owner',reassignOwnerDesc:'Assign disk to a different VM',targetVm:'Target VM',diskReassigned:'Disk reassigned',diskImported:'Disk imported',noImportableDisks:'No importable disk images found',reassign:'Reassign',import:'Import',detachDiskConfirm:'Really detach disk? It will become an unused disk.',diskDetached:'Disk detached',diskDeleted:'Disk deleted',diskAdded:'Disk added',dataWillBeDeleted:'Data will be permanently deleted!',removeNetworkConfirm:'Really remove network',snapshotCreated:'Snapshot created',snapshotDeleted:'Snapshot deleted',snapshotRestored:'Snapshot restored',rollbackConfirm:'Really rollback to this snapshot? This cannot be undone!',replicationCreated:'Replication created',replicationDeleted:'Replication deleted',replicationTriggered:'Replication triggered',haEnabled:'HA enabled',haDisabled:'HA disabled',noFallbackHosts:'No fallback hosts found (Single-Node Cluster?)',haVmAdded:'VM added to HA',haVmRemoved:'VM removed from HA',nodeMaintenanceEntered:'Maintenance mode entered',nodeMaintenanceExited:'Maintenance mode exited',nodeUpdateStarted:'Node update started',twoFactorAuth:'Two-Factor Authentication',twoFactorEnabled:'2FA enabled',twoFactorDisabled:'2FA disabled',enable2FA:'Enable 2FA',disable2FA:'Disable 2FA',setup2FA:'Setup 2FA',scan2FACode:'Scan QR code with authenticator app',enter2FACode:'Enter 6-digit code',verify2FA:'Verify',secretKey:'Secret Key',twoFARequired:'2FA code required',invalid2FACode:'Invalid 2FA code',force2FA:'Enforce 2FA',force2FADesc:'Require all users to set up Two-Factor Authentication before they can use PegaProx.',force2FAHint:'OIDC/Entra users are exempt (they use their Identity Provider\'s MFA). Users without 2FA will see a setup dialog on login.',force2FAExcludeAdmins:'Exclude admin accounts',force2FAExcludeAdminsDesc:'Admins can use PegaProx without 2FA',force2FASetupTitle:'2FA Setup Required',force2FASetupDesc:'Your administrator has made Two-Factor Authentication mandatory for all users. Please set up 2FA to continue.',resetPassword:'Reset Password',newPassword:'New Password',confirmPassword:'Confirm Password',currentPassword:'Current Password',passwordsDoNotMatch:'Passwords do not match',passwordTooShort:'Password must be at least 4 characters',passwordResetSuccess:'Password changed successfully',myProfile:'My Profile',security:'Security',snapshotNotSupported:'Snapshots not supported',snapshotWarnings:'Snapshot warnings',filterByUser:'Filter by user',filterByAction:'Filter by action',allUsers:'All Users',allActions:'All Actions',exportAuditLog:'Export',refreshAuditLog:'Refresh',// Header
addCluster:'Add Cluster',pveClusterDesc:'Virtual machines & containers',pbsDesc:'Backup management',vmwareDesc:'ESXi infrastructure',addConnection:'Add Connection',connectionType:'Connection Type',clusterManagement:'PegaProx Cluster Management for Proxmox VE',// Tabs
overview:'Overview',resources:'Resources',datacenter:'Datacenter',settings:'Settings',of:'of',showing:'Showing',perPage:'Per page',loadingDatacenter:'Loading datacenter data...',// Cluster
clusters:'Clusters',noClusterSelected:'No Cluster Selected',allClustersOverview:'All Clusters Overview',allClusters:'All Clusters',multiClusterSummary:'Summary of all managed clusters',clustersConnected:'Clusters Connected',clusterOverview:'Cluster Overview',vmsRunning:'VMs Running',vmsStopped:'VMs Stopped',noClustersConfigured:'No clusters configured',addClusterToStart:'Add a cluster to get started',clickClusterTip:'Click on a cluster row or select from the sidebar to view detailed information and manage resources.',health:'Health',average:'Average',noDataAvailable:'No data available',clickToManage:'Click to manage',sortBy:'Sort by',ungrouped:'Ungrouped',alerts:'Alerts',updated:'Updated',justNow:'just now',topResources:'Top Resources',highestCpuUsage:'Highest CPU and RAM usage across all clusters',clickToOpenVm:'Click to open VM',selectCluster:'Select a cluster from the list',addFirstCluster:'Add First Cluster',connectCluster:'Connect a Proxmox cluster with PegaProx',clusterName:'Cluster Name',host:'Host',username:'Username',password:'Password',passwordOrToken:'Password / Token',apiTokenHint:'For API tokens: user@realm!tokenid',sslVerification:'SSL Verification',connecting:'Connecting...',addNewCluster:'Add New Cluster',testConnection:'Test Connection',deleteCluster:'Delete Cluster',deleteClusterConfirm:'Really delete cluster?',clusterHealth:'Cluster Health',excellent:'Excellent',good:'Good',warning:'Warning',critical:'Critical',nodesOnline:'Nodes Online',nodeJoinHint:'To add a new node, run on the new node:',avgScore:'Avg. Score',avgCpu:'Avg. CPU',avgRam:'Avg. RAM',// Nodes
nodes:'Nodes',node:'Node',loadingMetrics:'Loading metrics...',connectionError:'Connection Error',retry:'Retry',checkConnectionAndRetry:'Please check your connection and try again.',connectionTimeout:'Timeout - Proxmox unreachable',maintenance:'Maintenance',enterMaintenance:'Enter Maintenance Mode',exitMaintenance:'Exit Maintenance Mode',maintenanceMode:'Maintenance Mode',update:'Update',startUpdate:'Start Update',nodeConfig:'Node Configuration',cpuHistory:'CPU History',ramHistory:'RAM History',ramUsage:'RAM Usage',cpuUsage:'CPU Usage',diskUsage:'Disk Usage',showMore:'Show more',showLess:'Show less',// VMs & Resources
virtualMachines:'Virtual Machines',containers:'Containers',vm:'VM',lxc:'LXC',lxcContainer:'LXC Container',container:'Container',guests:'Guests',start:'Start',stop:'Stop',shutdown:'Shutdown',reboot:'Reboot',forceStop:'Force Stop',forceReset:'Force Reset',forceStopConfirm:'really force stop? This may cause data loss!',migrate:'Migrate',migrateVm:'Migrate VM',crossClusterMigration:'Cross-Cluster Migration',crossClusterMigrateDesc:'Migrate VM to another Proxmox cluster',crossClusterMigrate:'Cross-Cluster Migrate',crossClusterStarted:'Cross-Cluster Migration started',crossClusterFailed:'Cross-Cluster Migration failed',crossClusterLB:'Cross-Cluster Load Balancing',crossClusterLBEnabled:'Cross-Cluster LB enabled',crossClusterLBDisabled:'Cross-Cluster LB disabled',crossClusterLBThreshold:'Score Threshold',crossClusterLBInterval:'Check Interval',crossClusterLBDryRun:'Simulation (Dry Run)',crossClusterLBLastRun:'Last Run',crossClusterReplication:'Cross-Cluster Replication',crossClusterReplicationDesc:'Replicate VM snapshots to another cluster (DR)',groupOverview:'Group Overview',groupSettings:'Group Settings',groupSettingsSaved:'Group settings saved',replicationSchedule:'Schedule',replicationRetention:'Retention',maxMigrations:'Max Migrations per Cycle',lbHistory:'LB History',clusterScore:'Cluster Score',noReplicationJobs:'No cross-cluster replication jobs',createReplicationJob:'Create DR Job',replicationStarted:'Replication started',replicationJobCreated:'Replication job created',replicationJobDeleted:'Replication job deleted',recentLbActions:'Recent cross-cluster LB actions',noLbEvents:'No cross-cluster LB events yet',enableCrossClusterLB:'Enable Cross-Cluster Load Balancing',lbDescription:'Automatically migrate VMs between clusters when resource thresholds are exceeded',dryRunMode:'Dry Run / Simulation Mode',cpuThreshold:'CPU Threshold (%)',lbStatus:'Load Balancing Status',lbExplanation:'Cross-Cluster Load Balancing monitors CPU and RAM usage across all clusters in this group. When a cluster exceeds the configured threshold, VMs are automatically migrated to a less loaded cluster.',lbDryRunExplanation:'Enable Dry Run mode first to review what actions would be taken before enabling live migrations.',neverRun:'Never run',newCrossClusterReplication:'New Cross-Cluster Replication',confirmDeleteXRepl:'Delete this cross-cluster replication job?',addDrJob:'Add DR Job',scheduleCron:'Schedule (cron)',targetStorageHint:'Storage name on destination cluster',maxMigrationsHint:'Limit how many VMs are moved each check cycle (1-5)',proxlbCredit:'ProxLB by gyptazy',proxlbCreditDesc:'Our load balancing functionality is based on the excellent work from ProxLB. Special thanks to gyptazy for creating and open-sourcing this amazing tool!',xReplCreated:'Cross-cluster replication created',xReplDeleted:'Cross-cluster replication deleted',xReplStarted:'Cross-cluster replication started',xReplCreateFailed:'Failed to create job',xReplDeleteFailed:'Delete failed',xReplStartFailed:'Failed to start',lastRunPrefix:'Last',runNow:'Run now',loadingCrossClusterResources:'Loading storage/network for all clusters...',noCommonStorages:'No common storage found across all clusters',noCommonBridges:'No common bridge found across all clusters',selectBridge:'Select bridge...',crossClusterThresholdDesc:'CPU threshold for cluster imbalance (10-80%)',crossClusterIntervalDesc:'Time between check cycles',crossClusterMaxMigrationsDesc:'Max migrations per check cycle',commonStorageHint:'Only storages available on all clusters in this group',commonBridgeHint:'Only bridges available on all clusters in this group',includeContainers:'Include Containers',includeContainersDesc:'Include containers (LXC) in cross-cluster balancing',containerMigrationWarning:'Containers are restarted during migration (downtime)',excludedVMsCrossCluster:'Excluded VMs/Containers',excludedVMsCrossClusterDesc:'VMs and containers excluded from automatic cross-cluster balancing',clusterExcludedVMs:'Excluded VMs',noExcludedVMsInGroup:'No VMs excluded',selectCluster:'Select cluster...',selectClusterFirst:'Select a target cluster first',simulationMode:'Simulation Mode',sourceVm:'Source VM',targetCluster:'Target Cluster',targetNode:'Target Node',targetStorage:'Target Storage',targetBridge:'Target Network (Bridge)',moveDisk:'Move Disk',resizeDisk:'Resize Disk',diskResized:'Disk resized',deleteSourceDisk:'Delete source after move',deleteSourceDiskWarning:'The original disk will remain on the source storage. You can remove it manually later.',move:'Move',from:'from',noNetworkInterfaces:'No network interfaces',nameRequired:'Name required',newVmid:'New VMID (optional)',sameIdPlaceholder:'Empty = same ID',liveMigrationOption:'Live Migration (VM keeps running)',deleteSourceAfter:'Delete source VM after migration',largeDiskWarning:'Large Disk Detected',largeDiskExplanation:'Live migration for disks >100GB may fail with "401 Unauthorized" due to Proxmox WebSocket ticket timeout. The server will automatically use offline migration unless forced.',forceOnlineMigration:'Force online migration anyway (may fail)',autoTokenInfo:'PegaProx automatically creates temporary API tokens for migration and deletes them after completion.',clusterReachableInfo:'Clusters must be able to reach each other over the network. The configured user must have permissions to create API tokens.',selectCluster:'Select cluster...',selectNode:'Select Node',selectStorage:'Select storage...',loadingNodes:'Loading target nodes...',loadingStorageNetwork:'Loading storage/network...',liveMigration:'Live Migration (no downtime)',on:'on',targetStorage:'Target Storage',sameAsSource:'Same as source',loadingStorages:'Loading storages',free:'free',withLocalDisks:'With Local Disks',withLocalDisksDesc:'Migrate local disks to target storage',localDisksDetected:'This VM has local disks. Migration requires copying disk data.',requiredForThisVm:'Required for this VM',cdDvdMounted:'CD/DVD Drive Mounted',cdDvdMigrationWarning:'Live migration is not possible with a CD/DVD mounted. Please eject the CD/DVD first or use offline migration.',isoMounted:'ISO/CD-ROM Mounted',isoEjected:'CD-ROM Ejected',isoMigrationWarning:'Migration may fail if the ISO is not available on the target node. Eject the CD/DVD or ensure the ISO exists on shared storage.',localStorage:'Local',bootOrderIssue:'Boot Order Issue',bootOrderWarning:'Boot order references non-existent disks',bootOrder:'Boot Order',dragToReorder:'Click to toggle, use arrows to reorder',noBootDevices:'No boot devices found',resizeDiskHint:'Increase by (e.g. +10G) or new size',// SMBIOS Settings
smbiosSettings:'SMBIOS Settings',smbiosHint:'System Management BIOS - useful for Windows licensing and VM identification',applySmbiosFromClusterConfig:'Apply SMBIOS settings from cluster configuration',requiresRestart:'RESTART',readOnly:'read-only',autoGenerated:'auto-generated',smbiosFormatHint:'Only letters and numbers allowed (A-Za-z0-9)',preview:'Preview',currentValue:'Current Value',managedByProxmox:'managed by Proxmox',willBeAutoGenerated:'Will be auto-generated on save',forceConntrack:'Force (Conntrack State)',forceConntrackDesc:'Force migration even if conntrack entries exist',containerNoLiveMigration:'Containers do not support true live migration',startingMigration:'Starting migration of',migrationStarted:'Migration started:',migrationFailed:'Migration failed',clone:'Clone',console:'Console',openConsole:'Open Console',metrics:'Metrics',config:'Configuration',configuration:'Configuration',createVm:'Create new VM',createContainer:'Create new Container',noNodesAvailable:'No nodes available. Please wait for cluster data to load.',loadingStorage:'Loading storage list...',noIsoAvailable:'No ISO images found',noTemplateAvailable:'No templates found',noStorageAvailable:'No storage available',noIsoStorage:'No storage with ISO content found',ram:'RAM',cpu:'CPU',disk:'Disk',network:'Network',// VM Creation Wizard
node:'Node',next:'Next',guestOs:'Guest Operating System',isoImage:'ISO Image',noIso:'No ISO',virtioDrivers:'VirtIO Drivers ISO (Windows)',noVirtioDrivers:'No VirtIO Drivers',allIsos:'All ISOs',virtioDriversHint:'Will be mounted as additional CD-ROM for Windows driver installation',// MK: New wizard translations
advancedCpu:'Advanced CPU Settings',cpuAffinity:'CPU Affinity',cpuAffinityHint:'Pin vCPUs to specific host CPUs',enableNuma:'Enable NUMA',advancedMemory:'Advanced Memory Settings',minimumMemory:'Minimum Memory',sameAsMemory:'Same as Memory (no ballooning)',minimumMemoryHint:'Lower limit for memory ballooning',ballooningDevice:'Ballooning Device',memoryShares:'Memory Shares',memorySharesHint:'Weight for memory auto-ballooning (0-50000, default: 1000)',primaryDisk:'Primary Disk',additionalDisk:'Additional Disk',addDisk:'Add Disk',macAddress:'MAC Address',autoGenerate:'Auto-generate (leave empty)',advancedNetwork:'Advanced Network Settings',inheritBridge:'Inherit from bridge',rateLimit:'Rate Limit',unlimited:'Unlimited',noLinkOnStart:'No network link on start',highAvailability:'High Availability',enableHa:'Add to Proxmox Native HA',haGroup:'HA Group',defaultGroup:'Default group (leave empty)',rootFilesystem:'Root Filesystem',mountPoint:'Mount Point',addMountPoint:'Add Mount Point',path:'Path',busType:'Bus/Type',size:'Size',format:'Format',storageDefault:'Storage Default',bestPerformance:'best performance',free:'free',bridge:'Bridge',model:'Model',vlanTag:'VLAN Tag (optional)',vlanExample:'e.g. 100',enableFirewall:'Enable Firewall',cpuType:'CPU Type',machineType:'Machine Type',efiSettings:'UEFI/EFI Settings',efiDiskStorage:'EFI Disk Storage',preEnrollKeys:'Pre-enroll Microsoft Keys (SecureBoot)',tpmSettings:'TPM (Trusted Platform Module)',enableTpm:'Enable TPM',tpmStorage:'TPM Storage',tpmVersion:'TPM Version',recommended:'recommended',win11NeedsTpm:'Windows 11 requires TPM 2.0',efiTpmSettings:'EFI & TPM Settings',efiDisk:'EFI Disk',tpmChip:'TPM Chip',configured:'Configured',noEfiDisk:'No EFI disk configured',addEfiDisk:'Add EFI Disk',efiDiskRequired:'Required for UEFI boot. Will be created automatically on first boot if not configured.',efiDiskInfo:'EFI disk stores UEFI firmware variables and is required for UEFI boot. Size is automatically set to 4MB.',efiDiskAdded:'EFI disk added',noTpm:'No TPM configured',addTpm:'Add TPM',tpmInfo:'TPM (Trusted Platform Module) is required for Windows 11 and provides hardware-based security features like BitLocker.',tpmAdded:'TPM added',confirmDeleteEfiDisk:'Delete EFI disk? This may prevent the VM from booting.',confirmDeleteTpm:'Delete TPM? Windows 11 and BitLocker will stop working.',efiDiskDeleted:'EFI disk deleted',tpmDeleted:'TPM deleted',enableQemuAgent:'Enable QEMU Guest Agent',startOnBoot:'Start on host boot',startAfterCreate:'Start after creation',rootPassword:'Root Password',sshPublicKeys:'SSH Public Keys',loadSshKeyFile:'Load SSH Key File',sshKeyHintMultiple:'One key per line. Paste or load from file.',// SSH Shell Login
dropKeyFileHere:'Drop key file here or click',keyLoaded:'Key loaded',lines:'lines',keyPassphrase:'Key Passphrase',optional:'optional',ifKeyEncrypted:'If key is encrypted...',connect:'Connect',dnsDomain:'DNS Domain',dnsServers:'DNS Servers',useHostSettings:'Use host settings',dnsServersHint:'Space-separated list of DNS servers',disconnected:'Disconnected',manual:'Manual',ipAddress:'IP Address',recommended:'recommended',dockerSupport:'Docker support',free:'free',used:'used',total:'total',selectTemplate:'Select template...',cpuCoresLabel:'CPU Cores',swapMemory:'Swap (MB)',unprivileged:'Unprivileged',unprivilegedHint:'Safer, but limited functionality',nesting:'Nesting',nestingHint:'Allows Docker/LXC in LXC',ipConfig:'IP Configuration',useDhcp:'Use DHCP',gateway:'Gateway',lvmZfsIgnoreFormat:'LVM/ZFS ignore format',targetNode:'Target Node',sameNode:'same node',crossNodeCloneWarning:'Cross-node clone requires shared storage (NFS, Ceph, etc.). Local storage will not work!',willBeCloned:'will be cloned',newVmId:'New VM ID',cloneMode:'Clone Mode',fullClone:'Full Clone',fullCloneDesc:'Independent copy of all data',linkedClone:'Linked Clone',linkedCloneDesc:'Faster, requires base image',onlyForVms:'Only available for VMs',cloneNotes:'Notes for clone...',optional:'optional',gridView:'Grid View',listView:'List View',compactView:'Compact View',selectVmFromList:'Select a VM from the list',selectAll:'Select All',deselectAll:'Deselect All',selectedItems:'selected',bulkActions:'Bulk Actions',quickActions:'Quick Actions',moreActions:'More Actions',xOfYResources:'of',resourcesLabel:'Resource Management',startClone:'Start Clone',vmStillRunning:'The VM is still running. It will be stopped before deletion.',ctStillRunning:'The container is still running. It will be stopped before deletion.',confirmDelete:'Confirm Delete',reallyDelete:'Really delete?',connectionFailed:'Connection failed',smartNotAvailable:'SMART data not available',smartFetchError:'Error fetching SMART data',cloneFailed:'Clone failed',forceStopFailed:'Force stop failed',forceStopping:'Force stopping...',bulkMigrationFailed:'Bulk migration failed',bulkMigration:'Bulk Migration',vmsSelected:'VMs selected',targetNode:'Target Node',selectNode:'Select node...',liveMigration:'Live Migration (no downtime)',migrateVms:'Migrate VMs',startingBulkMigration:'Starting bulk migration of',creationFailed:'Creation failed',actionFailed:'Action failed',autoDetectionFailed:'Auto-detection failed',clusterOffline:'Cluster unreachable',connectionClosed:'Connection closed',unexpectedDisconnect:'Connection unexpectedly closed',serverError:'Server error',switchTabToReconnect:'Switch tab and back to reconnect',deleteInterfaceConfirm:'Really delete interface?',noMigrationsYet:'No migrations yet',showMore:'Show all',showLess:'Show less',olderMigrations:'older migrations',paused:'Paused',performanceMetrics:'Performance Metrics',hour:'Hour',day:'Day',week:'Week',month:'Month',year:'Year',// Detail View
hostname:'Hostname',tags:'Tags',description:'Description',changesRequireRestart:'Note: Some changes require a restart',// Tags - NS Jan 2026
manageTags:'Manage Tags',noTags:'No tags',newTag:'New tag...',existingTags:'Existing tags',// Schedules - MK Jan 2026
schedules:'Schedules',scheduledActions:'Scheduled Actions',newSchedule:'New Schedule',editSchedule:'Edit Schedule',noSchedules:'No Scheduled Actions',noSchedulesDesc:'Create schedules to automatically start, stop, or snapshot VMs',createFirstSchedule:'Create your first schedule',scheduleCreated:'Schedule created',scheduleDeleted:'Schedule deleted',scheduleType:'Schedule Type',daily:'Daily',weekdays:'Weekdays',weekends:'Weekends',weekly:'Weekly',once:'Once',forOnce:'for once',forWeekly:'for weekly',days:'Days',lastRun:'Last Run',// Reports - NS Jan 2026
reports:'Reports',reportsAnalytics:'Reports & Analytics',lastHour:'Last Hour',last24h:'Last 24h',lastWeek:'Last Week',recentTasks:'Recent Tasks',noRecentTasks:'No recent tasks',alarms:'Alarms',noAlarms:'No active alarms',severity:'Severity',completionTime:'Completion',startTime:'Start Time',dismiss:'DISMISS',searchAllInventories:'Search in all inventories...',initiator:'Initiator',object:'Object',noReportData:'No Report Data',noReportDataDesc:'Historical data is being collected. Check back in a few minutes.',topVmsCpu:'Highest CPU Usage',topVmsMem:'Highest Memory Usage',historicalRange:'Historical Range',dataPoints:'data points',vmsRunning:'VMs Running',containersRunning:'Containers Running',clustersOnline:'Clusters Online',nodesOnline:'Nodes Online',datacenterOverview:'Datacenter Overview',noRunningVms:'No running VMs',// Automation Tab - NS Jan 2026
automation:'Automation',schedulesDesc:'Automatically start, stop, reboot or snapshot VMs on a schedule',tagsDesc:'Organize VMs with tags. Click the tag icon on any VM to add tags.',noTagsInCluster:'No tags in this cluster yet',addTagHint:'Use the tag button on VMs in the Resources tab',tagsTotal:'tags',clickVmTag:'Click tag icon on VMs to manage',alertsDesc:'Get notified when resources exceed thresholds',newAlert:'New Alert',noAlertsCluster:'No alerts for this cluster',alertCreated:'Alert created',targetType:'Apply to',entireCluster:'Entire Cluster',specificNode:'Specific Node',specificVm:'Specific VM',targetId:'Target',optional:'optional',condition:'Condition',cluster:'Cluster',affinityDesc:'Keep VMs/CTs together or separate across nodes',newRule:'New Rule',noAffinityCluster:'No affinity rules for this cluster',ruleCreated:'Rule created',together:'Together',separate:'Separate',enforced:'Enforced',// Config Modal Tabs
generalTab:'General',resourcesTab:'Resources',storageTab:'Storage',networkTab:'Network',snapshotsTab:'Snapshots',backupsTab:'Backups',replicationTab:'Replication',historyTab:'History',proxmoxTasks:'Proxmox Tasks',pegaproxActions:'PegaProx Actions',optionsTab:'Options',// Datacenter
summary:'Summary',cluster:'Cluster',options:'Options',storage:'Storage',backup:'Backup',replication:'Replication',balancing:'Balancing',excludedNodes:'Excluded Nodes',excludedNodesDesc:'These nodes will never be targets for automatic VM balancing or migration recommendations.',selectNodeToExclude:'Select node to exclude...',exclude:'Exclude',excludedFromBalancing:'Excluded from balancing',reincludedInBalancing:'re-included in balancing',excludeNode:'Exclude a node from balancing',noExcludedNodes:'No nodes excluded - all nodes participate in balancing',confirmExcludeNode:'Exclude',excludedVMs:'Excluded VMs',excludedVMsDesc:'These VMs will never be automatically migrated during load balancing.',selectVMToExclude:'Select VM to exclude...',noExcludedVMs:'No VMs excluded - all VMs participate in balancing',sourceCluster:'Source Cluster',selectVM:'Select VM...',fromBalancing:'from balancing',allNodesExcluded:'All nodes are excluded - balancing is effectively disabled',howExclusionWorks:'How node exclusion works',exclusionRule1:'Excluded nodes will NOT be targets for automatic VM balancing',exclusionRule2:'Excluded nodes will NOT receive VMs during load balancing migrations',exclusionRule3:'Excluded nodes are still visible and can receive manual migrations',exclusionRule4:'VMs on excluded nodes may still be migrated away if the node is overloaded',// NS: Backup translations - Dec 2025
createBackup:'Create Backup',noBackups:'No backups found',noBackupsHint:'Create a backup or check your backup storages',backupMode:'Backup Mode',compression:'Compression',backupStarted:'Backup started',downloadStarted:'Download started',downloadFailed:'Download failed',restoreBackup:'Restore Backup',selectedBackup:'Selected Backup',targetVmid:'Target VMID',targetStorage:'Target Storage',originalStorage:'Keep original',sameVmidWarning:'Same VMID = VM will be overwritten!',startAfterRestore:'Start after restore',confirmRestore:'Really restore this backup?',restoreStarted:'Restore started',confirmDeleteBackup:'Really delete this backup?',backupDeleted:'Backup deleted',// LW: backup mode options
backupModeSnapshot:'Snapshot (no stop)',backupModeSuspend:'Suspend (brief pause)',backupModeStop:'Stop (VM will stop)',compressZstd:'ZSTD (recommended)',compressLzo:'LZO (fast)',compressGzip:'GZIP',compressNone:'None',backupNotes:'Notes (optional)',backupNotesPlaceholder:'e.g. Before major update, weekly backup...',// HA
ha:'HA',haResources:'HA Resources',haGroups:'HA Groups',haStatus:'HA Status',cpuCompatibility:'CPU Compatibility',cpuCompatibilityMode:'CPU Compatibility Mode',cpuCompatibilityDesc:'Ensure live migration compatibility across different CPU generations',whatIsCpuCompat:'What is CPU Compatibility Mode?',cpuCompatExplain:'When you have nodes with different CPU generations (e.g., Haswell and Skylake), live migration may fail because newer CPUs expose features that older CPUs don\'t support.',cpuCompatSolution:'By setting all VMs to use a common CPU type, you ensure they can migrate between any node in the cluster.',recommendedSettings:'Recommended Settings',broadCompatibility:'Broad compatibility - works with most CPUs from 2008+',modern:'Modern',haswell:'Haswell and newer (2013+)',newest:'Newest',skylakeAvx:'Skylake-X with AVX-512 (2017+)',noMigration:'No Migration',hostDesc:'Pass-through host CPU - best performance, no migration',nodesCpuInfo:'Cluster Nodes CPU Information',howToApply:'How to Apply',cpuStep1:'Go to each VM\'s Hardware tab',cpuStep2:'Edit the CPU setting',cpuStep3:'Change "Type" to your chosen compatibility level',cpuStep4:'Restart the VM for changes to take effect',autoDetectedRecommendation:'Auto-Detected Recommendation',basedOnClusterCpus:'Based on the CPUs detected in your cluster, we recommend:',availableLevels:'Available Compatibility Levels',safest:'Safest',detectedClusterCpus:'Detected Cluster CPUs',loadingCpuInfo:'Loading CPU information...',copy:'Copy',criticalAlert:'CRITICAL ALERT',haRecoveryMayStart:'HA recovery may be in progress...',dismiss:'Dismiss',nodeOffline:'Node offline',nodeOnline:'Node online',nodeUnreachable:'Node unreachable',offlineSince:'Offline since',firewall:'Firewall',// SDN translations - MK Feb 2026
sdn:'SDN',sdnNotAvailable:'SDN Not Available',sdnNotConfigured:'Software Defined Networking is not configured on this cluster.',sdnPendingChanges:'There are pending SDN changes that need to be applied.',sdnApplied:'SDN configuration applied',sdnConfigSynced:'SDN configuration is in sync with all nodes.',applyingSDN:'Applying SDN configuration to all nodes...',sdnApplyReminder:'ðŸ’¡ Click "Apply / Reload" to deploy changes',applyChanges:'Apply Changes',sdnZones:'Zones',sdnVnets:'VNets',sdnInfo:'SDN Information',zones:'Zones',vnets:'VNets',subnets:'Subnets',controllers:'Controllers',noZones:'No zones configured',noVnets:'No VNets configured',createZoneFirst:'Create a zone first',addZone:'Add Zone',addVnet:'Add VNet',addSubnet:'Add Subnet',zoneName:'Zone Name',vnetName:'VNet Name',simpleZoneDesc:'Isolated zone with simple bridging',vlanZoneDesc:'VLAN-based zone using 802.1q tagging',vxlanZoneDesc:'VXLAN overlay network',evpnZoneDesc:'BGP EVPN with VXLAN',zoneCreated:'Zone created - Click "Apply / Reload" to activate',vnetCreated:'VNet created - Click "Apply / Reload" to activate',subnetCreated:'Subnet created - Click "Apply / Reload" to activate',zoneDeleted:'Zone deleted - Click "Apply / Reload" to activate',vnetDeleted:'VNet deleted - Click "Apply / Reload" to activate',sdnConfigSynced:'SDN configuration is in sync with all nodes.',applyingSDN:'Applying SDN configuration to all nodes...',confirmDeleteZone:'Delete zone?',confirmDeleteVnet:'Delete VNet?',zoneNameRequired:'Zone name is required',vnetNameZoneRequired:'VNet name and zone are required',subnetRequired:'Subnet is required',sourceNat:'Source NAT',noControllers:'No controllers configured. Controllers are needed for EVPN/VXLAN zones.',addController:'Add Controller',noIpam:'No IPAM configured. IPAM provides IP address management for subnets.',addIpam:'Add IPAM',noDns:'No DNS configured. DNS integration enables automatic DNS registration for VMs.',addDns:'Add DNS',seconds:'seconds',smbiosAuto:'SMBIOS Auto',smbiosAutoDesc:'Automatically configures SMBIOS data (Manufacturer, Product, Serial) for new VMs and VMs without SMBIOS configuration. Useful for Windows licensing.',deploySmbiosConfirm:'Deploy SMBIOS Auto-Config to all nodes in this cluster?',rescanAllVms:'Rescan all VMs',showLogs:'Show logs',deployToAllNodes:'Deploy to All Nodes',updateAllNodes:'Update All Nodes',nodeStatus:'Node Status',clickDeployToStart:'Click "Deploy to All Nodes" to get started',smbiosRequiresSSH:'âš ï¸ Requires SSH key configured in cluster connection settings',whySSH:'Why SSH?',smbiosSSHExplanation:'This feature uses SSH to deploy hook scripts to nodes. SSH credentials can be optionally configured in cluster settings.',deployed:'Deployed',notDeployed:'Not Deployed',requiresSSH:'Requires SSH',deploymentFailed:'Deployment failed',clusterNodes:'Cluster Nodes',joinInformation:'Join Information',datacenterOptions:'Datacenter Options',quorate:'Quorate',votes:'Votes',link:'Link',resourceUsage:'Resource Usage',memory:'Memory',// Storage
addStorage:'Add Storage',storageId:'Storage ID',directory:'Directory',path:'Path',server:'Server',content:'Content',shared:'Shared',deleteStorageConfirm:'Really delete storage?',deleteBackupJobConfirm:'Really delete backup job?',storageType:'Storage Type',volumeGroup:'Volume Group',thinPool:'Thin Pool',export:'Export',share:'Share',datastore:'Datastore',pool:'Pool',portal:'Portal',skipCertVerification:'Skip Certificate Verification',// Backup
backupJobs:'Backup Jobs',noBackupJobs:'No Backup Jobs',createBackupJob:'Create Backup Job',selectStorage:'Select Storage',allNodes:'All Nodes',hourly:'Hourly',daily:'Daily (02:00)',weekly:'Weekly (Sunday 02:00)',monthly:'Monthly (1st of month 02:00)',compression:'Compression',notification:'Notification',always:'Always',onFailure:'On Failure',never:'Never',schedule:'Schedule',selection:'Selection',retention:'Retention',// Replication
replicationJobs:'Replication Jobs',noReplicationJobs:'No Replication Jobs',guest:'Guest',job:'Job',// Firewall
firewallOptions:'Firewall Options',firewallRules:'Firewall Rules',noFirewallRules:'No Firewall Rules',policyIn:'Policy In',policyOut:'Policy Out',addRule:'Add Rule',deleteRuleConfirm:'Really delete rule?',action:'Action',protocol:'Protocol',confirmDeleteRule:'Delete this firewall rule?',addFirewallRule:'Add Firewall Rule',aliases:'Aliases',noAliases:'No aliases configured',noIpsets:'No IP sets configured',firewallLog:'Firewall Log',noLogEntries:'No log entries',fwEnable:'Firewall',fwDhcp:'DHCP',fwNdp:'NDP',fwRadv:'Router Adv.',fwMacFilter:'MAC Filter',fwLogLevel:'Log Level In',fwLogLevelOut:'Log Level Out',fwAddAlias:'Add Alias',fwAddIpset:'Add IP Set',// Ceph
ceph:'Ceph',cephStatus:'Ceph Status',cephHealth:'Cluster Health',cephCapacity:'Capacity',cephOsds:'OSDs',cephMons:'Monitors',cephPools:'Pools',cephMds:'Metadata Servers',cephFs:'CephFS',cephCreatePool:'Create Pool',cephCreateMon:'Create Monitor',cephNotInstalled:'Ceph Not Installed',cephNotInstalledDesc:'No Ceph cluster has been configured on this Proxmox cluster.',cephNotInstalledOnNode:'Ceph is not configured on this node.',cephInstallHint:'To set up Ceph, open a node and use the Ceph tab to initialize.',cephInit:'Initialize Ceph',// Settings
balancingConfig:'Balancing Configuration',migrationThreshold:'Migration Threshold',migrationThresholdDesc:'Score difference that triggers a migration',checkInterval:'Check Interval',checkIntervalDesc:'Interval between balance checks',autoMigrate:'Automatic Migration',autoMigrateDesc:'Automatic VM migration on imbalance',dryRun:'Dry Run Mode (no real migrations)',dryRunDesc:'Only simulate migrations, do not execute',balancingEnabled:'Balancing enabled',optionsTitle:'Options',intervalBetweenChecks:'Interval between balance checks',// HA
highAvailability:'High Availability (HA)',haEnabled:'High Availability enabled',haMonitoring:'HA Monitoring',haMonitorActive:'HA Monitor active',fallbackHosts:'Fallback Hosts',fallbackHostsAuto:'Fallback Hosts (auto-detected)',proxmoxHa:'Proxmox HA',proxmoxNativeHa:'Proxmox Native HA',haGroups:'HA Groups',haResources:'HA Resources',fencing:'Fencing',haInactive:'Proxmox HA inactive',haActivate:'Activate HA',enableNativeHa:'Enable native Proxmox HA for this VM',haMonitorDesc:'Monitors nodes every 10 seconds. On failure, VMs are automatically restarted on other nodes.',nativeHaDesc:'Native Proxmox HA runs directly on the cluster and provides Fencing & Quorum.',vmsWithHa:'VMs/CTs with Proxmox HA',noVmsWithHa:'No VMs configured with Proxmox HA. Enable HA for individual VMs in the detail view.',removeFromHa:'Remove from HA',deleteCannotBeUndone:'This action cannot be undone!',purgeDisks:'Purge - Delete all disks completely',destroyUnreferencedDisks:'Delete unreferenced disks',enterToConfirm:'Enter to confirm',deletePermanently:'Delete permanently',updateNode:'Update Node',updateCommand:'Will run apt update && apt dist-upgrade.',rebootAfterUpdate:'Reboot after update',recommendedForKernel:'Recommended for kernel updates',startUpdate:'Start Update',started:'started',stopped:'stopped',restarted:'restarted',created:'created',deleted:'deleted',cloned:'cloned',migrated:'migrated',vmStillRunning:'The VM is still running. It will be stopped before deletion.',ctStillRunning:'The container is still running. It will be stopped before deletion.',primary:'Primary',fallbacks:'Fallbacks',// Messages
connectionError:'Connection Error',// Task Bar
tasks:'Tasks',taskMigrate:'Migration',taskStart:'Start',taskStop:'Stop',taskReboot:'Reboot',taskCreate:'Create',taskDelete:'Delete',taskClone:'Clone',taskSnapshot:'Snapshot',taskDiskMove:'Move Disk',taskDiskResize:'Resize Disk',taskFailed:'Task failed',taskCancelled:'Task cancelled',taskCancelFailed:'Failed to cancel task',cancelTask:'Cancel task',allTasks:'All Tasks',runningTasks:'Running Tasks',failedTasks:'Failed Tasks',todaysTasks:'Today\'s Tasks',tasksShown:'tasks shown',taskOutput:'Task Output',errorLoadingLog:'Error loading log',duration:'Duration',description:'Description',clearCompleted:'Clear completed',startTime:'Start Time',endTime:'End Time',output:'Output',noOutput:'No output',noTasks:'No tasks available',completed:'completed',success:'Success',error:'Error',unsavedChanges:'Unsaved Changes',discardUnappliedChanges:'Discard all unapplied changes?',migrationStarted:'Migration started',configSaved:'Configuration saved',operationFailed:'Operation failed',confirmAction:'Confirm Action',// Misc
lastCheck:'Last Check',clusterInfo:'Cluster Info',primaryHost:'Primary Host',connectedTo:'Connected to',fallback:'Fallback',configured:'configured',noRestrictions:'No restrictions',general:'General',advanced:'Advanced',os:'Operating System',template:'Template',help:'Help',lastMigrations:'Last Migrations',noMigrations:'No migrations',// Options labels
keyboardLayout:'Keyboard Layout',httpProxy:'HTTP Proxy',consoleViewer:'Console Viewer',emailFrom:'Email From',macPrefix:'MAC Prefix',migrationSettings:'Migration Settings',replicationSettings:'Replication Settings',haSettings:'HA Settings',haSettingsSaved:'HA settings saved',haEnabled:'HA enabled',haDisabled:'HA disabled',haActive:'HA Active',haInactive:'HA Inactive',clusterType:'Cluster Type',quorum:'Quorum',quorumYes:'Yes',quorumNo:'No',healthy:'Healthy',degraded:'Degraded',critical:'Critical',splitBrainPrevention:'Split-Brain Prevention',splitBrainInfo:'In 2-node clusters, "split-brain" can occur when both nodes think the other is dead. Quorum hosts are pinged to decide which node may act.',splitBrainTip:'Use IPs that both nodes can reach (gateway, DNS servers, or external IPs). For internal networks without internet: Use your router/gateway as quorum host.',quorumSettings:'Quorum Settings',enableQuorumCheck:'Enable Quorum Check',quorumCheckDesc:'Prevents split-brain through external reachability check',gatewayIp:'Gateway IP',gatewayIpHint:'Your router/gateway for local networks',requiredVotes:'Required Votes',additionalQuorumHosts:'Additional Quorum Hosts (comma-separated)',quorumHostsHint:'For isolated networks: Own DNS servers, routers, or other stable hosts in the network',selfFencingRecovery:'Self-Fencing & Recovery',selfFencing:'Self-Fencing',selfFencingDesc:'Node without quorum will not start VMs',networkCheck:'Network Check',networkCheckDesc:'Checks connectivity before recovery',recoveryDelay:'Recovery Delay (seconds)',recoveryDelayHint:'Wait time before VMs are started on another node',failureThreshold:'Failure Threshold',failureThresholdHint:'Number of failed checks before node is considered offline',hardwareWatchdog:'Hardware Watchdog',watchdogWarning:'CAUTION: Node will automatically reboot on quorum loss!',// Fencing Explanation - NS Jan 2026
fencingExplanation:'How Split-Brain is Prevented',fencingStep1Title:'1. Quorum Loss Detection',fencingStep1Desc:'The isolated node loses quorum (< 50% votes) and /etc/pve becomes READ-ONLY. The pve-ha-lrm automatically stops all HA VMs.',fencingStep2Title:'2. Self-Fencing (Self-Isolation)',fencingStep2Desc:'The node recognizes it is isolated and refuses VM operations. This prevents two instances of the same VM running simultaneously.',fencingStep3Title:'3. Watchdog (Hardware Timer)',fencingStep3Desc:'If enabled: A hardware/software timer is regularly reset. On quorum loss, the reset stops and the node is hard-rebooted after ~60s.',fencingStep4Title:'4. External Fencing (STONITH)',fencingStep4Desc:'Optional hardware: IPMI/iLO/iDRAC or PDU powers off the node before VMs are started on another node.',fencingWarning:'IMPORTANT: Without fencing mechanism, split-brain can cause data corruption!',fencingRecommendation:'Recommendation for 2-Node Clusters:',fencingRecList:'â€¢ Configure quorum hosts (gateway, DNS server)\nâ€¢ Enable hardware watchdog if available\nâ€¢ Set recovery delay to at least 30 seconds',enableHA:'Enable HA',disableHA:'Disable HA',changesAfterRestart:'Changes active after restart',important2NodeCluster:'important for 2-node clusters!',online:'Online',// 2-Node Cluster Mode - NS Jan 2026
twoNodeMode:'2-Node Cluster Mode',twoNodeWarning:'2-Node Cluster Limitation',twoNodeExplanation:'In a 2-node Proxmox cluster, when one node fails, the surviving node loses quorum and cannot start VMs. This mode allows PegaProx to automatically force quorum on the surviving node.',enableTwoNodeMode:'Enable 2-Node Cluster Mode',enableTwoNodeModeDesc:'Automatically force quorum when one node fails',twoNodeReady:'Ready for 2-Node HA',twoNodeCredentialsInfo:'PegaProx will use the cluster credentials to SSH into the surviving node and run "pvecm expected 1" to restore quorum.',twoNodeTip:'Tip',twoNodeTipText:'For best results, install "sshpass" on the PegaProx server: apt install sshpass',// Split-Brain Risk - 2-Node - NS Jan 2026
splitBrainRisk:'Split-Brain Risk Without Fencing!',splitBrainRiskDesc:'If both nodes are alive but network between them fails, forcing quorum can cause BOTH nodes to run the same VM = data corruption!',safeSolutions:'Safe solutions for 2-Node clusters:',qdeviceDesc:'Add a 3rd vote (Raspberry Pi is enough!)',ipmiDesc:'Power off the other node before recovery',pduDesc:'Smart power strip to cut power remotely',quorumHostsDesc2:'External IPs to determine which node is isolated',safetyChecklist:'Safety Checklist',quorumHostsConfigured:'Quorum hosts configured',recoveryDelayCheck:'Recovery delay â‰¥ 30 seconds',selfFencingEnabled:'Self-fencing enabled',// Storage-based Split-Brain Protection - NS Jan 2026
storageHeartbeat:'Storage-based Split-Brain Protection',recommendedFor2Node:'Recommended for 2-Node Clusters!',storageHeartbeatDesc:'Uses shared storage (NFS/Ceph/iSCSI) to coordinate between nodes. If a node fails to write heartbeats, it is confirmed dead. A "poison pill" mechanism tells the isolated node to stop its VMs before recovery starts.',enableStorageHeartbeat:'Enable Storage-based Heartbeat',enableStorageHeartbeatDesc:'Write heartbeats to shared storage for node health verification',storageHeartbeatPath:'Shared Storage Path',storageHeartbeatPathHint:'Path to shared storage accessible by all nodes (e.g., Ceph, NFS, iSCSI)',heartbeatTimeout:'Heartbeat Timeout (s)',heartbeatTimeoutHint:'Node dead if no heartbeat for this long',poisonPillEnabled:'Enable Poison Pill Mechanism',poisonPillDesc:'Tell isolated node to stop VMs via storage before recovery',strictFencing:'Strict Fencing Mode',strictFencingDesc:'ABORT recovery if node cannot be confirmed dead (safer but may cause false positives)',howItWorks:'How it works',step1Heartbeat:'PegaProx writes heartbeats to shared storage every 5 seconds',step2Check:'When a node fails, storage heartbeat is checked to confirm death',step3Poison:'A "poison pill" file is written telling the other node to stop VMs',step4Recovery:'Only after confirmation/timeout does recovery proceed',nodeAgentRequired:'Node Agent Required!',nodeAgentRequiredDesc:'For this feature to work, you need to install the PegaProx Node Agent on each Proxmox node. The agent writes heartbeats and responds to poison pills.',// Automatic Split-Brain Protection - NS Jan 2026 - FULLY AUTOMATIC
splitBrainProtection:'Split-Brain Protection',fullyAutomatic:'100% AUTOMATIC',autoProtectionExplain:'PegaProx automatically discovers shared storage, installs node agents, and protects against split-brain - no configuration needed!',sharedStoragesFound:'Shared Storages Found:',inUse:'IN USE',fullProtectionActive:'Full dual-network protection active',nodeAgentsInstalled:'Node agents auto-installed',heartbeatsViaStorage:'Heartbeats via storage network',sshOnlyMode:'SSH-Only Protection Mode',noSharedStorageFound:'No shared storage (NFS/CephFS) found. Protection works via SSH verification.',notSafeForDualNetwork:'Not safe for dual-network setups (separate server/storage networks)',// Block Storage Warning - NS Jan 2026
blockStorageOnly:'Only Block Storage Found',blockStorageExplain:'Block storage (LVM, iSCSI, RBD) cannot store heartbeat files. For full dual-network protection, add a small NFS share.',sshOnlyActive:'SSH-Only Protection Active',sshOnlyRisk:'Works for single-network. For dual-network (separate server/iSCSI), add a small NFS share (100MB is enough).',// Multiple Storages - NS Jan 2026
clickToSelect:'Click to select',selected:'Selected',currentlyActive:'Currently active',blockStoragesIgnored:'Block storages (not usable)',// Self-Fence Protection - NS Jan 2026
selfFenceProtection:'Self-Fence Protection',advancedSettings:'Advanced Settings',selfFenceExplain:'Each node checks if it can reach the manager OR another node. If nobody reachable â†‘ node is isolated â†‘ stops its own VMs.',howItWorks:'How it works',nodeCanReachSomeone:'Node can reach someone',everythingOk:'Everything OK, do nothing',nodeCanReachNoone:'Node can reach NOBODY',nodeStopsOwnVms:'Isolated! Stops own VMs',selfFenceActive:'Self-Fence Protection Active',agentInstalledOnNodes:'Agent installed on',allNodes:'all nodes',selfFenceNotInstalled:'Self-Fence Agent not installed',selfFenceInstallHint:'Click the button to install the agent on all nodes. The agent checks reachability every 5 seconds.',installSelfFenceAgent:'Install Self-Fence Agent',selfFenceInstalling:'Installing agent...',noSharedStorageNeeded:'No shared storage needed',worksWithLvmIscsi:'Works with LVM, iSCSI, anything',nodeDecidesItself:'Node decides itself = fast reaction',uninstall:'Uninstall',confirmUninstallAgent:'Really uninstall Self-Fence Agent from all nodes?',selfFenceUninstalling:'Uninstalling agent...',enable2NodeMode:'Enable 2-Node Cluster Mode',twoNodeModeDesc:'Automatically force quorum when one node fails',// Legacy translations (kept for compatibility)
autoSplitBrainProtection:'Automatic Split-Brain Protection',noSetupRequired:'NO SETUP REQUIRED',autoProtectionDesc:'PegaProx automatically prevents split-brain using your existing SSH credentials.',sshSucceeds:'SSH succeeds:',networkSplitDetected:'Network split! VMs stopped on partitioned node first',sshFails:'SSH fails:',nodeConfirmedDead:'Node confirmed dead, safe to failover',advancedOptions:'Advanced Options',dualNetworkWarning:'Dual-Network Setup? (Server + iSCSI)',dualNetworkProblem:'If server network fails but iSCSI is up, SSH fails but node still writes to storage = DATA CORRUPTION!',enableDualNetworkProtection:'Enable Storage-based Protection',dualNetworkProtectionDesc:'Requires: PegaProx server can mount the shared storage (NFS/CephFS)',sharedStoragePath:'Shared Storage Path',agentAutoInstall:'Node agent will auto-install via SSH',// Device Passthrough
devicePassthrough:'Device Passthrough',pciDevices:'PCI Devices',usbDevices:'USB Devices',serialPorts:'Serial Ports',addPci:'Add PCI',addUsb:'Add USB',addSerial:'Add Serial',noPciDevices:'No PCI Devices',noUsbDevices:'No USB Devices',noSerialPorts:'No Serial Ports',availableDevices:'Available Devices',selectDevice:'Select device',pcie:'PCIe (recommended)',romBar:'ROM-Bar',usb3:'USB 3.0',serialType:'Type',socketConsole:'Socket (Unix Socket Console)',deviceAdded:'Device added',deviceRemoved:'Device removed',iommuGroup:'IOMMU Group',vendor:'Vendor',adding:'Adding...',bandwidthLimits:'Bandwidth Limits',maxWorkers:'Max Workers',nextVmid:'Next VMID',userTagAccess:'User Tag Access',registeredTags:'Registered Tags',// Subscription
subscriptionStatus:'Subscription Status',licensed:'Licensed',notLicensed:'Not Licensed',product:'Product',licenseKey:'License Key',validUntil:'Valid Until',supportLevel:'Support Level',noActiveSubscription:'No Active Subscription',noSubscriptionDesc:'This node has no valid Proxmox VE subscription. Without a subscription you will not receive enterprise updates or support.',enterLicenseKey:'Enter License Key',subscriptionKey:'Subscription Key',pleaseEnterLicenseKey:'Please enter license key',licenseActivated:'License activated successfully!',activationFailed:'Activation failed',activateLicense:'Activate License',refreshStatus:'Refresh Status',subscriptionBenefits:'A Proxmox VE Subscription provides',subscriptionBenefit1:'Access to Enterprise Repository with stable updates',subscriptionBenefit2:'Technical support from Proxmox',subscriptionBenefit3:'No subscription warning on login',// Maintenance
maintenanceModeTitle:'Enable Maintenance Mode',maintenanceWarning:'Warning: All running VMs and containers on this node will be automatically migrated to other nodes.',maintenanceDesc:'The node will be excluded from load balancing until maintenance mode is disabled.',startMaintenance:'Start Maintenance',removeNodeFromCluster:'Remove Node from Cluster',moveNodeToCluster:'Move Node to another Cluster',targetCluster:'Target Cluster',removeNodeWarning:'The node will be permanently removed from the cluster. All VMs must be migrated first.',removeNodeConfirm:'Remove Node',removeNodeTypeName:'Type node name to confirm',ready:'Ready',completedWithErrors:'Completed (with errors)',evacuating:'Evacuating...',failed:'Failed',starting:'Starting...',progress:'Progress',migrating:'Migrating',vmsCouldNotMigrate:'VM(s) could not be migrated',migrationIncomplete:'Migration Incomplete',someVmsOnLocalStorage:'Some VMs could not be migrated, likely due to local storage. You can:',proceedWithCaution:'Proceed anyway (VMs will be stopped during reboot)',exitAndMigrateManually:'Exit maintenance and migrate manually',forceMaintenanceWarning:'âš ï¸ WARNING: Proceeding will stop the remaining VMs on this node during reboot. Continue?',proceedAnyway:'Proceed Anyway',failedToMigrate:'Failed to migrate',vmsWillBeStopped:'VM(s) will be stopped during reboot',updating:'Updating',nodeConfiguration:'Node Configuration',rebootNode:'Reboot Node',shutdownNode:'Shutdown Node',rebootNodeWarning:'The node will be rebooted. Since it is in maintenance mode, no VMs are affected.',shutdownNodeWarning:'The node will be shut down. You will need to power it on manually!',rebootNow:'Reboot Now',shutdownNow:'Shutdown Now',updateAndReboot:'Update & Reboot',sudoNotAvailable:'sudo is not available on this node',nodeActionFailed:'Node action failed',startingUpdateFor:'Starting update for',updateStartedFor:'Update started for',errorStartingUpdate:'Error starting update',rebootInitiated:'reboot initiated',shutdownInitiated:'shutdown initiated',updateRunning:'Update running',updateFailed:'Update failed',failedNodes:'Failed Nodes',maintenanceModeWarning:'Some nodes may still be in maintenance mode. Check the Nodes tab and exit maintenance mode manually if needed.',viewLogs:'View Logs',updateCompleted:'Update completed!',packagesUpdated:'packages updated.',waitingForNode:'Waiting for node...',done:'Done',cancelAndExitMaintenance:'Cancel & exit maintenance mode',sshSettings:'SSH Settings',sshSettingsDesc:'Required for node updates, reboot, and shutdown. If empty, Proxmox user/password will be used.',sshKeyOptional:'SSH Key (Optional)',sshKeyExplanation:'SSH features (SMBIOS Auto-Config, Custom Scripts, 2-Node HA) use your login credentials automatically. Only add a key here if password authentication is disabled on your nodes.',sshUser:'SSH User',sshPort:'SSH Port',sshPrivateKey:'SSH Private Key',sshKeyHint:'Paste your private key here (id_rsa, id_ed25519, etc.)',sshKeyRequired:'SSH key required. Please configure in cluster settings.',balanceContainers:'Balance Containers',balanceLocalDisks:'Balance VMs with Local Disks',balanceLocalDisksDesc:'VMs with local disks will be migrated with --with-local-disks (copies data to target)',localDiskBalanceWarning:'Migration of VMs with local disks copies all disk data to the target node. This can take a long time and significantly increases network load.',containerBalanceWarning:'Containers can NOT be live migrated! Migration will stop and restart the container, causing downtime.',clusterSettings:'Cluster Settings',clusterSettingsDesc:'Configure balancing settings for each cluster.',clusterSettingsSaved:'Cluster settings saved',noClustersConfigured:'No clusters configured',collapse:'Collapse',threshold:'Threshold',interval:'Interval',saveSettings:'Save Settings',haEnabled:'HA Enabled',// Common notifications
connectionError:'Connection error',saveFailed:'Save failed',deleteError:'Delete error',activationError:'Activation error',deactivationError:'Deactivation error',bulkMigrationNote:'Migrations will be performed sequentially. This may take some time.',deleteFailed:'Delete failed',uploadFailed:'Upload failed',uploadFailedNetwork:'Upload failed - network error',createFailed:'Create failed',configSaved:'Configuration saved',failedToSaveSettings:'Failed to save settings',failedToUnlockIp:'Failed to unlock IP',failedToUnlockAllIps:'Failed to unlock all IPs',snapshotFailed:'Snapshot failed',rollbackFailed:'Rollback failed',replicationCreated:'Replication created',replicationDeleted:'Replication deleted',replicationStarted:'Replication started',startFailed:'Start failed',unlockVm:'Unlock VM',vmLocked:'VM is locked',vmUnlocked:'VM unlocked',// Security Settings
securitySettings:'Security Settings',securityDashboard:'Security Dashboard',issuesFound:'issues found',allSecure:'All systems secure',securityUpdates:'Security Updates',bannedIps:'Banned IPs',securityIssues:'Security Issues',recommendations:'Recommendations',enableClusterFirewall:'Enable cluster-wide firewall',installSecurityUpdates:'Install pending security updates',enable2fa:'Enable two-factor authentication',disableRootLogin:'Disable SSH root login',clusterFirewall:'Cluster Firewall',nodeFirewalls:'Node Firewalls',rules:'rules',noSecurityUpdates:'No security updates pending',systemUpToDate:'All systems are up to date',sshConfiguration:'SSH Configuration per Node',activeJails:'Active Jails',totalBanned:'Total Banned',installed:'Installed',notInstalled:'Not Installed',optional:'Optional',refreshSecurityAudit:'Refresh Security Audit',analyzingSecurity:'Analyzing security...',bruteForceProtection:'Brute Force Protection',bruteForceProtectionDesc:'Configure login attempt limits and lockout durations to block unauthorized access attempts',loginProtection:'Login Protection',passwordPolicy:'Password Policy',minPasswordLength:'Minimum Length',requireUppercase:'Uppercase',requireLowercase:'Lowercase',requireNumbers:'Numbers',requireSpecial:'Special chars',sessionTimeout:'Session Timeout',hours:'hours',days:'days',securityRecommendations:'Security Recommendations',securityRecommendationsDesc:'Suggestions to improve PegaProx security',httpsEnabled:'Connection is encrypted',httpsDisabled:'Consider enabling HTTPS for secure connections',sessionTimeout:'Session Timeout',currentlySetTo:'Currently set to',adminAccounts:'Admin Accounts',adminAccountsActive:'admin account(s) active',defaultCredentials:'Default Credentials',noDefaultPassword:'No default passwords detected',defaultPasswordWarning:'Default admin password is still in use!',lockAfter:'Lock after',failedAttempts:'failed attempts',auditLogging:'Audit Logging',auditLoggingEnabled:'All actions are logged for security',secure:'Secure',recommended:'Recommended',good:'Good',considerLowering:'Consider lowering',reviewRecommended:'Review recommended',actionRequired:'Action Required',maxLoginAttempts:'Max Login Attempts',maxLoginAttemptsDesc:'Number of failed attempts before lockout',lockoutTime:'Lockout Time',attemptWindow:'Attempt Window',lockedIps:'Locked IPs',noLockedIps:'No IPs locked',unlockAll:'Unlock All',unlockAllConfirm:'Really unlock all IPs?',allIpsUnlocked:'All IPs unlocked',unlock:'Unlock',unlocked:'unlocked',locked:'locked',attempts:'attempts',remaining:'remaining',// About page translations
about:'About',developmentTeam:'Development Team',creditsAcknowledgments:'Credits & Acknowledgments',links:'Links',// update Manager
updateManager:'Update Manager',updateManagerDesc:'Check and install updates on all cluster nodes',checkForUpdates:'Check for Updates',checkingUpdates:'Checking updates...',updatesAvailable:'Updates available',noUpdatesAvailable:'No updates available',packagesAvailable:'packages available',securityUpdates:'Security updates',lastChecked:'Last checked',neverChecked:'Never checked',startRollingUpdate:'Start Rolling Update',updateThisNode:'Update this Node',rebootRequired:'Reboot required for kernel',package:'Package',currentVersion:'Current',newVersion:'New',noUpdatesForNode:'This node is up to date',updateNode:'Update Node',updateNodeDesc:'This will run apt update && apt dist-upgrade on the node.',kernelUpdateDetected:'Kernel update detected',rebootRecommended:'A reboot is recommended to apply kernel changes.',rebootAfterUpdate:'Reboot after update',startUpdate:'Start Update',updateStarted:'Update started',updates:'updates',nodeNotInMaintenance:'Node is not in maintenance mode.',forceUpdateWarning:'Running VMs on this node may be affected if a reboot is performed.',continueAnyway:'Continue anyway?',rollingUpdateDesc:'Updates all nodes one by one. Each node is put into maintenance mode, VMs are migrated, updates are installed, and optionally rebooted.',rollingUpdateInProgress:'Rolling Update in Progress',currentlyUpdating:'Currently updating',waitingForReboot:'Waiting for reboot',nodesCompleted:'Nodes completed',nodesRemaining:'Nodes remaining',includeReboot:'Reboot after update',includeRebootHint:'Recommended for kernel updates',// PegaProx Auto-Update - NS Jan 2026
confirmUpdate:'This will download and install the update. A backup will be created. The server will restart automatically. Continue?',downloadingUpdate:'Downloading update...',installingUpdate:'Installing update...',serverRestarting:'Server restarting...',reconnecting:'Reconnecting...',updateSuccessRestarting:'Update installed! Server is restarting...',updateComplete:'Update complete! Please refresh the page.',alreadyUpToDate:'Already up to date!',installUpdate:'Install Update',updateAvailable:'Update Available!',newVersionAvailable:'New Version Available!',updateTo:'Update to',currentVersion:'Current version',viewUpdate:'View Update',later:'Later',whatsNew:"What's New",breakingChanges:'Breaking Changes',doNotCloseWindow:'Please do not close this window...',rollback:'Rollback',rollbackDesc:'Restore a previous version from backup',viewBackups:'View Backups',selectBackup:'Select Backup to Restore',noBackupsFound:'No backups found',confirmRollback:'This will restore PegaProx from backup. The server will restart. Continue?',restoringBackup:'Restoring from backup...',rollbackSuccess:'Rollback successful! Server is restarting...',rollbackWarning:'âš ï¸ Rollback will restart the server. Make sure you have saved any unsaved work.',// Security / Military Grade Encryption - NS Jan 2026
securityStatus:'Security Status',dataEncryption:'Data Encryption',passwordHashing:'Password Hashing',compliance:'Compliance',complianceStatus:'Compliance Status',auditLogIntegrity:'Audit Log Integrity',encryptionKey:'Encryption Key',corsConfiguration:'CORS Configuration',verifyIntegrity:'Verify Integrity',rotateKey:'Rotate Key',rotating:'Rotating...',recommendations:'Recommendations',totalEntries:'Total Entries',verified:'Verified',unsigned:'Unsigned (old)',tampered:'Potentially Tampered',algorithm:'Algorithm',keySize:'Key Size',lastRotation:'Last Rotation',backups:'Backups',allowedOrigins:'Allowed Origins',// IP Whitelisting
ipWhitelisting:'IP Whitelisting',enableIPWhitelist:'Enable IP Whitelist',ipWhitelistDesc:'Only allow access from specific IP addresses',yourIP:'Your current IP',whitelist:'Whitelist',blacklist:'Blacklist',allowedIPs:'Allowed IPs',blockedIPs:'Always Blocked',testIP:'Test IP Access',supportedFormats:'Supported formats',// Config Backup/Restore
configBackupRestore:'Configuration Backup & Restore',exportConfig:'Export Configuration',importConfig:'Import Configuration',includeUsers:'Include user accounts',includeSecrets:'Include passwords & secrets',includeAuditLog:'Include audit log',canBeLarge:'Can be large',sensitive:'Sensitive',downloadBackup:'Download Backup',exporting:'Exporting...',merge:'Merge',overwrite:'Overwrite',keepExisting:'Keep existing',replaceAll:'Replace all',restoreUsers:'Restore user accounts',notAdmin:'Excluding admin',dryRun:'Dry run',validateOnly:'Validate only, don\'t apply',selectBackupFile:'Select Backup File',importing:'Importing...',dryRunComplete:'Dry run complete - check results below',dryRunResults:'Dry Run Results',restoreComplete:'Configuration restored',restoreResults:'Restore Results',backupVersion:'Backup version',backupDate:'Backup date',backupDownloaded:'Encrypted backup downloaded',backupBy:'Created by',restored:'Restored',skipped:'Skipped',// Secure Backup
secureBackup:'Secure Backup',secureBackupDesc:'Backups are encrypted with AES-256-GCM. You must provide your password and a backup encryption password.',securityVerification:'Security Verification',exportSecurityDesc:'To create an encrypted backup, please verify your identity and set a backup password.',importSecurityDesc:'To restore a backup, please verify your identity and enter the backup password.',yourPassword:'Your Password',enterYourPassword:'Enter your account password',backupPassword:'Backup Password',backupPasswordPlaceholder:'Min. 8 characters - remember this!',confirmBackupPassword:'Confirm Backup Password',repeatBackupPassword:'Repeat backup password',backupPasswordMin8:'Backup password must be at least 8 characters',passwordsNoMatch:'Passwords do not match',backupPasswordRequired:'Backup password required',rememberBackupPassword:'Remember the backup password! Without it, you cannot restore the backup.',createBackup:'Create Backup',restoreBackup:'Restore Backup',restoreFromBackup:'Restore from Backup',validateBackup:'Validate Backup',backupFile:'Backup File',backupPasswordUsedWhenCreating:'Password used when creating backup',autoMigration:'Auto Migration',militaryGradeEncryption:'Military Grade Encryption',skipNode:'Skip node',retryNode:'Retry node',cancelRollingUpdate:'Cancel Rolling Update',confirmRollingUpdate:'Confirm Rolling Update',rollingUpdateWarning:'All nodes will be updated one by one. VMs will be migrated automatically.',skipUpToDate:'Skip up-to-date nodes',skipUpToDateHint:'Nodes without updates will be skipped',advancedOptions:'Advanced Options',evacuationTimeout:'Evacuation Timeout',evacuationTimeoutHint:'How long to wait for VMs to migrate before timeout',skipEvacuation:'Skip VM evacuation',skipEvacuationHint:'NOT RECOMMENDED - VMs stay on node during update',skipEvacuationWarning:'âš ï¸ Warning: VMs may crash if something goes wrong during the update!',scheduleUpdates:'Schedule Updates',enableAutoUpdate:'Enable Automatic Updates',autoUpdateDesc:'Automatically run rolling updates on schedule',updateDay:'Update Day',updateTime:'Update Time',serverTimezone:'Server timezone',autoUpdateInfo:'Nodes will be updated one by one. VMs will be automatically migrated. Up-to-date nodes will be skipped.',scheduleSaved:'Update schedule saved',scheduledFor:'Scheduled for',schedule:'Schedule',experimental:'EXPERIMENTAL',experimentalWarning:'Use with caution - this feature is currently experimental. Test in non-production environments first.',runOnce:'Run Once',recurring:'Recurring',runOnceInfo:'The update will run once at the scheduled time and then disable itself.',monday:'Monday',tuesday:'Tuesday',wednesday:'Wednesday',thursday:'Thursday',friday:'Friday',saturday:'Saturday',sunday:'Sunday',daily:'Daily',hour:'hour',hours:'hours',estimatedTime:'Estimated time',minutes:'minutes',updateHistory:'Update History',viewUpdateLog:'View Update Log',checkingForUpdates:'Checking for Updates',checkingNodes:'Checking nodes for available updates...',connectingToCluster:'Connecting to cluster...',processingResults:'Processing results...',// Repo management - MK
repoInfo:'Manage APT repositories for this node. Enable/disable repositories to control which packages are available.',repoProxmoxNotice:'Note: Due to Proxmox\'s switch to a new source format, the display may currently be inaccurate. We\'re working on it.',requiresSubscription:'Requires Subscription',detected:'Detected',notConfigured:'Not configured',repoWarning:'Mixing enterprise and no-subscription repositories is not recommended. After changing repositories, run "apt update" to refresh the package list.',noReposFound:'No repositories found',currentNode:'Current Node',currentStep:'Current Step',updateLogs:'Update Logs',started:'Started',// VM Detail buttons
console:'Console',configuration:'Configuration',// Config Modal
cpuCores:'CPU Cores',cpuLimit:'CPU Limit',memory:'Memory (RAM)',hardware:'Hardware',disks:'Disks',// Config Modal Tabs
mountIso:'Mount ISO',noIsoEject:'No ISO (eject)',device:'Device',target:'Target',cdrom:'CD-ROM',hardDisk:'Hard Disk',existingCdrom:'Existing CD-ROM drive',hardDiskNotAvailable:'Hard Disk - not available!',freeSlot:'Free Slot',mount:'Mount',eject:'Eject',addDisk:'Add Disk',freeSpace:'Free',notEnoughSpace:'Not enough space!',usedSpace:'Used',resize:'Resize',move:'Move',remove:'Remove',editDiskType:'Change Bus Type',changeDiskBusType:'Change Disk Bus Type',vmIsRunning:'VM is running',vmMustBeStopped:'VM must be stopped',vmMustBeStoppedForBusChange:'The VM must be stopped before changing the disk bus type. Please shut down the VM first.',currentDisk:'Current',diskBusWarning:'Changing the bus type requires the VM to be stopped. The guest OS may need driver updates.',selectNewBusType:'Select new bus type',scsiDesc:'Best performance with VirtIO SCSI controller',virtioDesc:'Legacy VirtIO, good performance',sataDesc:'Good compatibility, moderate performance',ideDesc:'Maximum compatibility, lowest performance',current:'Current',changeBusType:'Change Bus Type',saving:'Saving...',diskBusChanged:'Disk bus type changed',optionsWillBeRemoved:'The following options are not supported and will be removed',noDisksConfigured:'No disks configured',unusedDisks:'Unused Disks',unusedDisksDesc:'These disks are detached but still exist. You can reattach or delete them.',reattach:'Reattach',reattachDisk:'Reattach disk',selectBusType:'Select Bus Type',diskId:'Disk ID',nextAvailableId:'Next available ID for selected bus type',diskOptions:'Disk Options',ideLimitedOptions:'IDE has limited options available',preview:'Preview',attaching:'Attaching...',volume:'Volume',diskReattached:'Disk reattached',deleteUnusedDiskConfirm:'Permanently delete disk? This cannot be undone!',unusedDiskDeleted:'Unused disk deleted',deletePermanently:'Delete permanently',configLoadError:'Could not load configuration',networkInterfaces:'Network Interfaces',addNetwork:'Add Network',noNetworksConfigured:'No networks configured',networkDisconnected:'Network disconnected',disconnectNetwork:'Disconnect Network',disconnectNetworkHint:'Simulates an unplugged network cable',connectNetwork:'Connect Network',createSnapshot:'Create Snapshot',unknown:'Unknown',rollback:'Rollback',noSnapshots:'No snapshots available',createReplication:'Create Replication',replicationNeedsTwoNodes:'Replication requires at least 2 nodes in the cluster',lastSync:'Last Sync',neverSynced:'Never synced',syncNow:'Sync Now',noReplicationJobs:'No Replication Jobs',startOnBoot:'Start on Boot',protection:'Protection (prevent delete/modify)',kvmVirtualization:'KVM Hardware Virtualization',unprivilegedContainer:'Unprivileged Container',osType:'OS Type',other:'Other',hotplug:'Hotplug',hotplugHint:'Devices that can be added while VM is running',hotplugDisk:'Disk',hotplugNetwork:'Network',hotplugUsb:'USB',hotplugMemory:'Memory',hotplugCpu:'CPU',qemuGuestAgent:'QEMU Guest Agent',qemuGuestAgentHint:'Enables shutdown, freeze/thaw for snapshots',fstrim:'FSTRIM after Clone/Migration',fstrimHint:'Automatically run TRIM after clone',// More modals
optional:'optional',snapshotDescription:'Snapshot description...',saveRamState:'Save RAM state (Hibernate)',// NS: Feb 2026 - Efficient snapshot translations
spaceEfficientSnapshot:'Space-Efficient Snapshot',spaceEfficientSnapshots:'Space-Efficient Snapshots',snapshotMode:'Snapshot Mode',normalMode:'Standard (Proxmox)',efficientMode:'Space-Efficient (LVM COW)',spaceSavings:'Space Savings',normalSnapshotSize:'Normal Snapshot',efficientSnapshotSize:'Space-Efficient',guestAgentDetected:'Guest Agent detected (filesystem will be frozen)',noGuestAgent:'No Guest Agent (snapshot without FS freeze)',managedByPegaprox:'Managed by PegaProx (not visible in Proxmox)',vmMustBeStopped:'VM must be stopped for rollback',snapshotUsage:'Snapshot Usage',snapshotOverflow:'Snapshot almost full!',snapshotInvalidated:'Snapshot lost â€“ original data is safe',efficientSnapshotCreated:'Space-efficient snapshot created',efficientSnapshotDeleted:'Space-efficient snapshot deleted',efficientSnapshotRollback:'Rollback started',cowSnapshot:'COW',fsFrozen:'FS frozen',recommended:'Recommended',snapshotSizeGb:'Snapshot Size (GB)',create:'Create',createReplicationJob:'Create Replication Job',targetNode:'Target Node',rateLimit:'Rate Limit (MB/s)',unlimited:'Unlimited',comment:'Comment',commentPlaceholder:'e.g. DR replication',every5min:'Every 5 minutes',every15min:'Every 15 minutes',every30min:'Every 30 minutes',hourly:'Hourly',every2hours:'Every 2 hours',every4hours:'Every 4 hours',every6hours:'Every 6 hours',every12hours:'Every 12 hours',daily:'Daily (midnight)',size:'Size',enableFirewall:'Enable Firewall',editNetwork:'Edit Network',enableNuma:'Enable NUMA',viommu:'vIOMMU (Virtualized IOMMU)',viommuInfo:'Required for nested virtualization and certain passthrough scenarios',sockets:'Sockets',ballooningMinimum:'Ballooning Minimum',swap:'Swap',cpuType:'CPU Type',scsiController:'SCSI Controller',machineType:'Machine Type',machineTypePlaceholder:'e.g. q35 or i440fx (empty = default)',none:'None',compatible:'compatible',cache:'Cache',noCache:'No cache',default:'Default',unsafe:'unsafe',fastest:'fastest',discard:'Discard',ioThread:'IO Thread',ssdEmulation:'SSD Emulation',cores:'Cores',branding:'Branding',appName:'App Name',customLogo:'Custom Logo',logoHint:'PNG, SVG, or GIF recommended. Max 500KB.',logoUploaded:'Logo uploaded',logoUploadFailed:'Logo upload failed',logoDeleted:'Logo removed',remove:'Remove',upload:'Upload',thanksToSponsors:'Thanks to our Sponsors',sponsorSubtitle:'Supporting open source development',becomeSponsor:'Become a sponsor',madeWithLove:'Made with â¤ï¸ for the Proxmox community',settingsSaved:'Settings saved',saveError:'Error saving',dnsSaved:'DNS saved',hostsSaved:'Hosts saved',searchDomain:'Search Domain',dnsServer:'DNS Server',time:'Time',timezone:'Timezone',localTime:'Local Time',sslCertificates:'SSL Certificates',uploadCustomCert:'Upload Custom Certificate',issuer:'Issuer',valid:'Valid',expired:'Expired',noCertificates:'No certificates found',certificate:'Certificate',privateKey:'Private Key',certChainHint:'Can contain multiple certificates (chain)',restartPveproxyAfterUpload:'Restart pveproxy after upload',certAndKeyRequired:'Certificate and key required',certUploaded:'Certificate uploaded!',uploadCertificate:'Upload Certificate',deleteCertConfirm:'Delete custom certificate and revert to self-signed?',certDeleted:'Certificate deleted',deleteCustomCert:'Delete Custom Cert',syslogLatest:'Syslog (latest entries)',noLogEntries:'No log entries',datastore:'Datastore',datastores:'Datastores',esxiHosts:'ESXi Hosts',connectEsxi:'Connect ESXi Host',esxiHostname:'ESXi Hostname/IP',esxiUsername:'Username',esxiPassword:'Password',esxiConnected:'ESXi connected',esxiVms:'ESXi VMs',migrateToProxmox:'Import to Proxmox',esxiMigrationHint:'VM must be powered off on ESXi!',esxiMigrating:'Import in progress...',esxiMigrationStarted:'Import started',esxiDisconnect:'Disconnect',esxiNoVms:'No VMs on this ESXi host',esxiExperimental:'ESXi import uses native Proxmox feature (PVE 8.1+)',noEsxiHosts:'No ESXi hosts connected',fillAllFields:'Please fill all fields',confirmDisconnect:'Disconnect this ESXi host?',connect:'Connect',sharedStorage:'Shared Storage',selectStorage:'Select a storage to view contents',clickStorageToView:'Click on a storage to view its contents',storageEmpty:'This storage is empty',content:'Content',format:'Format',browse:'Browse',storageDrsDesc:'Automatically balance disk usage across shared storage',storageUsage:'Storage Usage',currentImbalance:'Current Imbalance',threshold:'Threshold',recommendations:'Recommendations',migrate:'Migrate',storageBalanced:'All storage is well balanced. No action needed.',experimentalFeature:'Experimental Feature',storageBalancingExperimental:'Storage Balancing is still experimental. We appreciate your feedback!',uploadIso:'Upload ISO',downloadFromUrl:'Download from URL',fromUrl:'From URL',isoUrl:'ISO URL',isoUrlHint:'Direct link to ISO file (http/https)',autoDetect:'Auto-detect from URL',startingDownload:'Starting download...',downloading:'Downloading...',downloadFailed:'Download failed',selectFile:'Select File',confirmDelete:'Confirm Delete',deleteConfirmText:'Are you sure you want to delete',createStorageCluster:'Create Storage Cluster',noStorageClusters:'No storage clusters configured',createStorageClusterHint:'Create a cluster to balance storage across multiple volumes',selectCluster:'Select a storage cluster',selectClusterToView:'Select a storage cluster to view balancing status',balancingThreshold:'Balancing Threshold',thresholdDesc:'Trigger balancing when imbalance exceeds this value',actionRecommended:'Action Recommended',balanced:'Balanced',storagesInCluster:'Storages in Cluster',addStorage:'+ Add Storage',clusterName:'Cluster Name',selectStorages:'Select Storages',minTwo:'min. 2',noSharedStorages:'No shared storages available',confirmDeleteCluster:'Delete this storage cluster?',minTwoStorages:'Minimum 2 storages required',needTwoStorages:'Need at least 2 storages',migrationStarted:'Migration started!',autoBalance:'Auto-Balance',autoBalanceActive:'Auto-Balance Active',autoBalanceDesc:'Disks will be automatically migrated when imbalance exceeds threshold. VMs with active snapshots/backups are skipped.',dryRunShort:'Dry Run',connecting:'Connecting...',needsRestart:'NEEDS RESTART',// NS: Alerts, Tasks, Tags, Affinity - Dec 2025
alerts:'Alerts',alertsDesc:'Email notifications when thresholds are exceeded',createAlert:'Create Alert',editAlert:'Edit Alert',alertName:'Alert Name',alertMetric:'Metric',alertThreshold:'Threshold',alertOperator:'Condition',alertTarget:'Target',alertTargetType:'Target Type',noAlerts:'No alerts configured',testEmail:'Send Test Email',testEmailSuccess:'Test email sent!',testEmailFailed:'Failed to send test email',enterEmailAddress:'Please enter an email address',saveSmtpSettings:'Save SMTP Settings',smtpSettingsSaved:'SMTP settings saved!',enableSmtpHint:'Enable SMTP to configure email settings',smtpHostRequired:'SMTP host is required',smtpFromEmailRequired:'From email address is required',emailRecipients:'Email Recipients',addRecipient:'Add Recipient',scheduledTasks:'Scheduled Tasks',scheduledTasksDesc:'Automate VM operations on a schedule',createTask:'Create Task',editTask:'Edit Task',taskName:'Task Name',taskAction:'Action',taskSchedule:'Schedule',scheduleType:'Schedule Type',scheduleTime:'Time',scheduleDay:'Day',noScheduledTasks:'No scheduled tasks',runNow:'Run Now',lastRun:'Last Run',hourly:'Hourly',daily:'Daily',weekly:'Weekly',monthly:'Monthly',tagsLabels:'Tags & Labels',tagsDesc:'Categorize and group VMs',createTag:'Create Tag',tagName:'Tag Name',tagColor:'Color',noTags:'No tags defined',assignedVms:'Assigned VMs',affinityRules:'Affinity Rules',customScripts:'Custom Scripts',scriptsDesc:'Run custom .sh or .py scripts on cluster nodes',newScript:'New Script',noScripts:'No scripts configured',scriptsInfo:'Create scripts to automate tasks across your cluster nodes',runScript:'Run Script',runScriptConfirm:'Run this script?',scriptStarted:'Script execution started',scriptDeleted:'Script deleted',scriptCreated:'Script created',scriptUpdated:'Script updated',scriptPermissions:'Script Permissions',scriptPermissionsDesc:'Scripts require SSH access to nodes. Configure SSH key in cluster settings.',scriptContent:'Script Content',targetNodes:'Target Nodes',scriptWarning:'Scripts run with SSH user permissions. Ensure scripts are safe before running.',passwordRequiredForScripts:'Password confirmation required for security',viewOutput:'View Output',noOutput:'No output available',output:'Output',affinityDesc:'Determine which VMs/CTs should run together or separately',createAffinityRule:'Create Rule',editAffinityRule:'Edit Rule',ruleName:'Rule Name',ruleType:'Rule Type',together:'Together (same host)',separate:'Separate (different hosts)',selectVms:'Select VMs',noAffinityRules:'No affinity rules',enforceRule:'Enforce Rule',enforceRuleHint:'Block migrations that would violate this rule',// Console Settings - NS Jan 2026
consoleSettings:'Console Ports',vncPort:'VNC Port',shellPort:'Shell Port',consolePortHint:'VNC for VM consoles, Shell for node terminals. Server restart required after changes!',nodeShellHint:'To access node shell or see detailed performance, use the Proxmox UI button above or connect directly to the node.',selfSignedCertWarning:'Self-signed Certificates',selfSignedCertHint:'VNC and Shell run on separate ports. With self-signed certificates, you need to accept them in your browser once.',openVncPort:'Open VNC Port',openShellPort:'Open Shell Port',certInstructions:'For self-signed certificates:',certStep1:'1. Open this link in a new tab:',certStep2:'2. Accept the certificate in your browser',certStep3:'3. Come back and try again',acceptCert:'Accept Certificate',openInProxmox:'Open in Proxmox',connectionError:'Connection Error',wsConnectionFailed:'WebSocket connection failed',checkServerLogs:'Check server logs for details',connectingWs:'Connecting WebSocket',wsConnected:'WebSocket connected, waiting for server...',ipFetchFailed:'Failed to fetch IP',smtpSettings:'SMTP Settings',smtpHost:'SMTP Server',smtpPort:'Port',smtpUser:'Username',smtpPassword:'Password',smtpFromEmail:'From Email',smtpFromName:'From Name',smtpTls:'Use TLS',smtpSsl:'Use SSL',alertCooldown:'Alert Cooldown (seconds)',migrationHistory:'Migration History',noMigrationHistory:'No migrations recorded',// LW: Password expiry settings
passwordExpiry:'Password Expiry',passwordExpiryDesc:'Force users to change their password after a specified number of days.',passwordExpiryHint:'Users receive email reminders at 14, 7, 3, and 1 day(s) before expiry. A warning banner is shown in the UI. SMTP must be configured for emails.',sendExpiryEmails:'Send email notifications when password is about to expire',expiryDays:'Password expires after',warningDays:'Warn users before',// LW: Password expiry banner
passwordExpired:'Your password has expired!',passwordExpiresIn:'Your password expires in {days} days',pleaseChangeNow:'Please change it now.',pleaseChangeSoon:'Please change it soon.',changePassword:'Change Password',dismissForNow:'Remind me later',// LW: Reset all passwords - Dec 2025
forcePasswordReset:'Force Password Reset',forcePasswordResetDesc:'Expire all user passwords immediately. Use after security incidents.',resetAllPasswords:'Reset All',confirmPasswordReset:'Confirm Password Reset',resetAllWarning:'This will force ALL users to change their passwords on next login. This action cannot be undone.',includeAdmins:'Include admin accounts',includeAdminsWarning:'Warning: You will also need to change your password!',includeAdminsInExpiry:'Include admin accounts',includeAdminsInExpiryDesc:'Admins will also need to change their passwords regularly',// Theme System - NS Jan 2026
appearance:'Appearance',themeDesc:'Choose a color theme for the interface',themeNote:'Theme changes are applied immediately and saved to your account.',chooseTheme:'Choose Your Theme',themePersonal:'Select a theme that suits your style. This setting is personal and only affects your account.',defaultTheme:'Default Theme',defaultThemeDesc:'Set the default theme for new users. Users can change their theme in My Profile.',currentDefault:'Current default',themeInProfile:'Change your theme in My Profile (click your username in the top right)',// UI Layout - LW Jan 2026
// LW: Feb 2026 - Layout Style (Modern vs Corporate)
layoutStyle:'Layout Style',layoutStyleDesc:'Choose between modern dashboard or corporate enterprise style.',layoutModern:'Modern',layoutModernDesc:'Dashboard with cards, animations and gradients',layoutCorporate:'Corporate (Experimental)',layoutCorporateDesc:'Classic enterprise style - experimental feature, still in development',breadcrumbAll:'All',// TaskBar Settings - NS Feb 2026
taskbarAutoExpand:'TaskBar Auto-Expand',taskbarAutoExpandDesc:'Automatically expand TaskBar when new tasks start',taskbarAutoExpandEnabled:'TaskBar auto-expand enabled',taskbarAutoExpandDisabled:'TaskBar auto-expand disabled',dragToResize:'Drag to resize',userColumnHint:'Shows PegaProx user if available, otherwise Proxmox user',// LW: Support Bundle translations - Feb 2026
support:'Support',supportBundle:'Support Bundle',supportBundleDesc:'Generate a diagnostic bundle containing logs, configuration, and system information for troubleshooting. Sensitive data (passwords, tokens, secrets) is automatically redacted.',bundleContents:'Bundle Contents',bundleSystemInfo:'System information (version, platform, Python)',bundleClusterStatus:'Cluster connection status',bundleAuditLogs:'Recent audit log entries (last 500)',bundleAppLogs:'Application logs (last 1000 lines)',bundleDbSchema:'Database schema and statistics',bundleServerSettings:'Server settings (passwords redacted)',bundleUserList:'User list (no sensitive data)',bundleRecentTasks:'Recent Proxmox tasks',bundleSseStats:'SSE/SSH connection statistics',generatingBundle:'Generating support bundle...',bundleDownloaded:'Support bundle downloaded successfully',bundleError:'Failed to generate support bundle',downloadBundle:'Download Support Bundle',bundleSize:'Typical size: 50-500 KB',supportResources:'Support Resources',reportIssue:'Report an Issue',discussions:'Discussions',documentation:'Documentation',releases:'Releases',quickSystemInfo:'Quick System Info',// MK: Storage Rescan translations - Feb 2026
rescan:'Rescan',rescanningStorage:'Rescanning storage...',storageRescanSuccess:'Storage rescan completed',storageRescanError:'Failed to rescan storage',rescanStorageTooltip:'Rescan storage to detect new LUNs/volumes',deepRescanningStorage:'Deep rescanning (with pvresize)...',rescanOptions:'Rescan Options',quickRescan:'Quick Rescan',quickRescanDesc:'Refresh storage status via API. Use for general status updates.',deepRescan:'Deep Scan',deepRescanDesc:'SSH-based SCSI rescan + multipath reconfigure + automatic pvresize. Use after LUN expansion or adding new LUNs.',deepRescanNote:'Requires SSH access to nodes',rescanStorage:'Rescan Storage',rescanStorageDesc:'Rescan storage to detect changes.',recommended:'Recommended',scanning:'Scanning...',themeChanged:'Theme changed to',themeChangeFailed:'Failed to save theme',uiLayout:'UI Layout',layoutDesc:'Choose between different interface layouts.',inventory:'Inventory',selectItem:'Select an item from the tree',summary:'Summary',monitor:'Monitor',configure:'Configure',console:'Console',snapshots:'Snapshots',snapshotsOverview:'Snapshot Overview',snapshotsCleanUp:'Cleanup',snapshotsDesc:'Overview of the oldest snapshots in this cluster',snapshotsHint:'Overview of the oldest snapshots over all guests within the cluster.',snapshotsType:'Type',snapshotsDate:'Created',snapshotsAge:'Age',snapshotsAction:'Action',noSnapshots:'No snapshots found'}};// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PegaProx - Contexts
// LanguageContext + AuthContext providers
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Language Context
// LW: Default is German (de) since thats what we use internally
const LanguageContext=createContext();function LanguageProvider({children}){// Persist language preference in localStorage
const[language,setLanguage]=useState(()=>{const saved=localStorage.getItem('pegaprox-language');return saved||'de';// German default
});// Translation function with English fallback
const t=useCallback(key=>{return translations[language]?.[key]||translations['en']?.[key]||key;},[language]);const changeLanguage=useCallback(lang=>{setLanguage(lang);localStorage.setItem('pegaprox-language',lang);});return/*#__PURE__*/React.createElement(LanguageContext.Provider,{value:{language,t,changeLanguage}},children);}function useTranslation(){return useContext(LanguageContext);}// Language Switcher Component
function LanguageSwitcher(){const{language,changeLanguage}=useTranslation();return/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1 bg-proxmox-dark rounded-lg p-1 border border-proxmox-border"},/*#__PURE__*/React.createElement("button",{onClick:()=>changeLanguage('de'),className:`flex items-center gap-1.5 px-2 py-1 rounded text-sm transition-all ${language==='de'?'bg-proxmox-orange text-white':'text-gray-400 hover:text-white'}`,title:"Deutsch (\xD6sterreich)"},/*#__PURE__*/React.createElement("span",{className:"text-base"},"\uD83C\uDDE6\uD83C\uDDF9"),/*#__PURE__*/React.createElement("span",{className:"hidden sm:inline"},"DE")),/*#__PURE__*/React.createElement("button",{onClick:()=>changeLanguage('en'),className:`flex items-center gap-1.5 px-2 py-1 rounded text-sm transition-all ${language==='en'?'bg-proxmox-orange text-white':'text-gray-400 hover:text-white'}`,title:"English"},/*#__PURE__*/React.createElement("span",{className:"text-base"},"\uD83C\uDDEC\uD83C\uDDE7"),/*#__PURE__*/React.createElement("span",{className:"hidden sm:inline"},"EN")));}// ============================================
// Authentication System
// NS: Simple session-based auth. Sessions stored server-side.
// Passwords hashed with bcrypt on backend.
// ============================================
const AuthContext=createContext();function AuthProvider({children}){const[user,setUser]=useState(null);// NS: Security fix - session cookie is HttpOnly (can't be stolen by XSS)
// But we also keep sessionId in memory for WebSocket auth (not in localStorage!)
const[sessionId,setSessionId]=useState(null);const[isAuthenticated,setIsAuthenticated]=useState(false);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[passwordExpiry,setPasswordExpiry]=useState(null);// LW: Track password expiration
const[requires2FASetup,setRequires2FASetup]=useState(false);// NS: Feb 2026 - Force 2FA setup
const[ldapEnabled,setLdapEnabled]=useState(false);// MK: Feb 2026 - LDAP available
const[oidcEnabled,setOidcEnabled]=useState(false);// NS: Feb 2026 - OIDC available
const[oidcButtonText,setOidcButtonText]=useState('Sign in with Microsoft');// Check session on mount
useEffect(()=>{checkSession();},[]);// check if session still valid (cookie is sent automatically)
const checkSession=async()=>{try{// Add cache-busting to prevent stale data
const r=await fetch(`${API_URL}/auth/check?t=${Date.now()}`,{credentials:'include',headers:{'Cache-Control':'no-cache, no-store, must-revalidate','Pragma':'no-cache'}});if(r&&r.ok){const d=await r.json();console.log('Session check response:',d);if(d.authenticated){setUser(d.user);setIsAuthenticated(true);// NS: Get session_id from response for WebSocket auth
if(d.session_id){setSessionId(d.session_id);}// LW: Store password expiry info if present
if(d.password_expiry){setPasswordExpiry(d.password_expiry);}// NS: Check if server requires 2FA setup
if(d.requires_2fa_setup){setRequires2FASetup(true);}else{setRequires2FASetup(false);}// NS: Apply user's theme or default
const userTheme=d.user?.theme||d.default_theme||'proxmoxDark';console.log('[Theme] checkSession - Server theme:',d.user?.theme,'Default:',d.default_theme,'Using:',userTheme);if(userTheme&&PEGAPROX_THEMES[userTheme]){applyTheme(userTheme);}}else{logout();}}else{// NS: Feb 2026 - Capture ldap_enabled from 401 response
try{const errData=await r.json();if(errData.ldap_enabled!==undefined)setLdapEnabled(errData.ldap_enabled);if(errData.oidc_enabled!==undefined){setOidcEnabled(errData.oidc_enabled);setOidcButtonText(errData.oidc_button_text||'Sign in with Microsoft');}}catch(e){}logout();}}catch(err){console.error('Session check failed:',err);console.log('err obj:',err);logout();}setLoading(false);};// -lw: Main login handler - supports 2FA flow
// TODO: add "remember me" checkbox somtime
const login=async(username,password,totpCode='')=>{setError(null);console.log('login attempt:',username);// tmp debug
try{const resp=await fetch(`${API_URL}/auth/login`,{method:'POST',credentials:'include',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password,totp_code:totpCode})});const data=await resp.json();// rate limit check
if(resp.status===429&&data.locked){setError(`${data.error}`);return{success:false,locked:true,retry_after:data.retry_after};}// 2fa required?
if(resp.ok&&data.requires_2fa){return{requires_2fa:true};}if(resp.ok&&data.success){setUser(data.user);setIsAuthenticated(true);// NS: Keep session_id in memory for WebSocket auth
if(data.session_id){setSessionId(data.session_id);}// NS: Feb 2026 - Check if force 2FA setup is required
if(data.requires_2fa_setup){setRequires2FASetup(true);}// NS: Apply user's theme (with fallback to default)
const userTheme=data.user?.theme||data.default_theme||'proxmoxDark';console.log('[Theme] Login - Server theme:',data.user?.theme,'Default:',data.default_theme,'Using:',userTheme);if(userTheme&&PEGAPROX_THEMES[userTheme]){applyTheme(userTheme);}// NS: Security warning for default password
if(data.security_warning==='DEFAULT_PASSWORD'){setTimeout(()=>{alert('âš ï¸ SECURITY WARNING!\n\nYou are using the default admin password.\nPlease change it immediately in Settings â†‘ Users!');},500);}return{success:true};}else{setError(data.error||'Login failed');return{success:false,error:data.error};}}catch(err){console.error('login err',err);setError('Connection error');return{success:false,error:'Connection error'};}};// LW: Update user preferences (theme, language, ui_layout)
const updatePreferences=async prefs=>{try{console.log('updatePreferences: Sending request with prefs:',prefs);const r=await fetch(`${API_URL}/user/preferences`,{method:'PUT',credentials:'include',headers:{'Content-Type':'application/json'},body:JSON.stringify(prefs)});console.log('updatePreferences: Response status:',r.status);if(r.ok){const data=await r.json();console.log('updatePreferences: Response data:',data);// Update user in state
setUser(currentUser=>{const updated={...currentUser,theme:data.theme,language:data.language,ui_layout:data.ui_layout,taskbar_auto_expand:data.taskbar_auto_expand};console.log('updatePreferences: Updated user state:',updated);return updated;});// Apply theme immediately AND save to localStorage
if(data.theme&&PEGAPROX_THEMES[data.theme]){applyTheme(data.theme);}return{success:true,data};}const errorData=await r.json().catch(()=>({}));console.error('updatePreferences: Request failed:',errorData);return{success:false,error:errorData.error};}catch(e){console.error('Failed to update preferences:',e);return{success:false,error:e.message};}};const logout=async()=>{try{await fetch(`${API_URL}/auth/logout`,{method:'POST',credentials:'include'// Cookie is sent automatically
});}catch(err){console.error('Logout request failed:',err);}setUser(null);setSessionId(null);setIsAuthenticated(false);};// NS: No more X-Session-ID header needed for fetch - cookies are automatic
// But sessionId is still available for WebSocket URLs
const getAuthHeaders=()=>{return{};// Empty - credentials: 'include' handles auth for fetch
};return/*#__PURE__*/React.createElement(AuthContext.Provider,{value:{user,sessionId,isAuthenticated,loading,error,login,logout,getAuthHeaders,isAdmin:user?.role==='admin',passwordExpiry,requires2FASetup,setRequires2FASetup,updatePreferences,ldapEnabled,oidcEnabled,oidcButtonText}},children);}function useAuth(){return useContext(AuthContext);}// LW: Feb 2026 - layout hook (reads from user preferences)
// returns layout type and convenience boolean for corporate mode
function useLayout(){const{user}=useAuth();const layout=user?.ui_layout||'modern';const isCorporate=layout==='corporate';// Set data-layout on body whenever layout changes
useEffect(()=>{document.body.setAttribute('data-layout',layout);},[layout]);return{layout,isCorporate};}// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PegaProx - Authentication
// LoginScreen component
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Login Screen Component
// LW: Keep this simple - first thing users see!
function LoginScreen(){const{t}=useTranslation();const{login,error,ldapEnabled,oidcEnabled,oidcButtonText}=useAuth();const[username,setUsername]=useState('');const[password,setPassword]=useState('');const[totpCode,setTotpCode]=useState('');const[loading,setLoading]=useState(false);const[showPassword,setShowPassword]=useState(false);const[requires2FA,setRequires2FA]=useState(false);const[oidcLoading,setOidcLoading]=useState(false);// NS: Feb 2026 - Handle OIDC callback (check URL for auth code on mount)
React.useEffect(()=>{const params=new URLSearchParams(window.location.search);const code=params.get('code');const state=params.get('state');if(code&&state){// We got redirected back from IdP with auth code
setOidcLoading(true);fetch(`${API_URL}/auth/oidc/callback`,{method:'POST',credentials:'include',headers:{'Content-Type':'application/json'},body:JSON.stringify({code,state})}).then(r=>r.json()).then(data=>{if(data.success){// Clear URL params and reload to authenticated state
window.history.replaceState({},'',window.location.pathname);window.location.reload();}else{setOidcError(data.error||'OIDC authentication failed');window.history.replaceState({},'',window.location.pathname);}}).catch(()=>{setOidcError('Network error during OIDC callback');}).finally(()=>setOidcLoading(false));}},[]);const[oidcError,setOidcError]=useState('');const handleOidcLogin=async()=>{setOidcLoading(true);setOidcError('');try{const res=await fetch(`${API_URL}/auth/oidc/authorize`,{credentials:'include'});const data=await res.json();if(data.auth_url){window.location.href=data.auth_url;}else{setOidcError(data.error||'Failed to get authorization URL');setOidcLoading(false);}}catch(e){setOidcError('Network error');setOidcLoading(false);}};const handleSubmit=async e=>{e.preventDefault();if(!username||!password)return;if(requires2FA&&!totpCode)return;setLoading(true);const result=await login(username,password,totpCode);if(result?.requires_2fa){setRequires2FA(true);}setLoading(false);};return/*#__PURE__*/React.createElement("div",{className:"min-h-screen bg-proxmox-darker flex items-center justify-center p-4"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-md"},/*#__PURE__*/React.createElement("div",{className:"text-center mb-8"},/*#__PURE__*/React.createElement("img",{src:"/images/pegaprox.png",alt:"PegaProx",className:"w-24 h-24 mx-auto mb-4 rounded-full object-cover shadow-lg shadow-orange-500/30",onError:e=>{// fallback to styled div if PNG not found
e.target.outerHTML='<div class="w-24 h-24 mx-auto mb-4 rounded-full bg-gradient-to-br from-proxmox-orange to-orange-600 flex items-center justify-center shadow-lg shadow-orange-500/30"><svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2" /></svg></div>';}}),/*#__PURE__*/React.createElement("h1",{className:"text-3xl font-bold text-white mb-2"},"PegaProx"),/*#__PURE__*/React.createElement("p",{className:"text-gray-400"},t('loginSubtitle'))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-2xl p-8 shadow-xl"},/*#__PURE__*/React.createElement("h2",{className:"text-xl font-semibold text-white mb-6"},requires2FA?t('twoFARequired'):t('loginTitle')),error&&/*#__PURE__*/React.createElement("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm"},error),/*#__PURE__*/React.createElement("form",{onSubmit:handleSubmit,className:"space-y-5"},!requires2FA?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-2"},t('usernameLabel')),/*#__PURE__*/React.createElement("input",{type:"text",value:username,onChange:e=>setUsername(e.target.value),className:"w-full px-4 py-3 bg-proxmox-dark border border-proxmox-border rounded-xl text-white placeholder-gray-500 focus:outline-none focus:border-proxmox-orange transition-colors",placeholder:"pegaprox",autoComplete:"username",autoFocus:true})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-2"},t('passwordLabel')),/*#__PURE__*/React.createElement("div",{className:"relative"},/*#__PURE__*/React.createElement("input",{type:showPassword?'text':'password',value:password,onChange:e=>setPassword(e.target.value),className:"w-full px-4 py-3 bg-proxmox-dark border border-proxmox-border rounded-xl text-white placeholder-gray-500 focus:outline-none focus:border-proxmox-orange transition-colors pr-12",placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",autoComplete:"current-password"}),/*#__PURE__*/React.createElement("button",{type:"button",onClick:()=>setShowPassword(!showPassword),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white"},showPassword?/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})):/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})))))):/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-2"},t('enter2FACode')),/*#__PURE__*/React.createElement("input",{type:"text",value:totpCode,onChange:e=>setTotpCode(e.target.value.replace(/\D/g,'').slice(0,6)),className:"w-full px-4 py-3 bg-proxmox-dark border border-proxmox-border rounded-xl text-white text-center text-2xl tracking-widest placeholder-gray-500 focus:outline-none focus:border-proxmox-orange transition-colors",placeholder:"000000",maxLength:6,autoFocus:true}),/*#__PURE__*/React.createElement("p",{className:"text-gray-400 text-sm mt-2 text-center"},t('scan2FACode'))),/*#__PURE__*/React.createElement("button",{type:"submit",disabled:loading||!username||!password,className:"w-full py-3 bg-proxmox-orange rounded-xl text-white font-semibold hover:bg-orange-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},loading?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),/*#__PURE__*/React.createElement("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})),t('loggingIn')):t('loginButton'))),oidcEnabled&&/*#__PURE__*/React.createElement("div",{className:"mt-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3 mb-4"},/*#__PURE__*/React.createElement("div",{className:"flex-1 h-px bg-proxmox-border"}),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 uppercase"},"or"),/*#__PURE__*/React.createElement("div",{className:"flex-1 h-px bg-proxmox-border"})),/*#__PURE__*/React.createElement("button",{onClick:handleOidcLogin,disabled:oidcLoading,className:"w-full flex items-center justify-center gap-3 px-4 py-2.5 bg-[#0078d4] hover:bg-[#106ebe] disabled:opacity-50 rounded-lg text-white font-medium text-sm transition-colors"},oidcLoading?/*#__PURE__*/React.createElement(Icons.Loader,{className:"w-5 h-5 animate-spin"}):/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",viewBox:"0 0 21 21",fill:"none"},/*#__PURE__*/React.createElement("path",{d:"M0 0h10v10H0z",fill:"#f25022"}),/*#__PURE__*/React.createElement("path",{d:"M11 0h10v10H11z",fill:"#7fba00"}),/*#__PURE__*/React.createElement("path",{d:"M0 11h10v10H0z",fill:"#00a4ef"}),/*#__PURE__*/React.createElement("path",{d:"M11 11h10v10H11z",fill:"#ffb900"})),oidcButtonText||'Sign in with Microsoft'),oidcError&&/*#__PURE__*/React.createElement("p",{className:"text-red-400 text-xs text-center mt-2"},oidcError)),ldapEnabled&&/*#__PURE__*/React.createElement("div",{className:"mt-3 flex items-center justify-center gap-2 text-xs text-gray-500"},/*#__PURE__*/React.createElement(Icons.Users,{className:"w-3 h-3"}),/*#__PURE__*/React.createElement("span",null,"LDAP / Active Directory enabled"))),/*#__PURE__*/React.createElement("div",{className:"flex justify-center mt-6"},/*#__PURE__*/React.createElement(LanguageSwitcher,null)),/*#__PURE__*/React.createElement("p",{className:"text-center text-gray-500 text-sm mt-6"},"PegaProx Cluster Management ",PEGAPROX_VERSION)));}// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PegaProx - Icons
// SVG icon components (Heroicons)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Icons - mostly from Heroicons, some custom ones -- MK
// ChatGPT helped clean these up, they look pretty good now
// TODO: maybe use react-icons instead? would be cleaner - LW
// nah heroicons is fine - NS
const Icons={Server:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"})),// Palette icon for themes - NS Jan 2026
Palette:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})),// Building icon for tenants - NS
Building:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})),// Key icon for permissions
Key:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})),// FileKey icon for SSH key authentication
FileKey:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"}),/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 11a2 2 0 100-4 2 2 0 000 4z"})),Database:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"})),// Storage: () => (...)  // old, use Database instead
Cpu:({className,style}={})=>/*#__PURE__*/React.createElement("svg",{className:className||'w-5 h-5',style:style,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 3v2m6-2v2M9 19v2m6-2v2M3 9h2m-2 6h2m14-6h2m-2 6h2M5 5h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2z"})),Memory:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})),Plus:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})),MoreVertical:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})),Trash:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})),// MK: Alias for Trash2
Trash2:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})),Settings:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})),Activity:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})),ArrowRight:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})),Check:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})),Upload:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})),Zap:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})),X:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})),XCircle:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})),CheckCircle:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})),Copy:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})),Eye:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})),Clock:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})),RotateCcw:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h4a4 4 0 014 4v0a4 4 0 01-4 4H3m0 0l3-3m-3 3l3 3M21 14h-4a4 4 0 01-4-4v0a4 4 0 014-4h4m0 0l-3 3m3-3l-3-3"})),Grid:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})),List:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 10h16M4 14h16M4 18h16"})),Globe:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})),// NS: New icons for alerts, tasks, tags, affinity - Dec 2025
Mail:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})),Tag:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})),Link:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})),Unlink:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101M3 3l18 18m-1.828-8.828a4 4 0 00-5.656 0l-4 4"})),Square:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2"})),Camera:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})),Archive:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})),Bell:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})),WifiOff:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3m8.293 8.293l1.414 1.414"})),Folder:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})),Cloud:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"})),FolderPlus:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})),FolderInput:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 9l3 3m0 0l-3 3m3-3H8m13 0a9 9 0 11-18 0 9 9 0 0118 0z"})),Search:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})),Filter:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})),Refresh:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})),VM:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})),Container:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})),Play:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{d:"M8 5v14l11-7z"})),Pause:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("rect",{x:"6",y:"4",width:"4",height:"16"}),/*#__PURE__*/React.createElement("rect",{x:"14",y:"4",width:"4",height:"16"})),Wrench:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})),Download:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})),RotateCw:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})),Terminal:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})),Power:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.636 5.636a9 9 0 1012.728 0M12 3v9"})),Stop:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("rect",{x:"6",y:"6",width:"12",height:"12",rx:"1"})),PlayCircle:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})),StopCircle:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}),/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"})),RefreshCw:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})),Monitor:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})),Maximize:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})),Minimize:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"})),Cog:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})),HardDrive:({className,style}={})=>/*#__PURE__*/React.createElement("svg",{className:className||"w-4 h-4",style:style,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"})),Layers:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"})),Network:({className,style}={})=>/*#__PURE__*/React.createElement("svg",{className:className||"w-4 h-4",style:style,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.14 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"})),Plug:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})),// MK: Unplug icon - plug with arrow showing disconnect
Unplug:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 3v3M15 3v3M9 21v-3M15 21v-3M3 9h3M21 9h-3M3 15h3M21 15h-3"}),/*#__PURE__*/React.createElement("rect",{x:"7",y:"7",width:"10",height:"10",rx:"1",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2}),/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 5l14 14"})),Save:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})),Shield:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})),Scale:({className})=>/*#__PURE__*/React.createElement("svg",{className:className||"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"})),Disc:({className})=>/*#__PURE__*/React.createElement("svg",{className:className||"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("circle",{cx:"12",cy:"12",r:"10",strokeWidth:2}),/*#__PURE__*/React.createElement("circle",{cx:"12",cy:"12",r:"3",strokeWidth:2})),MemoryStick:({className,style}={})=>/*#__PURE__*/React.createElement("svg",{className:className||"w-5 h-5",style:style,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",strokeWidth:2}),/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 4v4M15 4v4M9 16v4M15 16v4M4 9h4M4 15h4M16 9h4M16 15h4"})),Star:({className})=>/*#__PURE__*/React.createElement("svg",{className:className||"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})),Package:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})),Lock:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})),Unlock:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"})),Ban:({className})=>/*#__PURE__*/React.createElement("svg",{className:className||"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("circle",{cx:"12",cy:"12",r:"10",strokeWidth:2}),/*#__PURE__*/React.createElement("line",{x1:"4.93",y1:"4.93",x2:"19.07",y2:"19.07",strokeWidth:2,strokeLinecap:"round"})),UserX:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7a4 4 0 11-8 0 4 4 0 018 0zM9 14a6 6 0 00-6 6v1h12v-1a6 6 0 00-6-6zM21 12h-6"})),AlertTriangle:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5 text-yellow-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})),Info:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5 text-blue-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})),// LW: LifeBuoy icon for support bundle - Feb 2026
LifeBuoy:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("circle",{cx:"12",cy:"12",r:"10",strokeWidth:2}),/*#__PURE__*/React.createElement("circle",{cx:"12",cy:"12",r:"4",strokeWidth:2}),/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.93 4.93l4.24 4.24m5.66 0l4.24-4.24m0 14.14l-4.24-4.24m-5.66 0l-4.24 4.24"})),// MK: Box icon for containers/packages - Feb 2026
Box:({className,style})=>/*#__PURE__*/React.createElement("svg",{className:className||"w-5 h-5",style:style,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})),LogOut:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})),ChevronDown:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})),ChevronUp:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})),ChevronRight:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})),// LW: Feb 2026 - needed for corporate VM detail back button
ChevronLeft:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})),User:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})),Users:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})),ClipboardList:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})),UserPlus:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})),Edit:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})),BarChart:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})),Image:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})),FileText:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})),ExternalLink:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})),Github:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{fillRule:"evenodd",d:"M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z",clipRule:"evenodd"})),Loader:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})),// NS: Added missing icons for About section
Heart:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})),Book:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})),// LW: MessageSquare icon for discussions - Feb 2026
MessageSquare:()=>/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})),// NS: Feb 2026 - PBS File Browser icons
ArrowLeft:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 12H5m0 0l7 7m-7-7l7-7"})),File:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})),FolderOpen:()=>/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"}))};// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PegaProx - UI Components
// Charts, Gauge, Toast, NodeJoin wizards
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Sparkline Component - Small inline chart
// NS: ChatGPT wrote the initial SVG math, I just cleaned it up
function Sparkline({data=[],color='#3b82f6',height=24,width=80}){if(!data||data.length===0)return null;const max=Math.max(...data,1);const min=Math.min(...data,0);const range=max-min||1;const points=data.map((value,index)=>{const x=index/(data.length-1)*width;const y=height-(value-min)/range*height;return`${x},${y}`;}).join(' ');return/*#__PURE__*/React.createElement("svg",{width:width,height:height,className:"inline-block"},/*#__PURE__*/React.createElement("polyline",{fill:"none",stroke:color,strokeWidth:"1.5",points:points}));}// VM Metrics Modal - Shows detailed graphs
// LW: RRD data from Proxmox, charts built with SVG
// Oct 2025: Added timeframe selector after user feedback
// Helper functions moved outside component
const formatBytes=bytes=>{if(bytes===0)return'0 B';if(!bytes||isNaN(bytes))return'0 B';const k=1024;const sizes=['B','KB','MB','GB','TB'];if(bytes<1)return bytes.toFixed(2)+' B';const i=Math.floor(Math.log(bytes)/Math.log(k));if(i<0)return bytes.toFixed(1)+' B';if(i>=sizes.length)return(bytes/Math.pow(k,sizes.length-1)).toFixed(1)+' '+sizes[sizes.length-1];return(bytes/Math.pow(k,i)).toFixed(1)+' '+sizes[i];};const formatTime=ts=>{if(!ts)return'';return new Date(ts*1000).toLocaleString();};// Chart.js line chart component - uses canvas for interactive charts
const LineChart=React.memo(function LineChart({data,datasets,timestamps,label,color,unit,formatValue,yMin,yMax}){const canvasRef=React.useRef(null);const chartRef=React.useRef(null);const formatRef=React.useRef(formatValue);formatRef.current=formatValue;// Normalize input to array of datasets
const chartDatasets=React.useMemo(()=>{if(datasets&&datasets.length>0)return datasets.filter(ds=>ds.data&&ds.data.length>0);if(data&&data.length>0)return[{label:label,data:data,color:color,fill:true}];return[];},[data,datasets,label,color]);// Stable fingerprint of data to avoid re-creating chart on parent re-renders
const dataFingerprint=React.useMemo(()=>{if(chartDatasets.length===0)return'';// Simple fingerprint: length + first + middle + last values of all datasets
return chartDatasets.map(ds=>{const d=ds.data;if(!d||d.length===0)return'0';return d.length+':'+(d[0]||0)+':'+(d[Math.floor(d.length/2)]||0)+':'+(d[d.length-1]||0);}).join('|');},[chartDatasets]);// Cleanup on unmount
React.useEffect(()=>{return()=>{if(chartRef.current){chartRef.current.destroy();chartRef.current=null;}};},[]);// Create/update chart only when data actually changes
React.useEffect(()=>{if(!canvasRef.current||!window.Chart)return;// Destroy previous chart
if(chartRef.current){chartRef.current.destroy();chartRef.current=null;}if(chartDatasets.length===0)return;// Process datasets (sanitize and decimate)
const processedDatasets=[];let finalLabels=[];// Determine timestamps/labels from first valid dataset or timestamps prop
const rawLength=chartDatasets[0]&&chartDatasets[0].data?chartDatasets[0].data.length:0;if(rawLength===0)return;// Build raw labels first
const rawLabels=[];if(timestamps&&timestamps.length===rawLength){for(let i=0;i<timestamps.length;i++){const d=new Date(timestamps[i]*1000);rawLabels.push(d.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}));}}else{for(let i=0;i<rawLength;i++){rawLabels.push(String(i));}}// Decimation factor
const step=rawLength>200?Math.ceil(rawLength/200):1;// Process labels
if(step>1){for(let i=0;i<rawLength;i+=step){finalLabels.push(rawLabels[i]);}}else{finalLabels=rawLabels;}// Process each dataset
chartDatasets.forEach(ds=>{if(!ds.data||ds.data.length===0)return;const cleanData=[];for(let i=0;i<ds.data.length;i++){const v=ds.data[i];cleanData.push(v===null||v===undefined||v!==v?0:v);}let finalData=[];if(step>1){for(let i=0;i<cleanData.length;i+=step){finalData.push(cleanData[i]);}}else{finalData=cleanData;}processedDatasets.push({label:ds.label||label,data:finalData,borderColor:ds.color||color,backgroundColor:(ds.color||color)+'33',fill:ds.fill!==undefined?ds.fill:true,tension:0.4,pointRadius:0,pointHitRadius:8,borderWidth:2});});// Set canvas dimensions explicitly
const canvas=canvasRef.current;const parent=canvas.parentElement;if(parent){canvas.width=parent.clientWidth||600;canvas.height=180;}const unitStr=unit||'%';const ctx=canvas.getContext('2d');try{const chart=new window.Chart(ctx,{type:'line',data:{labels:finalLabels,datasets:processedDatasets},options:{responsive:false,animation:false,normalized:true,interaction:{mode:'nearest',axis:'x',intersect:false},plugins:{legend:{display:processedDatasets.length>1,labels:{color:'#9ca3af',usePointStyle:true,boxWidth:6}},tooltip:{enabled:true,mode:'index',intersect:false,backgroundColor:'rgba(30, 30, 40, 0.95)',titleColor:'#e5e7eb',bodyColor:'#fff',callbacks:{label:function(c){var val=c.parsed.y;var fn=formatRef.current;var str=fn?fn(val):val.toFixed(2);return' '+c.dataset.label+': '+str+(unitStr.trim()?unitStr:'');}}},decimation:false},scales:{x:{ticks:{color:'#6b7280',font:{size:10},maxTicksLimit:8,maxRotation:0},grid:{color:'rgba(75, 85, 99, 0.3)'}},y:{beginAtZero:true,min:yMin,max:yMax,ticks:{color:'#6b7280',font:{size:10},callback:function(value){var fn=formatRef.current;if(fn)return fn(value)+(unitStr.trim()?unitStr:'');return value.toFixed(yMax&&yMax<=10?1:0)+unitStr;}},grid:{color:'rgba(75, 85, 99, 0.3)'}}}}});chartRef.current=chart;}catch(e){console.error('Chart.js error for '+label+':',e);}},[dataFingerprint,unit,yMin,yMax]);// re-run if data changes
if(chartDatasets.length===0)return null;return React.createElement('div',{className:'bg-proxmox-dark rounded-lg p-4'},React.createElement('div',{className:'flex justify-between items-center mb-2'},React.createElement('span',{className:'text-sm font-medium text-gray-300'},label)),React.createElement('div',{style:{width:'100%',height:'180px'}},React.createElement('canvas',{ref:canvasRef})));});function VmMetricsModal({vm,clusterId,onClose}){const{t}=useTranslation();const{getAuthHeaders}=useAuth();const[timeframe,setTimeframe]=useState('day');const[loading,setLoading]=useState(true);const[data,setData]=useState(null);const[err,setErr]=useState(null);// LW: one-liner, keep it simple
const authFetch=(url,opts={})=>fetch(url,{...opts,credentials:'include',headers:{...opts.headers,...getAuthHeaders()}});useEffect(()=>{const fetchMetrics=async()=>{setLoading(true);setErr(null);try{const r=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/rrd/${timeframe}`);if(r.ok){setData(await r.json());}else{setErr('Failed to load metrics');}}catch(e){setErr(e.message);}setLoading(false);};fetchMetrics();},[timeframe,vm.vmid]);// Prepare memory data in GB
const maxMemGB=vm.maxmem?vm.maxmem/(1024*1024*1024):0;const memDataGB=React.useMemo(()=>{if(!data||!data.metrics||!data.metrics.memory||!maxMemGB)return[];return data.metrics.memory.map(p=>p/100*maxMemGB);},[data,maxMemGB]);return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:onClose},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:"text-lg font-semibold text-white"},vm.name||`${vm.type==='qemu'?'VM':'CT'} ${vm.vmid}`," - ",t('performanceMetrics')||'Performance Metrics'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-500"},"Node: ",vm.node)),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("select",{value:timeframe,onChange:e=>setTimeframe(e.target.value),className:"bg-proxmox-dark border border-proxmox-border rounded px-3 py-1.5 text-sm text-white"},/*#__PURE__*/React.createElement("option",{value:"hour"},"1 ",t('hour')||'Hour'),/*#__PURE__*/React.createElement("option",{value:"day"},"1 ",t('day')||'Day'),/*#__PURE__*/React.createElement("option",{value:"week"},"1 ",t('week')||'Week'),/*#__PURE__*/React.createElement("option",{value:"month"},"1 ",t('month')||'Month'),/*#__PURE__*/React.createElement("option",{value:"year"},"1 ",t('year')||'Year')),/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"p-1 hover:bg-proxmox-border rounded"},/*#__PURE__*/React.createElement(Icons.X,null)))),/*#__PURE__*/React.createElement("div",{className:"p-4 overflow-y-auto max-h-[70vh]"},loading?/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center py-12"},/*#__PURE__*/React.createElement(Icons.RotateCw,null),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-gray-400"},t('loading')||'Loading...')):err?/*#__PURE__*/React.createElement("div",{className:"text-center py-12 text-red-400"},err):data&&data.metrics?/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement(LineChart,{data:data.metrics.cpu,timestamps:data.timestamps,label:"CPU",color:"#3b82f6",unit:"%"}),/*#__PURE__*/React.createElement(LineChart,{data:memDataGB,timestamps:data.timestamps,label:"Memory",color:"#22c55e",unit:" GB",yMin:0,yMax:maxMemGB,formatValue:v=>v.toFixed(2)}),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement(LineChart,{data:data.metrics.disk_read,timestamps:data.timestamps,label:"Disk Read",color:"#eab308",unit:"/s",formatValue:formatBytes}),/*#__PURE__*/React.createElement(LineChart,{data:data.metrics.disk_write,timestamps:data.timestamps,label:"Disk Write",color:"#f97316",unit:"/s",formatValue:formatBytes})),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement(LineChart,{data:data.metrics.net_in,timestamps:data.timestamps,label:"Network In",color:"#06b6d4",unit:"/s",formatValue:formatBytes}),/*#__PURE__*/React.createElement(LineChart,{data:data.metrics.net_out,timestamps:data.timestamps,label:"Network Out",color:"#8b5cf6",unit:"/s",formatValue:formatBytes})),data.metrics.pressurecpusome&&/*#__PURE__*/React.createElement(LineChart,{datasets:[{label:'Some',data:data.metrics.pressurecpusome,color:'#3b82f6'},{label:'Full',data:data.metrics.pressurecpufull,color:'#ef4444'}],timestamps:data.timestamps,label:"CPU Pressure Stall",unit:"%",yMin:0,yMax:100}),data.metrics.pressurememorysome&&/*#__PURE__*/React.createElement(LineChart,{datasets:[{label:'Some',data:data.metrics.pressurememorysome,color:'#22c55e'},{label:'Full',data:data.metrics.pressurememoryfull,color:'#ef4444'}],timestamps:data.timestamps,label:"Memory Pressure Stall",unit:"%",yMin:0,yMax:100}),data.metrics.pressureiosome&&/*#__PURE__*/React.createElement(LineChart,{datasets:[{label:'Some',data:data.metrics.pressureiosome,color:'#eab308'},{label:'Full',data:data.metrics.pressureiofull,color:'#ef4444'}],timestamps:data.timestamps,label:"IO Pressure Stall",unit:"%",yMin:0,yMax:100}),data.timestamps&&data.timestamps.length>0&&/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 text-center mt-4"},formatTime(data.timestamps[0])," - ",formatTime(data.timestamps[data.timestamps.length-1]))):/*#__PURE__*/React.createElement("div",{className:"text-center py-12 text-gray-400"},"No data available"))));}// Gauge Component
function Gauge({value,max=100,size=120,label,color}){const r=45;const circ=2*Math.PI*r;const prog=Math.min(value/max,1);const off=circ-prog*circ;// color thresholds
const getColor=()=>{if(color)return color;if(value<50)return'#22c55e';// green
if(value<80)return'#eab308';// yellow
return'#ef4444';// red
};return/*#__PURE__*/React.createElement("div",{className:"gauge-container flex flex-col items-center"},/*#__PURE__*/React.createElement("svg",{viewBox:"0 0 100 100",className:"w-full h-full"},/*#__PURE__*/React.createElement("circle",{cx:"50",cy:"50",r:r,className:"gauge-bg"}),/*#__PURE__*/React.createElement("circle",{cx:"50",cy:"50",r:r,className:"gauge-fill",style:{stroke:getColor(),strokeDasharray:circ,strokeDashoffset:off}}),/*#__PURE__*/React.createElement("text",{x:"50",y:"50",textAnchor:"middle",dy:"0.35em",className:"gauge-text text-white text-lg"},value.toFixed(1),"%")),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-400 mt-1 font-medium"},label));}/*
         * Toggle Component
         * NS: simple on/off switch, used everywhere
         */function Toggle({checked,onChange,label}){return/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-3 cursor-pointer group"},/*#__PURE__*/React.createElement("div",{className:`toggle-switch ${checked?'active':''}`,onClick:()=>onChange(!checked)}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300 group-hover:text-white transition-colors"},label));}// Slider Component - LW: fancy slider with gradient fill
function Slider({label,value,onChange,min=0,max=100,step=1,unit='%',description}){const percentage=(value-min)/(max-min)*100;return/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm font-medium text-gray-200"},label),description&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},description)),/*#__PURE__*/React.createElement("span",{className:"font-mono text-sm text-proxmox-orange font-semibold bg-proxmox-orange/10 px-3 py-1 rounded-lg"},value,unit)),/*#__PURE__*/React.createElement("div",{className:"relative"},/*#__PURE__*/React.createElement("div",{className:"absolute inset-0 h-2 rounded-full bg-proxmox-border top-1/2 -translate-y-1/2"}),/*#__PURE__*/React.createElement("div",{className:"absolute h-2 rounded-full bg-gradient-to-r from-proxmox-orange to-orange-400 top-1/2 -translate-y-1/2 transition-all",style:{width:`${percentage}%`}}),/*#__PURE__*/React.createElement("input",{type:"range",min:min,max:max,step:step,value:value,onChange:e=>onChange(Number(e.target.value)),className:"custom-slider w-full relative z-10 bg-transparent"})),/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-xs text-gray-500"},/*#__PURE__*/React.createElement("span",null,min,unit),/*#__PURE__*/React.createElement("span",null,max,unit)));}// Sponsor Slot Component - loads PNG from /images/sponsors/
function SponsorSlot({num}){const{t}=useTranslation();const[hasImage,setHasImage]=useState(true);const[sponsorUrl,setSponsorUrl]=useState(null);// Sponsor URLs - edit these to add sponsor links
const sponsorLinks={1:'https://socialfurr.com',2:null,3:null,4:null,5:null,6:null,7:null,8:null};const handleImageError=()=>{setHasImage(false);};const url=sponsorLinks[num];const imageSrc=`/images/sponsors/sponsor${num}.png`;if(!hasImage){// Show "Wanted" placeholder
return/*#__PURE__*/React.createElement("a",{href:"mailto:sponsor@pegaprox.com?subject=Sponsorship%20Inquiry",className:"group",title:t('becomeSponsor')||'Become a sponsor'},/*#__PURE__*/React.createElement("div",{className:"w-12 h-12 rounded-lg bg-proxmox-card border border-dashed border-proxmox-border flex flex-col items-center justify-center hover:border-proxmox-orange/50 transition-all hover:scale-105"},/*#__PURE__*/React.createElement("span",{className:"text-sm"},"\uD83C\uDFAF")));}const content=/*#__PURE__*/React.createElement("div",{className:"w-12 h-12 rounded-lg bg-proxmox-card border border-proxmox-border p-1 flex items-center justify-center hover:border-proxmox-orange/50 transition-all hover:scale-105 overflow-hidden"},/*#__PURE__*/React.createElement("img",{src:imageSrc,alt:`Sponsor ${num}`,className:"w-full h-full object-contain opacity-80 group-hover:opacity-100 transition-opacity",onError:handleImageError}));if(url){return/*#__PURE__*/React.createElement("a",{href:url,target:"_blank",rel:"noopener noreferrer",className:"group"},content);}return/*#__PURE__*/React.createElement("div",{className:"group"},content);}// Notification Toast
// LW: Simple toast - auto-closes after 3s
// tried 5s but users complained it was too long
function Toast({message,type='success',onClose}){useEffect(()=>{const timer=setTimeout(onClose,3000);// 3000ms = 3s
return()=>clearTimeout(timer);},[onClose]);// NS: ternary hell but it works lol
return/*#__PURE__*/React.createElement("div",{className:`toast-enter flex items-center gap-3 px-4 py-3 rounded-lg border ${type==='success'?'bg-green-500/10 border-green-500/30 text-green-400':type==='error'?'bg-red-500/10 border-red-500/30 text-red-400':'bg-proxmox-orange/10 border-proxmox-orange/30 text-proxmox-orange'}`},type==='success'?/*#__PURE__*/React.createElement(Icons.Check,null):type==='error'?/*#__PURE__*/React.createElement(Icons.X,null):/*#__PURE__*/React.createElement(Icons.Activity,null),/*#__PURE__*/React.createElement("span",{className:"text-sm font-medium"},message));}// Node Alert Banner - shows critical alerts when nodes go offline
// fix for #184 - banner was not showing on first load
// NS: Now filters by cluster_id to only show alerts for current cluster
function NodeAlertBanner({alerts,onDismiss,currentClusterId}){const{t}=useTranslation();// Filter alerts to only show ones for the current cluster
const alertEntries=Object.entries(alerts||{}).filter(([nodeName,alert])=>!currentClusterId||alert.cluster_id===currentClusterId);if(alertEntries.length===0)return null;return/*#__PURE__*/React.createElement("div",{className:"fixed top-0 left-0 right-0 z-50"},alertEntries.map(([nodeName,alert])=>/*#__PURE__*/React.createElement("div",{key:nodeName,className:"bg-red-600 text-white px-4 py-3 flex items-center justify-between animate-pulse"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-2 bg-red-500 rounded-full"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-5 h-5"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"font-bold"},t('criticalAlert')||'CRITICAL ALERT',":"),/*#__PURE__*/React.createElement("span",{className:"ml-2"},alert.message),/*#__PURE__*/React.createElement("span",{className:"ml-4 text-red-200 text-sm"},new Date(alert.timestamp).toLocaleTimeString()))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-red-200"},t('haRecoveryMayStart')||'HA recovery may be in progress...'),/*#__PURE__*/React.createElement("button",{onClick:()=>onDismiss&&onDismiss(nodeName),className:"p-1 hover:bg-red-500 rounded",title:t('dismiss')||'Dismiss'},/*#__PURE__*/React.createElement(Icons.X,{className:"w-4 h-4"}))))));}// =============================================================================
// NODE MANAGEMENT COMPONENTS
// NS: Feb 2026 - 3-step join wizard: test connection â†‘ verify info â†‘ join
// LW: Force rejoin option handles nodes removed via pvecm delnode
// MK: Uses invoke_shell for pvecm add because it prompts for password interactively
// =============================================================================
function NodeJoinWizard({isOpen,onClose,clusterId,onSuccess,addToast}){const{t}=useTranslation();const{getAuthHeaders}=useAuth();const[step,setStep]=useState(1);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);const[nodeIp,setNodeIp]=useState('');const[username,setUsername]=useState('root');const[password,setPassword]=useState('');const[sshPort,setSshPort]=useState(22);const[link0Address,setLink0Address]=useState('');const[nodeInfo,setNodeInfo]=useState(null);const[joinResult,setJoinResult]=useState(null);const[forceRejoin,setForceRejoin]=useState(false);const resetWizard=()=>{setStep(1);setNodeIp('');setUsername('root');setPassword('');setSshPort(22);setLink0Address('');setNodeInfo(null);setJoinResult(null);setError(null);setLoading(false);};const handleClose=()=>{resetWizard();onClose();};const testConnection=async()=>{setLoading(true);setError(null);try{const response=await fetch(`${API_URL}/clusters/${clusterId}/nodes/join/test`,{method:'POST',credentials:'include',headers:{'Content-Type':'application/json',...getAuthHeaders()},body:JSON.stringify({node_ip:nodeIp,username,password,ssh_port:sshPort})});const data=await response.json();if(data.success){setNodeInfo(data.info);if(data.info.already_in_cluster||data.info.has_old_config)setForceRejoin(true);setStep(2);}else{setError(data.error||'Connection failed');}}catch(err){setError('Network error: '+err.message);}finally{setLoading(false);}};const joinCluster=async()=>{setLoading(true);setError(null);try{const response=await fetch(`${API_URL}/clusters/${clusterId}/nodes/join`,{method:'POST',credentials:'include',headers:{'Content-Type':'application/json',...getAuthHeaders()},body:JSON.stringify({node_ip:nodeIp,username,password,ssh_port:sshPort,link0_address:link0Address||undefined,force:forceRejoin})});const data=await response.json();if(data.success){setJoinResult(data);setStep(3);if(onSuccess)onSuccess();}else{setError(data.error||'Join failed');}}catch(err){setError('Network error: '+err.message);}finally{setLoading(false);}};if(!isOpen)return null;return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-lg"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h2",{className:"text-lg font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Server,{className:"w-5 h-5 text-proxmox-orange"}),"Add Node to Cluster"),/*#__PURE__*/React.createElement("button",{onClick:handleClose,className:"p-1 hover:bg-proxmox-dark rounded"},/*#__PURE__*/React.createElement(Icons.X,{className:"w-5 h-5"}))),/*#__PURE__*/React.createElement("div",{className:"px-4 py-3 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},[1,2,3].map(s=>/*#__PURE__*/React.createElement("div",{key:s,className:"flex items-center"},/*#__PURE__*/React.createElement("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${step>=s?'bg-proxmox-orange text-white':'bg-proxmox-dark text-gray-400'}`},step>s?/*#__PURE__*/React.createElement(Icons.Check,{className:"w-4 h-4"}):s),/*#__PURE__*/React.createElement("span",{className:`ml-2 text-sm ${step>=s?'text-white':'text-gray-500'}`},s===1?'Connect':s===2?'Verify':'Join'),s<3&&/*#__PURE__*/React.createElement("div",{className:"w-12 h-0.5 bg-proxmox-border mx-2"}))))),/*#__PURE__*/React.createElement("div",{className:"p-4"},error&&/*#__PURE__*/React.createElement("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500 rounded-lg text-red-400 text-sm"},error),step===1&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Node IP *"),/*#__PURE__*/React.createElement("input",{type:"text",value:nodeIp,onChange:e=>setNodeIp(e.target.value),placeholder:"192.168.1.100",className:"w-full bg-proxmox-dark border border-proxmox-border rounded px-3 py-2 text-white"})),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"SSH User"),/*#__PURE__*/React.createElement("input",{type:"text",value:username,onChange:e=>setUsername(e.target.value),className:"w-full bg-proxmox-dark border border-proxmox-border rounded px-3 py-2 text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"SSH Port"),/*#__PURE__*/React.createElement("input",{type:"number",value:sshPort,onChange:e=>setSshPort(parseInt(e.target.value)||22),className:"w-full bg-proxmox-dark border border-proxmox-border rounded px-3 py-2 text-white"}))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"SSH Password *"),/*#__PURE__*/React.createElement("input",{type:"password",value:password,onChange:e=>setPassword(e.target.value),className:"w-full bg-proxmox-dark border border-proxmox-border rounded px-3 py-2 text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Link0 Address (optional)"),/*#__PURE__*/React.createElement("input",{type:"text",value:link0Address,onChange:e=>setLink0Address(e.target.value),placeholder:"10.0.0.100",className:"w-full bg-proxmox-dark border border-proxmox-border rounded px-3 py-2 text-white"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},"Only for multi-network setups"))),step===2&&nodeInfo&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"p-4 bg-green-500/10 border border-green-500/30 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-green-400"},/*#__PURE__*/React.createElement(Icons.CheckCircle,{className:"w-5 h-5"}),/*#__PURE__*/React.createElement("span",{className:"font-medium"},"Connection OK"))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4 space-y-3"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"Hostname:"),/*#__PURE__*/React.createElement("span",{className:"font-mono text-white"},nodeInfo.hostname)),/*#__PURE__*/React.createElement("div",{className:"flex justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"IP:"),/*#__PURE__*/React.createElement("span",{className:"font-mono text-white"},nodeInfo.ip)),/*#__PURE__*/React.createElement("div",{className:"flex justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"Proxmox:"),/*#__PURE__*/React.createElement("span",{className:nodeInfo.proxmox_installed?'text-green-400':'text-red-400'},nodeInfo.proxmox_installed?nodeInfo.proxmox_version:'Not Installed')),/*#__PURE__*/React.createElement("div",{className:"flex justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"Cluster:"),/*#__PURE__*/React.createElement("span",{className:nodeInfo.already_in_cluster?'text-yellow-400':'text-green-400'},nodeInfo.already_in_cluster?nodeInfo.current_cluster:'Not in cluster'))),!nodeInfo.proxmox_installed&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-red-500/20 border border-red-500 rounded-lg text-red-400 text-sm"},"Proxmox VE not installed"),(nodeInfo.already_in_cluster||nodeInfo.has_old_config)&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg text-yellow-400 text-sm flex items-start gap-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4 mt-0.5 shrink-0"}),/*#__PURE__*/React.createElement("span",null,nodeInfo.already_in_cluster?'This node is already in a cluster.':'This node has leftover cluster config files.')),nodeInfo.proxmox_installed&&/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer p-3 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:forceRejoin,onChange:e=>setForceRejoin(e.target.checked),className:"w-4 h-4 rounded border-gray-500 accent-proxmox-orange"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-white font-medium"},"Force Join"),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},"- cleans old corosync/pve config before joining (use if node was previously in a cluster)"))),step===3&&joinResult&&/*#__PURE__*/React.createElement("div",{className:"text-center"},/*#__PURE__*/React.createElement("div",{className:"p-4 bg-green-500/10 border border-green-500/30 rounded-lg"},/*#__PURE__*/React.createElement(Icons.CheckCircle,{className:"w-12 h-12 text-green-400 mx-auto mb-2"}),/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-green-400"},"Node Joined!"),/*#__PURE__*/React.createElement("p",{className:"text-gray-400 mt-2"},joinResult.message)),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-500 mt-4"},"Refresh to see the new node."))),/*#__PURE__*/React.createElement("div",{className:"p-4 border-t border-proxmox-border flex justify-between"},step===1&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("button",{onClick:handleClose,className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-border rounded-lg text-white"},"Cancel"),/*#__PURE__*/React.createElement("button",{onClick:testConnection,disabled:loading||!nodeIp||!password,className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg disabled:opacity-50 flex items-center gap-2 text-white"},loading&&/*#__PURE__*/React.createElement(Icons.Loader,{className:"w-4 h-4 animate-spin"}),"Test Connection")),step===2&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("button",{onClick:()=>setStep(1),className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-border rounded-lg text-white"},"Back"),/*#__PURE__*/React.createElement("button",{onClick:joinCluster,disabled:loading||!nodeInfo?.proxmox_installed||nodeInfo?.already_in_cluster&&!forceRejoin,className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg disabled:opacity-50 flex items-center gap-2 text-white"},loading&&/*#__PURE__*/React.createElement(Icons.Loader,{className:"w-4 h-4 animate-spin"}),loading?'Joining...':forceRejoin?'Force Join Cluster':'Join Cluster')),step===3&&/*#__PURE__*/React.createElement("button",{onClick:handleClose,className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg ml-auto text-white"},"Done"))));}// MK: Feb 2026 - Removal checklist with blockers (hard) vs warnings (soft)
// LW: After pvecm delnode, automatically cleans up stale config on removed node via SSH
function RemoveNodeConfirmModal({isOpen,onClose,node,clusterId,onSuccess,addToast}){const{getAuthHeaders}=useAuth();const[loading,setLoading]=useState(false);const[error,setError]=useState(null);const[canRemove,setCanRemove]=useState(null);const[confirmText,setConfirmText]=useState('');useEffect(()=>{if(isOpen&&node){setConfirmText('');setError(null);setCanRemove(null);fetch(`${API_URL}/clusters/${clusterId}/nodes/${node.name}/can-remove`,{credentials:'include',headers:getAuthHeaders()}).then(r=>{if(!r.ok)throw new Error(`HTTP ${r.status}`);return r.json();}).then(setCanRemove).catch(e=>setError('Could not check status: '+e.message));}},[isOpen,node]);const removeNode=async()=>{if(confirmText!==node.name)return;setLoading(true);setError(null);try{const response=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${node.name}/cluster-membership`,{method:'DELETE',credentials:'include',headers:{'Content-Type':'application/json',...getAuthHeaders()},body:JSON.stringify({confirm:true})});const data=await response.json();if(data.success){const cleanupOk=data.cleanup?.success;const cleanupDetail=data.cleanup?.message||'';const cleanupMsg=cleanupOk?' âœ“ Config cleaned':` âš  Cleanup: ${cleanupDetail}`;if(addToast)addToast(`Node removed.${cleanupMsg}`,cleanupOk?'success':'warning');if(onSuccess)onSuccess();onClose();}else{setError(data.error||'Failed');}}catch(err){setError('Network error');}finally{setLoading(false);}};if(!isOpen||!node)return null;return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-md"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("h2",{className:"text-lg font-semibold text-red-400 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-5 h-5"}),"Remove Node")),/*#__PURE__*/React.createElement("div",{className:"p-4 space-y-4"},error&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-red-500/20 border border-red-500 rounded-lg text-red-400 text-sm"},error),/*#__PURE__*/React.createElement("p",{className:"text-gray-300"},"Remove ",/*#__PURE__*/React.createElement("strong",{className:"text-white"},node.name)," from cluster?"),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},"This runs ",/*#__PURE__*/React.createElement("code",{className:"bg-proxmox-dark px-1 rounded"},"pvecm delnode")," on another cluster node."),canRemove&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-3 space-y-2"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},canRemove.in_maintenance?/*#__PURE__*/React.createElement(Icons.CheckCircle,{className:"w-4 h-4 text-green-400"}):/*#__PURE__*/React.createElement(Icons.XCircle,{className:"w-4 h-4 text-red-400"}),/*#__PURE__*/React.createElement("span",{className:canRemove.in_maintenance?'text-green-400':'text-red-400'},"Maintenance Mode")),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},canRemove.maintenance_complete?/*#__PURE__*/React.createElement(Icons.CheckCircle,{className:"w-4 h-4 text-green-400"}):/*#__PURE__*/React.createElement(Icons.XCircle,{className:"w-4 h-4 text-red-400"}),/*#__PURE__*/React.createElement("span",{className:canRemove.maintenance_complete?'text-green-400':'text-red-400'},"Evacuation Done")),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},canRemove.is_offline?/*#__PURE__*/React.createElement(Icons.CheckCircle,{className:"w-4 h-4 text-green-400"}):/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4 text-yellow-400"}),/*#__PURE__*/React.createElement("span",{className:canRemove.is_offline?'text-green-400':'text-yellow-400'},canRemove.is_offline?'Node Offline':'Node Online (recommended: shutdown after removal)')),!canRemove.has_vms?/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.CheckCircle,{className:"w-4 h-4 text-green-400"}),/*#__PURE__*/React.createElement("span",{className:"text-green-400"},"No VMs/CTs on node")):/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.XCircle,{className:"w-4 h-4 text-red-400"}),/*#__PURE__*/React.createElement("span",{className:"text-red-400"},canRemove.vm_count," VM(s)/CT(s) still on node"))),canRemove&&!canRemove.can_remove&&canRemove.blockers?.length>0&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-red-400 text-sm"},/*#__PURE__*/React.createElement("strong",null,"Blockers:"),/*#__PURE__*/React.createElement("ul",{className:"mt-1 ml-4 list-disc"},canRemove.blockers.map((b,i)=>/*#__PURE__*/React.createElement("li",{key:i},b)))),canRemove?.warnings?.length>0&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg text-yellow-400 text-sm flex items-start gap-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4 mt-0.5 shrink-0"}),/*#__PURE__*/React.createElement("span",null,canRemove.warnings.join('. '))),canRemove?.can_remove&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Type ",/*#__PURE__*/React.createElement("strong",{className:"text-white"},node.name)," to confirm:"),/*#__PURE__*/React.createElement("input",{type:"text",value:confirmText,onChange:e=>setConfirmText(e.target.value),placeholder:node.name,className:"w-full bg-proxmox-dark border border-proxmox-border rounded px-3 py-2 text-white"}))),/*#__PURE__*/React.createElement("div",{className:"p-4 border-t border-proxmox-border flex justify-end gap-3"},/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-border rounded-lg text-white"},"Cancel"),/*#__PURE__*/React.createElement("button",{onClick:removeNode,disabled:loading||!canRemove?.can_remove||confirmText!==node.name,className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg disabled:opacity-50 flex items-center gap-2 text-white"},loading&&/*#__PURE__*/React.createElement(Icons.Loader,{className:"w-4 h-4 animate-spin"}),"Remove"))));}// NS: Feb 2026 - Move node between clusters: remove from source â†‘ cleanup â†‘ force join to target
// MK: Always uses force:true for the join since node was just removed and has stale config
function MoveNodeModal({isOpen,onClose,nodeName,currentClusterId,clusters,onSuccess,addToast}){const{t}=useTranslation();const{getAuthHeaders}=useAuth();const[loading,setLoading]=useState(false);const[error,setError]=useState(null);const[step,setStep]=useState(1);// 1=select target, 2=confirm, 3=progress
const[targetCluster,setTargetCluster]=useState(null);const[password,setPassword]=useState('');const[progress,setProgress]=useState([]);const otherClusters=(clusters||[]).filter(c=>c.id!==currentClusterId);const startMove=async()=>{if(!targetCluster||!password)return;setLoading(true);setError(null);setStep(3);setProgress([{text:'Removing node from current cluster...',status:'running'}]);try{// Remove from current cluster
const removeResp=await fetch(`${API_URL}/clusters/${currentClusterId}/nodes/${nodeName}/cluster-membership`,{method:'DELETE',credentials:'include',headers:{'Content-Type':'application/json',...getAuthHeaders()},body:JSON.stringify({confirm:true})});const removeData=await removeResp.json();if(!removeData.success){setProgress(prev=>[...prev.slice(0,-1),{text:'Remove from cluster failed',status:'error'}]);setError(removeData.error||'Failed to remove node from current cluster');setLoading(false);return;}const cleanupOk=removeData.cleanup?.success;setProgress(prev=>[...prev.slice(0,-1),{text:'Removed from current cluster'+(cleanupOk?' (config cleaned)':''),status:'done'},{text:`Getting join info from ${targetCluster.name}...`,status:'running'}]);// Get join info from target cluster
const joinInfoResp=await fetch(`${API_URL}/clusters/${targetCluster.id}/datacenter/join-info`,{credentials:'include',headers:getAuthHeaders()});if(!joinInfoResp||!joinInfoResp.ok){setProgress(prev=>[...prev.slice(0,-1),{text:'Could not get join info',status:'error'}]);setError('Failed to get join info from target cluster. You may need to join manually.');setLoading(false);return;}setProgress(prev=>[...prev.slice(0,-1),{text:`Got join info from ${targetCluster.name}`,status:'done'},{text:`Joining node to ${targetCluster.name}...`,status:'running'}]);// Resolve node IP from current cluster knowledge
const nodeIp=await(async()=>{try{const r=await fetch(`${API_URL}/clusters/${currentClusterId}/nodes`,{credentials:'include',headers:getAuthHeaders()});if(r&&r.ok){const nodes=await r.json();const n=(nodes.data||nodes||[]).find(x=>x.node===nodeName||x.name===nodeName);return n?.ip||n?.ring0_addr||nodeName;}}catch{}return nodeName;})();// Join to target cluster
// NS: Feb 2026 - Always force since node was just removed and may have leftover config
const joinResp=await fetch(`${API_URL}/clusters/${targetCluster.id}/nodes/join`,{method:'POST',credentials:'include',headers:{'Content-Type':'application/json',...getAuthHeaders()},body:JSON.stringify({node_ip:nodeIp,username:'root',password:password,ssh_port:22,force:true})});const joinData=await joinResp.json();if(joinData.success){setProgress(prev=>[...prev.slice(0,-1),{text:`Successfully joined ${targetCluster.name}!`,status:'done'}]);if(addToast)addToast(`Node ${nodeName} moved to ${targetCluster.name}`,'success');setTimeout(()=>{if(onSuccess)onSuccess();onClose();},2000);}else{setProgress(prev=>[...prev.slice(0,-1),{text:'Join failed - node removed but not joined',status:'error'}]);setError(`Node was removed from cluster but could not join target: ${joinData.error}. Join manually with pvecm.`);}}catch(err){setError('Network error: '+err.message);setProgress(prev=>[...prev.slice(0,-1),{text:'Error',status:'error'}]);}finally{setLoading(false);}};if(!isOpen||!nodeName)return null;return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-md"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("h2",{className:"text-lg font-semibold text-blue-400 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.ArrowRight,{className:"w-5 h-5"}),t('moveNodeToCluster')||'Move Node to another Cluster')),/*#__PURE__*/React.createElement("div",{className:"p-4 space-y-4"},error&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-red-500/20 border border-red-500 rounded-lg text-red-400 text-sm"},error),step===1&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("p",{className:"text-gray-300 text-sm"},"Move ",/*#__PURE__*/React.createElement("strong",{className:"text-white"},nodeName)," to another cluster. This will remove it from the current cluster and join it to the target."),/*#__PURE__*/React.createElement("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-3 text-yellow-400 text-sm flex items-start gap-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4 mt-0.5 shrink-0"}),/*#__PURE__*/React.createElement("span",null,"All VMs must be migrated off this node first. The node must be in maintenance mode.")),otherClusters.length===0?/*#__PURE__*/React.createElement("p",{className:"text-gray-500 text-sm italic"},"No other clusters available."):/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('targetCluster')||'Target Cluster'),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},otherClusters.map(c=>/*#__PURE__*/React.createElement("button",{key:c.id,onClick:()=>setTargetCluster(c),className:`w-full text-left px-3 py-2.5 rounded-lg border transition-colors flex items-center justify-between ${targetCluster?.id===c.id?'border-blue-500 bg-blue-500/10 text-white':'border-proxmox-border bg-proxmox-dark text-gray-300 hover:border-gray-500'}`},/*#__PURE__*/React.createElement("span",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Server,{className:"w-4 h-4"}),c.name),targetCluster?.id===c.id&&/*#__PURE__*/React.createElement(Icons.CheckCircle,{className:"w-4 h-4 text-blue-400"}))))),targetCluster&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Root password of ",nodeName),/*#__PURE__*/React.createElement("input",{type:"password",value:password,onChange:e=>setPassword(e.target.value),placeholder:"Node root password for SSH",className:"w-full bg-proxmox-dark border border-proxmox-border rounded px-3 py-2 text-white"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},"Needed to SSH into the node and run pvecm join"))),step===3&&/*#__PURE__*/React.createElement("div",{className:"space-y-2"},progress.map((p,i)=>/*#__PURE__*/React.createElement("div",{key:i,className:"flex items-center gap-2 text-sm"},p.status==='running'&&/*#__PURE__*/React.createElement(Icons.Loader,{className:"w-4 h-4 text-blue-400 animate-spin"}),p.status==='done'&&/*#__PURE__*/React.createElement(Icons.CheckCircle,{className:"w-4 h-4 text-green-400"}),p.status==='error'&&/*#__PURE__*/React.createElement(Icons.XCircle,{className:"w-4 h-4 text-red-400"}),/*#__PURE__*/React.createElement("span",{className:p.status==='error'?'text-red-400':p.status==='done'?'text-green-400':'text-gray-300'},p.text))))),/*#__PURE__*/React.createElement("div",{className:"p-4 border-t border-proxmox-border flex justify-end gap-3"},/*#__PURE__*/React.createElement("button",{onClick:onClose,disabled:loading,className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-border rounded-lg text-white disabled:opacity-50"},step===3&&!loading?'Close':'Cancel'),step===1&&/*#__PURE__*/React.createElement("button",{onClick:startMove,disabled:!targetCluster||!password||loading,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg disabled:opacity-50 flex items-center gap-2 text-white"},loading&&/*#__PURE__*/React.createElement(Icons.Loader,{className:"w-4 h-4 animate-spin"}),"Move Node"))));}// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PegaProx - Datacenter
// DatacenterTab (HA, multipath, corosync, bridges)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Datacenter Tab Component (embedded in main view)
// Datacenter Tab Component
function DatacenterTab({clusterId,addToast}){const{t}=useTranslation();const{getAuthHeaders}=useAuth();const[activeSection,setActiveSection]=useState('summary');const[loading,setLoading]=useState(true);const[dcStatus,setDcStatus]=useState(null);const[clusterNodes,setClusterNodes]=useState([]);const[joinInfo,setJoinInfo]=useState(null);const[showJoinInfo,setShowJoinInfo]=useState(false);const[dcOptions,setDcOptions]=useState({});const[showEditOptions,setShowEditOptions]=useState(false);const[editingOptions,setEditingOptions]=useState({});const[storage,setStorage]=useState([]);const[showAddStorage,setShowAddStorage]=useState(false);// Multipath Easy Setup - NS Feb 2026
const[multipathStatus,setMultipathStatus]=useState(null);const[multipathLoading,setMultipathLoading]=useState(false);const[showMultipathSetup,setShowMultipathSetup]=useState(false);const[multipathSetupData,setMultipathSetupData]=useState({vendor:'default',policy:'service-time',skipExistingConfig:false});const[multipathSetupResult,setMultipathSetupResult]=useState(null);const[multipathSelectedNodes,setMultipathSelectedNodes]=useState(null);// null = all nodes
// Reset multipath state when cluster changes
useEffect(()=>{setMultipathStatus(null);setMultipathSetupResult(null);setMultipathSelectedNodes(null);setShowMultipathSetup(false);},[clusterId]);const[newStorage,setNewStorage]=useState({type:'dir',storage:'',path:'',content:'images,rootdir'});const[backupJobs,setBackupJobs]=useState([]);const[replicationJobs,setReplicationJobs]=useState([]);// TODO: actually use this
const[firewallOptions,setFirewallOptions]=useState({});const[firewallRules,setFirewallRules]=useState([]);const[showAddRuleModal,setShowAddRuleModal]=useState(false);const[newRule,setNewRule]=useState({type:'in',action:'ACCEPT',enable:1});// MK: HA State Variables
const[haManagerStatus,setHaManagerStatus]=useState([]);const[haResources,setHaResources]=useState([]);const[haGroups,setHaGroups]=useState([]);const[availableVmsForHa,setAvailableVmsForHa]=useState([]);const[showAddHaResource,setShowAddHaResource]=useState(false);const[showAddHaGroup,setShowAddHaGroup]=useState(false);const[showEditHaResource,setShowEditHaResource]=useState(null);const[showEditHaGroup,setShowEditHaGroup]=useState(null);const[newHaResource,setNewHaResource]=useState({sid:'',state:'started',group:'',max_restart:1,max_relocate:1,comment:''});const[newHaGroup,setNewHaGroup]=useState({group:'',nodes:'',restricted:0,nofailback:0});const[showAddBackupJob,setShowAddBackupJob]=useState(false);// const [editBackupJob, setEditBackupJob] = useState(null);  // later
const[newBackupJob,setNewBackupJob]=useState({enabled:1,schedule:'daily',storage:'',mode:'snapshot',compress:'zstd',vmid:'',node:'',mailnotification:'always',mailto:''});const[cpuInfo,setCpuInfo]=useState([]);const[recommendedCpu,setRecommendedCpu]=useState(null);const authHeaders=getAuthHeaders();// Node Management state
const[showNodeJoinWizard,setShowNodeJoinWizard]=useState(false);const[showRemoveNodeModal,setShowRemoveNodeModal]=useState(false);const[nodeToRemove,setNodeToRemove]=useState(null);const[showMoveNodeModal,setShowMoveNodeModal]=useState(false);const[nodeToMove,setNodeToMove]=useState(null);// LW: SDN State - Feb 2026, GitHub Issue #38
const[sdnData,setSdnData]=useState({available:false,zones:[],vnets:[],subnets:[],controllers:[],ipams:[],dns:[],pending:false,debug:{}});const[sdnLoading,setSdnLoading]=useState(false);const[showAddZone,setShowAddZone]=useState(false);const[showAddVnet,setShowAddVnet]=useState(false);const[showAddSubnet,setShowAddSubnet]=useState(null);// vnet name when adding subnet
const[showAddController,setShowAddController]=useState(false);const[showAddIpam,setShowAddIpam]=useState(false);const[showAddDns,setShowAddDns]=useState(false);const[showEditZone,setShowEditZone]=useState(null);const[newZone,setNewZone]=useState({zone:'',type:'simple',bridge:'',mtu:'',nodes:'',ipam:'',dns:'',dnszone:'',reversedns:''});const[newVnet,setNewVnet]=useState({vnet:'',zone:'',tag:'',alias:''});const[newSubnet,setNewSubnet]=useState({subnet:'',gateway:'',snat:0,dhcp:'none','dhcp-range':''});const[newController,setNewController]=useState({controller:'',type:'evpn',asn:'',peers:'','bgp-multipath-as-path-relax':0,ebgp:0,'ebgp-multihop':0});const[newIpam,setNewIpam]=useState({ipam:'',type:'pve',url:'',token:'',section:''});const[newDns,setNewDns]=useState({dns:'',type:'powerdns',url:'',key:'',reversemaskv6:64,ttl:3600});// Ceph state
const[cephData,setCephData]=useState(null);const[cephLoading,setCephLoading]=useState(false);const[cephNode,setCephNode]=useState('');const[showCreatePool,setShowCreatePool]=useState(false);const[newPool,setNewPool]=useState({name:'',size:3,min_size:2,pg_num:128});const[showCreateMon,setShowCreateMon]=useState(false);const[showCreateMds,setShowCreateMds]=useState(false);const[cephSubTab,setCephSubTab]=useState('status');/*
             * MK: CPU generation detection for recommended CPU type
             * Maps physical CPU model to x86-64 microarchitecture level
             * Used to suggest optimal QEMU cpu type in VM settings
             * 
             * Levels: v1 (baseline), v2-AES (most compatible), v3 (AVX2), v4 (AVX-512)
             * ChatGPT helped compile this list, I double-checked against Intel ARK
             */const detectCpuGeneration=cpuModel=>{if(!cpuModel)return{level:'v2-AES',generation:'Unknown'};const model=cpuModel.toLowerCase();// Intel Xeon generations (server CPUs)
if(model.includes('xeon')){// Xeon Scalable (Sapphire Rapids, Emerald Rapids)
if(model.includes('sapphire')||model.includes('emerald')||model.match(/[w\d]-[34]\d{3}/))return{level:'v4',generation:'Intel Xeon Scalable 4th/5th Gen'};// Xeon Scalable (Ice Lake, Cascade Lake)
if(model.includes('ice')||model.includes('cascade')||model.includes('platinum')||model.includes('gold')||model.includes('silver')||model.includes('bronze'))return{level:'v3',generation:'Intel Xeon Scalable'};// Xeon E5/E7 v4 (Broadwell)
if(model.includes('v4'))return{level:'v3',generation:'Intel Xeon E5/E7 v4 (Broadwell)'};// Xeon E5/E7 v3 (Haswell)
if(model.includes('v3'))return{level:'v3',generation:'Intel Xeon E5/E7 v3 (Haswell)'};// Xeon E5/E7 v2 (Ivy Bridge)
if(model.includes('v2'))return{level:'v2-AES',generation:'Intel Xeon E5/E7 v2 (Ivy Bridge)'};// Xeon E5/E7 v1 (Sandy Bridge)
if(model.includes('e5-')||model.includes('e7-'))return{level:'v2-AES',generation:'Intel Xeon E5/E7 (Sandy Bridge)'};// Older Xeons
return{level:'v2-AES',generation:'Intel Xeon (Legacy)'};}// Intel Core generations (desktop/laptop CPUs)
if(model.includes('core')){if(model.includes('13th')||model.includes('14th')||model.includes('i9-13')||model.includes('i9-14')||model.includes('i7-13')||model.includes('i7-14'))return{level:'v4',generation:'Intel Core 13th/14th Gen'};if(model.includes('11th')||model.includes('12th')||model.includes('i9-12')||model.includes('i7-12')||model.includes('i9-11')||model.includes('i7-11'))return{level:'v3',generation:'Intel Core 11th/12th Gen'};if(model.includes('10th')||model.includes('i9-10')||model.includes('i7-10')||model.includes('i5-10'))return{level:'v3',generation:'Intel Core 10th Gen'};if(model.includes('8th')||model.includes('9th')||model.includes('i7-8')||model.includes('i7-9')||model.includes('i5-8')||model.includes('i5-9'))return{level:'v3',generation:'Intel Core 8th/9th Gen'};if(model.includes('6th')||model.includes('7th')||model.includes('i7-6')||model.includes('i7-7')||model.includes('i5-6')||model.includes('i5-7'))return{level:'v3',generation:'Intel Core 6th/7th Gen (Skylake/Kaby Lake)'};if(model.includes('4th')||model.includes('5th')||model.includes('i7-4')||model.includes('i7-5')||model.includes('i5-4')||model.includes('i5-5'))return{level:'v3',generation:'Intel Core 4th/5th Gen (Haswell/Broadwell)'};if(model.includes('3rd')||model.includes('2nd')||model.includes('i7-3')||model.includes('i7-2')||model.includes('i5-3')||model.includes('i5-2'))return{level:'v2-AES',generation:'Intel Core 2nd/3rd Gen (Sandy/Ivy Bridge)'};return{level:'v2-AES',generation:'Intel Core (Legacy)'};}// AMD EPYC generations (server CPUs)
if(model.includes('epyc')){// EPYC 9xx4 series (Genoa, Zen 4)
if(model.match(/9\d{3}/)||model.includes('genoa'))return{level:'v4',generation:'AMD EPYC Genoa (Zen 4)'};// EPYC 7xx3 series (Milan, Zen 3)
if(model.match(/7\d{2}3/)||model.match(/77\d{2}/)||model.includes('milan'))return{level:'v3',generation:'AMD EPYC Milan (Zen 3)'};// EPYC 7xx2 series (Rome, Zen 2)
if(model.match(/7\d{2}2/)||model.includes('rome'))return{level:'v3',generation:'AMD EPYC Rome (Zen 2)'};// EPYC 7xx1 series (Naples, Zen 1)
if(model.match(/7\d{2}1/)||model.includes('naples'))return{level:'v2-AES',generation:'AMD EPYC Naples (Zen 1)'};return{level:'v2-AES',generation:'AMD EPYC'};}// AMD Ryzen/Threadripper generations
if(model.includes('ryzen')||model.includes('threadripper')){if(model.includes('7000')||model.includes('9000')||model.match(/\d{1}-7\d{3}/)||model.match(/\d{1}-9\d{3}/))return{level:'v4',generation:'AMD Ryzen 7000/9000 (Zen 4)'};if(model.includes('5000')||model.includes('6000')||model.match(/\d{1}-5\d{3}/)||model.match(/\d{1}-6\d{3}/))return{level:'v3',generation:'AMD Ryzen 5000/6000 (Zen 3)'};if(model.includes('3000')||model.includes('4000')||model.match(/\d{1}-3\d{3}/)||model.match(/\d{1}-4\d{3}/))return{level:'v3',generation:'AMD Ryzen 3000/4000 (Zen 2)'};if(model.includes('1000')||model.includes('2000')||model.match(/\d{1}-1\d{3}/)||model.match(/\d{1}-2\d{3}/))return{level:'v2-AES',generation:'AMD Ryzen 1000/2000 (Zen/Zen+)'};return{level:'v2-AES',generation:'AMD Ryzen'};}// fallback for other/unknown CPUs
if(model.includes('amd'))return{level:'v2-AES',generation:'AMD (Unknown)'};if(model.includes('intel'))return{level:'v2-AES',generation:'Intel (Unknown)'};return{level:'v2-AES',generation:'Unknown CPU'};};// Determine recommended CPU level based on all nodes
const calculateRecommendedCpu=cpuInfoList=>{if(!cpuInfoList||cpuInfoList.length===0)return'x86-64-v2-AES';const levels=cpuInfoList.map(c=>c.detectedLevel);const levelOrder=['v2-AES','v3','v4'];// Find the lowest common denominator
let lowestIndex=levelOrder.length-1;for(const level of levels){const idx=levelOrder.indexOf(level);if(idx<lowestIndex&&idx>=0)lowestIndex=idx;}return`x86-64-${levelOrder[lowestIndex]}`;};// NS: authFetch wrapper with proper error handling
// Returns null on network failure so callers need to check
const authFetch=async function(url,options){options=options||{};try{const response=await fetch(url,{...options,credentials:'include',// NS: Security - use cookies for auth
headers:Object.assign({},options.headers,getAuthHeaders())});return response;}catch(err){console.error('Auth fetch error:',err);return null;}};const sections=[{id:'summary',labelKey:'summary',icon:Icons.Activity},{id:'cluster',labelKey:'cluster',icon:Icons.Server},{id:'options',labelKey:'options',icon:Icons.Settings},{id:'storage',labelKey:'storage',icon:Icons.HardDrive},{id:'sdn',labelKey:'sdn',icon:Icons.Network},{id:'backup',labelKey:'backup',icon:Icons.Clock},{id:'replication',labelKey:'replication',icon:Icons.RefreshCw},{id:'ha',labelKey:'proxmoxNativeHa',icon:Icons.Activity},{id:'cpucompat',labelKey:'cpuCompatibility',icon:Icons.Cpu},{id:'firewall',labelKey:'firewall',icon:Icons.Shield},{id:'ceph',labelKey:'ceph',icon:Icons.Database}];const storageTypes=[{id:'dir',label:'Directory',icon:'ðŸ“'},{id:'lvm',label:'LVM',icon:'ðŸ’¾'},{id:'lvmthin',label:'LVM-Thin',icon:'ðŸ’¾'},{id:'btrfs',label:'BTRFS',icon:'ðŸŒ²'},{id:'nfs',label:'NFS',icon:'ðŸŒ'},{id:'cifs',label:'SMB/CIFS',icon:'ðŸ–¥'},{id:'iscsi',label:'iSCSI',icon:'ðŸ”—'},{id:'cephfs',label:'CephFS',icon:'ðŸ™'},{id:'rbd',label:'RBD',icon:'ðŸ™'},{id:'zfs',label:'ZFS over iSCSI',icon:'âš¡'},{id:'zfspool',label:'ZFS',icon:'âš¡'},{id:'pbs',label:'Proxmox Backup Server',icon:'ðŸ’¼'},{id:'esxi',label:'ESXi',icon:'ðŸ–¥'}];const defaultOptions={keyboard:'de',http_proxy:'',console:'',email_from:'',mac_prefix:'BC:24:11',max_workers:4,// Migration (complex)
migration_type:'',migration_network:'',// HA (complex)
ha_shutdown_policy:'',// CRS (complex)
crs_ha_rebalance:'',crs_mode:'',// Next ID Range (complex)
next_id_lower:100,next_id_upper:999999999,// Bandwidth limits (complex)
bwlimit_clone:'',bwlimit_migration:'',bwlimit_move:'',bwlimit_restore:'',bwlimit_default:'',// Tags
user_tag_access:'free',registered_tags:'',// Tag Style (complex)
tag_style_shape:'',tag_style_color_map:'',tag_style_ordering:''};// MK: Parse complex options from API response into editable fields
const parseOptionsForEdit=opts=>{const parsed={...defaultOptions};// Simple fields
if(opts.keyboard)parsed.keyboard=opts.keyboard;if(opts.http_proxy)parsed.http_proxy=opts.http_proxy;if(opts.console)parsed.console=opts.console;if(opts.email_from)parsed.email_from=opts.email_from;if(opts.mac_prefix)parsed.mac_prefix=opts.mac_prefix;if(opts.max_workers)parsed.max_workers=opts.max_workers;// Migration: can be string "type=secure,network=10.0.0.0/24" or object {type, network}
if(opts.migration){if(typeof opts.migration==='object'){parsed.migration_type=opts.migration.type||'';parsed.migration_network=opts.migration.network||'';}else if(typeof opts.migration==='string'){opts.migration.split(',').forEach(part=>{const[k,v]=part.split('=');if(k==='type')parsed.migration_type=v;if(k==='network')parsed.migration_network=v;});}}// HA: can be object {shutdown_policy} or string
if(opts.ha){if(typeof opts.ha==='object'){parsed.ha_shutdown_policy=opts.ha.shutdown_policy||'';}else if(typeof opts.ha==='string'){opts.ha.split(',').forEach(part=>{const[k,v]=part.split('=');if(k==='shutdown_policy')parsed.ha_shutdown_policy=v;});}}// CRS: can be object {ha-rebalance-on-start, scheduling} or string
if(opts.crs){if(typeof opts.crs==='object'){parsed.crs_ha_rebalance=opts.crs['ha-rebalance-on-start']?'1':'';parsed.crs_mode=opts.crs.scheduling||'';}else if(typeof opts.crs==='string'){opts.crs.split(',').forEach(part=>{const[k,v]=part.split('=');if(k==='ha-rebalance-on-start')parsed.crs_ha_rebalance=v==='1'?'1':'';if(k==='scheduling')parsed.crs_mode=v;});}}// Next ID: can be object {lower, upper} or string
const nextId=opts['next-id']||opts.next_id;if(nextId){if(typeof nextId==='object'){parsed.next_id_lower=nextId.lower||100;parsed.next_id_upper=nextId.upper||999999999;}else if(typeof nextId==='string'){nextId.split(',').forEach(part=>{const[k,v]=part.split('=');if(k==='lower')parsed.next_id_lower=parseInt(v)||100;if(k==='upper')parsed.next_id_upper=parseInt(v)||999999999;});}}// Bandwidth limits: can be object or string
if(opts.bwlimit){if(typeof opts.bwlimit==='object'){parsed.bwlimit_clone=opts.bwlimit.clone||'';parsed.bwlimit_migration=opts.bwlimit.migration||'';parsed.bwlimit_move=opts.bwlimit.move||'';parsed.bwlimit_restore=opts.bwlimit.restore||'';parsed.bwlimit_default=opts.bwlimit.default||'';}else if(typeof opts.bwlimit==='string'){opts.bwlimit.split(',').forEach(part=>{const[k,v]=part.split('=');if(k==='clone')parsed.bwlimit_clone=v;if(k==='migration')parsed.bwlimit_migration=v;if(k==='move')parsed.bwlimit_move=v;if(k==='restore')parsed.bwlimit_restore=v;if(k==='default')parsed.bwlimit_default=v;});}}// Tag access - can be string "user-allow=free" or object
const userTagAccess=opts['user-tag-access']||opts.user_tag_access;if(userTagAccess){if(typeof userTagAccess==='string'&&userTagAccess.includes('=')){// Parse "user-allow=free" format
userTagAccess.split(',').forEach(part=>{const[k,v]=part.split('=');if(k==='user-allow')parsed.user_tag_access=v;});}else if(typeof userTagAccess==='object'&&userTagAccess['user-allow']){parsed.user_tag_access=userTagAccess['user-allow'];}else{parsed.user_tag_access=userTagAccess;}}// Registered tags
const regTags=opts['registered-tags']||opts.registered_tags;if(regTags)parsed.registered_tags=regTags;// Tag style: can be object or string
const tagStyle=opts['tag-style']||opts.tag_style;if(tagStyle){if(typeof tagStyle==='object'){parsed.tag_style_shape=tagStyle.shape||'';parsed.tag_style_color_map=tagStyle['color-map']||'';parsed.tag_style_ordering=tagStyle.ordering||'';}else if(typeof tagStyle==='string'){tagStyle.split(',').forEach(part=>{const[k,v]=part.split('=');if(k==='shape')parsed.tag_style_shape=v;if(k==='color-map')parsed.tag_style_color_map=v;if(k==='ordering')parsed.tag_style_ordering=v;});}}return parsed;};// MK: Load datacenter options from API
const loadOptions=async()=>{try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/options`);if(res?.ok){const opts=await res.json();setDcOptions(opts);setEditingOptions(parseOptionsForEdit(opts));}}catch(e){console.error('Failed to load datacenter options:',e);}};useEffect(()=>{fetchAllData();},[clusterId]);useEffect(()=>{if(activeSection==='ceph')fetchCephData();},[activeSection]);// NS: Dedicated function to refresh only storage list without full reload
const refreshStorage=async()=>{try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/storage`);if(res?.ok){const storageData=await res.json();console.log('Refreshed storage data:',storageData?.length||0,'items');setStorage(storageData);}}catch(e){console.error('Error refreshing storage:',e);}};const fetchAllData=async()=>{setLoading(true);try{// fetch everything in parallel
const results=await Promise.all([authFetch(`${API_URL}/clusters/${clusterId}/datacenter/status`),authFetch(`${API_URL}/clusters/${clusterId}/datacenter/cluster-info`),authFetch(`${API_URL}/clusters/${clusterId}/datacenter/options`),authFetch(`${API_URL}/clusters/${clusterId}/datacenter/storage`),authFetch(`${API_URL}/clusters/${clusterId}/datacenter/backup`),authFetch(`${API_URL}/clusters/${clusterId}/datacenter/replication`),authFetch(`${API_URL}/clusters/${clusterId}/datacenter/firewall/options`),authFetch(`${API_URL}/clusters/${clusterId}/datacenter/firewall/rules`),authFetch(`${API_URL}/clusters/${clusterId}/datacenter/join-info`),// MK: HA Data
authFetch(`${API_URL}/clusters/${clusterId}/datacenter/ha/status`),authFetch(`${API_URL}/clusters/${clusterId}/proxmox-ha/resources`),authFetch(`${API_URL}/clusters/${clusterId}/proxmox-ha/groups`),// LW: SDN Data - Feb 2026
authFetch(`${API_URL}/clusters/${clusterId}/datacenter/sdn`)]);const[r1,r2,r3,r4,r5,r6,r7,r8,r9,r10,r11,r12,r13]=results;if(r1?.ok)setDcStatus(await r1.json());if(r2?.ok){const tmp=await r2.json();// Fetch summary for each node - NS Jan 2026
const nodesWithSummary=await Promise.all((tmp||[]).map(async node=>{try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${node.node||node.name}/summary`);if(res?.ok){const summary=await res.json();return{...node,summary,name:node.node||node.name};}}catch(e){console.error('Failed to load node summary:',e);}return{...node,summary:null,name:node.node||node.name};}));setClusterNodes(nodesWithSummary);// Fetch CPU info for each online node
const online=(nodesWithSummary||[]).filter(n=>n.online!==0);const cpuPromises=online.map(async node=>{try{// Use already fetched summary if available
if(node.summary){const cpuModel=node.summary.cpuinfo?.model||'Unknown';const detected=detectCpuGeneration(cpuModel);return{node:node.name,model:cpuModel,cores:node.summary.cpuinfo?.cores||0,sockets:node.summary.cpuinfo?.sockets||1,detectedLevel:detected.level,generation:detected.generation};}const res=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${node.name}/summary`);if(res?.ok){const s=await res.json();const cpuModel=s.cpuinfo?.model||'Unknown';const detected=detectCpuGeneration(cpuModel);return{node:node.name,model:cpuModel,cores:s.cpuinfo?.cores||0,sockets:s.cpuinfo?.sockets||1,detectedLevel:detected.level,generation:detected.generation};}}catch(e){}return null;});const cpuResults=(await Promise.all(cpuPromises)).filter(Boolean);setCpuInfo(cpuResults);setRecommendedCpu(calculateRecommendedCpu(cpuResults));}if(r3?.ok){const opts=await r3.json();setDcOptions(opts);setEditingOptions(parseOptionsForEdit(opts));}if(r4?.ok){const storageData=await r4.json();console.log('Fetched storage data:',storageData?.length||0,'items');setStorage(storageData);}if(r5?.ok)setBackupJobs(await r5.json());if(r6?.ok)setReplicationJobs(await r6.json());if(r7?.ok)setFirewallOptions(await r7.json());if(r8?.ok)setFirewallRules(await r8.json());if(r9?.ok)setJoinInfo(await r9.json());// MK: HA Data
if(r10?.ok)setHaManagerStatus(await r10.json());if(r11?.ok)setHaResources(await r11.json());if(r12?.ok)setHaGroups(await r12.json());// MK: SDN Data - Feb 2026
if(r13?.ok){const sdnResponse=await r13.json();console.log('SDN API Response:',sdnResponse);setSdnData(sdnResponse);}else{console.log('SDN API failed:',r13?.status,r13?.statusText);}}catch(error){console.error('fetching datacenter data:',error);}finally{setLoading(false);}};const fetchJoinInfo=async()=>{try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/join-info`);if(res&&res.ok){const data=await res.json();setJoinInfo(data);setShowJoinInfo(true);}}catch(e){console.error(e);}};const fetchCephData=async()=>{setCephLoading(true);try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/ceph`);if(res?.ok){const d=await res.json();setCephData(d);if(d.node&&!cephNode)setCephNode(d.node);}}catch(e){console.error('Failed to load Ceph data:',e);}setCephLoading(false);};// NS: added PB for large storages, using toFixed(2) for more precision
const formatBytes=bytes=>{if(!bytes)return'0 B';const k=1024;const sizes=['B','KB','MB','GB','TB','PB'];const i=Math.floor(Math.log(bytes)/Math.log(k));return(bytes/Math.pow(k,i)).toFixed(2)+' '+sizes[i];};const saveOptions=async()=>{try{const payload={};// === Basic Settings ===
if(editingOptions.keyboard&&editingOptions.keyboard!==''){payload.keyboard=editingOptions.keyboard;}const validConsoleValues=['vv','html5','xtermjs'];if(editingOptions.console&&validConsoleValues.includes(editingOptions.console)){payload.console=editingOptions.console;}if(editingOptions.http_proxy&&editingOptions.http_proxy.trim()!==''){payload.http_proxy=editingOptions.http_proxy;}if(editingOptions.email_from&&editingOptions.email_from.includes('@')&&!editingOptions.email_from.includes('$')){payload.email_from=editingOptions.email_from;}if(editingOptions.mac_prefix&&/^[A-Fa-f0-9]{2}(:[A-Fa-f0-9]{2})*$/.test(editingOptions.mac_prefix)){payload.mac_prefix=editingOptions.mac_prefix.toUpperCase();}if(editingOptions.max_workers&&!isNaN(editingOptions.max_workers)){payload.max_workers=Math.max(1,Math.min(64,parseInt(editingOptions.max_workers)));}// === Migration Settings ===
const migrationParts=[];if(editingOptions.migration_type&&editingOptions.migration_type!==''){migrationParts.push(`type=${editingOptions.migration_type}`);}if(editingOptions.migration_network&&editingOptions.migration_network.trim()!==''){migrationParts.push(`network=${editingOptions.migration_network}`);}if(migrationParts.length>0){payload.migration=migrationParts.join(',');}// === HA Settings ===
if(editingOptions.ha_shutdown_policy&&editingOptions.ha_shutdown_policy!==''){payload.ha=`shutdown_policy=${editingOptions.ha_shutdown_policy}`;}// === CRS Settings ===
const crsParts=[];if(editingOptions.crs_ha_rebalance==='1'){crsParts.push('ha-rebalance-on-start=1');}if(editingOptions.crs_mode&&editingOptions.crs_mode!==''){crsParts.push(`scheduling=${editingOptions.crs_mode}`);}if(crsParts.length>0){payload.crs=crsParts.join(',');}// === Next ID Range ===
const nextIdParts=[];if(editingOptions.next_id_lower&&!isNaN(editingOptions.next_id_lower)){nextIdParts.push(`lower=${editingOptions.next_id_lower}`);}if(editingOptions.next_id_upper&&!isNaN(editingOptions.next_id_upper)){nextIdParts.push(`upper=${editingOptions.next_id_upper}`);}if(nextIdParts.length>0){payload['next-id']=nextIdParts.join(',');}// === Bandwidth Limits ===
const bwParts=[];if(editingOptions.bwlimit_clone&&editingOptions.bwlimit_clone!==''&&editingOptions.bwlimit_clone!=='0'){bwParts.push(`clone=${editingOptions.bwlimit_clone}`);}if(editingOptions.bwlimit_migration&&editingOptions.bwlimit_migration!==''&&editingOptions.bwlimit_migration!=='0'){bwParts.push(`migration=${editingOptions.bwlimit_migration}`);}if(editingOptions.bwlimit_move&&editingOptions.bwlimit_move!==''&&editingOptions.bwlimit_move!=='0'){bwParts.push(`move=${editingOptions.bwlimit_move}`);}if(editingOptions.bwlimit_restore&&editingOptions.bwlimit_restore!==''&&editingOptions.bwlimit_restore!=='0'){bwParts.push(`restore=${editingOptions.bwlimit_restore}`);}if(editingOptions.bwlimit_default&&editingOptions.bwlimit_default!==''&&editingOptions.bwlimit_default!=='0'){bwParts.push(`default=${editingOptions.bwlimit_default}`);}if(bwParts.length>0){payload.bwlimit=bwParts.join(',');}// === Tag Settings ===
// MK: user-tag-access is complex - Proxmox API is picky about format
// Skip for now - "free" is default anyway
// TODO: Implement proper format if needed
// registered-tags is simpler - just semicolon-separated list
if(editingOptions.registered_tags&&editingOptions.registered_tags.trim()!==''){payload['registered-tags']=editingOptions.registered_tags;}// === Tag Style ===
const tagStyleParts=[];if(editingOptions.tag_style_shape&&editingOptions.tag_style_shape!==''){tagStyleParts.push(`shape=${editingOptions.tag_style_shape}`);}if(editingOptions.tag_style_color_map&&editingOptions.tag_style_color_map!==''){tagStyleParts.push(`color-map=${editingOptions.tag_style_color_map}`);}if(editingOptions.tag_style_ordering&&editingOptions.tag_style_ordering!==''){tagStyleParts.push(`ordering=${editingOptions.tag_style_ordering}`);}if(tagStyleParts.length>0){payload['tag-style']=tagStyleParts.join(',');}console.log('Sending datacenter options:',payload);const res=await fetch(`${API_URL}/clusters/${clusterId}/datacenter/options`,{method:'PUT',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify(payload)});if(res.ok){// Refresh options from server to get latest state
await loadOptions();setShowEditOptions(false);addToast(t('optionsSaved')||'Options saved','success');}else{const err=await res.json();console.error('Datacenter options error:',err);addToast(err.errors?JSON.stringify(err.errors):err.error||'Failed to save options','error');}}catch(e){console.error(e);addToast('Failed to save options','error');}};const createStorage=async()=>{// NS: Improved validation - Dec 2025
// Validate required fields based on storage type
const requiredFields={dir:['path'],nfs:['server','export'],cifs:['server','share'],lvm:['vgname'],lvmthin:['vgname','thinpool'],iscsi:['portal','target'],rbd:['pool','monhost'],cephfs:['monhost'],zfspool:['pool'],zfs:['portal','target','pool'],pbs:['server','datastore','username','password'],btrfs:['path']};const required=requiredFields[newStorage.type]||[];const missing=required.filter(f=>!newStorage[f]);if(!newStorage.storage){addToast(t('storageIdRequired')||'Storage ID is required','error');return;}// Validate storage ID format
if(!/^[a-zA-Z][a-zA-Z0-9\-\_\.]*$/.test(newStorage.storage)){addToast(t('invalidStorageId')||'Storage ID must start with a letter and contain only letters, numbers, -, _, .','error');return;}if(missing.length>0){addToast(`${t('missingFields')||'Missing required fields'}: ${missing.join(', ')}`,'error');return;}// NS: Additional validation for Shared LVM - need base (storage:lun) when baseStorage is set
if(newStorage.type==='lvm'&&newStorage.baseStorage&&!newStorage.base){addToast('Please select a LUN for Shared LVM','error');return;}try{// Build storage data based on type
const storageData={...newStorage};// Remove UI-only fields that shouldn't be sent to API
delete storageData.baseStorage;// LW: This is UI-only, 'base' contains the actual value
// Remove empty fields
Object.keys(storageData).forEach(key=>{if(storageData[key]===''||storageData[key]===undefined){delete storageData[key];}});// Convert enabled to disable (Proxmox uses disable=1 to disable)
if(storageData.enabled===false){storageData.disable=1;}delete storageData.enabled;// NS: Debug output for troubleshooting
console.log('=== Storage Creation Debug ===');console.log('Type:',storageData.type);console.log('ID:',storageData.storage);console.log('Base:',storageData.base);console.log('VGName:',storageData.vgname);console.log('Full data:',JSON.stringify(storageData,null,2));const res=await fetch(`${API_URL}/clusters/${clusterId}/datacenter/storage`,{method:'POST',credentials:'include',headers:{...authHeaders,'Content-Type':'application/json'},body:JSON.stringify(storageData)});const data=await res.json();console.log('Create storage response:',res.status,data);if(res.ok&&data.success){setShowAddStorage(false);setNewStorage({type:'dir',storage:'',path:'',content:'images,rootdir',enabled:true});setScanResults([]);// Clear scan results
addToast(t('storageCreated')||'Storage created successfully','success');// NS: Only refresh storage list, not everything
await refreshStorage();}else{console.error('Storage creation failed:',data);const errorMsg=data.error||data.message||'Failed to create storage';addToast(`Error: ${errorMsg}`,'error');}}catch(e){console.error('Create storage error:',e);addToast(`Error creating storage: ${e.message}`,'error');}};// NS: Scan storage targets (iSCSI, NFS, CIFS, etc.)
const[scanning,setScanning]=useState(false);const[scanResults,setScanResults]=useState([]);const scanStorage=async type=>{setScanning(true);setScanResults([]);try{const scanData={type};// Add required params for each type
if(type==='iscsi'&&newStorage.portal){scanData.portal=newStorage.portal;}else if(type==='nfs'&&newStorage.server){scanData.server=newStorage.server;}else if(type==='cifs'&&newStorage.server){scanData.server=newStorage.server;if(newStorage.username)scanData.username=newStorage.username;if(newStorage.password)scanData.password=newStorage.password;if(newStorage.domain)scanData.domain=newStorage.domain;}else if(type==='lvmthin'&&newStorage.vgname){scanData.vgname=newStorage.vgname;}else if(type==='lvm'){// No extra params needed
}else if(type==='zfs'){// No extra params needed
}else{addToast(t('enterServerFirst')||'Please enter server/portal address first','warning');setScanning(false);return;}const res=await fetch(`${API_URL}/clusters/${clusterId}/storage/scan`,{method:'POST',credentials:'include',headers:{...authHeaders,'Content-Type':'application/json'},body:JSON.stringify(scanData)});const data=await res.json();if(res.ok&&data.success){setScanResults(data.data||[]);if(data.data?.length===0){addToast(t('noTargetsFound')||'No targets found','warning');}}else{addToast(`Scan failed: ${data.error}`,'error');}}catch(e){console.error('Scan error:',e);addToast(`Scan error: ${e.message}`,'error');}finally{setScanning(false);}};const deleteStorage=async storageId=>{if(!confirm(t('deleteStorageConfirm')))return;try{const res=await fetch(`${API_URL}/clusters/${clusterId}/datacenter/storage/${storageId}`,{method:'DELETE',credentials:'include',headers:authHeaders});if(res.ok){setStorage(storage.filter(s=>s.storage!==storageId));}else{const data=await res.json();alert(`Error: ${data.error||'Failed to delete storage'}`);}}catch(e){console.error('Delete storage error:',e);// dont show alert here, too annoying
}};// NS: backup job stuff below
const deleteBackupJob=async jobId=>{if(!confirm(t('deleteBackupJobConfirm')))return;try{const res=await fetch(`${API_URL}/clusters/${clusterId}/datacenter/backup/${jobId}`,{method:'DELETE',credentials:'include',headers:authHeaders});if(res.ok)setBackupJobs(backupJobs.filter(j=>j.id!==jobId));}catch(e){/* ignore */}};const createBackupJob=async()=>{try{const jobData={...newBackupJob};// Convert schedule to Proxmox systemd calender format
// Proxmox uses systemd calender events, not cron!
const scheduleMap={'daily':'02:00',// Daily at 2 AM
'weekly':'sun 02:00',// Sunday at 2 AM
'monthly':'*-*-01 02:00',// First of month at 2 AM
'hourly':'*:00'// Every hour
};if(scheduleMap[jobData.schedule]){jobData.schedule=scheduleMap[jobData.schedule];}// handle vmid: if empty or 'all', set all=1 flag
if(!jobData.vmid||jobData.vmid===''||jobData.vmid==='all'){jobData.all=1;delete jobData.vmid;}// Remove empty fileds (but not 'all')
Object.keys(jobData).forEach(key=>{if(key!=='all'&&(jobData[key]===''||jobData[key]===null)){delete jobData[key];}});const res=await fetch(`${API_URL}/clusters/${clusterId}/datacenter/backup`,{method:'POST',credentials:'include',headers:{...authHeaders,'Content-Type':'application/json'},body:JSON.stringify(jobData)});if(res.ok){setShowAddBackupJob(false);setNewBackupJob({enabled:1,schedule:'daily',storage:'',mode:'snapshot',compress:'zstd',vmid:'',node:'',mailnotification:'always',mailto:''});// Reload backup jobs
const backupRes=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/backup`);if(backupRes&&backupRes.ok)setBackupJobs(await backupRes.json());}else{const err=await res.json();alert(err.error||'Failed');}}catch(e){console.error(e);}};const deleteFirewallRule=async pos=>{if(!confirm(t('deleteRuleConfirm')))return;try{const res=await fetch(`${API_URL}/clusters/${clusterId}/datacenter/firewall/rules/${pos}`,{method:'DELETE',credentials:'include',headers:authHeaders});if(res.ok)setFirewallRules(firewallRules.filter(r=>r.pos!==pos));}catch(e){console.error(e);}};if(loading){return/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center h-64"},/*#__PURE__*/React.createElement(Icons.RotateCw,null),/*#__PURE__*/React.createElement("span",{className:"ml-2"},t('loadingDatacenter')||'Loading datacenter data / Lade Datacenter Daten...'));}return/*#__PURE__*/React.createElement("div",{className:"flex gap-6"},/*#__PURE__*/React.createElement("div",{className:"w-48 flex-shrink-0"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-3 sticky top-6"},/*#__PURE__*/React.createElement("nav",{className:"space-y-1"},sections.map(section=>/*#__PURE__*/React.createElement("button",{key:section.id,onClick:()=>setActiveSection(section.id),className:`w-full flex items-center gap-2 px-3 py-2 rounded-lg text-sm transition-all ${activeSection===section.id?'bg-proxmox-orange text-white':'text-gray-400 hover:bg-proxmox-dark hover:text-white'}`},/*#__PURE__*/React.createElement(section.icon,null),t(section.labelKey)))))),/*#__PURE__*/React.createElement("div",{className:"flex-1 space-y-6"},activeSection==='summary'&&dcStatus&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-6"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-4 text-green-400"},"Status"),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center"},/*#__PURE__*/React.createElement("div",{className:`w-20 h-20 rounded-full flex items-center justify-center text-3xl ${dcStatus.cluster?.standalone?'bg-blue-500/20 text-blue-400':dcStatus.cluster?.quorate?'bg-green-500/20 text-green-400':'bg-red-500/20 text-red-400'}`},dcStatus.cluster?.standalone?'â—':dcStatus.cluster?.quorate?'âœ“':'âœ—')),/*#__PURE__*/React.createElement("p",{className:"text-center mt-4 text-sm text-gray-400"},dcStatus.cluster?.standalone?`${dcStatus.cluster?.name} | Standalone Node`:`${dcStatus.cluster?.name} | Quorate: ${dcStatus.cluster?.quorate?'Yes':'No'}`)),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-4"},"Nodes"),/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-green-400"},"\u25CF Online"),/*#__PURE__*/React.createElement("span",{className:"font-bold text-xl"},dcStatus.nodes?.online||0)),/*#__PURE__*/React.createElement("div",{className:"flex justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-red-400"},"\u2717 Offline"),/*#__PURE__*/React.createElement("span",{className:"font-bold text-xl"},dcStatus.nodes?.offline||0))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-4 text-cyan-400"},"Guests"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-6"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h4",{className:"font-medium mb-3"},"Virtual Machines"),/*#__PURE__*/React.createElement("div",{className:"space-y-2 text-sm"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-green-400"},"\u25CF Running"),/*#__PURE__*/React.createElement("span",null,dcStatus.guests?.vms?.running||0)),/*#__PURE__*/React.createElement("div",{className:"flex justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"\u25CB Stopped"),/*#__PURE__*/React.createElement("span",null,dcStatus.guests?.vms?.stopped||0)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h4",{className:"font-medium mb-3"},"LXC Container"),/*#__PURE__*/React.createElement("div",{className:"space-y-2 text-sm"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-green-400"},"\u25CF Running"),/*#__PURE__*/React.createElement("span",null,dcStatus.guests?.containers?.running||0)),/*#__PURE__*/React.createElement("div",{className:"flex justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"\u25CB Stopped"),/*#__PURE__*/React.createElement("span",null,dcStatus.guests?.containers?.stopped||0)))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-4 text-yellow-400"},"Resources"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-6"},['cpu','memory','storage'].map(type=>/*#__PURE__*/React.createElement("div",{key:type,className:"text-center"},/*#__PURE__*/React.createElement("h4",{className:"font-medium mb-3 capitalize"},type),/*#__PURE__*/React.createElement("div",{className:"text-3xl font-bold text-blue-400"},dcStatus.resources?.[type]?.percent||0,"%"),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-2"},type==='cpu'?`${dcStatus.resources?.cpu?.total||0} CPU(s)`:formatBytes(dcStatus.resources?.[type]?.total))))))),activeSection==='cluster'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Info,null),"Cluster Information")),/*#__PURE__*/React.createElement("div",{className:"p-4 grid grid-cols-1 md:grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-500 mb-1"},"Cluster Name"),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("input",{readOnly:true,value:joinInfo?.cluster_name||dcStatus?.cluster?.name||'Loading...',className:"flex-1 bg-proxmox-dark border border-proxmox-border rounded px-3 py-2 font-mono text-sm"}),/*#__PURE__*/React.createElement("button",{onClick:()=>navigator.clipboard.writeText(joinInfo?.cluster_name||dcStatus?.cluster?.name||''),className:"p-2 bg-proxmox-dark hover:bg-proxmox-border rounded transition-colors",title:"Copy"},/*#__PURE__*/React.createElement(Icons.Copy,null)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-500 mb-1"},"Cluster IP / Join Address"),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("input",{readOnly:true,value:joinInfo?.preferred_node||clusterNodes[0]?.ring0_addr||clusterNodes[0]?.ip||'Loading...',className:"flex-1 bg-proxmox-dark border border-proxmox-border rounded px-3 py-2 font-mono text-sm"}),/*#__PURE__*/React.createElement("button",{onClick:()=>navigator.clipboard.writeText(joinInfo?.preferred_node||clusterNodes[0]?.ring0_addr||''),className:"p-2 bg-proxmox-dark hover:bg-proxmox-border rounded transition-colors",title:"Copy"},/*#__PURE__*/React.createElement(Icons.Copy,null)))),/*#__PURE__*/React.createElement("div",{className:"md:col-span-2"},/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-500 mb-1"},"Fingerprint"),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("textarea",{readOnly:true,value:joinInfo?.fingerprint||'Loading... (If empty, run "pvecm status" on a node)',className:"flex-1 bg-proxmox-dark border border-proxmox-border rounded px-3 py-2 font-mono text-xs h-16 resize-none"}),/*#__PURE__*/React.createElement("button",{onClick:()=>navigator.clipboard.writeText(joinInfo?.fingerprint||''),className:"p-2 bg-proxmox-dark hover:bg-proxmox-border rounded transition-colors self-start",title:"Copy"},/*#__PURE__*/React.createElement(Icons.Copy,null)))),joinInfo?.nodelist&&joinInfo.nodelist.length>0&&/*#__PURE__*/React.createElement("div",{className:"md:col-span-2"},/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-500 mb-1"},"Available Join Nodes"),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-2"},joinInfo.nodelist.map((node,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"px-3 py-1.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-sm font-mono"},node.name,": ",node.ring0_addr||node.pve_addr))))),/*#__PURE__*/React.createElement("div",{className:"px-4 pb-4"},/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},t('nodeJoinHint')||'To add a new node, run on the new node:'," ",/*#__PURE__*/React.createElement("code",{className:"bg-proxmox-dark px-1 rounded"},"pvecm add ",joinInfo?.preferred_node||clusterNodes[0]?.ring0_addr||'IP')))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},"Cluster Nodes"),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-400"},(clusterNodes||[]).length," Node(s)"),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowNodeJoinWizard(true),className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm text-white"},/*#__PURE__*/React.createElement(Icons.Plus,{className:"w-4 h-4"}),"Add Node"))),/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Nodename"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"ID"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Votes"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Ring 0 Address"))),/*#__PURE__*/React.createElement("tbody",null,(clusterNodes||[]).map((node,idx)=>/*#__PURE__*/React.createElement("tr",{key:idx,className:"border-t border-proxmox-border hover:bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("td",{className:"p-3 font-medium"},node.name),/*#__PURE__*/React.createElement("td",{className:"p-3"},node.nodeid),/*#__PURE__*/React.createElement("td",{className:"p-3"},node.quorum_votes||1),/*#__PURE__*/React.createElement("td",{className:"p-3 font-mono text-sm"},node.ring0_addr||node.ip||'-'))))))),activeSection==='options'&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},"Datacenter Options"),/*#__PURE__*/React.createElement("button",{onClick:()=>{if(!showEditOptions){// MK: Parse complex options when opening edit form
setEditingOptions(parseOptionsForEdit(dcOptions));}setShowEditOptions(!showEditOptions);},className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-dark hover:bg-proxmox-border rounded-lg text-sm"},/*#__PURE__*/React.createElement(Icons.Edit,null)," Edit")),showEditOptions?/*#__PURE__*/React.createElement("div",{className:"p-4 space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Keyboard Layout"),/*#__PURE__*/React.createElement("select",{value:editingOptions.keyboard||'de',onChange:e=>setEditingOptions({...editingOptions,keyboard:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:"de"},"German (de)"),/*#__PURE__*/React.createElement("option",{value:"de-ch"},"German (Swiss)"),/*#__PURE__*/React.createElement("option",{value:"en-us"},"English (US)"),/*#__PURE__*/React.createElement("option",{value:"en-gb"},"English (GB)"),/*#__PURE__*/React.createElement("option",{value:"fr"},"French"),/*#__PURE__*/React.createElement("option",{value:"fr-ch"},"French (Swiss)"),/*#__PURE__*/React.createElement("option",{value:"es"},"Spanish"),/*#__PURE__*/React.createElement("option",{value:"it"},"Italian"),/*#__PURE__*/React.createElement("option",{value:"nl"},"Dutch"),/*#__PURE__*/React.createElement("option",{value:"pl"},"Polish"),/*#__PURE__*/React.createElement("option",{value:"pt"},"Portuguese"),/*#__PURE__*/React.createElement("option",{value:"pt-br"},"Portuguese (Brazil)"),/*#__PURE__*/React.createElement("option",{value:"ru"},"Russian"),/*#__PURE__*/React.createElement("option",{value:"ja"},"Japanese"),/*#__PURE__*/React.createElement("option",{value:"sv"},"Swedish"),/*#__PURE__*/React.createElement("option",{value:"no"},"Norwegian"),/*#__PURE__*/React.createElement("option",{value:"da"},"Danish"),/*#__PURE__*/React.createElement("option",{value:"fi"},"Finnish"),/*#__PURE__*/React.createElement("option",{value:"tr"},"Turkish"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Console Viewer"),/*#__PURE__*/React.createElement("select",{value:editingOptions.console||'',onChange:e=>setEditingOptions({...editingOptions,console:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Default (xterm.js)"),/*#__PURE__*/React.createElement("option",{value:"xtermjs"},"xterm.js"),/*#__PURE__*/React.createElement("option",{value:"html5"},"noVNC"),/*#__PURE__*/React.createElement("option",{value:"vv"},"SPICE (virt-viewer)"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"HTTP Proxy"),/*#__PURE__*/React.createElement("input",{value:editingOptions.http_proxy||'',onChange:e=>setEditingOptions({...editingOptions,http_proxy:e.target.value}),placeholder:"http://proxy:port",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Email from address"),/*#__PURE__*/React.createElement("input",{value:editingOptions.email_from||'',onChange:e=>setEditingOptions({...editingOptions,email_from:e.target.value}),placeholder:"root@$hostname",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"MAC address prefix"),/*#__PURE__*/React.createElement("input",{value:editingOptions.mac_prefix||'',onChange:e=>setEditingOptions({...editingOptions,mac_prefix:e.target.value}),placeholder:"BC:24:11",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm font-mono"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Max Workers/bulk-action"),/*#__PURE__*/React.createElement("input",{type:"number",min:"1",max:"64",value:editingOptions.max_workers||4,onChange:e=>setEditingOptions({...editingOptions,max_workers:parseInt(e.target.value)||4}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"}))),/*#__PURE__*/React.createElement("div",{className:"border-t border-proxmox-border pt-4"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-gray-300 mb-3"},"Migration Settings"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Migration Type"),/*#__PURE__*/React.createElement("select",{value:editingOptions.migration_type||'',onChange:e=>setEditingOptions({...editingOptions,migration_type:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Default (secure)"),/*#__PURE__*/React.createElement("option",{value:"secure"},"Secure (encrypted)"),/*#__PURE__*/React.createElement("option",{value:"insecure"},"Insecure (faster)"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Migration Network"),/*#__PURE__*/React.createElement("input",{value:editingOptions.migration_network||'',onChange:e=>setEditingOptions({...editingOptions,migration_network:e.target.value}),placeholder:"e.g. 10.0.0.0/24",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm font-mono"}),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},"CIDR network for migration traffic")))),/*#__PURE__*/React.createElement("div",{className:"border-t border-proxmox-border pt-4"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-gray-300 mb-3"},"HA Settings"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Shutdown Policy"),/*#__PURE__*/React.createElement("select",{value:editingOptions.ha_shutdown_policy||'',onChange:e=>setEditingOptions({...editingOptions,ha_shutdown_policy:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Default (conditional)"),/*#__PURE__*/React.createElement("option",{value:"freeze"},"Freeze - keep resources frozen on shutdown"),/*#__PURE__*/React.createElement("option",{value:"failover"},"Failover - migrate to other node"),/*#__PURE__*/React.createElement("option",{value:"migrate"},"Migrate - always migrate"),/*#__PURE__*/React.createElement("option",{value:"conditional"},"Conditional - migrate if possible"))))),/*#__PURE__*/React.createElement("div",{className:"border-t border-proxmox-border pt-4"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-gray-300 mb-3"},"Cluster Resource Scheduling (CRS)"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"HA Rebalance on Start"),/*#__PURE__*/React.createElement("select",{value:editingOptions.crs_ha_rebalance||'',onChange:e=>setEditingOptions({...editingOptions,crs_ha_rebalance:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Disabled"),/*#__PURE__*/React.createElement("option",{value:"1"},"Enabled - auto-rebalance HA resources on node start"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"CRS Scheduling Mode"),/*#__PURE__*/React.createElement("select",{value:editingOptions.crs_mode||'',onChange:e=>setEditingOptions({...editingOptions,crs_mode:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Default (basic)"),/*#__PURE__*/React.createElement("option",{value:"basic"},"Basic - simple load distribution"),/*#__PURE__*/React.createElement("option",{value:"static"},"Static - consider static resource config"))))),/*#__PURE__*/React.createElement("div",{className:"border-t border-proxmox-border pt-4"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-gray-300 mb-3"},"Next Free VMID Range"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Lower Bound"),/*#__PURE__*/React.createElement("input",{type:"number",min:"100",max:"999999999",value:editingOptions.next_id_lower||100,onChange:e=>setEditingOptions({...editingOptions,next_id_lower:parseInt(e.target.value)||100}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Upper Bound"),/*#__PURE__*/React.createElement("input",{type:"number",min:"100",max:"999999999",value:editingOptions.next_id_upper||999999999,onChange:e=>setEditingOptions({...editingOptions,next_id_upper:parseInt(e.target.value)||999999999}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})))),/*#__PURE__*/React.createElement("div",{className:"border-t border-proxmox-border pt-4"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-gray-300 mb-3"},"Bandwidth Limits (MiB/s, 0 = unlimited)"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Clone"),/*#__PURE__*/React.createElement("input",{type:"number",min:"0",value:editingOptions.bwlimit_clone||'',onChange:e=>setEditingOptions({...editingOptions,bwlimit_clone:e.target.value}),placeholder:"0",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Migration"),/*#__PURE__*/React.createElement("input",{type:"number",min:"0",value:editingOptions.bwlimit_migration||'',onChange:e=>setEditingOptions({...editingOptions,bwlimit_migration:e.target.value}),placeholder:"0",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Move"),/*#__PURE__*/React.createElement("input",{type:"number",min:"0",value:editingOptions.bwlimit_move||'',onChange:e=>setEditingOptions({...editingOptions,bwlimit_move:e.target.value}),placeholder:"0",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Restore"),/*#__PURE__*/React.createElement("input",{type:"number",min:"0",value:editingOptions.bwlimit_restore||'',onChange:e=>setEditingOptions({...editingOptions,bwlimit_restore:e.target.value}),placeholder:"0",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Default"),/*#__PURE__*/React.createElement("input",{type:"number",min:"0",value:editingOptions.bwlimit_default||'',onChange:e=>setEditingOptions({...editingOptions,bwlimit_default:e.target.value}),placeholder:"0",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})))),/*#__PURE__*/React.createElement("div",{className:"border-t border-proxmox-border pt-4"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-gray-300 mb-3"},"Tag Settings"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"User Tag Access"),/*#__PURE__*/React.createElement("select",{value:editingOptions.user_tag_access||'free',disabled:true,className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm opacity-50 cursor-not-allowed"},/*#__PURE__*/React.createElement("option",{value:"free"},"Free - users can create any tags"),/*#__PURE__*/React.createElement("option",{value:"existing"},"Existing - only use existing tags"),/*#__PURE__*/React.createElement("option",{value:"list"},"List - only use registered tags"),/*#__PURE__*/React.createElement("option",{value:"none"},"None - no tag editing allowed")),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},"Edit via Proxmox UI")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Registered Tags"),/*#__PURE__*/React.createElement("input",{value:editingOptions.registered_tags||'',onChange:e=>setEditingOptions({...editingOptions,registered_tags:e.target.value}),placeholder:"tag1;tag2;tag3",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"}),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},"Semicolon-separated list of allowed tags")))),/*#__PURE__*/React.createElement("div",{className:"border-t border-proxmox-border pt-4"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-gray-300 mb-3"},"Tag Style Override"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Shape"),/*#__PURE__*/React.createElement("select",{value:editingOptions.tag_style_shape||'',onChange:e=>setEditingOptions({...editingOptions,tag_style_shape:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Default"),/*#__PURE__*/React.createElement("option",{value:"full"},"Full"),/*#__PURE__*/React.createElement("option",{value:"circle"},"Circle"),/*#__PURE__*/React.createElement("option",{value:"dense"},"Dense"),/*#__PURE__*/React.createElement("option",{value:"none"},"None"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Color Mode"),/*#__PURE__*/React.createElement("select",{value:editingOptions.tag_style_color_map||'',onChange:e=>setEditingOptions({...editingOptions,tag_style_color_map:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Default"),/*#__PURE__*/React.createElement("option",{value:"auto"},"Auto - generate from tag name"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Ordering"),/*#__PURE__*/React.createElement("select",{value:editingOptions.tag_style_ordering||'',onChange:e=>setEditingOptions({...editingOptions,tag_style_ordering:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Default (config)"),/*#__PURE__*/React.createElement("option",{value:"config"},"Config order"),/*#__PURE__*/React.createElement("option",{value:"alphabetical"},"Alphabetical"))))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("button",{onClick:saveOptions,className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm"},t('save')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowEditOptions(false),className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-border rounded-lg text-sm"},t('cancel')))):/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("tbody",null,(()=>{// MK: Helper to safely format values - API sometimes returns objects
const formatVal=(val,fallback='Default')=>{if(val===null||val===undefined||val==='')return fallback;if(typeof val==='object'){// Convert object to readable string
return Object.entries(val).map(([k,v])=>`${k}: ${v}`).join(', ')||fallback;}return String(val);};return[['Keyboard Layout',formatVal(dcOptions.keyboard,'German (de)')],['HTTP proxy',formatVal(dcOptions.http_proxy,'none')],['Console Viewer',formatVal(dcOptions.console,'Default (xterm.js)')],['Email from address',formatVal(dcOptions.email_from,'root@$hostname')],['MAC address prefix',formatVal(dcOptions.mac_prefix,'BC:24:11')],['Migration Settings',formatVal(dcOptions.migration,'Default')],['HA Settings',formatVal(dcOptions.ha,'Default')],['Cluster Resource Scheduling',formatVal(dcOptions.crs,'Default')],['U2F Settings',formatVal(dcOptions.u2f,'None')],['WebAuthn Settings',formatVal(dcOptions.webauthn,'None')],['Bandwidth Limits',formatVal(dcOptions.bwlimit,'None')],['Maximal Workers/bulk-action',formatVal(dcOptions.max_workers,'4')],['Next Free VMID Range',formatVal(dcOptions['next-id'],'Default')],['Tag Style Override',formatVal(dcOptions['tag-style'],'No Overrides')],['User Tag Access',formatVal(dcOptions['user-tag-access'],'Mode: free')],['Registered Tags',formatVal(dcOptions['registered-tags'],'No Registered Tags')]].map(([key,value],idx)=>/*#__PURE__*/React.createElement("tr",{key:idx,className:"border-t border-proxmox-border hover:bg-proxmox-dark/30"},/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400 w-1/3"},key),/*#__PURE__*/React.createElement("td",{className:"p-3"},value)));})()))),activeSection==='storage'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.HardDrive,null),"Storage Configuration"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("button",{onClick:refreshStorage,className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-dark hover:bg-proxmox-hover border border-proxmox-border rounded-lg text-sm transition-colors",title:"Refresh storage list"},/*#__PURE__*/React.createElement(Icons.RefreshCw,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddStorage(true),className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm text-white transition-colors"},/*#__PURE__*/React.createElement(Icons.Plus,null)," ",t('add')))),/*#__PURE__*/React.createElement("div",{className:"overflow-x-auto"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"ID"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('type')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Content"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Path/Server"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('nodes')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Shared"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('status')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"}))),/*#__PURE__*/React.createElement("tbody",null,!storage||storage.length===0?/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:"8",className:"p-8 text-center text-gray-500"},"No storage configured")):storage.map((s,idx)=>/*#__PURE__*/React.createElement("tr",{key:idx,className:"border-t border-proxmox-border hover:bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:`w-2 h-2 rounded-full ${s.disable?'bg-gray-500':'bg-green-500'}`}),/*#__PURE__*/React.createElement("span",{className:"font-medium text-white"},s.storage))),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:"px-2 py-0.5 bg-proxmox-dark rounded text-xs text-gray-300"},s.type)),/*#__PURE__*/React.createElement("td",{className:"p-3 text-sm text-gray-400 max-w-48"},/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-1"},(s.content||'').split(',').map((c,i)=>/*#__PURE__*/React.createElement("span",{key:i,className:"px-1.5 py-0.5 bg-blue-500/20 text-blue-400 rounded text-xs"},c.trim())))),/*#__PURE__*/React.createElement("td",{className:"p-3 font-mono text-sm text-gray-400 max-w-40 truncate"},s.path||s.server||s.pool||s.portal||s.export||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-sm text-gray-400"},s.nodes||/*#__PURE__*/React.createElement("span",{className:"text-gray-500 italic"},"All")),/*#__PURE__*/React.createElement("td",{className:"p-3"},s.shared?/*#__PURE__*/React.createElement("span",{className:"text-green-400"},"\u2713"):/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"-")),/*#__PURE__*/React.createElement("td",{className:"p-3"},s.disable?/*#__PURE__*/React.createElement("span",{className:"px-2 py-0.5 bg-red-500/20 text-red-400 rounded text-xs"},t('disabled')):/*#__PURE__*/React.createElement("span",{className:"px-2 py-0.5 bg-green-500/20 text-green-400 rounded text-xs"},t('enabled'))),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("div",{className:"flex gap-1"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setNewStorage({...s,enabled:!s.disable});setShowAddStorage(true);},className:"p-1.5 hover:bg-blue-500/20 rounded text-blue-400 transition-colors",title:"Edit"},/*#__PURE__*/React.createElement(Icons.Cog,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>deleteStorage(s.storage),className:"p-1.5 hover:bg-red-500/20 rounded text-red-400 transition-colors",title:t('delete')},/*#__PURE__*/React.createElement(Icons.Trash,null)))))))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Layers,{className:"text-purple-400"}),"Multipath Redundancy"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{setMultipathLoading(true);try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/multipath/status`);if(res.ok){const data=await res.json();setMultipathStatus(data);}}catch(e){console.error('Failed to get multipath status:',e);}setMultipathLoading(false);},className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-dark hover:bg-proxmox-hover border border-proxmox-border rounded-lg text-sm"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:multipathLoading?'animate-spin':''}),t('refresh')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{// Load current status first
setMultipathLoading(true);try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/multipath/status`);if(res.ok){setMultipathStatus(await res.json());}}catch(e){}setMultipathLoading(false);setShowMultipathSetup(true);},className:"flex items-center gap-2 px-3 py-1.5 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm"},/*#__PURE__*/React.createElement(Icons.Zap,null)," Easy Setup"))),/*#__PURE__*/React.createElement("div",{className:"p-4"},!multipathStatus?/*#__PURE__*/React.createElement("div",{className:"text-center text-gray-500 py-4"},/*#__PURE__*/React.createElement("p",null,"Click refresh to check multipath status across all nodes."),/*#__PURE__*/React.createElement("p",{className:"text-xs mt-2"},"Multipath provides redundant SAN/iSCSI connectivity for high availability.")):/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-3 text-center"},/*#__PURE__*/React.createElement("div",{className:"text-2xl font-bold"},multipathStatus.summary?.nodes_with_multipath||0),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-400"},"Nodes with Multipath")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-3 text-center"},/*#__PURE__*/React.createElement("div",{className:"text-2xl font-bold"},multipathStatus.summary?.total_devices||0),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-400"},"Total Devices")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-3 text-center"},/*#__PURE__*/React.createElement("div",{className:"text-2xl font-bold text-green-400"},multipathStatus.summary?.healthy_devices||0),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-400"},"Healthy")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-3 text-center"},/*#__PURE__*/React.createElement("div",{className:"text-2xl font-bold text-yellow-400"},multipathStatus.summary?.degraded_devices||0),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-400"},"Degraded")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-3 text-center"},/*#__PURE__*/React.createElement("div",{className:"text-2xl font-bold text-red-400"},multipathStatus.summary?.failed_devices||0),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-400"},"Failed"))),Object.entries(multipathStatus.nodes||{}).map(([nodeName,nodeData])=>/*#__PURE__*/React.createElement("div",{key:nodeName,className:"bg-proxmox-dark rounded-lg p-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-2"},/*#__PURE__*/React.createElement("span",{className:"font-medium flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Server,{className:"w-4 h-4"}),nodeName),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},nodeData.running?/*#__PURE__*/React.createElement("span",{className:"px-2 py-0.5 bg-green-500/20 text-green-400 rounded text-xs"},"multipathd running"):nodeData.installed?/*#__PURE__*/React.createElement("span",{className:"px-2 py-0.5 bg-yellow-500/20 text-yellow-400 rounded text-xs"},"installed but stopped"):/*#__PURE__*/React.createElement("span",{className:"px-2 py-0.5 bg-gray-500/20 text-gray-400 rounded text-xs"},"not installed"))),nodeData.devices&&nodeData.devices.length>0&&/*#__PURE__*/React.createElement("div",{className:"mt-2 space-y-1"},nodeData.devices.map((dev,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"flex items-center justify-between text-sm bg-proxmox-card/50 rounded px-2 py-1"},/*#__PURE__*/React.createElement("span",{className:"font-mono text-purple-400"},"/dev/mapper/",dev.name),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},dev.size_gb," GB"),/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs ${dev.status==='healthy'?'bg-green-500/20 text-green-400':dev.status==='degraded'?'bg-yellow-500/20 text-yellow-400':'bg-red-500/20 text-red-400'}`},dev.active_paths,"/",dev.total_paths," paths"))))),nodeData.error&&/*#__PURE__*/React.createElement("div",{className:"text-xs text-red-400 mt-1"},nodeData.error)))))),showMultipathSetup&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Zap,{className:"text-purple-400"}),"Multipath Easy Setup"),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowMultipathSetup(false),className:"text-gray-400 hover:text-white"},/*#__PURE__*/React.createElement(Icons.X,null))),/*#__PURE__*/React.createElement("div",{className:"p-4 space-y-4"},/*#__PURE__*/React.createElement("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-3 text-sm"},/*#__PURE__*/React.createElement("p",{className:"text-blue-400 font-medium mb-1"},"What this does:"),/*#__PURE__*/React.createElement("ul",{className:"text-gray-300 text-xs space-y-1 list-disc list-inside"},/*#__PURE__*/React.createElement("li",null,"Installs multipath-tools on all nodes (if not already installed)"),/*#__PURE__*/React.createElement("li",null,"Generates optimized multipath.conf for your storage vendor"),/*#__PURE__*/React.createElement("li",null,"Enables and starts multipathd service"),/*#__PURE__*/React.createElement("li",null,"Scans for existing multipath devices")),/*#__PURE__*/React.createElement("p",{className:"text-green-400 text-xs mt-2"},"\u2713 Once active, all future iSCSI/FC connections automatically use multipath!")),multipathStatus&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-3"},/*#__PURE__*/React.createElement("p",{className:"text-sm font-medium mb-2"},"Current Node Status:"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-xs"},Object.entries(multipathStatus.nodes||{}).map(([nodeName,nodeData])=>/*#__PURE__*/React.createElement("div",{key:nodeName,className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:`w-2 h-2 rounded-full ${nodeData.running?'bg-green-500':nodeData.installed?'bg-yellow-500':'bg-gray-500'}`}),/*#__PURE__*/React.createElement("span",null,nodeName),/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},nodeData.running?'(active)':nodeData.installed?'(stopped)':'(not installed)'))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-2"},/*#__PURE__*/React.createElement("p",{className:"text-sm font-medium"},"Target Nodes"),/*#__PURE__*/React.createElement("button",{onClick:()=>{if(multipathSelectedNodes===null){// Switch to manual: start with all selected
const allNodes=(clusterNodes||[]).filter(n=>n.online!==0).map(n=>n.node||n.name);setMultipathSelectedNodes(allNodes);}else{setMultipathSelectedNodes(null);}},className:"text-xs text-purple-400 hover:text-purple-300"},multipathSelectedNodes===null?'Select individual nodes':'Select all nodes')),multipathSelectedNodes===null?/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-400"},"All ",(clusterNodes||[]).filter(n=>n.online!==0).length," online nodes will be configured."):/*#__PURE__*/React.createElement("div",{className:"space-y-1"},(clusterNodes||[]).filter(n=>n.online!==0).map(n=>{const name=n.node||n.name;const isSelected=multipathSelectedNodes.includes(name);const nodeStatus=multipathStatus?.nodes?.[name];return/*#__PURE__*/React.createElement("label",{key:name,className:`flex items-center gap-2 px-2 py-1.5 rounded cursor-pointer hover:bg-proxmox-hover ${isSelected?'bg-purple-500/10':''}`},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:isSelected,onChange:()=>{setMultipathSelectedNodes(prev=>isSelected?prev.filter(x=>x!==name):[...prev,name]);},className:"accent-purple-500"}),/*#__PURE__*/React.createElement(Icons.Server,{className:"w-3 h-3 text-gray-400"}),/*#__PURE__*/React.createElement("span",{className:"text-sm"},name),nodeStatus&&/*#__PURE__*/React.createElement("span",{className:`text-xs ml-auto ${nodeStatus.running?'text-green-500':nodeStatus.installed?'text-yellow-500':'text-gray-500'}`},nodeStatus.running?'active':nodeStatus.installed?'stopped':'not installed'));}),multipathSelectedNodes.length===0&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-yellow-400 mt-1"},"Select at least one node"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},"Storage Vendor"),/*#__PURE__*/React.createElement("select",{value:multipathSetupData.vendor,onChange:e=>setMultipathSetupData({...multipathSetupData,vendor:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:"default"},"Default (Generic) - Works with most storage"),/*#__PURE__*/React.createElement("option",{value:"netapp"},"NetApp - ONTAP, E-Series, SolidFire"),/*#__PURE__*/React.createElement("option",{value:"emc"},"Dell EMC - VNX, Unity, PowerStore, XtremIO"),/*#__PURE__*/React.createElement("option",{value:"hpe"},"HPE - 3PAR, Primera, Nimble, MSA"),/*#__PURE__*/React.createElement("option",{value:"pure"},"Pure Storage - FlashArray, FlashBlade"),/*#__PURE__*/React.createElement("option",{value:"dell"},"Dell - Compellent, EqualLogic, PowerVault"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},"Load Balancing Policy"),/*#__PURE__*/React.createElement("select",{value:multipathSetupData.policy,onChange:e=>setMultipathSetupData({...multipathSetupData,policy:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:"service-time"},"Service Time (Recommended)"),/*#__PURE__*/React.createElement("option",{value:"round-robin"},"Round Robin"),/*#__PURE__*/React.createElement("option",{value:"queue-length"},"Queue Length")),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mt-2 space-y-1"},multipathSetupData.policy==='service-time'&&/*#__PURE__*/React.createElement("p",null,"\uD83D\uDCCA ",/*#__PURE__*/React.createElement("strong",null,"Service Time:")," Routes I/O to the path with the shortest estimated service time. Best for mixed workloads - automatically adapts to path latency."),multipathSetupData.policy==='round-robin'&&/*#__PURE__*/React.createElement("p",null,"\uD83D\uDD04 ",/*#__PURE__*/React.createElement("strong",null,"Round Robin:")," Distributes I/O evenly across all paths in rotation. Good for symmetric active/active arrays with equal path performance."),multipathSetupData.policy==='queue-length'&&/*#__PURE__*/React.createElement("p",null,"\uD83D\uDCCB ",/*#__PURE__*/React.createElement("strong",null,"Queue Length:")," Routes I/O to the path with the fewest pending requests. Good for paths with different throughput capabilities."))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:multipathSetupData.skipExistingConfig!==true,onChange:e=>setMultipathSetupData({...multipathSetupData,skipExistingConfig:!e.target.checked}),className:"w-4 h-4 rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm"},"Write multipath.conf (uncheck to keep existing config)")),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1 ml-6"},"If unchecked, only installs/enables multipathd without changing existing configuration.")),multipathSetupResult&&/*#__PURE__*/React.createElement("div",{className:`rounded-lg p-3 ${multipathSetupResult.success?'bg-green-500/10 border border-green-500/30':'bg-red-500/10 border border-red-500/30'}`},/*#__PURE__*/React.createElement("p",{className:`font-medium ${multipathSetupResult.success?'text-green-400':'text-red-400'}`},multipathSetupResult.success?'âœ“ Setup completed successfully!':'âœ— Setup had errors'),multipathSetupResult.error&&/*#__PURE__*/React.createElement("p",{className:"text-red-400 text-sm mt-1"},multipathSetupResult.error),/*#__PURE__*/React.createElement("div",{className:"mt-2 space-y-1 text-xs"},multipathSetupResult.results?.map((r,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"py-1"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:r.success?'text-green-400':'text-red-400'},r.success?'âœ“':'âœ—'),/*#__PURE__*/React.createElement("span",{className:"font-medium"},r.node),r.skipped_config&&/*#__PURE__*/React.createElement("span",{className:"text-yellow-400"},"(config preserved)")),r.error&&/*#__PURE__*/React.createElement("p",{className:"text-red-400 text-xs ml-5 mt-0.5"},r.error),r.steps&&r.steps.length>0&&!r.success&&/*#__PURE__*/React.createElement("div",{className:"ml-5 mt-1 space-y-0.5 text-gray-500"},r.steps.map((step,si)=>/*#__PURE__*/React.createElement("div",{key:si,className:"flex items-center gap-1"},/*#__PURE__*/React.createElement("span",{className:step.success?'text-green-600':'text-red-500'},step.success?'âœ“':'âœ—'),/*#__PURE__*/React.createElement("span",null,step.action),step.output&&!step.success&&/*#__PURE__*/React.createElement("span",{className:"text-red-500/70 truncate max-w-md"},"- ",typeof step.output==='string'?step.output.substring(0,150):''))))))),multipathSetupResult.success&&/*#__PURE__*/React.createElement("p",{className:"text-green-400 text-xs mt-2"},"\u2713 New iSCSI/FC LUNs will automatically use multipath redundancy!"))),/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center gap-3 p-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},multipathSelectedNodes===null?`Deploys to all ${(clusterNodes||[]).filter(n=>n.online!==0).length} online nodes`:`Deploys to ${multipathSelectedNodes.length} selected node${multipathSelectedNodes.length!==1?'s':''}`),/*#__PURE__*/React.createElement("div",{className:"flex gap-3"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowMultipathSetup(false);setMultipathSetupResult(null);setMultipathSelectedNodes(null);},className:"px-4 py-2 bg-proxmox-border hover:bg-proxmox-hover rounded-lg"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{const targetNodes=multipathSelectedNodes!==null?multipathSelectedNodes:(clusterNodes||[]).filter(n=>n.online!==0).map(n=>n.node||n.name);if(targetNodes.length===0){addToast('No nodes selected','error');return;}setMultipathSetupResult(null);addToast(`Starting multipath setup on ${targetNodes.length} node${targetNodes.length!==1?'s':''}...`,'info');try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/multipath/setup`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({...multipathSetupData,nodes:targetNodes})});const data=await res.json();if(!res.ok&&!data.results){// API returned error before reaching nodes (e.g. missing credentials)
setMultipathSetupResult({success:false,error:data.error||`Server error (${res.status})`,results:[]});addToast(data.error||'Setup failed','error');}else{setMultipathSetupResult(data);if(data.success){addToast('Multipath setup completed!','success');// Wait a moment for services to stabilize, then refresh status
addToast('Refreshing multipath status...','info');await new Promise(r=>setTimeout(r,2000));try{const statusRes=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/multipath/status`);if(statusRes.ok){const statusData=await statusRes.json();setMultipathStatus(statusData);const running=statusData.summary?.nodes_with_multipath||0;const total=statusData.summary?.total_nodes||0;addToast(`Multipath active on ${running}/${total} nodes`,running===total?'success':'warning');}}catch(e){console.error('Status refresh failed:',e);}}else{addToast(data.error||'Multipath setup completed with errors',data.error?'error':'warning');}}}catch(e){addToast('Setup failed: '+e.message,'error');}},className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:multipathSelectedNodes!==null&&multipathSelectedNodes.length===0},/*#__PURE__*/React.createElement(Icons.Zap,{className:"w-4 h-4"}),multipathSelectedNodes===null?'Deploy to All Nodes':`Deploy to ${multipathSelectedNodes.length} Node${multipathSelectedNodes.length!==1?'s':''}`))))),showAddStorage&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",onClick:()=>setShowAddStorage(false)},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center p-4 border-b border-proxmox-border sticky top-0 bg-proxmox-card z-10"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.HardDrive,null),newStorage.storage?`Edit: ${newStorage.storage}`:`Add: ${storageTypes.find(s=>s.id===newStorage.type)?.label||'Storage'}`),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddStorage(false),className:"p-1.5 hover:bg-proxmox-dark rounded-lg transition-colors"},/*#__PURE__*/React.createElement(Icons.X,null))),/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},"Type"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-5 gap-2"},storageTypes.map(st=>/*#__PURE__*/React.createElement("button",{key:st.id,onClick:()=>{setNewStorage({type:st.id,storage:'',content:'images,rootdir',enabled:true});setScanResults([]);// Clear scan results when type changes
},className:`p-2 rounded-lg border text-xs flex flex-col items-center gap-1 ${newStorage.type===st.id?'border-proxmox-orange bg-proxmox-orange/20':'border-proxmox-border hover:bg-proxmox-dark'}`},/*#__PURE__*/React.createElement("span",{className:"text-lg"},st.icon)," ",st.label)))),/*#__PURE__*/React.createElement("div",{className:"p-4 space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"ID *"),/*#__PURE__*/React.createElement("input",{value:newStorage.storage||'',onChange:e=>setNewStorage({...newStorage,storage:e.target.value}),placeholder:"storage-name",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Nodes"),/*#__PURE__*/React.createElement("select",{value:newStorage.nodes||'',onChange:e=>setNewStorage({...newStorage,nodes:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"All (No restrictions)"),(clusterNodes||[]).map(n=>/*#__PURE__*/React.createElement("option",{key:n.name,value:n.name},n.name))))),newStorage.type==='iscsi'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Portal *"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{value:newStorage.portal||'',onChange:e=>setNewStorage({...newStorage,portal:e.target.value}),placeholder:"192.168.1.100",className:"flex-1 bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm font-mono"}),/*#__PURE__*/React.createElement("button",{onClick:()=>scanStorage('iscsi'),disabled:!newStorage.portal||scanning,className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 rounded text-sm whitespace-nowrap"},scanning?'...':'Scan'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Target *"),scanResults.length>0&&newStorage.type==='iscsi'?/*#__PURE__*/React.createElement("select",{value:newStorage.target||'',onChange:e=>setNewStorage({...newStorage,target:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm font-mono"},/*#__PURE__*/React.createElement("option",{value:""},"Select target..."),scanResults.map((r,i)=>/*#__PURE__*/React.createElement("option",{key:i,value:r.target},r.target))):/*#__PURE__*/React.createElement("input",{value:newStorage.target||'',onChange:e=>setNewStorage({...newStorage,target:e.target.value}),placeholder:"iqn.2024...",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm font-mono"})),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4 col-span-2"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newStorage.enabled!==false,onChange:e=>setNewStorage({...newStorage,enabled:e.target.checked}),className:"rounded"})," Enable"),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newStorage.comstar_tg||false,onChange:e=>setNewStorage({...newStorage,comstar_tg:e.target.checked}),className:"rounded"})," Use LUNs directly"))),newStorage.type==='lvm'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Base storage (for Shared LVM)"),/*#__PURE__*/React.createElement("select",{value:newStorage.baseStorage||'',onChange:e=>{const baseStorage=e.target.value;// NS: If base storage is selected, it becomes shared automatically
setNewStorage({...newStorage,baseStorage,base:'',shared:baseStorage?true:newStorage.shared});// Clear scan results when base changes
setScanResults([]);},className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Existing volume groups (local)"),storage.filter(s=>s.type==='iscsi').map(s=>/*#__PURE__*/React.createElement("option",{key:s.storage,value:s.storage},"iSCSI: ",s.storage)))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newStorage.enabled!==false,onChange:e=>setNewStorage({...newStorage,enabled:e.target.checked}),className:"rounded"})," Enable")),newStorage.baseStorage&&/*#__PURE__*/React.createElement("div",{className:"col-span-2 p-3 bg-blue-900/30 border border-blue-500/50 rounded text-sm text-blue-300"},/*#__PURE__*/React.createElement("strong",null,"Shared LVM:")," Select a LUN from \"",newStorage.baseStorage,"\" below. The volume group will be created on or use the selected LUN. All cluster nodes must have access to the iSCSI target."),newStorage.baseStorage&&/*#__PURE__*/React.createElement("div",{className:"col-span-2"},/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Select LUN *"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("select",{value:newStorage.base||'',onChange:e=>setNewStorage({...newStorage,base:e.target.value}),className:"flex-1 bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm font-mono"},/*#__PURE__*/React.createElement("option",{value:""},"Select LUN..."),scanResults.filter(l=>l.volid).map((lun,i)=>/*#__PURE__*/React.createElement("option",{key:i,value:lun.volid},lun.volid," ",lun.size?`(${(lun.size/1024/1024/1024).toFixed(1)} GB)`:''))),/*#__PURE__*/React.createElement("button",{onClick:async()=>{// Fetch LUNs from iSCSI storage
setScanning(true);try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/datastores/${newStorage.baseStorage}/content`);if(res?.ok){const luns=await res.json();console.log('LUNs from',newStorage.baseStorage,':',luns);setScanResults(luns||[]);}else{addToast('Failed to scan LUNs','error');}}catch(e){console.error('Error fetching LUNs:',e);addToast('Error scanning LUNs','error');}setScanning(false);},disabled:scanning,className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 rounded text-sm whitespace-nowrap"},scanning?'...':'Scan LUNs')),scanResults.length===0&&!scanning&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},"Click \"Scan LUNs\" to discover available LUNs"),newStorage.baseStorage&&!newStorage.base&&scanResults.length>0&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-yellow-400 mt-1"},"\u26A0\uFE0F Select a LUN to continue")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Volume group name *"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},!newStorage.baseStorage&&scanResults.length>0&&newStorage.type==='lvm'?/*#__PURE__*/React.createElement("select",{value:newStorage.vgname||'',onChange:e=>setNewStorage({...newStorage,vgname:e.target.value}),className:"flex-1 bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Select VG..."),scanResults.filter(r=>r.vg).map((r,i)=>/*#__PURE__*/React.createElement("option",{key:i,value:r.vg},r.vg," (",(r.size/1024/1024/1024).toFixed(1)," GB)"))):/*#__PURE__*/React.createElement("input",{value:newStorage.vgname||'',onChange:e=>setNewStorage({...newStorage,vgname:e.target.value}),placeholder:newStorage.baseStorage?"shared-vg":"pve",className:"flex-1 bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"}),!newStorage.baseStorage&&/*#__PURE__*/React.createElement("button",{onClick:()=>scanStorage('lvm'),disabled:scanning,className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 rounded text-sm whitespace-nowrap"},scanning?'...':'Scan')),newStorage.baseStorage&&!newStorage.vgname&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-yellow-400 mt-1"},"\u26A0\uFE0F Enter a volume group name")),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newStorage.shared||false,onChange:e=>setNewStorage({...newStorage,shared:e.target.checked}),disabled:!!newStorage.baseStorage,className:"rounded"})," Shared ",newStorage.baseStorage&&'(auto)')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Content"),/*#__PURE__*/React.createElement("select",{value:newStorage.content||'images,rootdir',onChange:e=>setNewStorage({...newStorage,content:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:"images,rootdir"},"Disk image, Container"),/*#__PURE__*/React.createElement("option",{value:"images"},"Disk image"),/*#__PURE__*/React.createElement("option",{value:"rootdir"},"Container"))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm",title:"Wipe disk when deleting volumes (more secure, slower)"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newStorage.saferemove||false,onChange:e=>setNewStorage({...newStorage,saferemove:e.target.checked}),className:"rounded"})," Wipe on Delete")),/*#__PURE__*/React.createElement("div",{className:"col-span-2 p-3 bg-proxmox-dark border border-proxmox-border rounded"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newStorage['snapshot-as-volume-chain']||false,onChange:e=>setNewStorage({...newStorage,'snapshot-as-volume-chain':e.target.checked}),className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"font-medium"},"Snapshot as Volume Chain"),/*#__PURE__*/React.createElement("span",{className:"text-xs px-1.5 py-0.5 bg-green-600/30 text-green-400 rounded"},"PVE 9+")),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1 ml-6"},"Uses separate volumes for snapshot data instead of internal LVM snapshots. This provides better performance and compatibility."))),newStorage.type==='lvmthin'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Volume group *"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},scanResults.length>0&&newStorage.type==='lvmthin'&&!newStorage.vgname?/*#__PURE__*/React.createElement("select",{value:newStorage.vgname||'',onChange:e=>setNewStorage({...newStorage,vgname:e.target.value}),className:"flex-1 bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Select VG..."),scanResults.filter(r=>r.vg).map((r,i)=>/*#__PURE__*/React.createElement("option",{key:i,value:r.vg},r.vg))):/*#__PURE__*/React.createElement("input",{value:newStorage.vgname||'',onChange:e=>setNewStorage({...newStorage,vgname:e.target.value}),placeholder:"pve",className:"flex-1 bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"}),/*#__PURE__*/React.createElement("button",{onClick:()=>scanStorage('lvm'),disabled:scanning,className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 rounded text-sm whitespace-nowrap"},scanning?'...':'Scan VG'))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newStorage.enabled!==false,onChange:e=>setNewStorage({...newStorage,enabled:e.target.checked}),className:"rounded"})," Enable")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Thin Pool *"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},scanResults.length>0&&newStorage.vgname&&scanResults.some(r=>r.lv)?/*#__PURE__*/React.createElement("select",{value:newStorage.thinpool||'',onChange:e=>setNewStorage({...newStorage,thinpool:e.target.value}),className:"flex-1 bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Select pool..."),scanResults.filter(r=>r.lv).map((r,i)=>/*#__PURE__*/React.createElement("option",{key:i,value:r.lv},r.lv," (",(r.size/1024/1024/1024).toFixed(1)," GB, ",r.used_percent,"% used)"))):/*#__PURE__*/React.createElement("input",{value:newStorage.thinpool||'',onChange:e=>setNewStorage({...newStorage,thinpool:e.target.value}),placeholder:"data",className:"flex-1 bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"}),newStorage.vgname&&/*#__PURE__*/React.createElement("button",{onClick:()=>scanStorage('lvmthin'),disabled:scanning||!newStorage.vgname,className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 rounded text-sm whitespace-nowrap"},scanning?'...':'Scan'))),/*#__PURE__*/React.createElement("div",null),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Content"),/*#__PURE__*/React.createElement("select",{value:newStorage.content||'images,rootdir',onChange:e=>setNewStorage({...newStorage,content:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:"images,rootdir"},"Disk image, Container"),/*#__PURE__*/React.createElement("option",{value:"images"},"Disk image"),/*#__PURE__*/React.createElement("option",{value:"rootdir"},"Container"))),/*#__PURE__*/React.createElement("div",null),/*#__PURE__*/React.createElement("div",{className:"col-span-2 p-3 bg-proxmox-dark border border-proxmox-border rounded"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newStorage['snapshot-as-volume-chain']||false,onChange:e=>setNewStorage({...newStorage,'snapshot-as-volume-chain':e.target.checked}),className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"font-medium"},"Snapshot as Volume Chain"),/*#__PURE__*/React.createElement("span",{className:"text-xs px-1.5 py-0.5 bg-green-600/30 text-green-400 rounded"},"PVE 9+")),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1 ml-6"},"Uses separate volumes for snapshot data instead of internal snapshots. Improves performance and allows online snapshots for LVM-thin.")),/*#__PURE__*/React.createElement("div",{className:"col-span-2 p-2 bg-yellow-900/30 border border-yellow-500/50 rounded text-xs text-yellow-300"},"\u26A0\uFE0F LVM-thin storage cannot be shared between cluster nodes. For shared block storage, use regular LVM on iSCSI or Ceph RBD.")),newStorage.type==='btrfs'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Path *"),/*#__PURE__*/React.createElement("input",{value:newStorage.path||'',onChange:e=>setNewStorage({...newStorage,path:e.target.value}),placeholder:"/mnt/btrfs",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm font-mono"})),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newStorage.enabled!==false,onChange:e=>setNewStorage({...newStorage,enabled:e.target.checked}),className:"rounded"})," Enable")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Content"),/*#__PURE__*/React.createElement("select",{value:newStorage.content||'images,rootdir',onChange:e=>setNewStorage({...newStorage,content:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:"images,rootdir"},"Disk image, Container"),/*#__PURE__*/React.createElement("option",{value:"images"},"Disk image"),/*#__PURE__*/React.createElement("option",{value:"rootdir"},"Container"))),/*#__PURE__*/React.createElement("div",null),/*#__PURE__*/React.createElement("div",{className:"col-span-2 p-3 bg-blue-900/30 border border-blue-500/50 rounded text-sm text-blue-300"},"BTRFS integration is currently a technology preview."),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Preallocation"),/*#__PURE__*/React.createElement("select",{value:newStorage.preallocation||'',onChange:e=>setNewStorage({...newStorage,preallocation:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Default"),/*#__PURE__*/React.createElement("option",{value:"off"},"Off"),/*#__PURE__*/React.createElement("option",{value:"metadata"},"Metadata"),/*#__PURE__*/React.createElement("option",{value:"falloc"},"Falloc"),/*#__PURE__*/React.createElement("option",{value:"full"},"Full")))),newStorage.type==='nfs'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Server *"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{value:newStorage.server||'',onChange:e=>setNewStorage({...newStorage,server:e.target.value}),placeholder:"192.168.1.100",className:"flex-1 bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm font-mono"}),/*#__PURE__*/React.createElement("button",{onClick:()=>scanStorage('nfs'),disabled:!newStorage.server||scanning,className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 rounded text-sm whitespace-nowrap"},scanning?'...':'Scan'))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newStorage.enabled!==false,onChange:e=>setNewStorage({...newStorage,enabled:e.target.checked}),className:"rounded"})," Enable")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Export *"),scanResults.length>0&&newStorage.type==='nfs'?/*#__PURE__*/React.createElement("select",{value:newStorage.export||'',onChange:e=>setNewStorage({...newStorage,export:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm font-mono"},/*#__PURE__*/React.createElement("option",{value:""},"Select export..."),scanResults.map((r,i)=>/*#__PURE__*/React.createElement("option",{key:i,value:r.path},r.path," ",r.options?`(${r.options})`:''))):/*#__PURE__*/React.createElement("input",{value:newStorage.export||'',onChange:e=>setNewStorage({...newStorage,export:e.target.value}),placeholder:"/export/share",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm font-mono"})),/*#__PURE__*/React.createElement("div",null),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Content"),/*#__PURE__*/React.createElement("select",{value:newStorage.content||'images',onChange:e=>setNewStorage({...newStorage,content:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:"images"},"Disk image"),/*#__PURE__*/React.createElement("option",{value:"images,rootdir"},"Disk image, Container"),/*#__PURE__*/React.createElement("option",{value:"backup"},"Backup"),/*#__PURE__*/React.createElement("option",{value:"iso"},"ISO image"),/*#__PURE__*/React.createElement("option",{value:"vztmpl"},"Container template"),/*#__PURE__*/React.createElement("option",{value:"snippets"},"Snippets"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"NFS Version"),/*#__PURE__*/React.createElement("select",{value:newStorage.options||'',onChange:e=>setNewStorage({...newStorage,options:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Default"),/*#__PURE__*/React.createElement("option",{value:"vers=3"},"NFSv3"),/*#__PURE__*/React.createElement("option",{value:"vers=4"},"NFSv4"),/*#__PURE__*/React.createElement("option",{value:"vers=4.1"},"NFSv4.1"),/*#__PURE__*/React.createElement("option",{value:"vers=4.2"},"NFSv4.2"))),/*#__PURE__*/React.createElement("div",{className:"col-span-2 p-3 bg-proxmox-dark border border-proxmox-border rounded"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newStorage['snapshot-as-volume-chain']||false,onChange:e=>setNewStorage({...newStorage,'snapshot-as-volume-chain':e.target.checked}),className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"font-medium"},"Snapshot as Volume Chain"),/*#__PURE__*/React.createElement("span",{className:"text-xs px-1.5 py-0.5 bg-green-600/30 text-green-400 rounded"},"PVE 9+")),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1 ml-6"},"Uses separate qcow2 files for snapshot data instead of internal qcow2 snapshots.")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Preallocation"),/*#__PURE__*/React.createElement("select",{value:newStorage.preallocation||'',onChange:e=>setNewStorage({...newStorage,preallocation:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Default"),/*#__PURE__*/React.createElement("option",{value:"off"},"Off"),/*#__PURE__*/React.createElement("option",{value:"metadata"},"Metadata"),/*#__PURE__*/React.createElement("option",{value:"falloc"},"Falloc"),/*#__PURE__*/React.createElement("option",{value:"full"},"Full")))),newStorage.type==='cifs'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Server *"),/*#__PURE__*/React.createElement("input",{value:newStorage.server||'',onChange:e=>setNewStorage({...newStorage,server:e.target.value}),placeholder:"192.168.1.100",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm font-mono"})),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newStorage.enabled!==false,onChange:e=>setNewStorage({...newStorage,enabled:e.target.checked}),className:"rounded"})," Enable")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Username"),/*#__PURE__*/React.createElement("input",{value:newStorage.username||'',onChange:e=>setNewStorage({...newStorage,username:e.target.value}),placeholder:"Guest user",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Content"),/*#__PURE__*/React.createElement("select",{value:newStorage.content||'images',onChange:e=>setNewStorage({...newStorage,content:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:"images"},"Disk image"),/*#__PURE__*/React.createElement("option",{value:"images,rootdir"},"Disk image, Container"),/*#__PURE__*/React.createElement("option",{value:"backup"},"Backup"),/*#__PURE__*/React.createElement("option",{value:"iso"},"ISO image"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Password"),/*#__PURE__*/React.createElement("input",{type:"password",value:newStorage.password||'',onChange:e=>setNewStorage({...newStorage,password:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Domain"),/*#__PURE__*/React.createElement("input",{value:newStorage.domain||'',onChange:e=>setNewStorage({...newStorage,domain:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Share *"),/*#__PURE__*/React.createElement("input",{value:newStorage.share||'',onChange:e=>setNewStorage({...newStorage,share:e.target.value}),placeholder:"share-name",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Subdirectory"),/*#__PURE__*/React.createElement("input",{value:newStorage.subdir||'',onChange:e=>setNewStorage({...newStorage,subdir:e.target.value}),placeholder:"/some/path",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm font-mono"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Preallocation"),/*#__PURE__*/React.createElement("select",{value:newStorage.preallocation||'',onChange:e=>setNewStorage({...newStorage,preallocation:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Default"),/*#__PURE__*/React.createElement("option",{value:"off"},"Off"),/*#__PURE__*/React.createElement("option",{value:"metadata"},"Metadata"),/*#__PURE__*/React.createElement("option",{value:"full"},"Full"))),/*#__PURE__*/React.createElement("div",{className:"col-span-2 p-3 bg-proxmox-dark border border-proxmox-border rounded"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newStorage['snapshot-as-volume-chain']||false,onChange:e=>setNewStorage({...newStorage,'snapshot-as-volume-chain':e.target.checked}),className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"font-medium"},"Snapshot as Volume Chain"),/*#__PURE__*/React.createElement("span",{className:"text-xs px-1.5 py-0.5 bg-green-600/30 text-green-400 rounded"},"PVE 9+")),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1 ml-6"},"Uses separate qcow2 files for snapshot data instead of internal qcow2 snapshots."))),newStorage.type==='dir'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Directory *"),/*#__PURE__*/React.createElement("input",{value:newStorage.path||'',onChange:e=>setNewStorage({...newStorage,path:e.target.value}),placeholder:"/mnt/storage",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm font-mono"})),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newStorage.enabled!==false,onChange:e=>setNewStorage({...newStorage,enabled:e.target.checked}),className:"rounded"})," Enable"),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newStorage.shared||false,onChange:e=>setNewStorage({...newStorage,shared:e.target.checked}),className:"rounded"})," Shared")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Content"),/*#__PURE__*/React.createElement("select",{value:newStorage.content||'images,rootdir,vztmpl,backup,iso,snippets',onChange:e=>setNewStorage({...newStorage,content:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:"images,rootdir,vztmpl,backup,iso,snippets"},"All"),/*#__PURE__*/React.createElement("option",{value:"images,rootdir"},"Disk image, Container"),/*#__PURE__*/React.createElement("option",{value:"backup"},"Backup"),/*#__PURE__*/React.createElement("option",{value:"iso"},"ISO image"),/*#__PURE__*/React.createElement("option",{value:"vztmpl"},"Container template"))),/*#__PURE__*/React.createElement("div",null),/*#__PURE__*/React.createElement("div",{className:"col-span-2 p-3 bg-proxmox-dark border border-proxmox-border rounded"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newStorage['snapshot-as-volume-chain']||false,onChange:e=>setNewStorage({...newStorage,'snapshot-as-volume-chain':e.target.checked}),className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"font-medium"},"Snapshot as Volume Chain"),/*#__PURE__*/React.createElement("span",{className:"text-xs px-1.5 py-0.5 bg-green-600/30 text-green-400 rounded"},"PVE 9+")),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1 ml-6"},"Uses separate qcow2 files for snapshot data instead of internal qcow2 snapshots."))),newStorage.type==='pbs'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Server *"),/*#__PURE__*/React.createElement("input",{value:newStorage.server||'',onChange:e=>setNewStorage({...newStorage,server:e.target.value}),placeholder:"pbs.example.com",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newStorage.enabled!==false,onChange:e=>setNewStorage({...newStorage,enabled:e.target.checked}),className:"rounded"})," Enable")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Username *"),/*#__PURE__*/React.createElement("input",{value:newStorage.username||'',onChange:e=>setNewStorage({...newStorage,username:e.target.value}),placeholder:"user@pbs",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Password *"),/*#__PURE__*/React.createElement("input",{type:"password",value:newStorage.password||'',onChange:e=>setNewStorage({...newStorage,password:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Datastore *"),/*#__PURE__*/React.createElement("input",{value:newStorage.datastore||'',onChange:e=>setNewStorage({...newStorage,datastore:e.target.value}),placeholder:"store1",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Fingerprint"),/*#__PURE__*/React.createElement("input",{value:newStorage.fingerprint||'',onChange:e=>setNewStorage({...newStorage,fingerprint:e.target.value}),placeholder:"optional",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm font-mono text-xs"}))),newStorage.type==='zfspool'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Pool *"),/*#__PURE__*/React.createElement("input",{value:newStorage.pool||'',onChange:e=>setNewStorage({...newStorage,pool:e.target.value}),placeholder:"rpool/data",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm font-mono"})),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newStorage.enabled!==false,onChange:e=>setNewStorage({...newStorage,enabled:e.target.checked}),className:"rounded"})," Enable")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Content"),/*#__PURE__*/React.createElement("select",{value:newStorage.content||'images,rootdir',onChange:e=>setNewStorage({...newStorage,content:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:"images,rootdir"},"Disk image, Container"),/*#__PURE__*/React.createElement("option",{value:"images"},"Disk image"),/*#__PURE__*/React.createElement("option",{value:"rootdir"},"Container")))),newStorage.type==='esxi'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Server *"),/*#__PURE__*/React.createElement("input",{value:newStorage.server||'',onChange:e=>setNewStorage({...newStorage,server:e.target.value}),placeholder:"IP address or hostname",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm font-mono"})),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newStorage.enabled!==false,onChange:e=>setNewStorage({...newStorage,enabled:e.target.checked}),className:"rounded"})," Enable")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Username *"),/*#__PURE__*/React.createElement("input",{value:newStorage.username||'',onChange:e=>setNewStorage({...newStorage,username:e.target.value}),placeholder:"root",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newStorage.skip_cert_verification||false,onChange:e=>setNewStorage({...newStorage,skip_cert_verification:e.target.checked}),className:"rounded"})," Skip Certificate Verification")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Password *"),/*#__PURE__*/React.createElement("input",{type:"password",value:newStorage.password||'',onChange:e=>setNewStorage({...newStorage,password:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 p-4 border-t border-proxmox-border sticky bottom-0 bg-proxmox-card"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowAddStorage(false);setNewStorage({type:'dir',storage:'',path:'',content:'images,rootdir',enabled:true});},className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover rounded-lg text-sm transition-colors"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:createStorage,disabled:!newStorage.storage,className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg text-sm text-white transition-colors"},newStorage.storage&&storage.some(s=>s.storage===newStorage.storage)?t('save'):t('add')))))),activeSection==='sdn'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},!sdnData.available?/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-8 text-center"},/*#__PURE__*/React.createElement(Icons.Network,{className:"w-12 h-12 mx-auto mb-4 text-gray-500"}),/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-2"},t('sdnNotAvailable')||'SDN Not Available'),/*#__PURE__*/React.createElement("p",{className:"text-gray-400 text-sm mb-4"},sdnData.error||t('sdnNotConfigured')||'Software Defined Networking is not configured on this cluster.'),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4 text-left mb-4 max-w-md mx-auto"},/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-400 mb-2 font-medium"},"Troubleshooting:"),/*#__PURE__*/React.createElement("ul",{className:"text-xs text-gray-500 space-y-1 list-disc list-inside"},/*#__PURE__*/React.createElement("li",null,"SDN requires Proxmox VE 6.2 or newer"),/*#__PURE__*/React.createElement("li",null,"Install: ",/*#__PURE__*/React.createElement("code",{className:"text-orange-400"},"apt install libpve-network-perl")),/*#__PURE__*/React.createElement("li",null,"Enable SDN in Datacenter \u2191 SDN in Proxmox UI"),/*#__PURE__*/React.createElement("li",null,"API user needs SDN.Audit permission"))),/*#__PURE__*/React.createElement("div",{className:"flex gap-3 justify-center"},/*#__PURE__*/React.createElement("a",{href:"https://pve.proxmox.com/wiki/Software_Defined_Network",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline text-sm"},t('learnMore')||'Learn more about Proxmox SDN'," \u2191"),/*#__PURE__*/React.createElement("button",{onClick:()=>{console.log('SDN Data:',sdnData);console.log('SDN Debug:',sdnData.debug);alert(`SDN Debug Info:\n\nAvailable: ${sdnData.available}\nSDN Status: ${sdnData.debug?.sdn_status||'N/A'}\nZones Status: ${sdnData.debug?.zones_status||'N/A'}\nError: ${sdnData.debug?.error||sdnData.debug?.zones_error||'None'}\n\nCheck browser console (F12) for full details.`);},className:"text-gray-400 hover:text-white text-sm"},"Debug Info"))):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:`rounded-xl p-4 flex items-center justify-between ${sdnData.pending?'bg-yellow-500/10 border border-yellow-500/30':'bg-proxmox-card border border-proxmox-border'}`},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},sdnData.pending?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"text-yellow-500"}),/*#__PURE__*/React.createElement("span",{className:"text-yellow-500"},t('sdnPendingChanges')||'There are pending SDN changes that need to be applied.')):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Icons.CheckCircle,{className:"text-green-500"}),/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('sdnConfigSynced')||'SDN configuration is in sync with all nodes.'))),/*#__PURE__*/React.createElement("button",{onClick:async()=>{try{addToast(t('applyingSDN')||'Applying SDN configuration to all nodes...','info');const res=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/sdn/apply`,{method:'POST'});if(res.ok){addToast(t('sdnApplied')||'SDN configuration applied to all nodes','success');// Short delay then refresh
setTimeout(()=>fetchAllData(),1000);}else{const err=await res.json();addToast(err.error||'Failed to apply SDN','error');}}catch(e){addToast('Failed to apply SDN','error');}},className:`px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 ${sdnData.pending?'bg-yellow-500 hover:bg-yellow-600 text-black':'bg-proxmox-orange hover:bg-orange-600 text-white'}`},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-4 h-4"}),t('applyChanges')||'Apply / Reload')),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Layers,{className:"w-5 h-5"}),t('sdnZones')||'Zones'),/*#__PURE__*/React.createElement("button",{onClick:()=>{setNewZone({zone:'',type:'simple'});setShowAddZone(true);},className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm"},/*#__PURE__*/React.createElement(Icons.Plus,null)," ",t('add'))),sdnData.zones.length===0?/*#__PURE__*/React.createElement("div",{className:"p-8 text-center text-gray-500"},/*#__PURE__*/React.createElement("p",null,t('noZones')||'No zones configured')):/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('zone')||'Zone'),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('type')||'Type'),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"MTU"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Nodes"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('vnets')||'VNets'),/*#__PURE__*/React.createElement("th",{className:"text-right p-3 text-sm text-gray-400"},t('actions')))),/*#__PURE__*/React.createElement("tbody",null,sdnData.zones.map(zone=>/*#__PURE__*/React.createElement("tr",{key:zone.zone,className:"border-t border-proxmox-border hover:bg-proxmox-hover"},/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:"font-medium text-white"},zone.zone)),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-1 rounded text-xs ${zone.type==='simple'?'bg-green-500/20 text-green-400':zone.type==='vlan'?'bg-blue-500/20 text-blue-400':zone.type==='vxlan'?'bg-purple-500/20 text-purple-400':zone.type==='evpn'?'bg-orange-500/20 text-orange-400':'bg-gray-500/20 text-gray-400'}`},zone.type)),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},zone.mtu||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},zone.nodes||'all'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},sdnData.vnets.filter(v=>v.zone===zone.zone).length),/*#__PURE__*/React.createElement("td",{className:"p-3 text-right"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(confirm(t('confirmDeleteZone')||`Delete zone "${zone.zone}"?`)){try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/sdn/zones/${zone.zone}`,{method:'DELETE'});if(res.ok){addToast(t('zoneDeleted')||'Zone deleted','success');addToast('ðŸ’¡ Click "Apply / Reload" to deploy','info');fetchAllData();}else{const err=await res.json();addToast(err.error||'Failed to delete zone','error');}}catch(e){addToast('Failed to delete zone','error');}}},className:"p-1.5 hover:bg-red-500/20 rounded text-red-400",title:t('delete')},/*#__PURE__*/React.createElement(Icons.Trash2,{className:"w-4 h-4"})))))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Network,{className:"w-5 h-5 text-purple-400"}),t('sdnVnets')||'VNets'),/*#__PURE__*/React.createElement("button",{onClick:()=>{setNewVnet({vnet:'',zone:sdnData.zones[0]?.zone||'',tag:'',alias:''});setShowAddVnet(true);},className:"flex items-center gap-2 px-3 py-1.5 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm",disabled:sdnData.zones.length===0},/*#__PURE__*/React.createElement(Icons.Plus,null)," ",t('add'))),sdnData.vnets.length===0?/*#__PURE__*/React.createElement("div",{className:"p-8 text-center text-gray-500"},/*#__PURE__*/React.createElement("p",null,t('noVnets')||'No VNets configured'),sdnData.zones.length===0&&/*#__PURE__*/React.createElement("p",{className:"text-sm mt-2"},t('createZoneFirst')||'Create a zone first')):/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('vnet')||'VNet'),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('zone')||'Zone'),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('alias')||'Alias'),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"VLAN Tag"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('subnets')||'Subnets'),/*#__PURE__*/React.createElement("th",{className:"text-right p-3 text-sm text-gray-400"},t('actions')))),/*#__PURE__*/React.createElement("tbody",null,sdnData.vnets.map(vnet=>{const vnetSubnets=sdnData.subnets.filter(s=>s.vnet===vnet.vnet);return/*#__PURE__*/React.createElement("tr",{key:vnet.vnet,className:"border-t border-proxmox-border hover:bg-proxmox-hover"},/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:"font-medium text-white flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:"text-purple-400"},"\uD83C\uDF10"),vnet.vnet)),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},vnet.zone),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},vnet.alias||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3"},vnet.tag?/*#__PURE__*/React.createElement("span",{className:"px-2 py-0.5 bg-blue-500/20 text-blue-400 rounded text-xs"},vnet.tag):'-'),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-1"},vnetSubnets.length>0?vnetSubnets.map(s=>/*#__PURE__*/React.createElement("span",{key:s.subnet||s.cidr,className:"px-2 py-0.5 bg-green-500/20 text-green-400 rounded text-xs"},s.subnet||s.cidr)):/*#__PURE__*/React.createElement("span",{className:"text-gray-500 text-xs"},"-"),/*#__PURE__*/React.createElement("button",{onClick:()=>{setNewSubnet({subnet:'',gateway:'',snat:0,dhcp:'none'});setShowAddSubnet(vnet.vnet);},className:"px-2 py-0.5 bg-proxmox-dark hover:bg-proxmox-hover border border-proxmox-border rounded text-xs text-gray-400",title:t('addSubnet')||'Add Subnet'},"+"))),/*#__PURE__*/React.createElement("td",{className:"p-3 text-right"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(confirm(t('confirmDeleteVnet')||`Delete VNet "${vnet.vnet}"?`)){try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/sdn/vnets/${vnet.vnet}`,{method:'DELETE'});if(res.ok){addToast(t('vnetDeleted')||'VNet deleted','success');addToast('ðŸ’¡ Click "Apply / Reload" to deploy','info');fetchAllData();}else{const err=await res.json();addToast(err.error||'Failed to delete VNet','error');}}catch(e){addToast('Failed to delete VNet','error');}}},className:"p-1.5 hover:bg-red-500/20 rounded text-red-400",title:t('delete')},/*#__PURE__*/React.createElement(Icons.Trash2,{className:"w-4 h-4"}))));})))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold mb-3 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Info,{className:"w-5 h-5 text-blue-400"}),t('sdnInfo')||'SDN Information'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4 text-sm"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('zones')||'Zones',":"),/*#__PURE__*/React.createElement("span",{className:"ml-2 font-medium"},sdnData.zones.length)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('vnets')||'VNets',":"),/*#__PURE__*/React.createElement("span",{className:"ml-2 font-medium"},sdnData.vnets.length)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('subnets')||'Subnets',":"),/*#__PURE__*/React.createElement("span",{className:"ml-2 font-medium"},sdnData.subnets.length)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('controllers')||'Controllers',":"),/*#__PURE__*/React.createElement("span",{className:"ml-2 font-medium"},sdnData.controllers.length)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"IPAM:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 font-medium"},sdnData.ipams?.length||0)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"DNS:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 font-medium"},sdnData.dns?.length||0)))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Cpu,{className:"w-5 h-5 text-blue-400"}),t('controllers')||'Controllers'),/*#__PURE__*/React.createElement("button",{onClick:()=>{setNewController({controller:'',type:'evpn'});setShowAddController(true);},className:"flex items-center gap-2 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm"},/*#__PURE__*/React.createElement(Icons.Plus,null)," ",t('add'))),sdnData.controllers.length===0?/*#__PURE__*/React.createElement("div",{className:"p-6 text-center text-gray-500 text-sm"},t('noControllers')||'No controllers configured. Controllers are needed for EVPN/VXLAN zones.'):/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('name')||'Name'),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('type')||'Type'),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"ASN"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Peers"),/*#__PURE__*/React.createElement("th",{className:"text-right p-3 text-sm text-gray-400"},t('actions')))),/*#__PURE__*/React.createElement("tbody",null,sdnData.controllers.map(ctrl=>/*#__PURE__*/React.createElement("tr",{key:ctrl.controller,className:"border-t border-proxmox-border hover:bg-proxmox-hover"},/*#__PURE__*/React.createElement("td",{className:"p-3 font-medium text-white"},ctrl.controller),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-1 rounded text-xs ${ctrl.type==='evpn'?'bg-purple-500/20 text-purple-400':ctrl.type==='bgp'?'bg-blue-500/20 text-blue-400':ctrl.type==='isis'?'bg-orange-500/20 text-orange-400':'bg-gray-500/20 text-gray-400'}`},ctrl.type?.toUpperCase())),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},ctrl.asn||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},ctrl.peers||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-right"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(confirm(`Delete controller "${ctrl.controller}"?`)){try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/sdn/controllers/${ctrl.controller}`,{method:'DELETE'});if(res.ok){addToast('Controller deleted - Click Apply to activate','success');addToast('ðŸ’¡ Click "Apply / Reload" to deploy','info');fetchAllData();}else{const err=await res.json();addToast(err.error||'Failed','error');}}catch(e){addToast('Failed','error');}}},className:"p-1.5 hover:bg-red-500/20 rounded text-red-400"},/*#__PURE__*/React.createElement(Icons.Trash2,{className:"w-4 h-4"})))))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Database,{className:"w-5 h-5 text-green-400"}),"IPAM"),/*#__PURE__*/React.createElement("button",{onClick:()=>{setNewIpam({ipam:'',type:'pve'});setShowAddIpam(true);},className:"flex items-center gap-2 px-3 py-1.5 bg-green-600 hover:bg-green-700 rounded-lg text-sm"},/*#__PURE__*/React.createElement(Icons.Plus,null)," ",t('add'))),(sdnData.ipams?.length||0)===0?/*#__PURE__*/React.createElement("div",{className:"p-6 text-center text-gray-500 text-sm"},t('noIpam')||'No IPAM configured. IPAM provides IP address management for subnets.'):/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('name')||'Name'),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('type')||'Type'),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"URL"),/*#__PURE__*/React.createElement("th",{className:"text-right p-3 text-sm text-gray-400"},t('actions')))),/*#__PURE__*/React.createElement("tbody",null,sdnData.ipams?.map(ipam=>/*#__PURE__*/React.createElement("tr",{key:ipam.ipam,className:"border-t border-proxmox-border hover:bg-proxmox-hover"},/*#__PURE__*/React.createElement("td",{className:"p-3 font-medium text-white"},ipam.ipam),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-1 rounded text-xs ${ipam.type==='pve'?'bg-orange-500/20 text-orange-400':ipam.type==='netbox'?'bg-blue-500/20 text-blue-400':ipam.type==='phpipam'?'bg-purple-500/20 text-purple-400':'bg-gray-500/20 text-gray-400'}`},ipam.type)),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},ipam.url||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-right"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(confirm(`Delete IPAM "${ipam.ipam}"?`)){try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/sdn/ipams/${ipam.ipam}`,{method:'DELETE'});if(res.ok){addToast('IPAM deleted - Click Apply to activate','success');addToast('ðŸ’¡ Click "Apply / Reload" to deploy','info');fetchAllData();}else{const err=await res.json();addToast(err.error||'Failed','error');}}catch(e){addToast('Failed','error');}}},className:"p-1.5 hover:bg-red-500/20 rounded text-red-400"},/*#__PURE__*/React.createElement(Icons.Trash2,{className:"w-4 h-4"})))))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Globe,{className:"w-5 h-5 text-cyan-400"}),"DNS"),/*#__PURE__*/React.createElement("button",{onClick:()=>{setNewDns({dns:'',type:'powerdns',url:'',key:'',reversev6mask:64});setShowAddDns(true);},className:"flex items-center gap-2 px-3 py-1.5 bg-cyan-600 hover:bg-cyan-700 rounded-lg text-sm"},/*#__PURE__*/React.createElement(Icons.Plus,null)," ",t('add'))),(sdnData.dns?.length||0)===0?/*#__PURE__*/React.createElement("div",{className:"p-6 text-center text-gray-500 text-sm"},t('noDns')||'No DNS configured. DNS integration enables automatic DNS registration for VMs.'):/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('name')||'Name'),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('type')||'Type'),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"URL"),/*#__PURE__*/React.createElement("th",{className:"text-right p-3 text-sm text-gray-400"},t('actions')))),/*#__PURE__*/React.createElement("tbody",null,sdnData.dns?.map(dns=>/*#__PURE__*/React.createElement("tr",{key:dns.dns,className:"border-t border-proxmox-border hover:bg-proxmox-hover"},/*#__PURE__*/React.createElement("td",{className:"p-3 font-medium text-white"},dns.dns),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:"px-2 py-1 rounded text-xs bg-cyan-500/20 text-cyan-400"},dns.type)),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},dns.url||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-right"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(confirm(`Delete DNS "${dns.dns}"?`)){try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/sdn/dns/${dns.dns}`,{method:'DELETE'});if(res.ok){addToast('DNS deleted - Click Apply to activate','success');addToast('ðŸ’¡ Click "Apply / Reload" to deploy','info');fetchAllData();}else{const err=await res.json();addToast(err.error||'Failed','error');}}catch(e){addToast('Failed','error');}}},className:"p-1.5 hover:bg-red-500/20 rounded text-red-400"},/*#__PURE__*/React.createElement(Icons.Trash2,{className:"w-4 h-4"}))))))))),showAddZone&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-2xl p-6 max-h-[90vh] overflow-y-auto"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-4"},t('addZone')||'Add Zone'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('zoneName')||'Zone Name'," *"),/*#__PURE__*/React.createElement("input",{type:"text",value:newZone.zone,onChange:e=>setNewZone({...newZone,zone:e.target.value}),placeholder:"myzone",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('type')||'Type'," *"),/*#__PURE__*/React.createElement("select",{value:newZone.type,onChange:e=>setNewZone({...newZone,type:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:"simple"},"Simple"),/*#__PURE__*/React.createElement("option",{value:"vlan"},"VLAN"),/*#__PURE__*/React.createElement("option",{value:"qinq"},"QinQ"),/*#__PURE__*/React.createElement("option",{value:"vxlan"},"VXLAN"),/*#__PURE__*/React.createElement("option",{value:"evpn"},"EVPN")))),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 -mt-2"},newZone.type==='simple'&&(t('simpleZoneDesc')||'Isolated zone with simple bridging - each node has its own bridge'),newZone.type==='vlan'&&(t('vlanZoneDesc')||'VLAN-based zone using 802.1q tagging on a shared bridge'),newZone.type==='qinq'&&'QinQ (802.1ad) - VLAN stacking for service provider networks',newZone.type==='vxlan'&&(t('vxlanZoneDesc')||'VXLAN overlay network - Layer 2 over Layer 3 using UDP encapsulation'),newZone.type==='evpn'&&(t('evpnZoneDesc')||'BGP EVPN with VXLAN - advanced datacenter fabric with BGP control plane')),(newZone.type==='vlan'||newZone.type==='qinq')&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Bridge *"),/*#__PURE__*/React.createElement("input",{type:"text",value:newZone.bridge||'',onChange:e=>setNewZone({...newZone,bridge:e.target.value}),placeholder:"vmbr0",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},"Physical bridge to use for VLAN tagging")),(newZone.type==='vxlan'||newZone.type==='evpn')&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Peers (multicast/unicast)"),/*#__PURE__*/React.createElement("input",{type:"text",value:newZone.peers||'',onChange:e=>setNewZone({...newZone,peers:e.target.value}),placeholder:"10.0.0.1,10.0.0.2",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),newZone.type==='evpn'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Controller"),/*#__PURE__*/React.createElement("select",{value:newZone.controller||'',onChange:e=>setNewZone({...newZone,controller:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:""},"-- Select --"),sdnData.controllers.map(c=>/*#__PURE__*/React.createElement("option",{key:c.controller,value:c.controller},c.controller," (",c.type,")"))))),newZone.type==='evpn'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"VRF VXLAN ID"),/*#__PURE__*/React.createElement("input",{type:"number",value:newZone['vrf-vxlan']||'',onChange:e=>setNewZone({...newZone,'vrf-vxlan':e.target.value}),placeholder:"Auto",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Exit Nodes"),/*#__PURE__*/React.createElement("input",{type:"text",value:newZone['exitnodes']||'',onChange:e=>setNewZone({...newZone,'exitnodes':e.target.value}),placeholder:"node1,node2",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"MTU"),/*#__PURE__*/React.createElement("input",{type:"number",value:newZone.mtu||'',onChange:e=>setNewZone({...newZone,mtu:e.target.value}),placeholder:"auto",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Nodes"),/*#__PURE__*/React.createElement("input",{type:"text",value:newZone.nodes||'',onChange:e=>setNewZone({...newZone,nodes:e.target.value}),placeholder:"all (or: node1,node2)",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"IPAM"),/*#__PURE__*/React.createElement("select",{value:newZone.ipam||'',onChange:e=>setNewZone({...newZone,ipam:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:""},"-- None --"),sdnData.ipams?.map(i=>/*#__PURE__*/React.createElement("option",{key:i.ipam,value:i.ipam},i.ipam," (",i.type,")")))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"DNS Server"),/*#__PURE__*/React.createElement("select",{value:newZone.dns||'',onChange:e=>setNewZone({...newZone,dns:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:""},"-- None --"),sdnData.dns?.map(d=>/*#__PURE__*/React.createElement("option",{key:d.dns,value:d.dns},d.dns," (",d.type,")"))))),newZone.dns&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"DNS Zone"),/*#__PURE__*/React.createElement("input",{type:"text",value:newZone.dnszone||'',onChange:e=>setNewZone({...newZone,dnszone:e.target.value}),placeholder:"example.com",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Reverse DNS Zone"),/*#__PURE__*/React.createElement("input",{type:"text",value:newZone.reversedns||'',onChange:e=>setNewZone({...newZone,reversedns:e.target.value}),placeholder:"10.in-addr.arpa",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddZone(false),className:"px-4 py-2 bg-proxmox-border hover:bg-proxmox-hover rounded-lg"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!newZone.zone){addToast(t('zoneNameRequired')||'Zone name is required','error');return;}if((newZone.type==='vlan'||newZone.type==='qinq')&&!newZone.bridge){addToast('Bridge is required for VLAN/QinQ zones','error');return;}try{// Build payload with only non-empty values
const payload={zone:newZone.zone,type:newZone.type};['bridge','mtu','nodes','ipam','dns','dnszone','reversedns','peers','controller','vrf-vxlan','exitnodes'].forEach(key=>{if(newZone[key])payload[key]=newZone[key];});if(payload.mtu)payload.mtu=parseInt(payload.mtu);const res=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/sdn/zones`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(res.ok){addToast(t('zoneCreated')||'Zone created','success');addToast(t('sdnApplyReminder')||'ðŸ’¡ Remember to click "Apply / Reload" to deploy changes','info');setShowAddZone(false);setNewZone({zone:'',type:'simple',bridge:'',mtu:'',nodes:'',ipam:'',dns:'',dnszone:'',reversedns:''});fetchAllData();}else{const err=await res.json();addToast(err.error||'Failed to create zone','error');}}catch(e){addToast('Failed to create zone','error');}},className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg"},t('create'))))),showAddVnet&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-md p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-4"},t('addVnet')||'Add VNet'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('vnetName')||'VNet Name'),/*#__PURE__*/React.createElement("input",{type:"text",value:newVnet.vnet,onChange:e=>setNewVnet({...newVnet,vnet:e.target.value}),placeholder:"myvnet",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('zone')||'Zone'),/*#__PURE__*/React.createElement("select",{value:newVnet.zone,onChange:e=>setNewVnet({...newVnet,zone:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},sdnData.zones.map(z=>/*#__PURE__*/React.createElement("option",{key:z.zone,value:z.zone},z.zone," (",z.type,")")))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('alias')||'Alias'," (",t('optional'),")"),/*#__PURE__*/React.createElement("input",{type:"text",value:newVnet.alias,onChange:e=>setNewVnet({...newVnet,alias:e.target.value}),placeholder:"My Network",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"VLAN Tag (",t('optional'),")"),/*#__PURE__*/React.createElement("input",{type:"number",value:newVnet.tag,onChange:e=>setNewVnet({...newVnet,tag:e.target.value}),placeholder:"100",min:"1",max:"4094",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddVnet(false),className:"px-4 py-2 bg-proxmox-border hover:bg-proxmox-hover rounded-lg"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!newVnet.vnet||!newVnet.zone){addToast(t('vnetNameZoneRequired')||'VNet name and zone are required','error');return;}try{const payload={vnet:newVnet.vnet,zone:newVnet.zone};if(newVnet.alias)payload.alias=newVnet.alias;if(newVnet.tag)payload.tag=parseInt(newVnet.tag);const res=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/sdn/vnets`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(res.ok){addToast(t('vnetCreated')||'VNet created','success');addToast(t('sdnApplyReminder')||'ðŸ’¡ Click "Apply / Reload" to deploy','info');setShowAddVnet(false);fetchAllData();}else{const err=await res.json();addToast(err.error||'Failed to create VNet','error');}}catch(e){addToast('Failed to create VNet','error');}},className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg"},t('create'))))),showAddSubnet&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-lg p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-4"},t('addSubnet')||'Add Subnet'," - ",showAddSubnet),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Subnet (CIDR) *"),/*#__PURE__*/React.createElement("input",{type:"text",value:newSubnet.subnet,onChange:e=>setNewSubnet({...newSubnet,subnet:e.target.value}),placeholder:"10.0.0.0/24",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('gateway')||'Gateway'),/*#__PURE__*/React.createElement("input",{type:"text",value:newSubnet.gateway,onChange:e=>setNewSubnet({...newSubnet,gateway:e.target.value}),placeholder:"10.0.0.1",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"DNS Server"),/*#__PURE__*/React.createElement("input",{type:"text",value:newSubnet.dnszoneprefix||'',onChange:e=>setNewSubnet({...newSubnet,dnszoneprefix:e.target.value}),placeholder:"10.0.0.1",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"DHCP Range"),/*#__PURE__*/React.createElement("input",{type:"text",value:newSubnet['dhcp-range']||'',onChange:e=>setNewSubnet({...newSubnet,'dhcp-range':e.target.value}),placeholder:"start-address=10.0.0.100,end-address=10.0.0.200",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},"Format: start-address=IP,end-address=IP")),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newSubnet.snat===1,onChange:e=>setNewSubnet({...newSubnet,snat:e.target.checked?1:0}),className:"w-4 h-4 rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm"},"SNAT (",t('sourceNat')||'Source NAT',")")))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddSubnet(null),className:"px-4 py-2 bg-proxmox-border hover:bg-proxmox-hover rounded-lg"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!newSubnet.subnet){addToast(t('subnetRequired')||'Subnet is required','error');return;}try{const payload={subnet:newSubnet.subnet};if(newSubnet.gateway)payload.gateway=newSubnet.gateway;if(newSubnet.snat)payload.snat=1;if(newSubnet['dhcp-range'])payload['dhcp-range']=newSubnet['dhcp-range'];if(newSubnet.dnszoneprefix)payload.dnszoneprefix=newSubnet.dnszoneprefix;const res=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/sdn/vnets/${showAddSubnet}/subnets`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(res.ok){addToast(t('subnetCreated')||'Subnet created','success');addToast(t('sdnApplyReminder')||'ðŸ’¡ Click "Apply / Reload" to deploy','info');setShowAddSubnet(null);setNewSubnet({subnet:'',gateway:'',snat:0,dhcp:'none','dhcp-range':''});fetchAllData();}else{const err=await res.json();addToast(err.error||'Failed to create subnet','error');}}catch(e){addToast('Failed to create subnet','error');}},className:"px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg"},t('create'))))),showAddController&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-lg p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-4"},t('addController')||'Add Controller'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('name')||'Name'),/*#__PURE__*/React.createElement("input",{type:"text",value:newController.controller,onChange:e=>setNewController({...newController,controller:e.target.value}),placeholder:"mycontroller",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('type')||'Type'),/*#__PURE__*/React.createElement("select",{value:newController.type,onChange:e=>setNewController({...newController,type:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:"evpn"},"EVPN"),/*#__PURE__*/React.createElement("option",{value:"bgp"},"BGP"),/*#__PURE__*/React.createElement("option",{value:"isis"},"ISIS")))),(newController.type==='evpn'||newController.type==='bgp')&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"ASN"),/*#__PURE__*/React.createElement("input",{type:"number",value:newController.asn,onChange:e=>setNewController({...newController,asn:e.target.value}),placeholder:"65000",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Peers"),/*#__PURE__*/React.createElement("input",{type:"text",value:newController.peers,onChange:e=>setNewController({...newController,peers:e.target.value}),placeholder:"10.0.0.1,10.0.0.2",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}))),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newController.ebgp===1,onChange:e=>setNewController({...newController,ebgp:e.target.checked?1:0}),className:"w-4 h-4 rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm"},"eBGP")),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newController['ebgp-multihop']===1,onChange:e=>setNewController({...newController,'ebgp-multihop':e.target.checked?1:0}),className:"w-4 h-4 rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm"},"eBGP Multihop")),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newController['bgp-multipath-as-path-relax']===1,onChange:e=>setNewController({...newController,'bgp-multipath-as-path-relax':e.target.checked?1:0}),className:"w-4 h-4 rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm"},"Multipath AS-Path Relax")))),newController.type==='isis'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"ISIS Domain"),/*#__PURE__*/React.createElement("input",{type:"text",value:newController['isis-domain']||'',onChange:e=>setNewController({...newController,'isis-domain':e.target.value}),placeholder:"49.0001",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddController(false),className:"px-4 py-2 bg-proxmox-border hover:bg-proxmox-hover rounded-lg"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!newController.controller){addToast('Controller name is required','error');return;}try{const payload={controller:newController.controller,type:newController.type};if(newController.asn)payload.asn=parseInt(newController.asn);if(newController.peers)payload.peers=newController.peers;if(newController.ebgp)payload.ebgp=1;if(newController['ebgp-multihop'])payload['ebgp-multihop']=1;if(newController['bgp-multipath-as-path-relax'])payload['bgp-multipath-as-path-relax']=1;if(newController['isis-domain'])payload['isis-domain']=newController['isis-domain'];const res=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/sdn/controllers`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(res.ok){addToast('Controller created - Click Apply to activate','success');addToast('ðŸ’¡ Click "Apply / Reload" to deploy','info');setShowAddController(false);fetchAllData();}else{const err=await res.json();addToast(err.error||'Failed','error');}}catch(e){addToast('Failed to create controller','error');}},className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg"},t('create'))))),showAddIpam&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-lg p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-4"},t('addIpam')||'Add IPAM'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('name')||'Name'),/*#__PURE__*/React.createElement("input",{type:"text",value:newIpam.ipam,onChange:e=>setNewIpam({...newIpam,ipam:e.target.value}),placeholder:"myipam",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('type')||'Type'),/*#__PURE__*/React.createElement("select",{value:newIpam.type,onChange:e=>setNewIpam({...newIpam,type:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:"pve"},"PVE (built-in)"),/*#__PURE__*/React.createElement("option",{value:"netbox"},"Netbox"),/*#__PURE__*/React.createElement("option",{value:"phpipam"},"phpIPAM")))),newIpam.type!=='pve'&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"URL"),/*#__PURE__*/React.createElement("input",{type:"text",value:newIpam.url,onChange:e=>setNewIpam({...newIpam,url:e.target.value}),placeholder:"https://netbox.example.com/api",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Token / API Key"),/*#__PURE__*/React.createElement("input",{type:"password",value:newIpam.token,onChange:e=>setNewIpam({...newIpam,token:e.target.value}),placeholder:"API token",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),newIpam.type==='phpipam'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Section"),/*#__PURE__*/React.createElement("input",{type:"number",value:newIpam.section,onChange:e=>setNewIpam({...newIpam,section:e.target.value}),placeholder:"1",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}))),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},newIpam.type==='pve'&&'Built-in PVE IPAM stores IP assignments locally in the cluster.',newIpam.type==='netbox'&&'Netbox is an open source IPAM and DCIM tool.',newIpam.type==='phpipam'&&'phpIPAM is an open source IP address management application.')),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddIpam(false),className:"px-4 py-2 bg-proxmox-border hover:bg-proxmox-hover rounded-lg"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!newIpam.ipam){addToast('IPAM name is required','error');return;}try{const payload={ipam:newIpam.ipam,type:newIpam.type};if(newIpam.url)payload.url=newIpam.url;if(newIpam.token)payload.token=newIpam.token;if(newIpam.section)payload.section=parseInt(newIpam.section);const res=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/sdn/ipams`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(res.ok){addToast('IPAM created - Click Apply to activate','success');addToast('ðŸ’¡ Click "Apply / Reload" to deploy','info');setShowAddIpam(false);fetchAllData();}else{const err=await res.json();addToast(err.error||'Failed','error');}}catch(e){addToast('Failed to create IPAM','error');}},className:"px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg"},t('create'))))),showAddDns&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-lg p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-4"},t('addDns')||'Add DNS'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('name')||'Name'),/*#__PURE__*/React.createElement("input",{type:"text",value:newDns.dns,onChange:e=>setNewDns({...newDns,dns:e.target.value}),placeholder:"mydns",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('type')||'Type'),/*#__PURE__*/React.createElement("select",{value:newDns.type,onChange:e=>setNewDns({...newDns,type:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:"powerdns"},"PowerDNS")))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"URL"),/*#__PURE__*/React.createElement("input",{type:"text",value:newDns.url,onChange:e=>setNewDns({...newDns,url:e.target.value}),placeholder:"http://powerdns.example.com:8081/api/v1/servers/localhost",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"API Key"),/*#__PURE__*/React.createElement("input",{type:"password",value:newDns.key,onChange:e=>setNewDns({...newDns,key:e.target.value}),placeholder:"PowerDNS API key",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"TTL (",t('seconds'),")"),/*#__PURE__*/React.createElement("input",{type:"number",value:newDns.ttl,onChange:e=>setNewDns({...newDns,ttl:e.target.value}),placeholder:"3600",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Reverse IPv6 Mask"),/*#__PURE__*/React.createElement("input",{type:"number",value:newDns.reversemaskv6,onChange:e=>setNewDns({...newDns,reversemaskv6:e.target.value}),placeholder:"64",min:"1",max:"128",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}))),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},"PowerDNS integration enables automatic DNS registration for VMs with static IPs.")),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddDns(false),className:"px-4 py-2 bg-proxmox-border hover:bg-proxmox-hover rounded-lg"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!newDns.dns||!newDns.url||!newDns.key){addToast('DNS name, URL and API key are required','error');return;}try{const payload={dns:newDns.dns,type:newDns.type,url:newDns.url,key:newDns.key};if(newDns.ttl)payload.ttl=parseInt(newDns.ttl);if(newDns.reversemaskv6)payload.reversemaskv6=parseInt(newDns.reversemaskv6);const res=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/sdn/dns`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(res.ok){addToast('DNS created - Click Apply to activate','success');addToast('ðŸ’¡ Click "Apply / Reload" to deploy','info');setShowAddDns(false);fetchAllData();}else{const err=await res.json();addToast(err.error||'Failed','error');}}catch(e){addToast('Failed to create DNS','error');}},className:"px-4 py-2 bg-cyan-600 hover:bg-cyan-700 rounded-lg"},t('create')))))),activeSection==='backup'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},t('backupJobs')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddBackupJob(true),className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm"},/*#__PURE__*/React.createElement(Icons.Plus,null)," ",t('add'))),/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('enabled')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Node"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('schedule')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Storage"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Mode"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"VMs"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"}))),/*#__PURE__*/React.createElement("tbody",null,backupJobs.length===0?/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:"7",className:"p-8 text-center text-gray-500"},t('noBackupJobs'))):backupJobs.map((job,idx)=>/*#__PURE__*/React.createElement("tr",{key:job.id||idx,className:"border-t border-proxmox-border hover:bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("td",{className:"p-3"},job.enabled!==0?/*#__PURE__*/React.createElement("span",{className:"text-green-400"},"\u2713"):/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"\u2717")),/*#__PURE__*/React.createElement("td",{className:"p-3"},job.node||t('all')),/*#__PURE__*/React.createElement("td",{className:"p-3 font-mono text-sm"},job.schedule||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3"},job.storage||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs ${job.mode==='snapshot'?'bg-green-500/20 text-green-400':job.mode==='suspend'?'bg-yellow-500/20 text-yellow-400':'bg-blue-500/20 text-blue-400'}`},job.mode||'snapshot')),/*#__PURE__*/React.createElement("td",{className:"p-3 text-sm"},job.vmid||t('all')),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("button",{onClick:()=>deleteBackupJob(job.id),className:"p-1 hover:bg-red-500/20 rounded text-red-400"},/*#__PURE__*/React.createElement(Icons.Trash,null)))))))),showAddBackupJob&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70",onClick:()=>setShowAddBackupJob(false)},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-2xl bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border bg-proxmox-dark"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Clock,null),t('createBackupJob')||'Create Backup Job')),/*#__PURE__*/React.createElement("div",{className:"p-6 space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Storage *"),/*#__PURE__*/React.createElement("select",{value:newBackupJob.storage,onChange:e=>setNewBackupJob({...newBackupJob,storage:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:""},t('selectStorage')||'Select Storage'),(storage||[]).filter(s=>s.content?.includes('backup')).map(s=>/*#__PURE__*/React.createElement("option",{key:s.storage,value:s.storage},s.storage)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('schedule')),/*#__PURE__*/React.createElement("select",{value:['hourly','daily','weekly','monthly'].includes(newBackupJob.schedule)?newBackupJob.schedule:'custom',onChange:e=>{if(e.target.value==='custom'){setNewBackupJob({...newBackupJob,schedule:'02:00'});}else{setNewBackupJob({...newBackupJob,schedule:e.target.value});}},className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:"hourly"},t('hourly')||'Hourly'),/*#__PURE__*/React.createElement("option",{value:"daily"},t('daily')||'Daily'," (02:00)"),/*#__PURE__*/React.createElement("option",{value:"weekly"},t('weekly')||'Weekly'," (Sun 02:00)"),/*#__PURE__*/React.createElement("option",{value:"monthly"},t('monthly')||'Monthly'," (1st 02:00)"),/*#__PURE__*/React.createElement("option",{value:"custom"},t('custom')||'Custom')),!['hourly','daily','weekly','monthly'].includes(newBackupJob.schedule)&&/*#__PURE__*/React.createElement("input",{type:"text",value:newBackupJob.schedule,onChange:e=>setNewBackupJob({...newBackupJob,schedule:e.target.value}),placeholder:"e.g. 02:00, sat 03:00, *-*-01 04:00",className:"w-full mt-2 px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Node"),/*#__PURE__*/React.createElement("select",{value:newBackupJob.node,onChange:e=>setNewBackupJob({...newBackupJob,node:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:""},t('allNodes')||'All Nodes'),(clusterNodes||[]).map(n=>/*#__PURE__*/React.createElement("option",{key:n.node,value:n.node},n.node)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Mode"),/*#__PURE__*/React.createElement("select",{value:newBackupJob.mode,onChange:e=>setNewBackupJob({...newBackupJob,mode:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:"snapshot"},"Snapshot"),/*#__PURE__*/React.createElement("option",{value:"suspend"},"Suspend"),/*#__PURE__*/React.createElement("option",{value:"stop"},"Stop")))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('compression')||'Compression'),/*#__PURE__*/React.createElement("select",{value:newBackupJob.compress,onChange:e=>setNewBackupJob({...newBackupJob,compress:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:"0"},"None"),/*#__PURE__*/React.createElement("option",{value:"gzip"},"GZIP"),/*#__PURE__*/React.createElement("option",{value:"lzo"},"LZO"),/*#__PURE__*/React.createElement("option",{value:"zstd"},"ZSTD (recommended)"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"VM IDs (",t('optional'),")"),/*#__PURE__*/React.createElement("input",{type:"text",value:newBackupJob.vmid,onChange:e=>setNewBackupJob({...newBackupJob,vmid:e.target.value}),placeholder:"100,101,102 or empty for all",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('notification')||'Notification'),/*#__PURE__*/React.createElement("select",{value:newBackupJob.mailnotification,onChange:e=>setNewBackupJob({...newBackupJob,mailnotification:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:"always"},t('always')||'Always'),/*#__PURE__*/React.createElement("option",{value:"failure"},t('onFailure')||'On Failure'),/*#__PURE__*/React.createElement("option",{value:"never"},t('never')||'Never'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Email (",t('optional'),")"),/*#__PURE__*/React.createElement("input",{type:"email",value:newBackupJob.mailto,onChange:e=>setNewBackupJob({...newBackupJob,mailto:e.target.value}),placeholder:"admin@example.com",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newBackupJob.enabled===1,onChange:e=>setNewBackupJob({...newBackupJob,enabled:e.target.checked?1:0}),className:"rounded"}),/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-300"},t('enabled')))),/*#__PURE__*/React.createElement("div",{className:"p-4 border-t border-proxmox-border bg-proxmox-dark flex justify-end gap-3"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddBackupJob(false),className:"px-4 py-2 text-gray-400 hover:text-white"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:createBackupJob,disabled:!newBackupJob.storage,className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed"},t('create')))))),activeSection==='replication'&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},"Replication Jobs")),/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Enabled"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Guest"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Job"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Target"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Schedule"))),/*#__PURE__*/React.createElement("tbody",null,replicationJobs.length===0?/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:"5",className:"p-8 text-center text-gray-500"},t('noReplicationJobs')||'No Replication Jobs')):replicationJobs.map((job,idx)=>/*#__PURE__*/React.createElement("tr",{key:idx,className:"border-t border-proxmox-border hover:bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("td",{className:"p-3"},job.disable?/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"\u2717"):/*#__PURE__*/React.createElement("span",{className:"text-green-400"},"\u2713")),/*#__PURE__*/React.createElement("td",{className:"p-3"},job.guest),/*#__PURE__*/React.createElement("td",{className:"p-3"},job.jobnum),/*#__PURE__*/React.createElement("td",{className:"p-3"},job.target),/*#__PURE__*/React.createElement("td",{className:"p-3 font-mono text-sm"},job.schedule)))))),activeSection==='cpucompat'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},recommendedCpu&&cpuInfo.length>0&&/*#__PURE__*/React.createElement("div",{className:"bg-gradient-to-r from-purple-500/20 to-blue-500/20 border border-purple-500/30 rounded-xl p-6"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("div",{className:"p-4 bg-purple-500/20 rounded-xl"},/*#__PURE__*/React.createElement(Icons.Cpu,{className:"w-8 h-8 text-purple-400"})),/*#__PURE__*/React.createElement("div",{className:"flex-1"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-1"},t('autoDetectedRecommendation')||'Auto-Detected Recommendation'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-300 mb-3"},t('basedOnClusterCpus')||'Based on the CPUs detected in your cluster, we recommend:'),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("code",{className:"text-xl font-bold text-purple-400 bg-proxmox-dark px-4 py-2 rounded-lg"},"cpu: ",recommendedCpu),/*#__PURE__*/React.createElement("button",{onClick:()=>{navigator.clipboard.writeText(`cpu: ${recommendedCpu}`);},className:"px-3 py-2 bg-purple-500/20 hover:bg-purple-500/30 text-purple-400 rounded-lg text-sm transition-colors"},t('copy')||'Copy'))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3 mb-4"},/*#__PURE__*/React.createElement("div",{className:"p-3 bg-purple-500/10 rounded-lg"},/*#__PURE__*/React.createElement(Icons.Cpu,{className:"text-purple-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"font-semibold text-white"},t('cpuCompatibilityMode')||'CPU Compatibility Mode'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},t('cpuCompatibilityDesc')||'Ensure live migration compatibility across different CPU generations'))),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg mb-6"},/*#__PURE__*/React.createElement("h4",{className:"text-blue-400 font-medium mb-2 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4"}),t('whatIsCpuCompat')||'What is CPU Compatibility Mode?'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-300 mb-2"},t('cpuCompatExplain')||'When you have nodes with different CPU generations (e.g., Haswell and Skylake), live migration may fail because newer CPUs expose features that older CPUs don\'t support.'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-300"},t('cpuCompatSolution')||'By setting all VMs to use a common CPU type, you ensure they can migrate between any node in the cluster.')),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},t('availableLevels')||'Available Compatibility Levels'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},[{id:'x86-64-v2-AES',label:'x86-64-v2-AES',color:'green',tag:t('safest')||'Safest',desc:t('broadCompatibility')||'Broad compatibility - works with most CPUs from 2008+'},{id:'x86-64-v3',label:'x86-64-v3',color:'blue',tag:t('modern')||'Modern',desc:t('haswell')||'Haswell and newer (2013+)'},{id:'x86-64-v4',label:'x86-64-v4',color:'yellow',tag:t('newest')||'Newest',desc:t('skylakeAvx')||'Skylake-X with AVX-512 (2017+)'},{id:'host',label:'host',color:'red',tag:t('noMigration')||'No Migration',desc:t('hostDesc')||'Pass-through host CPU - best performance, no migration'}].map(level=>/*#__PURE__*/React.createElement("div",{key:level.id,onClick:()=>navigator.clipboard.writeText(`cpu: ${level.label}`),className:`p-4 bg-proxmox-dark rounded-lg border transition-all cursor-pointer ${recommendedCpu===level.id?'border-purple-500 ring-2 ring-purple-500/30':'border-proxmox-border hover:border-purple-500/50'}`},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-2"},/*#__PURE__*/React.createElement("span",{className:"font-medium text-white"},level.label),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},recommendedCpu===level.id&&/*#__PURE__*/React.createElement("span",{className:"text-xs px-2 py-1 bg-purple-500/20 text-purple-400 rounded"},t('recommended')||'Recommended'),/*#__PURE__*/React.createElement("span",{className:`text-xs px-2 py-1 rounded bg-${level.color}-500/20 text-${level.color}-400`},level.tag))),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-400 mb-2"},level.desc),/*#__PURE__*/React.createElement("code",{className:"text-xs bg-proxmox-darker px-2 py-1 rounded font-mono text-purple-400"},"cpu: ",level.label))))),/*#__PURE__*/React.createElement("div",{className:"mt-6 pt-6 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Server,{className:"w-4 h-4"}),t('detectedClusterCpus')||'Detected Cluster CPUs'),cpuInfo.length>0?/*#__PURE__*/React.createElement("div",{className:"space-y-2"},cpuInfo.map(info=>/*#__PURE__*/React.createElement("div",{key:info.node,className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"w-2 h-2 rounded-full bg-green-500"}),/*#__PURE__*/React.createElement("span",{className:"font-medium text-white"},info.node)),/*#__PURE__*/React.createElement("span",{className:`text-xs px-2 py-1 rounded ${info.detectedLevel==='v4'?'bg-yellow-500/20 text-yellow-400':info.detectedLevel==='v3'?'bg-blue-500/20 text-blue-400':'bg-green-500/20 text-green-400'}`},"x86-64-",info.detectedLevel)),/*#__PURE__*/React.createElement("div",{className:"mt-2 flex items-center justify-between text-sm"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400 font-mono truncate max-w-md"},info.model),/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},info.generation," \u2022 ",info.sockets,"x",info.cores," Cores"))))):/*#__PURE__*/React.createElement("div",{className:"text-center py-6 text-gray-500"},/*#__PURE__*/React.createElement(Icons.Cpu,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),t('loadingCpuInfo')||'Loading CPU information...')),/*#__PURE__*/React.createElement("div",{className:"mt-6 p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg"},/*#__PURE__*/React.createElement("h4",{className:"text-yellow-400 font-medium mb-2 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4"}),t('howToApply')||'How to Apply'),/*#__PURE__*/React.createElement("ol",{className:"text-sm text-gray-300 space-y-1 list-decimal list-inside"},/*#__PURE__*/React.createElement("li",null,t('cpuStep1')||'Go to each VM\'s Hardware tab'),/*#__PURE__*/React.createElement("li",null,t('cpuStep2')||'Edit the CPU setting'),/*#__PURE__*/React.createElement("li",null,t('cpuStep3')||'Change "Type" to your chosen compatibility level'),/*#__PURE__*/React.createElement("li",null,t('cpuStep4')||'Restart the VM for changes to take effect'))))),activeSection==='ha'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Activity,null),"Status"),/*#__PURE__*/React.createElement("button",{onClick:fetchAllData,className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-dark hover:bg-proxmox-border rounded-lg text-sm"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-4 h-4"}))),/*#__PURE__*/React.createElement("div",{className:"p-4 space-y-4"},haManagerStatus&&typeof haManagerStatus==='object'?/*#__PURE__*/React.createElement(React.Fragment,null,haManagerStatus.quorum&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3 p-3 bg-proxmox-dark/50 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:`w-3 h-3 rounded-full ${haManagerStatus.quorum.quorate==='1'||haManagerStatus.quorum.quorate===1?'bg-green-500':'bg-red-500'}`}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"font-medium"},"Quorum"),/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400"},haManagerStatus.quorum.quorate==='1'||haManagerStatus.quorum.quorate===1?'OK':'NOT OK',haManagerStatus.quorum.node&&` - Node: ${haManagerStatus.quorum.node}`))),haManagerStatus.manager_status&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-proxmox-dark/50 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"font-medium mb-2"},"Manager Status"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-2 text-sm"},/*#__PURE__*/React.createElement("div",{className:"text-gray-400"},"Master Node:"),/*#__PURE__*/React.createElement("div",{className:"text-green-400 font-mono"},String(haManagerStatus.manager_status.master_node||'-'))),haManagerStatus.manager_status.node_status&&/*#__PURE__*/React.createElement("div",{className:"mt-2"},/*#__PURE__*/React.createElement("div",{className:"text-gray-400 text-sm mb-1"},"Node Status:"),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-2"},Object.entries(haManagerStatus.manager_status.node_status).filter(([k])=>k!=='').map(([node,status])=>/*#__PURE__*/React.createElement("span",{key:node,className:`px-2 py-1 rounded text-xs ${status==='online'?'bg-green-500/20 text-green-400':'bg-red-500/20 text-red-400'}`},node,": ",String(status)))))),haManagerStatus.lrm_status&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-proxmox-dark/50 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"font-medium mb-2"},"LRM Status (Local Resource Manager)"),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},Object.entries(haManagerStatus.lrm_status).filter(([k])=>k!=='').map(([node,data])=>/*#__PURE__*/React.createElement("div",{key:node,className:"flex items-center justify-between text-sm p-2 bg-proxmox-dark rounded"},/*#__PURE__*/React.createElement("span",{className:"font-mono"},node),/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs ${data&&data.mode==='active'?'bg-green-500/20 text-green-400':'bg-yellow-500/20 text-yellow-400'}`},data?String(data.mode||'unknown'):'unknown')))))):/*#__PURE__*/React.createElement("p",{className:"text-gray-500 text-center py-4"},"No HA status available"))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Server,null),"Resources"),/*#__PURE__*/React.createElement("button",{onClick:async()=>{// Fetch available VMs/CTs when opening modal
try{var res=await authFetch(API_URL+'/clusters/'+clusterId+'/resources');if(res&&res.ok){var allResources=await res.json();// Filter to VMs and CTs not already in HA
var haIds=(haResources||[]).map(function(r){return r.sid;});var available=(allResources||[]).filter(function(r){var sid=(r.type==='qemu'?'vm:':'ct:')+r.vmid;return(r.type==='qemu'||r.type==='lxc')&&!haIds.includes(sid);});setAvailableVmsForHa(available);}}catch(e){console.error('Failed to fetch VMs:',e);}setNewHaResource({sid:'',state:'started',group:'',max_restart:1,max_relocate:1,comment:''});setShowAddHaResource(true);},className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm"},/*#__PURE__*/React.createElement(Icons.Plus,{className:"w-4 h-4"})," Add")),/*#__PURE__*/React.createElement("div",{className:"overflow-x-auto"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",{className:"text-left text-gray-400 text-sm bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("th",{className:"p-3"},"ID"),/*#__PURE__*/React.createElement("th",{className:"p-3"},"State"),/*#__PURE__*/React.createElement("th",{className:"p-3"},"Node"),/*#__PURE__*/React.createElement("th",{className:"p-3"},"Max Restart"),/*#__PURE__*/React.createElement("th",{className:"p-3"},"Max Relocate"),/*#__PURE__*/React.createElement("th",{className:"p-3"},"Group"),/*#__PURE__*/React.createElement("th",{className:"p-3"},"Comment"),/*#__PURE__*/React.createElement("th",{className:"p-3"},"Actions"))),/*#__PURE__*/React.createElement("tbody",null,haResources&&Array.isArray(haResources)&&haResources.length>0?haResources.map((res,idx)=>/*#__PURE__*/React.createElement("tr",{key:idx,className:"border-t border-proxmox-border hover:bg-proxmox-dark/30"},/*#__PURE__*/React.createElement("td",{className:"p-3 font-mono text-sm"},String(res.sid||'')),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-1 rounded text-xs ${res.state==='started'?'bg-green-500/20 text-green-400':res.state==='stopped'?'bg-gray-500/20 text-gray-400':res.state==='error'?'bg-red-500/20 text-red-400':'bg-yellow-500/20 text-yellow-400'}`},String(res.state||'unknown'))),/*#__PURE__*/React.createElement("td",{className:"p-3"},String(res.node||'-')),/*#__PURE__*/React.createElement("td",{className:"p-3"},res.max_restart!==undefined?res.max_restart:1),/*#__PURE__*/React.createElement("td",{className:"p-3"},res.max_relocate!==undefined?res.max_relocate:1),/*#__PURE__*/React.createElement("td",{className:"p-3"},String(res.group||'-')),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400 text-sm max-w-xs truncate"},String(res.comment||'-')),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(confirm('Remove '+res.sid+' from HA?')){try{var r=await authFetch(API_URL+'/clusters/'+clusterId+'/proxmox-ha/resources/'+res.sid,{method:'DELETE'});if(r&&r.ok){addToast('Removed','success');fetchAllData();}else{addToast('Failed','error');}}catch(e){addToast('Error','error');}}},className:"p-1.5 hover:bg-red-500/20 rounded text-gray-400 hover:text-red-400",title:"Remove from HA"},/*#__PURE__*/React.createElement(Icons.Trash2,{className:"w-4 h-4"}))))):/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:"8",className:"p-8 text-center text-gray-500"},"No HA resources configured")))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Users,null),"Groups"),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddHaGroup(true),className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm"},/*#__PURE__*/React.createElement(Icons.Plus,{className:"w-4 h-4"})," Add")),/*#__PURE__*/React.createElement("div",{className:"overflow-x-auto"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",{className:"text-left text-gray-400 text-sm bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("th",{className:"p-3"},"Group"),/*#__PURE__*/React.createElement("th",{className:"p-3"},"Nodes"),/*#__PURE__*/React.createElement("th",{className:"p-3"},"Restricted"),/*#__PURE__*/React.createElement("th",{className:"p-3"},"No Failback"),/*#__PURE__*/React.createElement("th",{className:"p-3"},"Actions"))),/*#__PURE__*/React.createElement("tbody",null,haGroups&&Array.isArray(haGroups)&&haGroups.length>0?haGroups.map((grp,idx)=>/*#__PURE__*/React.createElement("tr",{key:idx,className:"border-t border-proxmox-border hover:bg-proxmox-dark/30"},/*#__PURE__*/React.createElement("td",{className:"p-3 font-medium"},String(grp.group||'')),/*#__PURE__*/React.createElement("td",{className:"p-3 font-mono text-sm"},String(grp.nodes||'-')),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:grp.restricted?'text-yellow-400':'text-gray-500'},grp.restricted?'Yes':'No')),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:grp.nofailback?'text-yellow-400':'text-gray-500'},grp.nofailback?'Yes':'No')),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(confirm('Delete group '+grp.group+'?')){try{var r=await authFetch(API_URL+'/clusters/'+clusterId+'/proxmox-ha/groups/'+grp.group,{method:'DELETE'});if(r&&r.ok){addToast('Deleted','success');fetchAllData();}else{addToast('Failed','error');}}catch(e){addToast('Error','error');}}},className:"p-1.5 hover:bg-red-500/20 rounded text-gray-400 hover:text-red-400",title:"Delete group"},/*#__PURE__*/React.createElement(Icons.Trash2,{className:"w-4 h-4"}))))):/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:"5",className:"p-8 text-center text-gray-500"},"No HA groups configured")))))),showAddHaResource&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",onClick:()=>setShowAddHaResource(false)},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-6 w-full max-w-lg",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-4"},"Add: Resource: Container/Virtual Machine"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"VM:"),/*#__PURE__*/React.createElement("select",{value:newHaResource.sid||'',onChange:e=>setNewHaResource({...newHaResource,sid:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"-- Select VM/CT --"),availableVmsForHa&&availableVmsForHa.map(vm=>/*#__PURE__*/React.createElement("option",{key:vm.vmid,value:(vm.type==='qemu'?'vm:':'ct:')+vm.vmid},vm.vmid," - ",vm.name||'unnamed'," (",vm.type==='qemu'?'VM':'CT',")")))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Max. Restart:"),/*#__PURE__*/React.createElement("input",{type:"number",min:"0",max:"10",value:newHaResource.max_restart||1,onChange:e=>setNewHaResource({...newHaResource,max_restart:parseInt(e.target.value)||0}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Max. Relocate:"),/*#__PURE__*/React.createElement("input",{type:"number",min:"0",max:"10",value:newHaResource.max_relocate||1,onChange:e=>setNewHaResource({...newHaResource,max_relocate:parseInt(e.target.value)||0}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"}))),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Group:"),/*#__PURE__*/React.createElement("select",{value:newHaResource.group||'',onChange:e=>setNewHaResource({...newHaResource,group:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"-- None --"),haGroups&&Array.isArray(haGroups)&&haGroups.map(g=>/*#__PURE__*/React.createElement("option",{key:g.group,value:g.group},g.group)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Request State:"),/*#__PURE__*/React.createElement("select",{value:newHaResource.state||'started',onChange:e=>setNewHaResource({...newHaResource,state:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:"started"},"started"),/*#__PURE__*/React.createElement("option",{value:"stopped"},"stopped"),/*#__PURE__*/React.createElement("option",{value:"ignored"},"ignored"),/*#__PURE__*/React.createElement("option",{value:"disabled"},"disabled")))),/*#__PURE__*/React.createElement("div",{className:"col-span-2"},/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Comment:"),/*#__PURE__*/React.createElement("input",{type:"text",value:newHaResource.comment||'',onChange:e=>setNewHaResource({...newHaResource,comment:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm",placeholder:"Optional comment"}))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-2 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddHaResource(false),className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-border rounded-lg text-sm"},"Cancel"),/*#__PURE__*/React.createElement("button",{onClick:async function(){var sidVal=(newHaResource.sid||'').trim();if(!sidVal){addToast('Please select a VM/CT','error');return;}try{var payload={sid:sidVal,state:newHaResource.state||'started',max_restart:newHaResource.max_restart||1,max_relocate:newHaResource.max_relocate||1};if(newHaResource.group)payload.group=newHaResource.group;if(newHaResource.comment)payload.comment=newHaResource.comment;var res=await authFetch(API_URL+'/clusters/'+clusterId+'/proxmox-ha/resources',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(res&&res.ok){addToast('Resource added to HA','success');setShowAddHaResource(false);setNewHaResource({sid:'',state:'started',group:'',max_restart:1,max_relocate:1,comment:''});fetchAllData();}else{var errData=await res.json().catch(function(){return{};});addToast(errData.error||'Failed to add resource','error');}}catch(e){addToast('Error: '+e.message,'error');}},className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm"},"Add")))),showAddHaGroup&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",onClick:()=>setShowAddHaGroup(false)},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-6 w-full max-w-md",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-4"},"Add HA Group"),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Group Name"),/*#__PURE__*/React.createElement("input",{value:newHaGroup.group||'',onChange:e=>setNewHaGroup({...newHaGroup,group:e.target.value}),placeholder:"e.g. production",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Nodes (with priority)"),/*#__PURE__*/React.createElement("input",{value:newHaGroup.nodes||'',onChange:e=>setNewHaGroup({...newHaGroup,nodes:e.target.value}),placeholder:"node1:1,node2:2,node3:1",className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm font-mono"}),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},"Lower priority = preferred")),/*#__PURE__*/React.createElement("div",{className:"flex gap-6"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newHaGroup.restricted===1,onChange:e=>setNewHaGroup({...newHaGroup,restricted:e.target.checked?1:0}),className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm"},"Restricted")),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newHaGroup.nofailback===1,onChange:e=>setNewHaGroup({...newHaGroup,nofailback:e.target.checked?1:0}),className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm"},"No Failback")))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-2 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddHaGroup(false),className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-border rounded-lg text-sm"},"Cancel"),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!newHaGroup.group||!newHaGroup.nodes){addToast('Enter group name and nodes','error');return;}try{var res=await authFetch(API_URL+'/clusters/'+clusterId+'/proxmox-ha/groups',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(newHaGroup)});if(res&&res.ok){addToast('Group created','success');setShowAddHaGroup(false);setNewHaGroup({group:'',nodes:'',restricted:0,nofailback:0});fetchAllData();}else{var err=await res.json().catch(function(){return{};});addToast(err.error||'Failed to create group','error');}}catch(e){addToast('Error: '+e.message,'error');}},className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm"},"Create"))))),activeSection==='firewall'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-4"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Shield,null),t('firewallOptions')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{const newState=!firewallOptions.enable;try{const res=await fetch(`${API_URL}/clusters/${clusterId}/datacenter/firewall/options`,{method:'PUT',headers:{...authHeaders,'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({enable:newState?1:0})});if(res.ok){setFirewallOptions(prev=>({...prev,enable:newState}));}}catch(e){console.error('updating firewall:',e);}},className:`px-4 py-2 rounded-lg font-medium transition-colors ${firewallOptions.enable?'bg-green-500/20 text-green-400 hover:bg-green-500/30':'bg-red-500/20 text-red-400 hover:bg-red-500/30'}`},firewallOptions.enable?t('enabled'):t('disabled'))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mb-1"},"Policy In"),/*#__PURE__*/React.createElement("select",{value:firewallOptions.policy_in||'DROP',onChange:async e=>{try{const res=await fetch(`${API_URL}/clusters/${clusterId}/datacenter/firewall/options`,{method:'PUT',headers:{...authHeaders,'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({policy_in:e.target.value})});if(res.ok)setFirewallOptions(prev=>({...prev,policy_in:e.target.value}));}catch(e){}},className:"w-full bg-proxmox-darker border border-proxmox-border rounded-lg p-2 text-white"},/*#__PURE__*/React.createElement("option",{value:"ACCEPT"},"ACCEPT"),/*#__PURE__*/React.createElement("option",{value:"DROP"},"DROP"),/*#__PURE__*/React.createElement("option",{value:"REJECT"},"REJECT"))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mb-1"},"Policy Out"),/*#__PURE__*/React.createElement("select",{value:firewallOptions.policy_out||'ACCEPT',onChange:async e=>{try{const res=await fetch(`${API_URL}/clusters/${clusterId}/datacenter/firewall/options`,{method:'PUT',headers:{...authHeaders,'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({policy_out:e.target.value})});if(res.ok)setFirewallOptions(prev=>({...prev,policy_out:e.target.value}));}catch(e){}},className:"w-full bg-proxmox-darker border border-proxmox-border rounded-lg p-2 text-white"},/*#__PURE__*/React.createElement("option",{value:"ACCEPT"},"ACCEPT"),/*#__PURE__*/React.createElement("option",{value:"DROP"},"DROP"),/*#__PURE__*/React.createElement("option",{value:"REJECT"},"REJECT"))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mb-1"},"Log Level"),/*#__PURE__*/React.createElement("select",{value:firewallOptions.log_level_in||'nolog',onChange:async e=>{try{const res=await fetch(`${API_URL}/clusters/${clusterId}/datacenter/firewall/options`,{method:'PUT',headers:{...authHeaders,'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({log_level_in:e.target.value})});if(res.ok)setFirewallOptions(prev=>({...prev,log_level_in:e.target.value}));}catch(e){}},className:"w-full bg-proxmox-darker border border-proxmox-border rounded-lg p-2 text-white"},/*#__PURE__*/React.createElement("option",{value:"nolog"},"No Log"),/*#__PURE__*/React.createElement("option",{value:"emerg"},"Emergency"),/*#__PURE__*/React.createElement("option",{value:"alert"},"Alert"),/*#__PURE__*/React.createElement("option",{value:"crit"},"Critical"),/*#__PURE__*/React.createElement("option",{value:"err"},"Error"),/*#__PURE__*/React.createElement("option",{value:"warning"},"Warning"),/*#__PURE__*/React.createElement("option",{value:"notice"},"Notice"),/*#__PURE__*/React.createElement("option",{value:"info"},"Info"),/*#__PURE__*/React.createElement("option",{value:"debug"},"Debug"))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},t('firewallRules')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddRuleModal(true),className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm text-white transition-colors"},/*#__PURE__*/React.createElement(Icons.Plus,null)," ",t('add'))),/*#__PURE__*/React.createElement("div",{className:"overflow-x-auto"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"#"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('type')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('action')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Macro"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('source')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Dest"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Proto"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Port"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('enabled')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('comment')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"}))),/*#__PURE__*/React.createElement("tbody",null,!firewallRules||firewallRules.length===0?/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:"11",className:"p-8 text-center text-gray-500"},t('noFirewallRules'))):(Array.isArray(firewallRules)?firewallRules:[]).map((rule,idx)=>/*#__PURE__*/React.createElement("tr",{key:idx,className:"border-t border-proxmox-border hover:bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},rule.pos),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs ${rule.type==='in'?'bg-blue-500/20 text-blue-400':'bg-purple-500/20 text-purple-400'}`},rule.type||'in')),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${rule.action==='ACCEPT'?'bg-green-500/20 text-green-400':rule.action==='DROP'?'bg-red-500/20 text-red-400':'bg-yellow-500/20 text-yellow-400'}`},rule.action)),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300"},rule.macro||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 font-mono text-xs text-gray-300"},rule.source||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 font-mono text-xs text-gray-300"},rule.dest||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300"},rule.proto||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 font-mono text-xs text-gray-300"},rule.dport||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{try{const res=await fetch(`${API_URL}/clusters/${clusterId}/datacenter/firewall/rules/${rule.pos}`,{method:'PUT',credentials:'include',headers:{...authHeaders,'Content-Type':'application/json'},body:JSON.stringify({enable:rule.enable?0:1})});if(res.ok){setFirewallRules(prev=>prev.map(r=>r.pos===rule.pos?{...r,enable:rule.enable?0:1}:r));}}catch(e){}},className:`w-8 h-5 rounded-full transition-colors ${rule.enable?'bg-green-500':'bg-gray-600'}`},/*#__PURE__*/React.createElement("div",{className:`w-4 h-4 rounded-full bg-white transition-transform ${rule.enable?'translate-x-3.5':'translate-x-0.5'}`}))),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-500 text-xs max-w-32 truncate"},rule.comment||''),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("button",{onClick:()=>deleteFirewallRule(rule.pos),className:"p-1.5 hover:bg-red-500/20 rounded text-red-400 transition-colors"},/*#__PURE__*/React.createElement(Icons.Trash,null))))))))),showAddRuleModal&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop",onClick:()=>setShowAddRuleModal(false)},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-lg bg-proxmox-card border border-proxmox-border rounded-2xl shadow-2xl overflow-hidden",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},"Add Firewall Rule")),/*#__PURE__*/React.createElement("div",{className:"p-4 space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"Direction"),/*#__PURE__*/React.createElement("select",{value:newRule.type||'in',onChange:e=>setNewRule(p=>({...p,type:e.target.value})),className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"},/*#__PURE__*/React.createElement("option",{value:"in"},"IN"),/*#__PURE__*/React.createElement("option",{value:"out"},"OUT"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"Action"),/*#__PURE__*/React.createElement("select",{value:newRule.action||'ACCEPT',onChange:e=>setNewRule(p=>({...p,action:e.target.value})),className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"},/*#__PURE__*/React.createElement("option",{value:"ACCEPT"},"ACCEPT"),/*#__PURE__*/React.createElement("option",{value:"DROP"},"DROP"),/*#__PURE__*/React.createElement("option",{value:"REJECT"},"REJECT")))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"Macro"),/*#__PURE__*/React.createElement("select",{value:newRule.macro||'',onChange:e=>setNewRule(p=>({...p,macro:e.target.value||undefined})),className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"},/*#__PURE__*/React.createElement("option",{value:""},"None"),['Amanda','Auth','BGP','BitTorrent','Ceph','CephMon','CephOSD','CephMGR','CephMDS','DHCPfwd','DHCPv6','DNS','Dropbox','FTP','GNUnet','GRE','HKP','HTTP','HTTPS','ICMP','ICMPv6','IMAP','IMAPS','IPsec-ah','IPsec-esp','IRC','Jabber','JetDirect','L2TP','LDAP','LDAPS','MDNS','MSSQL','MySQL','NFS','NTP','OSPF','OpenVPN','PCA','PMG','POP3','POP3S','PPtP','Ping','PostgreSQL','Printer','RDP','RIP','RNDC','Razor','Rsh','SANE','SMB','SMBv2','SMTP','SMTPS','SNMP','SPAMD','SSH','SVN','SixXS','Squid','Submission','Syslog','TFTP','Telnet','Tinc','Traceroute','VNC','VXLAN','Webmin'].map(name=>/*#__PURE__*/React.createElement("option",{key:name,value:name},name)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"Interface"),/*#__PURE__*/React.createElement("input",{type:"text",value:newRule.iface||'',onChange:e=>setNewRule(p=>({...p,iface:e.target.value})),placeholder:"e.g. vmbr0",className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"Protocol"),/*#__PURE__*/React.createElement("select",{value:newRule.proto||'',onChange:e=>setNewRule(p=>({...p,proto:e.target.value})),className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"},/*#__PURE__*/React.createElement("option",{value:""},"Any"),/*#__PURE__*/React.createElement("option",{value:"tcp"},"TCP"),/*#__PURE__*/React.createElement("option",{value:"udp"},"UDP"),/*#__PURE__*/React.createElement("option",{value:"icmp"},"ICMP"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"Dest. Port"),/*#__PURE__*/React.createElement("input",{type:"text",value:newRule.dport||'',onChange:e=>setNewRule(p=>({...p,dport:e.target.value})),placeholder:"e.g. 22, 80, 443",className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"Source"),/*#__PURE__*/React.createElement("input",{type:"text",value:newRule.source||'',onChange:e=>setNewRule(p=>({...p,source:e.target.value})),placeholder:"e.g. 10.0.0.0/24",className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"Destination"),/*#__PURE__*/React.createElement("input",{type:"text",value:newRule.dest||'',onChange:e=>setNewRule(p=>({...p,dest:e.target.value})),placeholder:"e.g. 192.168.1.0/24",className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"}))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"Comment"),/*#__PURE__*/React.createElement("input",{type:"text",value:newRule.comment||'',onChange:e=>setNewRule(p=>({...p,comment:e.target.value})),placeholder:"Optional description",className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"})),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newRule.enable!==0,onChange:e=>setNewRule(p=>({...p,enable:e.target.checked?1:0})),className:"w-4 h-4 rounded"}),/*#__PURE__*/React.createElement("span",null,"Enable rule"))),/*#__PURE__*/React.createElement("div",{className:"p-4 border-t border-proxmox-border flex gap-3 justify-end"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddRuleModal(false),className:"px-4 py-2 bg-proxmox-dark rounded-lg hover:bg-proxmox-hover transition-colors"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{try{const res=await fetch(`${API_URL}/clusters/${clusterId}/datacenter/firewall/rules`,{method:'POST',credentials:'include',headers:{...authHeaders,'Content-Type':'application/json'},body:JSON.stringify(newRule)});if(res.ok){// Refresh rules
const rulesRes=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/firewall/rules`);if(rulesRes.ok)setFirewallRules(await rulesRes.json());setShowAddRuleModal(false);setNewRule({type:'in',action:'ACCEPT',enable:1});}}catch(e){}},className:"px-4 py-2 bg-proxmox-orange rounded-lg text-white hover:bg-orange-600 transition-colors"},t('add')))))),activeSection==='ceph'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},cephLoading?/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center py-12"},/*#__PURE__*/React.createElement("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-proxmox-orange"})):!cephData||!cephData.available?/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-8 text-center"},/*#__PURE__*/React.createElement(Icons.Database,{className:"w-12 h-12 mx-auto text-gray-600 mb-4"}),/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-2"},t('cephNotInstalled')||'Ceph Not Installed'),/*#__PURE__*/React.createElement("p",{className:"text-gray-400 mb-4"},t('cephNotInstalledDesc')||'No Ceph cluster has been configured on this Proxmox cluster.'),/*#__PURE__*/React.createElement("p",{className:"text-gray-500 text-sm"},t('cephInstallHint')||'To set up Ceph, open a node and use the Ceph tab to initialize.')):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"flex gap-1 border-b border-proxmox-border pb-2"},['status','osds','monitors','pools','fs'].map(st=>/*#__PURE__*/React.createElement("button",{key:st,onClick:()=>setCephSubTab(st),className:`px-4 py-2 rounded-lg text-sm transition-colors ${cephSubTab===st?'bg-proxmox-orange text-white':'text-gray-400 hover:text-white hover:bg-proxmox-dark'}`},st==='status'?t('cephStatus')||'Status':st==='osds'?'OSDs':st==='monitors'?t('cephMons')||'Monitors':st==='pools'?t('cephPools')||'Pools':'CephFS'))),cephSubTab==='status'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Activity,null),t('cephHealth')||'Cluster Health'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mb-1"},t('status')),/*#__PURE__*/React.createElement("div",{className:`text-xl font-bold ${cephData.status?.health?.status==='HEALTH_OK'?'text-green-400':cephData.status?.health?.status==='HEALTH_WARN'?'text-yellow-400':'text-red-400'}`},cephData.status?.health?.status||'Unknown'),cephData.status?.health?.checks&&Object.entries(cephData.status.health.checks).map(([k,v])=>/*#__PURE__*/React.createElement("div",{key:k,className:"mt-2 text-xs text-gray-400"},/*#__PURE__*/React.createElement("span",{className:v.severity==='HEALTH_WARN'?'text-yellow-400':'text-red-400'},k),": ",v.summary?.message||''))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mb-1"},"PG Status"),/*#__PURE__*/React.createElement("div",{className:"space-y-1 text-sm"},cephData.status?.pgmap?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",null,cephData.status.pgmap.num_pgs||0," PGs"),cephData.status.pgmap.pgs_by_state?.map((s,i)=>/*#__PURE__*/React.createElement("div",{key:i,className:"text-xs text-gray-400"},s.count," ",s.state_name))):/*#__PURE__*/React.createElement("div",{className:"text-gray-500"},"-"))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mb-1"},t('cephCapacity')||'Capacity'),(()=>{const total=cephData.status?.pgmap?.bytes_total||0;const used=cephData.status?.pgmap?.bytes_used||0;const pct=total>0?(used/total*100).toFixed(1):0;const fmt=b=>{if(!b)return'0 B';const k=1024,s=['B','KB','MB','GB','TB','PB'],i=Math.floor(Math.log(b)/Math.log(k));return(b/Math.pow(k,i)).toFixed(1)+' '+s[i];};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"text-lg font-bold"},pct,"%"),/*#__PURE__*/React.createElement("div",{className:"w-full bg-gray-700 rounded-full h-2 mt-2"},/*#__PURE__*/React.createElement("div",{className:`h-2 rounded-full ${pct>80?'bg-red-500':pct>60?'bg-yellow-500':'bg-green-500'}`,style:{width:`${Math.min(pct,100)}%`}})),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-400 mt-1"},fmt(used)," / ",fmt(total)));})()))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4"},[{label:'OSDs',value:cephData.osd?.length||0,color:'blue'},{label:'Monitors',value:cephData.mon?.length||0,color:'purple'},{label:'Pools',value:cephData.pools?.length||0,color:'green'},{label:'MDS',value:cephData.mds?.data?.length||0,color:'yellow'},{label:'MGR',value:cephData.mgr?1:0,color:'cyan'}].map(item=>/*#__PURE__*/React.createElement("div",{key:item.label,className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4 text-center"},/*#__PURE__*/React.createElement("div",{className:`text-2xl font-bold text-${item.color}-400`},item.value),/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400"},item.label))))),cephSubTab==='osds'&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},"OSDs (",(cephData.osd||[]).length,")"),/*#__PURE__*/React.createElement("button",{onClick:fetchCephData,className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-dark hover:bg-proxmox-hover rounded-lg text-sm transition-colors"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-4 h-4"})," ",t('refresh')||'Refresh')),/*#__PURE__*/React.createElement("div",{className:"overflow-x-auto"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"ID"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('name')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('host')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('status')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"In/Out"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Class"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('actions')))),/*#__PURE__*/React.createElement("tbody",null,!cephData.osd||cephData.osd.length===0?/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:"7",className:"p-8 text-center text-gray-500"},"No OSDs found")):cephData.osd.map(osd=>/*#__PURE__*/React.createElement("tr",{key:osd.id,className:"border-t border-proxmox-border hover:bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("td",{className:"p-3"},osd.id),/*#__PURE__*/React.createElement("td",{className:"p-3 font-medium"},osd.name||`osd.${osd.id}`),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300"},osd.host||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs ${osd.status==='up'?'bg-green-500/20 text-green-400':'bg-red-500/20 text-red-400'}`},osd.status||'unknown')),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs ${osd.in?'bg-blue-500/20 text-blue-400':'bg-yellow-500/20 text-yellow-400'}`},osd.in?'In':'Out')),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300"},osd.device_class||osd.class||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("div",{className:"flex gap-1"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{const action=osd.in?'out':'in';const host=osd.host||cephNode;if(!confirm(`Mark OSD ${osd.id} as ${action.toUpperCase()}?`))return;try{await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${host}/ceph/osd/${osd.id}/${action}`,{method:'POST'});fetchCephData();}catch(e){}},className:"px-2 py-1 text-xs bg-proxmox-dark hover:bg-proxmox-hover rounded transition-colors",title:osd.in?'Mark Out':'Mark In'},osd.in?'Out':'In'),/*#__PURE__*/React.createElement("button",{onClick:async()=>{const host=osd.host||cephNode;try{await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${host}/ceph/osd/${osd.id}/scrub`,{method:'POST'});addToast('Scrub started','success');}catch(e){}},className:"px-2 py-1 text-xs bg-proxmox-dark hover:bg-proxmox-hover rounded transition-colors",title:"Scrub"},"Scrub"))))))))),cephSubTab==='monitors'&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},t('cephMons')||'Monitors'," (",(cephData.mon||[]).length,")"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowCreateMon(true),className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm text-white transition-colors"},/*#__PURE__*/React.createElement(Icons.Plus,null)," ",t('add')),/*#__PURE__*/React.createElement("button",{onClick:fetchCephData,className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-dark hover:bg-proxmox-hover rounded-lg text-sm transition-colors"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-4 h-4"})))),/*#__PURE__*/React.createElement("div",{className:"overflow-x-auto"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('name')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('host')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('status')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Address"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('actions')))),/*#__PURE__*/React.createElement("tbody",null,!cephData.mon||cephData.mon.length===0?/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:"5",className:"p-8 text-center text-gray-500"},"No monitors found")):cephData.mon.map((mon,idx)=>/*#__PURE__*/React.createElement("tr",{key:idx,className:"border-t border-proxmox-border hover:bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("td",{className:"p-3 font-medium"},mon.name),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300"},mon.host||mon.name),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs ${mon.quorum!==false?'bg-green-500/20 text-green-400':'bg-red-500/20 text-red-400'}`},mon.quorum!==false?'In Quorum':'Not in Quorum')),/*#__PURE__*/React.createElement("td",{className:"p-3 font-mono text-xs text-gray-300"},mon.addr||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!confirm(`Delete monitor "${mon.name}"?`))return;const host=mon.host||mon.name;try{await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${host}/ceph/mon/${mon.name}`,{method:'DELETE'});fetchCephData();}catch(e){}},className:"p-1.5 hover:bg-red-500/20 rounded text-red-400 transition-colors"},/*#__PURE__*/React.createElement(Icons.Trash,null))))))))),cephSubTab==='pools'&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},t('cephPools')||'Pools'," (",(cephData.pools||[]).length,")"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowCreatePool(true),className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm text-white transition-colors"},/*#__PURE__*/React.createElement(Icons.Plus,null)," ",t('cephCreatePool')||'Create Pool'),/*#__PURE__*/React.createElement("button",{onClick:fetchCephData,className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-dark hover:bg-proxmox-hover rounded-lg text-sm transition-colors"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-4 h-4"})))),/*#__PURE__*/React.createElement("div",{className:"overflow-x-auto"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('name')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Size"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Min Size"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"PGs"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"CRUSH Rule"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('actions')))),/*#__PURE__*/React.createElement("tbody",null,!cephData.pools||cephData.pools.length===0?/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:"6",className:"p-8 text-center text-gray-500"},"No pools")):cephData.pools.map((pool,idx)=>/*#__PURE__*/React.createElement("tr",{key:idx,className:"border-t border-proxmox-border hover:bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("td",{className:"p-3 font-medium"},pool.pool_name||pool.name),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300"},pool.size||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300"},pool.min_size||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300"},pool.pg_num||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300"},pool.crush_rule||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{const name=pool.pool_name||pool.name;if(!confirm(`Delete pool "${name}"? This cannot be undone!`))return;try{await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${cephNode}/ceph/pool/${name}`,{method:'DELETE'});fetchCephData();}catch(e){}},className:"p-1.5 hover:bg-red-500/20 rounded text-red-400 transition-colors"},/*#__PURE__*/React.createElement(Icons.Trash,null))))))))),cephSubTab==='fs'&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},"CephFS (",(cephData.fs||[]).length,")"),/*#__PURE__*/React.createElement("button",{onClick:fetchCephData,className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-dark hover:bg-proxmox-hover rounded-lg text-sm transition-colors"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-4 h-4"})," ",t('refresh')||'Refresh')),!cephData.fs||cephData.fs.length===0?/*#__PURE__*/React.createElement("div",{className:"p-8 text-center text-gray-500"},"No CephFS filesystems configured"):/*#__PURE__*/React.createElement("div",{className:"divide-y divide-proxmox-border"},cephData.fs.map((fs,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"p-4"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"font-medium"},fs.name),/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mt-1"},"Metadata Pool: ",fs.metadata_pool||'-'," | Data Pools: ",(fs.data_pools||[]).join(', ')||'-')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!confirm(`Delete CephFS "${fs.name}"? This will destroy all data!`))return;try{await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${cephNode}/ceph/fs/${fs.name}`,{method:'DELETE'});fetchCephData();}catch(e){}},className:"p-1.5 hover:bg-red-500/20 rounded text-red-400 transition-colors"},/*#__PURE__*/React.createElement(Icons.Trash,null)))))),cephData.mds&&/*#__PURE__*/React.createElement("div",{className:"border-t border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-sm"},t('cephMds')||'Metadata Servers')),/*#__PURE__*/React.createElement("div",{className:"divide-y divide-proxmox-border"},(cephData.mds?.data||[]).map((mds,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"p-4 flex justify-between items-center"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"font-medium"},mds.name),/*#__PURE__*/React.createElement("span",{className:"text-gray-400 ml-2"},"on ",mds.host||'-')),/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs ${mds.state==='up:active'?'bg-green-500/20 text-green-400':mds.state?.includes('up')?'bg-yellow-500/20 text-yellow-400':'bg-gray-600/20 text-gray-400'}`},mds.state||mds.status||'unknown'))),(!cephData.mds?.data||cephData.mds.data.length===0)&&/*#__PURE__*/React.createElement("div",{className:"p-4 text-center text-gray-500 text-sm"},"No MDS daemons")))),showCreatePool&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop",onClick:()=>setShowCreatePool(false)},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-md bg-proxmox-card border border-proxmox-border rounded-2xl shadow-2xl overflow-hidden",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},t('cephCreatePool')||'Create Pool')),/*#__PURE__*/React.createElement("div",{className:"p-4 space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},t('name')),/*#__PURE__*/React.createElement("input",{type:"text",value:newPool.name,onChange:e=>setNewPool(p=>({...p,name:e.target.value})),placeholder:"e.g. mypool",className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"})),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"Size"),/*#__PURE__*/React.createElement("input",{type:"number",min:"1",max:"7",value:newPool.size,onChange:e=>setNewPool(p=>({...p,size:parseInt(e.target.value)})),className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"Min Size"),/*#__PURE__*/React.createElement("input",{type:"number",min:"1",max:"7",value:newPool.min_size,onChange:e=>setNewPool(p=>({...p,min_size:parseInt(e.target.value)})),className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"PGs"),/*#__PURE__*/React.createElement("select",{value:newPool.pg_num,onChange:e=>setNewPool(p=>({...p,pg_num:parseInt(e.target.value)})),className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"},[8,16,32,64,128,256,512,1024].map(n=>/*#__PURE__*/React.createElement("option",{key:n,value:n},n))))),cephNode&&/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"Creating on node: ",cephNode)),/*#__PURE__*/React.createElement("div",{className:"p-4 border-t border-proxmox-border flex gap-3 justify-end"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowCreatePool(false),className:"px-4 py-2 bg-proxmox-dark rounded-lg hover:bg-proxmox-hover transition-colors"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!newPool.name||!cephNode)return;try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${cephNode}/ceph/pool`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(newPool)});if(res?.ok){setShowCreatePool(false);setNewPool({name:'',size:3,min_size:2,pg_num:128});fetchCephData();}}catch(e){}},className:"px-4 py-2 bg-proxmox-orange rounded-lg text-white hover:bg-orange-600 transition-colors"},t('create')||'Create')))),showCreateMon&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop",onClick:()=>setShowCreateMon(false)},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-md bg-proxmox-card border border-proxmox-border rounded-2xl shadow-2xl overflow-hidden",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},t('cephCreateMon')||'Create Monitor')),/*#__PURE__*/React.createElement("div",{className:"p-4 space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},t('node')),/*#__PURE__*/React.createElement("select",{value:cephNode,onChange:e=>setCephNode(e.target.value),className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"},(clusterNodes||[]).filter(n=>n.online!==0).map(n=>/*#__PURE__*/React.createElement("option",{key:n.name,value:n.name},n.name))))),/*#__PURE__*/React.createElement("div",{className:"p-4 border-t border-proxmox-border flex gap-3 justify-end"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowCreateMon(false),className:"px-4 py-2 bg-proxmox-dark rounded-lg hover:bg-proxmox-hover transition-colors"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!cephNode)return;try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${cephNode}/ceph/mon/${cephNode}`,{method:'POST'});if(res?.ok){setShowCreateMon(false);fetchCephData();}}catch(e){}},className:"px-4 py-2 bg-proxmox-orange rounded-lg text-white hover:bg-orange-600 transition-colors"},t('create')||'Create'))))))),showNodeJoinWizard&&/*#__PURE__*/React.createElement(NodeJoinWizard,{isOpen:showNodeJoinWizard,onClose:()=>setShowNodeJoinWizard(false),clusterId:clusterId,onSuccess:()=>{fetchAllData();},addToast:addToast}),showRemoveNodeModal&&nodeToRemove&&/*#__PURE__*/React.createElement(RemoveNodeConfirmModal,{isOpen:showRemoveNodeModal,onClose:()=>{setShowRemoveNodeModal(false);setNodeToRemove(null);},node:nodeToRemove,clusterId:clusterId,onSuccess:()=>{fetchAllData();},addToast:addToast}));}// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PegaProx - Security & Compliance
// SecuritySettings, Compliance, IPWhitelist, Backup, UpdateManager
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Security Settings Section Component (for PegaProx Settings)
// LW: The locked IPs table was AI-generated (Claude), I just styled it - Oct 2025
function SecuritySettingsSection({addToast}){const{t}=useTranslation();const{getAuthHeaders,isAdmin}=useAuth();const[settings,setSettings]=useState({login_max_attempts:5,login_lockout_time:300,login_attempt_window:600,password_min_length:8,password_require_uppercase:true,password_require_lowercase:true,password_require_numbers:true,password_require_special:false,session_timeout:86400,// MK: frontend says 86400 but backend default is 28800 (the server wins)
// LW: Password expiry - Dec 2025
password_expiry_enabled:false,password_expiry_days:90,password_expiry_warning_days:14,password_expiry_email_enabled:true,password_expiry_include_admins:false,// NS: opt-in for admins
// NS: Feb 2026 - Force 2FA
force_2fa:false,force_2fa_exclude_admins:false});const[lockedIps,setLockedIps]=useState([]);const[lockedUsers,setLockedUsers]=useState([]);// NS: Username lockout support
const[loading,setLoading]=useState(true);const[resetAllLoading,setResetAllLoading]=useState(false);const[showResetConfirm,setShowResetConfirm]=useState(false);const[includeAdmins,setIncludeAdmins]=useState(false);useEffect(()=>{fetchSettings();fetchLockedIps();},[]);const fetchSettings=async()=>{try{const res=await fetch(`${API_URL}/settings/server`,{credentials:'include',headers:getAuthHeaders()});if(res.ok){const data=await res.json();setSettings(prev=>({...prev,login_max_attempts:data.login_max_attempts||5,login_lockout_time:data.login_lockout_time||300,login_attempt_window:data.login_attempt_window||600,password_min_length:data.password_min_length||8,password_require_uppercase:data.password_require_uppercase!==false,password_require_lowercase:data.password_require_lowercase!==false,password_require_numbers:data.password_require_numbers!==false,password_require_special:data.password_require_special||false,session_timeout:data.session_timeout||86400,// LW: Password expiry
password_expiry_enabled:data.password_expiry_enabled||false,password_expiry_days:data.password_expiry_days||90,password_expiry_warning_days:data.password_expiry_warning_days||14,password_expiry_email_enabled:data.password_expiry_email_enabled!==false,password_expiry_include_admins:data.password_expiry_include_admins||false,force_2fa:data.force_2fa||false,force_2fa_exclude_admins:data.force_2fa_exclude_admins||false}));}}catch(e){console.error('to fetch security settings:',e);}finally{setLoading(false);}};const fetchLockedIps=async()=>{try{const res=await fetch(`${API_URL}/security/locked-ips`,{credentials:'include',headers:getAuthHeaders()});if(res.ok){const data=await res.json();setLockedIps(data.locked_ips||[]);setLockedUsers(data.locked_users||[]);// NS: Also get locked users
}}catch(e){console.error('to fetch locked IPs:',e);}};// LW: Reset all user passwords - for security incidents
// NS: This was scary to implement lol, triple-confirmed it works right
const resetAllPasswords=async()=>{setResetAllLoading(true);try{const res=await fetch(`${API_URL}/security/password-expiry/reset-all`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({include_admins:includeAdmins})});if(res.ok){const data=await res.json();addToast(data.message||`${data.reset_count} users will need to change their password`,'success');setShowResetConfirm(false);setIncludeAdmins(false);// reset checkbox
}else{const err=await res.json();addToast(err.error||'Failed to reset passwords','error');}}catch(e){console.error('reset all passwords failed:',e);addToast('Connection error','error');}finally{setResetAllLoading(false);}};const saveSettings=async newSettings=>{try{const res=await fetch(`${API_URL}/settings/server`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify(newSettings)});if(res.ok){setSettings(newSettings);addToast(t('settingsSaved'),'success');}}catch(e){addToast(t('failedToSaveSettings'),'error');}};const unlockIp=async ip=>{try{const res=await fetch(`${API_URL}/security/locked-ips/${encodeURIComponent(ip)}`,{method:'DELETE',credentials:'include',headers:getAuthHeaders()});if(res.ok){setLockedIps(prev=>prev.filter(l=>l.ip!==ip));addToast(`IP ${ip} ${t('unlocked')}`,'success');}}catch(e){addToast(t('failedToUnlockIp'),'error');}};// NS: Unlock a specific username
const unlockUser=async username=>{try{const res=await fetch(`${API_URL}/security/locked-users/${encodeURIComponent(username)}`,{method:'DELETE',credentials:'include',headers:getAuthHeaders()});if(res.ok){setLockedUsers(prev=>prev.filter(l=>l.username!==username));addToast(`${t('user')} ${username} ${t('unlocked')}`,'success');}}catch(e){addToast(t('failedToUnlockUser')||'Failed to unlock user','error');}};const unlockAll=async()=>{if(!confirm(t('unlockAllConfirm')))return;try{const res=await fetch(`${API_URL}/security/locked-ips`,{method:'DELETE',credentials:'include',headers:getAuthHeaders()});if(res.ok){setLockedIps([]);addToast(t('allIpsUnlocked'),'success');}}catch(e){addToast(t('failedToUnlockAllIps'),'error');}};// NS: Unlock all usernames
const unlockAllUsers=async()=>{if(!confirm(t('unlockAllUsersConfirm')||'Unlock all users?'))return;try{const res=await fetch(`${API_URL}/security/locked-users`,{method:'DELETE',credentials:'include',headers:getAuthHeaders()});if(res.ok){setLockedUsers([]);addToast(t('allUsersUnlocked')||'All users unlocked','success');}}catch(e){addToast(t('failedToUnlockAllUsers')||'Failed to unlock all users','error');}};if(!isAdmin)return null;return/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-2 bg-red-500/10 rounded-lg"},/*#__PURE__*/React.createElement(Icons.Shield,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white"},t('bruteForceProtection')),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},t('bruteForceProtectionDesc')||'Configure login attempt limits and lockout settings'))),(lockedIps.length>0||lockedUsers.length>0)&&/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},lockedIps.length>0&&/*#__PURE__*/React.createElement("span",{className:"px-3 py-1.5 bg-red-500/20 text-red-400 rounded-full text-sm font-medium"},lockedIps.length," IP",lockedIps.length!==1?'s':''),lockedUsers.length>0&&/*#__PURE__*/React.createElement("span",{className:"px-3 py-1.5 bg-orange-500/20 text-orange-400 rounded-full text-sm font-medium"},lockedUsers.length," ",t('user'),lockedUsers.length!==1?'s':''))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white mb-4"},t('loginProtection')||'Login Protection'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('maxLoginAttempts')),/*#__PURE__*/React.createElement("input",{type:"number",value:settings.login_max_attempts,onChange:e=>setSettings(prev=>({...prev,login_max_attempts:parseInt(e.target.value)||5})),onBlur:()=>saveSettings(settings),min:1,max:20,className:"w-full bg-proxmox-darker border border-proxmox-border rounded-lg p-2 text-white"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('maxLoginAttemptsDesc'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('lockoutTime')),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"number",value:settings.login_lockout_time,onChange:e=>setSettings(prev=>({...prev,login_lockout_time:parseInt(e.target.value)||300})),onBlur:()=>saveSettings(settings),min:60,max:3600,step:60,className:"flex-1 bg-proxmox-darker border border-proxmox-border rounded-lg p-2 text-white"}),/*#__PURE__*/React.createElement("span",{className:"flex items-center text-gray-500 text-sm"},"sec")),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},Math.round(settings.login_lockout_time/60)," ",t('minutes'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('attemptWindow')),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"number",value:settings.login_attempt_window,onChange:e=>setSettings(prev=>({...prev,login_attempt_window:parseInt(e.target.value)||600})),onBlur:()=>saveSettings(settings),min:60,max:3600,step:60,className:"flex-1 bg-proxmox-darker border border-proxmox-border rounded-lg p-2 text-white"}),/*#__PURE__*/React.createElement("span",{className:"flex items-center text-gray-500 text-sm"},"sec")),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},Math.round(settings.login_attempt_window/60)," ",t('minutes'))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Key,null),t('passwordPolicy')||'Password Policy'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('minPasswordLength')||'Minimum Length'),/*#__PURE__*/React.createElement("input",{type:"number",value:settings.password_min_length||8,onChange:e=>setSettings(prev=>({...prev,password_min_length:parseInt(e.target.value)||8})),onBlur:()=>saveSettings(settings),min:4,max:32,className:"w-full bg-proxmox-darker border border-proxmox-border rounded-lg p-2 text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('sessionTimeout')||'Session Timeout'),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"number",value:Math.round((settings.session_timeout||86400)/3600),onChange:e=>setSettings(prev=>({...prev,session_timeout:(parseInt(e.target.value)||24)*3600})),onBlur:()=>saveSettings(settings),min:1,max:168,className:"flex-1 bg-proxmox-darker border border-proxmox-border rounded-lg p-2 text-white"}),/*#__PURE__*/React.createElement("span",{className:"flex items-center text-gray-500 text-sm"},t('hours')||'hours')))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:settings.password_require_uppercase!==false,onChange:e=>{const newSettings={...settings,password_require_uppercase:e.target.checked};setSettings(newSettings);saveSettings(newSettings);},className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},t('requireUppercase')||'Uppercase')),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:settings.password_require_lowercase!==false,onChange:e=>{const newSettings={...settings,password_require_lowercase:e.target.checked};setSettings(newSettings);saveSettings(newSettings);},className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},t('requireLowercase')||'Lowercase')),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:settings.password_require_numbers!==false,onChange:e=>{const newSettings={...settings,password_require_numbers:e.target.checked};setSettings(newSettings);saveSettings(newSettings);},className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},t('requireNumbers')||'Numbers')),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:settings.password_require_special||false,onChange:e=>{const newSettings={...settings,password_require_special:e.target.checked};setSettings(newSettings);saveSettings(newSettings);},className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},t('requireSpecial')||'Special chars')))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-4"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Clock,null),t('passwordExpiry')||'Password Expiry'),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:settings.password_expiry_enabled||false,onChange:e=>{const newSettings={...settings,password_expiry_enabled:e.target.checked};setSettings(newSettings);saveSettings(newSettings);},className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},t('enabled')))),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mb-4"},t('passwordExpiryDesc')||'Force users to change their password after a specified number of days.'),settings.password_expiry_enabled&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('expiryDays')||'Password expires after'),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"number",value:settings.password_expiry_days||90,onChange:e=>setSettings(prev=>({...prev,password_expiry_days:parseInt(e.target.value)||90})),onBlur:()=>saveSettings(settings),min:7,max:365,className:"flex-1 bg-proxmox-darker border border-proxmox-border rounded-lg p-2 text-white"}),/*#__PURE__*/React.createElement("span",{className:"flex items-center text-gray-500 text-sm"},t('days')||'days'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('warningDays')||'Warn users before'),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"number",value:settings.password_expiry_warning_days||14,onChange:e=>setSettings(prev=>({...prev,password_expiry_warning_days:parseInt(e.target.value)||14})),onBlur:()=>saveSettings(settings),min:1,max:30,className:"flex-1 bg-proxmox-darker border border-proxmox-border rounded-lg p-2 text-white"}),/*#__PURE__*/React.createElement("span",{className:"flex items-center text-gray-500 text-sm"},t('days')||'days')))),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:settings.password_expiry_email_enabled!==false,onChange:e=>{const newSettings={...settings,password_expiry_email_enabled:e.target.checked};setSettings(newSettings);saveSettings(newSettings);},className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},t('sendExpiryEmails')||'Send email notifications when password is about to expire')),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:settings.password_expiry_include_admins||false,onChange:e=>{const newSettings={...settings,password_expiry_include_admins:e.target.checked};setSettings(newSettings);saveSettings(newSettings);},className:"rounded"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-sm text-yellow-400 font-medium"},t('includeAdminsInExpiry')||'Include admin accounts'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},t('includeAdminsInExpiryDesc')||'Admins will also need to change their passwords regularly'))),/*#__PURE__*/React.createElement("div",{className:"p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg"},/*#__PURE__*/React.createElement("p",{className:"text-sm text-blue-400"},"\uD83D\uDCA1 ",t('passwordExpiryHint')||'Users receive email reminders at 14, 7, 3, and 1 day(s) before expiry. A warning banner is shown in the UI. SMTP must be configured for emails.')),/*#__PURE__*/React.createElement("div",{className:"pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h5",{className:"text-sm font-medium text-white"},t('forcePasswordReset')||'Force Password Reset'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('forcePasswordResetDesc')||'Expire all user passwords immediately. Use after security incidents.')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowResetConfirm(true),className:"px-4 py-2 bg-red-500/20 text-red-400 hover:bg-red-500/30 rounded-lg text-sm font-medium transition-colors"},t('resetAllPasswords')||'Reset All'))))),showResetConfirm&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-6 max-w-md w-full mx-4 shadow-2xl"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3 mb-4"},/*#__PURE__*/React.createElement("div",{className:"p-2 bg-red-500/20 rounded-lg"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-6 h-6 text-red-400"})),/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white"},t('confirmPasswordReset')||'Confirm Password Reset')),/*#__PURE__*/React.createElement("p",{className:"text-gray-400 mb-4"},t('resetAllWarning')||'This will force ALL users to change their passwords on next login. This action cannot be undone.'),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer mb-6 p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:includeAdmins,onChange:e=>setIncludeAdmins(e.target.checked),className:"rounded"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-sm text-yellow-400 font-medium"},t('includeAdmins')||'Include admin accounts'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},t('includeAdminsWarning')||'Warning: You will also need to change your password!'))),/*#__PURE__*/React.createElement("div",{className:"flex gap-3"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowResetConfirm(false);setIncludeAdmins(false);},className:"flex-1 px-4 py-2 bg-proxmox-hover hover:bg-proxmox-border rounded-lg text-white transition-colors",disabled:resetAllLoading},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:resetAllPasswords,disabled:resetAllLoading,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 rounded-lg text-white font-medium transition-colors disabled:opacity-50 flex items-center justify-center gap-2"},resetAllLoading?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-4 h-4 animate-spin"}),t('processing')||'Processing...'):t('resetAllPasswords')||'Reset All Passwords')))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-4"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Shield,null),t('force2FA')||'Enforce 2FA'),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:settings.force_2fa||false,onChange:e=>{const newSettings={...settings,force_2fa:e.target.checked};setSettings(newSettings);saveSettings(newSettings);},className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},t('enabled')))),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mb-4"},t('force2FADesc')||'Require all users to set up Two-Factor Authentication before they can use PegaProx.'),settings.force_2fa&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:settings.force_2fa_exclude_admins||false,onChange:e=>{const newSettings={...settings,force_2fa_exclude_admins:e.target.checked};setSettings(newSettings);saveSettings(newSettings);},className:"rounded"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-sm text-yellow-400 font-medium"},t('force2FAExcludeAdmins')||'Exclude admin accounts'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},t('force2FAExcludeAdminsDesc')||'Admins can use PegaProx without 2FA'))),/*#__PURE__*/React.createElement("div",{className:"p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg"},/*#__PURE__*/React.createElement("p",{className:"text-sm text-blue-400"},"\uD83D\uDCA1 ",t('force2FAHint')||'OIDC/Entra users are exempt (they use their Identity Provider\'s MFA). Users without 2FA will see a setup dialog on login.')))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-4"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Shield,null),t('lockedIps')),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:fetchLockedIps,className:"p-2 hover:bg-proxmox-hover rounded-lg text-gray-400 hover:text-white transition-colors",title:"Refresh"},/*#__PURE__*/React.createElement(Icons.RefreshCw,null)),lockedIps.length>0&&/*#__PURE__*/React.createElement("button",{onClick:unlockAll,className:"px-3 py-1.5 bg-red-500/20 text-red-400 hover:bg-red-500/30 rounded-lg text-sm transition-colors"},t('unlockAll')))),lockedIps.length===0?/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},/*#__PURE__*/React.createElement(Icons.CheckCircle,{className:"w-12 h-12 mx-auto mb-3 text-green-500/50"}),/*#__PURE__*/React.createElement("p",null,t('noLockedIps')),/*#__PURE__*/React.createElement("p",{className:"text-xs mt-1"},t('allClear')||'All systems operational')):/*#__PURE__*/React.createElement("div",{className:"space-y-2"},lockedIps.map(item=>/*#__PURE__*/React.createElement("div",{key:item.ip,className:"flex items-center justify-between p-3 bg-proxmox-darker rounded-lg border border-red-500/20"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"font-mono text-white"},item.ip),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},item.attempt_count," ",t('attempts')," \u2022 ",item.remaining_seconds,"s ",t('remaining')))),/*#__PURE__*/React.createElement("button",{onClick:()=>unlockIp(item.ip),className:"px-4 py-2 bg-green-500/20 text-green-400 hover:bg-green-500/30 rounded-lg text-sm font-medium transition-colors"},t('unlock')))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-4"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.User,null),t('lockedUsers')||'Locked Users'),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:fetchLockedIps,className:"p-2 hover:bg-proxmox-hover rounded-lg text-gray-400 hover:text-white transition-colors",title:"Refresh"},/*#__PURE__*/React.createElement(Icons.RefreshCw,null)),lockedUsers.length>0&&/*#__PURE__*/React.createElement("button",{onClick:unlockAllUsers,className:"px-3 py-1.5 bg-orange-500/20 text-orange-400 hover:bg-orange-500/30 rounded-lg text-sm transition-colors"},t('unlockAll')))),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mb-3"},t('lockedUsersDesc')||'Accounts locked due to too many failed login attempts from any IP address.'),lockedUsers.length===0?/*#__PURE__*/React.createElement("div",{className:"text-center py-6 text-gray-500"},/*#__PURE__*/React.createElement(Icons.CheckCircle,{className:"w-10 h-10 mx-auto mb-2 text-green-500/50"}),/*#__PURE__*/React.createElement("p",{className:"text-sm"},t('noLockedUsers')||'No locked accounts')):/*#__PURE__*/React.createElement("div",{className:"space-y-2"},lockedUsers.map(item=>/*#__PURE__*/React.createElement("div",{key:item.username,className:"flex items-center justify-between p-3 bg-proxmox-darker rounded-lg border border-orange-500/20"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"w-2 h-2 rounded-full bg-orange-500 animate-pulse"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"font-medium text-white"},item.username),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},item.attempt_count," ",t('attempts')," \u2022 ",item.remaining_seconds,"s ",t('remaining')))),/*#__PURE__*/React.createElement("button",{onClick:()=>unlockUser(item.username),className:"px-4 py-2 bg-green-500/20 text-green-400 hover:bg-green-500/30 rounded-lg text-sm font-medium transition-colors"},t('unlock')))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-xl p-6 border border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Shield,{className:"w-5 h-5 text-blue-400"}),t('ipWhitelisting')||'IP Whitelisting'),/*#__PURE__*/React.createElement(IPWhitelistSection,{addToast:addToast})),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-xl p-6 border border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Database,{className:"w-5 h-5 text-green-400"}),t('configBackupRestore')||'Configuration Backup & Restore'),/*#__PURE__*/React.createElement(ConfigBackupSection,{addToast:addToast})));}// Compliance & Key Management Section (HIPAA/ISO 27001)
function ComplianceSection({addToast}){const{t}=useTranslation();const{getAuthHeaders,isAdmin}=useAuth();const[compliance,setCompliance]=useState(null);const[auditIntegrity,setAuditIntegrity]=useState(null);const[keyInfo,setKeyInfo]=useState(null);const[corsInfo,setCorsInfo]=useState(null);const[loading,setLoading]=useState(true);const[rotating,setRotating]=useState(false);const[checking,setChecking]=useState(false);useEffect(()=>{fetchComplianceStatus();},[]);const fetchComplianceStatus=async()=>{setLoading(true);try{const[compRes,keyRes,corsRes]=await Promise.all([fetch(`${API_URL}/security/compliance`,{credentials:'include',headers:getAuthHeaders()}),fetch(`${API_URL}/security/key-info`,{credentials:'include',headers:getAuthHeaders()}),fetch(`${API_URL}/security/cors`,{credentials:'include',headers:getAuthHeaders()})]);if(compRes.ok)setCompliance(await compRes.json());if(keyRes.ok)setKeyInfo(await keyRes.json());if(corsRes.ok)setCorsInfo(await corsRes.json());}catch(e){console.error('Failed to fetch compliance status:',e);}finally{setLoading(false);}};const checkAuditIntegrity=async()=>{setChecking(true);try{const res=await fetch(`${API_URL}/audit/integrity`,{credentials:'include',headers:getAuthHeaders()});if(res.ok){const data=await res.json();setAuditIntegrity(data);if(data.potentially_tampered>0){addToast(`âš ï¸ WARNING: ${data.potentially_tampered} audit entries may have been tampered!`,'error');}else{addToast(`âœ“ Audit log integrity verified: ${data.verified}/${data.total_entries} entries`,'success');}}}catch(e){addToast('Failed to check audit integrity','error');}finally{setChecking(false);}};const rotateKey=async()=>{if(!confirm('Are you sure you want to rotate the encryption key?\n\nThis will re-encrypt all sensitive data with a new key.\nThe old key will be backed up.')){return;}setRotating(true);try{const res=await fetch(`${API_URL}/security/key-rotate`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({confirm:true})});const data=await res.json();if(data.success){addToast(`Key rotation completed: ${data.users_rotated} users, ${data.clusters_rotated} clusters re-encrypted`,'success');fetchComplianceStatus();}else{addToast(`Key rotation failed: ${data.error}`,'error');}}catch(e){addToast('Key rotation failed','error');}finally{setRotating(false);}};if(loading){return/*#__PURE__*/React.createElement("div",{className:"flex justify-center py-8"},/*#__PURE__*/React.createElement("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-proxmox-orange"}));}const getScoreColor=score=>{if(score>=90)return'text-green-400';if(score>=70)return'text-yellow-400';return'text-red-400';};return/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-xl p-6 border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-4"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Check,null)," ",t('complianceStatus')||'Compliance Status'," (HIPAA/ISO 27001)"),compliance&&/*#__PURE__*/React.createElement("div",{className:`text-3xl font-bold ${getScoreColor(compliance.compliance_score)}`},compliance.compliance_score,"%")),compliance&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4"},Object.entries(compliance.checks||{}).map(([key,value])=>/*#__PURE__*/React.createElement("div",{key:key,className:`p-3 rounded-lg ${value?'bg-green-500/10 border border-green-500/30':'bg-red-500/10 border border-red-500/30'}`},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},value?/*#__PURE__*/React.createElement("span",{className:"text-green-400"},"\u2713"):/*#__PURE__*/React.createElement("span",{className:"text-red-400"},"\u2717"),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},key.replace(/_/g,' ')))))),compliance?.recommendations?.length>0&&/*#__PURE__*/React.createElement("div",{className:"mt-4 p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg"},/*#__PURE__*/React.createElement("h4",{className:"text-yellow-400 font-medium mb-2"},t('recommendations')||'Recommendations'),/*#__PURE__*/React.createElement("ul",{className:"text-sm text-gray-300 space-y-1"},compliance.recommendations.map((rec,i)=>/*#__PURE__*/React.createElement("li",{key:i},"\u2022 ",rec))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-xl p-6 border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-4"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white"},t('auditLogIntegrity')||'Audit Log Integrity'," (HMAC-SHA256)"),/*#__PURE__*/React.createElement("button",{onClick:checkAuditIntegrity,disabled:checking,className:"px-4 py-2 bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 rounded-lg text-sm font-medium transition-colors disabled:opacity-50"},checking?t('checking')||'Checking...':t('verifyIntegrity')||'Verify Integrity')),auditIntegrity&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4"},/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-card rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"text-2xl font-bold text-white"},auditIntegrity.total_entries),/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400"},t('totalEntries')||'Total Entries')),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-green-500/10 rounded-lg border border-green-500/30"},/*#__PURE__*/React.createElement("div",{className:"text-2xl font-bold text-green-400"},auditIntegrity.verified),/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400"},t('verified')||'Verified')),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-yellow-500/10 rounded-lg border border-yellow-500/30"},/*#__PURE__*/React.createElement("div",{className:"text-2xl font-bold text-yellow-400"},auditIntegrity.unsigned),/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400"},t('unsigned')||'Unsigned (old)')),/*#__PURE__*/React.createElement("div",{className:`p-4 rounded-lg border ${auditIntegrity.potentially_tampered>0?'bg-red-500/20 border-red-500':'bg-proxmox-card border-proxmox-border'}`},/*#__PURE__*/React.createElement("div",{className:`text-2xl font-bold ${auditIntegrity.potentially_tampered>0?'text-red-400':'text-gray-400'}`},auditIntegrity.potentially_tampered),/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400"},t('tampered')||'Potentially Tampered')))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-xl p-6 border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-4"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white"},t('encryptionKey')||'Encryption Key'," (AES-256-GCM)"),/*#__PURE__*/React.createElement("button",{onClick:rotateKey,disabled:rotating,className:"px-4 py-2 bg-orange-500/20 text-orange-400 hover:bg-orange-500/30 rounded-lg text-sm font-medium transition-colors disabled:opacity-50"},rotating?t('rotating')||'Rotating...':t('rotateKey')||'Rotate Key')),keyInfo&&/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-sm"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('algorithm')||'Algorithm',":"),/*#__PURE__*/React.createElement("span",{className:"text-white font-mono"},keyInfo.algorithm||'AES-256-GCM')),/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-sm"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('keySize')||'Key Size',":"),/*#__PURE__*/React.createElement("span",{className:"text-white"},keyInfo.key_size_bits||256," bits")),/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-sm"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('created')||'Created',":"),/*#__PURE__*/React.createElement("span",{className:"text-white"},keyInfo.created?new Date(keyInfo.created).toLocaleString():'Unknown')),/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-sm"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('lastRotation')||'Last Rotation',":"),/*#__PURE__*/React.createElement("span",{className:"text-white"},keyInfo.last_modified?new Date(keyInfo.last_modified).toLocaleString():'Never')),/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-sm"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('backups')||'Backups',":"),/*#__PURE__*/React.createElement("span",{className:"text-white"},keyInfo.backups?.length||0)))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-xl p-6 border border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4"},t('corsConfiguration')||'CORS Configuration'),corsInfo&&/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-sm"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('mode')||'Mode',":"),/*#__PURE__*/React.createElement("span",{className:`font-medium ${corsInfo.mode==='same-origin'?'text-green-400':'text-yellow-400'}`},corsInfo.mode==='same-origin'?'ðŸ”’ Same-Origin Only (Most Secure)':'âš™ï¸ Configured Origins')),corsInfo.all_allowed?.length>0&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-400 text-sm"},t('allowedOrigins')||'Allowed Origins',":"),/*#__PURE__*/React.createElement("div",{className:"mt-2 space-y-1"},corsInfo.all_allowed.map((origin,i)=>/*#__PURE__*/React.createElement("div",{key:i,className:"text-sm font-mono bg-proxmox-card px-3 py-1 rounded border border-proxmox-border"},origin)))),/*#__PURE__*/React.createElement("div",{className:"mt-4 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg text-sm text-gray-300"},/*#__PURE__*/React.createElement("strong",{className:"text-blue-400"},"Tip:")," For permanent CORS configuration, set the environment variable:",/*#__PURE__*/React.createElement("code",{className:"block mt-1 bg-proxmox-card px-2 py-1 rounded font-mono text-xs"},"export PEGAPROX_ALLOWED_ORIGINS=\"https://your-domain.com\"")))));}// IP Whitelist Management Component
// LW: Jan 2026 - Enterprise feature, be careful with this
// NS: Make sure you add your own IP before enabling lol
function IPWhitelistSection({addToast}){const{t}=useTranslation();const{getAuthHeaders}=useAuth();const[config,setConfig]=useState(null);const[loading,setLoading]=useState(true);const[saving,setSaving]=useState(false);const[newWhitelistIP,setNewWhitelistIP]=useState('');const[newBlacklistIP,setNewBlacklistIP]=useState('');const[testIP,setTestIP]=useState('');const[testResult,setTestResult]=useState(null);useEffect(()=>{fetchConfig();},[]);const fetchConfig=async()=>{try{const res=await fetch(`${API_URL}/security/ip-whitelist`,{credentials:'include',headers:getAuthHeaders()});if(res.ok){setConfig(await res.json());}}catch(e){console.error('Failed to fetch IP whitelist:',e);}finally{setLoading(false);}};const saveConfig=async newConfig=>{setSaving(true);try{const res=await fetch(`${API_URL}/security/ip-whitelist`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify(newConfig)});const data=await res.json();if(res.ok){addToast(t('saved')||'Saved successfully','success');fetchConfig();}else{addToast(data.error||'Failed to save','error');}}catch(e){addToast('Failed to save','error');}finally{setSaving(false);}};const addToWhitelist=()=>{if(!newWhitelistIP.trim())return;const updated=[...(config?.whitelist||[]),newWhitelistIP.trim()];saveConfig({...config,whitelist:updated});setNewWhitelistIP('');};const removeFromWhitelist=ip=>{const updated=(config?.whitelist||[]).filter(i=>i!==ip);saveConfig({...config,whitelist:updated});};const addToBlacklist=()=>{if(!newBlacklistIP.trim())return;const updated=[...(config?.blacklist||[]),newBlacklistIP.trim()];saveConfig({...config,blacklist:updated});setNewBlacklistIP('');};const removeFromBlacklist=ip=>{const updated=(config?.blacklist||[]).filter(i=>i!==ip);saveConfig({...config,blacklist:updated});};const testIPAccess=async()=>{if(!testIP.trim())return;try{const res=await fetch(`${API_URL}/security/ip-whitelist/test`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({ip:testIP.trim()})});if(res.ok){setTestResult(await res.json());}}catch(e){console.error('Test failed:',e);}};if(loading){return/*#__PURE__*/React.createElement("div",{className:"animate-pulse h-20 bg-proxmox-card rounded"});}// Show error state if config failed to load
if(!config){return/*#__PURE__*/React.createElement("div",{className:"p-4 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400"},/*#__PURE__*/React.createElement("p",null,t('failedToLoad')||'Failed to load IP whitelist configuration.'),/*#__PURE__*/React.createElement("button",{onClick:fetchConfig,className:"mt-2 px-3 py-1 bg-red-500/20 hover:bg-red-500/30 rounded text-sm"},t('retry')||'Retry'));}return/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between p-4 bg-proxmox-card rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"font-medium text-white"},t('enableIPWhitelist')||'Enable IP Whitelist'),/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400"},t('ipWhitelistDesc')||'Only allow access from specific IP addresses')),/*#__PURE__*/React.createElement("button",{onClick:()=>saveConfig({...config,enabled:!config?.enabled}),disabled:saving,className:`relative w-12 h-6 rounded-full transition-colors ${config?.enabled?'bg-green-500':'bg-gray-600'}`},/*#__PURE__*/React.createElement("span",{className:`absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full transition-transform shadow ${config?.enabled?'translate-x-6':'translate-x-0'}`}))),/*#__PURE__*/React.createElement("div",{className:"p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg text-sm"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('yourIP')||'Your current IP',":"),/*#__PURE__*/React.createElement("span",{className:"ml-2 font-mono text-white"},config?.your_ip)),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},/*#__PURE__*/React.createElement("label",{className:"text-sm font-medium text-gray-300"},t('whitelist')||'Whitelist'," (",t('allowedIPs')||'Allowed IPs',")"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"text",value:newWhitelistIP,onChange:e=>setNewWhitelistIP(e.target.value),placeholder:"192.168.1.0/24 or 10.0.0.*",className:"flex-1 px-3 py-2 bg-proxmox-card border border-proxmox-border rounded-lg text-white text-sm",onKeyDown:e=>e.key==='Enter'&&addToWhitelist()}),/*#__PURE__*/React.createElement("button",{onClick:addToWhitelist,disabled:saving||!newWhitelistIP.trim(),className:"px-4 py-2 bg-green-500/20 text-green-400 hover:bg-green-500/30 rounded-lg text-sm disabled:opacity-50"},t('add')||'Add')),config?.whitelist?.length>0&&/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-2 mt-2"},config.whitelist.map((ip,i)=>/*#__PURE__*/React.createElement("span",{key:i,className:"inline-flex items-center gap-1 px-3 py-1 bg-green-500/10 border border-green-500/30 rounded-full text-sm text-green-400"},ip,/*#__PURE__*/React.createElement("button",{onClick:()=>removeFromWhitelist(ip),className:"ml-1 text-red-400 hover:text-red-300"},"\xD7"))))),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},/*#__PURE__*/React.createElement("label",{className:"text-sm font-medium text-gray-300"},t('blacklist')||'Blacklist'," (",t('blockedIPs')||'Always Blocked',")"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"text",value:newBlacklistIP,onChange:e=>setNewBlacklistIP(e.target.value),placeholder:"192.168.1.100",className:"flex-1 px-3 py-2 bg-proxmox-card border border-proxmox-border rounded-lg text-white text-sm",onKeyDown:e=>e.key==='Enter'&&addToBlacklist()}),/*#__PURE__*/React.createElement("button",{onClick:addToBlacklist,disabled:saving||!newBlacklistIP.trim(),className:"px-4 py-2 bg-red-500/20 text-red-400 hover:bg-red-500/30 rounded-lg text-sm disabled:opacity-50"},t('add')||'Add')),config?.blacklist?.length>0&&/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-2 mt-2"},config.blacklist.map((ip,i)=>/*#__PURE__*/React.createElement("span",{key:i,className:"inline-flex items-center gap-1 px-3 py-1 bg-red-500/10 border border-red-500/30 rounded-full text-sm text-red-400"},ip,/*#__PURE__*/React.createElement("button",{onClick:()=>removeFromBlacklist(ip),className:"ml-1 text-gray-400 hover:text-gray-300"},"\xD7"))))),/*#__PURE__*/React.createElement("div",{className:"space-y-2 pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("label",{className:"text-sm font-medium text-gray-300"},t('testIP')||'Test IP Access'),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"text",value:testIP,onChange:e=>setTestIP(e.target.value),placeholder:"Enter IP to test",className:"flex-1 px-3 py-2 bg-proxmox-card border border-proxmox-border rounded-lg text-white text-sm",onKeyDown:e=>e.key==='Enter'&&testIPAccess()}),/*#__PURE__*/React.createElement("button",{onClick:testIPAccess,disabled:!testIP.trim(),className:"px-4 py-2 bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 rounded-lg text-sm disabled:opacity-50"},t('test')||'Test')),testResult&&/*#__PURE__*/React.createElement("div",{className:`p-3 rounded-lg text-sm ${testResult.allowed?'bg-green-500/10 border border-green-500/30 text-green-400':'bg-red-500/10 border border-red-500/30 text-red-400'}`},/*#__PURE__*/React.createElement("strong",null,testResult.ip,":")," ",testResult.allowed?'âœ“ Allowed':'âœ— Blocked'," - ",testResult.reason)),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mt-2"},t('supportedFormats')||'Supported formats',": Single IP (192.168.1.100), CIDR (192.168.1.0/24), Wildcard (192.168.1.*)"));}// Config Backup/Restore Component
// NS: Jan 2026 - encrypted backups with AES-256-GCM
// NS: Double password (user + backup) for security
function ConfigBackupSection({addToast}){const{t}=useTranslation();const{getAuthHeaders}=useAuth();const[exporting,setExporting]=useState(false);const[importing,setImporting]=useState(false);const[includeSecrets,setIncludeSecrets]=useState(false);// LW: off by default for safety
const[includeUsers,setIncludeUsers]=useState(true);const[includeAudit,setIncludeAudit]=useState(false);const[restoreMode,setRestoreMode]=useState('merge');// NS: merge is safer than overwrite
const[restoreUsers,setRestoreUsers]=useState(false);const[dryRun,setDryRun]=useState(true);// NS: dry run by default, dont want accidents
const[lastResult,setLastResult]=useState(null);const fileInputRef=React.useRef(null);// Security: Password fields
const[showExportModal,setShowExportModal]=useState(false);const[showImportModal,setShowImportModal]=useState(false);const[userPassword,setUserPassword]=useState('');const[backupPassword,setBackupPassword]=useState('');const[backupPasswordConfirm,setBackupPasswordConfirm]=useState('');const[selectedFile,setSelectedFile]=useState(null);const exportConfig=async()=>{if(!userPassword){addToast(t('passwordRequired')||'Password required','error');return;}if(!backupPassword||backupPassword.length<8){addToast(t('backupPasswordMin8')||'Backup password must be at least 8 characters','error');return;}if(backupPassword!==backupPasswordConfirm){addToast(t('passwordsNoMatch')||'Passwords do not match','error');return;}setExporting(true);try{const res=await fetch(`${API_URL}/config/backup`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({user_password:userPassword,backup_password:backupPassword,include_secrets:includeSecrets,include_users:includeUsers,include_audit:includeAudit})});if(res.ok){const blob=await res.blob();if(blob.size===0){addToast('Backup file is empty','error');return;}const url=window.URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`pegaprox-backup-${new Date().toISOString().split('T')[0]}.pegabackup`;a.style.display='none';document.body.appendChild(a);a.click();setTimeout(()=>{window.URL.revokeObjectURL(url);a.remove();},100);addToast(t('backupDownloaded')||'Encrypted backup downloaded','success');setShowExportModal(false);setUserPassword('');setBackupPassword('');setBackupPasswordConfirm('');}else{// Try to parse error response
let errMsg=`Export failed (${res.status})`;try{const err=await res.json();errMsg=err.error||errMsg;}catch(e){// Response might not be JSON
const text=await res.text();if(text)errMsg=text;}addToast(errMsg,'error');}}catch(e){console.error('Backup export error:',e);addToast('Export failed: '+e.message,'error');}finally{setExporting(false);}};const importConfig=async()=>{if(!userPassword){addToast(t('passwordRequired')||'Password required','error');return;}if(!backupPassword){addToast(t('backupPasswordRequired')||'Backup password required','error');return;}if(!selectedFile){addToast(t('selectFile')||'Please select a file','error');return;}setImporting(true);setLastResult(null);try{const formData=new FormData();formData.append('user_password',userPassword);formData.append('backup_password',backupPassword);formData.append('backup_file',selectedFile);formData.append('mode',restoreMode);formData.append('restore_users',restoreUsers);formData.append('dry_run',dryRun);const res=await fetch(`${API_URL}/config/restore`,{method:'POST',credentials:'include',headers:getAuthHeaders(),// Don't set Content-Type for FormData
body:formData});const result=await res.json().catch(()=>({error:`Server error (${res.status})`}));setLastResult(result);if(res.ok){if(dryRun){addToast(t('dryRunComplete')||'Dry run complete - check results below','info');}else{addToast(t('restoreComplete')||'Configuration restored','success');}setShowImportModal(false);setUserPassword('');setBackupPassword('');setSelectedFile(null);}else{console.error('Restore error:',result);addToast(result.error||`Restore failed (${res.status})`,'error');}}catch(e){console.error('Import exception:',e);addToast('Import failed: '+e.message,'error');}finally{setImporting(false);if(fileInputRef.current)fileInputRef.current.value='';}};return/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"p-3 bg-green-500/10 border border-green-500/30 rounded-lg text-sm text-gray-300"},/*#__PURE__*/React.createElement("strong",{className:"text-green-400"},"\uD83D\uDD12 ",t('secureBackup')||'Secure Backup',":")," ",t('secureBackupDesc')||'Backups are encrypted with AES-256-GCM. You must provide your password and a backup encryption password.'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},t('exportConfig')||'Export Configuration'),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:includeUsers,onChange:e=>setIncludeUsers(e.target.checked),className:"rounded border-gray-600 bg-proxmox-card text-proxmox-orange focus:ring-proxmox-orange"}),t('includeUsers')||'Include user accounts'),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:includeSecrets,onChange:e=>setIncludeSecrets(e.target.checked),className:"rounded border-gray-600 bg-proxmox-card text-proxmox-orange focus:ring-proxmox-orange"}),t('includeSecrets')||'Include passwords & secrets',/*#__PURE__*/React.createElement("span",{className:"text-yellow-500 text-xs"},"(\u26A0\uFE0F ",t('sensitive')||'Sensitive',")")),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:includeAudit,onChange:e=>setIncludeAudit(e.target.checked),className:"rounded border-gray-600 bg-proxmox-card text-proxmox-orange focus:ring-proxmox-orange"}),t('includeAuditLog')||'Include audit log',/*#__PURE__*/React.createElement("span",{className:"text-gray-500 text-xs"},"(",t('canBeLarge')||'Can be large',")"))),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowExportModal(true),className:"flex items-center gap-2 px-4 py-2 bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 rounded-lg text-sm font-medium transition-colors"},/*#__PURE__*/React.createElement(Icons.Download,{className:"w-4 h-4"})," ",t('createBackup')||'Create Backup')),/*#__PURE__*/React.createElement("div",{className:"space-y-4 pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},t('importConfig')||'Import Configuration'),/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement("div",{className:"flex gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"radio",name:"restoreMode",checked:restoreMode==='merge',onChange:()=>setRestoreMode('merge'),className:"border-gray-600 bg-proxmox-card text-proxmox-orange focus:ring-proxmox-orange"}),t('merge')||'Merge'," ",/*#__PURE__*/React.createElement("span",{className:"text-gray-500 text-xs"},"(",t('keepExisting')||'Keep existing',")")),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"radio",name:"restoreMode",checked:restoreMode==='overwrite',onChange:()=>setRestoreMode('overwrite'),className:"border-gray-600 bg-proxmox-card text-proxmox-orange focus:ring-proxmox-orange"}),t('overwrite')||'Overwrite'," ",/*#__PURE__*/React.createElement("span",{className:"text-red-500 text-xs"},"(",t('replaceAll')||'Replace all',")"))),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:restoreUsers,onChange:e=>setRestoreUsers(e.target.checked),className:"rounded border-gray-600 bg-proxmox-card text-proxmox-orange focus:ring-proxmox-orange"}),t('restoreUsers')||'Restore user accounts',/*#__PURE__*/React.createElement("span",{className:"text-yellow-500 text-xs"},"(\u26A0\uFE0F ",t('notAdmin')||'Excluding admin',")")),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:dryRun,onChange:e=>setDryRun(e.target.checked),className:"rounded border-gray-600 bg-proxmox-card text-proxmox-orange focus:ring-proxmox-orange"}),t('dryRun')||'Dry run',/*#__PURE__*/React.createElement("span",{className:"text-green-500 text-xs"},"(",t('validateOnly')||'Validate only, don\'t apply',")"))),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowImportModal(true),className:"flex items-center gap-2 px-4 py-2 bg-orange-500/20 text-orange-400 hover:bg-orange-500/30 rounded-lg text-sm font-medium transition-colors"},/*#__PURE__*/React.createElement(Icons.Upload,{className:"w-4 h-4"})," ",t('restoreBackup')||'Restore from Backup')),lastResult&&/*#__PURE__*/React.createElement("div",{className:`p-4 rounded-lg border ${lastResult.errors?.length>0?'bg-yellow-500/10 border-yellow-500/30':'bg-green-500/10 border-green-500/30'}`},/*#__PURE__*/React.createElement("h5",{className:"font-medium text-white mb-2"},lastResult.dry_run?t('dryRunResults')||'Dry Run Results':t('restoreResults')||'Restore Results'),/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-300 space-y-1"},/*#__PURE__*/React.createElement("div",null,t('backupVersion')||'Backup version',": ",lastResult.backup_version),/*#__PURE__*/React.createElement("div",null,t('backupDate')||'Backup date',": ",new Date(lastResult.backup_date).toLocaleString()),/*#__PURE__*/React.createElement("div",null,t('backupBy')||'Created by',": ",lastResult.backup_by),/*#__PURE__*/React.createElement("div",null,t('mode')||'Mode',": ",lastResult.mode),Object.keys(lastResult.restored||{}).length>0&&/*#__PURE__*/React.createElement("div",{className:"mt-2"},/*#__PURE__*/React.createElement("strong",{className:"text-green-400"},t('restored')||'Restored',":"),/*#__PURE__*/React.createElement("ul",{className:"ml-4"},Object.entries(lastResult.restored).map(([key,val])=>/*#__PURE__*/React.createElement("li",{key:key},key,": ",val===true?'âœ“':val)))),Object.keys(lastResult.skipped||{}).length>0&&/*#__PURE__*/React.createElement("div",{className:"mt-2"},/*#__PURE__*/React.createElement("strong",{className:"text-yellow-400"},t('skipped')||'Skipped',":"),/*#__PURE__*/React.createElement("ul",{className:"ml-4"},Object.entries(lastResult.skipped).map(([key,val])=>/*#__PURE__*/React.createElement("li",{key:key},key,": ",val)))),lastResult.errors?.length>0&&/*#__PURE__*/React.createElement("div",{className:"mt-2"},/*#__PURE__*/React.createElement("strong",{className:"text-red-400"},t('errors')||'Errors',":"),/*#__PURE__*/React.createElement("ul",{className:"ml-4 text-red-300"},lastResult.errors.map((err,i)=>/*#__PURE__*/React.createElement("li",{key:i},err)))))),showExportModal&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-6 max-w-md w-full mx-4 space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white"},"\uD83D\uDD10 ",t('securityVerification')||'Security Verification'),/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowExportModal(false);setUserPassword('');setBackupPassword('');setBackupPasswordConfirm('');},className:"text-gray-400 hover:text-white"},"\xD7")),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},t('exportSecurityDesc')||'To create an encrypted backup, please verify your identity and set a backup password.'),/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-1"},t('yourPassword')||'Your Password'),/*#__PURE__*/React.createElement("input",{type:"password",value:userPassword,onChange:e=>setUserPassword(e.target.value),placeholder:t('enterYourPassword')||'Enter your account password',className:"w-full px-3 py-2 bg-proxmox-card border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-1"},t('backupPassword')||'Backup Password'),/*#__PURE__*/React.createElement("input",{type:"password",value:backupPassword,onChange:e=>setBackupPassword(e.target.value),placeholder:t('backupPasswordPlaceholder')||'Min. 8 characters - remember this!',className:"w-full px-3 py-2 bg-proxmox-card border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-1"},t('confirmBackupPassword')||'Confirm Backup Password'),/*#__PURE__*/React.createElement("input",{type:"password",value:backupPasswordConfirm,onChange:e=>setBackupPasswordConfirm(e.target.value),placeholder:t('repeatBackupPassword')||'Repeat backup password',className:`w-full px-3 py-2 bg-proxmox-card border rounded-lg text-white ${backupPasswordConfirm&&backupPassword!==backupPasswordConfirm?'border-red-500':'border-proxmox-border'}`}))),/*#__PURE__*/React.createElement("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg text-sm text-yellow-300"},"\u26A0\uFE0F ",t('rememberBackupPassword')||'Remember the backup password! Without it, you cannot restore the backup.'),/*#__PURE__*/React.createElement("div",{className:"flex gap-3 pt-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowExportModal(false);setUserPassword('');setBackupPassword('');setBackupPasswordConfirm('');},className:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-500"},t('cancel')||'Cancel'),/*#__PURE__*/React.createElement("button",{onClick:exportConfig,disabled:exporting||!userPassword||backupPassword.length<8||backupPassword!==backupPasswordConfirm,className:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed"},exporting?t('exporting')||'Exporting...':t('downloadBackup')||'Download Backup')))),showImportModal&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-6 max-w-md w-full mx-4 space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white"},"\uD83D\uDD10 ",t('restoreFromBackup')||'Restore from Backup'),/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowImportModal(false);setUserPassword('');setBackupPassword('');setSelectedFile(null);},className:"text-gray-400 hover:text-white"},"\xD7")),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},t('importSecurityDesc')||'To restore a backup, please verify your identity and enter the backup password.'),/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-1"},t('backupFile')||'Backup File'),/*#__PURE__*/React.createElement("input",{ref:fileInputRef,type:"file",accept:".pegabackup,.json",onChange:e=>setSelectedFile(e.target.files?.[0]||null),className:"w-full px-3 py-2 bg-proxmox-card border border-proxmox-border rounded-lg text-white file:mr-4 file:py-1 file:px-3 file:rounded file:border-0 file:bg-proxmox-orange file:text-white file:cursor-pointer"}),selectedFile&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-400 mt-1"},"\uD83D\uDCCE ",selectedFile.name," (",(selectedFile.size/1024).toFixed(1)," KB)")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-1"},t('yourPassword')||'Your Password'),/*#__PURE__*/React.createElement("input",{type:"password",value:userPassword,onChange:e=>setUserPassword(e.target.value),placeholder:t('enterYourPassword')||'Enter your account password',className:"w-full px-3 py-2 bg-proxmox-card border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-1"},t('backupPassword')||'Backup Password'),/*#__PURE__*/React.createElement("input",{type:"password",value:backupPassword,onChange:e=>setBackupPassword(e.target.value),placeholder:t('backupPasswordUsedWhenCreating')||'Password used when creating backup',className:"w-full px-3 py-2 bg-proxmox-card border border-proxmox-border rounded-lg text-white"}))),/*#__PURE__*/React.createElement("div",{className:"flex gap-3 pt-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowImportModal(false);setUserPassword('');setBackupPassword('');setSelectedFile(null);},className:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-500"},t('cancel')||'Cancel'),/*#__PURE__*/React.createElement("button",{onClick:importConfig,disabled:importing||!userPassword||!backupPassword||!selectedFile,className:"flex-1 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed"},importing?t('importing')||'Importing...':dryRun?t('validateBackup')||'Validate Backup':t('restoreBackup')||'Restore Backup')))));}// NS: Excluded VMs List Component for Balancing Config
// LW: Users wanted to exclude certain VMs from auto-migration (pinned VMs, etc)
// TODO(MK): Add bulk exclude/include
function ExcludedVMsList({clusterId,clusterMetrics,addToast,getAuthHeaders}){const{t}=useTranslation();const[excludedVMs,setExcludedVMs]=useState([]);const[loading,setLoading]=useState(true);const[allVMs,setAllVMs]=useState([]);// Fetch excluded VMs
const fetchExcludedVMs=async()=>{try{const res=await fetch(`${API_URL}/clusters/${clusterId}/excluded-vms`,{credentials:'include',headers:getAuthHeaders()});if(res.ok){const data=await res.json();setExcludedVMs(data.excluded_vms||[]);}}catch(e){console.error('Error fetching excluded VMs:',e);}setLoading(false);};// Fetch all VMs for dropdown
const fetchAllVMs=async()=>{try{const res=await fetch(`${API_URL}/clusters/${clusterId}/vms`,{credentials:'include',headers:getAuthHeaders()});if(res.ok){const data=await res.json();setAllVMs(data.vms||data||[]);}}catch(e){console.error('Error fetching VMs:',e);}};useEffect(()=>{fetchExcludedVMs();fetchAllVMs();},[clusterId]);const excludeVM=async(vmid,vmName)=>{try{const res=await fetch(`${API_URL}/clusters/${clusterId}/excluded-vms/${vmid}`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({reason:'Manually excluded'})});if(res.ok){addToast(`${vmName||vmid} ${t('excludedFromBalancing')||'excluded from balancing'}`,'success');fetchExcludedVMs();}}catch(e){console.error(e);}};const includeVM=async(vmid,vmName)=>{try{const res=await fetch(`${API_URL}/clusters/${clusterId}/excluded-vms/${vmid}`,{method:'DELETE',credentials:'include',headers:getAuthHeaders()});if(res.ok){addToast(`${vmName||vmid} ${t('reincludedInBalancing')||'re-included in balancing'}`,'success');fetchExcludedVMs();}}catch(e){console.error(e);}};const excludedVmIds=excludedVMs.map(v=>v.vmid);const availableVMs=allVMs.filter(vm=>!excludedVmIds.includes(vm.vmid));if(loading){return/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},t('loading'),"...");}return/*#__PURE__*/React.createElement("div",null,excludedVMs.length>0?/*#__PURE__*/React.createElement("div",{className:"space-y-2 mb-3"},excludedVMs.map(vm=>/*#__PURE__*/React.createElement("div",{key:vm.vmid,className:"flex items-center justify-between bg-proxmox-dark rounded-lg p-2"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Monitor,{className:"w-4 h-4 text-red-400"}),/*#__PURE__*/React.createElement("span",{className:"text-sm"},vm.name||`VM ${vm.vmid}`),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},"(",vm.vmid,")")),/*#__PURE__*/React.createElement("button",{onClick:()=>includeVM(vm.vmid,vm.name),className:"text-xs text-green-400 hover:text-green-300"},t('include')||'Include')))):/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-600 mb-3 p-2 bg-proxmox-dark rounded-lg"},t('noExcludedVMs')||'No VMs excluded'),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("select",{id:`excludeVMSelect-${clusterId}`,className:"flex-1 bg-proxmox-dark border border-proxmox-border rounded-lg px-3 py-2 text-sm",defaultValue:""},/*#__PURE__*/React.createElement("option",{value:"",disabled:true},t('selectVMToExclude')||'Select VM to exclude...'),availableVMs.map(vm=>/*#__PURE__*/React.createElement("option",{key:vm.vmid,value:vm.vmid},vm.name||`VM ${vm.vmid}`," (",vm.vmid,") - ",vm.node))),/*#__PURE__*/React.createElement("button",{onClick:()=>{const select=document.getElementById(`excludeVMSelect-${clusterId}`);const vmid=parseInt(select?.value);if(!vmid)return;const vm=availableVMs.find(v=>v.vmid===vmid);excludeVM(vmid,vm?.name);select.value='';},className:"px-3 py-2 bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30 text-sm flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.Ban,{className:"w-4 h-4"}),t('exclude')||'Exclude')));}// update Manager Section Component (for Settings tab)
function UpdateManagerSection({clusterId,addToast}){const{t}=useTranslation();const{getAuthHeaders,isAdmin}=useAuth();const[loading,setLoading]=useState(false);const[checking,setChecking]=useState(false);const[updateStatus,setUpdateStatus]=useState(null);const[rollingUpdate,setRollingUpdate]=useState(null);const[includeReboot,setIncludeReboot]=useState(true);const[skipUpToDate,setSkipUpToDate]=useState(true);// NS: Skip nodes without updates
const[skipEvacuation,setSkipEvacuation]=useState(false);// NS: Issue #22 - skip VM evacuation (NOT RECOMMENDED)
const[evacuationTimeout,setEvacuationTimeout]=useState(1800);// NS: 30 min default
const[waitForReboot,setWaitForReboot]=useState(true);// NS: GitHub #40 - wait for node online before next
const[pauseOnEvacError,setPauseOnEvacError]=useState(true);// NS: GitHub #40 - pause if VMs fail to migrate
const[showAdvancedOptions,setShowAdvancedOptions]=useState(false);// NS: Toggle for timeouts
const[showConfirm,setShowConfirm]=useState(false);const[expanded,setExpanded]=useState(false);const[selectedNode,setSelectedNode]=useState(null);const[updatingNode,setUpdatingNode]=useState(null);const[showNodeUpdateConfirm,setShowNodeUpdateConfirm]=useState(null);const[nodeReboot,setNodeReboot]=useState(true);// NS: Auto-Update Scheduling
const[showScheduleModal,setShowScheduleModal]=useState(false);const[updateSchedule,setUpdateSchedule]=useState(null);const[scheduleEnabled,setScheduleEnabled]=useState(false);const[scheduleType,setScheduleType]=useState('recurring');// 'once' or 'recurring'
const[scheduleDay,setScheduleDay]=useState('sunday');const[scheduleTime,setScheduleTime]=useState('03:00');const[scheduleReboot,setScheduleReboot]=useState(true);const[scheduleSkipEvacuation,setScheduleSkipEvacuation]=useState(false);const[scheduleEvacTimeout,setScheduleEvacTimeout]=useState(1800);const[scheduleWaitForReboot,setScheduleWaitForReboot]=useState(true);const[scheduleShowAdvanced,setScheduleShowAdvanced]=useState(false);const[scheduleSaving,setScheduleSaving]=useState(false);// check if node has kernel updates
const nodeHasKernelUpdates=nodeData=>{return(nodeData?.updates||[]).some(pkg=>pkg.Package?.includes('linux-image')||pkg.Package?.includes('pve-kernel')||pkg.Package?.includes('proxmox-kernel'));};// check if node has security updates
const nodeHasSecurityUpdates=nodeData=>{return(nodeData?.updates||[]).some(pkg=>pkg.Origin?.includes('security')||pkg.Section?.includes('security'));};// update single node
const updateSingleNode=async(nodeName,withReboot)=>{setShowNodeUpdateConfirm(null);setUpdatingNode(nodeName);try{// First try normal update (requires maintenance mode)
let response=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${nodeName}/update`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({reboot:withReboot})});let data=await response.json();// If node not in maintenance mode, ask user if they want to force
if(!response.ok&&data.error?.includes('Wartungsmodus')){const forceUpdate=confirm(`${t('nodeNotInMaintenance')||'Node is not in maintenance mode.'}\n\n`+`${t('forceUpdateWarning')||'Running VMs on this node may be affected if a reboot is performed.'}\n\n`+`${t('continueAnyway')||'Continue anyway?'}`);if(forceUpdate){response=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${nodeName}/update`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({reboot:withReboot,force:true})});data=await response.json();}else{setUpdatingNode(null);return;}}if(data.success||response.ok){addToast(`${t('updateStarted')||'Update started'}: ${nodeName}`,'success');// Poll for update completion and refresh list
const pollUpdateStatus=setInterval(async()=>{try{const statusRes=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${nodeName}/update`,{credentials:'include',headers:getAuthHeaders()});if(statusRes.ok){const statusData=await statusRes.json();if(statusData.status==='completed'||statusData.status==='failed'){clearInterval(pollUpdateStatus);setUpdatingNode(null);if(statusData.status==='completed'){addToast(`${t('updateCompleted')||'Update completed'}: ${nodeName}`,'success');// Clear cache and re-check updates
localStorage.removeItem(`updateCheck_${clusterId}`);setTimeout(()=>checkUpdates(),2000);}}}}catch(e){// Ignore polling errors
}},5000);// Stop polling after 15 minutes max
setTimeout(()=>{clearInterval(pollUpdateStatus);setUpdatingNode(null);},15*60*1000);}else{addToast(data.error||'Error starting update','error');setUpdatingNode(null);}}catch(error){addToast(t('connectionError'),'error');setUpdatingNode(null);}};// Check for updates with progress
const[checkProgress,setCheckProgress]=useState(null);const checkUpdates=async()=>{setChecking(true);setCheckProgress({status:'checking',message:t('checkingNodes')||'Checking nodes for updates...'});try{const res=await fetch(`${API_URL}/clusters/${clusterId}/updates/check`,{method:'POST',credentials:'include',headers:getAuthHeaders()});const json=await res.json();if(json.success){setUpdateStatus(json);localStorage.setItem(`updateCheck_${clusterId}`,JSON.stringify({time:new Date().toISOString(),summary:json.summary,nodes:json.nodes}));if(json.summary?.total_updates>0){const failMsg=json.summary?.nodes_failed?` (${json.summary.nodes_failed} node(s) failed)`:'';addToast(`${json.summary.total_updates} ${t('updatesAvailable')}${failMsg}`,'info');}else if(json.summary?.nodes_failed>0){addToast(`${json.summary.nodes_failed} node(s) failed update check`,'warning');}else{addToast(t('noUpdatesAvailable'),'success');}}else{addToast(json.error||'Error checking updates','error');}}catch(err){console.error('Update check error:',err);addToast('Connection error checking updates','error');}setChecking(false);setCheckProgress(null);};// NS: Load update schedule for this cluster
const loadUpdateSchedule=async()=>{try{const res=await fetch(`${API_URL}/clusters/${clusterId}/updates/schedule`,{credentials:'include',headers:getAuthHeaders()});if(res.ok){const data=await res.json();setUpdateSchedule(data);setScheduleEnabled(data.enabled||false);setScheduleType(data.schedule_type||'recurring');setScheduleDay(data.day||'sunday');setScheduleTime(data.time||'03:00');setScheduleReboot(data.include_reboot!==false);setScheduleSkipEvacuation(data.skip_evacuation||false);setScheduleEvacTimeout(data.evacuation_timeout||1800);setScheduleWaitForReboot(data.wait_for_reboot!==false);}}catch(e){console.error('Error loading update schedule:',e);}};// NS: Save update schedule
const saveUpdateSchedule=async()=>{setScheduleSaving(true);try{const res=await fetch(`${API_URL}/clusters/${clusterId}/updates/schedule`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({enabled:scheduleEnabled,schedule_type:scheduleType,day:scheduleDay,time:scheduleTime,include_reboot:scheduleReboot,skip_evacuation:scheduleSkipEvacuation,wait_for_reboot:scheduleWaitForReboot,skip_up_to_date:true,evacuation_timeout:scheduleEvacTimeout})});if(res.ok){addToast(t('scheduleSaved')||'Update schedule saved','success');setShowScheduleModal(false);loadUpdateSchedule();}else{const err=await res.json();addToast(err.error||'Error saving schedule','error');}}catch(e){addToast('Error saving schedule','error');}setScheduleSaving(false);};// Load schedule on mount
useEffect(()=>{loadUpdateSchedule();},[clusterId]);// Get rolling update status
const getRollingStatus=async()=>{try{const r=await fetch(`${API_URL}/clusters/${clusterId}/updates/status`,{credentials:'include',headers:getAuthHeaders()});if(!r.ok){setRollingUpdate(null);return;}const d=await r.json();// Backend already clears old/invalid status, just use what it returns
if(d.success&&d.rolling_update){setRollingUpdate(d.rolling_update);}else{setRollingUpdate(null);}}catch(e){console.error('getting rolling update status:',e);setRollingUpdate(null);}};// start rolling update
const startRollingUpdate=async()=>{setShowConfirm(false);try{const response=await fetch(`${API_URL}/clusters/${clusterId}/updates/rolling`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({include_reboot:includeReboot,skip_up_to_date:skipUpToDate,skip_evacuation:skipEvacuation,// NS: Issue #22 - skip VM evacuation (NOT RECOMMENDED)
wait_for_reboot:waitForReboot,// NS: GitHub #40
pause_on_evacuation_error:pauseOnEvacError,// NS: GitHub #40
evacuation_timeout:evacuationTimeout})});const data=await response.json();if(data.success){addToast(t('rollingUpdateInProgress'),'info');setExpanded(true);// Auto-expand to show progress
// Immediately fetch status to show progress UI
setTimeout(()=>getRollingStatus(),500);setTimeout(()=>getRollingStatus(),1500);}else{addToast(data.error||'Error starting rolling update','error');}}catch(error){addToast(t('connectionError'),'error');}};// Cancel rolling update
const cancelRollingUpdate=async()=>{try{const response=await fetch(`${API_URL}/clusters/${clusterId}/updates/rolling`,{method:'DELETE',credentials:'include',headers:getAuthHeaders()});const data=await response.json();if(data.success){addToast(t('cancelRollingUpdate')+' âœ“','info');setRollingUpdate(null);}}catch(error){addToast(t('connectionError'),'error');}};// NS: GitHub #40 - Resume a paused rolling update
const resumeRollingUpdate=async()=>{try{const response=await fetch(`${API_URL}/clusters/${clusterId}/updates/rolling/resume`,{method:'POST',credentials:'include',headers:getAuthHeaders()});const data=await response.json();if(data.success){addToast('Rolling Update resumed','success');setTimeout(()=>getRollingStatus(),500);}else{addToast(data.error||'Failed to resume','error');}}catch(error){addToast(t('connectionError'),'error');}};// Load cached update status and check daily
useEffect(()=>{// Reset state when cluster changes
setUpdateStatus(null);setRollingUpdate(null);setSelectedNode(null);setUpdatingNode(null);setExpanded(false);// Check rolling update status
getRollingStatus();// Load cached status from localStorage
const cached=localStorage.getItem(`updateCheck_${clusterId}`);if(cached){try{const data=JSON.parse(cached);// Show cached data immediately
if(data.summary){setUpdateStatus({summary:data.summary,nodes:data.nodes||{}});}// Check if cache is older than 24 hours
const lastCheck=new Date(data.time);const hoursSince=(Date.now()-lastCheck.getTime())/(1000*60*60);if(hoursSince>24){checkUpdates();}}catch(e){checkUpdates();}}else{// No cache - do initial check
checkUpdates();}// Poll for rolling update status every 3 seconds (always poll, let the function decide)
const interval=setInterval(()=>{getRollingStatus();},3000);return()=>clearInterval(interval);},[clusterId]);const totalUpdates=updateStatus?.summary?.total_updates||0;const nodesWithUpdates=updateStatus?.summary?.nodes_with_updates||0;const nodesFailed=updateStatus?.summary?.nodes_failed||0;// Check for kernel updates
// NS: kernel updates require reboot, so we flag them seperately
const hasKernelUpdates=updateStatus&&Object.values(updateStatus.nodes||{}).some(node=>(node.updates||[]).some(pkg=>pkg.Package?.includes('linux-image')||pkg.Package?.includes('pve-kernel')));// Get last check info
const lastCheckInfo=(()=>{const cached=localStorage.getItem(`updateCheck_${clusterId}`);if(cached){try{const data=JSON.parse(cached);return new Date(data.time).toLocaleString();}catch(e){}}return t('neverChecked');})();return/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 flex items-center justify-between cursor-pointer hover:bg-proxmox-hover/50 transition-colors",onClick:()=>setExpanded(!expanded)},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"w-10 h-10 rounded-lg bg-proxmox-dark flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Download,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"font-semibold text-white"},t('updateManager')),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-400"},totalUpdates>0?/*#__PURE__*/React.createElement("span",{className:"text-yellow-400"},totalUpdates," ",t('updatesAvailable'),nodesFailed>0?` (${nodesFailed} failed)`:''):nodesFailed>0?/*#__PURE__*/React.createElement("span",{className:"text-red-400"},nodesFailed," node(s) failed check"):updateStatus?/*#__PURE__*/React.createElement("span",{className:"text-green-400"},t('noUpdatesAvailable')):/*#__PURE__*/React.createElement("span",null,t('lastChecked'),": ",lastCheckInfo)))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},totalUpdates>0&&/*#__PURE__*/React.createElement("span",{className:"px-2 py-1 bg-yellow-500/20 text-yellow-400 rounded-full text-xs font-medium"},totalUpdates),hasKernelUpdates&&/*#__PURE__*/React.createElement("span",{className:"px-2 py-1 bg-red-500/20 text-red-400 rounded-full text-xs font-medium"},"Kernel"),/*#__PURE__*/React.createElement(Icons.ChevronDown,{className:`transition-transform ${expanded?'rotate-180':''}`}))),expanded&&/*#__PURE__*/React.createElement("div",{className:"border-t border-proxmox-border p-4 space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();checkUpdates();},disabled:checking,className:"px-4 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-sm hover:border-proxmox-orange transition-colors flex items-center gap-2 disabled:opacity-50"},checking?/*#__PURE__*/React.createElement("div",{className:"animate-spin w-4 h-4 border-2 border-proxmox-orange border-t-transparent rounded-full"}):/*#__PURE__*/React.createElement(Icons.RefreshCw,null),t('checkForUpdates')),isAdmin&&/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();setShowScheduleModal(true);},className:`px-4 py-2 rounded-lg text-sm transition-colors flex items-center gap-2 ${scheduleEnabled?'bg-green-500/20 border border-green-500/50 text-green-400 hover:bg-green-500/30':'bg-proxmox-dark border border-proxmox-border text-gray-400 hover:bg-proxmox-hover'}`,title:scheduleEnabled?`${t('scheduledFor')||'Scheduled for'}: ${scheduleDay} ${scheduleTime}`:t('scheduleUpdates')||'Schedule Updates'},/*#__PURE__*/React.createElement(Icons.Clock,null),scheduleEnabled?/*#__PURE__*/React.createElement("span",{className:"hidden sm:inline"},scheduleDay.charAt(0).toUpperCase()+scheduleDay.slice(1)," ",scheduleTime):/*#__PURE__*/React.createElement("span",{className:"hidden sm:inline"},t('schedule')||'Schedule')),isAdmin&&totalUpdates>0&&!rollingUpdate&&/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();setShowConfirm(true);},className:"px-4 py-2 bg-proxmox-orange rounded-lg text-white text-sm hover:bg-orange-600 transition-colors flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Play,null),t('startRollingUpdate'))),checking&&checkProgress&&/*#__PURE__*/React.createElement("div",{className:"p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"relative"},/*#__PURE__*/React.createElement("div",{className:"animate-spin w-8 h-8 border-3 border-blue-400 border-t-transparent rounded-full"}),/*#__PURE__*/React.createElement(Icons.Server,{className:"absolute inset-0 m-auto w-4 h-4 text-blue-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-blue-400 font-medium"},t('checkingForUpdates')||'Checking for Updates'),/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400"},checkProgress.message))),/*#__PURE__*/React.createElement("div",{className:"mt-3 w-full bg-proxmox-dark rounded-full h-1.5 overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"bg-blue-400 h-full rounded-full animate-pulse",style:{width:'100%'}}))),hasKernelUpdates&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg flex items-start gap-2"},/*#__PURE__*/React.createElement("span",{className:"text-red-400"},"\u26A0\uFE0F"),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("p",{className:"text-red-400 text-sm font-medium"},"Kernel Update Available"),/*#__PURE__*/React.createElement("p",{className:"text-red-300/70 text-xs"},t('includeRebootHint')))),updateStatus&&/*#__PURE__*/React.createElement("div",{className:"space-y-2"},Object.entries(updateStatus.nodes||{}).map(([nodeName,nodeData])=>{const hasKernel=nodeHasKernelUpdates(nodeData);const hasSecurity=nodeHasSecurityUpdates(nodeData);const isExpanded=selectedNode===nodeName;const isUpdating=updatingNode===nodeName;return/*#__PURE__*/React.createElement("div",{key:nodeName,className:"bg-proxmox-dark rounded-lg border border-proxmox-border overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-3 flex items-center justify-between cursor-pointer hover:bg-proxmox-hover/30 transition-colors",onClick:()=>setSelectedNode(isExpanded?null:nodeName)},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement(Icons.Server,{className:"w-4 h-4 text-gray-400"}),/*#__PURE__*/React.createElement("span",{className:"text-sm font-medium text-white"},nodeName),hasKernel&&/*#__PURE__*/React.createElement("span",{className:"px-1.5 py-0.5 bg-red-500/20 text-red-400 rounded text-xs"},"Kernel"),hasSecurity&&/*#__PURE__*/React.createElement("span",{className:"px-1.5 py-0.5 bg-orange-500/20 text-orange-400 rounded text-xs"},"Security")),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},isUpdating&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-blue-400 text-xs"},/*#__PURE__*/React.createElement("div",{className:"animate-spin w-3 h-3 border-2 border-blue-400 border-t-transparent rounded-full"}),"Updating..."),/*#__PURE__*/React.createElement("span",{className:`text-xs px-2 py-0.5 rounded-full ${!nodeData.success?'bg-red-500/20 text-red-400':nodeData.count>0?'bg-yellow-500/20 text-yellow-400':'bg-green-500/20 text-green-400'}`},!nodeData.success?`âš  ${t('checkFailed')||'Check failed'}`:`${nodeData.count||0} ${t('updates')||'updates'}`),/*#__PURE__*/React.createElement(Icons.ChevronDown,{className:`w-4 h-4 text-gray-400 transition-transform ${isExpanded?'rotate-180':''}`}))),isExpanded&&/*#__PURE__*/React.createElement("div",{className:"border-t border-proxmox-border"},nodeData.count>0?/*#__PURE__*/React.createElement(React.Fragment,null,isAdmin&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-proxmox-darker border-b border-proxmox-border flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();setNodeReboot(hasKernel);setShowNodeUpdateConfirm(nodeName);},disabled:isUpdating,className:"px-3 py-1.5 bg-proxmox-orange hover:bg-orange-600 rounded text-white text-xs font-medium transition-colors disabled:opacity-50 flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.Download,{className:"w-3 h-3"}),t('updateThisNode')||'Update this Node'),hasKernel&&/*#__PURE__*/React.createElement("span",{className:"text-xs text-red-400 flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-3 h-3"}),t('rebootRequired')||'Reboot required for kernel')),/*#__PURE__*/React.createElement("div",{className:"max-h-64 overflow-y-auto"},/*#__PURE__*/React.createElement("table",{className:"w-full text-xs"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-darker sticky top-0"},/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{className:"text-left p-2 text-gray-400 font-medium"},t('package')||'Package'),/*#__PURE__*/React.createElement("th",{className:"text-left p-2 text-gray-400 font-medium"},t('currentVersion')||'Current'),/*#__PURE__*/React.createElement("th",{className:"text-left p-2 text-gray-400 font-medium"},t('newVersion')||'New'),/*#__PURE__*/React.createElement("th",{className:"text-left p-2 text-gray-400 font-medium"},t('type')||'Type'))),/*#__PURE__*/React.createElement("tbody",null,(nodeData.updates||[]).map((pkg,idx)=>{const isKernelPkg=pkg.Package?.includes('linux-image')||pkg.Package?.includes('kernel');const isSecurityPkg=pkg.Origin?.includes('security')||pkg.Section?.includes('security');return/*#__PURE__*/React.createElement("tr",{key:idx,className:"border-t border-gray-700/50 hover:bg-proxmox-hover/20"},/*#__PURE__*/React.createElement("td",{className:"p-2 font-mono text-white"},pkg.Package||'unknown'),/*#__PURE__*/React.createElement("td",{className:"p-2 font-mono text-gray-400 truncate max-w-24",title:pkg.OldVersion},pkg.OldVersion?.substring(0,15)||'-'),/*#__PURE__*/React.createElement("td",{className:"p-2 font-mono text-green-400 truncate max-w-24",title:pkg.Version},pkg.Version?.substring(0,15)||'-'),/*#__PURE__*/React.createElement("td",{className:"p-2"},isKernelPkg?/*#__PURE__*/React.createElement("span",{className:"px-1.5 py-0.5 bg-red-500/20 text-red-400 rounded"},"Kernel"):isSecurityPkg?/*#__PURE__*/React.createElement("span",{className:"px-1.5 py-0.5 bg-orange-500/20 text-orange-400 rounded"},"Security"):/*#__PURE__*/React.createElement("span",{className:"px-1.5 py-0.5 bg-blue-500/20 text-blue-400 rounded"},"Update")));}))))):!nodeData.success?/*#__PURE__*/React.createElement("div",{className:"p-4 text-center text-sm"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-6 h-6 mx-auto mb-2 text-red-400"}),/*#__PURE__*/React.createElement("p",{className:"text-red-400 font-medium"},t('checkFailed')||'Update check failed'),/*#__PURE__*/React.createElement("p",{className:"text-gray-500 mt-1 text-xs"},nodeData.error||'Connection error')):/*#__PURE__*/React.createElement("div",{className:"p-4 text-center text-gray-500 text-sm"},/*#__PURE__*/React.createElement(Icons.CheckCircle,{className:"w-6 h-6 mx-auto mb-2 text-green-400"}),t('noUpdatesForNode')||'This node is up to date')));})),showNodeUpdateConfirm&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop",onClick:()=>setShowNodeUpdateConfirm(null)},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-5 max-w-md w-full animate-scale-in",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-3 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Download,null),t('updateNode')||'Update Node',": ",showNodeUpdateConfirm),/*#__PURE__*/React.createElement("p",{className:"text-gray-400 text-sm mb-4"},t('updateNodeDesc')||'This will run apt update && apt dist-upgrade on the node.'),nodeHasKernelUpdates(updateStatus?.nodes?.[showNodeUpdateConfirm])&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg mb-4 flex items-start gap-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4 text-red-400 mt-0.5"}),/*#__PURE__*/React.createElement("div",{className:"text-xs"},/*#__PURE__*/React.createElement("p",{className:"text-red-400 font-medium"},t('kernelUpdateDetected')||'Kernel update detected'),/*#__PURE__*/React.createElement("p",{className:"text-red-300/70"},t('rebootRecommended')||'A reboot is recommended to apply kernel changes.'))),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 mb-4 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:nodeReboot,onChange:e=>setNodeReboot(e.target.checked),className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},t('rebootAfterUpdate')||'Reboot after update')),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowNodeUpdateConfirm(null),className:"flex-1 px-4 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-gray-400 hover:text-white transition-colors"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:()=>updateSingleNode(showNodeUpdateConfirm,nodeReboot),className:"flex-1 px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-white font-medium transition-colors"},t('startUpdate')||'Start Update')))),rollingUpdate&&(rollingUpdate.status==='running'||rollingUpdate.status==='paused')&&/*#__PURE__*/React.createElement("div",{className:`p-4 ${rollingUpdate.status==='paused'?'bg-yellow-500/10 border border-yellow-500/30':'bg-blue-500/10 border border-blue-500/30'} rounded-lg space-y-4`},rollingUpdate.status==='paused'&&/*#__PURE__*/React.createElement("div",{className:"bg-yellow-900/30 border border-yellow-600/50 rounded-lg p-4 space-y-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-5 h-5 text-yellow-400"}),/*#__PURE__*/React.createElement("span",{className:"text-yellow-400 font-semibold text-lg"},"Rolling Update Paused")),rollingUpdate.paused_details&&/*#__PURE__*/React.createElement("div",{className:"text-sm text-yellow-200/80"},rollingUpdate.paused_details.message),rollingUpdate.paused_reason==='evacuation_failures'&&rollingUpdate.paused_details?.failed_vms&&/*#__PURE__*/React.createElement("div",{className:"space-y-1 mt-2"},/*#__PURE__*/React.createElement("p",{className:"text-xs text-yellow-400 font-medium"},"Failed VMs:"),rollingUpdate.paused_details.failed_vms.map((vm,i)=>/*#__PURE__*/React.createElement("div",{key:i,className:"flex items-center gap-2 text-xs text-red-400 bg-red-900/20 rounded px-2 py-1"},/*#__PURE__*/React.createElement(Icons.XCircle,{className:"w-3 h-3"}),/*#__PURE__*/React.createElement("span",{className:"font-mono"},vm.name," (VMID: ",vm.vmid,")"),vm.error&&/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"- ",vm.error)))),/*#__PURE__*/React.createElement("div",{className:"flex gap-3 mt-3"},/*#__PURE__*/React.createElement("button",{onClick:resumeRollingUpdate,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium flex items-center gap-2 transition-colors"},/*#__PURE__*/React.createElement(Icons.Play,{className:"w-4 h-4"}),"Continue Update"),/*#__PURE__*/React.createElement("button",{onClick:cancelRollingUpdate,className:"px-4 py-2 bg-red-600/30 hover:bg-red-600/50 text-red-400 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors"},/*#__PURE__*/React.createElement(Icons.X,{className:"w-4 h-4"}),"Cancel Update"))),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},rollingUpdate.status==='paused'?/*#__PURE__*/React.createElement(Icons.Pause,{className:"w-5 h-5 text-yellow-400"}):/*#__PURE__*/React.createElement("div",{className:"animate-spin w-5 h-5 border-2 border-blue-400 border-t-transparent rounded-full"}),/*#__PURE__*/React.createElement("span",{className:`${rollingUpdate.status==='paused'?'text-yellow-400':'text-blue-400'} font-semibold text-lg`},rollingUpdate.status==='paused'?'Update Paused':t('rollingUpdateInProgress'))),rollingUpdate.status==='running'&&/*#__PURE__*/React.createElement("button",{onClick:cancelRollingUpdate,className:"px-3 py-1.5 text-sm bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30 transition-colors flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.X,{className:"w-4 h-4"}),t('cancel'))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('currentNode'),":"),/*#__PURE__*/React.createElement("div",{className:"text-white font-mono font-semibold"},rollingUpdate.current_node||'-')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('currentStep'),":"),/*#__PURE__*/React.createElement("div",{className:"text-yellow-400 font-medium capitalize"},rollingUpdate.current_step||'-')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('progress'),":"),/*#__PURE__*/React.createElement("div",{className:"text-white font-mono"},(rollingUpdate.current_index||0)+1," / ",rollingUpdate.nodes?.length||0)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('started'),":"),/*#__PURE__*/React.createElement("div",{className:"text-gray-300 text-xs"},rollingUpdate.started_at||'-'))),/*#__PURE__*/React.createElement("div",{className:"w-full bg-proxmox-darker rounded-full h-3 overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"bg-gradient-to-r from-blue-500 to-blue-400 h-full rounded-full transition-all duration-500 relative",style:{width:`${((rollingUpdate.current_index||0)+1)/(rollingUpdate.nodes?.length||1)*100}%`}},/*#__PURE__*/React.createElement("div",{className:"absolute inset-0 bg-white/20 animate-pulse"})))),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-2"},(rollingUpdate.nodes||[]).map((nodeName,idx)=>{const isCompleted=(rollingUpdate.completed_nodes||[]).includes(nodeName);const isFailed=(rollingUpdate.failed_nodes||[]).some(f=>f.node===nodeName);const isCurrent=rollingUpdate.current_node===nodeName;const isPending=!isCompleted&&!isFailed&&!isCurrent;return/*#__PURE__*/React.createElement("div",{key:nodeName,className:`px-3 py-1.5 rounded-lg text-sm font-medium flex items-center gap-1.5 ${isCompleted?'bg-green-500/20 text-green-400':isFailed?'bg-red-500/20 text-red-400':isCurrent?'bg-blue-500/20 text-blue-400 animate-pulse':'bg-gray-500/20 text-gray-400'}`},isCompleted&&/*#__PURE__*/React.createElement(Icons.CheckCircle,{className:"w-3 h-3"}),isFailed&&/*#__PURE__*/React.createElement(Icons.XCircle,{className:"w-3 h-3"}),isCurrent&&/*#__PURE__*/React.createElement("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-ping"}),isPending&&/*#__PURE__*/React.createElement(Icons.Clock,{className:"w-3 h-3"}),nodeName);})),rollingUpdate.logs&&rollingUpdate.logs.length>0&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker rounded-lg overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"px-3 py-2 bg-proxmox-dark border-b border-proxmox-border flex items-center justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-sm font-medium text-gray-300 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Terminal,{className:"w-4 h-4"}),t('updateLogs')),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},rollingUpdate.logs.length," entries")),/*#__PURE__*/React.createElement("div",{className:"max-h-48 overflow-y-auto p-3 font-mono text-xs space-y-1"},rollingUpdate.logs.map((log,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:`${log.includes('ERROR')||log.includes('Failed:')?'text-red-400':log.includes('PAUSED')||log.includes('Warning')?'text-yellow-400':log.includes('Resumed')||log.includes('successfully')||log.includes('completed')||log.includes('back online')?'text-green-400':log.includes('Starting')||log.includes('Processing')?'text-blue-400':'text-gray-400'}`},log))))),rollingUpdate&&rollingUpdate.status==='completed'&&rollingUpdate.completed_at&&(()=>{const completedTime=new Date(rollingUpdate.completed_at.replace(' ','T'));const ageMinutes=(Date.now()-completedTime.getTime())/1000/60;return!isNaN(ageMinutes)&&ageMinutes<10;})()&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-green-500/10 border border-green-500/30 rounded-lg flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-green-400"},/*#__PURE__*/React.createElement(Icons.CheckCircle,null),/*#__PURE__*/React.createElement("span",null,t('updateCompleted'))),/*#__PURE__*/React.createElement("button",{onClick:async()=>{setRollingUpdate(null);// Clear backend status too
try{await fetch(`${API_URL}/clusters/${clusterId}/updates/rolling/clear`,{method:'POST',credentials:'include',headers:getAuthHeaders()});}catch(e){}// Clear cache and re-check updates
localStorage.removeItem(`updateCheck_${clusterId}`);checkUpdates();},className:"text-xs text-gray-400 hover:text-white"},t('dismiss')||'Dismiss')),rollingUpdate&&rollingUpdate.status==='failed'&&/*#__PURE__*/React.createElement("div",{className:"p-4 bg-red-500/10 border border-red-500/30 rounded-lg space-y-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-red-400"},/*#__PURE__*/React.createElement(Icons.XCircle,null),/*#__PURE__*/React.createElement("span",{className:"font-semibold"},t('updateFailed')||'Update Failed')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{setRollingUpdate(null);try{await fetch(`${API_URL}/clusters/${clusterId}/updates/rolling/clear`,{method:'POST',credentials:'include',headers:getAuthHeaders()});}catch(e){}localStorage.removeItem(`updateCheck_${clusterId}`);checkUpdates();},className:"text-xs text-gray-400 hover:text-white"},t('dismiss')||'Dismiss')),rollingUpdate.error&&/*#__PURE__*/React.createElement("div",{className:"p-2 bg-red-500/20 rounded text-red-300 text-sm font-mono"},rollingUpdate.error),rollingUpdate.failed_nodes&&rollingUpdate.failed_nodes.length>0&&/*#__PURE__*/React.createElement("div",{className:"space-y-2"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-400"},t('failedNodes')||'Failed Nodes',":"),rollingUpdate.failed_nodes.map((fn,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"p-2 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-red-400 text-sm font-medium"},/*#__PURE__*/React.createElement(Icons.Server,{className:"w-4 h-4"}),fn.node),fn.error&&/*#__PURE__*/React.createElement("pre",{className:"mt-1 text-xs text-red-300/70 whitespace-pre-wrap max-h-24 overflow-auto"},fn.error)))),/*#__PURE__*/React.createElement("div",{className:"p-2 bg-yellow-500/10 border border-yellow-500/30 rounded text-yellow-300 text-xs flex items-start gap-2"},/*#__PURE__*/React.createElement("span",{className:"mt-0.5"},"\u26A0\uFE0F"),/*#__PURE__*/React.createElement("span",null,t('maintenanceModeWarning')||'Some nodes may still be in maintenance mode. Check the Nodes tab and exit maintenance mode manually if needed.')),rollingUpdate.logs&&rollingUpdate.logs.length>0&&/*#__PURE__*/React.createElement("details",{className:"bg-proxmox-dark rounded-lg overflow-hidden"},/*#__PURE__*/React.createElement("summary",{className:"px-3 py-2 cursor-pointer text-sm text-gray-400 hover:text-white"},t('viewLogs')||'View Logs'," (",rollingUpdate.logs.length,")"),/*#__PURE__*/React.createElement("div",{className:"max-h-48 overflow-y-auto p-3 font-mono text-xs space-y-1 border-t border-proxmox-border"},rollingUpdate.logs.map((log,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:`${log.includes('ERROR')||log.includes('âœ—')?'text-red-400':log.includes('âœ“')||log.includes('successfully')?'text-green-400':log.includes('Starting')?'text-blue-400':'text-gray-400'}`},log)))))),showConfirm&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop",onClick:()=>setShowConfirm(false)},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-2xl p-6 max-w-md w-full animate-scale-in",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-2"},t('confirmRollingUpdate')),/*#__PURE__*/React.createElement("p",{className:"text-gray-400 text-sm mb-4"},t('rollingUpdateWarning')),/*#__PURE__*/React.createElement("div",{className:"space-y-3 mb-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:includeReboot,onChange:e=>setIncludeReboot(e.target.checked),className:"w-4 h-4 rounded border-proxmox-border bg-proxmox-dark text-proxmox-orange focus:ring-proxmox-orange"}),/*#__PURE__*/React.createElement("span",{className:"text-white"},t('includeReboot')),hasKernelUpdates&&/*#__PURE__*/React.createElement("span",{className:"text-xs text-red-400"},"(Recommended)")),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:skipUpToDate,onChange:e=>setSkipUpToDate(e.target.checked),className:"w-4 h-4 rounded border-proxmox-border bg-proxmox-dark text-proxmox-orange focus:ring-proxmox-orange"}),/*#__PURE__*/React.createElement("span",{className:"text-white"},t('skipUpToDate')||'Skip up-to-date nodes')),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:skipEvacuation,onChange:e=>setSkipEvacuation(e.target.checked),className:"w-4 h-4 rounded border-proxmox-border bg-proxmox-dark text-red-500 focus:ring-red-500"}),/*#__PURE__*/React.createElement("span",{className:"text-red-400"},t('skipEvacuation')||'Skip VM evacuation'),/*#__PURE__*/React.createElement("span",{className:"text-xs bg-red-900/30 text-red-400 px-1.5 py-0.5 rounded"},t('notRecommended')||'NOT RECOMMENDED')),skipEvacuation&&/*#__PURE__*/React.createElement("div",{className:"ml-6 p-2 bg-red-900/20 border border-red-800 rounded text-xs text-red-400"},t('skipEvacuationWarning')||'âš ï¸ Warning: VMs may crash if something goes wrong during the update!'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAdvancedOptions(!showAdvancedOptions),className:"text-xs text-gray-500 hover:text-gray-300 flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.ChevronRight,{className:`w-3 h-3 transition-transform ${showAdvancedOptions?'rotate-90':''}`}),t('advancedOptions')||'Advanced Options'),showAdvancedOptions&&/*#__PURE__*/React.createElement("div",{className:"ml-4 space-y-3 p-3 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:waitForReboot,onChange:e=>setWaitForReboot(e.target.checked),className:"w-4 h-4 rounded border-proxmox-border bg-proxmox-darker text-proxmox-orange focus:ring-proxmox-orange",disabled:!includeReboot}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-white text-sm"},"Wait for node to come back online before next"),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},"Prevents migrating VMs to a still-rebooting node"))),!waitForReboot&&includeReboot&&/*#__PURE__*/React.createElement("div",{className:"ml-6 p-2 bg-yellow-900/20 border border-yellow-800 rounded text-xs text-yellow-400"},"Warning: Next node may try to migrate VMs to a node that is still rebooting!"),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:pauseOnEvacError,onChange:e=>setPauseOnEvacError(e.target.checked),className:"w-4 h-4 rounded border-proxmox-border bg-proxmox-darker text-proxmox-orange focus:ring-proxmox-orange",disabled:skipEvacuation}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-white text-sm"},"Pause if VMs fail to migrate"),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},"Lets you manually handle stuck VMs before continuing"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-xs text-gray-400 block mb-1"},t('evacuationTimeout')||'Evacuation Timeout'," (",t('seconds')||'seconds',")"),/*#__PURE__*/React.createElement("select",{value:evacuationTimeout,onChange:e=>setEvacuationTimeout(parseInt(e.target.value)),className:"w-full bg-proxmox-darker border border-proxmox-border rounded px-3 py-1.5 text-sm text-white",disabled:skipEvacuation},/*#__PURE__*/React.createElement("option",{value:300},"5 ",t('minutes')||'minutes'),/*#__PURE__*/React.createElement("option",{value:600},"10 ",t('minutes')||'minutes'),/*#__PURE__*/React.createElement("option",{value:1200},"20 ",t('minutes')||'minutes'),/*#__PURE__*/React.createElement("option",{value:1800},"30 ",t('minutes')||'minutes'," (",t('default')||'default',")"),/*#__PURE__*/React.createElement("option",{value:3600},"1 ",t('hour')||'hour'),/*#__PURE__*/React.createElement("option",{value:7200},"2 ",t('hours')||'hours')),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('evacuationTimeoutHint')||'How long to wait for VMs to migrate before timeout')))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-3 mb-4 text-sm"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-gray-400"},/*#__PURE__*/React.createElement("span",null,t('nodes'),":"),/*#__PURE__*/React.createElement("span",{className:"text-white"},updateStatus?.summary?.total_nodes||0)),/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-gray-400"},/*#__PURE__*/React.createElement("span",null,t('packagesAvailable'),":"),/*#__PURE__*/React.createElement("span",{className:"text-yellow-400"},totalUpdates)),/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-gray-400"},/*#__PURE__*/React.createElement("span",null,t('estimatedTime'),":"),/*#__PURE__*/React.createElement("span",{className:"text-white"},"~",(updateStatus?.summary?.total_nodes||1)*(includeReboot?10:5)," ",t('minutes'))),skipUpToDate&&/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-gray-400 mt-1"},/*#__PURE__*/React.createElement("span",null,t('note')||'Note',":"),/*#__PURE__*/React.createElement("span",{className:"text-green-400 text-xs"},t('skipUpToDateHint')||'Up-to-date nodes will be skipped'))),/*#__PURE__*/React.createElement("div",{className:"flex gap-3 justify-end"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowConfirm(false),className:"px-4 py-2 bg-proxmox-dark text-gray-300 rounded-lg hover:bg-proxmox-hover transition-colors"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:startRollingUpdate,className:"px-4 py-2 bg-proxmox-orange text-white rounded-lg hover:bg-orange-600 transition-colors"},t('startRollingUpdate'))))),showScheduleModal&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop",onClick:()=>setShowScheduleModal(false)},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-2xl p-6 max-w-md w-full animate-scale-in",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3 mb-4"},/*#__PURE__*/React.createElement("div",{className:"p-2 rounded-lg bg-blue-500/20"},/*#__PURE__*/React.createElement(Icons.Clock,{className:"text-blue-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white"},t('scheduleUpdates')||'Schedule Automatic Updates'),/*#__PURE__*/React.createElement("span",{className:"text-xs bg-yellow-500/20 text-yellow-400 px-2 py-0.5 rounded"},t('experimental')||'EXPERIMENTAL'))),/*#__PURE__*/React.createElement("div",{className:"mb-4 p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"text-yellow-400 mt-0.5 flex-shrink-0"}),/*#__PURE__*/React.createElement("div",{className:"text-sm text-yellow-300"},t('experimentalWarning')||'Use with caution - this feature is currently experimental. Test in non-production environments first.'))),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center justify-between p-3 bg-proxmox-dark rounded-lg cursor-pointer"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-white font-medium"},t('enableAutoUpdate')||'Enable Automatic Updates'),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},t('autoUpdateDesc')||'Automatically run rolling updates on schedule')),/*#__PURE__*/React.createElement("div",{className:`w-12 h-6 rounded-full p-1 transition-colors cursor-pointer ${scheduleEnabled?'bg-green-500':'bg-proxmox-border'}`,onClick:()=>setScheduleEnabled(!scheduleEnabled)},/*#__PURE__*/React.createElement("div",{className:`w-4 h-4 rounded-full bg-white transition-transform ${scheduleEnabled?'translate-x-6':'translate-x-0'}`}))),scheduleEnabled&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-xs text-gray-400 block mb-1"},t('scheduleType')||'Schedule Type'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setScheduleType('once'),className:`p-3 rounded-lg border text-sm font-medium transition-colors ${scheduleType==='once'?'bg-proxmox-orange/20 border-proxmox-orange text-proxmox-orange':'bg-proxmox-dark border-proxmox-border text-gray-400 hover:border-gray-500'}`},t('runOnce')||'Run Once'),/*#__PURE__*/React.createElement("button",{onClick:()=>setScheduleType('recurring'),className:`p-3 rounded-lg border text-sm font-medium transition-colors ${scheduleType==='recurring'?'bg-proxmox-orange/20 border-proxmox-orange text-proxmox-orange':'bg-proxmox-dark border-proxmox-border text-gray-400 hover:border-gray-500'}`},t('recurring')||'Recurring'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-xs text-gray-400 block mb-1"},t('updateDay')||'Update Day'),/*#__PURE__*/React.createElement("select",{value:scheduleDay,onChange:e=>setScheduleDay(e.target.value),className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg px-3 py-2 text-white"},/*#__PURE__*/React.createElement("option",{value:"monday"},t('monday')||'Monday'),/*#__PURE__*/React.createElement("option",{value:"tuesday"},t('tuesday')||'Tuesday'),/*#__PURE__*/React.createElement("option",{value:"wednesday"},t('wednesday')||'Wednesday'),/*#__PURE__*/React.createElement("option",{value:"thursday"},t('thursday')||'Thursday'),/*#__PURE__*/React.createElement("option",{value:"friday"},t('friday')||'Friday'),/*#__PURE__*/React.createElement("option",{value:"saturday"},t('saturday')||'Saturday'),/*#__PURE__*/React.createElement("option",{value:"sunday"},t('sunday')||'Sunday'),scheduleType==='recurring'&&/*#__PURE__*/React.createElement("option",{value:"daily"},t('daily')||'Daily'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-xs text-gray-400 block mb-1"},t('updateTime')||'Update Time'),/*#__PURE__*/React.createElement("input",{type:"time",value:scheduleTime,onChange:e=>setScheduleTime(e.target.value),className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg px-3 py-2 text-white"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('serverTimezone')||'Server timezone')),/*#__PURE__*/React.createElement("div",{className:"space-y-2 pt-2 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:scheduleReboot,onChange:e=>setScheduleReboot(e.target.checked),className:"rounded bg-proxmox-darker border-proxmox-border text-proxmox-orange focus:ring-proxmox-orange"}),/*#__PURE__*/React.createElement("span",{className:"text-white text-sm"},t('includeReboot')||'Include reboot after update')),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:scheduleSkipEvacuation,onChange:e=>setScheduleSkipEvacuation(e.target.checked),className:"rounded bg-proxmox-darker border-proxmox-border text-red-500 focus:ring-red-500"}),/*#__PURE__*/React.createElement("span",{className:"text-red-400 text-sm"},t('skipEvacuation')||'Skip VM evacuation'),/*#__PURE__*/React.createElement("span",{className:"text-xs bg-red-900/30 text-red-400 px-1.5 py-0.5 rounded"},t('notRecommended')||'NOT RECOMMENDED')),/*#__PURE__*/React.createElement("button",{onClick:()=>setScheduleShowAdvanced(!scheduleShowAdvanced),className:"text-xs text-gray-500 hover:text-gray-300 flex items-center gap-1 mt-1"},/*#__PURE__*/React.createElement(Icons.ChevronRight,{className:`w-3 h-3 transition-transform ${scheduleShowAdvanced?'rotate-90':''}`}),t('advancedOptions')||'Advanced Options'),scheduleShowAdvanced&&/*#__PURE__*/React.createElement("div",{className:"ml-4 space-y-3 p-3 bg-proxmox-darker rounded-lg"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:scheduleWaitForReboot,onChange:e=>setScheduleWaitForReboot(e.target.checked),className:"w-4 h-4 rounded border-proxmox-border bg-proxmox-dark text-proxmox-orange focus:ring-proxmox-orange",disabled:!scheduleReboot}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-white text-sm"},"Wait for node to come back online"),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},"Prevents migrating VMs to a still-rebooting node"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-xs text-gray-400 block mb-1"},t('evacuationTimeout')||'Evacuation Timeout'),/*#__PURE__*/React.createElement("select",{value:scheduleEvacTimeout,onChange:e=>setScheduleEvacTimeout(parseInt(e.target.value)),className:"w-full bg-proxmox-dark border border-proxmox-border rounded px-3 py-1.5 text-sm text-white",disabled:scheduleSkipEvacuation},/*#__PURE__*/React.createElement("option",{value:300},"5 ",t('minutes')||'min'),/*#__PURE__*/React.createElement("option",{value:600},"10 ",t('minutes')||'min'),/*#__PURE__*/React.createElement("option",{value:1200},"20 ",t('minutes')||'min'),/*#__PURE__*/React.createElement("option",{value:1800},"30 ",t('minutes')||'min'," (",t('default')||'default',")"),/*#__PURE__*/React.createElement("option",{value:3600},"1 ",t('hour')||'hour'),/*#__PURE__*/React.createElement("option",{value:7200},"2 ",t('hours')||'hours'))),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 flex items-start gap-1.5"},/*#__PURE__*/React.createElement(Icons.Info,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),/*#__PURE__*/React.createElement("span",null,"Scheduled updates cannot pause for user input. If VMs fail to migrate, the node will be skipped and the update continues with the next node.")))),/*#__PURE__*/React.createElement("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-3 text-sm"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-2"},/*#__PURE__*/React.createElement(Icons.Info,{className:"text-blue-400 mt-0.5 flex-shrink-0"}),/*#__PURE__*/React.createElement("div",{className:"text-blue-300"},scheduleType==='once'?t('runOnceInfo')||'The update will run once at the scheduled time and then disable itself.':t('autoUpdateInfo')||'Nodes will be updated one by one. VMs will be automatically migrated during maintenance. Up-to-date nodes are skipped.'))))),/*#__PURE__*/React.createElement("div",{className:"flex gap-3 justify-end mt-6"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowScheduleModal(false),className:"px-4 py-2 bg-proxmox-dark text-gray-300 rounded-lg hover:bg-proxmox-hover transition-colors"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:saveUpdateSchedule,disabled:scheduleSaving,className:"px-4 py-2 bg-proxmox-orange text-white rounded-lg hover:bg-orange-600 transition-colors disabled:opacity-50 flex items-center gap-2"},scheduleSaving&&/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"animate-spin"}),t('save'))))));}// SMBIOS Auto-Config Section Component
// LW: this whole feature started because Windows kept complaining about hardware changes after migrations
function SmbiosAutoConfigSection({clusterId,selectedCluster,updateConfig,addToast}){const{t}=useTranslation();const{getAuthHeaders}=useAuth();const[smbiosStatus,setSmbiosStatus]=useState({});const[smbiosLoading,setSmbiosLoading]=useState(false);const[smbiosActionLoading,setSmbiosActionLoading]=useState({});// per-node loading state
// Local authFetch for this component - NS Jan 2026
const authFetch=(url,opts={})=>fetch(url,{...opts,credentials:'include',headers:{...opts.headers,...getAuthHeaders()}});// Load status for all nodes - chatgpt suggested polling but thats overkill imo
const loadSmbiosStatus=async()=>{if(!clusterId)return;setSmbiosLoading(true);try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/smbios-autoconfig/status-all`);if(res&&res.ok){const data=await res.json();setSmbiosStatus(data||{});}}catch(e){console.error('Error loading SMBIOS status:',e);}setSmbiosLoading(false);};// Load status on mount
useEffect(()=>{if(clusterId){loadSmbiosStatus();}},[clusterId]);// Control service (start/stop/restart)
const controlService=async(node,action)=>{setSmbiosActionLoading(prev=>({...prev,[node]:action}));try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/smbios-autoconfig/control`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action})});const result=await res.json();if(result.success){addToast(result.message,'success');await loadSmbiosStatus();}else{addToast(result.error||'Action failed','error');}}catch(e){addToast('Error: '+e.message,'error');}setSmbiosActionLoading(prev=>({...prev,[node]:null}));};// Remove from node
const removeFromNode=async node=>{if(!confirm(`Remove SMBIOS Auto-Config from ${node}?`))return;setSmbiosActionLoading(prev=>({...prev,[node]:'remove'}));try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/smbios-autoconfig`,{method:'DELETE'});const result=await res.json();if(result.success){addToast(result.message,'success');await loadSmbiosStatus();}else{addToast(result.error||'Remove failed','error');}}catch(e){addToast('Error: '+e.message,'error');}setSmbiosActionLoading(prev=>({...prev,[node]:null}));};// Deploy to all nodes
const deployToAll=async()=>{if(!confirm(t('deploySmbiosConfirm')||'Deploy SMBIOS Auto-Config to all nodes?'))return;setSmbiosLoading(true);try{// Save config first
await authFetch(`${API_URL}/clusters/${clusterId}/smbios-autoconfig`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({manufacturer:selectedCluster?.smbios_manufacturer||'Proxmox',product:selectedCluster?.smbios_product||'PegaProxManagment',version:selectedCluster?.smbios_version||'v1',family:selectedCluster?.smbios_family||'ProxmoxVE'})});// Deploy
const res=await authFetch(`${API_URL}/clusters/${clusterId}/smbios-autoconfig/deploy-all`,{method:'POST'});const result=await res.json();if(result.success){addToast(result.message,'success');if(updateConfig)updateConfig('smbios_enabled',true);await loadSmbiosStatus();}else{addToast(result.error||'Deploy failed','error');}}catch(e){addToast('Error: '+e.message,'error');}setSmbiosLoading(false);};// Count running nodes
const nodeCount=Object.keys(smbiosStatus).length;const runningCount=Object.values(smbiosStatus).filter(s=>s.running).length;const installedCount=Object.values(smbiosStatus).filter(s=>s.installed).length;return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-4"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Cpu,{className:"w-5 h-5"}),"SMBIOS Auto-Configurator"),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:loadSmbiosStatus,disabled:smbiosLoading,className:"p-1.5 rounded-lg hover:bg-proxmox-dark text-gray-400 hover:text-white transition-colors",title:t('refresh')||'Refresh'},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:`w-4 h-4 ${smbiosLoading?'animate-spin':''}`})),nodeCount>0&&/*#__PURE__*/React.createElement("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${runningCount===nodeCount&&runningCount>0?'bg-green-500/20 text-green-400':runningCount>0?'bg-yellow-500/20 text-yellow-400':installedCount>0?'bg-orange-500/20 text-orange-400':'bg-gray-500/20 text-gray-400'}`},runningCount,"/",nodeCount," ",t('running')||'running'))),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mb-4"},t('smbiosAutoDesc')||'Automatically configures SMBIOS data (Manufacturer, Product, Serial) for new VMs and VMs without SMBIOS configuration. Useful for Windows licensing.'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4 mb-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Manufacturer"),/*#__PURE__*/React.createElement("input",{type:"text",value:selectedCluster?.smbios_manufacturer||'Proxmox',onChange:e=>updateConfig&&updateConfig('smbios_manufacturer',e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Product"),/*#__PURE__*/React.createElement("input",{type:"text",value:selectedCluster?.smbios_product||'PegaProxManagment',onChange:e=>updateConfig&&updateConfig('smbios_product',e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Version"),/*#__PURE__*/React.createElement("input",{type:"text",value:selectedCluster?.smbios_version||'v1',onChange:e=>updateConfig&&updateConfig('smbios_version',e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Family"),/*#__PURE__*/React.createElement("input",{type:"text",value:selectedCluster?.smbios_family||'ProxmoxVE',onChange:e=>updateConfig&&updateConfig('smbios_family',e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"}))),/*#__PURE__*/React.createElement("div",{className:"flex gap-3 mb-4"},/*#__PURE__*/React.createElement("button",{onClick:deployToAll,disabled:smbiosLoading,className:"flex items-center gap-2 px-4 py-2 bg-green-600 rounded-lg text-white text-sm font-medium hover:bg-green-500 transition-colors disabled:opacity-50"},smbiosLoading?/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-4 h-4 animate-spin"}):/*#__PURE__*/React.createElement(Icons.Download,{className:"w-4 h-4"}),installedCount>0?t('updateAllNodes')||'Update All Nodes':t('deployToAllNodes')||'Deploy to All Nodes')),nodeCount>0&&/*#__PURE__*/React.createElement("div",{className:"space-y-2"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 font-medium"},t('nodeStatus')||'Node Status',":"),Object.entries(smbiosStatus).map(([nodeName,status])=>/*#__PURE__*/React.createElement("div",{key:nodeName,className:"bg-proxmox-dark rounded-lg border border-proxmox-border overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between p-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:`w-2 h-2 rounded-full ${status.running?'bg-green-500':status.installed?'bg-yellow-500':'bg-gray-500'}`}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-white font-medium"},nodeName),/*#__PURE__*/React.createElement("span",{className:`text-xs px-2 py-0.5 rounded ${status.running?'bg-green-500/20 text-green-400':status.installed?'bg-yellow-500/20 text-yellow-400':'bg-gray-500/20 text-gray-400'}`},status.running?t('running')||'Running':status.installed?t('stopped')||'Stopped':t('notInstalled')||'Not Installed'),status.error&&/*#__PURE__*/React.createElement("span",{className:"text-xs text-red-400"},status.error)),status.installed&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1"},status.running?/*#__PURE__*/React.createElement("button",{onClick:()=>controlService(nodeName,'stop'),disabled:smbiosActionLoading[nodeName],className:"p-1.5 rounded hover:bg-red-500/20 text-gray-400 hover:text-red-400 transition-colors disabled:opacity-50",title:t('stop')||'Stop'},smbiosActionLoading[nodeName]==='stop'?/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-4 h-4 animate-spin"}):/*#__PURE__*/React.createElement(Icons.Square,{className:"w-4 h-4"})):/*#__PURE__*/React.createElement("button",{onClick:()=>controlService(nodeName,'start'),disabled:smbiosActionLoading[nodeName],className:"p-1.5 rounded hover:bg-green-500/20 text-gray-400 hover:text-green-400 transition-colors disabled:opacity-50",title:t('start')||'Start'},smbiosActionLoading[nodeName]==='start'?/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-4 h-4 animate-spin"}):/*#__PURE__*/React.createElement(Icons.Play,{className:"w-4 h-4"})),/*#__PURE__*/React.createElement("button",{onClick:()=>controlService(nodeName,'restart'),disabled:smbiosActionLoading[nodeName],className:"p-1.5 rounded hover:bg-orange-500/20 text-gray-400 hover:text-orange-400 transition-colors disabled:opacity-50",title:t('restart')||'Restart'},smbiosActionLoading[nodeName]==='restart'?/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-4 h-4 animate-spin"}):/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-4 h-4"})),/*#__PURE__*/React.createElement("button",{onClick:()=>controlService(nodeName,'rescan'),disabled:smbiosActionLoading[nodeName],className:"p-1.5 rounded hover:bg-blue-500/20 text-gray-400 hover:text-blue-400 transition-colors disabled:opacity-50",title:t('rescanAllVms')||'Rescan all VMs'},smbiosActionLoading[nodeName]==='rescan'?/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-4 h-4 animate-spin"}):/*#__PURE__*/React.createElement(Icons.Search,{className:"w-4 h-4"})),/*#__PURE__*/React.createElement("button",{onClick:()=>removeFromNode(nodeName),disabled:smbiosActionLoading[nodeName],className:"p-1.5 rounded hover:bg-red-500/20 text-gray-400 hover:text-red-400 transition-colors disabled:opacity-50",title:t('remove')||'Remove'},smbiosActionLoading[nodeName]==='remove'?/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-4 h-4 animate-spin"}):/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-4 h-4"})))),status.logs&&status.logs!=='No logs yet'&&/*#__PURE__*/React.createElement("div",{className:"px-3 pb-3 pt-0"},/*#__PURE__*/React.createElement("details",{className:"text-xs"},/*#__PURE__*/React.createElement("summary",{className:"cursor-pointer text-gray-500 hover:text-gray-400"},t('showLogs')||'Show logs'),/*#__PURE__*/React.createElement("pre",{className:"mt-2 p-2 bg-black/50 rounded text-[10px] text-gray-400 overflow-x-auto max-h-32 overflow-y-auto font-mono whitespace-pre-wrap"},status.logs)))))),nodeCount===0&&!smbiosLoading&&/*#__PURE__*/React.createElement("div",{className:"text-center py-4 text-gray-500 text-sm"},t('clickDeployToStart')||'Click "Deploy to All Nodes" to get started'));}// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PegaProx - Storage
// DatastoreTab with storage cluster balancing
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Datastore Tab Component - with Storage Clusters for balancing
function DatastoreTab({clusterId,addToast}){const{t}=useTranslation();const{getAuthHeaders,isAdmin}=useAuth();const[loading,setLoading]=useState(true);const[datastores,setDatastores]=useState({shared:[],local:{},nodes:[]});const[selectedStorage,setSelectedStorage]=useState(null);const[storageContent,setStorageContent]=useState([]);const[contentLoading,setContentLoading]=useState(false);const[expandedNodes,setExpandedNodes]=useState({});const[activeTab,setActiveTab]=useState('browse');// browse, balancing
const[uploadModalOpen,setUploadModalOpen]=useState(false);const[uploadFile,setUploadFile]=useState(null);const[uploading,setUploading]=useState(false);const[uploadProgress,setUploadProgress]=useState(0);const[uploadSpeed,setUploadSpeed]=useState(0);const[deleteConfirm,setDeleteConfirm]=useState(null);const[isRefreshing,setIsRefreshing]=useState(false);// not used
const lastFetchTime=useRef(0);// for rate limiting, not implemented
// NS: URL Download state - Jan 2026
const[downloadUrlModalOpen,setDownloadUrlModalOpen]=useState(false);const[downloadUrl,setDownloadUrl]=useState('');const[downloadFilename,setDownloadFilename]=useState('');const[urlDownloading,setUrlDownloading]=useState(false);const[urlDownloadProgress,setUrlDownloadProgress]=useState(null);// NS: Template download state - Jan 2026
const[showTemplateModal,setShowTemplateModal]=useState(false);const[availableTemplates,setAvailableTemplates]=useState([]);const[templatesLoading,setTemplatesLoading]=useState(false);const[templateFilter,setTemplateFilter]=useState('');const[downloadingTemplate,setDownloadingTemplate]=useState(null);// MK: Storage Rescan modal state - Feb 2026
const[showRescanModal,setShowRescanModal]=useState(false);const[rescanLoading,setRescanLoading]=useState(false);// Refs to prevent unnecessary re-renders and track state
const datastoresRef=useRef(null);const fetchingRef=useRef(false);const initialLoadDone=useRef(false);const _mountedRef=useRef(true);// cleanup
// Storage Clusters state
const[storageClusters,setStorageClusters]=useState([]);const[selectedCluster,setSelectedCluster]=useState(null);const[clusterStatus,setClusterStatus]=useState(null);const[showCreateCluster,setShowCreateCluster]=useState(false);const[newClusterName,setNewClusterName]=useState('');const[newClusterStorages,setNewClusterStorages]=useState([]);const[newClusterThreshold,setNewClusterThreshold]=useState(20);const[balancingLoading,setBalancingLoading]=useState(false);// NS: ESXi Integration state - Dec 2025
const[esxiHosts,setEsxiHosts]=useState([]);const[showAddEsxi,setShowAddEsxi]=useState(false);const[esxiForm,setEsxiForm]=useState({host:'',username:'root',password:''});const[esxiLoading,setEsxiLoading]=useState(false);const[selectedEsxi,setSelectedEsxi]=useState(null);const[esxiVms,setEsxiVms]=useState([]);const[esxiVmsLoading,setEsxiVmsLoading]=useState(false);// Debounce timer for threshold updates
const thresholdTimer=useRef(null);/* LW: wrapped fetch with auth headers + error handling
               returns null on failure so you can do: if(!res) return; */const authFetch=async(url,opts={})=>{try{const res=await fetch(url,{...opts,credentials:'include',headers:{...opts.headers,...getAuthHeaders()}});return res;}catch(e){console.error('fetch failed:',e);return null;}};// old helper, keeping for now
const _authFetchOld=async(url,options)=>{return fetch(url,{...options,headers:{...options?.headers,...getAuthHeaders()}}).catch(err=>{console.error(err);return null;});};// NS: Load available templates from Proxmox repository
const loadAvailableTemplates=async()=>{setTemplatesLoading(true);try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/templates/available`);if(res?.ok){const data=await res.json();setAvailableTemplates(data||[]);}else{console.error('Failed to load templates');}}catch(e){console.error('Error loading templates:',e);}setTemplatesLoading(false);};// NS: Download template to storage
const downloadTemplate=async(template,storage)=>{setDownloadingTemplate(template.template);try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/templates/download`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({storage:storage,template:template.template})});if(res?.ok){const data=await res.json();addToast(`${t('downloadStarted')||'Download started'}: ${template.package||template.template}`,'success');// Refresh storage content after a short delay
setTimeout(()=>{if(selectedStorage?.name===storage){loadStorageContent(storage,selectedStorage.node);}},2000);}else{const err=await res.json();addToast(`${t('downloadFailed')||'Download failed'}: ${err.error||'Unknown error'}`,'error');}}catch(e){console.error('Error downloading template:',e);addToast(`${t('error')||'Error'}: ${e.message}`,'error');}setDownloadingTemplate(null);};// Stable sort function - always sorts alphabetically
const stableSortData=data=>{if(!data)return data;// sort shared alphabeticaly
const sortedShared=[...(data.shared||[])].sort((a,b)=>(a.storage||'').localeCompare(b.storage||''));// sort nodes  
const sortedNodes=[...(data.nodes||[])].sort((a,b)=>a.localeCompare(b));// sort local per node
const sortedLocal={};for(const node of sortedNodes){if(data.local&&data.local[node]){sortedLocal[node]=[...data.local[node]].sort((a,b)=>(a.storage||'').localeCompare(b.storage||''));}}return{shared:sortedShared,local:sortedLocal,nodes:sortedNodes};};useEffect(()=>{// LW: Reset ALL cluster-specific state when cluster changes
// This prevents showing stale data from previous cluster
setSelectedStorage(null);setStorageContent([]);setStorageClusters([]);// NS: also reset storage clusters
setSelectedCluster(null);setClusterStatus(null);setEsxiHosts([]);// NS: reset ESXi hosts too
setSelectedEsxi(null);setEsxiVms([]);// Reset refs
initialLoadDone.current=false;// Allow loading spinner again
datastoresRef.current=null;// Clear cached data
fetchingRef.current=false;// Reset fetch lock
fetchDatastores();fetchStorageClusters();},[clusterId]);const fetchDatastores=async()=>{// prevent concurrent fetches
if(fetchingRef.current)return;fetchingRef.current=true;// Only show loading spinner on initial load
if(!initialLoadDone.current){setLoading(true);}try{const resp=await authFetch(`${API_URL}/clusters/${clusterId}/datastores`);if(resp&&resp.ok){const rawData=await resp.json();// console.log('datastores raw:', rawData);
// Apply stable sorting
const data=stableSortData(rawData);// Create a comparable string (only compare essential data, not usage which changes)
// ns: this is kinda hacky but prevents flickering
const getEssentialData=d=>({shared:d.shared?.map(s=>s.storage).sort(),nodes:d.nodes?.sort(),localKeys:Object.keys(d.local||{}).sort()});const currentEssential=JSON.stringify(getEssentialData(data));const prevEssential=datastoresRef.current?JSON.stringify(getEssentialData(datastoresRef.current)):null;// Only update if structure changed (not just usage percentages)
if(currentEssential!==prevEssential||!initialLoadDone.current){datastoresRef.current=data;setDatastores(data);// Only set expanded nodes on first load
if(!initialLoadDone.current){const expanded={shared:true};data.nodes?.forEach(n=>expanded[n]=true);setExpandedNodes(expanded);}}else{// update usage data without triggering re-render of structure
datastoresRef.current=data;setDatastores(data);// prev => data
}initialLoadDone.current=true;}}catch(err){console.error('fetching datastores:',err);}finally{setLoading(false);fetchingRef.current=false;}};// storage clusters (ceph etc)
const fetchStorageClusters=async()=>{try{const r=await authFetch(`${API_URL}/clusters/${clusterId}/storage-clusters`);if(r?.ok){setStorageClusters(await r.json());}}catch(e){console.error('fetching storage clusters:',e);}};const loadClusterStatus=async scId=>{setBalancingLoading(true);try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/storage-clusters/${scId}/status`);if(response&&response.ok){setClusterStatus(await response.json());}}catch(error){console.error('loading cluster status:',error);}finally{setBalancingLoading(false);}};const createStorageCluster=async()=>{if(!newClusterName.trim()||newClusterStorages.length<2){alert(t('needTwoStorages')||'Need at least 2 storages');return;}try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/storage-clusters`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name:newClusterName,storages:newClusterStorages,threshold:newClusterThreshold})});if(response&&response.ok){setShowCreateCluster(false);setNewClusterName('');setNewClusterStorages([]);setNewClusterThreshold(20);fetchStorageClusters();}else{const err=await response.json();alert(err.error||'Failed to create');}}catch(error){console.error('creating storage cluster:',error);}};const updateClusterThreshold=(scId,threshold)=>{// update local state immediately
setStorageClusters(prev=>prev.map(sc=>sc.id===scId?{...sc,threshold}:sc));if(clusterStatus?.id===scId){setClusterStatus(prev=>prev?{...prev,threshold}:null);}// Debounce API call
if(thresholdTimer.current)clearTimeout(thresholdTimer.current);thresholdTimer.current=setTimeout(async()=>{try{await authFetch(`${API_URL}/clusters/${clusterId}/storage-clusters/${scId}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({threshold})});}catch(error){console.error('updating threshold:',error);}},500);};const toggleClusterEnabled=async(scId,enabled)=>{try{await authFetch(`${API_URL}/clusters/${clusterId}/storage-clusters/${scId}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({enabled})});setStorageClusters(prev=>prev.map(sc=>sc.id===scId?{...sc,enabled}:sc));}catch(error){console.error('toggling cluster:',error);}};const toggleAutoBalance=async(scId,auto_balance)=>{try{await authFetch(`${API_URL}/clusters/${clusterId}/storage-clusters/${scId}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({auto_balance})});setStorageClusters(prev=>prev.map(sc=>sc.id===scId?{...sc,auto_balance}:sc));}catch(error){console.error('toggling auto-balance:',error);}};const deleteStorageCluster=async scId=>{if(!confirm(t('confirmDeleteCluster')||'Delete this storage cluster?'))return;try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/storage-clusters/${scId}`,{method:'DELETE'});if(response&&response.ok){setStorageClusters(prev=>prev.filter(sc=>sc.id!==scId));if(selectedCluster===scId){setSelectedCluster(null);setClusterStatus(null);}}}catch(error){console.error('deleting storage cluster:',error);}};const addStorageToCluster=async(scId,storageName)=>{const cluster=storageClusters.find(sc=>sc.id===scId);if(!cluster)return;const newStorages=[...cluster.storages,storageName];try{await authFetch(`${API_URL}/clusters/${clusterId}/storage-clusters/${scId}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({storages:newStorages})});fetchStorageClusters();if(selectedCluster===scId)loadClusterStatus(scId);}catch(error){console.error('adding storage:',error);}};const removeStorageFromCluster=async(scId,storageName)=>{const cluster=storageClusters.find(sc=>sc.id===scId);if(!cluster||cluster.storages.length<=2){alert(t('minTwoStorages')||'Minimum 2 storages required');return;}const newStorages=cluster.storages.filter(s=>s!==storageName);try{await authFetch(`${API_URL}/clusters/${clusterId}/storage-clusters/${scId}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({storages:newStorages})});fetchStorageClusters();if(selectedCluster===scId)loadClusterStatus(scId);}catch(error){console.error('removing storage:',error);}};const executeMigration=async rec=>{if(!confirm(`Move ${rec.disk} of ${rec.vm_name} from ${rec.source} to ${rec.target}?`))return;try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/storage-balancing/migrate`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({vmid:rec.vmid,disk:rec.disk,target:rec.target})});if(response&&response.ok){alert(t('migrationStarted')||'Migration started!');if(selectedCluster)loadClusterStatus(selectedCluster);}else{const err=await response.json();alert(err.error||'Migration failed');}}catch(error){console.error('executing migration:',error);}};const loadStorageContent=async(storageName,node)=>{setContentLoading(true);setSelectedStorage({name:storageName,node});try{const url=node?`${API_URL}/clusters/${clusterId}/datastores/${storageName}/content?node=${node}`:`${API_URL}/clusters/${clusterId}/datastores/${storageName}/content`;const response=await authFetch(url);if(response&&response.ok){setStorageContent(await response.json());}}catch(error){console.error('loading content:',error);}finally{setContentLoading(false);}};const handleDelete=async item=>{try{const url=`${API_URL}/clusters/${clusterId}/datastores/${selectedStorage.name}/content/${encodeURIComponent(item.volid)}?node=${selectedStorage.node||''}`;const response=await authFetch(url,{method:'DELETE'});if(response&&response.ok){setStorageContent(prev=>prev.filter(i=>i.volid!==item.volid));setDeleteConfirm(null);}else{const err=await response.json();alert(err.error||t('deleteFailed'));}}catch(error){console.error('deleting:',error);alert(t('deleteFailed'));}};const handleUpload=async()=>{if(!uploadFile||!selectedStorage)return;setUploading(true);setUploadProgress(0);setUploadSpeed(0);const formData=new FormData();formData.append('file',uploadFile);formData.append('content','iso');if(selectedStorage.node){formData.append('node',selectedStorage.node);}// Use XMLHttpRequest for progress tracking
const xhr=new XMLHttpRequest();const startTime=Date.now();let lastLoaded=0;let lastTime=startTime;xhr.upload.addEventListener('progress',e=>{if(e.lengthComputable){const percent=Math.round(e.loaded/e.total*100);setUploadProgress(percent);// calc speed
const now=Date.now();const timeDiff=(now-lastTime)/1000;// seconds
if(timeDiff>0.5){// update speed every 500ms
const bytesDiff=e.loaded-lastLoaded;const speed=bytesDiff/timeDiff;// bytes per second
setUploadSpeed(speed);lastLoaded=e.loaded;lastTime=now;}}});xhr.addEventListener('load',()=>{if(xhr.status>=200&&xhr.status<300){setUploadModalOpen(false);setUploadFile(null);setUploadProgress(0);setUploadSpeed(0);// refresh after delay
setTimeout(()=>loadStorageContent(selectedStorage.name,selectedStorage.node),2000);}else{try{const err=JSON.parse(xhr.responseText);alert(err.error||t('uploadFailed'));}catch{alert(t('uploadFailed'));}}setUploading(false);});xhr.addEventListener('error',()=>{console.error('Upload error');alert(t('uploadFailedNetwork'));setUploading(false);setUploadProgress(0);setUploadSpeed(0);});xhr.addEventListener('abort',()=>{setUploading(false);setUploadProgress(0);setUploadSpeed(0);});xhr.open('POST',`${API_URL}/clusters/${clusterId}/datastores/${selectedStorage.name}/upload`);// auth headers
const headers=getAuthHeaders();for(const[key,value]of Object.entries(headers)){xhr.setRequestHeader(key,value);}xhr.send(formData);};const formatSpeed=bytesPerSec=>{if(!bytesPerSec)return'0 B/s';const units=['B/s','KB/s','MB/s','GB/s'];let i=0;while(bytesPerSec>=1024&&i<units.length-1){bytesPerSec/=1024;i++;}return`${bytesPerSec.toFixed(1)} ${units[i]}`;};// NS: Download ISO from URL - Jan 2026 (like Proxmox)
const handleDownloadFromUrl=async()=>{if(!downloadUrl||!selectedStorage)return;// Extract filename from URL if not provided
let filename=downloadFilename.trim();if(!filename){try{const urlPath=new URL(downloadUrl).pathname;filename=urlPath.split('/').pop()||'download.iso';}catch{filename='download.iso';}}// Ensure .iso extension
if(!filename.toLowerCase().endsWith('.iso')&&!filename.toLowerCase().endsWith('.img')){filename+='.iso';}setUrlDownloading(true);setUrlDownloadProgress({status:'starting',percent:0,message:t('startingDownload')||'Starting download...'});try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/datastores/${selectedStorage.name}/download-url`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({url:downloadUrl,filename:filename,node:selectedStorage.node||''})});if(response&&response.ok){const data=await response.json();const taskId=data.task_id;// Poll for progress
const pollInterval=setInterval(async()=>{try{const statusResp=await authFetch(`${API_URL}/clusters/${clusterId}/datastores/${selectedStorage.name}/download-status/${taskId}`);if(statusResp&&statusResp.ok){const status=await statusResp.json();setUrlDownloadProgress(status);if(status.status==='completed'){clearInterval(pollInterval);setUrlDownloading(false);setDownloadUrlModalOpen(false);setDownloadUrl('');setDownloadFilename('');// Refresh content
setTimeout(()=>loadStorageContent(selectedStorage.name,selectedStorage.node),1000);}else if(status.status==='error'){clearInterval(pollInterval);setUrlDownloading(false);alert(status.message||t('downloadFailed')||'Download failed');}}}catch(e){console.error('Polling download status:',e);}},1000);// Cleanup after 30 min max
setTimeout(()=>clearInterval(pollInterval),30*60*1000);}else{const err=await response.json();alert(err.error||t('downloadFailed')||'Download failed');setUrlDownloading(false);}}catch(error){console.error('Download from URL error:',error);alert(t('downloadFailed')||'Download failed');setUrlDownloading(false);}};// NS: ESXi Integration functions - Dec 2025
const fetchEsxiHosts=async()=>{try{const r=await authFetch(`${API_URL}/clusters/${clusterId}/esxi-hosts`);if(r?.ok)setEsxiHosts(await r.json());}catch(e){console.error('fetching esxi hosts:',e);}};const connectEsxiHost=async()=>{if(!esxiForm.host||!esxiForm.password){alert(t('fillAllFields')||'Please fill all fields');return;}setEsxiLoading(true);try{const r=await authFetch(`${API_URL}/clusters/${clusterId}/esxi-hosts`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(esxiForm)});if(r?.ok){setShowAddEsxi(false);setEsxiForm({host:'',username:'root',password:''});fetchEsxiHosts();}else{const err=await r.json();alert(err.error||t('connectionFailed'));}}catch(e){alert(t('connectionFailed'));}finally{setEsxiLoading(false);}};const disconnectEsxiHost=async hostId=>{if(!confirm(t('confirmDisconnect')||'Disconnect this ESXi host?'))return;try{const r=await authFetch(`${API_URL}/clusters/${clusterId}/esxi-hosts/${hostId}`,{method:'DELETE'});if(r?.ok){setEsxiHosts(prev=>prev.filter(h=>h.id!==hostId));if(selectedEsxi===hostId){setSelectedEsxi(null);setEsxiVms([]);}}}catch(e){console.error('disconnecting esxi:',e);}};const fetchEsxiVms=async hostId=>{setSelectedEsxi(hostId);setEsxiVmsLoading(true);try{const r=await authFetch(`${API_URL}/clusters/${clusterId}/esxi-hosts/${hostId}/vms`);if(r?.ok)setEsxiVms(await r.json());}catch(e){console.error('fetching esxi vms:',e);}finally{setEsxiVmsLoading(false);}};// NS: ESXi VMs should be migrated via VMware Migration Wizard (Tasks tab)
// The native Proxmox import was removed - our wizard handles hardware detection better
// load esxi hosts on mount
useEffect(()=>{fetchEsxiHosts();},[clusterId]);const toggleNode=nodeKey=>{setExpandedNodes(prev=>({...prev,[nodeKey]:!prev[nodeKey]}));};const formatSize=bytes=>{if(!bytes)return'0 B';const units=['B','KB','MB','GB','TB'];let i=0;while(bytes>=1024&&i<units.length-1){bytes/=1024;i++;}return`${bytes.toFixed(1)} ${units[i]}`;};const getContentIcon=content=>{if(content?.includes('iso'))return'ðŸ’¿';if(content?.includes('images')||content?.includes('rootdir'))return'ðŸ’¾';if(content?.includes('backup'))return'ðŸ“¦';if(content?.includes('vztmpl'))return'ðŸ“‹';return'ðŸ“';};const getTypeColor=type=>{const colors={'zfspool':'text-blue-400','lvmthin':'text-purple-400','lvm':'text-purple-400','dir':'text-green-400','nfs':'text-yellow-400','cifs':'text-yellow-400','cephfs':'text-red-400','rbd':'text-red-400'};return colors[type]||'text-gray-400';};const canUploadTo=storage=>{return storage?.content?.includes('iso')||storage?.content?.includes('vztmpl');};if(loading){return/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center py-12"},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"animate-spin"}),/*#__PURE__*/React.createElement("span",{className:"ml-2"},t('loading')));}const StorageRow=({storage,node,isShared})=>{const usedPercent=storage.total?storage.used/storage.total*100:0;const isSelected=selectedStorage?.name===storage.storage&&selectedStorage?.node===node;return/*#__PURE__*/React.createElement("div",{className:`flex items-center justify-between p-3 rounded-lg cursor-pointer transition-all ${isSelected?'bg-proxmox-orange/20 border border-proxmox-orange/50':'bg-proxmox-dark hover:bg-proxmox-hover'}`,onClick:()=>loadStorageContent(storage.storage,node)},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("span",{className:"text-lg"},getContentIcon(storage.content)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"font-medium text-white"},storage.storage),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},/*#__PURE__*/React.createElement("span",{className:getTypeColor(storage.type)},storage.type)))),/*#__PURE__*/React.createElement("div",{className:"text-right"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-white"},formatSize(storage.used)," / ",formatSize(storage.total)),/*#__PURE__*/React.createElement("div",{className:"w-24 h-1.5 bg-proxmox-border rounded-full mt-1"},/*#__PURE__*/React.createElement("div",{className:`h-full rounded-full ${usedPercent>90?'bg-red-500':usedPercent>70?'bg-yellow-500':'bg-green-500'}`,style:{width:`${Math.min(usedPercent,100)}%`}}))));};return/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setActiveTab('browse'),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${activeTab==='browse'?'bg-proxmox-orange text-white':'bg-proxmox-card text-gray-400 hover:text-white'}`},/*#__PURE__*/React.createElement(Icons.Folder,{className:"inline mr-2"}),t('browse')||'Browse'),/*#__PURE__*/React.createElement("button",{onClick:()=>{setActiveTab('balancing');fetchStorageClusters();},className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${activeTab==='balancing'?'bg-proxmox-orange text-white':'bg-proxmox-card text-gray-400 hover:text-white'}`},/*#__PURE__*/React.createElement(Icons.Zap,{className:"inline mr-2"}),"Storage Balancing")),activeTab==='browse'?/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6"},/*#__PURE__*/React.createElement("div",{className:"lg:col-span-1 bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border bg-proxmox-dark"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Database,null),t('datastores')||'Datastores')),/*#__PURE__*/React.createElement("div",{className:"p-4 space-y-4 max-h-[600px] overflow-y-auto"},datastores.shared?.length>0&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("button",{className:"flex items-center gap-2 w-full text-left p-2 rounded-lg hover:bg-proxmox-hover",onClick:()=>toggleNode('shared')},/*#__PURE__*/React.createElement("span",{className:`transform transition-transform ${expandedNodes.shared?'rotate-90':''}`},"\u25B6"),/*#__PURE__*/React.createElement(Icons.Globe,null),/*#__PURE__*/React.createElement("span",{className:"font-medium text-yellow-400"},t('sharedStorage')||'Shared Storage'),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 ml-auto"},datastores.shared.length)),expandedNodes.shared&&/*#__PURE__*/React.createElement("div",{className:"ml-6 mt-2 space-y-2"},datastores.shared.map(storage=>/*#__PURE__*/React.createElement(StorageRow,{key:storage.storage,storage:storage,isShared:true})))),datastores.nodes?.map(node=>/*#__PURE__*/React.createElement("div",{key:node},/*#__PURE__*/React.createElement("button",{className:"flex items-center gap-2 w-full text-left p-2 rounded-lg hover:bg-proxmox-hover",onClick:()=>toggleNode(node)},/*#__PURE__*/React.createElement("span",{className:`transform transition-transform ${expandedNodes[node]?'rotate-90':''}`},"\u25B6"),/*#__PURE__*/React.createElement(Icons.Server,null),/*#__PURE__*/React.createElement("span",{className:"font-medium"},node),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 ml-auto"},datastores.local[node]?.length||0)),expandedNodes[node]&&datastores.local[node]&&/*#__PURE__*/React.createElement("div",{className:"ml-6 mt-2 space-y-2"},datastores.local[node].map(storage=>/*#__PURE__*/React.createElement(StorageRow,{key:`${node}-${storage.storage}`,storage:storage,node:node}))))),/*#__PURE__*/React.createElement("div",{className:"mt-4 pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-2"},/*#__PURE__*/React.createElement("button",{className:"flex items-center gap-2 text-left p-2 rounded-lg hover:bg-proxmox-hover flex-1",onClick:()=>toggleNode('esxi')},/*#__PURE__*/React.createElement("span",{className:`transform transition-transform ${expandedNodes.esxi?'rotate-90':''}`},"\u25B6"),/*#__PURE__*/React.createElement("span",{className:"text-lg"},"\uD83D\uDDA5\uFE0F"),/*#__PURE__*/React.createElement("span",{className:"font-medium text-cyan-400"},t('esxiHosts')||'ESXi Hosts'),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 ml-auto"},esxiHosts.length)),isAdmin&&/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddEsxi(true),className:"p-1.5 hover:bg-proxmox-hover rounded-lg text-gray-400 hover:text-cyan-400",title:t('connectEsxi')||'Connect ESXi'},/*#__PURE__*/React.createElement(Icons.Plus,null))),expandedNodes.esxi&&/*#__PURE__*/React.createElement("div",{className:"ml-6 space-y-2"},esxiHosts.length===0?/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 py-2"},t('noEsxiHosts')||'No ESXi hosts connected'):esxiHosts.map(host=>/*#__PURE__*/React.createElement("div",{key:host.id,className:`flex items-center gap-2 p-2 rounded-lg cursor-pointer transition-colors ${selectedEsxi===host.id?'bg-cyan-500/20 border border-cyan-500/30':'hover:bg-proxmox-hover'}`,onClick:()=>fetchEsxiVms(host.id)},/*#__PURE__*/React.createElement("span",{className:`w-2 h-2 rounded-full ${host.connected?'bg-green-500':'bg-red-500'}`}),/*#__PURE__*/React.createElement("span",{className:"text-sm"},host.host),isAdmin&&/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();disconnectEsxiHost(host.id);},className:"ml-auto p-1 hover:bg-red-500/20 rounded text-gray-500 hover:text-red-400",title:t('esxiDisconnect')},/*#__PURE__*/React.createElement(Icons.X,{className:"w-3 h-3"})))))))),/*#__PURE__*/React.createElement("div",{className:"lg:col-span-2 bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},selectedEsxi?/*#__PURE__*//* LW: ESXi VMs Panel */React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border bg-proxmox-dark flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:"text-lg"},"\uD83D\uDDA5\uFE0F"),t('esxiVms')||'ESXi VMs',/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},"(",esxiHosts.find(h=>h.id===selectedEsxi)?.host,")")),/*#__PURE__*/React.createElement("button",{onClick:()=>{setSelectedEsxi(null);setEsxiVms([]);},className:"p-1.5 hover:bg-proxmox-hover rounded-lg text-gray-400"},/*#__PURE__*/React.createElement(Icons.X,null))),/*#__PURE__*/React.createElement("div",{className:"p-4"},/*#__PURE__*/React.createElement("div",{className:"p-2 bg-cyan-500/10 border border-cyan-500/30 rounded-lg mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement("span",null,"\uD83E\uDDEA"),/*#__PURE__*/React.createElement("span",{className:"text-xs text-cyan-400"},t('esxiExperimental')||'ESXi integration is experimental')),esxiVmsLoading?/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center py-12"},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"animate-spin"})):esxiVms.length===0?/*#__PURE__*/React.createElement("div",{className:"text-center py-12 text-gray-500"},/*#__PURE__*/React.createElement("p",null,t('esxiNoVms')||'No VMs on this ESXi host')):/*#__PURE__*/React.createElement("div",{className:"space-y-2"},esxiVms.map(vm=>/*#__PURE__*/React.createElement("div",{key:vm.id,className:"p-3 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("span",{className:"w-3 h-3 rounded-full bg-gray-500"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("p",{className:"font-medium text-white"},vm.name),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},vm.guest_os!=='Unknown'?`${vm.guest_os} â€¢ `:'',vm.num_cpu>0?`${vm.num_cpu} vCPU â€¢ `:'',vm.memory_mb>0?`${Math.round(vm.memory_mb/1024)} GB RAM`:''),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-600 font-mono truncate max-w-xs"},vm.volid||vm.id))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 italic"},t('useVMwareMigration')||'Use ESXi â†’ Migration Wizard')))))))):/*#__PURE__*//* Original Storage Content */React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border bg-proxmox-dark flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Folder,null),selectedStorage?/*#__PURE__*/React.createElement(React.Fragment,null,t('content')||'Content',": ",selectedStorage.name):t('selectStorage')||'Select a storage'),selectedStorage&&isAdmin&&/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},(()=>{const storage=datastores.shared.find(s=>s.storage===selectedStorage.name)||datastores.local[selectedStorage.node]?.find(s=>s.storage===selectedStorage.name);return storage?.content?.includes('vztmpl');})()&&/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowTemplateModal(true);loadAvailableTemplates();},className:"flex items-center gap-1 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm"},/*#__PURE__*/React.createElement(Icons.Download,null)," Templates"),(()=>{const storage=datastores.shared.find(s=>s.storage===selectedStorage.name)||datastores.local[selectedStorage.node]?.find(s=>s.storage===selectedStorage.name);return storage?.content?.includes('iso');})()&&/*#__PURE__*/React.createElement("button",{onClick:()=>setDownloadUrlModalOpen(true),className:"flex items-center gap-1 px-3 py-1.5 bg-green-600 hover:bg-green-700 rounded-lg text-sm",title:t('downloadFromUrl')||'Download from URL'},/*#__PURE__*/React.createElement(Icons.Link,null)," ",t('fromUrl')||'From URL'),canUploadTo(datastores.shared.find(s=>s.storage===selectedStorage.name)||datastores.local[selectedStorage.node]?.find(s=>s.storage===selectedStorage.name))&&/*#__PURE__*/React.createElement("button",{onClick:()=>setUploadModalOpen(true),className:"flex items-center gap-1 px-3 py-1.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm"},/*#__PURE__*/React.createElement(Icons.Upload,null)," ",t('upload')||'Upload'),(()=>{const storage=datastores.shared.find(s=>s.storage===selectedStorage.name)||datastores.local[selectedStorage.node]?.find(s=>s.storage===selectedStorage.name);return['iscsi','iscsidirect','lvm','lvmthin','zfspool','zfs'].includes(storage?.type);})()&&/*#__PURE__*/React.createElement("button",{onClick:()=>setShowRescanModal(true),className:"flex items-center gap-1 px-3 py-1.5 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm",title:t('rescanStorageTooltip')||'Rescan storage to detect new LUNs/volumes'},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-4 h-4"})," ",t('rescan')||'Rescan'),/*#__PURE__*/React.createElement("button",{onClick:()=>loadStorageContent(selectedStorage.name,selectedStorage.node),className:"p-1.5 hover:bg-proxmox-hover rounded-lg text-gray-400 hover:text-white"},/*#__PURE__*/React.createElement(Icons.RotateCw,null)))),/*#__PURE__*/React.createElement("div",{className:"p-4"},contentLoading?/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center py-12"},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"animate-spin"})):!selectedStorage?/*#__PURE__*/React.createElement("div",{className:"text-center py-12 text-gray-500"},/*#__PURE__*/React.createElement(Icons.Database,{className:"mx-auto mb-2 opacity-50"}),/*#__PURE__*/React.createElement("p",null,t('clickStorageToView')||'Click on a storage to view its contents')):storageContent.length===0?/*#__PURE__*/React.createElement("div",{className:"text-center py-12 text-gray-500"},/*#__PURE__*/React.createElement(Icons.Folder,{className:"mx-auto mb-2 opacity-50"}),/*#__PURE__*/React.createElement("p",null,t('storageEmpty')||'This storage is empty')):/*#__PURE__*/React.createElement("div",{className:"space-y-1 max-h-[500px] overflow-y-auto"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"sticky top-0 bg-proxmox-card"},/*#__PURE__*/React.createElement("tr",{className:"text-left text-xs text-gray-500 uppercase"},/*#__PURE__*/React.createElement("th",{className:"p-2"},t('name')||'Name'),/*#__PURE__*/React.createElement("th",{className:"p-2"},t('type')||'Type'),/*#__PURE__*/React.createElement("th",{className:"p-2"},t('format')||'Format'),/*#__PURE__*/React.createElement("th",{className:"p-2 text-right"},t('size')||'Size'),isAdmin&&/*#__PURE__*/React.createElement("th",{className:"p-2 w-10"}))),/*#__PURE__*/React.createElement("tbody",null,storageContent.map((item,idx)=>/*#__PURE__*/React.createElement("tr",{key:idx,className:"border-t border-proxmox-border hover:bg-proxmox-hover"},/*#__PURE__*/React.createElement("td",{className:"p-2"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",null,item.content==='iso'?'ðŸ’¿':item.content==='backup'?'ðŸ“¦':'ðŸ’¾'),/*#__PURE__*/React.createElement("span",{className:"font-mono text-sm truncate max-w-xs",title:item.volid},item.volid?.split('/').pop()||item.volid),item.vmid&&/*#__PURE__*/React.createElement("span",{className:"text-xs text-blue-400 bg-blue-500/10 px-1.5 py-0.5 rounded"},"VM ",item.vmid))),/*#__PURE__*/React.createElement("td",{className:"p-2 text-sm text-gray-400"},item.content),/*#__PURE__*/React.createElement("td",{className:"p-2 text-sm text-gray-400"},item.format||'-'),/*#__PURE__*/React.createElement("td",{className:"p-2 text-sm text-right"},item.size_human||formatSize(item.size)),isAdmin&&/*#__PURE__*/React.createElement("td",{className:"p-2"},(item.content==='backup'||!item.vmid&&(item.content==='iso'||item.content==='vztmpl'))&&/*#__PURE__*/React.createElement("button",{onClick:()=>setDeleteConfirm(item),className:"p-1 hover:bg-red-500/20 rounded text-gray-500 hover:text-red-400",title:t('delete')||'Delete'},/*#__PURE__*/React.createElement(Icons.Trash,null)))))))))))):/*#__PURE__*//* Storage Balancing Tab with Storage Clusters */React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6"},/*#__PURE__*/React.createElement("div",{className:"lg:col-span-3 p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-xl flex items-center gap-3"},/*#__PURE__*/React.createElement("span",{className:"text-2xl"},"\uD83E\uDDEA"),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("p",{className:"text-yellow-400 font-medium"},t('experimentalFeature')||'Experimental Feature'),/*#__PURE__*/React.createElement("p",{className:"text-yellow-300/70 text-sm"},t('storageBalancingExperimental')||'Storage Balancing is still experimental. We appreciate your feedback!'))),/*#__PURE__*/React.createElement("div",{className:"lg:col-span-1 bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border bg-proxmox-dark flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Zap,{className:"text-yellow-400"}),"Storage Clusters"),isAdmin&&/*#__PURE__*/React.createElement("button",{onClick:()=>setShowCreateCluster(true),className:"p-1.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg",title:t('createCluster')||'Create Cluster'},/*#__PURE__*/React.createElement(Icons.Plus,null))),/*#__PURE__*/React.createElement("div",{className:"p-4 space-y-3 max-h-[500px] overflow-y-auto"},storageClusters.length===0?/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},/*#__PURE__*/React.createElement(Icons.Database,{className:"mx-auto mb-2 opacity-50"}),/*#__PURE__*/React.createElement("p",null,t('noStorageClusters')||'No storage clusters configured'),/*#__PURE__*/React.createElement("p",{className:"text-xs mt-1"},t('createStorageClusterHint')||'Create a cluster to balance storage across multiple volumes')):storageClusters.map(sc=>/*#__PURE__*/React.createElement("div",{key:sc.id,className:`p-3 rounded-lg cursor-pointer transition-all ${selectedCluster===sc.id?'bg-proxmox-orange/20 border border-proxmox-orange/50':'bg-proxmox-dark hover:bg-proxmox-hover'}`,onClick:()=>{setSelectedCluster(sc.id);loadClusterStatus(sc.id);}},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:`w-2 h-2 rounded-full ${sc.enabled?'bg-green-500':'bg-gray-500'}`}),/*#__PURE__*/React.createElement("span",{className:"font-medium"},sc.name)),isAdmin&&/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();deleteStorageCluster(sc.id);},className:"p-1 hover:bg-red-500/20 rounded text-gray-500 hover:text-red-400"},/*#__PURE__*/React.createElement(Icons.Trash,null))),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mt-1"},sc.storages?.length||0," ",t('storages')||'storages'," \u2022 ",t('threshold'),": ",sc.threshold,"%"))))),/*#__PURE__*/React.createElement("div",{className:"lg:col-span-2 bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border bg-proxmox-dark"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},clusterStatus?clusterStatus.name:t('selectCluster')||'Select a storage cluster')),/*#__PURE__*/React.createElement("div",{className:"p-4"},balancingLoading?/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center py-12"},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"animate-spin"})):!clusterStatus?/*#__PURE__*/React.createElement("div",{className:"text-center py-12 text-gray-500"},/*#__PURE__*/React.createElement(Icons.Zap,{className:"mx-auto mb-2 opacity-50"}),/*#__PURE__*/React.createElement("p",null,t('selectClusterToView')||'Select a storage cluster to view balancing status')):/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between gap-4 p-4 bg-proxmox-dark rounded-lg flex-wrap"},/*#__PURE__*/React.createElement(Toggle,{checked:clusterStatus.enabled,onChange:v=>toggleClusterEnabled(clusterStatus.id,v),label:t('enabled')||'Enabled'}),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement(Toggle,{checked:storageClusters.find(sc=>sc.id===clusterStatus.id)?.auto_balance||false,onChange:v=>toggleAutoBalance(clusterStatus.id,v),label:t('autoBalance')||'Auto-Balance'}),/*#__PURE__*/React.createElement("button",{onClick:()=>loadClusterStatus(clusterStatus.id),className:"p-2 hover:bg-proxmox-hover rounded-lg text-gray-400 hover:text-white"},/*#__PURE__*/React.createElement(Icons.RotateCw,null)))),storageClusters.find(sc=>sc.id===clusterStatus.id)?.auto_balance&&/*#__PURE__*/React.createElement("div",{className:"p-4 bg-green-500/10 border border-green-500/30 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-green-400 mb-2"},/*#__PURE__*/React.createElement(Icons.Zap,null),/*#__PURE__*/React.createElement("span",{className:"font-medium"},t('autoBalanceActive')||'Auto-Balance Active')),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},t('autoBalanceDesc')||'Disks will be automatically migrated when imbalance exceeds threshold. VMs with active snapshots/backups are skipped.')),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement(Slider,{label:t('balancingThreshold')||'Balancing Threshold',description:t('thresholdDesc')||'Trigger balancing when imbalance exceeds this value',value:clusterStatus.threshold,onChange:v=>updateClusterThreshold(clusterStatus.id,v),min:5,max:50,step:5})),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4 p-4 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex-1"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400"},t('currentImbalance')||'Current Imbalance'),/*#__PURE__*/React.createElement("div",{className:`text-2xl font-bold ${clusterStatus.imbalance>clusterStatus.threshold?'text-yellow-400':'text-green-400'}`},clusterStatus.imbalance,"%")),/*#__PURE__*/React.createElement("div",{className:`px-4 py-2 rounded-lg ${clusterStatus.imbalance>clusterStatus.threshold?'bg-yellow-500/20 text-yellow-400':'bg-green-500/20 text-green-400'}`},clusterStatus.imbalance>clusterStatus.threshold?'âš ï¸ '+(t('actionRecommended')||'Action Recommended'):'âœ“ '+(t('balanced')||'Balanced'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-gray-400"},t('storagesInCluster')||'Storages in Cluster'),isAdmin&&datastores.shared?.length>(clusterStatus.storages?.length||0)&&/*#__PURE__*/React.createElement("select",{className:"px-2 py-1 bg-proxmox-dark border border-proxmox-border rounded text-sm",onChange:e=>{if(e.target.value){addStorageToCluster(clusterStatus.id,e.target.value);e.target.value='';}},defaultValue:""},/*#__PURE__*/React.createElement("option",{value:""},t('addStorage')||'+ Add Storage'),datastores.shared?.filter(s=>!clusterStatus.storages?.some(cs=>cs.storage===s.storage)).map(s=>/*#__PURE__*/React.createElement("option",{key:s.storage,value:s.storage},s.storage)))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3"},clusterStatus.storages?.map(storage=>/*#__PURE__*/React.createElement("div",{key:storage.storage,className:"p-3 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center mb-2"},/*#__PURE__*/React.createElement("span",{className:"font-medium"},storage.storage),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:`text-sm ${storage.usage_percent>90?'text-red-400':storage.usage_percent>70?'text-yellow-400':'text-green-400'}`},storage.usage_percent,"%"),isAdmin&&clusterStatus.storages.length>2&&/*#__PURE__*/React.createElement("button",{onClick:()=>removeStorageFromCluster(clusterStatus.id,storage.storage),className:"p-1 hover:bg-red-500/20 rounded text-gray-500 hover:text-red-400",title:t('remove')||'Remove'},/*#__PURE__*/React.createElement(Icons.X,null)))),/*#__PURE__*/React.createElement("div",{className:"w-full h-2 bg-proxmox-border rounded-full"},/*#__PURE__*/React.createElement("div",{className:`h-full rounded-full ${storage.usage_percent>90?'bg-red-500':storage.usage_percent>70?'bg-yellow-500':'bg-green-500'}`,style:{width:`${storage.usage_percent}%`}})),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mt-1"},formatSize(storage.used)," / ",formatSize(storage.total)))))),clusterStatus.recommendations?.length>0&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-gray-400 mb-3"},t('recommendations')||'Recommendations'),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},clusterStatus.recommendations.map((rec,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"flex items-center justify-between p-3 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:`p-2 rounded-lg ${rec.vm_status==='running'?'bg-green-500/20':'bg-gray-500/20'}`},/*#__PURE__*/React.createElement(Icons.HardDrive,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"font-medium"},rec.vm_name," ",/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"(",rec.disk,")")),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},rec.reason))),isAdmin&&/*#__PURE__*/React.createElement("button",{onClick:()=>executeMigration(rec),className:"px-3 py-1.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm"},t('migrate')||'Migrate'))))),clusterStatus.recommendations?.length===0&&clusterStatus.imbalance<=clusterStatus.threshold&&/*#__PURE__*/React.createElement("div",{className:"text-center py-6 text-gray-500"},/*#__PURE__*/React.createElement(Icons.Check,{className:"mx-auto mb-2 text-green-400"}),/*#__PURE__*/React.createElement("p",null,t('storageBalanced')||'Storage is well balanced. No action needed.')))))),showCreateCluster&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-6 w-full max-w-lg"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-4"},t('createStorageCluster')||'Create Storage Cluster'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('clusterName')||'Cluster Name'),/*#__PURE__*/React.createElement("input",{type:"text",value:newClusterName,onChange:e=>setNewClusterName(e.target.value),placeholder:"e.g. Production Storage",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('selectStorages')||'Select Storages'," (",t('minTwo')||'min. 2',")"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto p-2 bg-proxmox-dark rounded-lg"},datastores.shared?.map(storage=>/*#__PURE__*/React.createElement("label",{key:storage.storage,className:"flex items-center gap-2 p-2 hover:bg-proxmox-hover rounded cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newClusterStorages.includes(storage.storage),onChange:e=>{if(e.target.checked){setNewClusterStorages(prev=>[...prev,storage.storage]);}else{setNewClusterStorages(prev=>prev.filter(s=>s!==storage.storage));}},className:"rounded"}),/*#__PURE__*/React.createElement("span",null,storage.storage)))),datastores.shared?.length===0&&/*#__PURE__*/React.createElement("div",{className:"text-center py-4 text-gray-500 text-sm"},t('noSharedStorages')||'No shared storages available')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement(Slider,{label:t('balancingThreshold')||'Balancing Threshold',value:newClusterThreshold,onChange:setNewClusterThreshold,min:5,max:50,step:5})),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end pt-4"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowCreateCluster(false);setNewClusterName('');setNewClusterStorages([]);},className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover rounded-lg"},t('cancel')||'Cancel'),/*#__PURE__*/React.createElement("button",{onClick:createStorageCluster,disabled:!newClusterName.trim()||newClusterStorages.length<2,className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg disabled:opacity-50"},t('create')||'Create'))))),showTemplateModal&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-4xl max-h-[85vh] flex flex-col"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Download,null),t('downloadTemplates')||'Download Container Templates'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowTemplateModal(false),className:"p-1.5 hover:bg-proxmox-hover rounded-lg text-gray-400 hover:text-white"},/*#__PURE__*/React.createElement(Icons.X,null))),/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("input",{type:"text",placeholder:t('searchTemplates')||'Search templates...',value:templateFilter,onChange:e=>setTemplateFilter(e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white placeholder-gray-500"})),/*#__PURE__*/React.createElement("div",{className:"flex-1 overflow-y-auto p-4"},templatesLoading?/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center py-12"},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"animate-spin mr-2"}),"Loading templates..."):availableTemplates.length===0?/*#__PURE__*/React.createElement("div",{className:"text-center py-12 text-gray-500"},/*#__PURE__*/React.createElement(Icons.Package,{className:"mx-auto mb-2 opacity-50"}),/*#__PURE__*/React.createElement("p",null,t('noTemplatesAvailable')||'No templates available')):/*#__PURE__*/React.createElement("div",{className:"space-y-2"},Object.entries(availableTemplates.filter(t=>!templateFilter||t.package?.toLowerCase().includes(templateFilter.toLowerCase())||t.headline?.toLowerCase().includes(templateFilter.toLowerCase())||t.os?.toLowerCase().includes(templateFilter.toLowerCase())).reduce((acc,t)=>{const section=t.section||'Other';if(!acc[section])acc[section]=[];acc[section].push(t);return acc;},{})).map(([section,templates])=>/*#__PURE__*/React.createElement("div",{key:section,className:"mb-4"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-semibold text-gray-400 uppercase mb-2 sticky top-0 bg-proxmox-card py-1"},section," (",templates.length,")"),/*#__PURE__*/React.createElement("div",{className:"space-y-1"},templates.map((tmpl,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"flex items-center justify-between p-3 bg-proxmox-dark rounded-lg hover:bg-proxmox-hover group"},/*#__PURE__*/React.createElement("div",{className:"flex-1 min-w-0"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:"font-medium text-white truncate"},tmpl.package||tmpl.template),tmpl.version&&/*#__PURE__*/React.createElement("span",{className:"text-xs bg-blue-500/20 text-blue-400 px-1.5 py-0.5 rounded"},tmpl.version)),tmpl.headline&&/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 truncate"},tmpl.headline),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500"},tmpl.os&&/*#__PURE__*/React.createElement("span",null,"OS: ",tmpl.os),tmpl.infopage&&/*#__PURE__*/React.createElement("a",{href:tmpl.infopage,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline"},"Info"))),/*#__PURE__*/React.createElement("button",{onClick:()=>downloadTemplate(tmpl,selectedStorage.name),disabled:downloadingTemplate===tmpl.template,className:"flex items-center gap-1 px-3 py-1.5 bg-green-600 hover:bg-green-700 disabled:opacity-50 rounded-lg text-sm ml-2 whitespace-nowrap"},downloadingTemplate===tmpl.template?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"animate-spin w-4 h-4"})," ..."):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Icons.Download,{className:"w-4 h-4"})," Download"))))))))),/*#__PURE__*/React.createElement("div",{className:"p-4 border-t border-proxmox-border bg-proxmox-dark flex justify-between items-center text-sm text-gray-400"},/*#__PURE__*/React.createElement("span",null,availableTemplates.length," ",t('templatesAvailable')||'templates available'),/*#__PURE__*/React.createElement("span",null,t('downloadTo')||'Download to',": ",/*#__PURE__*/React.createElement("strong",{className:"text-white"},selectedStorage?.name))))),showRescanModal&&selectedStorage&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-md"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"text-purple-400"}),t('rescanStorage')||'Rescan Storage'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowRescanModal(false),className:"p-1.5 hover:bg-proxmox-hover rounded-lg text-gray-400 hover:text-white",disabled:rescanLoading},/*#__PURE__*/React.createElement(Icons.X,null))),/*#__PURE__*/React.createElement("div",{className:"p-4 space-y-4"},/*#__PURE__*/React.createElement("p",{className:"text-gray-400 text-sm"},t('rescanStorageDesc')||`Rescan "${selectedStorage.name}" to detect changes.`),/*#__PURE__*/React.createElement("button",{onClick:async()=>{setRescanLoading(true);try{addToast(t('rescanningStorage')||`Rescanning ${selectedStorage.name}...`,'info');const res=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/storage/${selectedStorage.name}/rescan`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({deep_scan:false})});const data=await res.json();if(res.ok&&data.success){addToast(t('storageRescanSuccess')||`Rescan completed on ${data.nodes_successful}/${data.nodes_scanned} nodes`,'success');fetchDatastores();loadStorageContent(selectedStorage.name,selectedStorage.node);}else{addToast(data.error||'Rescan failed','error');}}catch(e){console.error('Rescan error:',e);addToast(t('storageRescanError')||'Failed to rescan storage','error');}finally{setRescanLoading(false);setShowRescanModal(false);}},disabled:rescanLoading,className:"w-full p-4 bg-proxmox-dark hover:bg-proxmox-hover border border-proxmox-border rounded-xl text-left transition-colors disabled:opacity-50"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-2 bg-blue-500/20 rounded-lg"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-5 h-5 text-blue-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},t('quickRescan')||'Quick Rescan'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mt-1"},t('quickRescanDesc')||'Refresh storage status via API. Use for general status updates.')))),/*#__PURE__*/React.createElement("button",{onClick:async()=>{setRescanLoading(true);try{addToast(t('deepRescanningStorage')||`Deep rescanning ${selectedStorage.name}...`,'info');const res=await authFetch(`${API_URL}/clusters/${clusterId}/datacenter/storage/${selectedStorage.name}/rescan`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({deep_scan:true,pvresize:true})});const data=await res.json();if(res.ok&&data.success){addToast(`Deep scan completed on ${data.nodes_successful}/${data.nodes_scanned} nodes`,'success');fetchDatastores();loadStorageContent(selectedStorage.name,selectedStorage.node);}else{addToast(data.error||'Deep scan failed','error');}}catch(e){console.error('Deep scan error:',e);addToast(t('storageRescanError')||'Failed to rescan storage','error');}finally{setRescanLoading(false);setShowRescanModal(false);}},disabled:rescanLoading,className:"w-full p-4 bg-proxmox-dark hover:bg-proxmox-hover border border-purple-500/50 rounded-xl text-left transition-colors disabled:opacity-50"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-2 bg-purple-500/20 rounded-lg"},/*#__PURE__*/React.createElement(Icons.Zap,{className:"w-5 h-5 text-purple-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white flex items-center gap-2"},t('deepRescan')||'Deep Scan',/*#__PURE__*/React.createElement("span",{className:"text-xs px-2 py-0.5 bg-purple-500/20 text-purple-400 rounded"},t('recommended')||'Recommended')),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mt-1"},t('deepRescanDesc')||'SSH-based SCSI rescan + multipath reconfigure + automatic pvresize. Use after LUN expansion or adding new LUNs.'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-yellow-500/80 mt-2 flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-3 h-3"}),t('deepRescanNote')||'Requires SSH access to nodes')))),rescanLoading&&/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center gap-2 py-2 text-gray-400"},/*#__PURE__*/React.createElement(Icons.Loader,{className:"w-4 h-4 animate-spin"}),t('scanning')||'Scanning...')),/*#__PURE__*/React.createElement("div",{className:"p-4 border-t border-proxmox-border bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowRescanModal(false),disabled:rescanLoading,className:"w-full px-4 py-2 bg-proxmox-border hover:bg-proxmox-hover rounded-lg text-sm transition-colors disabled:opacity-50"},t('cancel')||'Cancel')))),uploadModalOpen&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-6 w-full max-w-md"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-4"},t('uploadIso')||'Upload ISO'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('selectFile')||'Select File'),/*#__PURE__*/React.createElement("input",{type:"file",accept:".iso",onChange:e=>setUploadFile(e.target.files[0]),disabled:uploading,className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white disabled:opacity-50"})),uploadFile&&/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400"},"\uD83D\uDCC4 ",uploadFile.name," (",formatSize(uploadFile.size),")"),uploading&&/*#__PURE__*/React.createElement("div",{className:"space-y-2"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-sm"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},uploadProgress<100?'Uploading...':'Processing...'),/*#__PURE__*/React.createElement("span",{className:"text-proxmox-orange font-mono"},uploadProgress,"%")),/*#__PURE__*/React.createElement("div",{className:"w-full bg-proxmox-dark rounded-full h-3 overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"h-full bg-gradient-to-r from-proxmox-orange to-orange-400 transition-all duration-300 ease-out",style:{width:`${uploadProgress}%`}})),/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-xs text-gray-500"},/*#__PURE__*/React.createElement("span",null,formatSize(uploadFile.size*uploadProgress/100)," / ",formatSize(uploadFile.size)),/*#__PURE__*/React.createElement("span",null,formatSpeed(uploadSpeed)))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setUploadModalOpen(false);setUploadFile(null);setUploadProgress(0);},disabled:uploading,className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover rounded-lg disabled:opacity-50"},t('cancel')||'Cancel'),/*#__PURE__*/React.createElement("button",{onClick:handleUpload,disabled:!uploadFile||uploading,className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg disabled:opacity-50 flex items-center gap-2"},uploading?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"animate-spin w-4 h-4"}),/*#__PURE__*/React.createElement("span",null,uploadProgress,"%")):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Icons.Upload,{className:"w-4 h-4"}),/*#__PURE__*/React.createElement("span",null,t('upload')||'Upload'))))))),downloadUrlModalOpen&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-6 w-full max-w-lg"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Link,{className:"w-5 h-5"}),t('downloadFromUrl')||'Download from URL'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('isoUrl')||'ISO URL'),/*#__PURE__*/React.createElement("input",{type:"url",value:downloadUrl,onChange:e=>setDownloadUrl(e.target.value),placeholder:"https://releases.ubuntu.com/22.04/ubuntu-22.04-live-server-amd64.iso",disabled:urlDownloading,className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white disabled:opacity-50 text-sm"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('isoUrlHint')||'Direct link to ISO file (http/https)')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('filename')||'Filename'," (",t('optional')||'optional',")"),/*#__PURE__*/React.createElement("input",{type:"text",value:downloadFilename,onChange:e=>setDownloadFilename(e.target.value),placeholder:t('autoDetect')||'Auto-detect from URL',disabled:urlDownloading,className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white disabled:opacity-50 text-sm"})),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark/50 rounded-lg p-3 text-sm"},/*#__PURE__*/React.createElement("p",{className:"text-gray-400"},/*#__PURE__*/React.createElement("strong",null,t('storage')||'Storage',":")," ",selectedStorage?.name,selectedStorage?.node&&/*#__PURE__*/React.createElement("span",{className:"text-gray-500"}," (",selectedStorage.node,")"))),urlDownloading&&urlDownloadProgress&&/*#__PURE__*/React.createElement("div",{className:"space-y-2"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-sm"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},urlDownloadProgress.message||'Downloading...'),urlDownloadProgress.percent!==undefined&&/*#__PURE__*/React.createElement("span",{className:"text-green-400 font-mono"},urlDownloadProgress.percent,"%")),/*#__PURE__*/React.createElement("div",{className:"w-full bg-proxmox-dark rounded-full h-3 overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"h-full bg-gradient-to-r from-green-500 to-green-400 transition-all duration-300 ease-out",style:{width:`${urlDownloadProgress.percent||0}%`}})),urlDownloadProgress.downloaded&&urlDownloadProgress.total&&/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-xs text-gray-500"},/*#__PURE__*/React.createElement("span",null,formatSize(urlDownloadProgress.downloaded)," / ",formatSize(urlDownloadProgress.total)),urlDownloadProgress.speed&&/*#__PURE__*/React.createElement("span",null,formatSpeed(urlDownloadProgress.speed)))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setDownloadUrlModalOpen(false);setDownloadUrl('');setDownloadFilename('');setUrlDownloadProgress(null);},disabled:urlDownloading,className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover rounded-lg disabled:opacity-50"},t('cancel')||'Cancel'),/*#__PURE__*/React.createElement("button",{onClick:handleDownloadFromUrl,disabled:!downloadUrl||urlDownloading,className:"px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg disabled:opacity-50 flex items-center gap-2"},urlDownloading?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"animate-spin w-4 h-4"}),/*#__PURE__*/React.createElement("span",null,t('downloading')||'Downloading...')):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Icons.Download,{className:"w-4 h-4"}),/*#__PURE__*/React.createElement("span",null,t('download')||'Download'))))))),deleteConfirm&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-6 w-full max-w-md"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-4 text-red-400"},t('confirmDelete')||'Confirm Delete'),/*#__PURE__*/React.createElement("p",{className:"text-gray-300 mb-4"},t('deleteConfirmText')||'Are you sure you want to delete',":",/*#__PURE__*/React.createElement("br",null),/*#__PURE__*/React.createElement("span",{className:"font-mono text-sm"},deleteConfirm.volid?.split('/').pop())),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end"},/*#__PURE__*/React.createElement("button",{onClick:()=>setDeleteConfirm(null),className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover rounded-lg"},t('cancel')||'Cancel'),/*#__PURE__*/React.createElement("button",{onClick:()=>handleDelete(deleteConfirm),className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg"},t('delete')||'Delete')))),showAddEsxi&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",onClick:()=>setShowAddEsxi(false)},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-6 w-full max-w-md",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:"text-xl"},"\uD83D\uDDA5\uFE0F"),t('connectEsxi')||'Connect ESXi Host'),/*#__PURE__*/React.createElement("div",{className:"p-2 bg-yellow-500/10 border border-yellow-500/30 rounded-lg mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement("span",null,"\uD83E\uDDEA"),/*#__PURE__*/React.createElement("span",{className:"text-xs text-yellow-400"},t('esxiExperimental')||'ESXi integration is experimental')),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('esxiHostname')||'ESXi Hostname/IP'),/*#__PURE__*/React.createElement("input",{type:"text",value:esxiForm.host,onChange:e=>setEsxiForm({...esxiForm,host:e.target.value}),placeholder:"192.168.1.100 oder esxi.local",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('esxiUsername')||'Username'),/*#__PURE__*/React.createElement("input",{type:"text",value:esxiForm.username,onChange:e=>setEsxiForm({...esxiForm,username:e.target.value}),placeholder:"root",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('esxiPassword')||'Password'),/*#__PURE__*/React.createElement("input",{type:"password",value:esxiForm.password,onChange:e=>setEsxiForm({...esxiForm,password:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end pt-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddEsxi(false),className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover rounded-lg"},t('cancel')||'Cancel'),/*#__PURE__*/React.createElement("button",{onClick:connectEsxiHost,disabled:esxiLoading||!esxiForm.host||!esxiForm.password,className:"px-4 py-2 bg-cyan-600 hover:bg-cyan-700 rounded-lg disabled:opacity-50 flex items-center gap-2"},esxiLoading&&/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"animate-spin w-4 h-4"}),t('connect')||'Connect'))))));}// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PegaProx - Tables & Cards
// NodeCard + ResourceTable
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Node Card Component
function NodeCard({name,metrics,index,clusterId,onMaintenanceToggle,onStartUpdate,onOpenNodeConfig,onNodeAction,onRemoveNode,onMoveNode}){const{t}=useTranslation();const{getAuthHeaders}=useAuth();// NS: 20 data points = last ~40s of sparkline at 2s polling interval
const historyRef=useRef({cpu:Array(20).fill(0),mem:Array(20).fill(0),disk:Array(20).fill(0),netin:Array(20).fill(0),netout:Array(20).fill(0)});const[,forceUpdate]=useState(0);const[showMaintenanceConfirm,setShowMaintenanceConfirm]=useState(false);const[showUpdateConfirm,setShowUpdateConfirm]=useState(false);const[updateWithReboot,setUpdateWithReboot]=useState(true);const[showUpdateLog,setShowUpdateLog]=useState(false);const[showRebootConfirm,setShowRebootConfirm]=useState(false);const[showShutdownConfirm,setShowShutdownConfirm]=useState(false);const[actionLoading,setActionLoading]=useState(null);const[expanded,setExpanded]=useState(false);const lastMetricsRef=useRef(null);const lastNetRef=useRef({netin:0,netout:0,time:Date.now()});useEffect(()=>{if(metrics&&metrics!==lastMetricsRef.current){lastMetricsRef.current=metrics;// calc network rate
const now=Date.now();const timeDiff=(now-lastNetRef.current.time)/1000;const netinRate=timeDiff>0?Math.max(0,(metrics.netin-lastNetRef.current.netin)/timeDiff):0;const netoutRate=timeDiff>0?Math.max(0,(metrics.netout-lastNetRef.current.netout)/timeDiff):0;lastNetRef.current={netin:metrics.netin||0,netout:metrics.netout||0,time:now};historyRef.current={cpu:[...historyRef.current.cpu.slice(1),metrics.cpu_percent||0],mem:[...historyRef.current.mem.slice(1),metrics.mem_percent||0],disk:[...historyRef.current.disk.slice(1),metrics.disk_percent||0],netin:[...historyRef.current.netin.slice(1),netinRate/1048576],// MB/s
netout:[...historyRef.current.netout.slice(1),netoutRate/1048576]};forceUpdate(n=>n+1);}},[metrics?.cpu_percent,metrics?.mem_percent,metrics?.netin,metrics?.netout]);const history=historyRef.current;const formatBytes=bytes=>{const gb=bytes/1073741824;return gb>=1?`${gb.toFixed(1)} GB`:`${(bytes/1048576).toFixed(1)} MB`;};const formatUptime=seconds=>{const days=Math.floor(seconds/86400);const hours=Math.floor(seconds%86400/3600);const mins=Math.floor(seconds%3600/60);if(days>0)return`${days}d ${hours}h`;if(hours>0)return`${hours}h ${mins}m`;return`${mins}m`;};if(!metrics)return null;const isInMaintenance=metrics.maintenance_mode;const maintenanceTask=metrics.maintenance_task;const isUpdating=metrics.is_updating;const updateTask=metrics.update_task;const isOffline=metrics.offline||metrics.status==='offline';// Can only update if in maintenance and evacuation complete
const canUpdate=isInMaintenance&&maintenanceTask?.status&&['completed','completed_with_errors'].includes(maintenanceTask.status)&&!isUpdating;// Show simplified card for offline nodes
if(isOffline){return/*#__PURE__*/React.createElement("div",{className:"relative card-hover bg-proxmox-card border-2 border-red-500/50 rounded-xl p-5 animate-slide-up",style:{animationDelay:`${index*100}ms`}},/*#__PURE__*/React.createElement("div",{className:"absolute top-2 right-2"},/*#__PURE__*/React.createElement("span",{className:"px-2 py-1 bg-red-500 text-white text-xs font-bold rounded animate-pulse"},"OFFLINE")),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3 mb-4"},/*#__PURE__*/React.createElement("div",{className:"p-2 bg-red-500/20 rounded-lg"},/*#__PURE__*/React.createElement(Icons.Server,{className:"text-red-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"font-semibold text-white"},name),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 mt-1"},/*#__PURE__*/React.createElement("span",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"}),/*#__PURE__*/React.createElement("span",{className:"text-xs text-red-400"},"offline")))),/*#__PURE__*/React.createElement("div",{className:"space-y-3 opacity-50"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-xs mb-1"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"CPU"),/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"--")),/*#__PURE__*/React.createElement("div",{className:"h-2 bg-proxmox-dark rounded-full"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-xs mb-1"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"RAM"),/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"--")),/*#__PURE__*/React.createElement("div",{className:"h-2 bg-proxmox-dark rounded-full"}))),metrics.last_seen&&/*#__PURE__*/React.createElement("div",{className:"mt-4 pt-3 border-t border-red-500/30 text-xs text-red-400"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"inline w-3 h-3 mr-1"}),t('lastSeen')||'Last seen',": ",new Date(metrics.last_seen).toLocaleString()));}return/*#__PURE__*/React.createElement("div",{className:`card-hover bg-proxmox-card border rounded-xl p-5 animate-slide-up ${isUpdating?'border-blue-500/50 bg-blue-500/5':isInMaintenance?'border-yellow-500/50 bg-yellow-500/5':'border-proxmox-border'}`,style:{animationDelay:`${index*100}ms`}},isUpdating&&updateTask&&/*#__PURE__*/React.createElement("div",{className:"mb-4 -mt-1 -mx-1"},/*#__PURE__*/React.createElement("div",{className:`${updateTask.status==='failed'?'bg-red-500/10 border-red-500/30':updateTask.status==='completed'?'bg-green-500/10 border-green-500/30':'bg-blue-500/10 border-blue-500/30'} border rounded-lg p-3`},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-2"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},updateTask.status==='completed'?/*#__PURE__*/React.createElement(Icons.CheckCircle,{className:"text-green-400"}):updateTask.status==='failed'?/*#__PURE__*/React.createElement(Icons.XCircle,{className:"text-red-400"}):/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"animate-spin"}),/*#__PURE__*/React.createElement("span",{className:`${updateTask.status==='failed'?'text-red-400':updateTask.status==='completed'?'text-green-400':'text-blue-400'} font-semibold text-sm`},updateTask.status==='failed'?t('updateFailed'):updateTask.status==='completed'?t('updateCompleted'):t('updateRunning'))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:`text-xs px-2 py-0.5 rounded ${updateTask.status==='completed'?'bg-green-500/20 text-green-400':updateTask.status==='failed'?'bg-red-500/20 text-red-400':'bg-blue-500/20 text-blue-400'}`},updateTask.phase==='apt_update'?'apt update':updateTask.phase==='apt_upgrade'?'apt upgrade':updateTask.phase==='reboot'?'Reboot':updateTask.phase==='wait_online'?t('waitingForNode'):updateTask.phase==='done'?t('done'):updateTask.status),(updateTask.status==='completed'||updateTask.status==='failed')&&/*#__PURE__*/React.createElement("button",{onClick:async e=>{e.stopPropagation();try{await fetch(`${API_URL}/clusters/${clusterId}/nodes/${name}/update`,{method:'DELETE',credentials:'include',headers:getAuthHeaders()});}catch(e){}},className:"text-xs text-gray-400 hover:text-white px-2 py-0.5 hover:bg-proxmox-hover rounded transition-colors"},"\u2715"))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker rounded p-2 font-mono text-xs max-h-32 overflow-y-auto cursor-pointer",onClick:()=>setShowUpdateLog(true)},updateTask.output_lines?.slice(-5).map((line,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"text-gray-400 truncate"},line.text))),updateTask.status==='completed'&&/*#__PURE__*/React.createElement("div",{className:"mt-2 text-xs text-green-400"},"\u2705 ",t('updateCompleted')," ",updateTask.packages_upgraded," ",t('packagesUpdated')),updateTask.status==='failed'&&/*#__PURE__*/React.createElement("div",{className:"mt-2 space-y-2"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-red-400"},"\u274C ",t('error'),": ",updateTask.error),/*#__PURE__*/React.createElement("button",{onClick:async()=>{// First clear the update status
try{await fetch(`${API_URL}/clusters/${clusterId}/nodes/${name}/update`,{method:'DELETE',credentials:'include',headers:getAuthHeaders()});}catch(e){}// Then exit maintenance mode
if(onMaintenanceToggle)onMaintenanceToggle(name,false);},className:"w-full px-3 py-1.5 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded-lg text-red-400 text-xs font-medium transition-colors"},t('cancelAndExitMaintenance'))))),isInMaintenance&&!isUpdating&&/*#__PURE__*/React.createElement("div",{className:"mb-4 -mt-1 -mx-1"},/*#__PURE__*/React.createElement("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-2"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Wrench,null),/*#__PURE__*/React.createElement("span",{className:"text-yellow-400 font-semibold text-sm"},t('maintenanceMode'))),/*#__PURE__*/React.createElement("span",{className:`text-xs px-2 py-0.5 rounded ${maintenanceTask?.status==='completed'?'bg-green-500/20 text-green-400':maintenanceTask?.status==='completed_with_errors'?'bg-orange-500/20 text-orange-400':maintenanceTask?.status==='evacuating'?'bg-blue-500/20 text-blue-400':maintenanceTask?.status==='failed'?'bg-red-500/20 text-red-400':'bg-yellow-500/20 text-yellow-400'}`},maintenanceTask?.status==='completed'?t('ready'):maintenanceTask?.status==='completed_with_errors'?t('completedWithErrors'):maintenanceTask?.status==='evacuating'?t('evacuating'):maintenanceTask?.status==='failed'?t('failed'):t('starting'))),maintenanceTask&&maintenanceTask.status==='evacuating'&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"mb-2"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-xs text-gray-400 mb-1"},/*#__PURE__*/React.createElement("span",null,t('progress')),/*#__PURE__*/React.createElement("span",null,maintenanceTask.migrated_vms," / ",maintenanceTask.total_vms," VMs")),/*#__PURE__*/React.createElement("div",{className:"h-2 bg-proxmox-dark rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"h-full bg-gradient-to-r from-yellow-500 to-yellow-400 transition-all duration-500",style:{width:`${maintenanceTask.progress_percent}%`}}))),maintenanceTask.current_vm&&/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-400"},t('migrating'),": ",/*#__PURE__*/React.createElement("span",{className:"text-white font-mono"},maintenanceTask.current_vm.name))),maintenanceTask?.status==='completed_with_errors'&&!metrics.maintenance_acknowledged&&/*#__PURE__*/React.createElement("div",{className:"space-y-3 mt-2"},/*#__PURE__*/React.createElement("div",{className:"p-3 bg-orange-500/10 border border-orange-500/30 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-2 text-orange-400 text-xs"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("p",{className:"font-medium"},t('migrationIncomplete')||'Migration Incomplete'),/*#__PURE__*/React.createElement("p",{className:"text-orange-300/80 mt-1"},t('someVmsOnLocalStorage')||'Some VMs could not be migrated (likely local storage). They will be stopped during reboot.')))),maintenanceTask?.failed_vms?.length>0&&/*#__PURE__*/React.createElement("div",{className:"p-2 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-400 mb-1"},t('failedToMigrate')||'Failed to migrate',":"),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-1"},maintenanceTask.failed_vms.slice(0,5).map((vm,idx)=>/*#__PURE__*/React.createElement("span",{key:idx,className:"px-2 py-0.5 bg-red-500/20 text-red-400 text-xs rounded font-mono"},vm.name||vm.vmid||`VM ${idx+1}`)),maintenanceTask.failed_vms.length>5&&/*#__PURE__*/React.createElement("span",{className:"px-2 py-0.5 bg-gray-500/20 text-gray-400 text-xs rounded"},"+",maintenanceTask.failed_vms.length-5," ",t('more')||'more'))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(confirm(t('forceMaintenanceWarning')||'âš ï¸ WARNING: Proceeding will allow actions that may stop the remaining VMs. Continue?')){// Acknowledge the warning - unlock full menu
try{await fetch(`${API_URL}/clusters/${clusterId}/nodes/${name}/maintenance/acknowledge`,{method:'POST',credentials:'include',headers:{'Content-Type':'application/json'}});}catch(e){console.error(e);}}},className:"flex-1 flex items-center justify-center gap-2 px-3 py-1.5 bg-orange-500/20 hover:bg-orange-500/30 border border-orange-500/30 rounded-lg text-orange-400 text-xs font-medium transition-colors"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,null),t('proceedAnyway')||'Proceed Anyway'),/*#__PURE__*/React.createElement("button",{onClick:()=>onMaintenanceToggle(name,false),className:"flex-1 px-3 py-1.5 bg-gray-500/20 hover:bg-gray-500/30 border border-gray-500/30 rounded-lg text-gray-400 text-xs font-medium transition-colors"},t('exitMaintenance')))),(maintenanceTask?.status==='completed'||maintenanceTask?.status==='completed_with_errors'&&metrics.maintenance_acknowledged)&&/*#__PURE__*/React.createElement("div",{className:"space-y-2 mt-2"},maintenanceTask?.status==='completed_with_errors'&&maintenanceTask?.failed_vms?.length>0&&/*#__PURE__*/React.createElement("div",{className:"p-2 bg-orange-500/10 border border-orange-500/20 rounded-lg text-xs text-orange-400 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-3 h-3"}),maintenanceTask.failed_vms.length," ",t('vmsWillBeStopped')||'VM(s) will be stopped during reboot'),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowUpdateConfirm(true),className:"flex-1 flex items-center justify-center gap-2 px-3 py-1.5 bg-blue-500/20 hover:bg-blue-500/30 border border-blue-500/30 rounded-lg text-blue-400 text-xs font-medium transition-colors"},/*#__PURE__*/React.createElement(Icons.Download,null),t('updateAndReboot')),/*#__PURE__*/React.createElement("button",{onClick:()=>onMaintenanceToggle(name,false),className:"flex-1 px-3 py-1.5 bg-green-500/20 hover:bg-green-500/30 border border-green-500/30 rounded-lg text-green-400 text-xs font-medium transition-colors"},t('exitMaintenance'))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowRebootConfirm(true),disabled:actionLoading,className:"flex-1 flex items-center justify-center gap-2 px-3 py-1.5 bg-orange-500/20 hover:bg-orange-500/30 border border-orange-500/30 rounded-lg text-orange-400 text-xs font-medium transition-colors disabled:opacity-50"},/*#__PURE__*/React.createElement(Icons.RefreshCw,null),t('rebootNode')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowShutdownConfirm(true),disabled:actionLoading,className:"flex-1 flex items-center justify-center gap-2 px-3 py-1.5 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded-lg text-red-400 text-xs font-medium transition-colors disabled:opacity-50"},/*#__PURE__*/React.createElement(Icons.Power,null),t('shutdownNode'))),/*#__PURE__*/React.createElement("div",{className:"mt-3 pt-3 border-t border-proxmox-border/50 flex gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>onMoveNode&&onMoveNode(name),className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-1.5 bg-blue-500/10 hover:bg-blue-500/20 border border-blue-500/20 rounded-lg text-blue-400 text-xs font-medium transition-colors"},/*#__PURE__*/React.createElement(Icons.ArrowRight,{className:"w-3 h-3"}),t('moveNodeToCluster')||'Move to Cluster'),/*#__PURE__*/React.createElement("button",{onClick:()=>onRemoveNode&&onRemoveNode(name),className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-1.5 bg-red-500/10 hover:bg-red-500/20 border border-red-500/20 rounded-lg text-red-400 text-xs font-medium transition-colors"},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-3 h-3"}),t('removeNodeFromCluster')||'Remove'))),maintenanceTask?.failed_vms?.length>0&&!['completed','completed_with_errors'].includes(maintenanceTask?.status)&&/*#__PURE__*/React.createElement("div",{className:"mt-2 text-xs text-red-400"},"\u26A0\uFE0F ",maintenanceTask.failed_vms.length," ",t('vmsCouldNotMigrate')))),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:`p-2 rounded-lg ${isUpdating?'bg-blue-500/10':isInMaintenance?'bg-yellow-500/10':'bg-proxmox-orange/10'}`},isUpdating?/*#__PURE__*/React.createElement(Icons.RotateCw,null):isInMaintenance?/*#__PURE__*/React.createElement(Icons.Wrench,null):/*#__PURE__*/React.createElement(Icons.Server,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"font-semibold text-white"},name),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 mt-0.5"},/*#__PURE__*/React.createElement("span",{className:`w-2 h-2 rounded-full ${isUpdating?'bg-blue-500 animate-pulse':isInMaintenance?'bg-yellow-500':metrics.status==='online'?'bg-green-500 status-online':'bg-gray-500'}`}),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-400"},isUpdating?t('updating'):isInMaintenance?t('maintenance'):metrics.status)))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},!isInMaintenance&&!isUpdating&&/*#__PURE__*/React.createElement("button",{onClick:()=>setShowMaintenanceConfirm(true),className:"p-2 rounded-lg bg-proxmox-dark hover:bg-yellow-500/20 text-gray-400 hover:text-yellow-400 transition-all",title:t('enterMaintenance')},/*#__PURE__*/React.createElement(Icons.Wrench,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>onOpenNodeConfig&&onOpenNodeConfig(name),className:"p-2 rounded-lg bg-proxmox-dark hover:bg-proxmox-orange/20 text-gray-400 hover:text-proxmox-orange transition-all",title:t('nodeConfiguration')},/*#__PURE__*/React.createElement(Icons.Cog,null)),/*#__PURE__*/React.createElement("div",{className:"text-right"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"Score"),/*#__PURE__*/React.createElement("div",{className:`font-mono font-bold text-lg ${metrics.score<100?'text-green-400':metrics.score<150?'text-yellow-400':'text-red-400'}`},metrics.score.toFixed(0))))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4 mb-4"},/*#__PURE__*/React.createElement(Gauge,{value:metrics.cpu_percent,label:"CPU"}),/*#__PURE__*/React.createElement(Gauge,{value:metrics.mem_percent,label:"RAM"})),/*#__PURE__*/React.createElement("div",{className:"space-y-3 pt-3 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Cpu,null)," ",t('cpuHistory')),/*#__PURE__*/React.createElement(Sparkline,{data:history.cpu,width:80,height:24})),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Memory,null)," ",t('ramHistory')),/*#__PURE__*/React.createElement(Sparkline,{data:history.mem,width:80,height:24})),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between text-xs"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},t('ramUsage')),/*#__PURE__*/React.createElement("span",{className:"text-gray-300 font-mono"},formatBytes(metrics.mem_used)," / ",formatBytes(metrics.mem_total))),/*#__PURE__*/React.createElement("button",{onClick:()=>setExpanded(!expanded),className:"w-full flex items-center justify-center gap-1 text-xs text-gray-500 hover:text-gray-300 transition-colors pt-2"},expanded?t('showLess'):t('showMore'),/*#__PURE__*/React.createElement(Icons.ChevronDown,{className:`w-3 h-3 transition-transform ${expanded?'rotate-180':''}`})),expanded&&/*#__PURE__*/React.createElement("div",{className:"space-y-3 pt-2 border-t border-gray-700/50 animate-fade-in"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between text-xs"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.HardDrive,null)," ",t('disk')),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("div",{className:"w-16 h-1.5 bg-proxmox-dark rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:`h-full rounded-full ${metrics.disk_percent>90?'bg-red-500':metrics.disk_percent>75?'bg-yellow-500':'bg-green-500'}`,style:{width:`${metrics.disk_percent||0}%`}})),/*#__PURE__*/React.createElement("span",{className:"text-gray-300 font-mono w-12 text-right"},(metrics.disk_percent||0).toFixed(1),"%"))),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between text-xs"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},t('diskUsage')),/*#__PURE__*/React.createElement("span",{className:"text-gray-300 font-mono"},formatBytes(metrics.disk_used||0)," / ",formatBytes(metrics.disk_total||0))),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between text-xs"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Network,null)," Network In"),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Sparkline,{data:history.netin,width:50,height:16,color:"#22c55e"}),/*#__PURE__*/React.createElement("span",{className:"text-green-400 font-mono w-16 text-right"},history.netin[history.netin.length-1]?.toFixed(1)||'0.0'," MB/s"))),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between text-xs"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Network,null)," Network Out"),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Sparkline,{data:history.netout,width:50,height:16,color:"#f97316"}),/*#__PURE__*/React.createElement("span",{className:"text-orange-400 font-mono w-16 text-right"},history.netout[history.netout.length-1]?.toFixed(1)||'0.0'," MB/s"))),metrics.loadavg&&/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between text-xs"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Activity,null)," Load Avg"),/*#__PURE__*/React.createElement("span",{className:"text-gray-300 font-mono"},Array.isArray(metrics.loadavg)?metrics.loadavg.map(l=>l.toFixed(2)).join(' / '):typeof metrics.loadavg==='number'?metrics.loadavg.toFixed(2):'-')),metrics.cpuinfo&&/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between text-xs"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},t('cores')),/*#__PURE__*/React.createElement("span",{className:"text-gray-300"},metrics.cpuinfo.cores||metrics.cpuinfo.cpus||'-'," \xD7 ",metrics.cpuinfo.sockets||1," Socket")),metrics.kversion&&/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between text-xs"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Kernel"),/*#__PURE__*/React.createElement("span",{className:"text-gray-400 font-mono text-[10px] truncate max-w-32"},metrics.kversion.split(' ')[0]||metrics.kversion)),metrics.pveversion&&/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between text-xs"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"PVE"),/*#__PURE__*/React.createElement("span",{className:"text-gray-400 font-mono text-[10px]"},metrics.pveversion))),metrics.uptime>0&&/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between text-xs"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500 flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.Clock,null)," ",t('uptime')),/*#__PURE__*/React.createElement("span",{className:"text-gray-300 font-mono"},formatUptime(metrics.uptime)))),showMaintenanceConfirm&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60",onClick:()=>setShowMaintenanceConfirm(false)},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-md bg-proxmox-card border border-proxmox-border rounded-2xl shadow-2xl overflow-hidden",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"p-6 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-3 bg-yellow-500/10 rounded-xl"},/*#__PURE__*/React.createElement(Icons.Wrench,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:"text-lg font-bold text-white"},t('maintenanceModeTitle')),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},name)))),/*#__PURE__*/React.createElement("div",{className:"p-6"},/*#__PURE__*/React.createElement("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4 mb-4"},/*#__PURE__*/React.createElement("p",{className:"text-sm text-yellow-200"},/*#__PURE__*/React.createElement("strong",null,t('warning'),":")," ",t('maintenanceWarning').replace('Warning: ',''))),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mb-6"},t('maintenanceDesc')),/*#__PURE__*/React.createElement("div",{className:"flex gap-3"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowMaintenanceConfirm(false),className:"flex-1 px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-gray-300 font-medium hover:bg-proxmox-hover transition-colors"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowMaintenanceConfirm(false);onMaintenanceToggle(name,true);},className:"flex-1 px-4 py-2.5 bg-yellow-500 hover:bg-yellow-600 rounded-lg text-black font-medium transition-colors"},t('startMaintenance')))))),showUpdateConfirm&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60",onClick:()=>setShowUpdateConfirm(false)},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-md bg-proxmox-card border border-proxmox-border rounded-2xl shadow-2xl overflow-hidden",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"p-6 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-3 bg-blue-500/10 rounded-xl"},/*#__PURE__*/React.createElement(Icons.Download,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:"text-lg font-bold text-white"},t('updateNode')),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},name)))),/*#__PURE__*/React.createElement("div",{className:"p-6"},/*#__PURE__*/React.createElement("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4 mb-4"},/*#__PURE__*/React.createElement("p",{className:"text-sm text-blue-200"},t('updateCommand'))),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-3 mb-6 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:updateWithReboot,onChange:e=>setUpdateWithReboot(e.target.checked),className:"w-5 h-5 rounded border-proxmox-border bg-proxmox-dark text-blue-500 focus:ring-blue-500"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},t('rebootAfterUpdate')),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},t('recommendedForKernel')))),/*#__PURE__*/React.createElement("div",{className:"flex gap-3"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowUpdateConfirm(false),className:"flex-1 px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-gray-300 font-medium hover:bg-proxmox-hover transition-colors"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowUpdateConfirm(false);onStartUpdate(name,updateWithReboot);},className:"flex-1 px-4 py-2.5 bg-blue-500 hover:bg-blue-600 rounded-lg text-white font-medium transition-colors"},t('startUpdate')))))),showUpdateLog&&updateTask&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop bg-black/60",onClick:()=>setShowUpdateLog(false)},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-2xl bg-proxmox-card border border-proxmox-border rounded-2xl shadow-2xl animate-scale-in overflow-hidden",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement(Icons.Terminal,null),/*#__PURE__*/React.createElement("h2",{className:"font-bold text-white"},"Update Log - ",name)),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowUpdateLog(false),className:"p-2 hover:bg-proxmox-hover rounded-lg transition-colors"},/*#__PURE__*/React.createElement(Icons.X,null))),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-darker font-mono text-xs max-h-96 overflow-y-auto"},updateTask.output_lines?.map((line,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"py-0.5 text-gray-300 hover:bg-proxmox-card/50"},/*#__PURE__*/React.createElement("span",{className:"text-gray-600 mr-2"},new Date(line.timestamp).toLocaleTimeString('de-DE')),line.text))))),showRebootConfirm&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop bg-black/60",onClick:()=>setShowRebootConfirm(false)},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-md bg-proxmox-card border border-orange-500/30 rounded-2xl shadow-2xl animate-scale-in overflow-hidden",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"p-6 border-b border-orange-500/30 bg-orange-500/10"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-3 bg-orange-500/20 rounded-xl"},/*#__PURE__*/React.createElement(Icons.RefreshCw,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:"text-lg font-bold text-white"},t('rebootNode')),/*#__PURE__*/React.createElement("p",{className:"text-sm text-orange-400"},name)))),/*#__PURE__*/React.createElement("div",{className:"p-6"},/*#__PURE__*/React.createElement("div",{className:"bg-orange-500/10 border border-orange-500/30 rounded-lg p-4 mb-4"},/*#__PURE__*/React.createElement("p",{className:"text-sm text-orange-200"},t('rebootNodeWarning'))),/*#__PURE__*/React.createElement("div",{className:"flex gap-3"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowRebootConfirm(false),className:"flex-1 px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-gray-300 font-medium hover:bg-proxmox-hover transition-colors"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{setActionLoading('reboot');setShowRebootConfirm(false);if(onNodeAction)await onNodeAction(name,'reboot');setActionLoading(null);},disabled:actionLoading,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-orange-500 hover:bg-orange-600 rounded-lg text-white font-medium transition-colors disabled:opacity-50"},actionLoading==='reboot'?/*#__PURE__*/React.createElement(Icons.RotateCw,null):/*#__PURE__*/React.createElement(Icons.RefreshCw,null),t('rebootNow')))))),showShutdownConfirm&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop bg-black/60",onClick:()=>setShowShutdownConfirm(false)},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-md bg-proxmox-card border border-red-500/30 rounded-2xl shadow-2xl animate-scale-in overflow-hidden",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"p-6 border-b border-red-500/30 bg-red-500/10"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-3 bg-red-500/20 rounded-xl"},/*#__PURE__*/React.createElement(Icons.Power,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:"text-lg font-bold text-white"},t('shutdownNode')),/*#__PURE__*/React.createElement("p",{className:"text-sm text-red-400"},name)))),/*#__PURE__*/React.createElement("div",{className:"p-6"},/*#__PURE__*/React.createElement("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-4 mb-4"},/*#__PURE__*/React.createElement("p",{className:"text-sm text-red-200"},t('shutdownNodeWarning'))),/*#__PURE__*/React.createElement("div",{className:"flex gap-3"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowShutdownConfirm(false),className:"flex-1 px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-gray-300 font-medium hover:bg-proxmox-hover transition-colors"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{setActionLoading('shutdown');setShowShutdownConfirm(false);if(onNodeAction)await onNodeAction(name,'shutdown');setActionLoading(null);},disabled:actionLoading,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-red-500 hover:bg-red-600 rounded-lg text-white font-medium transition-colors disabled:opacity-50"},actionLoading==='shutdown'?/*#__PURE__*/React.createElement(Icons.RotateCw,null):/*#__PURE__*/React.createElement(Icons.Power,null),t('shutdownNow')))))));}// LW: Feb 2026 - compact node row for corporate overview
function NodeCompactRow({name,metrics,clusterId,onOpenNodeConfig,onMaintenanceToggle,onStartUpdate,onNodeAction,onRemoveNode,onMoveNode}){const{t}=useTranslation();const{getAuthHeaders}=useAuth();const[expanded,setExpanded]=useState(false);const[showMaintenanceConfirm,setShowMaintenanceConfirm]=useState(false);const[showRebootConfirm,setShowRebootConfirm]=useState(false);const[showShutdownConfirm,setShowShutdownConfirm]=useState(false);const[showUpdateConfirm,setShowUpdateConfirm]=useState(false);const[updateWithReboot,setUpdateWithReboot]=useState(true);const[actionLoading,setActionLoading]=useState(null);const isOffline=!metrics||metrics.status==='offline';const cpuPercent=metrics?.cpu_percent?.toFixed(1)||(metrics?.cpu?(metrics.cpu*100).toFixed(1):'0');const ramPercent=metrics?.mem_percent?.toFixed(1)||(metrics?.memory?(metrics.memory.used/metrics.memory.total*100).toFixed(1):'0');const isInMaintenance=metrics?.maintenance_mode;const maintenanceTask=metrics?.maintenance_task;const isUpdating=metrics?.is_updating;const updateTask=metrics?.update_task;const canUpdate=isInMaintenance&&maintenanceTask?.status&&['completed','completed_with_errors'].includes(maintenanceTask.status)&&!isUpdating;const formatBytes=bytes=>{const gb=bytes/1073741824;return gb>=1?`${gb.toFixed(1)} GB`:`${(bytes/1048576).toFixed(1)} MB`;};const formatUptime=uptime=>{if(!uptime)return'-';const days=Math.floor(uptime/86400);const hours=Math.floor(uptime%86400/3600);const mins=Math.floor(uptime%3600/60);if(days>0)return`${days}d ${hours}h`;if(hours>0)return`${hours}h ${mins}m`;return`${mins}m`;};// Status colors - Clarity dark theme
const statusDotStyle=isOffline?{background:'#f54f47'}:isInMaintenance?{background:'#efc006'}:isUpdating?{background:'#49afd9'}:{background:'#60b515'};const statusLabel=isOffline?'':isInMaintenance?t('maintenance'):isUpdating?updateTask?.phase||t('updating'):'';return/*#__PURE__*/React.createElement("div",{className:"corp-node-row"},/*#__PURE__*/React.createElement("div",{className:`flex items-center gap-3 px-3 py-2 text-[13px] cursor-pointer ${isOffline?'opacity-50':''}`,onClick:()=>!isOffline&&setExpanded(!expanded)},!isOffline&&/*#__PURE__*/React.createElement(Icons.ChevronRight,{className:`w-3 h-3 flex-shrink-0`,style:{color:'#728b9a',transform:expanded?'rotate(90deg)':'none'}}),/*#__PURE__*/React.createElement("span",{className:"w-2 h-2 rounded-full flex-shrink-0",style:statusDotStyle}),/*#__PURE__*/React.createElement("span",{className:"font-medium w-32 truncate",style:{color:'#e9ecef'}},name),!isOffline?/*#__PURE__*/React.createElement(React.Fragment,null,statusLabel&&/*#__PURE__*/React.createElement("span",{className:`corp-badge ${isInMaintenance?'corp-badge-locked':'corp-badge-ha'}`},statusLabel),/*#__PURE__*/React.createElement("span",{className:"w-8",style:{color:'#728b9a'}},"CPU"),/*#__PURE__*/React.createElement("div",{className:"w-20 h-1.5 flex-shrink-0 overflow-hidden",style:{background:'#1b2a32',borderRadius:'1px'}},/*#__PURE__*/React.createElement("div",{className:"h-full",style:{width:`${Math.min(cpuPercent,100)}%`,background:'#49afd9',borderRadius:'1px'}})),/*#__PURE__*/React.createElement("span",{className:"w-12 text-right",style:{color:'#adbbc4'}},cpuPercent,"%"),/*#__PURE__*/React.createElement("span",{className:"w-8 ml-2",style:{color:'#728b9a'}},"RAM"),/*#__PURE__*/React.createElement("div",{className:"w-20 h-1.5 flex-shrink-0 overflow-hidden",style:{background:'#1b2a32',borderRadius:'1px'}},/*#__PURE__*/React.createElement("div",{className:"h-full",style:{width:`${Math.min(ramPercent,100)}%`,background:'#9b59b6',borderRadius:'1px'}})),/*#__PURE__*/React.createElement("span",{className:"w-12 text-right",style:{color:'#adbbc4'}},ramPercent,"%"),metrics.score!=null&&/*#__PURE__*/React.createElement("span",{className:"ml-3 w-16",style:{color:'#728b9a'}},t('score'),": ",/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4'}},metrics.score)),/*#__PURE__*/React.createElement("span",{className:"ml-3",style:{color:'#728b9a'}},formatUptime(metrics.uptime)),/*#__PURE__*/React.createElement("span",{className:"flex-1"}),isInMaintenance&&maintenanceTask&&maintenanceTask.status==='running'&&/*#__PURE__*/React.createElement("span",{className:"text-[11px] mr-2",style:{color:'#efc006'}},maintenanceTask.migrated_count||0,"/",maintenanceTask.total_vms||'?'," VMs"),/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();onOpenNodeConfig&&onOpenNodeConfig(name);},className:"p-0.5 hover:text-white",style:{color:'#728b9a'},title:t('settings')||'Settings'},/*#__PURE__*/React.createElement(Icons.Settings,{className:"w-3.5 h-3.5"}))):/*#__PURE__*/React.createElement("span",{className:"text-[12px]",style:{color:'#f54f47'}},t('nodeUnreachable')||'Node unreachable')),expanded&&!isOffline&&metrics&&/*#__PURE__*/React.createElement("div",{className:"px-3 pb-3 pt-1 ml-5",style:{borderTop:'1px solid #37474f'}},isUpdating&&updateTask&&/*#__PURE__*/React.createElement("div",{className:"mb-2 p-2 text-[12px]",style:{background:updateTask.status==='failed'?'rgba(245,79,71,0.08)':updateTask.status==='completed'?'rgba(96,181,21,0.08)':'rgba(73,175,217,0.08)',border:`1px solid ${updateTask.status==='failed'?'rgba(245,79,71,0.2)':updateTask.status==='completed'?'rgba(96,181,21,0.2)':'rgba(73,175,217,0.2)'}`}},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2",style:{color:updateTask.status==='failed'?'#f54f47':updateTask.status==='completed'?'#60b515':'#49afd9'}},updateTask.status==='completed'?/*#__PURE__*/React.createElement(Icons.CheckCircle,{className:"w-3 h-3"}):updateTask.status==='failed'?/*#__PURE__*/React.createElement(Icons.XCircle,{className:"w-3 h-3"}):/*#__PURE__*/React.createElement(Icons.Download,{className:"w-3 h-3"}),/*#__PURE__*/React.createElement("span",{className:"font-medium"},updateTask.status==='failed'?t('updateFailed'):updateTask.status==='completed'?t('updateCompleted'):t('updateRunning'),": ",updateTask.phase||'...')),(updateTask.status==='completed'||updateTask.status==='failed')&&/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();fetch(`${API_URL}/clusters/${clusterId}/nodes/${name}/update`,{method:'DELETE',credentials:'include',headers:getAuthHeaders()}).catch(()=>{});},className:"text-[10px] px-1.5 py-0.5 hover:text-white",style:{color:'#728b9a'}},"\u2715")),updateTask.output&&updateTask.output.length>0&&/*#__PURE__*/React.createElement("pre",{className:"mt-1 text-[10px] font-mono max-h-16 overflow-y-auto",style:{color:'#728b9a'}},(updateTask.output_lines||updateTask.output).slice(-3).map(l=>typeof l==='object'?l.text:l).join('\n')),updateTask.status==='completed'&&updateTask.packages_upgraded&&/*#__PURE__*/React.createElement("div",{className:"mt-1",style:{color:'#60b515'}},t('updateCompleted')," - ",updateTask.packages_upgraded," ",t('packagesUpdated')),updateTask.status==='failed'&&updateTask.error&&/*#__PURE__*/React.createElement("div",{className:"mt-1",style:{color:'#f54f47'}},updateTask.error)),isInMaintenance&&maintenanceTask&&/*#__PURE__*/React.createElement("div",{className:"mb-2 p-2 text-[12px]",style:{background:'rgba(239, 192, 6, 0.08)',border:'1px solid rgba(239, 192, 6, 0.2)'}},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2",style:{color:'#efc006'}},/*#__PURE__*/React.createElement(Icons.Wrench,{className:"w-3 h-3"}),/*#__PURE__*/React.createElement("span",{className:"font-medium"},t('maintenance')),/*#__PURE__*/React.createElement("span",{style:{color:'#728b9a'}},"- ",maintenanceTask.status==='completed'?t('ready'):maintenanceTask.status==='completed_with_errors'?t('completedWithErrors'):maintenanceTask.status==='evacuating'?t('evacuating'):maintenanceTask.status==='failed'?t('failed'):maintenanceTask.status==='running'?t('running')||'Running':maintenanceTask.status)),(maintenanceTask.status==='running'||maintenanceTask.status==='evacuating')&&maintenanceTask.total_vms>0&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("div",{className:"w-16 h-1 overflow-hidden",style:{background:'#1b2a32',borderRadius:'1px'}},/*#__PURE__*/React.createElement("div",{className:"h-full",style:{width:`${(maintenanceTask.migrated_count||maintenanceTask.migrated_vms||0)/maintenanceTask.total_vms*100}%`,background:'#efc006',borderRadius:'1px'}})),/*#__PURE__*/React.createElement("span",{style:{color:'#efc006'}},maintenanceTask.migrated_count||maintenanceTask.migrated_vms||0,"/",maintenanceTask.total_vms))),maintenanceTask.failed_vms&&maintenanceTask.failed_vms.length>0&&/*#__PURE__*/React.createElement("div",{className:"mt-1",style:{color:'#f54f47'}},t('failedToMigrate'),": ",maintenanceTask.failed_vms.map(v=>v.name||v.vmid).join(', ')),maintenanceTask.status==='completed_with_errors'&&!metrics.maintenance_acknowledged&&/*#__PURE__*/React.createElement("div",{className:"mt-1.5 flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();if(confirm(t('forceMaintenanceWarning')||'Proceeding may stop remaining VMs. Continue?')){fetch(`${API_URL}/clusters/${clusterId}/nodes/${name}/maintenance/acknowledge`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'}}).catch(()=>{});}},className:"px-2 py-0.5 text-[11px] font-medium",style:{background:'rgba(239,192,6,0.15)',color:'#efc006',border:'1px solid rgba(239,192,6,0.3)'}},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-2.5 h-2.5 inline mr-1"}),t('proceedAnyway')),/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();onMaintenanceToggle&&onMaintenanceToggle(name,false);},className:"px-2 py-0.5 text-[11px] font-medium",style:{background:'rgba(96,181,21,0.1)',color:'#60b515',border:'1px solid rgba(96,181,21,0.3)'}},t('exitMaintenance')))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-x-6 gap-y-1 text-[12px] mb-2"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{style:{color:'#728b9a'}},t('disk'),": "),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4'}},metrics.disk_percent?.toFixed(1)||'-',"%"),metrics.disk_total&&/*#__PURE__*/React.createElement("span",{style:{color:'#728b9a'}}," (",formatBytes(metrics.disk_used||0)," / ",formatBytes(metrics.disk_total),")")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{style:{color:'#728b9a'}},"Load: "),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4'}},Array.isArray(metrics.loadavg)?metrics.loadavg.map(l=>typeof l==='number'?l.toFixed(2):l).join(' / '):typeof metrics.loadavg==='number'?metrics.loadavg.toFixed(2):metrics.loadavg||'-')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{style:{color:'#728b9a'}},t('cpuCores'),": "),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4'}},metrics.cpus||metrics.cpu_count||(metrics.cpuinfo?`${metrics.cpuinfo.cores||metrics.cpuinfo.cpus||'-'} Ã— ${metrics.cpuinfo.sockets||1}`:'-'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{style:{color:'#728b9a'}},t('uptime'),": "),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4'}},formatUptime(metrics.uptime))),(metrics.kernel_version||metrics.kversion)&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{style:{color:'#728b9a'}},t('kernel')||'Kernel',": "),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4'}},metrics.kernel_version||(metrics.kversion?metrics.kversion.split(' ')[0]:''))),(metrics.pve_version||metrics.pveversion)&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{style:{color:'#728b9a'}},"PVE: "),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4'}},metrics.pve_version||metrics.pveversion))),/*#__PURE__*/React.createElement("div",{className:"corp-toolbar flex flex-wrap items-center gap-1 pt-1",style:{borderTop:'1px solid #37474f'}},!isInMaintenance?/*#__PURE__*/React.createElement("button",{onClick:()=>setShowMaintenanceConfirm(true)},/*#__PURE__*/React.createElement(Icons.Wrench,{className:"w-3 h-3",style:{color:'#efc006'}})," ",t('enterMaintenance')||t('maintenance')):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("button",{onClick:()=>onMaintenanceToggle&&onMaintenanceToggle(name,false)},/*#__PURE__*/React.createElement(Icons.X,{className:"w-3 h-3",style:{color:'#60b515'}})," ",t('exitMaintenance')),canUpdate&&/*#__PURE__*/React.createElement("button",{onClick:()=>setShowUpdateConfirm(true)},/*#__PURE__*/React.createElement(Icons.Download,{className:"w-3 h-3",style:{color:'#49afd9'}})," ",t('startUpdate')),maintenanceTask?.status&&['completed','completed_with_errors'].includes(maintenanceTask.status)&&/*#__PURE__*/React.createElement(React.Fragment,null,onRemoveNode&&/*#__PURE__*/React.createElement("button",{onClick:()=>onRemoveNode(name)},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-3 h-3",style:{color:'#f54f47'}})," ",t('removeNodeFromCluster')),onMoveNode&&/*#__PURE__*/React.createElement("button",{onClick:()=>onMoveNode(name)},/*#__PURE__*/React.createElement(Icons.ArrowRight,{className:"w-3 h-3"})," ",t('moveNodeToCluster')))),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowRebootConfirm(true)},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-3 h-3",style:{color:'#efc006'}})," ",t('reboot')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowShutdownConfirm(true)},/*#__PURE__*/React.createElement(Icons.Power,{className:"w-3 h-3",style:{color:'#f54f47'}})," ",t('shutdown')))),showMaintenanceConfirm&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-sm bg-proxmox-card border border-proxmox-border p-5"},/*#__PURE__*/React.createElement("h3",{className:"text-[14px] font-semibold mb-2",style:{color:'#e9ecef'}},t('enterMaintenance')||'Enter Maintenance Mode'),/*#__PURE__*/React.createElement("p",{className:"text-[13px] mb-4",style:{color:'#adbbc4'}},t('maintenanceWarning')||`All VMs on ${name} will be migrated to other nodes.`),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowMaintenanceConfirm(false),className:"px-3 py-1.5 text-[13px] border border-proxmox-border hover:text-white",style:{color:'#adbbc4'}},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:()=>{onMaintenanceToggle&&onMaintenanceToggle(name,true);setShowMaintenanceConfirm(false);},className:"px-3 py-1.5 text-[13px] text-white",style:{background:'#efc006',border:'1px solid #d4a905'}},t('confirm')||'Confirm')))),showUpdateConfirm&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-sm bg-proxmox-card border border-proxmox-border p-5"},/*#__PURE__*/React.createElement("h3",{className:"text-[14px] font-semibold mb-2",style:{color:'#e9ecef'}},t('startUpdate')||'Start Update'),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-[13px] mb-4",style:{color:'#adbbc4'}},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:updateWithReboot,onChange:e=>setUpdateWithReboot(e.target.checked)}),t('rebootAfterUpdate')||'Reboot after update'),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowUpdateConfirm(false),className:"px-3 py-1.5 text-[13px] border border-proxmox-border hover:text-white",style:{color:'#adbbc4'}},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:()=>{onStartUpdate&&onStartUpdate(name,updateWithReboot);setShowUpdateConfirm(false);},className:"px-3 py-1.5 text-[13px] text-white",style:{background:'#49afd9',border:'1px solid #3d9bc2'}},t('startUpdate')||'Start')))),showRebootConfirm&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-sm bg-proxmox-card border border-proxmox-border p-5"},/*#__PURE__*/React.createElement("h3",{className:"text-[14px] font-semibold mb-2",style:{color:'#e9ecef'}},t('rebootNode')||`Reboot ${name}`),/*#__PURE__*/React.createElement("p",{className:"text-[13px] mb-4",style:{color:'#adbbc4'}},t('rebootWarning')||'This will reboot the node. All VMs will be affected.'),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowRebootConfirm(false),className:"px-3 py-1.5 text-[13px] border border-proxmox-border hover:text-white",style:{color:'#adbbc4'}},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:()=>{onNodeAction&&onNodeAction(name,'reboot');setShowRebootConfirm(false);},className:"px-3 py-1.5 text-[13px] text-white",style:{background:'#efc006',border:'1px solid #d4a905'}},t('reboot'))))),showShutdownConfirm&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-sm bg-proxmox-card border border-proxmox-border p-5"},/*#__PURE__*/React.createElement("h3",{className:"text-[14px] font-semibold mb-2",style:{color:'#e9ecef'}},t('shutdownNode')||`Shutdown ${name}`),/*#__PURE__*/React.createElement("p",{className:"text-[13px] mb-4",style:{color:'#adbbc4'}},t('shutdownWarning')||'This will shut down the node.'),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowShutdownConfirm(false),className:"px-3 py-1.5 text-[13px] border border-proxmox-border hover:text-white",style:{color:'#adbbc4'}},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:()=>{onNodeAction&&onNodeAction(name,'shutdown');setShowShutdownConfirm(false);},className:"px-3 py-1.5 text-[13px] text-white",style:{background:'#f54f47',border:'1px solid #d4433d'}},t('shutdown'))))));}// Resource Table Component
// LW: The main VM/CT list - supports cards, table, and detail view
// NS: Added bulk select for mass operations (migration, etc.)
// This component does a lot... might need to split it up eventually
// FIXME: rerenders too often, useMemo wuold help probably
function ResourceTable({resources,clusterId,clusters,sourceCluster,onVmAction,onOpenConsole,onOpenConfig,onMigrate,onBulkMigrate,onDelete,onClone,onForceStop,onCrossClusterMigrate,nodes,onOpenTags,highlightedVm,addToast}){const{t}=useTranslation();const{isCorporate}=useLayout();// LW: Feb 2026 - corporate defaults to table view
const[search,setSearch]=useState('');const[filter,setFilter]=useState('all');const[sortBy,setSortBy]=useState('vmid');const[sortDir,setSortDir]=useState('asc');const[viewMode,setViewMode]=useState(isCorporate?'table':'cards');// LW: corporate defaults to table
const[actionLoading,setActionLoading]=useState({});const[selectedVms,setSelectedVms]=useState([]);const[showMigrateModal,setShowMigrateModal]=useState(null);const[showBulkMigrate,setShowBulkMigrate]=useState(false);const[showDeleteConfirm,setShowDeleteConfirm]=useState(null);const[showCloneModal,setShowCloneModal]=useState(null);const[selectedDetailVm,setSelectedDetailVm]=useState(null);// For detail view
const highlightedRowRef=useRef(null);// Pagination states - MK Jan 2026
// LW: Moved up 25.01.2026 - must be declared before useEffect that uses them
// This was breaking pre-compiled builds (GitHub Issue #4)
// Browser-Babel was more forgiving but compiled JS enforces strict declaration order
const[currentPage,setCurrentPage]=useState(1);const[itemsPerPage,setItemsPerPage]=useState(50);// Default 50, options: 50, 100, 200, 500
// NS: scroll to highlighted VM from global search
// claude helped with the pagination math here - kept getting off-by-one errors
useEffect(()=>{if(highlightedVm){// clear filters first
setSearch('');setFilter('all');// jump to correct page
const vmIndex=resources.findIndex(r=>r.vmid===highlightedVm.vmid);if(vmIndex!==-1){const targetPage=Math.floor(vmIndex/itemsPerPage)+1;setCurrentPage(targetPage);}// wait for render then scroll
setTimeout(()=>{if(highlightedRowRef.current){highlightedRowRef.current.scrollIntoView({behavior:'smooth',block:'center'});}},100);}},[highlightedVm,resources,itemsPerPage]);// NS: Update selectedDetailVm when resources change (via SSE)
// This ensures the detail view shows the current status without re-selecting the VM
useEffect(()=>{if(selectedDetailVm&&resources){const updatedVm=resources.find(r=>r.vmid===selectedDetailVm.vmid);if(updatedVm){// Check if any relevant field changed
if(updatedVm.status!==selectedDetailVm.status||updatedVm.cpu!==selectedDetailVm.cpu||updatedVm.mem!==selectedDetailVm.mem||updatedVm.maxmem!==selectedDetailVm.maxmem||updatedVm.uptime!==selectedDetailVm.uptime||updatedVm.node!==selectedDetailVm.node||updatedVm.name!==selectedDetailVm.name||updatedVm.netin!==selectedDetailVm.netin||updatedVm.netout!==selectedDetailVm.netout||updatedVm.diskread!==selectedDetailVm.diskread||updatedVm.diskwrite!==selectedDetailVm.diskwrite){setSelectedDetailVm(updatedVm);}}else{// VM was deleted or no longer in list
setSelectedDetailVm(null);}}},[resources]);const[showCrossClusterMigrate,setShowCrossClusterMigrate]=useState(null);const[showMetricsModal,setShowMetricsModal]=useState(null);// For VM metrics
const[openDropdown,setOpenDropdown]=useState(null);// action dropdown menu
const prevResources=useRef(resources);// for comparison, not really used
const filterLabels={all:t('all'),running:t('active'),stopped:t('stopped'),vm:'VM',lxc:'LXC'};// LW: filter + sort in one useMemo for perf
// TODO: maybe split this up, its getting complex
// MK: added tag/node/ip search, people kept complaining they couldnt find stuff
const filteredResources=useMemo(()=>{let filtered=resources.filter(r=>{// search by name, vmid, ip, node, or tags
const s=search.toLowerCase();const matchesSearch=!search||r.name?.toLowerCase().includes(s)||r.vmid?.toString().includes(s)||(r.node||'').toLowerCase().includes(s)||(r.ip||'').toLowerCase().includes(s)||(r.tags||'').toLowerCase().includes(s);const matchesFilter=filter==='all'||filter==='running'&&r.status==='running'||filter==='stopped'&&r.status==='stopped'||filter==='vm'&&r.type==='qemu'||filter==='lxc'&&r.type==='lxc';return matchesSearch&&matchesFilter;});// sort
filtered.sort((a,b)=>{const aVal=a[sortBy];const bVal=b[sortBy];const dir=sortDir==='asc'?1:-1;if(typeof aVal==='number')return(aVal-bVal)*dir;return String(aVal).localeCompare(String(bVal))*dir;});return filtered;},[resources,search,filter,sortBy,sortDir]);// Reset page when filters change - MK Jan 2026
// NS: Also reset when cluster changes (via clusterId) to avoid showing empty page
useEffect(()=>{setCurrentPage(1);},[search,filter,sortBy,sortDir,itemsPerPage,clusterId]);// Paginated resources - MK Jan 2026
const totalPages=Math.max(1,Math.ceil(filteredResources.length/itemsPerPage));// NS: Clamp currentPage to valid bounds - direct calculation, no effect loop
const effectivePage=Math.max(1,Math.min(currentPage,totalPages));// NS: Auto-correct if currentPage is out of bounds (e.g., after cluster switch)
useEffect(()=>{if(currentPage>totalPages&&totalPages>0){setCurrentPage(1);// Reset to first page
}},[filteredResources.length]);// Only when data changes
const paginatedResources=useMemo(()=>{const startIndex=(effectivePage-1)*itemsPerPage;return filteredResources.slice(startIndex,startIndex+itemsPerPage);},[filteredResources,effectivePage,itemsPerPage]);const handleSort=col=>{if(sortBy===col){setSortDir(sortDir==='asc'?'desc':'asc');}else{setSortBy(col);setSortDir('asc');// reset to asc on new column
}};// NS: 1073741824 = 1024^3 (GB), 1048576 = 1024^2 (MB)
const formatBytes=bytes=>{const gb=bytes/1073741824;return gb>=1?`${gb.toFixed(1)} GB`:`${(bytes/1048576).toFixed(0)} MB`;};// old version for reference
// const formatBytes2 = (b) => b >= 1073741824 ? `${(b/1073741824).toFixed(1)} GB` : `${(b/1048576).toFixed(0)} MB`;
const handleAction=async(resource,action)=>{const key=`${resource.vmid}-${action}`;setActionLoading(prev=>({...prev,[key]:true}));await onVmAction(resource,action);setActionLoading(prev=>({...prev,[key]:false}));};const toggleSelect=resource=>{setSelectedVms(prev=>{const exists=prev.find(v=>v.vmid===resource.vmid);if(exists){return prev.filter(v=>v.vmid!==resource.vmid);}return[...prev,{vmid:resource.vmid,node:resource.node,type:resource.type,name:resource.name}];});};const toggleSelectAll=()=>{if(selectedVms.length===filteredResources.length){setSelectedVms([]);}else{setSelectedVms(filteredResources.map(r=>({vmid:r.vmid,node:r.node,type:r.type,name:r.name})));}};const groupedByNode=useMemo(()=>{const groups={};filteredResources.forEach(r=>{if(!groups[r.node])groups[r.node]=[];groups[r.node].push(r);});return groups;},[filteredResources]);return/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"relative flex-1 min-w-[200px]"},/*#__PURE__*/React.createElement(Icons.Search,null),/*#__PURE__*/React.createElement("input",{type:"text",placeholder:t('searchByNameOrId'),value:search,onChange:e=>setSearch(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-sm text-white placeholder-gray-500 focus:outline-none focus:border-proxmox-orange transition-colors"}),/*#__PURE__*/React.createElement("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"},/*#__PURE__*/React.createElement(Icons.Search,null))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},['all','running','stopped','vm','lxc'].map(f=>/*#__PURE__*/React.createElement("button",{key:f,onClick:()=>setFilter(f),className:`px-3 py-1.5 text-xs font-medium rounded-lg transition-all ${filter===f?'bg-proxmox-orange text-white':'bg-proxmox-dark text-gray-400 hover:text-white border border-proxmox-border'}`},filterLabels[f]))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1 p-1 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("button",{onClick:()=>setViewMode('cards'),className:`p-1.5 rounded transition-colors ${viewMode==='cards'?'bg-proxmox-orange text-white':'text-gray-400 hover:text-white'}`,title:t('gridView')},/*#__PURE__*/React.createElement(Icons.Grid,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>setViewMode('table'),className:`p-1.5 rounded transition-colors ${viewMode==='table'?'bg-proxmox-orange text-white':'text-gray-400 hover:text-white'}`,title:t('listView')},/*#__PURE__*/React.createElement(Icons.List,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>setViewMode('detail'),className:`p-1.5 rounded transition-colors ${viewMode==='detail'?'bg-proxmox-orange text-white':'text-gray-400 hover:text-white'}`,title:t('compactView')},/*#__PURE__*/React.createElement(Icons.Eye,null)))),selectedVms.length>0&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3 p-3 bg-proxmox-orange/10 border border-proxmox-orange/30 rounded-lg"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-proxmox-orange font-medium"},selectedVms.length," ",t('selectedItems')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowBulkMigrate(true),className:"flex items-center gap-2 px-3 py-1.5 bg-blue-600 rounded-lg text-white text-sm hover:bg-blue-700"},/*#__PURE__*/React.createElement(Icons.ArrowRight,null),t('migrate')),/*#__PURE__*/React.createElement("button",{onClick:()=>setSelectedVms([]),className:"px-3 py-1.5 text-gray-400 hover:text-white text-sm"},t('deselectAll'))),viewMode==='cards'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},paginatedResources.length===0?/*#__PURE__*/React.createElement("div",{className:"col-span-full text-center py-12 text-gray-500"},t('noResults')):paginatedResources.map((resource,idx)=>/*#__PURE__*/React.createElement("div",{key:resource.vmid,ref:highlightedVm?.vmid===resource.vmid?highlightedRowRef:null,className:`bg-proxmox-card border rounded-xl overflow-hidden transition-all hover:border-proxmox-orange/50 animate-fade-in ${selectedVms.find(v=>v.vmid===resource.vmid)?'border-proxmox-orange bg-proxmox-orange/5':highlightedVm?.vmid===resource.vmid?'ring-2 ring-proxmox-orange border-proxmox-orange bg-proxmox-orange/20':'border-proxmox-border'}`,style:{animationDelay:`${idx*30}ms`}},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between p-4 border-b border-proxmox-border bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:!!selectedVms.find(v=>v.vmid===resource.vmid),onChange:()=>toggleSelect(resource),className:"w-4 h-4 rounded border-proxmox-border bg-proxmox-dark text-proxmox-orange"}),/*#__PURE__*/React.createElement("div",{className:`p-2 rounded-lg ${resource.type==='qemu'?'bg-blue-500/10':'bg-purple-500/10'}`},resource.type==='qemu'?/*#__PURE__*/React.createElement(Icons.VM,null):/*#__PURE__*/React.createElement(Icons.Container,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"font-medium text-white truncate max-w-[150px]"},resource.name||`${resource.type==='qemu'?'VM':'CT'} ${resource.vmid}`),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"ID: ",resource.vmid))),/*#__PURE__*/React.createElement("span",{className:`w-2.5 h-2.5 rounded-full ${resource.status==='running'?'bg-green-500 animate-pulse':'bg-red-500'}`})),/*#__PURE__*/React.createElement("div",{className:"p-4 space-y-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between text-sm"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},t('node')),/*#__PURE__*/React.createElement("span",{className:"text-gray-300 font-mono"},resource.node)),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between text-sm"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},t('status')),/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${resource.status==='running'?'bg-green-500/10 text-green-400':'bg-red-500/10 text-red-400'}`},resource.status==='running'?t('running'):t('stopped'))),resource.tags&&/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-1"},resource.tags.split(';').filter(t=>t.trim()).map((tag,i)=>/*#__PURE__*/React.createElement("span",{key:i,className:"px-1.5 py-0.5 text-xs rounded bg-proxmox-orange/20 text-proxmox-orange"},tag.trim()))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between text-xs mb-1"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},t('ram')),/*#__PURE__*/React.createElement("span",{className:"text-gray-400 font-mono"},formatBytes(resource.mem)," / ",formatBytes(resource.maxmem))),/*#__PURE__*/React.createElement("div",{className:"h-1.5 rounded-full bg-proxmox-border overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"h-full rounded-full transition-all",style:{width:`${resource.mem_percent||0}%`,background:resource.mem_percent<50?'#22c55e':resource.mem_percent<80?'#eab308':'#ef4444'}}))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between text-xs mb-1"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},t('cpu')),/*#__PURE__*/React.createElement("span",{className:"text-gray-400 font-mono"},(resource.cpu_percent||0).toFixed(1),"% ",resource.maxcpu&&`(${resource.maxcpu} ${t('cores')})`)),/*#__PURE__*/React.createElement("div",{className:"h-1.5 rounded-full bg-proxmox-border overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"h-full rounded-full transition-all",style:{width:`${Math.min(resource.cpu_percent||0,100)}%`,background:(resource.cpu_percent||0)<50?'#3b82f6':(resource.cpu_percent||0)<80?'#eab308':'#ef4444'}})))),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between p-3 border-t border-proxmox-border bg-proxmox-dark/30"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1"},resource.status==='stopped'?/*#__PURE__*/React.createElement("button",{onClick:()=>handleAction(resource,'start'),disabled:actionLoading[`${resource.vmid}-start`],className:"p-1.5 rounded-lg hover:bg-green-500/20 text-gray-400 hover:text-green-400 transition-all disabled:opacity-50",title:t('start')},actionLoading[`${resource.vmid}-start`]?/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"animate-spin"}):/*#__PURE__*/React.createElement(Icons.PlayCircle,null)):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("button",{onClick:()=>handleAction(resource,'shutdown'),disabled:actionLoading[`${resource.vmid}-shutdown`],className:"p-1.5 rounded-lg hover:bg-yellow-500/20 text-gray-400 hover:text-yellow-400 transition-all disabled:opacity-50",title:t('shutdown')},actionLoading[`${resource.vmid}-shutdown`]?/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"animate-spin"}):/*#__PURE__*/React.createElement(Icons.Power,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>handleAction(resource,'reboot'),disabled:actionLoading[`${resource.vmid}-reboot`],className:"p-1.5 rounded-lg hover:bg-orange-500/20 text-gray-400 hover:text-orange-400 transition-all disabled:opacity-50",title:t('reboot')},actionLoading[`${resource.vmid}-reboot`]?/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"animate-spin"}):/*#__PURE__*/React.createElement(Icons.RefreshCw,null))),resource.status==='running'&&/*#__PURE__*/React.createElement("button",{onClick:()=>onOpenConsole(resource),className:"p-1.5 rounded-lg hover:bg-blue-500/20 text-gray-400 hover:text-blue-400 transition-all",title:t('console')},/*#__PURE__*/React.createElement(Icons.Monitor,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>onOpenConfig(resource),className:"p-1.5 rounded-lg hover:bg-purple-500/20 text-gray-400 hover:text-purple-400 transition-all",title:t('configuration')},/*#__PURE__*/React.createElement(Icons.Cog,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowMigrateModal(resource),className:"p-1.5 rounded-lg hover:bg-cyan-500/20 text-gray-400 hover:text-cyan-400 transition-all",title:t('migrate')},/*#__PURE__*/React.createElement(Icons.ArrowRight,null))),/*#__PURE__*/React.createElement("div",{className:"relative"},/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();setOpenDropdown(openDropdown===resource.vmid?null:resource.vmid);},className:"p-1.5 rounded-lg hover:bg-proxmox-hover text-gray-400 hover:text-white transition-all",title:t('moreActions')},/*#__PURE__*/React.createElement(Icons.MoreVertical,null)),openDropdown===resource.vmid&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-40",onClick:()=>setOpenDropdown(null)}),/*#__PURE__*/React.createElement("div",{className:"absolute right-0 bottom-full mb-1 w-48 bg-proxmox-card border border-proxmox-border rounded-lg shadow-xl z-50 py-1 animate-fade-in"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowMigrateModal(resource);setOpenDropdown(null);},className:"w-full px-3 py-2 text-left text-sm text-gray-300 hover:bg-proxmox-hover flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.ArrowRight,{className:"w-4 h-4"}),t('migrate')),clusters&&clusters.length>1&&/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowCrossClusterMigrate(resource);setOpenDropdown(null);},className:"w-full px-3 py-2 text-left text-sm text-gray-300 hover:bg-proxmox-hover flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Globe,{className:"w-4 h-4"}),t('crossClusterMigrate')),/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowMetricsModal(resource);setOpenDropdown(null);},className:"w-full px-3 py-2 text-left text-sm text-gray-300 hover:bg-proxmox-hover flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.BarChart,{className:"w-4 h-4"}),t('performance')),/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowCloneModal(resource);setOpenDropdown(null);},className:"w-full px-3 py-2 text-left text-sm text-gray-300 hover:bg-proxmox-hover flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Copy,{className:"w-4 h-4"}),t('clone')),resource.status==='running'&&/*#__PURE__*/React.createElement(React.Fragment,null,resource.type==='qemu'&&/*#__PURE__*/React.createElement("button",{onClick:()=>{onVmAction(resource,'reset');setOpenDropdown(null);},className:"w-full px-3 py-2 text-left text-sm text-yellow-400 hover:bg-yellow-500/10 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Zap,{className:"w-4 h-4"}),t('forceReset')),/*#__PURE__*/React.createElement("button",{onClick:()=>{onForceStop(resource);setOpenDropdown(null);},className:"w-full px-3 py-2 text-left text-sm text-yellow-400 hover:bg-yellow-500/10 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.XCircle,{className:"w-4 h-4"}),t('forceStop'))),/*#__PURE__*/React.createElement("div",{className:"border-t border-proxmox-border my-1"}),/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowDeleteConfirm(resource);setOpenDropdown(null);},className:"w-full px-3 py-2 text-left text-sm text-red-400 hover:bg-red-500/10 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-4 h-4"}),t('delete'))))))))),viewMode==='table'&&/*#__PURE__*/React.createElement("div",{className:isCorporate?'overflow-hidden border border-proxmox-border':'overflow-hidden rounded-xl border border-proxmox-border'},/*#__PURE__*/React.createElement("table",{className:`w-full ${isCorporate?'corp-datagrid':''}`},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",{className:isCorporate?'text-left':'bg-proxmox-dark text-left',style:isCorporate?{background:'#22343c'}:undefined},/*#__PURE__*/React.createElement("th",{className:isCorporate?'px-2 py-1.5 w-8':'px-4 py-3 w-10'},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:selectedVms.length===filteredResources.length&&filteredResources.length>0,onChange:toggleSelectAll,className:"w-4 h-4 rounded border-proxmox-border bg-proxmox-dark text-proxmox-orange focus:ring-proxmox-orange"})),[{key:'vmid',label:'ID'},{key:'name',label:t('name')},{key:'type',label:t('type')},{key:'node',label:'Node'},{key:'mem',label:'RAM'},{key:'status',label:'Status'},{key:'actions',label:t('actions')}].map(col=>/*#__PURE__*/React.createElement("th",{key:col.key,onClick:()=>col.key!=='actions'&&handleSort(col.key),className:isCorporate?`text-xs font-semibold uppercase tracking-wider ${col.key!=='actions'?'cursor-pointer hover:text-white':''}`:`px-4 py-3 text-xs font-semibold text-gray-400 uppercase tracking-wider ${col.key!=='actions'?'cursor-pointer hover:text-white':''} transition-colors`,style:isCorporate?{color:'#adbbc4',padding:'6px 8px',fontSize:'12px'}:undefined},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1"},col.label,sortBy===col.key&&/*#__PURE__*/React.createElement("span",{className:isCorporate?'sort-indicator':'text-proxmox-orange',style:isCorporate?{color:'#49afd9'}:undefined},sortDir==='asc'?'â†‘':'â†“')))))),/*#__PURE__*/React.createElement("tbody",{className:isCorporate?'':'divide-y divide-proxmox-border'},paginatedResources.length===0?/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:8,className:isCorporate?'px-2 py-4 text-center text-gray-500':'px-4 py-8 text-center text-gray-500'},t('noResults'))):paginatedResources.map((resource,idx)=>/*#__PURE__*/React.createElement("tr",{key:resource.vmid,ref:highlightedVm?.vmid===resource.vmid?highlightedRowRef:null,className:isCorporate?`table-row-hover ${selectedVms.find(v=>v.vmid===resource.vmid)?'corp-row-selected':''} ${highlightedVm?.vmid===resource.vmid?'corp-row-selected':''}`:`table-row-hover bg-proxmox-card animate-fade-in ${selectedVms.find(v=>v.vmid===resource.vmid)?'bg-proxmox-orange/5':''} ${highlightedVm?.vmid===resource.vmid?'ring-2 ring-proxmox-orange bg-proxmox-orange/20':''}`,style:isCorporate?undefined:{animationDelay:`${idx*30}ms`}},/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:!!selectedVms.find(v=>v.vmid===resource.vmid),onChange:()=>toggleSelect(resource),className:"w-4 h-4 rounded border-proxmox-border bg-proxmox-dark text-proxmox-orange focus:ring-proxmox-orange"})),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("span",{className:"font-mono text-sm text-gray-300"},resource.vmid)),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"font-medium text-white"},resource.name||'-'),resource.tags&&/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-1 mt-1"},resource.tags.split(';').filter(t=>t.trim()).slice(0,3).map((tag,i)=>/*#__PURE__*/React.createElement("span",{key:i,className:"px-1.5 py-0.5 text-xs rounded bg-proxmox-orange/20 text-proxmox-orange"},tag.trim())),resource.tags.split(';').filter(t=>t.trim()).length>3&&/*#__PURE__*/React.createElement("span",{className:"px-1.5 py-0.5 text-xs rounded bg-gray-500/20 text-gray-400"},"+",resource.tags.split(';').filter(t=>t.trim()).length-3)))),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("span",{className:`inline-flex items-center gap-1.5 px-2 py-1 rounded-md text-xs font-medium ${resource.type==='qemu'?'bg-blue-500/10 text-blue-400 border border-blue-500/20':'bg-purple-500/10 text-purple-400 border border-purple-500/20'}`},resource.type==='qemu'?/*#__PURE__*/React.createElement(Icons.VM,null):/*#__PURE__*/React.createElement(Icons.Container,null),resource.type==='qemu'?'VM':'LXC')),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},resource.node)),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("div",{className:"flex-1 max-w-[100px]"},/*#__PURE__*/React.createElement("div",{className:"h-1.5 rounded-full bg-proxmox-border overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"h-full rounded-full transition-all",style:{width:`${resource.mem_percent||0}%`,background:resource.mem_percent<50?'#22c55e':resource.mem_percent<80?'#eab308':'#ef4444'}}))),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-400 font-mono whitespace-nowrap"},formatBytes(resource.mem)," / ",formatBytes(resource.maxmem)))),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("span",{className:`inline-flex items-center gap-1.5 px-2 py-1 rounded-md text-xs font-medium ${resource.status==='running'?'bg-green-500/10 text-green-400 border border-green-500/20':resource.status==='stopped'?'bg-red-500/10 text-red-400 border border-red-500/20':'bg-gray-500/10 text-gray-400 border border-gray-500/20'}`},/*#__PURE__*/React.createElement("span",{className:`w-1.5 h-1.5 rounded-full ${resource.status==='running'?'bg-green-400':'bg-red-400'}`}),resource.status)),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1"},/*#__PURE__*/React.createElement("button",{onClick:()=>onOpenConfig(resource),className:"p-1.5 rounded-lg bg-proxmox-dark hover:bg-purple-500/20 text-gray-400 hover:text-purple-400 transition-all",title:t('configuration')},/*#__PURE__*/React.createElement(Icons.Cog,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>onOpenTags&&onOpenTags(resource),className:"p-1.5 rounded-lg bg-proxmox-dark hover:bg-yellow-500/20 text-gray-400 hover:text-yellow-400 transition-all",title:t('tags')},/*#__PURE__*/React.createElement(Icons.Tag,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowMetricsModal(resource),className:"p-1.5 rounded-lg bg-proxmox-dark hover:bg-blue-500/20 text-gray-400 hover:text-blue-400 transition-all",title:t('metrics')},/*#__PURE__*/React.createElement(Icons.BarChart,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowMigrateModal(resource),className:"p-1.5 rounded-lg bg-proxmox-dark hover:bg-cyan-500/20 text-gray-400 hover:text-cyan-400 transition-all",title:t('migrate')},/*#__PURE__*/React.createElement(Icons.ArrowRight,null)),clusters&&clusters.length>1&&/*#__PURE__*/React.createElement("button",{onClick:()=>setShowCrossClusterMigrate(resource),className:"p-1.5 rounded-lg bg-proxmox-dark hover:bg-emerald-500/20 text-gray-400 hover:text-emerald-400 transition-all",title:t('crossClusterMigrate')},/*#__PURE__*/React.createElement(Icons.Globe,null)),resource.status==='running'&&/*#__PURE__*/React.createElement("button",{onClick:()=>onOpenConsole(resource),className:"p-1.5 rounded-lg bg-proxmox-dark hover:bg-blue-500/20 text-gray-400 hover:text-blue-400 transition-all",title:t('openConsole')},/*#__PURE__*/React.createElement(Icons.Monitor,null)),resource.status==='stopped'?/*#__PURE__*/React.createElement("button",{onClick:()=>handleAction(resource,'start'),disabled:actionLoading[`${resource.vmid}-start`],className:"p-1.5 rounded-lg bg-proxmox-dark hover:bg-green-500/20 text-gray-400 hover:text-green-400 transition-all disabled:opacity-50",title:t('start')},actionLoading[`${resource.vmid}-start`]?/*#__PURE__*/React.createElement(Icons.RotateCw,null):/*#__PURE__*/React.createElement(Icons.PlayCircle,null)):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("button",{onClick:()=>handleAction(resource,'shutdown'),disabled:actionLoading[`${resource.vmid}-shutdown`],className:"p-1.5 rounded-lg bg-proxmox-dark hover:bg-yellow-500/20 text-gray-400 hover:text-yellow-400 transition-all disabled:opacity-50",title:t('shutdown')},actionLoading[`${resource.vmid}-shutdown`]?/*#__PURE__*/React.createElement(Icons.RotateCw,null):/*#__PURE__*/React.createElement(Icons.Power,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>onForceStop(resource),disabled:actionLoading[`${resource.vmid}-stop`],className:"p-1.5 rounded-lg bg-proxmox-dark hover:bg-red-500/20 text-gray-400 hover:text-red-400 transition-all disabled:opacity-50",title:t('forceStop')},actionLoading[`${resource.vmid}-stop`]?/*#__PURE__*/React.createElement(Icons.RotateCw,null):/*#__PURE__*/React.createElement(Icons.XCircle,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>handleAction(resource,'reboot'),disabled:actionLoading[`${resource.vmid}-reboot`],className:"p-1.5 rounded-lg bg-proxmox-dark hover:bg-orange-500/20 text-gray-400 hover:text-orange-400 transition-all disabled:opacity-50",title:t('reboot')},actionLoading[`${resource.vmid}-reboot`]?/*#__PURE__*/React.createElement(Icons.RotateCw,null):/*#__PURE__*/React.createElement(Icons.RefreshCw,null)),resource.type==='qemu'&&/*#__PURE__*/React.createElement("button",{onClick:()=>handleAction(resource,'reset'),disabled:actionLoading[`${resource.vmid}-reset`],className:"p-1.5 rounded-lg bg-proxmox-dark hover:bg-orange-500/20 text-gray-400 hover:text-orange-400 transition-all disabled:opacity-50",title:t('forceReset')},actionLoading[`${resource.vmid}-reset`]?/*#__PURE__*/React.createElement(Icons.RotateCw,null):/*#__PURE__*/React.createElement(Icons.Zap,null))),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowCloneModal(resource),className:"p-1.5 rounded-lg bg-proxmox-dark hover:bg-blue-500/20 text-gray-400 hover:text-blue-400 transition-all",title:t('clone')},/*#__PURE__*/React.createElement(Icons.Copy,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowDeleteConfirm(resource),className:"p-1.5 rounded-lg bg-proxmox-dark hover:bg-red-500/20 text-gray-400 hover:text-red-400 transition-all",title:t('delete')},/*#__PURE__*/React.createElement(Icons.Trash,null))))))))),viewMode==='detail'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4"},/*#__PURE__*/React.createElement("div",{className:"lg:col-span-1 bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-3 border-b border-proxmox-border bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-medium text-gray-300"},"VMs & Container (",filteredResources.length,")")),/*#__PURE__*/React.createElement("div",{className:"max-h-[600px] overflow-y-auto"},paginatedResources.map(resource=>/*#__PURE__*/React.createElement("div",{key:resource.vmid,onClick:()=>setSelectedDetailVm(resource),className:`flex items-center gap-3 p-3 cursor-pointer transition-all border-b border-gray-700/50 ${selectedDetailVm?.vmid===resource.vmid?'bg-proxmox-orange/10 border-l-2 border-l-proxmox-orange':'hover:bg-proxmox-dark/50'}`},/*#__PURE__*/React.createElement("div",{className:`p-1.5 rounded ${resource.type==='qemu'?'bg-blue-500/10':'bg-purple-500/10'}`},resource.type==='qemu'?/*#__PURE__*/React.createElement(Icons.VM,null):/*#__PURE__*/React.createElement(Icons.Container,null)),/*#__PURE__*/React.createElement("div",{className:"flex-1 min-w-0"},/*#__PURE__*/React.createElement("div",{className:"font-medium text-white text-sm truncate"},resource.name||`${resource.type==='qemu'?'VM':'CT'} ${resource.vmid}`),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"ID: ",resource.vmid," \xB7 ",resource.node),resource.tags&&/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-1 mt-1"},resource.tags.split(';').filter(t=>t.trim()).slice(0,2).map((tag,i)=>/*#__PURE__*/React.createElement("span",{key:i,className:"px-1 py-0.5 text-xs rounded bg-proxmox-orange/20 text-proxmox-orange"},tag.trim())),resource.tags.split(';').filter(t=>t.trim()).length>2&&/*#__PURE__*/React.createElement("span",{className:"px-1 py-0.5 text-xs rounded bg-gray-500/20 text-gray-400"},"+",resource.tags.split(';').filter(t=>t.trim()).length-2))),/*#__PURE__*/React.createElement("span",{className:`w-2 h-2 rounded-full ${resource.status==='running'?'bg-green-500':'bg-red-500'}`}))))),/*#__PURE__*/React.createElement("div",{className:"lg:col-span-2"},selectedDetailVm?/*#__PURE__*/React.createElement(VmDetailPanel,{vm:selectedDetailVm,clusterId:clusterId,onAction:handleAction,onOpenConsole:onOpenConsole,onOpenConfig:onOpenConfig,onMigrate:()=>setShowMigrateModal(selectedDetailVm),onClone:()=>setShowCloneModal(selectedDetailVm),onForceStop:onForceStop,onDelete:()=>setShowDeleteConfirm(selectedDetailVm),onCrossClusterMigrate:vm=>setShowCrossClusterMigrate(vm),showCrossCluster:clusters&&clusters.length>1,actionLoading:actionLoading,onShowMetrics:vm=>setShowMetricsModal(vm),addToast:addToast}):/*#__PURE__*/React.createElement("div",{className:"h-full flex items-center justify-center bg-proxmox-card border border-proxmox-border rounded-xl p-12"},/*#__PURE__*/React.createElement("div",{className:"text-center text-gray-500"},/*#__PURE__*/React.createElement(Icons.Eye,null),/*#__PURE__*/React.createElement("p",{className:"mt-2"},t('selectVmFromList')||'Select a VM from the list'))))),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap items-center justify-between gap-4 text-sm text-gray-400 py-2"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("span",null,t('showing')," ",(effectivePage-1)*itemsPerPage+1,"-",Math.min(effectivePage*itemsPerPage,filteredResources.length)," ",t('of')," ",filteredResources.length," ",t('resources'),filteredResources.length!==resources.length&&` (${resources.length} ${t('total')})`),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},t('perPage'),":"),/*#__PURE__*/React.createElement("select",{value:itemsPerPage,onChange:e=>setItemsPerPage(Number(e.target.value)),className:"bg-proxmox-dark border border-proxmox-border rounded px-2 py-1 text-sm"},/*#__PURE__*/React.createElement("option",{value:50},"50"),/*#__PURE__*/React.createElement("option",{value:100},"100"),/*#__PURE__*/React.createElement("option",{value:200},"200"),/*#__PURE__*/React.createElement("option",{value:500},"500")))),totalPages>1&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1"},/*#__PURE__*/React.createElement("button",{onClick:()=>setCurrentPage(1),disabled:effectivePage===1,className:"px-2 py-1 rounded bg-proxmox-dark border border-proxmox-border disabled:opacity-30 hover:bg-proxmox-hover disabled:hover:bg-proxmox-dark",title:"First page"},"\xAB\xAB"),/*#__PURE__*/React.createElement("button",{onClick:()=>setCurrentPage(p=>Math.max(1,p-1)),disabled:effectivePage===1,className:"px-2 py-1 rounded bg-proxmox-dark border border-proxmox-border disabled:opacity-30 hover:bg-proxmox-hover disabled:hover:bg-proxmox-dark"},"\xAB"),Array.from({length:Math.min(5,totalPages)},(_,i)=>{let pageNum;if(totalPages<=5){pageNum=i+1;}else if(effectivePage<=3){pageNum=i+1;}else if(effectivePage>=totalPages-2){pageNum=totalPages-4+i;}else{pageNum=effectivePage-2+i;}return/*#__PURE__*/React.createElement("button",{key:pageNum,onClick:()=>setCurrentPage(pageNum),className:`px-3 py-1 rounded border ${effectivePage===pageNum?'bg-proxmox-orange text-white border-proxmox-orange':'bg-proxmox-dark border-proxmox-border hover:bg-proxmox-hover'}`},pageNum);}),/*#__PURE__*/React.createElement("button",{onClick:()=>setCurrentPage(p=>Math.min(totalPages,p+1)),disabled:effectivePage===totalPages,className:"px-2 py-1 rounded bg-proxmox-dark border border-proxmox-border disabled:opacity-30 hover:bg-proxmox-hover disabled:hover:bg-proxmox-dark"},"\xBB"),/*#__PURE__*/React.createElement("button",{onClick:()=>setCurrentPage(totalPages),disabled:effectivePage===totalPages,className:"px-2 py-1 rounded bg-proxmox-dark border border-proxmox-border disabled:opacity-30 hover:bg-proxmox-hover disabled:hover:bg-proxmox-dark",title:"Last page"},"\xBB\xBB")),/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},Object.keys(groupedByNode).length," Nodes")),showDeleteConfirm&&/*#__PURE__*/React.createElement(DeleteVmModal,{vm:showDeleteConfirm,clusterId:clusterId,onDelete:onDelete,onClose:()=>setShowDeleteConfirm(null)}),showCloneModal&&/*#__PURE__*/React.createElement(CloneVmModal,{vm:showCloneModal,nodes:nodes,clusterId:clusterId,onClone:onClone,onClose:()=>setShowCloneModal(null)}),showMigrateModal&&/*#__PURE__*/React.createElement(MigrateModal,{vm:showMigrateModal,nodes:nodes,clusterId:clusterId,onMigrate:onMigrate,onClose:()=>setShowMigrateModal(null)}),showBulkMigrate&&/*#__PURE__*/React.createElement(BulkMigrateModal,{vms:selectedVms,nodes:nodes,clusterId:clusterId,onMigrate:onBulkMigrate,onClose:()=>{setShowBulkMigrate(false);setSelectedVms([]);}}),showCrossClusterMigrate&&clusters&&clusters.length>1&&/*#__PURE__*/React.createElement(CrossClusterMigrateModal,{vm:showCrossClusterMigrate,sourceCluster:sourceCluster,clusters:clusters,onMigrate:onCrossClusterMigrate,onClose:()=>setShowCrossClusterMigrate(null)}),showMetricsModal&&/*#__PURE__*/React.createElement(VmMetricsModal,{vm:showMetricsModal,clusterId:clusterId,onClose:()=>setShowMetricsModal(null)}));}// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PegaProx - VM Modals
// Delete, Clone, Detail, Migrate, Snapshots, Replication
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Delete VM Modal Component
// NS: Added confirmation input after someone accidentally deleted prod VM
// Better safe than sorry...
function DeleteVmModal({vm,clusterId,onDelete,onClose}){const{t}=useTranslation();const[confirmName,setConfirmName]=useState('');const[purge,setPurge]=useState(false);const[destroyUnreferenced,setDestroyUnreferenced]=useState(false);const[loading,setLoading]=useState(false);const isQemu=vm.type==='qemu';const displayName=vm.name||`${isQemu?'VM':'CT'} ${vm.vmid}`;const canDelete=confirmName===vm.vmid.toString();const handleDelete=async()=>{if(!canDelete)return;setLoading(true);await onDelete(vm,{purge,destroyUnreferenced});setLoading(false);onClose();};return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/80"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-md bg-proxmox-card border border-red-500/30 rounded-xl overflow-hidden animate-scale-in"},/*#__PURE__*/React.createElement("div",{className:"p-6 border-b border-red-500/30 bg-red-500/10"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-3 rounded-full bg-red-500/20"},/*#__PURE__*/React.createElement(Icons.Trash,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white"},isQemu?'VM':'Container'," ",t('delete')),/*#__PURE__*/React.createElement("p",{className:"text-sm text-red-400"},t('deleteCannotBeUndone'))))),/*#__PURE__*/React.createElement("div",{className:"p-6 space-y-4"},/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:`p-2 rounded-lg ${isQemu?'bg-blue-500/10':'bg-purple-500/10'}`},isQemu?/*#__PURE__*/React.createElement(Icons.VM,null):/*#__PURE__*/React.createElement(Icons.Container,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"font-medium text-white"},displayName),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"ID: ",vm.vmid," \xB7 Node: ",vm.node)),/*#__PURE__*/React.createElement("span",{className:`ml-auto px-2 py-1 rounded text-xs ${vm.status==='running'?'bg-green-500/10 text-green-400':'bg-red-500/10 text-red-400'}`},vm.status))),vm.status==='running'&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg text-sm text-yellow-400"},"\u26A0\uFE0F ",isQemu?t('vmStillRunning'):t('ctStillRunning')),/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:purge,onChange:e=>setPurge(e.target.checked),className:"rounded"}),t('purgeDisks')),isQemu&&/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:destroyUnreferenced,onChange:e=>setDestroyUnreferenced(e.target.checked),className:"rounded"}),t('destroyUnreferencedDisks'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('enterToConfirm')," ",/*#__PURE__*/React.createElement("span",{className:"font-mono text-red-400"},vm.vmid),":"),/*#__PURE__*/React.createElement("input",{type:"text",value:confirmName,onChange:e=>setConfirmName(e.target.value),placeholder:vm.vmid.toString(),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white focus:border-red-500",autoFocus:true}))),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-proxmox-border bg-proxmox-dark"},/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"px-4 py-2 text-gray-300 hover:text-white"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:handleDelete,disabled:loading||!canDelete,className:"flex items-center gap-2 px-4 py-2 bg-red-600 rounded-lg text-white hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed"},loading&&/*#__PURE__*/React.createElement(Icons.RotateCw,null),/*#__PURE__*/React.createElement(Icons.Trash,null),t('deletePermanently')))));}// Clone VM Modal
// LW: Supports both linked clones and full clones
// Full clone takes longer but is independent from source
function CloneVmModal({vm,nodes,clusterId,onClone,onClose}){const{t}=useTranslation();const{getAuthHeaders}=useAuth();// NS: same pattern as everywhere else, maybe extract to hook someday
async function authFetch(url,opts){try{return await fetch(url,{...opts,headers:{...opts?.headers,...getAuthHeaders()}});}catch(e){console.error(e);return null;}}const[cloneConfig,setCloneConfig]=useState({name:`${vm.name||vm.vmid}-clone`,newid:'',full:true,// default to full clone
target_node:vm.node,description:''});const[loading,setLoading]=useState(false);const[loadingVmid,setLoadingVmid]=useState(true);const isQemu=vm.type==='qemu';// Get next available VMID on mount
useEffect(()=>{(async()=>{try{const r=await authFetch(`${API_URL}/clusters/${clusterId}/nextid`);if(r?.ok){const d=await r.json();setCloneConfig(prev=>({...prev,newid:d.vmid.toString()}));}}catch(err){console.error('to get next VMID:',err);}setLoadingVmid(false);})();},[clusterId]);const handleClone=async()=>{if(!cloneConfig.newid)return;setLoading(true);await onClone(vm,cloneConfig);setLoading(false);};return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/80"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-lg bg-proxmox-card border border-blue-500/30 rounded-xl overflow-hidden animate-scale-in"},/*#__PURE__*/React.createElement("div",{className:"p-6 border-b border-blue-500/30 bg-blue-500/10"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-3 rounded-full bg-blue-500/20"},/*#__PURE__*/React.createElement(Icons.Copy,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white"},isQemu?'VM':'Container'," ",t('clone')),/*#__PURE__*/React.createElement("p",{className:"text-sm text-blue-400"},vm.name||vm.vmid," ",t('willBeCloned'))))),/*#__PURE__*/React.createElement("div",{className:"p-6 space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('newVmId')),/*#__PURE__*/React.createElement("input",{type:"number",value:cloneConfig.newid,onChange:e=>setCloneConfig({...cloneConfig,newid:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm",placeholder:loadingVmid?t('loading'):'VMID',disabled:loadingVmid})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('name')),/*#__PURE__*/React.createElement("input",{type:"text",value:cloneConfig.name,onChange:e=>setCloneConfig({...cloneConfig,name:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm",placeholder:"clone-name"}))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('targetNode')),/*#__PURE__*/React.createElement("select",{value:cloneConfig.target_node,onChange:e=>setCloneConfig({...cloneConfig,target_node:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},(nodes||[]).map(node=>{const nodeName=typeof node==='string'?node:node.name;const isSameNode=nodeName===vm.node;return/*#__PURE__*/React.createElement("option",{key:nodeName,value:nodeName},nodeName," ",isSameNode?`(${t('sameNode')})`:'');})),cloneConfig.target_node!==vm.node&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-yellow-400 mt-1"},"\u26A0\uFE0F ",t('crossNodeCloneWarning'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-2"},t('cloneMode')),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3"},/*#__PURE__*/React.createElement("button",{onClick:()=>setCloneConfig({...cloneConfig,full:true}),className:`p-3 rounded-lg border text-left transition-all ${cloneConfig.full?'border-blue-500 bg-blue-500/10':'border-proxmox-border hover:border-gray-600'}`},/*#__PURE__*/React.createElement("div",{className:"font-medium text-white text-sm"},t('fullClone')),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mt-1"},t('fullCloneDesc'))),/*#__PURE__*/React.createElement("button",{onClick:()=>setCloneConfig({...cloneConfig,full:false}),disabled:!isQemu,className:`p-3 rounded-lg border text-left transition-all ${!cloneConfig.full?'border-blue-500 bg-blue-500/10':'border-proxmox-border hover:border-gray-600'} ${!isQemu?'opacity-50 cursor-not-allowed':''}`},/*#__PURE__*/React.createElement("div",{className:"font-medium text-white text-sm"},t('linkedClone')),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mt-1"},isQemu?t('linkedCloneDesc'):t('onlyForVms'))))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('description')," (",t('optional'),")"),/*#__PURE__*/React.createElement("textarea",{value:cloneConfig.description,onChange:e=>setCloneConfig({...cloneConfig,description:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm resize-none",rows:"2",placeholder:t('cloneNotes')}))),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-proxmox-border bg-proxmox-dark"},/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"px-4 py-2 text-gray-300 hover:text-white"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:handleClone,disabled:loading||!cloneConfig.newid,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 rounded-lg text-white hover:bg-blue-700 disabled:opacity-50"},loading&&/*#__PURE__*/React.createElement(Icons.RotateCw,null),/*#__PURE__*/React.createElement(Icons.Copy,null),t('startClone')))));}// VM Detail Modal Component
function VmDetailModal({vm,clusterId,onAction,onOpenConsole,onOpenConfig,onMigrate,onClone,onForceStop,onDelete,onClose}){const[loading,setLoading]=useState({});const isQemu=vm.type==='qemu';const displayName=vm.name||`${isQemu?'VM':'CT'} ${vm.vmid}`;const[guestInfo,setGuestInfo]=useState(null);const[vmHwInfo,setVmHwInfo]=useState(null);// copypaste from somewhere else lol
function formatBytes(bytes){if(!bytes)return'0 B';const k=1024;const s=['B','KB','MB','GB','TB'];const i=Math.floor(Math.log(bytes)/Math.log(k));return(bytes/Math.pow(k,i)).toFixed(1)+' '+s[i];}const handleAction=async action=>{setLoading(prev=>({...prev,[action]:true}));await onAction(vm,action);setLoading(prev=>({...prev,[action]:false}));};// TODO: this is also duplicated somewhere
const formatUptime=uptime=>{if(!uptime)return'-';const d=Math.floor(uptime/86400);const h=Math.floor(uptime%86400/3600);const m=Math.floor(uptime%3600/60);if(d>0)return`${d}d ${h}h ${m}m`;if(h>0)return`${h}h ${m}m`;return`${m}m`;};// Fetch VM config for hardware info + guest agent
useEffect(()=>{if(!isQemu)return;const doFetch=async url=>{try{const r=await fetch(url,{credentials:'include',headers:getAuthHeaders()});return r.ok?r.json():null;}catch{return null;}};// Hardware info
doFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/config`).then(cfg=>{if(!cfg)return;const raw=cfg.raw||cfg;setVmHwInfo({machine:raw.machine||'i440fx',bios:raw.bios||'seabios',cpu:raw.cpu||'kvm64',scsihw:raw.scsihw||'lsi',cores:raw.cores||1,sockets:raw.sockets||1,ostype:raw.ostype,net:(()=>{const nk=Object.keys(raw).find(k=>k.startsWith('net'));return nk?raw[nk].split(',')[0].split('=')[0]:null;})(),agent:raw.agent});});// Guest agent info
if(vm.status==='running'){doFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/guest-info`).then(data=>{if(data&&data.agent_running)setGuestInfo(data);});}},[vm.vmid,vm.status,clusterId]);return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/80",onClick:onClose},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-2xl bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden animate-scale-in",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"p-6 border-b border-proxmox-border bg-gradient-to-r from-proxmox-dark to-proxmox-card"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("div",{className:`p-3 rounded-xl ${isQemu?'bg-blue-500/20':'bg-purple-500/20'}`},isQemu?/*#__PURE__*/React.createElement(Icons.VM,null):/*#__PURE__*/React.createElement(Icons.Container,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:"text-xl font-bold text-white"},displayName),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3 text-sm text-gray-400"},/*#__PURE__*/React.createElement("span",null,"ID: ",vm.vmid),/*#__PURE__*/React.createElement("span",null,"\u2022"),/*#__PURE__*/React.createElement("span",null,isQemu?'QEMU VM':'LXC Container'),/*#__PURE__*/React.createElement("span",null,"\u2022"),/*#__PURE__*/React.createElement("span",null,vm.node)))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("span",{className:`px-3 py-1.5 rounded-full text-sm font-medium ${vm.status==='running'?'bg-green-500/20 text-green-400':'bg-red-500/20 text-red-400'}`},vm.status==='running'?t('running')||'Running':t('stopped')||'Stopped'),/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"p-2 hover:bg-proxmox-dark rounded-lg text-gray-400 hover:text-white"},/*#__PURE__*/React.createElement(Icons.X,null))))),/*#__PURE__*/React.createElement("div",{className:"p-6 grid grid-cols-2 md:grid-cols-4 gap-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-1"},"CPU"),/*#__PURE__*/React.createElement("div",{className:"text-lg font-bold text-white"},(vm.cpu_percent||0).toFixed(1),"%"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},vm.maxcpu||1," Cores"),/*#__PURE__*/React.createElement("div",{className:"mt-2 h-1.5 rounded-full bg-proxmox-border overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"h-full rounded-full transition-all",style:{width:`${Math.min(vm.cpu_percent||0,100)}%`,background:(vm.cpu_percent||0)<50?'#3b82f6':(vm.cpu_percent||0)<80?'#eab308':'#ef4444'}}))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-1"},"RAM"),/*#__PURE__*/React.createElement("div",{className:"text-lg font-bold text-white"},(vm.mem_percent||0).toFixed(1),"%"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},formatBytes(vm.mem)," / ",formatBytes(vm.maxmem)),/*#__PURE__*/React.createElement("div",{className:"mt-2 h-1.5 rounded-full bg-proxmox-border overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"h-full rounded-full transition-all",style:{width:`${vm.mem_percent||0}%`,background:(vm.mem_percent||0)<50?'#22c55e':(vm.mem_percent||0)<80?'#eab308':'#ef4444'}}))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-1"},"Disk"),/*#__PURE__*/React.createElement("div",{className:"text-lg font-bold text-white"},formatBytes(vm.disk||0)),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"von ",formatBytes(vm.maxdisk||0))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-1"},"Uptime"),/*#__PURE__*/React.createElement("div",{className:"text-lg font-bold text-white"},formatUptime(vm.uptime)),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},vm.status==='running'?t('sinceStart'):t('offline')))),isQemu&&vmHwInfo&&/*#__PURE__*/React.createElement("div",{className:"px-6 pb-2"},/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-2"},/*#__PURE__*/React.createElement("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-proxmox-dark border border-proxmox-border text-xs"},/*#__PURE__*/React.createElement(Icons.Cpu,{className:"w-3 h-3 text-blue-400"}),/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"CPU:"),/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},vmHwInfo.cpu),/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"(",vmHwInfo.sockets,"s/",vmHwInfo.cores,"c)")),/*#__PURE__*/React.createElement("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-proxmox-dark border border-proxmox-border text-xs"},/*#__PURE__*/React.createElement(Icons.Monitor,{className:"w-3 h-3 text-amber-400"}),/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"Machine:"),/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},vmHwInfo.machine)),/*#__PURE__*/React.createElement("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-proxmox-dark border border-proxmox-border text-xs"},/*#__PURE__*/React.createElement(Icons.HardDrive,{className:"w-3 h-3 text-emerald-400"}),/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"BIOS:"),/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},vmHwInfo.bios==='ovmf'?'UEFI (OVMF)':'SeaBIOS')),/*#__PURE__*/React.createElement("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-proxmox-dark border border-proxmox-border text-xs"},/*#__PURE__*/React.createElement(Icons.Database,{className:"w-3 h-3 text-purple-400"}),/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"SCSI:"),/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},vmHwInfo.scsihw)),vmHwInfo.net&&/*#__PURE__*/React.createElement("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-proxmox-dark border border-proxmox-border text-xs"},/*#__PURE__*/React.createElement(Icons.Globe,{className:"w-3 h-3 text-cyan-400"}),/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"NIC:"),/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},vmHwInfo.net)),vmHwInfo.ostype&&/*#__PURE__*/React.createElement("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-proxmox-dark border border-proxmox-border text-xs"},/*#__PURE__*/React.createElement(Icons.Network,{className:"w-3 h-3 text-orange-400"}),/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"OS:"),/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},vmHwInfo.ostype)))),isQemu&&vm.status==='running'&&guestInfo&&/*#__PURE__*/React.createElement("div",{className:"px-6 pb-2"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4 grid grid-cols-1 md:grid-cols-3 gap-4"},guestInfo.hostname&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-2 rounded-lg bg-cyan-500/10"},/*#__PURE__*/React.createElement(Icons.Monitor,{className:"w-4 h-4 text-cyan-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"Hostname"),/*#__PURE__*/React.createElement("div",{className:"text-sm font-semibold text-white font-mono"},guestInfo.hostname))),guestInfo.os_pretty_name&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-2 rounded-lg bg-emerald-500/10"},/*#__PURE__*/React.createElement(Icons.Cpu,{className:"w-4 h-4 text-emerald-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},t('osVersion')),/*#__PURE__*/React.createElement("div",{className:"text-sm font-semibold text-white"},guestInfo.os_pretty_name))),guestInfo.os_kernel&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-2 rounded-lg bg-purple-500/10"},/*#__PURE__*/React.createElement(Icons.Terminal,{className:"w-4 h-4 text-purple-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"Kernel"),/*#__PURE__*/React.createElement("div",{className:"text-sm font-semibold text-gray-300 font-mono"},guestInfo.os_kernel))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1.5 md:col-span-3 pt-2 border-t border-gray-700/30"},/*#__PURE__*/React.createElement("div",{className:"w-2 h-2 rounded-full bg-cyan-400 animate-pulse"}),/*#__PURE__*/React.createElement("span",{className:"text-xs text-cyan-400/70"},"QEMU Guest Agent")))),isQemu&&vm.status==='running'&&!guestInfo&&/*#__PURE__*/React.createElement("div",{className:"px-6 pb-2"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-3 flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-1.5 rounded-lg bg-yellow-500/10"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4 text-yellow-500"})),/*#__PURE__*/React.createElement("div",{className:"flex-1"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-yellow-400"},t('guestAgentNotInstalled')),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},t('guestAgentInstallHint'))))),/*#__PURE__*/React.createElement("div",{className:"px-6 pb-6"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-3"},t('quickActions')),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3"},vm.status==='stopped'?/*#__PURE__*/React.createElement("button",{onClick:()=>handleAction('start'),disabled:loading.start,className:"flex items-center justify-center gap-2 p-3 bg-green-500/10 hover:bg-green-500/20 border border-green-500/30 rounded-lg text-green-400 transition-all disabled:opacity-50"},loading.start?/*#__PURE__*/React.createElement(Icons.RotateCw,null):/*#__PURE__*/React.createElement(Icons.PlayCircle,null),t('start')):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("button",{onClick:()=>handleAction('shutdown'),disabled:loading.shutdown,className:"flex items-center justify-center gap-2 p-3 bg-yellow-500/10 hover:bg-yellow-500/20 border border-yellow-500/30 rounded-lg text-yellow-400 transition-all disabled:opacity-50"},loading.shutdown?/*#__PURE__*/React.createElement(Icons.RotateCw,null):/*#__PURE__*/React.createElement(Icons.Power,null),"Shutdown"),/*#__PURE__*/React.createElement("button",{onClick:()=>handleAction('reboot'),disabled:loading.reboot,className:"flex items-center justify-center gap-2 p-3 bg-orange-500/10 hover:bg-orange-500/20 border border-orange-500/30 rounded-lg text-orange-400 transition-all disabled:opacity-50"},loading.reboot?/*#__PURE__*/React.createElement(Icons.RotateCw,null):/*#__PURE__*/React.createElement(Icons.RefreshCw,null),"Reboot")),/*#__PURE__*/React.createElement("button",{onClick:()=>{onClose();onOpenConsole(vm);},className:"flex items-center justify-center gap-2 p-3 bg-blue-500/10 hover:bg-blue-500/20 border border-blue-500/30 rounded-lg text-blue-400 transition-all"},/*#__PURE__*/React.createElement(Icons.Monitor,null),"Konsole"),/*#__PURE__*/React.createElement("button",{onClick:()=>{onClose();onOpenConfig(vm);},className:"flex items-center justify-center gap-2 p-3 bg-proxmox-dark hover:bg-proxmox-border border border-proxmox-border rounded-lg text-gray-300 transition-all"},/*#__PURE__*/React.createElement(Icons.Cog,null),"Konfiguration"))),/*#__PURE__*/React.createElement("div",{className:"px-6 pb-6"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-3"},t('moreActions')),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>{onClose();onMigrate(vm);},className:"flex items-center gap-2 px-3 py-2 bg-proxmox-dark hover:bg-proxmox-border border border-proxmox-border rounded-lg text-sm text-gray-300 transition-all"},/*#__PURE__*/React.createElement(Icons.ArrowRight,null),"Migrieren"),/*#__PURE__*/React.createElement("button",{onClick:()=>{onClose();onClone(vm);},className:"flex items-center gap-2 px-3 py-2 bg-proxmox-dark hover:bg-proxmox-border border border-proxmox-border rounded-lg text-sm text-gray-300 transition-all"},/*#__PURE__*/React.createElement(Icons.Copy,null),"Klonen"),vm.status==='running'&&/*#__PURE__*/React.createElement(React.Fragment,null,isQemu&&/*#__PURE__*/React.createElement("button",{onClick:()=>onAction(vm,'reset'),className:"flex items-center gap-2 px-3 py-2 bg-orange-500/10 hover:bg-orange-500/20 border border-orange-500/30 rounded-lg text-sm text-orange-400 transition-all"},/*#__PURE__*/React.createElement(Icons.Zap,null),t('forceReset')),/*#__PURE__*/React.createElement("button",{onClick:()=>onForceStop(vm),className:"flex items-center gap-2 px-3 py-2 bg-red-500/10 hover:bg-red-500/20 border border-red-500/30 rounded-lg text-sm text-red-400 transition-all"},/*#__PURE__*/React.createElement(Icons.XCircle,null),t('forceStop'))),/*#__PURE__*/React.createElement("button",{onClick:()=>{onClose();onDelete(vm);},className:"flex items-center gap-2 px-3 py-2 bg-red-500/10 hover:bg-red-500/20 border border-red-500/30 rounded-lg text-sm text-red-400 transition-all"},/*#__PURE__*/React.createElement(Icons.Trash,null),t('delete')))),vm.tags&&/*#__PURE__*/React.createElement("div",{className:"px-6 pb-6"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-2"},"Tags"),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-2"},vm.tags.split(';').map(tag=>/*#__PURE__*/React.createElement("span",{key:tag,className:"px-2 py-1 bg-proxmox-dark rounded text-xs text-gray-400"},tag))))));}// VM Detail Panel Component (inline, not modal)
// LW: this shows when you click a VM in detail view mode
function VmDetailPanel({vm,clusterId,onAction,onOpenConsole,onOpenConfig,onMigrate,onClone,onForceStop,onDelete,onCrossClusterMigrate,showCrossCluster,actionLoading,onShowMetrics,addToast}){const{t}=useTranslation();const{getAuthHeaders}=useAuth();// some quick helpers
const isQemu=vm.type==='qemu';const displayName=vm.name||`${isQemu?'VM':'CT'} ${vm.vmid}`;const[haEnabled,setHaEnabled]=useState(false);const[haLoading,setHaLoading]=useState(false);const[haResources,setHaResources]=useState([]);// NS: Lock status for VMs
const[lockInfo,setLockInfo]=useState({locked:false,lock_reason:null,lock_description:null,unlock_command:null});const[unlockLoading,setUnlockLoading]=useState(false);const[showUnlockConfirm,setShowUnlockConfirm]=useState(false);// NS: Issue #50 - Guest Agent info
const[guestInfo,setGuestInfo]=useState(null);// LW: inline arrow fn, less boilerplate
const authFetch=async(url,opts={})=>{try{return await fetch(url,{...opts,credentials:'include',headers:{...opts.headers,...getAuthHeaders()}});}catch(e){console.error(e);return null;}};// LW: these could be extracted to utils but w/e
const formatBytes=b=>{if(!b)return'0 B';const k=1024,sizes=['B','KB','MB','GB','TB'];const i=Math.floor(Math.log(b)/Math.log(k));return`${(b/Math.pow(k,i)).toFixed(1)} ${sizes[i]}`;};const formatUptime=uptime=>{if(!uptime)return'-';const days=Math.floor(uptime/86400);const hours=Math.floor(uptime%86400/3600);const mins=Math.floor(uptime%3600/60);if(days>0)return`${days}d ${hours}h ${mins}m`;if(hours>0)return`${hours}h ${mins}m`;return`${mins}m`;};const handleAction=async action=>{await onAction(vm,action);};// NS: Fetch lock status
const fetchLockStatus=async()=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/lock`);if(response&&response.ok){const data=await response.json();// NS: Ensure we have valid data structure
setLockInfo({locked:data.locked||false,lock_reason:data.lock_reason||null,lock_description:data.lock_description||null,unlock_command:data.unlock_command||null});}else{// API error - assume not locked
setLockInfo({locked:false,lock_reason:null,lock_description:null,unlock_command:null});}}catch(error){console.error('Error fetching lock status:',error);// On error, assume not locked
setLockInfo({locked:false,lock_reason:null,lock_description:null,unlock_command:null});}};// NS: Unlock VM
const handleUnlock=async()=>{setUnlockLoading(true);try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/unlock`,{method:'POST'});if(response&&response.ok){const data=await response.json();if(addToast)addToast(t('vmUnlocked')||`VM ${vm.vmid} unlocked successfully`,'success');setLockInfo({locked:false,lock_reason:null,lock_description:null,unlock_command:null});setShowUnlockConfirm(false);}else{const err=await response.json();if(addToast)addToast(err.error||'Unlock failed','error');}}catch(error){if(addToast)addToast('Unlock failed','error');}setUnlockLoading(false);};// Fetch lock status on mount
useEffect(()=>{fetchLockStatus();},[vm.vmid,clusterId]);// NS: Issue #50 - Fetch guest agent info
useEffect(()=>{if(!isQemu||vm.status!=='running'){setGuestInfo(null);return;}authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/guest-info`).then(r=>r&&r.ok?r.json():null).then(data=>{if(data&&data.agent_running)setGuestInfo(data);else setGuestInfo(null);}).catch(()=>setGuestInfo(null));},[vm.vmid,vm.status,clusterId]);// NS: Fetch VM config for hardware info (machine type, BIOS, SCSI, CPU model)
const[vmHwInfo,setVmHwInfo]=useState(null);useEffect(()=>{if(!isQemu){setVmHwInfo(null);return;}authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/config`).then(r=>r&&r.ok?r.json():null).then(cfg=>{if(!cfg){setVmHwInfo(null);return;}const raw=cfg.raw||cfg;setVmHwInfo({machine:raw.machine||'i440fx',bios:raw.bios||'seabios',cpu:raw.cpu||'kvm64',scsihw:raw.scsihw||'lsi',cores:raw.cores||1,sockets:raw.sockets||1,ostype:raw.ostype,net:(()=>{const nk=Object.keys(raw).find(k=>k.startsWith('net'));return nk?raw[nk].split(',')[0].split('=')[0]:null;})(),agent:raw.agent});}).catch(()=>setVmHwInfo(null));},[vm.vmid,clusterId]);// Check HA status for this VM
useEffect(()=>{const checkHaStatus=async()=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/proxmox-ha/resources`);if(response&&response.ok){const resources=await response.json();setHaResources(resources);const vmType=isQemu?'vm':'ct';const isInHa=resources.some(r=>r.sid===`${vmType}:${vm.vmid}`);setHaEnabled(isInHa);}}catch(error){console.error('checking HA status:',error);}};checkHaStatus();},[vm.vmid,clusterId]);const toggleProxmoxHa=async()=>{setHaLoading(true);try{const vmType=isQemu?'vm':'ct';if(haEnabled){// Remove from HA
const response=await authFetch(`${API_URL}/clusters/${clusterId}/proxmox-ha/resources/${vmType}:${vm.vmid}`,{method:'DELETE'});if(response&&response.ok){setHaEnabled(false);}}else{// Add to HA
const response=await authFetch(`${API_URL}/clusters/${clusterId}/proxmox-ha/resources`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({vmid:vm.vmid,type:vmType,max_restart:3,max_relocate:3})});if(response&&response.ok){setHaEnabled(true);}}}catch(error){console.error('toggling HA:',error);}finally{setHaLoading(false);}};return/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-6 border-b border-proxmox-border bg-gradient-to-r from-proxmox-dark to-proxmox-card"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("div",{className:`p-3 rounded-xl ${isQemu?'bg-blue-500/20':'bg-purple-500/20'}`},isQemu?/*#__PURE__*/React.createElement(Icons.VM,null):/*#__PURE__*/React.createElement(Icons.Container,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:"text-xl font-bold text-white"},displayName),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3 text-sm text-gray-400"},/*#__PURE__*/React.createElement("span",null,"ID: ",vm.vmid),/*#__PURE__*/React.createElement("span",null,"\u2022"),/*#__PURE__*/React.createElement("span",null,isQemu?'QEMU VM':'LXC Container'),/*#__PURE__*/React.createElement("span",null,"\u2022"),/*#__PURE__*/React.createElement("span",null,vm.node)))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},lockInfo?.locked&&/*#__PURE__*/React.createElement("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-red-500/20 text-red-400 border border-red-500/30 flex items-center gap-1 cursor-pointer hover:bg-red-500/30 transition-colors",onClick:()=>setShowUnlockConfirm(true),title:lockInfo?.lock_description||'Locked'},/*#__PURE__*/React.createElement(Icons.Lock,null),lockInfo?.lock_reason||'Locked'),haEnabled&&/*#__PURE__*/React.createElement("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-cyan-500/20 text-cyan-400 border border-cyan-500/30 flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.Shield,null),"HA"),/*#__PURE__*/React.createElement("span",{className:`px-3 py-1.5 rounded-full text-sm font-medium ${vm.status==='running'?'bg-green-500/20 text-green-400':'bg-red-500/20 text-red-400'}`},vm.status==='running'?'â— '+t('running'):'â—‹ '+t('stopped'))))),showUnlockConfirm&&lockInfo?.locked&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",onClick:()=>setShowUnlockConfirm(false)},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-6 max-w-md w-full mx-4",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3 mb-4"},/*#__PURE__*/React.createElement("div",{className:"p-2 rounded-lg bg-red-500/20"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"text-red-400"})),/*#__PURE__*/React.createElement("h3",{className:"text-lg font-bold text-white"},t('unlockVm')||'Unlock VM')),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mb-2"},t('lockReason')||'Lock Reason',":"),/*#__PURE__*/React.createElement("div",{className:"text-white font-medium"},lockInfo?.lock_description||'Unknown'),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mt-1"},"(",lockInfo?.lock_reason||'unknown',")")),/*#__PURE__*/React.createElement("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"text-yellow-400 mt-0.5 flex-shrink-0"}),/*#__PURE__*/React.createElement("div",{className:"text-sm text-yellow-300"},t('unlockWarning')||'Warning: Unlocking a VM during an active operation may cause data corruption or other issues. Only proceed if you are sure the operation has failed or been cancelled.'))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-3"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-1"},"CLI ",t('command')||'Command',":"),/*#__PURE__*/React.createElement("code",{className:"text-sm text-green-400 font-mono"},lockInfo?.unlock_command||`qm unlock ${vm.vmid}`))),/*#__PURE__*/React.createElement("div",{className:"flex gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowUnlockConfirm(false),className:"flex-1 px-4 py-2 bg-proxmox-dark text-gray-300 rounded-lg hover:bg-proxmox-hover transition-colors"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:handleUnlock,disabled:unlockLoading,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2"},unlockLoading?/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"animate-spin"}):/*#__PURE__*/React.createElement(Icons.Unlock,null),t('unlock')||'Unlock')))),/*#__PURE__*/React.createElement("div",{className:"p-6 grid grid-cols-2 md:grid-cols-4 gap-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-1"},"CPU"),/*#__PURE__*/React.createElement("div",{className:"text-lg font-bold text-white"},(vm.cpu_percent||0).toFixed(1),"%"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},vm.maxcpu||1," ",t('cores')),/*#__PURE__*/React.createElement("div",{className:"mt-2 h-1.5 rounded-full bg-proxmox-border overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"h-full rounded-full transition-all",style:{width:`${Math.min(vm.cpu_percent||0,100)}%`,background:(vm.cpu_percent||0)<50?'#3b82f6':(vm.cpu_percent||0)<80?'#eab308':'#ef4444'}}))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-1"},"RAM"),/*#__PURE__*/React.createElement("div",{className:"text-lg font-bold text-white"},(vm.mem_percent||0).toFixed(1),"%"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},formatBytes(vm.mem)," / ",formatBytes(vm.maxmem)),/*#__PURE__*/React.createElement("div",{className:"mt-2 h-1.5 rounded-full bg-proxmox-border overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"h-full rounded-full transition-all",style:{width:`${vm.mem_percent||0}%`,background:(vm.mem_percent||0)<50?'#22c55e':(vm.mem_percent||0)<80?'#eab308':'#ef4444'}}))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-1"},"Disk"),/*#__PURE__*/React.createElement("div",{className:"text-lg font-bold text-white"},formatBytes(vm.disk||0)),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},t('of')," ",formatBytes(vm.maxdisk||0))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-1"},t('uptime')),/*#__PURE__*/React.createElement("div",{className:"text-lg font-bold text-white"},formatUptime(vm.uptime)),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},vm.status==='running'?t('sinceStart'):t('offline')))),isQemu&&vmHwInfo&&/*#__PURE__*/React.createElement("div",{className:"px-6 pb-2"},/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-2"},/*#__PURE__*/React.createElement("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-proxmox-dark border border-proxmox-border text-xs"},/*#__PURE__*/React.createElement(Icons.Cpu,{className:"w-3 h-3 text-blue-400"}),/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"CPU:"),/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},vmHwInfo.cpu),/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"(",vmHwInfo.sockets,"s/",vmHwInfo.cores,"c)")),/*#__PURE__*/React.createElement("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-proxmox-dark border border-proxmox-border text-xs"},/*#__PURE__*/React.createElement(Icons.Monitor,{className:"w-3 h-3 text-amber-400"}),/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"Machine:"),/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},vmHwInfo.machine)),/*#__PURE__*/React.createElement("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-proxmox-dark border border-proxmox-border text-xs"},/*#__PURE__*/React.createElement(Icons.HardDrive,{className:"w-3 h-3 text-emerald-400"}),/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"BIOS:"),/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},vmHwInfo.bios==='ovmf'?'UEFI (OVMF)':'SeaBIOS')),/*#__PURE__*/React.createElement("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-proxmox-dark border border-proxmox-border text-xs"},/*#__PURE__*/React.createElement(Icons.Database,{className:"w-3 h-3 text-purple-400"}),/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"SCSI:"),/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},vmHwInfo.scsihw)),vmHwInfo.net&&/*#__PURE__*/React.createElement("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-proxmox-dark border border-proxmox-border text-xs"},/*#__PURE__*/React.createElement(Icons.Globe,{className:"w-3 h-3 text-cyan-400"}),/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"NIC:"),/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},vmHwInfo.net)),vmHwInfo.ostype&&/*#__PURE__*/React.createElement("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md bg-proxmox-dark border border-proxmox-border text-xs"},/*#__PURE__*/React.createElement(Icons.Network,{className:"w-3 h-3 text-orange-400"}),/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"OS:"),/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},vmHwInfo.ostype)))),isQemu&&vm.status==='running'&&guestInfo&&/*#__PURE__*/React.createElement("div",{className:"px-6 pb-2"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4 grid grid-cols-1 md:grid-cols-3 gap-4"},guestInfo.hostname&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-2 rounded-lg bg-cyan-500/10"},/*#__PURE__*/React.createElement(Icons.Monitor,{className:"w-4 h-4 text-cyan-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"Hostname"),/*#__PURE__*/React.createElement("div",{className:"text-sm font-semibold text-white font-mono"},guestInfo.hostname))),guestInfo.os_pretty_name&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-2 rounded-lg bg-emerald-500/10"},/*#__PURE__*/React.createElement(Icons.Cpu,{className:"w-4 h-4 text-emerald-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},t('osVersion')),/*#__PURE__*/React.createElement("div",{className:"text-sm font-semibold text-white"},guestInfo.os_pretty_name))),guestInfo.os_kernel&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-2 rounded-lg bg-purple-500/10"},/*#__PURE__*/React.createElement(Icons.Terminal,{className:"w-4 h-4 text-purple-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"Kernel"),/*#__PURE__*/React.createElement("div",{className:"text-sm font-semibold text-gray-300 font-mono"},guestInfo.os_kernel))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1.5 md:col-span-3 pt-2 border-t border-gray-700/30"},/*#__PURE__*/React.createElement("div",{className:"w-2 h-2 rounded-full bg-cyan-400 animate-pulse"}),/*#__PURE__*/React.createElement("span",{className:"text-xs text-cyan-400/70"},"QEMU Guest Agent")))),isQemu&&vm.status==='running'&&!guestInfo&&/*#__PURE__*/React.createElement("div",{className:"px-6 pb-2"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-3 flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-1.5 rounded-lg bg-yellow-500/10"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4 text-yellow-500"})),/*#__PURE__*/React.createElement("div",{className:"flex-1"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-yellow-400"},t('guestAgentNotInstalled')),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},t('guestAgentInstallHint'))))),/*#__PURE__*/React.createElement("div",{className:"px-6 pb-6"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-3"},t('quickActions')),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3"},vm.status==='stopped'?/*#__PURE__*/React.createElement("button",{onClick:()=>handleAction('start'),disabled:actionLoading?.[`${vm.vmid}-start`],className:"flex items-center justify-center gap-2 p-3 bg-green-500/10 hover:bg-green-500/20 border border-green-500/30 rounded-lg text-green-400 transition-all disabled:opacity-50"},actionLoading?.[`${vm.vmid}-start`]?/*#__PURE__*/React.createElement(Icons.RotateCw,null):/*#__PURE__*/React.createElement(Icons.PlayCircle,null),t('start')):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("button",{onClick:()=>handleAction('shutdown'),disabled:actionLoading?.[`${vm.vmid}-shutdown`],className:"flex items-center justify-center gap-2 p-3 bg-yellow-500/10 hover:bg-yellow-500/20 border border-yellow-500/30 rounded-lg text-yellow-400 transition-all disabled:opacity-50"},actionLoading?.[`${vm.vmid}-shutdown`]?/*#__PURE__*/React.createElement(Icons.RotateCw,null):/*#__PURE__*/React.createElement(Icons.Power,null),t('shutdown')),/*#__PURE__*/React.createElement("button",{onClick:()=>handleAction('reboot'),disabled:actionLoading?.[`${vm.vmid}-reboot`],className:"flex items-center justify-center gap-2 p-3 bg-orange-500/10 hover:bg-orange-500/20 border border-orange-500/30 rounded-lg text-orange-400 transition-all disabled:opacity-50"},actionLoading?.[`${vm.vmid}-reboot`]?/*#__PURE__*/React.createElement(Icons.RotateCw,null):/*#__PURE__*/React.createElement(Icons.RefreshCw,null),t('reboot'))),/*#__PURE__*/React.createElement("button",{onClick:()=>onOpenConsole(vm),className:"flex items-center justify-center gap-2 p-3 bg-blue-500/10 hover:bg-blue-500/20 border border-blue-500/30 rounded-lg text-blue-400 transition-all"},/*#__PURE__*/React.createElement(Icons.Monitor,null),t('console')),/*#__PURE__*/React.createElement("button",{onClick:()=>onOpenConfig(vm),className:"flex items-center justify-center gap-2 p-3 bg-proxmox-dark hover:bg-proxmox-border border border-proxmox-border rounded-lg text-gray-300 transition-all"},/*#__PURE__*/React.createElement(Icons.Cog,null),t('configuration')))),/*#__PURE__*/React.createElement("div",{className:"px-6 pb-6"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-3"},t('moreActions')),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>onShowMetrics&&onShowMetrics(vm),className:"flex items-center gap-2 px-3 py-2 bg-indigo-500/10 hover:bg-indigo-500/20 border border-indigo-500/30 rounded-lg text-sm text-indigo-400 transition-all"},/*#__PURE__*/React.createElement(Icons.BarChart,null),t('performanceMetrics')),/*#__PURE__*/React.createElement("button",{onClick:onMigrate,className:"flex items-center gap-2 px-3 py-2 bg-proxmox-dark hover:bg-proxmox-border border border-proxmox-border rounded-lg text-sm text-gray-300 transition-all"},/*#__PURE__*/React.createElement(Icons.ArrowRight,null),t('migrate')),showCrossCluster&&/*#__PURE__*/React.createElement("button",{onClick:()=>onCrossClusterMigrate(vm),className:"flex items-center gap-2 px-3 py-2 bg-cyan-500/10 hover:bg-cyan-500/20 border border-cyan-500/30 rounded-lg text-sm text-cyan-400 transition-all"},/*#__PURE__*/React.createElement(Icons.Globe,null),t('crossClusterMigrate')),/*#__PURE__*/React.createElement("button",{onClick:onClone,className:"flex items-center gap-2 px-3 py-2 bg-proxmox-dark hover:bg-proxmox-border border border-proxmox-border rounded-lg text-sm text-gray-300 transition-all"},/*#__PURE__*/React.createElement(Icons.Copy,null),t('clone')),vm.status==='running'&&/*#__PURE__*/React.createElement(React.Fragment,null,isQemu&&/*#__PURE__*/React.createElement("button",{onClick:()=>handleAction('reset'),disabled:actionLoading?.[`${vm.vmid}-reset`],className:"flex items-center gap-2 px-3 py-2 bg-orange-500/10 hover:bg-orange-500/20 border border-orange-500/30 rounded-lg text-sm text-orange-400 transition-all disabled:opacity-50"},actionLoading?.[`${vm.vmid}-reset`]?/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"animate-spin"}):/*#__PURE__*/React.createElement(Icons.Zap,null),t('forceReset')||'Force Reset'),/*#__PURE__*/React.createElement("button",{onClick:()=>onForceStop(vm),className:"flex items-center gap-2 px-3 py-2 bg-red-500/10 hover:bg-red-500/20 border border-red-500/30 rounded-lg text-sm text-red-400 transition-all"},/*#__PURE__*/React.createElement(Icons.XCircle,null),t('forceStop'))),/*#__PURE__*/React.createElement("button",{onClick:onDelete,className:"flex items-center gap-2 px-3 py-2 bg-red-500/10 hover:bg-red-500/20 border border-red-500/30 rounded-lg text-sm text-red-400 transition-all"},/*#__PURE__*/React.createElement(Icons.Trash,null),t('delete')))),/*#__PURE__*/React.createElement("div",{className:"px-6 pb-6"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-3"},t('proxmoxHa')),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:`p-2 rounded-lg ${haEnabled?'bg-green-500/20':'bg-gray-500/20'}`},/*#__PURE__*/React.createElement(Icons.Shield,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-sm font-medium text-white"},t('proxmoxHa')," ",haEnabled?t('active'):t('haInactive').replace('Proxmox HA ','')),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},haEnabled?t('haMonitorDesc').split('.')[0]:t('enableNativeHa')))),/*#__PURE__*/React.createElement("button",{onClick:toggleProxmoxHa,disabled:haLoading,className:`px-4 py-2 rounded-lg text-sm font-medium transition-all disabled:opacity-50 ${haEnabled?'bg-red-500/20 hover:bg-red-500/30 text-red-400 border border-red-500/30':'bg-green-500/20 hover:bg-green-500/30 text-green-400 border border-green-500/30'}`},haLoading?/*#__PURE__*/React.createElement(Icons.RotateCw,null):haEnabled?t('disable')+' HA':t('haActivate'))),haEnabled&&/*#__PURE__*/React.createElement("div",{className:"mt-3 pt-3 border-t border-gray-700/50 grid grid-cols-2 gap-4 text-xs"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Max. Restarts:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-white"},"3")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Max. Relocate:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-white"},"3"))))),vm.tags&&/*#__PURE__*/React.createElement("div",{className:"px-6 pb-6"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-2"},"Tags"),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-2"},vm.tags.split(';').map(tag=>/*#__PURE__*/React.createElement("span",{key:tag,className:"px-2 py-1 bg-proxmox-dark rounded text-xs text-gray-400"},tag)))));}// LW: Feb 2026 - Corporate VM Detail View (experimental)
function CorporateVmDetailView({vm,clusterId,onAction,onOpenConsole,onOpenConfig,onBack,onMigrate,onClone,onForceStop,onDelete,onCrossClusterMigrate,showCrossCluster,actionLoading,onShowMetrics,addToast}){const{t}=useTranslation();const{getAuthHeaders}=useAuth();const[activeDetailTab,setActiveDetailTab]=useState('summary');const[showActionsMenu,setShowActionsMenu]=useState(false);const isQemu=vm.type==='qemu';const displayName=vm.name||`${isQemu?'VM':'CT'} ${vm.vmid}`;const isRunning=vm.status==='running';// Reuse same fetch pattern as VmDetailPanel
const authFetch=async(url,opts={})=>{try{return await fetch(url,{...opts,credentials:'include',headers:{...opts.headers,...getAuthHeaders()}});}catch(e){console.error(e);return null;}};const formatBytes=b=>{if(!b)return'0 B';const k=1024,sizes=['B','KB','MB','GB','TB'];const i=Math.floor(Math.log(b)/Math.log(k));return`${(b/Math.pow(k,i)).toFixed(1)} ${sizes[i]}`;};const formatUptime=uptime=>{if(!uptime)return'-';const days=Math.floor(uptime/86400);const hours=Math.floor(uptime%86400/3600);const mins=Math.floor(uptime%3600/60);if(days>0)return`${days}d ${hours}h ${mins}m`;if(hours>0)return`${hours}h ${mins}m`;return`${mins}m`;};const handleAction=async action=>{await onAction(vm,action);};// State for fetched data
const[haEnabled,setHaEnabled]=useState(false);const[haLoading,setHaLoading]=useState(false);const[haResources,setHaResources]=useState([]);const[lockInfo,setLockInfo]=useState({locked:false,lock_reason:null,lock_description:null,unlock_command:null});const[unlockLoading,setUnlockLoading]=useState(false);const[showUnlockConfirm,setShowUnlockConfirm]=useState(false);const[guestInfo,setGuestInfo]=useState(null);const[vmHwInfo,setVmHwInfo]=useState(null);// Close actions menu on outside click
useEffect(()=>{if(!showActionsMenu)return;const close=()=>setShowActionsMenu(false);document.addEventListener('click',close);return()=>document.removeEventListener('click',close);},[showActionsMenu]);// Fetch lock status
const fetchLockStatus=async()=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/lock`);if(response&&response.ok){const data=await response.json();setLockInfo({locked:data.locked||false,lock_reason:data.lock_reason||null,lock_description:data.lock_description||null,unlock_command:data.unlock_command||null});}else{setLockInfo({locked:false,lock_reason:null,lock_description:null,unlock_command:null});}}catch(error){setLockInfo({locked:false,lock_reason:null,lock_description:null,unlock_command:null});}};useEffect(()=>{fetchLockStatus();},[vm.vmid,clusterId]);// Unlock VM
const handleUnlock=async()=>{setUnlockLoading(true);try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/unlock`,{method:'POST'});if(response&&response.ok){if(addToast)addToast(t('vmUnlocked')||`VM ${vm.vmid} unlocked successfully`,'success');setLockInfo({locked:false,lock_reason:null,lock_description:null,unlock_command:null});setShowUnlockConfirm(false);}else{const err=await response.json();if(addToast)addToast(err.error||'Unlock failed','error');}}catch(error){if(addToast)addToast('Unlock failed','error');}setUnlockLoading(false);};// Fetch guest agent info
useEffect(()=>{if(!isQemu||vm.status!=='running'){setGuestInfo(null);return;}authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/guest-info`).then(r=>r&&r.ok?r.json():null).then(data=>{if(data&&data.agent_running)setGuestInfo(data);else setGuestInfo(null);}).catch(()=>setGuestInfo(null));},[vm.vmid,vm.status,clusterId]);// Fetch VM hardware config
useEffect(()=>{if(!isQemu){setVmHwInfo(null);return;}authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/config`).then(r=>r&&r.ok?r.json():null).then(cfg=>{if(!cfg){setVmHwInfo(null);return;}const raw=cfg.raw||cfg;setVmHwInfo({machine:raw.machine||'i440fx',bios:raw.bios||'seabios',cpu:raw.cpu||'kvm64',scsihw:raw.scsihw||'lsi',cores:raw.cores||1,sockets:raw.sockets||1,ostype:raw.ostype,net:(()=>{const nk=Object.keys(raw).find(k=>k.startsWith('net'));return nk?raw[nk].split(',')[0].split('=')[0]:null;})(),agent:raw.agent});}).catch(()=>setVmHwInfo(null));},[vm.vmid,clusterId]);// Fetch HA status
useEffect(()=>{authFetch(`${API_URL}/clusters/${clusterId}/proxmox-ha/resources`).then(r=>r&&r.ok?r.json():null).then(resources=>{if(resources){setHaResources(resources);const vmType=isQemu?'vm':'ct';setHaEnabled(resources.some(r=>r.sid===`${vmType}:${vm.vmid}`));}}).catch(()=>{});},[vm.vmid,clusterId]);// Toggle HA
const toggleProxmoxHa=async()=>{setHaLoading(true);try{const vmType=isQemu?'vm':'ct';if(haEnabled){const response=await authFetch(`${API_URL}/clusters/${clusterId}/proxmox-ha/resources/${vmType}:${vm.vmid}`,{method:'DELETE'});if(response&&response.ok)setHaEnabled(false);}else{const response=await authFetch(`${API_URL}/clusters/${clusterId}/proxmox-ha/resources`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({vmid:vm.vmid,type:vmType,max_restart:3,max_relocate:3})});if(response&&response.ok)setHaEnabled(true);}}catch(error){console.error('toggling HA:',error);}finally{setHaLoading(false);}};const cpuPercent=vm.maxcpu?((vm.cpu||0)*100).toFixed(1):0;const ramPercent=vm.maxmem?(vm.mem/vm.maxmem*100).toFixed(1):0;return/*#__PURE__*/React.createElement("div",{className:"space-y-0"},showUnlockConfirm&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-md bg-proxmox-card border border-proxmox-border p-5"},/*#__PURE__*/React.createElement("h3",{className:"text-[14px] font-semibold text-white mb-3"},t('unlockVm')||'Unlock VM'),/*#__PURE__*/React.createElement("p",{className:"text-[13px] text-gray-400 mb-2"},t('unlockVmConfirm')||`Are you sure you want to unlock ${displayName}?`),lockInfo.lock_description&&/*#__PURE__*/React.createElement("p",{className:"text-[12px] mb-2",style:{color:'#efc006'}},lockInfo.lock_description),lockInfo.unlock_command&&/*#__PURE__*/React.createElement("code",{className:"block text-[11px] text-gray-500 bg-proxmox-dark p-2 mb-3 font-mono"},lockInfo.unlock_command),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowUnlockConfirm(false),className:"px-3 py-1.5 text-[13px] text-gray-400 border border-proxmox-border hover:text-white"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:handleUnlock,disabled:unlockLoading,className:"px-3 py-1.5 text-[13px] text-white border disabled:opacity-50",style:{background:'#efc006',borderColor:'#d4a905'}},unlockLoading?/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-3 h-3 animate-spin"}):t('unlock')||'Unlock')))),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between px-4 py-2 border-b border-proxmox-border",style:{background:'#22343c'}},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:onBack,className:"p-1 hover:text-white",style:{color:'#adbbc4'},title:t('backToList')},/*#__PURE__*/React.createElement(Icons.ChevronLeft,{className:"w-4 h-4"})),/*#__PURE__*/React.createElement(Icons.Monitor,{className:`w-4 h-4 ${vm.type==='lxc'?'text-cyan-400':isRunning?'text-green-400':''}`,style:!vm.type==='lxc'&&!isRunning?{color:'#728b9a'}:{}}),/*#__PURE__*/React.createElement("span",{className:"text-[14px] font-medium",style:{color:'#e9ecef'}},displayName),/*#__PURE__*/React.createElement("span",{className:"text-[11px]",style:{color:'#728b9a'}},"(",vm.vmid,")"),/*#__PURE__*/React.createElement("span",{className:`corp-badge ${isRunning?'corp-badge-running':'corp-badge-stopped'}`},isRunning?t('running'):t('stopped')),haEnabled&&/*#__PURE__*/React.createElement("span",{className:"corp-badge corp-badge-ha"},"HA"),lockInfo.locked&&/*#__PURE__*/React.createElement("span",{className:"corp-badge corp-badge-locked flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.Lock,{className:"w-2.5 h-2.5"}),t('locked'))),/*#__PURE__*/React.createElement("div",{className:"corp-toolbar flex items-center gap-1"},!isRunning&&/*#__PURE__*/React.createElement("button",{onClick:()=>handleAction('start'),disabled:actionLoading?.[`${vm.vmid}-start`]},actionLoading?.[`${vm.vmid}-start`]?/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-3 h-3 animate-spin"}):/*#__PURE__*/React.createElement(Icons.PlayCircle,{className:"w-3 h-3",style:{color:'#60b515'}})," ",t('start')),isRunning&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("button",{onClick:()=>handleAction('shutdown'),disabled:actionLoading?.[`${vm.vmid}-shutdown`]},actionLoading?.[`${vm.vmid}-shutdown`]?/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-3 h-3 animate-spin"}):/*#__PURE__*/React.createElement(Icons.Power,{className:"w-3 h-3",style:{color:'#f54f47'}})," ",t('shutdown')),/*#__PURE__*/React.createElement("button",{onClick:()=>handleAction('reboot'),disabled:actionLoading?.[`${vm.vmid}-reboot`]},actionLoading?.[`${vm.vmid}-reboot`]?/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-3 h-3 animate-spin"}):/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-3 h-3",style:{color:'#efc006'}})," ",t('reboot'))),isQemu&&isRunning&&/*#__PURE__*/React.createElement("button",{onClick:()=>onOpenConsole(vm)},/*#__PURE__*/React.createElement(Icons.Terminal,{className:"w-3 h-3"})," ",t('console')),/*#__PURE__*/React.createElement("button",{onClick:()=>onOpenConfig(vm)},/*#__PURE__*/React.createElement(Icons.Settings,{className:"w-3 h-3"})," ",t('configure')),/*#__PURE__*/React.createElement("div",{className:"relative"},/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();setShowActionsMenu(!showActionsMenu);}},t('actions')," ",/*#__PURE__*/React.createElement(Icons.ChevronDown,{className:"w-3 h-3"})),showActionsMenu&&/*#__PURE__*/React.createElement("div",{className:"corp-dropdown absolute right-0 top-full mt-1 w-52 z-50 py-1",onClick:e=>e.stopPropagation()},onShowMetrics&&/*#__PURE__*/React.createElement("button",{onClick:()=>{onShowMetrics(vm);setShowActionsMenu(false);},className:"w-full text-left px-3 py-1.5 text-[13px] flex items-center gap-2",style:{color:'#adbbc4'}},/*#__PURE__*/React.createElement(Icons.BarChart,{className:"w-3.5 h-3.5"})," ",t('performanceMetrics')),/*#__PURE__*/React.createElement("button",{onClick:()=>{onMigrate(vm);setShowActionsMenu(false);},className:"w-full text-left px-3 py-1.5 text-[13px] flex items-center gap-2",style:{color:'#adbbc4'}},/*#__PURE__*/React.createElement(Icons.ArrowRight,{className:"w-3.5 h-3.5"})," ",t('migrate')),showCrossCluster&&/*#__PURE__*/React.createElement("button",{onClick:()=>{onCrossClusterMigrate(vm);setShowActionsMenu(false);},className:"w-full text-left px-3 py-1.5 text-[13px] flex items-center gap-2",style:{color:'#adbbc4'}},/*#__PURE__*/React.createElement(Icons.Globe,{className:"w-3.5 h-3.5"})," ",t('crossClusterMigrate')),/*#__PURE__*/React.createElement("button",{onClick:()=>{onClone(vm);setShowActionsMenu(false);},className:"w-full text-left px-3 py-1.5 text-[13px] flex items-center gap-2",style:{color:'#adbbc4'}},/*#__PURE__*/React.createElement(Icons.Copy,{className:"w-3.5 h-3.5"})," ",t('clone')),isRunning&&isQemu&&/*#__PURE__*/React.createElement("button",{onClick:()=>{handleAction('reset');setShowActionsMenu(false);},disabled:actionLoading?.[`${vm.vmid}-reset`],className:"w-full text-left px-3 py-1.5 text-[13px] flex items-center gap-2",style:{color:'#efc006'}},/*#__PURE__*/React.createElement(Icons.Zap,{className:"w-3.5 h-3.5"})," ",t('forceReset')||'Force Reset'),isRunning&&/*#__PURE__*/React.createElement("button",{onClick:()=>{onForceStop(vm);setShowActionsMenu(false);},className:"w-full text-left px-3 py-1.5 text-[13px] flex items-center gap-2",style:{color:'#f54f47'}},/*#__PURE__*/React.createElement(Icons.XCircle,{className:"w-3.5 h-3.5"})," ",t('forceStop')),/*#__PURE__*/React.createElement("div",{className:"my-1",style:{borderTop:'1px solid #485764'}}),/*#__PURE__*/React.createElement("button",{onClick:()=>{onDelete(vm);setShowActionsMenu(false);},className:"w-full text-left px-3 py-1.5 text-[13px] flex items-center gap-2",style:{color:'#f54f47'}},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-3.5 h-3.5"})," ",t('delete')))))),/*#__PURE__*/React.createElement("div",{className:"corp-tab-strip px-4",style:{background:'#22343c'}},/*#__PURE__*/React.createElement("button",{className:activeDetailTab==='summary'?'active':'',onClick:()=>setActiveDetailTab('summary')},t('summary')),/*#__PURE__*/React.createElement("button",{onClick:()=>onOpenConfig(vm)},t('configure')),isRunning&&/*#__PURE__*/React.createElement("button",{onClick:()=>onOpenConsole(vm)},/*#__PURE__*/React.createElement(Icons.Terminal,{className:"w-3 h-3 inline mr-1"}),t('console'))),activeDetailTab==='summary'&&/*#__PURE__*/React.createElement("div",{className:"p-4 space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex gap-5"},/*#__PURE__*/React.createElement("div",{className:"flex-shrink-0",style:{width:'280px'}},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center",style:{height:'180px',background:'#17242b',border:'1px solid #485764'}},/*#__PURE__*/React.createElement("div",{className:"text-center"},isQemu?/*#__PURE__*/React.createElement(Icons.Monitor,{className:"w-12 h-12 mx-auto mb-2",style:{color:'#485764'}}):/*#__PURE__*/React.createElement(Icons.Box,{className:"w-12 h-12 mx-auto mb-2",style:{color:'#485764'}}),/*#__PURE__*/React.createElement("div",{className:"text-[11px]",style:{color:'#728b9a'}},isRunning?t('consoleAvailable')||'Console available':t('vmStopped')||'VM is powered off'))),isRunning&&/*#__PURE__*/React.createElement("button",{onClick:()=>onOpenConsole(vm),className:"w-full mt-1.5 py-1.5 text-[12px] font-medium uppercase tracking-wider flex items-center justify-center gap-1.5",style:{background:'#22343c',border:'1px solid #485764',color:'#49afd9'}},/*#__PURE__*/React.createElement(Icons.Terminal,{className:"w-3.5 h-3.5"}),t('launchWebConsole')||'Launch Web Console')),/*#__PURE__*/React.createElement("div",{className:"flex-1 min-w-0"},/*#__PURE__*/React.createElement("table",{className:"corp-property-grid"},/*#__PURE__*/React.createElement("tbody",null,/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('guestOs')||'Guest OS'),/*#__PURE__*/React.createElement("td",null,guestInfo?.os_pretty_name||vmHwInfo?.ostype||(isQemu?'QEMU Virtual Machine':'LXC Container'))),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('type')),/*#__PURE__*/React.createElement("td",null,isQemu?'QEMU/KVM':'LXC'," - ",vmHwInfo?`${vmHwInfo.machine} / ${vmHwInfo.bios==='ovmf'?'UEFI':'SeaBIOS'}`:vm.vmid)),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('qemuAgent')||'QEMU Agent'),/*#__PURE__*/React.createElement("td",{className:"flex items-center gap-1.5"},isQemu&&isRunning?guestInfo?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("span",{className:"w-1.5 h-1.5 rounded-full inline-block",style:{background:'#60b515'}})," ",t('running')):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("span",{className:"w-1.5 h-1.5 rounded-full inline-block",style:{background:'#f54f47'}})," ",t('notInstalled')||'Not installed'):/*#__PURE__*/React.createElement("span",{style:{color:'#728b9a'}},"-"))),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"IP"),/*#__PURE__*/React.createElement("td",{style:{fontFamily:'monospace',fontSize:'12px'}},guestInfo?.ip_addresses?.join(', ')||'-')),guestInfo?.hostname&&/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('hostname')),/*#__PURE__*/React.createElement("td",null,guestInfo.hostname)),vm.tags&&/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"Tags"),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-1"},vm.tags.split(';').map(tag=>/*#__PURE__*/React.createElement("span",{key:tag,className:"px-1.5 py-0.5 text-[11px]",style:{background:'rgba(73, 175, 217, 0.12)',color:'#49afd9',border:'1px solid rgba(73, 175, 217, 0.25)'}},tag))))))),/*#__PURE__*/React.createElement("div",{className:"mt-3 flex gap-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1.5"},/*#__PURE__*/React.createElement("div",{className:"w-2 h-2 rounded-full",style:{background:'#49afd9'}}),/*#__PURE__*/React.createElement("span",{className:"text-[12px]",style:{color:'#adbbc4'}},t('cpuUsage')),/*#__PURE__*/React.createElement("span",{className:"text-[12px] font-medium",style:{color:'#e9ecef'}},cpuPercent,"%")),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1.5"},/*#__PURE__*/React.createElement("div",{className:"w-2 h-2 rounded-full",style:{background:'#9b59b6'}}),/*#__PURE__*/React.createElement("span",{className:"text-[12px]",style:{color:'#adbbc4'}},t('ramUsage')),/*#__PURE__*/React.createElement("span",{className:"text-[12px] font-medium",style:{color:'#e9ecef'}},formatBytes(vm.mem))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1.5"},/*#__PURE__*/React.createElement("div",{className:"w-2 h-2 rounded-full",style:{background:'#60b515'}}),/*#__PURE__*/React.createElement("span",{className:"text-[12px]",style:{color:'#adbbc4'}},"Disk"),/*#__PURE__*/React.createElement("span",{className:"text-[12px] font-medium",style:{color:'#e9ecef'}},formatBytes(vm.maxdisk))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1.5"},/*#__PURE__*/React.createElement("div",{className:"w-2 h-2 rounded-full",style:{background:'#efc006'}}),/*#__PURE__*/React.createElement("span",{className:"text-[12px]",style:{color:'#adbbc4'}},t('uptime')),/*#__PURE__*/React.createElement("span",{className:"text-[12px] font-medium",style:{color:'#e9ecef'}},formatUptime(vm.uptime)))))),lockInfo.locked&&/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between px-3 py-2",style:{background:'rgba(239, 192, 6, 0.08)',borderLeft:'3px solid #efc006'}},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Lock,{className:"w-4 h-4",style:{color:'#efc006'}}),/*#__PURE__*/React.createElement("span",{className:"text-[13px]",style:{color:'#efc006'}},t('vmLocked')||'This virtual machine is locked',": ",lockInfo.lock_reason||'unknown')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowUnlockConfirm(true),className:"px-2 py-1 text-[12px] font-medium",style:{color:'#49afd9'}},t('unlock')||'Unlock')),isQemu&&isRunning&&!guestInfo&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 px-3 py-2",style:{background:'rgba(239, 192, 6, 0.08)',borderLeft:'3px solid #efc006'}},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4 flex-shrink-0",style:{color:'#efc006'}}),/*#__PURE__*/React.createElement("span",{className:"text-[13px]",style:{color:'#efc006'}},t('guestAgentNotInstalled')),/*#__PURE__*/React.createElement("a",{href:"https://pve.proxmox.com/wiki/Qemu-guest-agent",target:"_blank",rel:"noopener noreferrer",className:"text-[12px] ml-1",style:{color:'#49afd9'}},t('installGuestAgent')||'Install QEMU Guest Agent...')),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",{style:{border:'1px solid #485764'}},/*#__PURE__*/React.createElement("div",{className:"px-3 py-2 flex items-center justify-between",style:{background:'#22343c',borderBottom:'1px solid #485764'}},/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium",style:{color:'#e9ecef'}},t('vmHardware')||'VM Hardware')),/*#__PURE__*/React.createElement("div",{className:"p-3 space-y-2"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-[12px]"},/*#__PURE__*/React.createElement(Icons.Cpu,{className:"w-3.5 h-3.5 flex-shrink-0",style:{color:'#49afd9'}}),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4',width:'60px'}},"CPU"),/*#__PURE__*/React.createElement("div",{className:"flex-1"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("div",{className:"flex-1 h-1.5 overflow-hidden",style:{background:'#1b2a32'}},/*#__PURE__*/React.createElement("div",{className:"h-full",style:{width:`${Math.min(cpuPercent,100)}%`,background:'#49afd9'}})),/*#__PURE__*/React.createElement("span",{style:{color:'#e9ecef',minWidth:'35px'}},cpuPercent,"%")),/*#__PURE__*/React.createElement("div",{className:"text-[11px] mt-0.5",style:{color:'#728b9a'}},vm.maxcpu," ",t('cores')," ",vmHwInfo?`â€¢ ${vmHwInfo.cpu}`:''))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-[12px]"},/*#__PURE__*/React.createElement(Icons.MemoryStick,{className:"w-3.5 h-3.5 flex-shrink-0",style:{color:'#9b59b6'}}),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4',width:'60px'}},t('memory')||'Memory'),/*#__PURE__*/React.createElement("div",{className:"flex-1"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("div",{className:"flex-1 h-1.5 overflow-hidden",style:{background:'#1b2a32'}},/*#__PURE__*/React.createElement("div",{className:"h-full",style:{width:`${Math.min(ramPercent,100)}%`,background:'#9b59b6'}})),/*#__PURE__*/React.createElement("span",{style:{color:'#e9ecef',minWidth:'35px'}},ramPercent,"%")),/*#__PURE__*/React.createElement("div",{className:"text-[11px] mt-0.5",style:{color:'#728b9a'}},formatBytes(vm.mem)," / ",formatBytes(vm.maxmem)))),vm.maxdisk&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-[12px]"},/*#__PURE__*/React.createElement(Icons.HardDrive,{className:"w-3.5 h-3.5 flex-shrink-0",style:{color:'#60b515'}}),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4',width:'60px'}},"Disk"),/*#__PURE__*/React.createElement("span",{style:{color:'#e9ecef'}},formatBytes(vm.maxdisk))),vmHwInfo?.net&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-[12px]"},/*#__PURE__*/React.createElement(Icons.Network,{className:"w-3.5 h-3.5 flex-shrink-0",style:{color:'#efc006'}}),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4',width:'60px'}},t('network')||'Network'),/*#__PURE__*/React.createElement("span",{style:{color:'#e9ecef'}},vmHwInfo.net)),vmHwInfo&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-[12px]"},/*#__PURE__*/React.createElement(Icons.Settings,{className:"w-3.5 h-3.5 flex-shrink-0",style:{color:'#728b9a'}}),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4',width:'60px'}},t('biosType')||'BIOS'),/*#__PURE__*/React.createElement("span",{style:{color:'#e9ecef'}},vmHwInfo.bios==='ovmf'?'UEFI (OVMF)':'SeaBIOS'," \u2022 ",vmHwInfo.machine," \u2022 ",vmHwInfo.scsihw)))),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{style:{border:'1px solid #485764'}},/*#__PURE__*/React.createElement("div",{className:"px-3 py-2",style:{background:'#22343c',borderBottom:'1px solid #485764'}},/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium",style:{color:'#e9ecef'}},t('relatedObjects')||'Related Objects')),/*#__PURE__*/React.createElement("table",{className:"corp-property-grid"},/*#__PURE__*/React.createElement("tbody",null,/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('node')),/*#__PURE__*/React.createElement("td",{className:"flex items-center gap-1.5"},/*#__PURE__*/React.createElement(Icons.Server,{className:"w-3 h-3",style:{color:'#49afd9'}})," ",vm.node)),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('status')),/*#__PURE__*/React.createElement("td",{className:"flex items-center gap-1.5"},/*#__PURE__*/React.createElement("span",{className:"w-2 h-2 rounded-full",style:{background:isRunning?'#60b515':'#728b9a'}})," ",isRunning?t('running'):t('stopped'))),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"VMID"),/*#__PURE__*/React.createElement("td",null,vm.vmid)),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('uptime')),/*#__PURE__*/React.createElement("td",null,formatUptime(vm.uptime))),vmHwInfo?.net&&/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('network')||'Network'),/*#__PURE__*/React.createElement("td",null,vmHwInfo.net))))),isQemu&&isRunning&&guestInfo&&/*#__PURE__*/React.createElement("div",{style:{border:'1px solid #485764'}},/*#__PURE__*/React.createElement("div",{className:"px-3 py-2",style:{background:'#22343c',borderBottom:'1px solid #485764'}},/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium",style:{color:'#e9ecef'}},t('guestAgentInfo'))),/*#__PURE__*/React.createElement("table",{className:"corp-property-grid"},/*#__PURE__*/React.createElement("tbody",null,guestInfo.hostname&&/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('hostname')),/*#__PURE__*/React.createElement("td",null,guestInfo.hostname)),guestInfo.os_pretty_name&&/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('osVersion')),/*#__PURE__*/React.createElement("td",null,guestInfo.os_pretty_name)),guestInfo.kernel_version&&/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('kernel')),/*#__PURE__*/React.createElement("td",null,guestInfo.kernel_version)),guestInfo.ip_addresses&&guestInfo.ip_addresses.length>0&&/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"IP"),/*#__PURE__*/React.createElement("td",{style:{fontFamily:'monospace',fontSize:'11px'}},guestInfo.ip_addresses.join(', ')))))),/*#__PURE__*/React.createElement("div",{style:{border:'1px solid #485764'}},/*#__PURE__*/React.createElement("div",{className:"px-3 py-2 flex items-center justify-between",style:{background:'#22343c',borderBottom:'1px solid #485764'}},/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium",style:{color:'#e9ecef'}},t('proxmoxHa')||'Proxmox HA'),/*#__PURE__*/React.createElement("button",{onClick:toggleProxmoxHa,disabled:haLoading,className:"text-[11px] px-2 py-0.5 disabled:opacity-50",style:haEnabled?{color:'#f54f47',border:'1px solid rgba(245, 79, 71, 0.3)'}:{color:'#60b515',border:'1px solid rgba(96, 181, 21, 0.3)'}},haLoading?/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-3 h-3 animate-spin"}):haEnabled?t('disable'):t('haActivate')||'Enable')),/*#__PURE__*/React.createElement("div",{className:"px-3 py-2 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Shield,{className:"w-4 h-4",style:{color:haEnabled?'#60b515':'#728b9a'}}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-[12px]",style:{color:'#e9ecef'}},haEnabled?t('active'):t('disabled')),haEnabled&&/*#__PURE__*/React.createElement("div",{className:"text-[11px]",style:{color:'#728b9a'}},"Max Restart: 3 | Max Relocate: 3"))))))));}// Proxmox Native HA Section for Settings
function ProxmoxHaSection({clusterId}){const{t}=useTranslation();const{getAuthHeaders}=useAuth();const[resources,setResources]=useState([]);const[loading,setLoading]=useState(true);// Local authFetch helper
const authFetch=async(url,options={})=>{try{return await fetch(url,{...options,credentials:'include',headers:{...options.headers,...getAuthHeaders()}});}catch(err){console.error('Auth fetch error:',err);return null;}};useEffect(()=>{const fetchData=async()=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/proxmox-ha/resources`);if(response&&response.ok){setResources(await response.json());}}catch(error){console.error('fetching HA data:',error);}finally{setLoading(false);}};fetchData();},[clusterId]);const removeFromHa=async sid=>{try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/proxmox-ha/resources/${sid}`,{method:'DELETE'});if(res&&res.ok){setResources(resources.filter(r=>r.sid!==sid));}}catch(e){console.error('removing from HA:',e);}};if(loading){return/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-gray-500 text-sm"},/*#__PURE__*/React.createElement(Icons.RotateCw,null),t('loading'));}return/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-400"},resources.length," ",t('vmsWithHa'))),resources.length===0?/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-600 p-3 bg-proxmox-dark rounded-lg"},t('noVmsWithHa')):/*#__PURE__*/React.createElement("div",{className:"space-y-2 max-h-48 overflow-y-auto"},resources.map(resource=>{const[type,vmid]=(resource.sid||'').split(':');return/*#__PURE__*/React.createElement("div",{key:resource.sid,className:"flex items-center justify-between p-2 bg-proxmox-dark rounded-lg text-sm"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:type==='vm'?'text-blue-400':'text-purple-400'},type==='vm'?'VM':'CT'," ",vmid),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},"Max Restart: ",resource.max_restart||3)),/*#__PURE__*/React.createElement("button",{onClick:()=>removeFromHa(resource.sid),className:"p-1 rounded hover:bg-red-500/20 text-gray-500 hover:text-red-400",title:t('removeFromHa')},/*#__PURE__*/React.createElement(Icons.X,null)));})));}// Migrate Modal Component
// LW: This thing was a nightmare to debug. ISO detection finally works now!
// See also: CrossClusterMigrateModal below (similar logic)
function MigrateModal({vm,nodes,clusterId,onMigrate,onClose}){const{t}=useTranslation();const{getAuthHeaders}=useAuth();const[targetNode,setTargetNode]=useState('');const[targetStorage,setTargetStorage]=useState('');const[online,setOnline]=useState(true);const[withLocalDisks,setWithLocalDisks]=useState(false);const[forceConntrack,setForceConntrack]=useState(false);const[loading,setLoading]=useState(false);const[storages,setStorages]=useState([]);const[loadingStorages,setLoadingStorages]=useState(false);const[hasLocalDisks,setHasLocalDisks]=useState(false);const[hasCdDvd,setHasCdDvd]=useState(false);const[detectedIsos,setDetectedIsos]=useState([]);const[bootOrderIssues,setBootOrderIssues]=useState([]);const availableNodes=nodes.filter(n=>n!==vm.node);const isContainer=vm.type==='lxc';// check if VM has local disks, CD/DVD, and boot order issues on mount
// NS: Now listens to SSE events for live updates
useEffect(()=>{if(!vm||!vm.node||!clusterId)return;const processVmConfig=data=>{const config=data.raw||data;// Check all disk entries for local storage
const diskKeys=Object.keys(config).filter(k=>k.match(/^(scsi|sata|virtio|ide|mp|rootfs)\d*$/));const hasLocal=diskKeys.some(key=>{const diskValue=config[key];if(typeof diskValue==='string'){return diskValue.includes('shared=0')||diskValue.startsWith('local:')||diskValue.startsWith('local-lvm:')||diskValue.startsWith('local-zfs:');}return false;});setHasLocalDisks(hasLocal);if(hasLocal){setWithLocalDisks(true);}// Check for CD/DVD drives with ISO mounted
const cdDvdKeys=Object.keys(config).filter(k=>k.match(/^(ide|sata|scsi)\d*$/));const foundIsos=[];cdDvdKeys.forEach(key=>{const value=config[key];if(typeof value==='string'&&value.includes('media=cdrom')){const isoMatch=value.match(/^([^,]+)/);if(isoMatch&&isoMatch[1]&&!isoMatch[1].includes('none')){const isoPath=isoMatch[1];const isLocalStorage=isoPath.startsWith('local:')||isoPath.startsWith('local-lvm:')||isoPath.startsWith('local-zfs:');foundIsos.push({device:key,iso:isoPath,isLocal:isLocalStorage});}}});setHasCdDvd(foundIsos.length>0);setDetectedIsos(foundIsos);// Check boot order for non-existent disks
const bootOrder=config.boot||'';const bootDevices=bootOrder.includes('order=')?bootOrder.split('order=')[1].split(';')[0].split(','):[];const issues=[];bootDevices.forEach(device=>{if(device&&!config[device]&&device!=='net0'){issues.push(device);}});setBootOrderIssues(issues);};const checkVmConfig=async()=>{try{const response=await fetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/config`,{credentials:'include',headers:getAuthHeaders()});if(response&&response.ok){const data=await response.json();processVmConfig(data);}}catch(err){console.error('checking VM config:',err);}};checkVmConfig();// NS: Listen to SSE vm_config events for live updates
const handleVmConfigUpdate=event=>{const{vmid:eventVmid,vm_type,config:newConfig,cluster_id}=event.detail;if(eventVmid===vm.vmid&&vm_type===vm.type&&cluster_id===clusterId){console.log('SSE: Updating MigrateModal config for',vm.vmid);processVmConfig(newConfig);}};window.addEventListener('pegaprox-vm-config',handleVmConfigUpdate);return()=>window.removeEventListener('pegaprox-vm-config',handleVmConfigUpdate);},[vm,clusterId]);// Fetch storages when target node changes
useEffect(()=>{if(targetNode){fetchStorages(targetNode);}else{setStorages([]);setTargetStorage('');}},[targetNode]);const fetchStorages=async node=>{setLoadingStorages(true);try{const response=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/storage`,{credentials:'include',headers:getAuthHeaders()});if(response&&response.ok){const data=await response.json();// Filter storages that can hold VM/CT images
const validStorages=data.filter(s=>s.content&&(s.content.includes('images')||s.content.includes('rootdir')));setStorages(validStorages);}}catch(err){console.error('fetching storages:',err);}setLoadingStorages(false);};const handleMigrate=async()=>{if(!targetNode)return;setLoading(true);const options={online,targetStorage:targetStorage||null,withLocalDisks,forceConntrack:isContainer?forceConntrack:null};await onMigrate(vm,targetNode,online,options);setLoading(false);onClose();};return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-md bg-proxmox-card border border-proxmox-border rounded-xl p-6 animate-scale-in"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4"},t('migrateVm')),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"p-3 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},vm.type==='qemu'?/*#__PURE__*/React.createElement(Icons.VM,null):/*#__PURE__*/React.createElement(Icons.Container,null),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"font-medium text-white"},vm.name||`VM ${vm.vmid}`),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-400"},"ID ",vm.vmid," ",t('on')," ",vm.node)))),(hasCdDvd||bootOrderIssues.length>0)&&/*#__PURE__*/React.createElement("div",{className:"space-y-2"},hasCdDvd&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-2"},/*#__PURE__*/React.createElement("span",{className:"text-red-400 text-lg"},"\uD83D\uDCBF"),/*#__PURE__*/React.createElement("div",{className:"flex-1"},/*#__PURE__*/React.createElement("p",{className:"text-red-400 font-medium text-sm"},t('isoMounted')||'ISO/CD-ROM Mounted'),/*#__PURE__*/React.createElement("p",{className:"text-red-300/70 text-xs mt-1"},t('isoMigrationWarning')||'Migration may fail if the ISO is not available on the target node. Eject the CD/DVD or ensure the ISO exists on shared storage.'),detectedIsos&&detectedIsos.length>0&&/*#__PURE__*/React.createElement("div",{className:"mt-2 space-y-1"},detectedIsos.map((iso,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"flex items-center gap-2 text-xs flex-wrap"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},iso.device,":"),/*#__PURE__*/React.createElement("code",{className:"text-red-300 bg-red-500/10 px-1 rounded break-all"},iso.iso),iso.isLocal&&/*#__PURE__*/React.createElement("span",{className:"px-1.5 py-0.5 bg-red-500/20 text-red-400 rounded text-[10px]"},t('localStorage')||'Local'))))))),bootOrderIssues.length>0&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg flex items-start gap-2"},/*#__PURE__*/React.createElement("span",{className:"text-yellow-400 text-lg"},"\u26A0\uFE0F"),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("p",{className:"text-yellow-400 font-medium text-sm"},t('bootOrderIssue')||'Boot Order Issue'),/*#__PURE__*/React.createElement("p",{className:"text-yellow-300/70 text-xs"},t('bootOrderWarning')||'Boot order references non-existent disks',": ",/*#__PURE__*/React.createElement("code",{className:"bg-yellow-500/10 px-1 rounded"},bootOrderIssues.join(', ')))))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('targetNode')),/*#__PURE__*/React.createElement("select",{value:targetNode,onChange:e=>setTargetNode(e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:""},t('selectNode'),"..."),availableNodes.map(node=>/*#__PURE__*/React.createElement("option",{key:node,value:node},node)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('targetStorage')),/*#__PURE__*/React.createElement("select",{value:targetStorage,onChange:e=>setTargetStorage(e.target.value),disabled:!targetNode||loadingStorages,className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white disabled:opacity-50"},/*#__PURE__*/React.createElement("option",{value:""},t('sameAsSource')),storages.map(storage=>/*#__PURE__*/React.createElement("option",{key:storage.storage,value:storage.storage},storage.storage," (",storage.type,") - ",Math.round((storage.avail||0)/1073741824)," GB ",t('free')))),loadingStorages&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('loadingStorages'),"...")),/*#__PURE__*/React.createElement("div",{className:"space-y-3 pt-2 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-3 text-sm text-gray-300 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:online,onChange:e=>setOnline(e.target.checked),className:"w-4 h-4 rounded"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",null,t('liveMigration')),isContainer&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-yellow-500 mt-0.5"},"\u26A0\uFE0F ",t('containerNoLiveMigration')))),hasLocalDisks&&/*#__PURE__*/React.createElement("div",{className:"p-2 bg-yellow-500/10 border border-yellow-500/30 rounded-lg"},/*#__PURE__*/React.createElement("p",{className:"text-xs text-yellow-400"},"\u26A0\uFE0F ",t('localDisksDetected')||'This VM has local disks. Migration requires copying disk data.')),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-3 text-sm text-gray-300 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:withLocalDisks,onChange:e=>setWithLocalDisks(e.target.checked),className:"w-4 h-4 rounded"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",null,t('withLocalDisks')),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},t('withLocalDisksDesc')),hasLocalDisks&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-yellow-400"},t('requiredForThisVm')||'Required for this VM'))),isContainer&&/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-3 text-sm text-gray-300 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:forceConntrack,onChange:e=>setForceConntrack(e.target.checked),className:"w-4 h-4 rounded"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",null,t('forceConntrack')),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},t('forceConntrackDesc')))))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"px-4 py-2 text-gray-300 hover:text-white"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:handleMigrate,disabled:!targetNode||loading,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 rounded-lg text-white hover:bg-blue-700 disabled:opacity-50"},loading&&/*#__PURE__*/React.createElement(Icons.RotateCw,null),t('migrate')))));}// Bulk Migrate Modal Component
// NS: For evacuating nodes before maintenance
// Migrations run sequentially to avoid overloading the network
function BulkMigrateModal({vms,nodes,clusterId,onMigrate,onClose}){const{t}=useTranslation();// MK: Fix missing translation hook
const[targetNode,setTargetNode]=useState('');const[online,setOnline]=useState(true);const[loading,setLoading]=useState(false);// Get all unique current nodes
const currentNodes=[...new Set(vms.map(v=>v.node))];const availableNodes=nodes.filter(n=>!currentNodes.includes(n)||currentNodes.length>1);const handleMigrate=async()=>{if(!targetNode)return;setLoading(true);await onMigrate(vms,targetNode,online);setLoading(false);onClose();};return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-lg bg-proxmox-card border border-proxmox-border rounded-xl p-6 animate-scale-in"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4"},t('bulkMigration')),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"p-3 bg-proxmox-dark rounded-lg max-h-48 overflow-y-auto"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mb-2"},vms.length," ",t('vmsSelected'),":"),/*#__PURE__*/React.createElement("div",{className:"space-y-1"},vms.map(vm=>/*#__PURE__*/React.createElement("div",{key:vm.vmid,className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement("span",{className:"text-proxmox-orange font-mono"},vm.vmid),/*#__PURE__*/React.createElement("span",{className:"text-white"},vm.name||'-'),/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"(",vm.node,")"))))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('targetNode')),/*#__PURE__*/React.createElement("select",{value:targetNode,onChange:e=>setTargetNode(e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:""},t('selectNode')),availableNodes.map(node=>/*#__PURE__*/React.createElement("option",{key:node,value:node},node)))),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-3 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:online,onChange:e=>setOnline(e.target.checked),className:"w-4 h-4 rounded"}),t('liveMigration')),/*#__PURE__*/React.createElement("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg text-sm text-yellow-400"},t('bulkMigrationNote')||'Migrations will be performed sequentially. This may take some time.')),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"px-4 py-2 text-gray-300 hover:text-white"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:handleMigrate,disabled:!targetNode||loading,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 rounded-lg text-white hover:bg-blue-700 disabled:opacity-50"},loading&&/*#__PURE__*/React.createElement(Icons.RotateCw,null),vms.length," ",t('migrateVms')))));}// Cross-Cluster Migration Modal
// NS: The big one - SSH tunnel based migration between clusters
// Uses same ISO detection logic as MigrateModal (copy-paste, I know...)
function CrossClusterMigrateModal({vm,sourceCluster,clusters,onMigrate,onClose}){const{getAuthHeaders}=useAuth();const{t}=useTranslation();const[targetCluster,setTargetCluster]=useState('');const[targetNode,setTargetNode]=useState('');const[targetStorage,setTargetStorage]=useState('');const[targetBridge,setTargetBridge]=useState('vmbr0');const[targetVmid,setTargetVmid]=useState('');const[online,setOnline]=useState(true);const[forceOnline,setForceOnline]=useState(false);// Force online migration for large disks
const[deleteSource,setDeleteSource]=useState(true);const[loading,setLoading]=useState(false);const[targetNodes,setTargetNodes]=useState([]);const[targetStorages,setTargetStorages]=useState([]);const[targetBridges,setTargetBridges]=useState([]);const[loadingTarget,setLoadingTarget]=useState(false);const[hasCdDvd,setHasCdDvd]=useState(false);const[detectedIsos,setDetectedIsos]=useState([]);const[bootOrderIssues,setBootOrderIssues]=useState([]);const[estimatedDiskGb,setEstimatedDiskGb]=useState(0);// Track disk size for warnings
const availableClusters=clusters.filter(c=>c.id!==sourceCluster.id);const isQemu=vm.type==='qemu';// Local authFetch helper
const authFetch=async(url,options={})=>{try{const response=await fetch(url,{...options,credentials:'include',headers:{...options.headers,...getAuthHeaders()}});return response;}catch(err){console.error('Auth fetch error:',err);return null;}};// Check for CD/DVD and boot order issues
// NS: Now uses SSE events for live updates
useEffect(()=>{const processVmConfig=config=>{// Check for CD/DVD drives with ISO mounted
const cdDvdKeys=Object.keys(config).filter(k=>k.match(/^(ide|sata|scsi)\d*$/));const foundIsos=[];cdDvdKeys.forEach(key=>{const value=config[key];if(typeof value==='string'&&value.includes('media=cdrom')){const isoMatch=value.match(/^([^,]+)/);if(isoMatch&&isoMatch[1]&&!isoMatch[1].includes('none')){const isoPath=isoMatch[1];const isLocal=isoPath.startsWith('local:')||isoPath.startsWith('local-lvm:')||isoPath.startsWith('local-zfs:');foundIsos.push({device:key,iso:isoPath,isLocal});}}});setHasCdDvd(foundIsos.length>0);setDetectedIsos(foundIsos);// Check boot order for non-existent disks
const bootOrder=config.boot||'';const bootDevices=bootOrder.includes('order=')?bootOrder.split('order=')[1].split(';')[0].split(','):[];const issues=[];bootDevices.forEach(device=>{if(device&&!config[device]&&device!=='net0'){issues.push(device);}});setBootOrderIssues(issues);// Calculate total disk size for large VM warning
let totalDiskGb=0;Object.keys(config).forEach(key=>{if(key.match(/^(scsi|virtio|sata|ide)\d+$/)&&typeof config[key]==='string'){const sizeMatch=config[key].match(/size=(\d+)([GMT])/);if(sizeMatch){const sizeVal=parseInt(sizeMatch[1]);const sizeUnit=sizeMatch[2];if(sizeUnit==='G')totalDiskGb+=sizeVal;else if(sizeUnit==='T')totalDiskGb+=sizeVal*1024;else if(sizeUnit==='M')totalDiskGb+=sizeVal/1024;}}});setEstimatedDiskGb(totalDiskGb);};const checkVmConfig=async()=>{try{const response=await authFetch(`${API_URL}/clusters/${sourceCluster.id}/vms/${vm.node}/${vm.type}/${vm.vmid}/config`);if(response&&response.ok){const data=await response.json();const config=data.raw||data;processVmConfig(config);}}catch(err){console.error('checking VM config:',err);}};checkVmConfig();// NS: Listen to SSE vm_config events for live updates
const handleVmConfigUpdate=event=>{const{vmid:eventVmid,vm_type,config:newConfig,cluster_id}=event.detail;if(eventVmid===vm.vmid&&vm_type===vm.type&&cluster_id===sourceCluster.id){console.log('SSE: Updating CrossClusterMigrateModal for',vm.vmid);const config=newConfig.raw||newConfig;processVmConfig(config);}};window.addEventListener('pegaprox-vm-config',handleVmConfigUpdate);return()=>window.removeEventListener('pegaprox-vm-config',handleVmConfigUpdate);},[vm,sourceCluster.id]);// Load target cluster nodes when cluster selected
useEffect(()=>{if(targetCluster){loadTargetNodes();}else{setTargetNodes([]);setTargetNode('');}},[targetCluster]);// Load target node resources when node selected
useEffect(()=>{if(targetCluster&&targetNode){loadTargetResources();}else{setTargetStorages([]);setTargetBridges([]);}},[targetNode]);const loadTargetNodes=async()=>{setLoadingTarget(true);try{const nodesRes=await authFetch(`${API_URL}/clusters/${targetCluster}/nodes`);if(nodesRes&&nodesRes.ok){const nodes=await nodesRes.json();setTargetNodes(nodes);// Auto-select first online node
const onlineNode=nodes.find(n=>n.status==='online');if(onlineNode){setTargetNode(onlineNode.node);}}}catch(error){console.error('to load target nodes:',error);}setLoadingTarget(false);};const loadTargetResources=async()=>{setLoadingTarget(true);try{// Get storage list for selected node
const storageRes=await authFetch(`${API_URL}/clusters/${targetCluster}/nodes/${targetNode}/storage`);if(storageRes&&storageRes.ok){setTargetStorages(await storageRes.json());}// Get network list for selected node (including SDN VNets)
const networkRes=await authFetch(`${API_URL}/clusters/${targetCluster}/nodes/${targetNode}/networks`);if(networkRes&&networkRes.ok){const networks=await networkRes.json();// Include local bridges AND SDN VNets
setTargetBridges(networks.filter(n=>n.type==='bridge'||n.type==='OVSBridge'||n.source==='sdn'));}}catch(error){console.error('to load target resources:',error);}setLoadingTarget(false);};const handleMigrate=async()=>{if(!targetCluster||!targetNode||!targetStorage||!targetBridge)return;setLoading(true);await onMigrate({source_cluster:sourceCluster.id,target_cluster:targetCluster,vmid:vm.vmid,vm_type:vm.type,source_node:vm.node,target_node:targetNode,target_storage:targetStorage,target_bridge:targetBridge,target_vmid:targetVmid?parseInt(targetVmid):null,online,force_online:forceOnline,delete_source:deleteSource});setLoading(false);onClose();};return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 overflow-y-auto"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-xl bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden animate-scale-in my-8"},/*#__PURE__*/React.createElement("div",{className:"px-6 py-4 border-b border-proxmox-border bg-gradient-to-r from-cyan-500/10 to-blue-500/10"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-2 rounded-lg bg-cyan-500/20"},/*#__PURE__*/React.createElement(Icons.Globe,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white"},t('crossClusterMigration')),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},t('crossClusterMigrateDesc')))),/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"p-2 hover:bg-proxmox-border rounded-lg text-gray-400 hover:text-white"},/*#__PURE__*/React.createElement(Icons.X,null)))),/*#__PURE__*/React.createElement("div",{className:"p-6 space-y-4 max-h-[60vh] overflow-y-auto"},/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-2"},t('sourceVm')),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:`p-2 rounded-lg ${isQemu?'bg-blue-500/10':'bg-purple-500/10'}`},isQemu?/*#__PURE__*/React.createElement(Icons.VM,null):/*#__PURE__*/React.createElement(Icons.Container,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"font-medium text-white"},vm.name||`${isQemu?'VM':'CT'} ${vm.vmid}`),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-400"},"ID ",vm.vmid," \xB7 ",vm.node," \xB7 ",sourceCluster.name)))),(hasCdDvd||bootOrderIssues.length>0)&&/*#__PURE__*/React.createElement("div",{className:"space-y-2"},hasCdDvd&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-2"},/*#__PURE__*/React.createElement("span",{className:"text-red-400 text-lg"},"\uD83D\uDCBF"),/*#__PURE__*/React.createElement("div",{className:"flex-1"},/*#__PURE__*/React.createElement("p",{className:"text-red-400 font-medium text-sm"},t('isoMounted')||'ISO/CD-ROM Mounted'),/*#__PURE__*/React.createElement("p",{className:"text-red-300/70 text-xs mt-1"},t('isoMigrationWarning')||'Migration may fail if the ISO is not available on the target node. Eject the CD/DVD or ensure the ISO exists on shared storage.'),detectedIsos&&detectedIsos.length>0&&/*#__PURE__*/React.createElement("div",{className:"mt-2 space-y-1"},detectedIsos.map((iso,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"flex items-center gap-2 text-xs flex-wrap"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},iso.device,":"),/*#__PURE__*/React.createElement("code",{className:"text-red-300 bg-red-500/10 px-1 rounded break-all"},iso.iso),iso.isLocal&&/*#__PURE__*/React.createElement("span",{className:"px-1.5 py-0.5 bg-red-500/20 text-red-400 rounded text-[10px]"},t('localStorage')||'Local'))))))),bootOrderIssues.length>0&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg flex items-start gap-2"},/*#__PURE__*/React.createElement("span",{className:"text-yellow-400 text-lg"},"\u26A0\uFE0F"),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("p",{className:"text-yellow-400 font-medium text-sm"},t('bootOrderIssue')||'Boot Order Issue'),/*#__PURE__*/React.createElement("p",{className:"text-yellow-300/70 text-xs"},t('bootOrderWarning')||'Boot order references non-existent disks',": ",/*#__PURE__*/React.createElement("code",{className:"bg-yellow-500/10 px-1 rounded"},bootOrderIssues.join(', ')))))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('targetCluster')),/*#__PURE__*/React.createElement("select",{value:targetCluster,onChange:e=>setTargetCluster(e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:""},t('selectCluster')),availableClusters.map(c=>/*#__PURE__*/React.createElement("option",{key:c.id,value:c.id},c.name)))),targetCluster&&/*#__PURE__*/React.createElement(React.Fragment,null,loadingTarget&&targetNodes.length===0?/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center py-4 text-gray-400"},/*#__PURE__*/React.createElement(Icons.RotateCw,null),/*#__PURE__*/React.createElement("span",{className:"ml-2"},t('loadingNodes'))):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('targetNode')),/*#__PURE__*/React.createElement("select",{value:targetNode,onChange:e=>setTargetNode(e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:""},t('selectNode'),"..."),targetNodes.map(n=>/*#__PURE__*/React.createElement("option",{key:n.node,value:n.node},n.node," (",n.status,") - CPU: ",n.cpu_percent?.toFixed(1),"% RAM: ",n.mem_percent?.toFixed(1),"%")))),targetNode&&/*#__PURE__*/React.createElement(React.Fragment,null,loadingTarget?/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center py-4 text-gray-400"},/*#__PURE__*/React.createElement(Icons.RotateCw,null),/*#__PURE__*/React.createElement("span",{className:"ml-2"},t('loadingStorageNetwork'))):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('targetStorage')),/*#__PURE__*/React.createElement("select",{value:targetStorage,onChange:e=>setTargetStorage(e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:""},t('selectStorage')),targetStorages.map(s=>/*#__PURE__*/React.createElement("option",{key:s.storage,value:s.storage},s.storage," (",s.type,")")))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('targetBridge')," / VNet"),/*#__PURE__*/React.createElement("select",{value:targetBridge,onChange:e=>setTargetBridge(e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},targetBridges.length===0&&/*#__PURE__*/React.createElement("option",{value:"vmbr0"},"vmbr0"),targetBridges.filter(b=>b.source!=='sdn').length>0&&/*#__PURE__*/React.createElement("optgroup",{label:"Local Bridges"},targetBridges.filter(b=>b.source!=='sdn').map(b=>/*#__PURE__*/React.createElement("option",{key:b.iface,value:b.iface},b.iface,b.comments?` - ${b.comments}`:''))),targetBridges.filter(b=>b.source==='sdn').length>0&&/*#__PURE__*/React.createElement("optgroup",{label:"SDN VNets"},targetBridges.filter(b=>b.source==='sdn').map(b=>/*#__PURE__*/React.createElement("option",{key:b.iface,value:b.iface},b.iface," - ",b.zone||'SDN',b.alias?` (${b.alias})`:''))))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('newVmid')),/*#__PURE__*/React.createElement("input",{type:"number",value:targetVmid,onChange:e=>setTargetVmid(e.target.value),placeholder:`${t('sameIdPlaceholder')} (${vm.vmid})`,className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},isQemu&&/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-3 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:online,onChange:e=>setOnline(e.target.checked),className:"w-4 h-4 rounded"}),t('liveMigrationOption')),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-3 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:deleteSource,onChange:e=>setDeleteSource(e.target.checked),className:"w-4 h-4 rounded"}),t('deleteSourceAfter'))),estimatedDiskGb>100&&online&&isQemu&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg space-y-2"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-yellow-400"},"\u26A0\uFE0F ",/*#__PURE__*/React.createElement("strong",null,t('largeDiskWarning')||'Large Disk Detected')," (",estimatedDiskGb.toFixed(0)," GB)"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-yellow-400/80"},t('largeDiskExplanation')||'Live migration for disks >100GB may fail with "401 Unauthorized" due to Proxmox WebSocket ticket timeout. The server will automatically use offline migration unless forced.'),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-3 text-sm text-yellow-300 mt-2"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:forceOnline,onChange:e=>setForceOnline(e.target.checked),className:"w-4 h-4 rounded"}),t('forceOnlineMigration')||'Force online migration anyway (may fail)')))))),/*#__PURE__*/React.createElement("div",{className:"p-3 bg-green-500/10 border border-green-500/30 rounded-lg text-sm text-green-400"},"\u2713 ",/*#__PURE__*/React.createElement("strong",null,t('autoTokenInfo').split('.')[0],".")," ",t('autoTokenInfo').split('.').slice(1).join('.')),/*#__PURE__*/React.createElement("div",{className:"p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg text-sm text-blue-400"},"\uD83D\uDCA1 ",t('clusterReachableInfo'))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 px-6 py-4 border-t border-proxmox-border bg-proxmox-dark"},/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"px-4 py-2 text-gray-300 hover:text-white"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:handleMigrate,disabled:!targetCluster||!targetNode||!targetStorage||loading,className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 rounded-lg text-white hover:bg-cyan-700 disabled:opacity-50"},loading&&/*#__PURE__*/React.createElement(Icons.RotateCw,null),/*#__PURE__*/React.createElement(Icons.Globe,null),t('crossClusterMigrate')))));}// Migration History Component
// LW: Limited to 10 items by default (GitHub Issue - list was too long)
function MigrationHistory({logs,maxItems=10}){const{t}=useTranslation();if(!logs||logs.length===0){return/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},/*#__PURE__*/React.createElement(Icons.Activity,null),/*#__PURE__*/React.createElement("p",{className:"mt-2"},t('noMigrationsYet')));}// LW: Only show last 10 migrations (newest first)
const reversedLogs=logs.slice().reverse();const displayLogs=reversedLogs.slice(0,maxItems);const hiddenCount=reversedLogs.length-maxItems;return/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"relative space-y-4"},/*#__PURE__*/React.createElement("div",{className:"timeline-line"}),displayLogs.map((log,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"relative pl-12 animate-slide-in",style:{animationDelay:`${idx*50}ms`}},/*#__PURE__*/React.createElement("div",{className:`absolute left-2 w-6 h-6 rounded-full flex items-center justify-center ${log.success?'bg-green-500/20 text-green-400 border border-green-500/30':'bg-red-500/20 text-red-400 border border-red-500/30'}`},log.success?/*#__PURE__*/React.createElement(Icons.Check,null):/*#__PURE__*/React.createElement(Icons.X,null)),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-2"},/*#__PURE__*/React.createElement("span",{className:"font-medium text-white"},log.vm),log.dry_run&&/*#__PURE__*/React.createElement("span",{className:"text-xs bg-yellow-500/10 text-yellow-400 px-2 py-0.5 rounded border border-yellow-500/20"},"Dry Run")),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-sm text-gray-400"},/*#__PURE__*/React.createElement("span",{className:"font-mono"},log.from_node),/*#__PURE__*/React.createElement(Icons.ArrowRight,null),/*#__PURE__*/React.createElement("span",{className:"font-mono"},log.to_node)),/*#__PURE__*/React.createElement("div",{className:"mt-2 text-xs text-gray-500"},new Date(log.timestamp).toLocaleString('de-DE')))))),hiddenCount>0&&/*#__PURE__*/React.createElement("div",{className:"text-center py-2 text-xs text-gray-500"},"+ ",hiddenCount," ",t('olderMigrations')||'older migrations'));}// MK: Group Overview - drills into a single cluster group
// basically a scoped-down version of AllClustersOverview w/ LB stuff
function GroupOverview({group,clusters,allMetrics,clusterGroups=[],topGuests=[],onSelectCluster,onSelectVm,onOpenSettings,authFetch,API_URL}){const{t}=useTranslation();const{isCorporate}=useLayout();const[sortBy,setSortBy]=useState('name');const[sortDir,setSortDir]=useState('asc');const[cpuHistory,setCpuHistory]=useState({});const[ramHistory,setRamHistory]=useState({});const[lbHistory,setLbHistory]=useState([]);const[groupStatus,setGroupStatus]=useState(null);// NS: only clusters that belong to this group
const groupClusters=clusters.filter(c=>c.group_id===group.id);// sparkline history - same as AllClustersOverview
useEffect(()=>{groupClusters.forEach(cluster=>{const status=allMetrics[cluster.id]?.data||{};const cpu=status.resources?.cpu?.percent||0;const ram=status.resources?.memory?.percent||0;setCpuHistory(prev=>({...prev,[cluster.id]:[...(prev[cluster.id]||[]).slice(-9),cpu]}));setRamHistory(prev=>({...prev,[cluster.id]:[...(prev[cluster.id]||[]).slice(-9),ram]}));});},[allMetrics]);// LW: fetch LB history + group status
useEffect(()=>{if(!group?.id)return;(async()=>{try{const r=await authFetch(`${API_URL}/cluster-groups/${group.id}/lb-history`);if(r?.ok){const d=await r.json();setLbHistory(Array.isArray(d)?d:[]);}}catch(err){console.error('Failed to fetch LB history:',err);}})();(async()=>{try{const r=await authFetch(`${API_URL}/cluster-groups/${group.id}/status`);if(r?.ok){const d=await r.json();setGroupStatus(d);}}catch(err){console.error('Failed to fetch group status:',err);}})();},[group?.id]);// stats per cluster - same calc as AllClustersOverview
const clusterStats=groupClusters.map(cluster=>{const status=allMetrics[cluster.id]?.data||{};const lastUpdate=allMetrics[cluster.id]?.lastUpdate;const nodes=status.nodes||{};const guests=status.guests||{};const resources=status.resources||{};const nodeCount=nodes.total||0;const onlineNodes=nodes.online||0;const offlineNodes=nodes.offline||0;const avgCpu=resources.cpu?.percent||0;const avgMem=resources.memory?.percent||0;const avgStorage=resources.storage?.percent||0;const vmsRunning=(guests.vms?.running||0)+(guests.containers?.running||0);const vmsStopped=(guests.vms?.stopped||0)+(guests.containers?.stopped||0);const totalVms=vmsRunning+vmsStopped;// health score - weighted average of metrics
const healthScore=cluster.connected?Math.max(0,100-(avgCpu*0.3+avgMem*0.3+avgStorage*0.2+(nodeCount>0?offlineNodes/nodeCount*100*0.2:0))):0;const alerts=[];if(!cluster.connected)alerts.push({type:'error',msg:'Offline'});if(offlineNodes>0)alerts.push({type:'warning',msg:`${offlineNodes} node(s) offline`});if(avgCpu>90)alerts.push({type:'error',msg:'CPU critical'});else if(avgCpu>80)alerts.push({type:'warning',msg:'CPU high'});if(avgMem>90)alerts.push({type:'error',msg:'RAM critical'});else if(avgMem>80)alerts.push({type:'warning',msg:'RAM high'});if(avgStorage>90)alerts.push({type:'error',msg:'Storage critical'});else if(avgStorage>80)alerts.push({type:'warning',msg:'Storage high'});return{...cluster,nodeCount,onlineNodes,offlineNodes,avgCpu,avgMem,avgStorage,totalVms,runningVms:vmsRunning,healthScore:Math.round(healthScore),hasMetrics:nodeCount>0||cluster.connected,lastUpdate,alerts,cpuHistory:cpuHistory[cluster.id]||[],ramHistory:ramHistory[cluster.id]||[]};});// sorting
const sortedStats=[...clusterStats].sort((a,b)=>{let aVal,bVal;switch(sortBy){case'health':aVal=a.healthScore;bVal=b.healthScore;break;case'nodes':aVal=a.nodeCount;bVal=b.nodeCount;break;case'vms':aVal=a.totalVms;bVal=b.totalVms;break;case'cpu':aVal=a.avgCpu;bVal=b.avgCpu;break;case'ram':aVal=a.avgMem;bVal=b.avgMem;break;default:aVal=(a.display_name||a.name).toLowerCase();bVal=(b.display_name||b.name).toLowerCase();}if(typeof aVal==='string')return sortDir==='asc'?aVal.localeCompare(bVal):bVal.localeCompare(aVal);return sortDir==='asc'?aVal-bVal:bVal-aVal;});// group totals
const withMetrics=clusterStats.filter(c=>c.hasMetrics);const totals={clusters:groupClusters.length,connectedClusters:groupClusters.filter(c=>c.connected).length,totalNodes:clusterStats.reduce((acc,c)=>acc+c.nodeCount,0),onlineNodes:clusterStats.reduce((acc,c)=>acc+c.onlineNodes,0),totalVms:clusterStats.reduce((acc,c)=>acc+c.totalVms,0),runningVms:clusterStats.reduce((acc,c)=>acc+c.runningVms,0),avgCpu:withMetrics.length>0?clusterStats.reduce((acc,c)=>acc+c.avgCpu,0)/withMetrics.length:0,avgMem:withMetrics.length>0?clusterStats.reduce((acc,c)=>acc+c.avgMem,0)/withMetrics.length:0,avgStorage:withMetrics.length>0?clusterStats.reduce((acc,c)=>acc+c.avgStorage,0)/withMetrics.length:0,totalAlerts:clusterStats.reduce((acc,c)=>acc+c.alerts.length,0)};const lbEnabled=!!group.cross_cluster_lb_enabled;// NS: sparkline - same as AllClustersOverview
const Sparkline=({data,color,height=20,width=60})=>{if(!data||data.length<2)return/*#__PURE__*/React.createElement("div",{style:{width,height},className:"bg-proxmox-dark/50 rounded"});const max=Math.max(...data,1);const min=Math.min(...data,0);const range=max-min||1;const points=data.map((v,i)=>`${i/(data.length-1)*width},${height-(v-min)/range*height}`).join(' ');return/*#__PURE__*/React.createElement("svg",{width:width,height:height,className:"overflow-visible"},/*#__PURE__*/React.createElement("polyline",{fill:"none",stroke:color,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",points:points}),/*#__PURE__*/React.createElement("circle",{cx:width,cy:height-(data[data.length-1]-min)/range*height,r:"2",fill:color}));};// circular progress gauge
const CircularProgress=({value,size=60,strokeWidth=6,color})=>{const radius=(size-strokeWidth)/2;const circumference=radius*2*Math.PI;const offset=circumference-value/100*circumference;return/*#__PURE__*/React.createElement("div",{className:"relative flex-shrink-0",style:{width:size,height:size}},/*#__PURE__*/React.createElement("svg",{className:"transform -rotate-90 overflow-visible",width:size,height:size},/*#__PURE__*/React.createElement("circle",{cx:size/2,cy:size/2,r:radius,fill:"none",stroke:"currentColor",strokeWidth:strokeWidth,className:"text-gray-700"}),/*#__PURE__*/React.createElement("circle",{cx:size/2,cy:size/2,r:radius,fill:"none",stroke:color,strokeWidth:strokeWidth,strokeLinecap:"round",strokeDasharray:circumference,strokeDashoffset:offset,className:"transition-all duration-500"})),/*#__PURE__*/React.createElement("div",{className:"absolute inset-0 flex items-center justify-center"},/*#__PURE__*/React.createElement("span",{className:"text-xs font-bold text-white"},value.toFixed(0),"%")));};const getHealthColor=score=>{if(score>=80)return{bg:'bg-green-500/20',text:'text-green-400',border:'border-green-500/30',color:'#22c55e'};if(score>=60)return{bg:'bg-yellow-500/20',text:'text-yellow-400',border:'border-yellow-500/30',color:'#eab308'};if(score>=40)return{bg:'bg-orange-500/20',text:'text-orange-400',border:'border-orange-500/30',color:'#f97316'};return{bg:'bg-red-500/20',text:'text-red-400',border:'border-red-500/30',color:'#ef4444'};};const formatLastUpdate=date=>{if(!date)return'-';const now=new Date();const diff=Math.floor((now-new Date(date))/1000);if(diff<10)return t('justNow')||'just now';if(diff<60)return`${diff}s ago`;if(diff<3600)return`${Math.floor(diff/60)}m ago`;return new Date(date).toLocaleTimeString();};const SortButton=({field,label})=>/*#__PURE__*/React.createElement("button",{onClick:()=>{setSortBy(field);setSortDir(sortBy===field&&sortDir==='asc'?'desc':'asc');},className:`px-3 py-1.5 text-sm rounded-lg transition-colors ${sortBy===field?'bg-proxmox-orange/20 text-proxmox-orange font-medium':'text-gray-400 hover:text-white hover:bg-proxmox-dark'}`},label," ",sortBy===field&&(sortDir==='asc'?'â†‘':'â†“'));// MK: cluster card - clickable, same layout as the all-clusters one
const ClusterCard=({cluster})=>{const healthColors=getHealthColor(cluster.healthScore);const hasAlerts=cluster.alerts.length>0;const errorCount=cluster.alerts.filter(a=>a.type==='error').length;return/*#__PURE__*/React.createElement("div",{onClick:()=>onSelectCluster(cluster),className:"group relative bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden cursor-pointer hover:border-proxmox-orange/50 transition-all duration-300 hover:shadow-lg hover:shadow-proxmox-orange/10"},/*#__PURE__*/React.createElement("div",{className:`h-1.5 ${cluster.connected?'bg-gradient-to-r from-green-500 via-emerald-500 to-green-500':'bg-gradient-to-r from-red-500 via-red-600 to-red-500'}`}),/*#__PURE__*/React.createElement("div",{className:"p-5"},/*#__PURE__*/React.createElement("div",{className:"flex items-start justify-between mb-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:`relative w-12 h-12 rounded-xl ${cluster.connected?'bg-gradient-to-br from-green-500/20 to-emerald-500/20':'bg-gradient-to-br from-red-500/20 to-red-600/20'} flex items-center justify-center`},/*#__PURE__*/React.createElement(Icons.Server,{className:`w-6 h-6 ${cluster.connected?'text-green-400':'text-red-400'}`}),cluster.connected&&/*#__PURE__*/React.createElement("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-proxmox-card animate-pulse"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"font-semibold text-white text-base group-hover:text-proxmox-orange transition-colors"},cluster.display_name||cluster.name),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},cluster.host))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},hasAlerts&&/*#__PURE__*/React.createElement("div",{className:`px-2.5 py-1 rounded-lg flex items-center gap-1.5 ${errorCount>0?'bg-red-500/20 border border-red-500/30':'bg-yellow-500/20 border border-yellow-500/30'}`},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:`w-3.5 h-3.5 ${errorCount>0?'text-red-400':'text-yellow-400'}`}),/*#__PURE__*/React.createElement("span",{className:`text-xs font-medium ${errorCount>0?'text-red-400':'text-yellow-400'}`},cluster.alerts.length)),cluster.connected?/*#__PURE__*/React.createElement("div",{className:`px-2.5 py-1 rounded-lg ${healthColors.bg} ${healthColors.border} border`},/*#__PURE__*/React.createElement("span",{className:`text-xs font-semibold ${healthColors.text}`},cluster.healthScore,"%")):/*#__PURE__*/React.createElement("div",{className:"px-2.5 py-1 rounded-lg bg-red-500/20 border border-red-500/30"},/*#__PURE__*/React.createElement("span",{className:"text-xs font-semibold text-red-400"},"Offline")))),cluster.hasMetrics?/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-5 gap-3"},/*#__PURE__*/React.createElement("div",{className:"text-center p-3 rounded-xl bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("div",{className:`text-xl font-bold ${cluster.onlineNodes===cluster.nodeCount?'text-green-400':'text-yellow-400'}`},cluster.onlineNodes,"/",cluster.nodeCount),/*#__PURE__*/React.createElement("div",{className:"text-[10px] text-gray-500 uppercase mt-1"},t('nodes'))),/*#__PURE__*/React.createElement("div",{className:"text-center p-3 rounded-xl bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("div",{className:"flex flex-col items-center gap-1"},/*#__PURE__*/React.createElement(CircularProgress,{value:cluster.avgCpu,size:44,strokeWidth:4,color:cluster.avgCpu>80?'#ef4444':cluster.avgCpu>60?'#eab308':'#22c55e'}),/*#__PURE__*/React.createElement(Sparkline,{data:cluster.cpuHistory,color:cluster.avgCpu>80?'#ef4444':'#22c55e',height:14,width:40})),/*#__PURE__*/React.createElement("div",{className:"text-[10px] text-gray-500 uppercase mt-1"},"CPU")),/*#__PURE__*/React.createElement("div",{className:"text-center p-3 rounded-xl bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("div",{className:"flex flex-col items-center gap-1"},/*#__PURE__*/React.createElement(CircularProgress,{value:cluster.avgMem,size:44,strokeWidth:4,color:cluster.avgMem>80?'#ef4444':cluster.avgMem>60?'#eab308':'#3b82f6'}),/*#__PURE__*/React.createElement(Sparkline,{data:cluster.ramHistory,color:cluster.avgMem>80?'#ef4444':'#3b82f6',height:14,width:40})),/*#__PURE__*/React.createElement("div",{className:"text-[10px] text-gray-500 uppercase mt-1"},"RAM")),/*#__PURE__*/React.createElement("div",{className:"text-center p-3 rounded-xl bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("div",{className:"flex justify-center"},/*#__PURE__*/React.createElement(CircularProgress,{value:cluster.avgStorage,size:44,strokeWidth:4,color:cluster.avgStorage>80?'#ef4444':cluster.avgStorage>60?'#eab308':'#8b5cf6'})),/*#__PURE__*/React.createElement("div",{className:"text-[10px] text-gray-500 uppercase mt-1"},t('storage')||'Disk')),/*#__PURE__*/React.createElement("div",{className:"text-center p-3 rounded-xl bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("div",{className:"text-xl font-bold"},/*#__PURE__*/React.createElement("span",{className:"text-green-400"},cluster.runningVms),/*#__PURE__*/React.createElement("span",{className:"text-gray-500 text-sm"},"/",cluster.totalVms)),/*#__PURE__*/React.createElement("div",{className:"text-[10px] text-gray-500 uppercase mt-1"},t('vms')))):/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center h-20 text-gray-500 text-sm"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4 mr-2"}),t('noDataAvailable')||'No data available'),/*#__PURE__*/React.createElement("div",{className:"mt-4 pt-3 border-t border-proxmox-border/50 flex items-center justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},t('updated')||'Updated',": ",formatLastUpdate(cluster.lastUpdate)),/*#__PURE__*/React.createElement(Icons.ArrowRight,{className:"w-4 h-4 text-gray-500 group-hover:text-proxmox-orange transition-colors"}))));};// LW: Feb 2026 - Corporate variant for GroupOverview
if(isCorporate){const corpBarColor=val=>val>80?'#f54f47':val>60?'#efc006':'#60b515';const groupClusterIds=groupClusters.map(c=>c.id);const groupTopGuests=topGuests.filter(g=>groupClusterIds.includes(g.cluster_id));return/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between pb-2",style:{borderBottom:'1px solid #485764'}},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Folder,{className:"w-4 h-4",style:{color:group.color||'#E86F2D'}}),/*#__PURE__*/React.createElement("h2",{className:"text-[15px] font-semibold",style:{color:'#e9ecef'}},group.name),/*#__PURE__*/React.createElement("span",{className:"text-[12px]",style:{color:'#728b9a'}},groupClusters.length," ",t('clusters'))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},totals.totalAlerts>0&&/*#__PURE__*/React.createElement("span",{className:"text-[12px] flex items-center gap-1",style:{color:'#f54f47'}},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-3.5 h-3.5"})," ",totals.totalAlerts),/*#__PURE__*/React.createElement("button",{onClick:onOpenSettings,className:"p-1",style:{color:'#728b9a'},title:t('settings')},/*#__PURE__*/React.createElement(Icons.Settings,{className:"w-4 h-4"})))),lbEnabled&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3 px-2 py-1.5 text-[12px]",style:{background:'#22343c',border:'1px solid #485764'}},/*#__PURE__*/React.createElement(Icons.Scale,{className:"w-3.5 h-3.5",style:{color:'#60b515'}}),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4'}},t('crossClusterLB')||'Cross-Cluster LB',": ",/*#__PURE__*/React.createElement("span",{style:{color:'#60b515'}},t('enabled')||'Enabled')),group.cross_cluster_dry_run&&/*#__PURE__*/React.createElement("span",{style:{color:'#efc006'}},"(",t('simulationMode')||'Simulation',")"),/*#__PURE__*/React.createElement("span",{style:{color:'#728b9a'}},"Threshold: ",group.cross_cluster_threshold||30,"%")),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-0 flex-wrap text-[13px] px-2 py-2",style:{background:'#22343c',border:'1px solid #485764'}},/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4'}},t('clusters'),": ",/*#__PURE__*/React.createElement("b",{style:{color:'#e9ecef'}},totals.connectedClusters,"/",totals.clusters)),/*#__PURE__*/React.createElement("span",{style:{color:'#485764',margin:'0 8px'}},"|"),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4'}},t('nodes'),": ",/*#__PURE__*/React.createElement("b",{style:{color:'#e9ecef'}},totals.onlineNodes,"/",totals.totalNodes)),/*#__PURE__*/React.createElement("span",{style:{color:'#485764',margin:'0 8px'}},"|"),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4'}},"VMs: ",/*#__PURE__*/React.createElement("b",{style:{color:'#60b515'}},totals.runningVms)," / ",/*#__PURE__*/React.createElement("b",{style:{color:'#728b9a'}},totals.totalVms-totals.runningVms)),/*#__PURE__*/React.createElement("span",{style:{color:'#485764',margin:'0 8px'}},"|"),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4'}},"CPU: ",/*#__PURE__*/React.createElement("b",{style:{color:corpBarColor(totals.avgCpu)}},totals.avgCpu.toFixed(0),"%")),/*#__PURE__*/React.createElement("span",{style:{color:'#485764',margin:'0 8px'}},"|"),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4'}},"RAM: ",/*#__PURE__*/React.createElement("b",{style:{color:corpBarColor(totals.avgMem)}},totals.avgMem.toFixed(0),"%")),/*#__PURE__*/React.createElement("span",{style:{color:'#485764',margin:'0 8px'}},"|"),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4'}},t('storage')||'Storage',": ",/*#__PURE__*/React.createElement("b",{style:{color:corpBarColor(totals.avgStorage)}},totals.avgStorage.toFixed(0),"%"))),/*#__PURE__*/React.createElement("table",{className:"corp-datagrid"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",null,[{field:'name',label:t('name')||'Name'},{field:null,label:t('status')||'Status'},{field:'nodes',label:t('nodes')||'Nodes'},{field:'vms',label:'VMs'},{field:'cpu',label:'CPU'},{field:'ram',label:'RAM'},{field:null,label:t('storage')||'Storage'},{field:'health',label:t('health')||'Health'}].map((col,i)=>/*#__PURE__*/React.createElement("th",{key:i,className:col.field?'cursor-pointer hover:text-white':'',onClick:col.field?()=>{setSortBy(col.field);setSortDir(sortBy===col.field&&sortDir==='asc'?'desc':'asc');}:undefined,style:{textAlign:'left'}},col.label," ",sortBy===col.field&&/*#__PURE__*/React.createElement("span",{className:"sort-indicator"},sortDir==='asc'?'â–²':'â–¼'))))),/*#__PURE__*/React.createElement("tbody",null,sortedStats.map(cluster=>{const hc=getHealthColor(cluster.healthScore);return/*#__PURE__*/React.createElement("tr",{key:cluster.id,className:"table-row-hover cursor-pointer",onClick:()=>onSelectCluster(cluster)},/*#__PURE__*/React.createElement("td",{style:{fontWeight:500}},cluster.display_name||cluster.name),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("span",{className:"inline-flex items-center gap-1.5"},/*#__PURE__*/React.createElement("span",{className:"w-1.5 h-1.5 rounded-full inline-block",style:{background:cluster.connected?'#60b515':'#f54f47'}}),/*#__PURE__*/React.createElement("span",{style:{color:cluster.connected?'#60b515':'#f54f47',fontSize:'12px'}},cluster.connected?'online':'offline'))),/*#__PURE__*/React.createElement("td",null,cluster.onlineNodes,"/",cluster.nodeCount),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("span",{style:{color:'#60b515'}},cluster.runningVms)," / ",/*#__PURE__*/React.createElement("span",{style:{color:'#728b9a'}},cluster.totalVms-cluster.runningVms)),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1.5"},/*#__PURE__*/React.createElement("span",{style:{color:corpBarColor(cluster.avgCpu),minWidth:'28px'}},cluster.avgCpu.toFixed(0),"%"),/*#__PURE__*/React.createElement("span",{className:"inline-block",style:{width:'40px',height:'2px',background:'#37474f',position:'relative'}},/*#__PURE__*/React.createElement("span",{style:{position:'absolute',left:0,top:0,height:'2px',width:`${Math.min(cluster.avgCpu,100)}%`,background:corpBarColor(cluster.avgCpu)}})))),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1.5"},/*#__PURE__*/React.createElement("span",{style:{color:corpBarColor(cluster.avgMem),minWidth:'28px'}},cluster.avgMem.toFixed(0),"%"),/*#__PURE__*/React.createElement("span",{className:"inline-block",style:{width:'40px',height:'2px',background:'#37474f',position:'relative'}},/*#__PURE__*/React.createElement("span",{style:{position:'absolute',left:0,top:0,height:'2px',width:`${Math.min(cluster.avgMem,100)}%`,background:corpBarColor(cluster.avgMem)}})))),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1.5"},/*#__PURE__*/React.createElement("span",{style:{color:corpBarColor(cluster.avgStorage),minWidth:'28px'}},cluster.avgStorage.toFixed(0),"%"),/*#__PURE__*/React.createElement("span",{className:"inline-block",style:{width:'40px',height:'2px',background:'#37474f',position:'relative'}},/*#__PURE__*/React.createElement("span",{style:{position:'absolute',left:0,top:0,height:'2px',width:`${Math.min(cluster.avgStorage,100)}%`,background:corpBarColor(cluster.avgStorage)}})))),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("span",{style:{color:hc.color,fontWeight:500}},cluster.healthScore,"%")));}))),groupTopGuests.length>0&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 py-1.5",style:{borderBottom:'1px solid #485764'}},/*#__PURE__*/React.createElement(Icons.Activity,{className:"w-3.5 h-3.5",style:{color:'#49afd9'}}),/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-semibold",style:{color:'#adbbc4'}},t('topResources')||'Top Resources')),/*#__PURE__*/React.createElement("table",{className:"corp-datagrid"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{style:{width:'24px'}}),/*#__PURE__*/React.createElement("th",null,t('name')),/*#__PURE__*/React.createElement("th",null,t('cluster')),/*#__PURE__*/React.createElement("th",null,t('node')),/*#__PURE__*/React.createElement("th",null,"CPU"),/*#__PURE__*/React.createElement("th",null,"RAM"),/*#__PURE__*/React.createElement("th",null,t('status')))),/*#__PURE__*/React.createElement("tbody",null,groupTopGuests.slice(0,10).map(guest=>{const cpuP=((guest.cpu||0)*100).toFixed(1);const memP=guest.maxmem>0?(guest.mem/guest.maxmem*100).toFixed(1):0;const gc=clusters.find(c=>c.id===guest.cluster_id);return/*#__PURE__*/React.createElement("tr",{key:`${guest.cluster_id}-${guest.vmid}`,className:"table-row-hover cursor-pointer",onClick:()=>{if(gc&&onSelectVm)onSelectVm(gc,guest.vmid,guest.node);}},/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement(Icons.Monitor,{className:"w-3.5 h-3.5",style:{color:guest.type==='qemu'?'#49afd9':'#a178d9'}})),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("span",{style:{fontWeight:500}},guest.name||`VM ${guest.vmid}`)," ",/*#__PURE__*/React.createElement("span",{style:{color:'#728b9a',fontSize:'11px'}},"#",guest.vmid)),/*#__PURE__*/React.createElement("td",null,guest.cluster_name),/*#__PURE__*/React.createElement("td",{style:{color:'#adbbc4'}},guest.node),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("span",{style:{color:corpBarColor(cpuP)}},cpuP,"%")),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("span",{style:{color:corpBarColor(memP)}},memP,"%")),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("span",{className:"inline-flex items-center gap-1"},/*#__PURE__*/React.createElement("span",{className:"w-1.5 h-1.5 rounded-full inline-block",style:{background:guest.status==='running'?'#60b515':'#728b9a'}}),/*#__PURE__*/React.createElement("span",{style:{color:guest.status==='running'?'#60b515':'#728b9a',fontSize:'12px'}},guest.status==='running'?t('running'):t('stopped')))));})))),lbEnabled&&lbHistory.length>0&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 py-1.5",style:{borderBottom:'1px solid #485764'}},/*#__PURE__*/React.createElement(Icons.Activity,{className:"w-3.5 h-3.5",style:{color:'#a178d9'}}),/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-semibold",style:{color:'#adbbc4'}},t('lbHistory')||'LB History')),/*#__PURE__*/React.createElement("table",{className:"corp-datagrid"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",null,t('time')),/*#__PURE__*/React.createElement("th",null,t('action')),/*#__PURE__*/React.createElement("th",null,t('details')))),/*#__PURE__*/React.createElement("tbody",null,lbHistory.slice(0,10).map((entry,i)=>/*#__PURE__*/React.createElement("tr",{key:i,className:"table-row-hover"},/*#__PURE__*/React.createElement("td",{style:{color:'#728b9a'}},new Date(entry.timestamp).toLocaleString()),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("span",{style:{color:entry.action==='migrate'?'#49afd9':'#a178d9'}},entry.action)),/*#__PURE__*/React.createElement("td",{style:{color:'#adbbc4'}},entry.details||'-')))))),groupClusters.length===0&&/*#__PURE__*/React.createElement("div",{className:"py-8 text-center text-[13px]",style:{color:'#728b9a'}},t('noClustersInGroup')||'No clusters in this group'));}// Modern layout (original)
return/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"relative overflow-hidden bg-gradient-to-r from-proxmox-card via-proxmox-dark to-proxmox-card border border-proxmox-border rounded-2xl p-6"},/*#__PURE__*/React.createElement("div",{className:"absolute inset-0 bg-gradient-to-r from-proxmox-orange/5 via-transparent to-blue-500/5"}),/*#__PURE__*/React.createElement("div",{className:"relative flex items-center justify-between flex-wrap gap-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center shadow-lg",style:{backgroundColor:(group.color||'#E86F2D')+'33'}},/*#__PURE__*/React.createElement(Icons.Folder,{className:"w-7 h-7",style:{color:group.color||'#E86F2D'}})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h1",{className:"text-2xl font-bold text-white"},group.name),group.description&&/*#__PURE__*/React.createElement("p",{className:"text-gray-400 text-sm"},group.description),/*#__PURE__*/React.createElement("p",{className:"text-gray-500 text-xs mt-0.5"},groupClusters.length," ",t('clusters')))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},totals.totalAlerts>0&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-red-500/10 border border-red-500/30 rounded-lg"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4 text-red-400"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-red-400 font-medium"},totals.totalAlerts," ",t('alerts')||'Alerts')),/*#__PURE__*/React.createElement("button",{onClick:onOpenSettings,className:"p-2 rounded-lg text-gray-400 hover:text-white hover:bg-proxmox-dark transition-colors",title:t('settings')||'Settings'},/*#__PURE__*/React.createElement(Icons.Settings,{className:"w-5 h-5"})),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-green-500/10 border border-green-500/30 rounded-full"},/*#__PURE__*/React.createElement("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),/*#__PURE__*/React.createElement("span",{className:"text-xs text-green-400 font-medium"},"Live"))))),lbEnabled&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Scale,{className:"w-5 h-5 text-green-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold flex items-center gap-2"},t('crossClusterLB')||'Cross-Cluster Load Balancing',/*#__PURE__*/React.createElement("span",{className:"bg-green-500/10 text-green-400 px-2 py-0.5 rounded-full text-xs"},t('enabled')||'Enabled'),group.cross_cluster_dry_run&&/*#__PURE__*/React.createElement("span",{className:"bg-yellow-500/10 text-yellow-400 px-2 py-0.5 rounded-full text-xs"},t('simulationMode')||'Simulation Mode')),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4 text-xs text-gray-500 mt-1"},/*#__PURE__*/React.createElement("span",null,t('threshold')||'Threshold',": ",group.cross_cluster_threshold||30,"%"),/*#__PURE__*/React.createElement("span",null,t('interval')||'Interval',": ",group.cross_cluster_interval||600,"s"),groupStatus?.cross_cluster_lb?.last_run&&/*#__PURE__*/React.createElement("span",null,t('lastRun')||'Last run',": ",formatLastUpdate(groupStatus.cross_cluster_lb.last_run))))))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4"},[{icon:Icons.Server,value:`${totals.connectedClusters}/${totals.clusters}`,label:t('clusters'),color:'proxmox-orange',hoverColor:'proxmox-orange'},{icon:Icons.Cpu,value:`${totals.onlineNodes}/${totals.totalNodes}`,label:t('nodesOnline')||'Nodes',color:'blue-400',hoverColor:'blue-500'},{icon:Icons.Play,value:totals.runningVms,label:t('vmsRunning')||'Running',color:'green-400',hoverColor:'green-500',valueColor:'text-green-400'},{icon:Icons.Square,value:totals.totalVms-totals.runningVms,label:t('vmsStopped')||'Stopped',color:'gray-400',hoverColor:'gray-500'}].map((stat,i)=>/*#__PURE__*/React.createElement("div",{key:i,className:`bg-gradient-to-br from-proxmox-card to-proxmox-dark border border-proxmox-border rounded-xl p-4 hover:border-${stat.hoverColor}/30 transition-all group`},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:`w-10 h-10 rounded-lg bg-${stat.color}/20 flex items-center justify-center group-hover:scale-110 transition-transform`},/*#__PURE__*/React.createElement(stat.icon,{className:`w-5 h-5 text-${stat.color}`})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:`text-xl font-bold ${stat.valueColor||'text-white'}`},stat.value),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},stat.label))))),[{value:totals.avgCpu,label:'CPU',color:totals.avgCpu>80?'#ef4444':totals.avgCpu>60?'#eab308':'#22c55e'},{value:totals.avgMem,label:'RAM',color:totals.avgMem>80?'#ef4444':totals.avgMem>60?'#eab308':'#3b82f6'},{value:totals.avgStorage,label:t('storage')||'Disk',color:totals.avgStorage>80?'#ef4444':totals.avgStorage>60?'#eab308':'#8b5cf6'}].map((stat,i)=>/*#__PURE__*/React.createElement("div",{key:i,className:"bg-gradient-to-br from-proxmox-card to-proxmox-dark border border-proxmox-border rounded-xl p-4 hover:border-proxmox-border transition-all"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement(CircularProgress,{value:stat.value||0,size:44,strokeWidth:4,color:stat.color}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-sm font-bold text-white"},stat.label),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},t('average')||'Avg')))))),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 flex-wrap"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-500 mr-1"},t('sortBy')||'Sort by',":"),/*#__PURE__*/React.createElement(SortButton,{field:"name",label:t('name')||'Name'}),/*#__PURE__*/React.createElement(SortButton,{field:"health",label:t('health')||'Health'}),/*#__PURE__*/React.createElement(SortButton,{field:"nodes",label:t('nodes')||'Nodes'}),/*#__PURE__*/React.createElement(SortButton,{field:"vms",label:"VMs"}),/*#__PURE__*/React.createElement(SortButton,{field:"cpu",label:"CPU"}),/*#__PURE__*/React.createElement(SortButton,{field:"ram",label:"RAM"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4"},sortedStats.map(cluster=>/*#__PURE__*/React.createElement(ClusterCard,{key:cluster.id,cluster:cluster}))),(()=>{const groupClusterIds2=groupClusters.map(c=>c.id);const groupTopGuests2=topGuests.filter(g=>groupClusterIds2.includes(g.cluster_id));if(groupTopGuests2.length===0)return null;return/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"w-10 h-10 rounded-lg bg-cyan-500/20 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Activity,{className:"w-5 h-5 text-cyan-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"font-semibold text-white"},t('topResources')||'Top Resources'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},t('highestCpuUsage')||'Highest CPU and RAM usage across all clusters'))),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 bg-proxmox-dark px-2 py-1 rounded"},"Top 10")),/*#__PURE__*/React.createElement("div",{className:"overflow-x-auto"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("tr",{className:"text-left text-xs text-gray-400"},/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 font-medium"},t('type')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 font-medium"},t('name')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 font-medium"},t('cluster')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 font-medium"},t('node')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 font-medium"},"CPU"),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 font-medium"},"RAM"),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 font-medium"},t('status')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 w-10"}))),/*#__PURE__*/React.createElement("tbody",{className:"divide-y divide-proxmox-border/50"},groupTopGuests2.slice(0,10).map((guest,idx)=>{const cpuPercent=((guest.cpu||0)*100).toFixed(1);const memPercent=guest.maxmem>0?(guest.mem/guest.maxmem*100).toFixed(1):0;const isVM=guest.type==='qemu';const guestCluster=clusters.find(c=>c.id===guest.cluster_id);return/*#__PURE__*/React.createElement("tr",{key:`${guest.cluster_id}-${guest.vmid}`,className:"hover:bg-proxmox-hover/50 transition-colors cursor-pointer group",onClick:()=>{if(guestCluster&&onSelectVm)onSelectVm(guestCluster,guest.vmid,guest.node);},title:t('clickToOpenVm')||'Click to open VM'},/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${isVM?'bg-blue-500/20':'bg-purple-500/20'}`},isVM?/*#__PURE__*/React.createElement(Icons.Monitor,{className:"w-4 h-4 text-blue-400"}):/*#__PURE__*/React.createElement(Icons.Layers,{className:"w-4 h-4 text-purple-400"}))),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("div",{className:"font-medium text-white group-hover:text-proxmox-orange transition-colors"},guest.name||`VM ${guest.vmid}`),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"ID: ",guest.vmid)),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},guest.cluster_name)),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-400"},guest.node)),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("div",{className:"w-16 h-2 bg-proxmox-dark rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:`h-full rounded-full ${cpuPercent>80?'bg-red-500':cpuPercent>60?'bg-yellow-500':'bg-green-500'}`,style:{width:`${Math.min(cpuPercent,100)}%`}})),/*#__PURE__*/React.createElement("span",{className:`text-xs font-medium ${cpuPercent>80?'text-red-400':cpuPercent>60?'text-yellow-400':'text-green-400'}`},cpuPercent,"%"))),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("div",{className:"w-16 h-2 bg-proxmox-dark rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:`h-full rounded-full ${memPercent>80?'bg-red-500':memPercent>60?'bg-yellow-500':'bg-blue-500'}`,style:{width:`${Math.min(memPercent,100)}%`}})),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-400"},memPercent,"%"))),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("span",{className:`inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium ${guest.status==='running'?'bg-green-500/20 text-green-400':'bg-gray-500/20 text-gray-400'}`},/*#__PURE__*/React.createElement("div",{className:`w-1.5 h-1.5 rounded-full ${guest.status==='running'?'bg-green-400':'bg-gray-400'}`}),guest.status==='running'?t('running'):t('stopped'))),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement(Icons.ArrowRight,{className:"w-4 h-4 text-gray-500 group-hover:text-proxmox-orange transition-colors"})));})))));})(),lbEnabled&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Activity,{className:"w-5 h-5 text-purple-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"font-semibold text-white"},t('lbHistory')||'Load Balancing History'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},t('recentLbActions')||'Recent cross-cluster LB actions'))),lbHistory.length>0?/*#__PURE__*/React.createElement("div",{className:"overflow-x-auto"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("tr",{className:"text-left text-xs text-gray-400"},/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 font-medium"},t('time')||'Time'),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 font-medium"},t('action')||'Action'),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 font-medium"},t('details')||'Details'))),/*#__PURE__*/React.createElement("tbody",{className:"divide-y divide-proxmox-border/50"},lbHistory.slice(0,20).map((entry,idx)=>/*#__PURE__*/React.createElement("tr",{key:idx,className:"hover:bg-proxmox-hover/50 transition-colors"},/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-sm text-gray-400"},new Date(entry.timestamp).toLocaleString()),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("span",{className:`inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium ${entry.action==='migrate'?'bg-blue-500/20 text-blue-400':entry.action==='rebalance'?'bg-purple-500/20 text-purple-400':'bg-gray-500/20 text-gray-400'}`},entry.action)),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-sm text-gray-300"},entry.details||'-')))))):/*#__PURE__*/React.createElement("div",{className:"p-8 text-center text-gray-500 text-sm"},/*#__PURE__*/React.createElement(Icons.Clock,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),t('noLbEvents')||'No cross-cluster LB events yet')),groupClusters.length===0&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-12 text-center"},/*#__PURE__*/React.createElement("div",{className:"w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-proxmox-orange/20 to-orange-600/20 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Server,{className:"w-8 h-8 text-proxmox-orange"})),/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-2"},t('noClustersInGroup')||'No clusters in this group'),/*#__PURE__*/React.createElement("p",{className:"text-gray-500 text-sm"},t('addClustersToGroup')||'Assign clusters to this group to see them here')));}// LW: All Clusters Overview - GitHub Feature Request #16
// added a bunch of stuff here - storage, sparklines, sorting etc
function AllClustersOverview({clusters,allMetrics,clusterGroups=[],topGuests=[],onSelectCluster,onSelectVm}){const{t}=useTranslation();const{isCorporate}=useLayout();const[sortBy,setSortBy]=useState('name');const[sortDir,setSortDir]=useState('asc');const[cpuHistory,setCpuHistory]=useState({});const[ramHistory,setRamHistory]=useState({});// sparkline history
useEffect(()=>{clusters.forEach(cluster=>{const status=allMetrics[cluster.id]?.data||{};const cpu=status.resources?.cpu?.percent||0;const ram=status.resources?.memory?.percent||0;setCpuHistory(prev=>({...prev,[cluster.id]:[...(prev[cluster.id]||[]).slice(-9),cpu]}));setRamHistory(prev=>({...prev,[cluster.id]:[...(prev[cluster.id]||[]).slice(-9),ram]}));});},[allMetrics]);// stats per cluster
const clusterStats=clusters.map(cluster=>{const status=allMetrics[cluster.id]?.data||{};const lastUpdate=allMetrics[cluster.id]?.lastUpdate;const nodes=status.nodes||{};const guests=status.guests||{};const resources=status.resources||{};const nodeCount=nodes.total||0;const onlineNodes=nodes.online||0;const offlineNodes=nodes.offline||0;const avgCpu=resources.cpu?.percent||0;const avgMem=resources.memory?.percent||0;const avgStorage=resources.storage?.percent||0;const vmsRunning=(guests.vms?.running||0)+(guests.containers?.running||0);const vmsStopped=(guests.vms?.stopped||0)+(guests.containers?.stopped||0);const totalVms=vmsRunning+vmsStopped;// health score calculation - cpu/ram/storage weighted
const healthScore=cluster.connected?Math.max(0,100-(avgCpu*0.3+avgMem*0.3+avgStorage*0.2+(nodeCount>0?offlineNodes/nodeCount*100*0.2:0))):0;// Count alerts/warnings
const alerts=[];if(!cluster.connected)alerts.push({type:'error',msg:'Offline'});if(offlineNodes>0)alerts.push({type:'warning',msg:`${offlineNodes} node(s) offline`});if(avgCpu>90)alerts.push({type:'error',msg:'CPU critical'});else if(avgCpu>80)alerts.push({type:'warning',msg:'CPU high'});if(avgMem>90)alerts.push({type:'error',msg:'RAM critical'});else if(avgMem>80)alerts.push({type:'warning',msg:'RAM high'});if(avgStorage>90)alerts.push({type:'error',msg:'Storage critical'});else if(avgStorage>80)alerts.push({type:'warning',msg:'Storage high'});return{...cluster,nodeCount,onlineNodes,offlineNodes,avgCpu,avgMem,avgStorage,totalVms,runningVms:vmsRunning,healthScore:Math.round(healthScore),hasMetrics:nodeCount>0||cluster.connected,lastUpdate,alerts,cpuHistory:cpuHistory[cluster.id]||[],ramHistory:ramHistory[cluster.id]||[]};});// sorting
const sortedStats=[...clusterStats].sort((a,b)=>{let aVal,bVal;switch(sortBy){case'health':aVal=a.healthScore;bVal=b.healthScore;break;case'nodes':aVal=a.nodeCount;bVal=b.nodeCount;break;case'vms':aVal=a.totalVms;bVal=b.totalVms;break;case'cpu':aVal=a.avgCpu;bVal=b.avgCpu;break;case'ram':aVal=a.avgMem;bVal=b.avgMem;break;default:aVal=(a.display_name||a.name).toLowerCase();bVal=(b.display_name||b.name).toLowerCase();}if(typeof aVal==='string')return sortDir==='asc'?aVal.localeCompare(bVal):bVal.localeCompare(aVal);return sortDir==='asc'?aVal-bVal:bVal-aVal;});// group by cluster group
const groupedClusters={};const ungroupedClusters=[];sortedStats.forEach(cluster=>{const group=clusterGroups.find(g=>g.id===cluster.group_id);if(group){if(!groupedClusters[group.id])groupedClusters[group.id]={group,clusters:[]};groupedClusters[group.id].clusters.push(cluster);}else{ungroupedClusters.push(cluster);}});// totals for the header cards
const totals={clusters:clusters.length,connectedClusters:clusters.filter(c=>c.connected).length,totalNodes:clusterStats.reduce((acc,c)=>acc+c.nodeCount,0),onlineNodes:clusterStats.reduce((acc,c)=>acc+c.onlineNodes,0),totalVms:clusterStats.reduce((acc,c)=>acc+c.totalVms,0),runningVms:clusterStats.reduce((acc,c)=>acc+c.runningVms,0),avgCpu:clusterStats.filter(c=>c.hasMetrics).length>0?clusterStats.reduce((acc,c)=>acc+c.avgCpu,0)/clusterStats.filter(c=>c.hasMetrics).length:0,avgMem:clusterStats.filter(c=>c.hasMetrics).length>0?clusterStats.reduce((acc,c)=>acc+c.avgMem,0)/clusterStats.filter(c=>c.hasMetrics).length:0,avgStorage:clusterStats.filter(c=>c.hasMetrics).length>0?clusterStats.reduce((acc,c)=>acc+c.avgStorage,0)/clusterStats.filter(c=>c.hasMetrics).length:0,totalAlerts:clusterStats.reduce((acc,c)=>acc+c.alerts.length,0)};// NS: sparkline svg - kept it simple
const Sparkline=({data,color,height=20,width=60})=>{if(!data||data.length<2)return/*#__PURE__*/React.createElement("div",{style:{width,height},className:"bg-proxmox-dark/50 rounded"});const max=Math.max(...data,1);const min=Math.min(...data,0);const range=max-min||1;const points=data.map((v,i)=>`${i/(data.length-1)*width},${height-(v-min)/range*height}`).join(' ');return/*#__PURE__*/React.createElement("svg",{width:width,height:height,className:"overflow-visible"},/*#__PURE__*/React.createElement("polyline",{fill:"none",stroke:color,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",points:points}),/*#__PURE__*/React.createElement("circle",{cx:width,cy:height-(data[data.length-1]-min)/range*height,r:"2",fill:color}));};// circular progress - reusable
const CircularProgress=({value,size=60,strokeWidth=6,color})=>{const radius=(size-strokeWidth)/2;const circumference=radius*2*Math.PI;const offset=circumference-value/100*circumference;return/*#__PURE__*/React.createElement("div",{className:"relative flex-shrink-0",style:{width:size,height:size}},/*#__PURE__*/React.createElement("svg",{className:"transform -rotate-90 overflow-visible",width:size,height:size},/*#__PURE__*/React.createElement("circle",{cx:size/2,cy:size/2,r:radius,fill:"none",stroke:"currentColor",strokeWidth:strokeWidth,className:"text-gray-700"}),/*#__PURE__*/React.createElement("circle",{cx:size/2,cy:size/2,r:radius,fill:"none",stroke:color,strokeWidth:strokeWidth,strokeLinecap:"round",strokeDasharray:circumference,strokeDashoffset:offset,className:"transition-all duration-500"})),/*#__PURE__*/React.createElement("div",{className:"absolute inset-0 flex items-center justify-center"},/*#__PURE__*/React.createElement("span",{className:"text-xs font-bold text-white"},value.toFixed(0),"%")));};const getHealthColor=score=>{if(score>=80)return{bg:'bg-green-500/20',text:'text-green-400',border:'border-green-500/30',color:'#22c55e'};if(score>=60)return{bg:'bg-yellow-500/20',text:'text-yellow-400',border:'border-yellow-500/30',color:'#eab308'};if(score>=40)return{bg:'bg-orange-500/20',text:'text-orange-400',border:'border-orange-500/30',color:'#f97316'};return{bg:'bg-red-500/20',text:'text-red-400',border:'border-red-500/30',color:'#ef4444'};};const formatLastUpdate=date=>{if(!date)return'-';const now=new Date();const diff=Math.floor((now-new Date(date))/1000);if(diff<10)return t('justNow')||'just now';if(diff<60)return`${diff}s ago`;if(diff<3600)return`${Math.floor(diff/60)}m ago`;return new Date(date).toLocaleTimeString();};const SortButton=({field,label})=>/*#__PURE__*/React.createElement("button",{onClick:()=>{setSortBy(field);setSortDir(sortBy===field&&sortDir==='asc'?'desc':'asc');},className:`px-3 py-1.5 text-sm rounded-lg transition-colors ${sortBy===field?'bg-proxmox-orange/20 text-proxmox-orange font-medium':'text-gray-400 hover:text-white hover:bg-proxmox-dark'}`},label," ",sortBy===field&&(sortDir==='asc'?'â†‘':'â†“'));// cluster card component
const ClusterCard=({cluster})=>{const healthColors=getHealthColor(cluster.healthScore);const hasAlerts=cluster.alerts.length>0;const errorCount=cluster.alerts.filter(a=>a.type==='error').length;return/*#__PURE__*/React.createElement("div",{onClick:()=>onSelectCluster(cluster),className:"group relative bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden cursor-pointer hover:border-proxmox-orange/50 transition-all duration-300 hover:shadow-lg hover:shadow-proxmox-orange/10"},/*#__PURE__*/React.createElement("div",{className:`h-1.5 ${cluster.connected?'bg-gradient-to-r from-green-500 via-emerald-500 to-green-500':'bg-gradient-to-r from-red-500 via-red-600 to-red-500'}`}),/*#__PURE__*/React.createElement("div",{className:"p-5"},/*#__PURE__*/React.createElement("div",{className:"flex items-start justify-between mb-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:`relative w-12 h-12 rounded-xl ${cluster.connected?'bg-gradient-to-br from-green-500/20 to-emerald-500/20':'bg-gradient-to-br from-red-500/20 to-red-600/20'} flex items-center justify-center`},/*#__PURE__*/React.createElement(Icons.Server,{className:`w-6 h-6 ${cluster.connected?'text-green-400':'text-red-400'}`}),cluster.connected&&/*#__PURE__*/React.createElement("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-proxmox-card animate-pulse"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"font-semibold text-white text-base group-hover:text-proxmox-orange transition-colors"},cluster.display_name||cluster.name),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},cluster.host))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},hasAlerts&&/*#__PURE__*/React.createElement("div",{className:"relative group/alerts"},/*#__PURE__*/React.createElement("div",{className:`px-2.5 py-1 rounded-lg flex items-center gap-1.5 ${errorCount>0?'bg-red-500/20 border border-red-500/30':'bg-yellow-500/20 border border-yellow-500/30'}`},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:`w-3.5 h-3.5 ${errorCount>0?'text-red-400':'text-yellow-400'}`}),/*#__PURE__*/React.createElement("span",{className:`text-xs font-medium ${errorCount>0?'text-red-400':'text-yellow-400'}`},cluster.alerts.length)),/*#__PURE__*/React.createElement("div",{className:"absolute right-0 top-full mt-1 z-50 hidden group-hover/alerts:block"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-lg p-2 shadow-xl min-w-[160px]"},cluster.alerts.map((alert,i)=>/*#__PURE__*/React.createElement("div",{key:i,className:`text-xs py-0.5 ${alert.type==='error'?'text-red-400':'text-yellow-400'}`},"\u2022 ",alert.msg))))),cluster.connected&&/*#__PURE__*/React.createElement("div",{className:`px-2.5 py-1 rounded-lg ${healthColors.bg} ${healthColors.border} border`},/*#__PURE__*/React.createElement("span",{className:`text-xs font-semibold ${healthColors.text}`},cluster.healthScore,"%")),!cluster.connected&&/*#__PURE__*/React.createElement("div",{className:"px-2.5 py-1 rounded-lg bg-red-500/20 border border-red-500/30"},/*#__PURE__*/React.createElement("span",{className:"text-xs font-semibold text-red-400"},"Offline")))),cluster.hasMetrics?/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-5 gap-3"},/*#__PURE__*/React.createElement("div",{className:"text-center p-3 rounded-xl bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("div",{className:`text-xl font-bold ${cluster.onlineNodes===cluster.nodeCount?'text-green-400':'text-yellow-400'}`},cluster.onlineNodes,"/",cluster.nodeCount),/*#__PURE__*/React.createElement("div",{className:"text-[10px] text-gray-500 uppercase mt-1"},t('nodes'))),/*#__PURE__*/React.createElement("div",{className:"text-center p-3 rounded-xl bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("div",{className:"flex flex-col items-center gap-1"},/*#__PURE__*/React.createElement(CircularProgress,{value:cluster.avgCpu,size:44,strokeWidth:4,color:cluster.avgCpu>80?'#ef4444':cluster.avgCpu>60?'#eab308':'#22c55e'}),/*#__PURE__*/React.createElement(Sparkline,{data:cluster.cpuHistory,color:cluster.avgCpu>80?'#ef4444':'#22c55e',height:14,width:40})),/*#__PURE__*/React.createElement("div",{className:"text-[10px] text-gray-500 uppercase mt-1"},"CPU")),/*#__PURE__*/React.createElement("div",{className:"text-center p-3 rounded-xl bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("div",{className:"flex flex-col items-center gap-1"},/*#__PURE__*/React.createElement(CircularProgress,{value:cluster.avgMem,size:44,strokeWidth:4,color:cluster.avgMem>80?'#ef4444':cluster.avgMem>60?'#eab308':'#3b82f6'}),/*#__PURE__*/React.createElement(Sparkline,{data:cluster.ramHistory,color:cluster.avgMem>80?'#ef4444':'#3b82f6',height:14,width:40})),/*#__PURE__*/React.createElement("div",{className:"text-[10px] text-gray-500 uppercase mt-1"},"RAM")),/*#__PURE__*/React.createElement("div",{className:"text-center p-3 rounded-xl bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("div",{className:"flex justify-center"},/*#__PURE__*/React.createElement(CircularProgress,{value:cluster.avgStorage,size:44,strokeWidth:4,color:cluster.avgStorage>80?'#ef4444':cluster.avgStorage>60?'#eab308':'#8b5cf6'})),/*#__PURE__*/React.createElement("div",{className:"text-[10px] text-gray-500 uppercase mt-1"},t('storage')||'Disk')),/*#__PURE__*/React.createElement("div",{className:"text-center p-3 rounded-xl bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("div",{className:"text-xl font-bold"},/*#__PURE__*/React.createElement("span",{className:"text-green-400"},cluster.runningVms),/*#__PURE__*/React.createElement("span",{className:"text-gray-500 text-sm"},"/",cluster.totalVms)),/*#__PURE__*/React.createElement("div",{className:"text-[10px] text-gray-500 uppercase mt-1"},t('vms')))):/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center h-20 text-gray-500 text-sm"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4 mr-2"}),t('noDataAvailable')||'No data available'),/*#__PURE__*/React.createElement("div",{className:"mt-4 pt-3 border-t border-proxmox-border/50 flex items-center justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},t('updated')||'Updated',": ",formatLastUpdate(cluster.lastUpdate)),/*#__PURE__*/React.createElement(Icons.ArrowRight,{className:"w-4 h-4 text-gray-500 group-hover:text-proxmox-orange transition-colors"}))));};// LW: Feb 2026 - Corporate variant for AllClustersOverview
if(isCorporate){const corpBarColor=val=>val>80?'#f54f47':val>60?'#efc006':'#60b515';return/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between pb-2",style:{borderBottom:'1px solid #485764'}},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Grid,{className:"w-4 h-4",style:{color:'#49afd9'}}),/*#__PURE__*/React.createElement("h2",{className:"text-[15px] font-semibold",style:{color:'#e9ecef'}},t('allClustersOverview')||'All Clusters Overview')),totals.totalAlerts>0&&/*#__PURE__*/React.createElement("span",{className:"text-[12px] flex items-center gap-1",style:{color:'#f54f47'}},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-3.5 h-3.5"})," ",totals.totalAlerts," ",t('alerts')||'alerts')),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-0 flex-wrap text-[13px] px-2 py-2",style:{background:'#22343c',border:'1px solid #485764'}},/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4'}},t('clusters'),": ",/*#__PURE__*/React.createElement("b",{style:{color:'#e9ecef'}},totals.connectedClusters,"/",totals.clusters)," online"),/*#__PURE__*/React.createElement("span",{style:{color:'#485764',margin:'0 8px'}},"|"),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4'}},t('nodes'),": ",/*#__PURE__*/React.createElement("b",{style:{color:'#e9ecef'}},totals.onlineNodes,"/",totals.totalNodes)),/*#__PURE__*/React.createElement("span",{style:{color:'#485764',margin:'0 8px'}},"|"),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4'}},"VMs: ",/*#__PURE__*/React.createElement("b",{style:{color:'#60b515'}},totals.runningVms)," ",t('running')?.toLowerCase(),", ",/*#__PURE__*/React.createElement("b",{style:{color:'#728b9a'}},totals.totalVms-totals.runningVms)," ",t('stopped')?.toLowerCase()),/*#__PURE__*/React.createElement("span",{style:{color:'#485764',margin:'0 8px'}},"|"),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4'}},"CPU: ",/*#__PURE__*/React.createElement("b",{style:{color:corpBarColor(totals.avgCpu)}},totals.avgCpu.toFixed(0),"%")),/*#__PURE__*/React.createElement("span",{className:"inline-block mx-1",style:{width:'40px',height:'2px',background:'#37474f',position:'relative',verticalAlign:'middle'}},/*#__PURE__*/React.createElement("span",{style:{position:'absolute',left:0,top:0,height:'2px',width:`${Math.min(totals.avgCpu,100)}%`,background:corpBarColor(totals.avgCpu)}})),/*#__PURE__*/React.createElement("span",{style:{color:'#485764',margin:'0 8px'}},"|"),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4'}},"RAM: ",/*#__PURE__*/React.createElement("b",{style:{color:corpBarColor(totals.avgMem)}},totals.avgMem.toFixed(0),"%")),/*#__PURE__*/React.createElement("span",{className:"inline-block mx-1",style:{width:'40px',height:'2px',background:'#37474f',position:'relative',verticalAlign:'middle'}},/*#__PURE__*/React.createElement("span",{style:{position:'absolute',left:0,top:0,height:'2px',width:`${Math.min(totals.avgMem,100)}%`,background:corpBarColor(totals.avgMem)}})),/*#__PURE__*/React.createElement("span",{style:{color:'#485764',margin:'0 8px'}},"|"),/*#__PURE__*/React.createElement("span",{style:{color:'#adbbc4'}},t('storage')||'Storage',": ",/*#__PURE__*/React.createElement("b",{style:{color:corpBarColor(totals.avgStorage)}},totals.avgStorage.toFixed(0),"%")),/*#__PURE__*/React.createElement("span",{className:"inline-block mx-1",style:{width:'40px',height:'2px',background:'#37474f',position:'relative',verticalAlign:'middle'}},/*#__PURE__*/React.createElement("span",{style:{position:'absolute',left:0,top:0,height:'2px',width:`${Math.min(totals.avgStorage,100)}%`,background:corpBarColor(totals.avgStorage)}}))),/*#__PURE__*/React.createElement("table",{className:"corp-datagrid"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",null,[{field:'name',label:t('name')||'Name'},{field:null,label:t('status')||'Status'},{field:'nodes',label:t('nodes')||'Nodes'},{field:'vms',label:'VMs'},{field:'cpu',label:'CPU'},{field:'ram',label:'RAM'},{field:null,label:t('storage')||'Storage'},{field:'health',label:t('health')||'Health'}].map((col,i)=>/*#__PURE__*/React.createElement("th",{key:i,className:col.field?'cursor-pointer hover:text-white':'',onClick:col.field?()=>{setSortBy(col.field);setSortDir(sortBy===col.field&&sortDir==='asc'?'desc':'asc');}:undefined,style:{textAlign:'left'}},col.label," ",sortBy===col.field&&/*#__PURE__*/React.createElement("span",{className:"sort-indicator"},sortDir==='asc'?'â–²':'â–¼'))))),/*#__PURE__*/React.createElement("tbody",null,sortedStats.map(cluster=>{const hc=getHealthColor(cluster.healthScore);return/*#__PURE__*/React.createElement("tr",{key:cluster.id,className:"table-row-hover cursor-pointer",onClick:()=>onSelectCluster(cluster)},/*#__PURE__*/React.createElement("td",{style:{fontWeight:500}},cluster.display_name||cluster.name),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("span",{className:"inline-flex items-center gap-1.5"},/*#__PURE__*/React.createElement("span",{className:"w-1.5 h-1.5 rounded-full inline-block",style:{background:cluster.connected?'#60b515':'#f54f47'}}),/*#__PURE__*/React.createElement("span",{style:{color:cluster.connected?'#60b515':'#f54f47',fontSize:'12px'}},cluster.connected?'online':'offline'))),/*#__PURE__*/React.createElement("td",null,cluster.onlineNodes,"/",cluster.nodeCount),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("span",{style:{color:'#60b515'}},cluster.runningVms),/*#__PURE__*/React.createElement("span",{style:{color:'#728b9a'}}," / ",cluster.totalVms-cluster.runningVms)),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1.5"},/*#__PURE__*/React.createElement("span",{style:{color:corpBarColor(cluster.avgCpu),minWidth:'28px'}},cluster.avgCpu.toFixed(0),"%"),/*#__PURE__*/React.createElement("span",{className:"inline-block",style:{width:'40px',height:'2px',background:'#37474f',position:'relative'}},/*#__PURE__*/React.createElement("span",{style:{position:'absolute',left:0,top:0,height:'2px',width:`${Math.min(cluster.avgCpu,100)}%`,background:corpBarColor(cluster.avgCpu)}})))),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1.5"},/*#__PURE__*/React.createElement("span",{style:{color:corpBarColor(cluster.avgMem),minWidth:'28px'}},cluster.avgMem.toFixed(0),"%"),/*#__PURE__*/React.createElement("span",{className:"inline-block",style:{width:'40px',height:'2px',background:'#37474f',position:'relative'}},/*#__PURE__*/React.createElement("span",{style:{position:'absolute',left:0,top:0,height:'2px',width:`${Math.min(cluster.avgMem,100)}%`,background:corpBarColor(cluster.avgMem)}})))),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1.5"},/*#__PURE__*/React.createElement("span",{style:{color:corpBarColor(cluster.avgStorage),minWidth:'28px'}},cluster.avgStorage.toFixed(0),"%"),/*#__PURE__*/React.createElement("span",{className:"inline-block",style:{width:'40px',height:'2px',background:'#37474f',position:'relative'}},/*#__PURE__*/React.createElement("span",{style:{position:'absolute',left:0,top:0,height:'2px',width:`${Math.min(cluster.avgStorage,100)}%`,background:corpBarColor(cluster.avgStorage)}})))),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("span",{style:{color:hc.color,fontWeight:500}},cluster.healthScore,"%")));}))),topGuests.length>0&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 py-1.5",style:{borderBottom:'1px solid #485764'}},/*#__PURE__*/React.createElement(Icons.Activity,{className:"w-3.5 h-3.5",style:{color:'#49afd9'}}),/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-semibold",style:{color:'#adbbc4'}},t('topResources')||'Top Resources'),/*#__PURE__*/React.createElement("span",{className:"text-[11px]",style:{color:'#728b9a'}},"Top 10")),/*#__PURE__*/React.createElement("table",{className:"corp-datagrid"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{style:{width:'24px'}}),/*#__PURE__*/React.createElement("th",null,t('name')),/*#__PURE__*/React.createElement("th",null,t('cluster')),/*#__PURE__*/React.createElement("th",null,t('node')),/*#__PURE__*/React.createElement("th",null,"CPU"),/*#__PURE__*/React.createElement("th",null,"RAM"),/*#__PURE__*/React.createElement("th",null,t('status')))),/*#__PURE__*/React.createElement("tbody",null,topGuests.map(guest=>{const cpuP=((guest.cpu||0)*100).toFixed(1);const memP=guest.maxmem>0?(guest.mem/guest.maxmem*100).toFixed(1):0;const gc=clusters.find(c=>c.id===guest.cluster_id);return/*#__PURE__*/React.createElement("tr",{key:`${guest.cluster_id}-${guest.vmid}`,className:"table-row-hover cursor-pointer",onClick:()=>{if(gc&&onSelectVm)onSelectVm(gc,guest.vmid,guest.node);}},/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement(Icons.Monitor,{className:"w-3.5 h-3.5",style:{color:guest.type==='qemu'?'#49afd9':'#a178d9'}})),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("span",{style:{fontWeight:500}},guest.name||`VM ${guest.vmid}`),/*#__PURE__*/React.createElement("span",{style:{color:'#728b9a',fontSize:'11px',marginLeft:'6px'}},"#",guest.vmid)),/*#__PURE__*/React.createElement("td",null,guest.cluster_name),/*#__PURE__*/React.createElement("td",{style:{color:'#adbbc4'}},guest.node),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1.5"},/*#__PURE__*/React.createElement("span",{style:{color:corpBarColor(cpuP),minWidth:'32px'}},cpuP,"%"),/*#__PURE__*/React.createElement("span",{className:"inline-block",style:{width:'40px',height:'2px',background:'#37474f',position:'relative'}},/*#__PURE__*/React.createElement("span",{style:{position:'absolute',left:0,top:0,height:'2px',width:`${Math.min(cpuP,100)}%`,background:corpBarColor(cpuP)}})))),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1.5"},/*#__PURE__*/React.createElement("span",{style:{color:corpBarColor(memP),minWidth:'32px'}},memP,"%"),/*#__PURE__*/React.createElement("span",{className:"inline-block",style:{width:'40px',height:'2px',background:'#37474f',position:'relative'}},/*#__PURE__*/React.createElement("span",{style:{position:'absolute',left:0,top:0,height:'2px',width:`${Math.min(memP,100)}%`,background:corpBarColor(memP)}})))),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("span",{className:"inline-flex items-center gap-1"},/*#__PURE__*/React.createElement("span",{className:"w-1.5 h-1.5 rounded-full inline-block",style:{background:guest.status==='running'?'#60b515':'#728b9a'}}),/*#__PURE__*/React.createElement("span",{style:{color:guest.status==='running'?'#60b515':'#728b9a',fontSize:'12px'}},guest.status==='running'?t('running'):t('stopped')))));})))),clusters.length===0&&/*#__PURE__*/React.createElement("div",{className:"py-8 text-center text-[13px]",style:{color:'#728b9a'}},/*#__PURE__*/React.createElement(Icons.Server,{className:"w-6 h-6 mx-auto mb-2",style:{color:'#485764'}}),t('noClustersConfigured')||'No clusters configured'));}// Modern layout (original)
return/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"relative overflow-hidden bg-gradient-to-r from-proxmox-card via-proxmox-dark to-proxmox-card border border-proxmox-border rounded-2xl p-6"},/*#__PURE__*/React.createElement("div",{className:"absolute inset-0 bg-gradient-to-r from-proxmox-orange/5 via-transparent to-blue-500/5"}),/*#__PURE__*/React.createElement("div",{className:"relative flex items-center justify-between flex-wrap gap-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-proxmox-orange to-orange-600 flex items-center justify-center shadow-lg shadow-orange-500/20"},/*#__PURE__*/React.createElement(Icons.Grid,{className:"w-7 h-7 text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h1",{className:"text-2xl font-bold text-white"},t('allClustersOverview')||'All Clusters Overview'),/*#__PURE__*/React.createElement("p",{className:"text-gray-400 text-sm"},t('multiClusterSummary')||'Summary of all managed clusters'))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},totals.totalAlerts>0&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-red-500/10 border border-red-500/30 rounded-lg"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4 text-red-400"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-red-400 font-medium"},totals.totalAlerts," ",t('alerts')||'Alerts')),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-green-500/10 border border-green-500/30 rounded-full"},/*#__PURE__*/React.createElement("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),/*#__PURE__*/React.createElement("span",{className:"text-xs text-green-400 font-medium"},"Live"))))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4"},[{icon:Icons.Server,value:`${totals.connectedClusters}/${totals.clusters}`,label:t('clusters'),color:'proxmox-orange',hoverColor:'proxmox-orange'},{icon:Icons.Cpu,value:`${totals.onlineNodes}/${totals.totalNodes}`,label:t('nodesOnline')||'Nodes',color:'blue-400',hoverColor:'blue-500'},{icon:Icons.Play,value:totals.runningVms,label:t('vmsRunning')||'Running',color:'green-400',hoverColor:'green-500',valueColor:'text-green-400'},{icon:Icons.Square,value:totals.totalVms-totals.runningVms,label:t('vmsStopped')||'Stopped',color:'gray-400',hoverColor:'gray-500'}].map((stat,i)=>/*#__PURE__*/React.createElement("div",{key:i,className:`bg-gradient-to-br from-proxmox-card to-proxmox-dark border border-proxmox-border rounded-xl p-4 hover:border-${stat.hoverColor}/30 transition-all group`},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:`w-10 h-10 rounded-lg bg-${stat.color}/20 flex items-center justify-center group-hover:scale-110 transition-transform`},/*#__PURE__*/React.createElement(stat.icon,{className:`w-5 h-5 text-${stat.color}`})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:`text-xl font-bold ${stat.valueColor||'text-white'}`},stat.value),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},stat.label))))),[{value:totals.avgCpu,label:'CPU',color:totals.avgCpu>80?'#ef4444':totals.avgCpu>60?'#eab308':'#22c55e'},{value:totals.avgMem,label:'RAM',color:totals.avgMem>80?'#ef4444':totals.avgMem>60?'#eab308':'#3b82f6'},{value:totals.avgStorage,label:t('storage')||'Disk',color:totals.avgStorage>80?'#ef4444':totals.avgStorage>60?'#eab308':'#8b5cf6'}].map((stat,i)=>/*#__PURE__*/React.createElement("div",{key:i,className:"bg-gradient-to-br from-proxmox-card to-proxmox-dark border border-proxmox-border rounded-xl p-4 hover:border-proxmox-border transition-all"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement(CircularProgress,{value:stat.value||0,size:44,strokeWidth:4,color:stat.color}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-sm font-bold text-white"},stat.label),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},t('average')||'Avg')))))),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 flex-wrap"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-500 mr-1"},t('sortBy')||'Sort by',":"),/*#__PURE__*/React.createElement(SortButton,{field:"name",label:t('name')||'Name'}),/*#__PURE__*/React.createElement(SortButton,{field:"health",label:t('health')||'Health'}),/*#__PURE__*/React.createElement(SortButton,{field:"nodes",label:t('nodes')||'Nodes'}),/*#__PURE__*/React.createElement(SortButton,{field:"vms",label:"VMs"}),/*#__PURE__*/React.createElement(SortButton,{field:"cpu",label:"CPU"}),/*#__PURE__*/React.createElement(SortButton,{field:"ram",label:"RAM"}))),Object.values(groupedClusters).map(({group,clusters:groupClusters})=>/*#__PURE__*/React.createElement("div",{key:group.id,className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3 px-1"},/*#__PURE__*/React.createElement("div",{className:"w-4 h-4 rounded",style:{backgroundColor:group.color||'#E86F2D'}}),/*#__PURE__*/React.createElement("h3",{className:"text-base font-semibold text-white"},group.name),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-500"},"(",groupClusters.length," ",t('clusters'),")")),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4"},groupClusters.map(cluster=>/*#__PURE__*/React.createElement(ClusterCard,{key:cluster.id,cluster:cluster}))))),ungroupedClusters.length>0&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},Object.keys(groupedClusters).length>0&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3 px-1"},/*#__PURE__*/React.createElement(Icons.Folder,{className:"w-4 h-4 text-gray-500"}),/*#__PURE__*/React.createElement("h3",{className:"text-base font-semibold text-white"},t('ungrouped')||'Ungrouped'),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-500"},"(",ungroupedClusters.length,")")),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4"},ungroupedClusters.map(cluster=>/*#__PURE__*/React.createElement(ClusterCard,{key:cluster.id,cluster:cluster})))),topGuests.length>0&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"w-10 h-10 rounded-lg bg-cyan-500/20 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Activity,{className:"w-5 h-5 text-cyan-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"font-semibold text-white"},t('topResources')||'Top Resources'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},t('highestCpuUsage')||'Highest CPU and RAM usage across all clusters'))),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 bg-proxmox-dark px-2 py-1 rounded"},"Top 10")),/*#__PURE__*/React.createElement("div",{className:"overflow-x-auto"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("tr",{className:"text-left text-xs text-gray-400"},/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 font-medium"},t('type')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 font-medium"},t('name')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 font-medium"},t('cluster')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 font-medium"},t('node')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 font-medium"},"CPU"),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 font-medium"},"RAM"),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 font-medium"},t('status')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 w-10"}))),/*#__PURE__*/React.createElement("tbody",{className:"divide-y divide-proxmox-border/50"},topGuests.map((guest,idx)=>{const cpuPercent=((guest.cpu||0)*100).toFixed(1);const memPercent=guest.maxmem>0?(guest.mem/guest.maxmem*100).toFixed(1):0;const isVM=guest.type==='qemu';const guestCluster=clusters.find(c=>c.id===guest.cluster_id);return/*#__PURE__*/React.createElement("tr",{key:`${guest.cluster_id}-${guest.vmid}`,className:"hover:bg-proxmox-hover/50 transition-colors cursor-pointer group",onClick:()=>{if(guestCluster&&onSelectVm){onSelectVm(guestCluster,guest.vmid,guest.node);}},title:t('clickToOpenVm')||'Click to open VM'},/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${isVM?'bg-blue-500/20':'bg-purple-500/20'}`},isVM?/*#__PURE__*/React.createElement(Icons.Monitor,{className:"w-4 h-4 text-blue-400"}):/*#__PURE__*/React.createElement(Icons.Layers,{className:"w-4 h-4 text-purple-400"}))),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("div",{className:"font-medium text-white group-hover:text-proxmox-orange transition-colors"},guest.name||`VM ${guest.vmid}`),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"ID: ",guest.vmid)),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},guest.cluster_name)),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-400"},guest.node)),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("div",{className:"w-16 h-2 bg-proxmox-dark rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:`h-full rounded-full transition-all ${cpuPercent>80?'bg-red-500':cpuPercent>60?'bg-yellow-500':'bg-green-500'}`,style:{width:`${Math.min(cpuPercent,100)}%`}})),/*#__PURE__*/React.createElement("span",{className:`text-xs font-medium ${cpuPercent>80?'text-red-400':cpuPercent>60?'text-yellow-400':'text-green-400'}`},cpuPercent,"%"))),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("div",{className:"w-16 h-2 bg-proxmox-dark rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:`h-full rounded-full transition-all ${memPercent>80?'bg-red-500':memPercent>60?'bg-yellow-500':'bg-blue-500'}`,style:{width:`${Math.min(memPercent,100)}%`}})),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-400"},memPercent,"%"))),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("span",{className:`inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium ${guest.status==='running'?'bg-green-500/20 text-green-400':'bg-gray-500/20 text-gray-400'}`},/*#__PURE__*/React.createElement("div",{className:`w-1.5 h-1.5 rounded-full ${guest.status==='running'?'bg-green-400':'bg-gray-400'}`}),guest.status==='running'?t('running'):t('stopped'))),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement(Icons.ArrowRight,{className:"w-4 h-4 text-gray-500 group-hover:text-proxmox-orange transition-colors"})));}))))),clusters.length===0&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-12 text-center"},/*#__PURE__*/React.createElement("div",{className:"w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-proxmox-orange/20 to-orange-600/20 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Server,{className:"w-8 h-8 text-proxmox-orange"})),/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-2"},t('noClustersConfigured')||'No clusters configured'),/*#__PURE__*/React.createElement("p",{className:"text-gray-500 text-sm"},t('addClusterToStart')||'Add a cluster to get started')));}// NS: Feb 2026 - Group Settings Modal
// settings + cross-cluster LB config for a specific group
function GroupSettingsModal({group,groupClusters=[],authFetch,addToast,onClose,onSave}){const{t}=useTranslation();const[activeTab,setActiveTab]=useState('general');const[saving,setSaving]=useState(false);// Storage/bridge intersection state for cross-cluster LB dropdowns
const[commonStorages,setCommonStorages]=useState([]);const[commonBridges,setCommonBridges]=useState([]);const[loadingResources,setLoadingResources]=useState(false);// Excluded VMs state per cluster
const[excludedVMsByCluster,setExcludedVMsByCluster]=useState({});const[allVMsByCluster,setAllVMsByCluster]=useState({});const[loadingExcludedVMs,setLoadingExcludedVMs]=useState(false);const[expandedClusters,setExpandedClusters]=useState({});// Cross-cluster replication state
const[xReplJobs,setXReplJobs]=useState([]);const[xReplLoading,setXReplLoading]=useState(false);const[showCreateXRepl,setShowCreateXRepl]=useState(false);const[xReplForm,setXReplForm]=useState({source_cluster:'',vmid:'',vm_type:'qemu',target_cluster:'',target_storage:'',target_bridge:'vmbr0',schedule:'0 */6 * * *',retention:3});const[xReplSourceVMs,setXReplSourceVMs]=useState([]);const[xReplLoadingVMs,setXReplLoadingVMs]=useState(false);const[xReplTargetStorages,setXReplTargetStorages]=useState([]);const[xReplTargetBridges,setXReplTargetBridges]=useState([]);const[xReplLoadingResources,setXReplLoadingResources]=useState(false);// form state - init from group data
// NS: field names must match DB column names exactly (cross_cluster_*)
const[form,setForm]=useState({name:group.name||'',description:group.description||'',color:group.color||'#E86F2D',// cross-cluster LB fields - column names from cluster_groups table
cross_cluster_lb_enabled:group.cross_cluster_lb_enabled||false,cross_cluster_threshold:group.cross_cluster_threshold||30,cross_cluster_interval:group.cross_cluster_interval||600,cross_cluster_dry_run:group.cross_cluster_dry_run!==undefined?group.cross_cluster_dry_run:true,cross_cluster_target_storage:group.cross_cluster_target_storage||'',cross_cluster_target_bridge:group.cross_cluster_target_bridge||'vmbr0',cross_cluster_max_migrations:group.cross_cluster_max_migrations||1,cross_cluster_include_containers:group.cross_cluster_include_containers||false});// Fetch storage/bridge lists from ALL clusters in group, compute intersection
useEffect(()=>{if(activeTab!=='lb'||!form.cross_cluster_lb_enabled||groupClusters.length===0||!authFetch)return;let cancelled=false;const fetchAllClusterResources=async()=>{setLoadingResources(true);const allStorageSets=[];const allStorageInfo={};const allBridgeSets=[];const allBridgeInfo={};for(const cluster of groupClusters){if(!cluster.connected)continue;try{const nodesRes=await authFetch(`${API_URL}/clusters/${cluster.id}/nodes`);if(!nodesRes||!nodesRes.ok)continue;const nodes=await nodesRes.json();const onlineNode=nodes.find(n=>n.status==='online')||nodes[0];if(!onlineNode)continue;const nodeName=onlineNode.node;const storageRes=await authFetch(`${API_URL}/clusters/${cluster.id}/nodes/${nodeName}/storage`);if(storageRes&&storageRes.ok){const storages=await storageRes.json();const names=new Set();storages.forEach(s=>{names.add(s.storage);allStorageInfo[s.storage]={storage:s.storage,type:s.type||'unknown',content:s.content||''};});allStorageSets.push(names);}const networkRes=await authFetch(`${API_URL}/clusters/${cluster.id}/nodes/${nodeName}/networks`);if(networkRes&&networkRes.ok){const networks=await networkRes.json();const names=new Set();networks.filter(n=>n.type==='bridge'||n.type==='OVSBridge'||n.source==='sdn').forEach(b=>{names.add(b.iface);allBridgeInfo[b.iface]={iface:b.iface,type:b.type,source:b.source||'local',comments:b.comments||'',zone:b.zone||'',alias:b.alias||''};});allBridgeSets.push(names);}}catch(err){console.error(`Failed to fetch resources for cluster ${cluster.id}:`,err);}}if(cancelled)return;if(allStorageSets.length>0){const intersection=[...allStorageSets[0]].filter(name=>allStorageSets.every(set=>set.has(name)));setCommonStorages(intersection.map(name=>allStorageInfo[name]).filter(Boolean));}else{setCommonStorages([]);}if(allBridgeSets.length>0){const intersection=[...allBridgeSets[0]].filter(name=>allBridgeSets.every(set=>set.has(name)));setCommonBridges(intersection.map(name=>allBridgeInfo[name]).filter(Boolean));}else{setCommonBridges([]);}setLoadingResources(false);};fetchAllClusterResources();return()=>{cancelled=true;};},[activeTab,form.cross_cluster_lb_enabled,groupClusters.length]);// Fetch excluded VMs for all clusters in group
useEffect(()=>{if(activeTab!=='lb'||!form.cross_cluster_lb_enabled||groupClusters.length===0||!authFetch)return;let cancelled=false;const fetchExcludedVMs=async()=>{setLoadingExcludedVMs(true);const excluded={};const allVMs={};for(const cluster of groupClusters){if(!cluster.connected)continue;try{const[exRes,vmRes]=await Promise.all([authFetch(`${API_URL}/clusters/${cluster.id}/excluded-vms`),authFetch(`${API_URL}/clusters/${cluster.id}/vms`)]);if(!cancelled&&exRes.ok){const exData=await exRes.json();excluded[cluster.id]=exData.excluded_vms||[];}if(!cancelled&&vmRes.ok){const vmData=await vmRes.json();allVMs[cluster.id]=vmData.vms||vmData||[];}}catch(err){console.error(`Error fetching excluded VMs for cluster ${cluster.id}:`,err);}}if(!cancelled){setExcludedVMsByCluster(excluded);setAllVMsByCluster(allVMs);setLoadingExcludedVMs(false);}};fetchExcludedVMs();return()=>{cancelled=true;};},[activeTab,form.cross_cluster_lb_enabled,groupClusters.length]);const excludeVM=async(clusterId,vmid,vmName)=>{try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/excluded-vms/${vmid}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({reason:'Excluded via cross-cluster LB settings'})});if(res.ok){setExcludedVMsByCluster(prev=>({...prev,[clusterId]:[...(prev[clusterId]||[]),{vmid,name:vmName}]}));}}catch(e){console.error(e);}};const includeVM=async(clusterId,vmid)=>{try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/excluded-vms/${vmid}`,{method:'DELETE'});if(res.ok){setExcludedVMsByCluster(prev=>({...prev,[clusterId]:(prev[clusterId]||[]).filter(v=>v.vmid!==vmid)}));}}catch(e){console.error(e);}};// NS: Fetch cross-cluster replication jobs for this group
const groupClusterIds=groupClusters.map(c=>c.id);const fetchXReplJobs=async()=>{setXReplLoading(true);try{const res=await authFetch(`${API_URL}/cross-cluster-replications`);if(res&&res.ok){const all=await res.json();setXReplJobs(all.filter(j=>groupClusterIds.includes(j.source_cluster)||groupClusterIds.includes(j.target_cluster)));}}catch(e){console.error('xrepl fetch:',e);}setXReplLoading(false);};useEffect(()=>{if(activeTab!=='replication'||!authFetch)return;fetchXReplJobs();},[activeTab]);// NS: Fetch VMs when source cluster changes
useEffect(()=>{if(!xReplForm.source_cluster||!authFetch)return;let cancelled=false;const fetchVMs=async()=>{setXReplLoadingVMs(true);setXReplSourceVMs([]);try{const res=await authFetch(`${API_URL}/clusters/${xReplForm.source_cluster}/vms`);if(!cancelled&&res&&res.ok){const data=await res.json();setXReplSourceVMs(data.vms||data||[]);}}catch(e){console.error('xrepl source vms:',e);}if(!cancelled)setXReplLoadingVMs(false);};fetchVMs();return()=>{cancelled=true;};},[xReplForm.source_cluster]);// NS: Fetch target cluster storages/bridges when target cluster changes
useEffect(()=>{if(!xReplForm.target_cluster||!authFetch)return;let cancelled=false;const fetchTargetResources=async()=>{setXReplLoadingResources(true);setXReplTargetStorages([]);setXReplTargetBridges([]);try{const nodesRes=await authFetch(`${API_URL}/clusters/${xReplForm.target_cluster}/nodes`);if(!nodesRes||!nodesRes.ok||cancelled)return;const nodesData=await nodesRes.json();const onlineNode=(Array.isArray(nodesData)?nodesData:nodesData.nodes||[]).find(n=>n.status==='online');if(!onlineNode||cancelled)return;const nodeName=onlineNode.node||onlineNode.name;const[storRes,netRes]=await Promise.all([authFetch(`${API_URL}/clusters/${xReplForm.target_cluster}/nodes/${nodeName}/storage`),authFetch(`${API_URL}/clusters/${xReplForm.target_cluster}/nodes/${nodeName}/networks`)]);if(cancelled)return;if(storRes&&storRes.ok){const storData=await storRes.json();setXReplTargetStorages((Array.isArray(storData)?storData:storData.storages||[]).filter(s=>s.content&&(s.content.includes('images')||s.content.includes('rootdir'))));}if(netRes&&netRes.ok){const netData=await netRes.json();setXReplTargetBridges((Array.isArray(netData)?netData:netData.networks||[]).filter(n=>n.type==='bridge'||n.type==='OVSBridge'||n.source==='sdn'));}}catch(err){console.error('xrepl target resources:',err);}if(!cancelled)setXReplLoadingResources(false);};fetchTargetResources();return()=>{cancelled=true;};},[xReplForm.target_cluster]);// NS: Cross-cluster replication handlers
const handleCreateXRepl=async()=>{try{const res=await authFetch(`${API_URL}/cross-cluster-replications`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({source_cluster:xReplForm.source_cluster,target_cluster:xReplForm.target_cluster,vmid:parseInt(xReplForm.vmid),vm_type:xReplForm.vm_type||'qemu',target_storage:xReplForm.target_storage,target_bridge:xReplForm.target_bridge,schedule:xReplForm.schedule,retention:parseInt(xReplForm.retention)||3})});if(res&&res.ok){if(addToast)addToast(t('xReplCreated')||'Replication job created','success');setShowCreateXRepl(false);setXReplForm({source_cluster:'',vmid:'',vm_type:'qemu',target_cluster:'',target_storage:'',target_bridge:'vmbr0',schedule:'0 */6 * * *',retention:3});await fetchXReplJobs();}else if(res){const err=await res.json();if(addToast)addToast(err.error||t('xReplCreateFailed')||'Failed to create replication job','error');}}catch(e){if(addToast)addToast(t('connectionError')||'Connection error','error');}};const handleDeleteXRepl=async jobId=>{if(!confirm(t('confirmDeleteXRepl')||'Delete this replication job?'))return;try{const res=await authFetch(`${API_URL}/cross-cluster-replications/${jobId}`,{method:'DELETE'});if(res&&res.ok){if(addToast)addToast(t('xReplDeleted')||'Replication job deleted','success');await fetchXReplJobs();}else if(res){const err=await res.json();if(addToast)addToast(err.error||t('xReplDeleteFailed')||'Failed to delete','error');}}catch(e){if(addToast)addToast(t('connectionError')||'Connection error','error');}};const handleRunXReplNow=async jobId=>{try{const res=await authFetch(`${API_URL}/cross-cluster-replications/${jobId}/run`,{method:'POST'});if(res&&res.ok){if(addToast)addToast(t('xReplStarted')||'Replication started','success');}else if(res){const err=await res.json();if(addToast)addToast(err.error||t('xReplStartFailed')||'Failed to start','error');}}catch(e){if(addToast)addToast(t('connectionError')||'Connection error','error');}};const handleSave=async()=>{if(!form.name.trim())return;setSaving(true);await onSave(form);setSaving(false);};// MK: tab config
const tabs=[{id:'general',label:t('general')||'General',icon:Icons.Settings},{id:'lb',label:t('crossClusterLB')||'Cross-Cluster LB',icon:Icons.Scale},{id:'replication',label:t('crossClusterReplication')||'Replication',icon:Icons.Globe},{id:'info',label:t('info')||'Info',icon:Icons.Info}];return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-2xl max-h-[80vh] overflow-y-auto"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between p-5 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:(form.color||'#E86F2D')+'33'}},/*#__PURE__*/React.createElement(Icons.Folder,{className:"w-5 h-5",style:{color:form.color||'#E86F2D'}})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:"text-lg font-semibold text-white"},t('groupSettings')||'Group Settings'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},group.name))),/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"text-gray-400 hover:text-white transition-colors"},/*#__PURE__*/React.createElement(Icons.X,null))),/*#__PURE__*/React.createElement("div",{className:"flex border-b border-proxmox-border"},tabs.map(tab=>/*#__PURE__*/React.createElement("button",{key:tab.id,onClick:()=>setActiveTab(tab.id),className:`flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors whitespace-nowrap ${activeTab===tab.id?'text-proxmox-orange border-b-2 border-proxmox-orange bg-proxmox-dark/50':'text-gray-400 hover:text-white hover:bg-proxmox-dark/30'}`},/*#__PURE__*/React.createElement(tab.icon,{className:"w-4 h-4"}),tab.label))),/*#__PURE__*/React.createElement("div",{className:"p-5"},activeTab==='general'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('name')||'Name'," *"),/*#__PURE__*/React.createElement("input",{value:form.name,onChange:e=>setForm(p=>({...p,name:e.target.value})),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-proxmox-orange",placeholder:"Production Cluster Group"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('description')||'Description'),/*#__PURE__*/React.createElement("textarea",{value:form.description,onChange:e=>setForm(p=>({...p,description:e.target.value})),rows:3,className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-proxmox-orange resize-none",placeholder:"Optional description for this group..."})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('color')||'Color'),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("input",{type:"color",value:form.color,onChange:e=>setForm(p=>({...p,color:e.target.value})),className:"w-10 h-10 rounded cursor-pointer border border-proxmox-border"}),/*#__PURE__*/React.createElement("input",{type:"text",value:form.color,onChange:e=>setForm(p=>({...p,color:e.target.value})),className:"w-28 px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm font-mono focus:outline-none focus:border-proxmox-orange",placeholder:"#E86F2D"}),/*#__PURE__*/React.createElement("div",{className:"flex gap-1.5"},['#E86F2D','#3B82F6','#22C55E','#EAB308','#8B5CF6','#EC4899'].map(c=>/*#__PURE__*/React.createElement("button",{key:c,onClick:()=>setForm(p=>({...p,color:c})),className:`w-6 h-6 rounded-full border-2 transition-all ${form.color===c?'border-white scale-110':'border-transparent hover:border-gray-500'}`,style:{backgroundColor:c}})))))),activeTab==='lb'&&/*#__PURE__*/React.createElement("div",{className:"space-y-5"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-white"},t('enableCrossClusterLB')||'Enable Cross-Cluster Load Balancing'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-0.5"},t('lbDescription')||'Automatically migrate VMs between clusters when resource thresholds are exceeded')),/*#__PURE__*/React.createElement("label",{className:"relative inline-flex items-center cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:form.cross_cluster_lb_enabled,onChange:e=>setForm(p=>({...p,cross_cluster_lb_enabled:e.target.checked})),className:"sr-only peer"}),/*#__PURE__*/React.createElement("div",{className:"w-11 h-6 bg-gray-600 peer-checked:bg-proxmox-orange rounded-full peer-focus:ring-2 peer-focus:ring-proxmox-orange/50 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full"}))),form.cross_cluster_lb_enabled&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between p-3 bg-yellow-500/5 border border-yellow-500/20 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4 text-yellow-400"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-sm text-yellow-300"},t('dryRunMode')||'Dry Run / Simulation Mode'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},t('dryRunDesc')||'Log what would happen without actually migrating'))),/*#__PURE__*/React.createElement("label",{className:"relative inline-flex items-center cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:form.cross_cluster_dry_run,onChange:e=>setForm(p=>({...p,cross_cluster_dry_run:e.target.checked})),className:"sr-only peer"}),/*#__PURE__*/React.createElement("div",{className:"w-11 h-6 bg-gray-600 peer-checked:bg-yellow-500 rounded-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full"}))),/*#__PURE__*/React.createElement(Slider,{label:t('cpuThreshold')||'CPU Threshold (%)',description:t('crossClusterThresholdDesc')||'CPU threshold for cluster imbalance (10-80%)',value:form.cross_cluster_threshold,onChange:v=>setForm(p=>({...p,cross_cluster_threshold:v})),min:10,max:80}),/*#__PURE__*/React.createElement(Slider,{label:t('checkInterval')||'Check Interval',description:t('crossClusterIntervalDesc')||'Time between check cycles',value:form.cross_cluster_interval,onChange:v=>setForm(p=>({...p,cross_cluster_interval:v})),min:300,max:3600,step:60,unit:"s"}),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('targetStorage')||'Target Storage'),loadingResources?/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-gray-500 text-sm py-2"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-4 h-4 animate-spin"}),t('loadingCrossClusterResources')||'Loading...'):commonStorages.length>0?/*#__PURE__*/React.createElement("select",{value:form.cross_cluster_target_storage,onChange:e=>setForm(p=>({...p,cross_cluster_target_storage:e.target.value})),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-proxmox-orange"},/*#__PURE__*/React.createElement("option",{value:""},t('selectStorage')||'Select storage...'),commonStorages.map(s=>/*#__PURE__*/React.createElement("option",{key:s.storage,value:s.storage},s.storage," (",s.type,")"))):/*#__PURE__*/React.createElement("div",{className:"text-xs text-yellow-400 py-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-3 h-3 inline mr-1"}),t('noCommonStorages')||'No common storage found across all clusters'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-600 mt-1"},t('commonStorageHint')||'Only storages available on all clusters')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('targetBridge')||'Target Bridge'),loadingResources?/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-gray-500 text-sm py-2"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-4 h-4 animate-spin"}),t('loadingCrossClusterResources')||'Loading...'):commonBridges.length>0?/*#__PURE__*/React.createElement("select",{value:form.cross_cluster_target_bridge,onChange:e=>setForm(p=>({...p,cross_cluster_target_bridge:e.target.value})),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-proxmox-orange"},commonBridges.filter(b=>b.source!=='sdn').length>0&&/*#__PURE__*/React.createElement("optgroup",{label:"Local Bridges"},commonBridges.filter(b=>b.source!=='sdn').map(b=>/*#__PURE__*/React.createElement("option",{key:b.iface,value:b.iface},b.iface,b.comments?` - ${b.comments}`:''))),commonBridges.filter(b=>b.source==='sdn').length>0&&/*#__PURE__*/React.createElement("optgroup",{label:"SDN VNets"},commonBridges.filter(b=>b.source==='sdn').map(b=>/*#__PURE__*/React.createElement("option",{key:b.iface,value:b.iface},b.iface," - ",b.zone||'SDN',b.alias?` (${b.alias})`:'')))):/*#__PURE__*/React.createElement("div",{className:"text-xs text-yellow-400 py-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-3 h-3 inline mr-1"}),t('noCommonBridges')||'No common bridge found across all clusters'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-600 mt-1"},t('commonBridgeHint')||'Only bridges available on all clusters'))),/*#__PURE__*/React.createElement(Slider,{label:t('maxMigrations')||'Max Migrations per Cycle',description:t('crossClusterMaxMigrationsDesc')||'Max migrations per check cycle',value:form.cross_cluster_max_migrations,onChange:v=>setForm(p=>({...p,cross_cluster_max_migrations:v})),min:1,max:5,step:1,unit:""}),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between p-3 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-sm text-white"},t('includeContainers')||'Include Containers'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-0.5"},t('includeContainersDesc')||'Include containers (LXC) in cross-cluster balancing'),form.cross_cluster_include_containers&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-yellow-400 mt-1 flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-3 h-3"}),t('containerMigrationWarning')||'Containers are restarted during migration (downtime)')),/*#__PURE__*/React.createElement("label",{className:"relative inline-flex items-center cursor-pointer ml-4"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:form.cross_cluster_include_containers,onChange:e=>setForm(p=>({...p,cross_cluster_include_containers:e.target.checked})),className:"sr-only peer"}),/*#__PURE__*/React.createElement("div",{className:"w-11 h-6 bg-gray-600 peer-checked:bg-proxmox-orange rounded-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full"}))),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-white mb-1"},t('excludedVMsCrossCluster')||'Excluded VMs/Containers'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mb-3"},t('excludedVMsCrossClusterDesc')||'VMs and containers excluded from automatic cross-cluster balancing'),loadingExcludedVMs?/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-gray-500 text-sm py-2"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-4 h-4 animate-spin"}),t('loading'),"..."):groupClusters.filter(c=>c.connected).length===0?/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-600 py-2"},t('noExcludedVMsInGroup')||'No VMs excluded'):/*#__PURE__*/React.createElement("div",{className:"space-y-2"},groupClusters.filter(c=>c.connected).map(cluster=>{const excluded=excludedVMsByCluster[cluster.id]||[];const allVMs=allVMsByCluster[cluster.id]||[];const excludedIds=excluded.map(v=>v.vmid);const available=allVMs.filter(vm=>!excludedIds.includes(vm.vmid));const isExpanded=expandedClusters[cluster.id];return/*#__PURE__*/React.createElement("div",{key:cluster.id,className:"border border-proxmox-border rounded-lg overflow-hidden"},/*#__PURE__*/React.createElement("button",{onClick:()=>setExpandedClusters(prev=>({...prev,[cluster.id]:!prev[cluster.id]})),className:"w-full flex items-center justify-between p-2.5 bg-proxmox-dark/50 hover:bg-proxmox-dark text-left"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Server,{className:"w-3.5 h-3.5 text-proxmox-orange"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-white"},cluster.name),excluded.length>0&&/*#__PURE__*/React.createElement("span",{className:"text-xs bg-red-500/20 text-red-400 px-1.5 py-0.5 rounded"},excluded.length)),/*#__PURE__*/React.createElement(Icons.ChevronDown,{className:`w-4 h-4 text-gray-500 transition-transform ${isExpanded?'rotate-180':''}`})),isExpanded&&/*#__PURE__*/React.createElement("div",{className:"p-2.5 space-y-2 border-t border-proxmox-border"},excluded.length>0?/*#__PURE__*/React.createElement("div",{className:"space-y-1"},excluded.map(vm=>/*#__PURE__*/React.createElement("div",{key:vm.vmid,className:"flex items-center justify-between bg-proxmox-dark rounded px-2.5 py-1.5"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Monitor,{className:"w-3.5 h-3.5 text-red-400"}),/*#__PURE__*/React.createElement("span",{className:"text-sm"},vm.name||`VM ${vm.vmid}`),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},"(",vm.vmid,")")),/*#__PURE__*/React.createElement("button",{onClick:()=>includeVM(cluster.id,vm.vmid),className:"text-xs text-green-400 hover:text-green-300"},t('include')||'Include')))):/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-600 p-2"},t('noExcludedVMsInGroup')||'No VMs excluded'),available.length>0&&/*#__PURE__*/React.createElement("div",{className:"flex gap-2 mt-1"},/*#__PURE__*/React.createElement("select",{id:`xclb-exclude-${cluster.id}`,className:"flex-1 bg-proxmox-dark border border-proxmox-border rounded px-2 py-1.5 text-sm",defaultValue:""},/*#__PURE__*/React.createElement("option",{value:"",disabled:true},t('selectVMToExclude')||'Select VM to exclude...'),available.map(vm=>/*#__PURE__*/React.createElement("option",{key:vm.vmid,value:vm.vmid},vm.name||`VM ${vm.vmid}`," (",vm.vmid,") - ",vm.node))),/*#__PURE__*/React.createElement("button",{onClick:()=>{const select=document.getElementById(`xclb-exclude-${cluster.id}`);const vmid=parseInt(select?.value);if(!vmid)return;const vm=available.find(v=>v.vmid===vmid);excludeVM(cluster.id,vmid,vm?.name);select.value='';},className:"px-2.5 py-1.5 bg-red-500/20 text-red-400 rounded hover:bg-red-500/30 text-xs flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.Ban,{className:"w-3.5 h-3.5"}),t('exclude')||'Exclude'))));}))))),activeTab==='replication'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Globe,{className:"w-4 h-4 text-proxmox-orange"}),t('crossClusterReplication')||'Cross-Cluster Replication'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-0.5"},t('crossClusterReplicationDesc')||'Replicate VM snapshots to another cluster (DR)')),groupClusters.length>=2&&/*#__PURE__*/React.createElement("button",{onClick:()=>setShowCreateXRepl(true),className:"flex items-center gap-1.5 px-3 py-1.5 bg-proxmox-orange/10 text-proxmox-orange rounded-lg text-xs hover:bg-proxmox-orange/20 transition-colors"},/*#__PURE__*/React.createElement(Icons.Plus,{className:"w-3.5 h-3.5"}),t('addDrJob')||'Add DR Job')),groupClusters.length<2?/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500 text-sm"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-8 h-8 mx-auto mb-2 text-gray-600"}),t('needTwoClusters')||'At least 2 clusters needed for cross-cluster replication'):xReplLoading?/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center gap-2 py-8 text-gray-500 text-sm"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-4 h-4 animate-spin"}),t('loading'),"..."):xReplJobs.length===0&&!showCreateXRepl?/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500 text-sm"},t('noReplicationJobs')||'No replication jobs configured'):/*#__PURE__*/React.createElement("div",{className:"space-y-2"},xReplJobs.map(job=>{const srcCluster=groupClusters.find(c=>c.id===job.source_cluster);const tgtCluster=groupClusters.find(c=>c.id===job.target_cluster);return/*#__PURE__*/React.createElement("div",{key:job.id,className:"bg-proxmox-dark rounded-lg p-3 flex items-center justify-between border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex-1 min-w-0"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 flex-wrap"},/*#__PURE__*/React.createElement("span",{className:`w-2 h-2 rounded-full flex-shrink-0 ${job.enabled?'bg-green-500':'bg-gray-500'}`}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-white truncate"},srcCluster?.name||job.source_cluster),/*#__PURE__*/React.createElement(Icons.ArrowRight,{className:"w-3.5 h-3.5 text-gray-500 flex-shrink-0"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-white truncate"},tgtCluster?.name||job.target_cluster),/*#__PURE__*/React.createElement("span",{className:"text-xs bg-proxmox-dark px-1.5 py-0.5 rounded text-gray-400 border border-proxmox-border"},job.vm_type==='lxc'?'CT':'VM'," ",job.vmid)),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mt-1 flex items-center gap-2 flex-wrap"},/*#__PURE__*/React.createElement("span",null,job.schedule),/*#__PURE__*/React.createElement("span",null,"\xB7"),/*#__PURE__*/React.createElement("span",null,job.target_storage||'default'),job.last_run&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("span",null,"\xB7"),/*#__PURE__*/React.createElement("span",null,t('lastRunPrefix')||'Last',": ",new Date(job.last_run).toLocaleString())),job.last_status&&/*#__PURE__*/React.createElement("span",{className:job.last_status==='OK'?'text-green-400':'text-red-400'},job.last_status),job.last_error&&/*#__PURE__*/React.createElement("span",{className:"text-red-400"},job.last_error))),/*#__PURE__*/React.createElement("div",{className:"flex gap-1 flex-shrink-0 ml-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>handleRunXReplNow(job.id),className:"p-1.5 rounded hover:bg-green-500/10 text-gray-400 hover:text-green-400",title:t('runNow')||'Run now'},/*#__PURE__*/React.createElement(Icons.Play,{className:"w-3.5 h-3.5"})),/*#__PURE__*/React.createElement("button",{onClick:()=>handleDeleteXRepl(job.id),className:"p-1.5 rounded hover:bg-red-500/10 text-gray-400 hover:text-red-400",title:t('delete')||'Delete'},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-3.5 h-3.5"}))));})),showCreateXRepl&&groupClusters.length>=2&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-lg p-4"},/*#__PURE__*/React.createElement("h5",{className:"text-sm font-medium text-white mb-3"},t('newCrossClusterReplication')||'New Cross-Cluster Replication'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('sourceCluster')||'Source Cluster'),/*#__PURE__*/React.createElement("select",{value:xReplForm.source_cluster,onChange:e=>setXReplForm(f=>({...f,source_cluster:e.target.value,vmid:'',vm_type:'qemu'})),className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},t('selectCluster')||'Select cluster...'),groupClusters.filter(c=>c.connected).map(c=>/*#__PURE__*/React.createElement("option",{key:c.id,value:c.id},c.name)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"VM"),xReplLoadingVMs?/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-gray-500 text-sm py-2"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-3.5 h-3.5 animate-spin"}),t('loading'),"..."):xReplForm.source_cluster?/*#__PURE__*/React.createElement("select",{value:xReplForm.vmid,onChange:e=>{const vmid=e.target.value;const vm=xReplSourceVMs.find(v=>String(v.vmid)===vmid);setXReplForm(f=>({...f,vmid,vm_type:vm?.type||'qemu'}));},className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},t('selectVM')||'Select VM...'),xReplSourceVMs.map(vm=>/*#__PURE__*/React.createElement("option",{key:vm.vmid,value:vm.vmid},vm.name||`VM ${vm.vmid}`," (",vm.vmid,") - ",vm.type==='lxc'?'CT':'VM'))):/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 py-2"},t('selectClusterFirst')||'Select a source cluster first')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('targetCluster')||'Target Cluster'),/*#__PURE__*/React.createElement("select",{value:xReplForm.target_cluster,onChange:e=>setXReplForm(f=>({...f,target_cluster:e.target.value,target_storage:'',target_bridge:'vmbr0'})),className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},t('selectCluster')||'Select cluster...'),groupClusters.filter(c=>c.connected&&c.id!==xReplForm.source_cluster).map(c=>/*#__PURE__*/React.createElement("option",{key:c.id,value:c.id},c.name)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('targetStorage')||'Target Storage'),xReplLoadingResources?/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-gray-500 text-sm py-2"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-3.5 h-3.5 animate-spin"}),t('loading'),"..."):xReplForm.target_cluster?/*#__PURE__*/React.createElement("select",{value:xReplForm.target_storage,onChange:e=>setXReplForm(f=>({...f,target_storage:e.target.value})),className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},t('selectStorage')||'Select storage...'),xReplTargetStorages.map(s=>/*#__PURE__*/React.createElement("option",{key:s.storage,value:s.storage},s.storage," (",s.type,")"))):/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 py-2"},t('selectClusterFirst')||'Select a target cluster first')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('targetBridge')||'Target Bridge'),xReplLoadingResources?/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-gray-500 text-sm py-2"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-3.5 h-3.5 animate-spin"}),t('loading'),"..."):xReplForm.target_cluster?/*#__PURE__*/React.createElement("select",{value:xReplForm.target_bridge,onChange:e=>setXReplForm(f=>({...f,target_bridge:e.target.value})),className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"},xReplTargetBridges.filter(b=>b.source!=='sdn').length>0&&/*#__PURE__*/React.createElement("optgroup",{label:"Local Bridges"},xReplTargetBridges.filter(b=>b.source!=='sdn').map(b=>/*#__PURE__*/React.createElement("option",{key:b.iface,value:b.iface},b.iface,b.comments?` - ${b.comments}`:''))),xReplTargetBridges.filter(b=>b.source==='sdn').length>0&&/*#__PURE__*/React.createElement("optgroup",{label:"SDN VNets"},xReplTargetBridges.filter(b=>b.source==='sdn').map(b=>/*#__PURE__*/React.createElement("option",{key:b.iface,value:b.iface},b.iface," - ",b.zone||'SDN',b.alias?` (${b.alias})`:'')))):/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 py-2"},t('selectClusterFirst')||'Select a target cluster first')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('scheduleCron')||'Schedule (Cron)'),/*#__PURE__*/React.createElement("input",{type:"text",value:xReplForm.schedule,onChange:e=>setXReplForm(f=>({...f,schedule:e.target.value})),placeholder:"0 */6 * * *",className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('replicationRetention')||'Retention'),/*#__PURE__*/React.createElement("input",{type:"number",min:"1",max:"30",value:xReplForm.retention,onChange:e=>setXReplForm(f=>({...f,retention:parseInt(e.target.value)||1})),className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"}))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 mt-3"},/*#__PURE__*/React.createElement("button",{onClick:handleCreateXRepl,disabled:!xReplForm.source_cluster||!xReplForm.vmid||!xReplForm.target_cluster,className:"px-3 py-1.5 bg-proxmox-orange text-white rounded-lg text-sm hover:bg-proxmox-orange/90 transition-colors disabled:opacity-50"},t('create')||'Create'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowCreateXRepl(false),className:"px-3 py-1.5 bg-proxmox-dark border border-proxmox-border text-gray-300 rounded-lg text-sm hover:bg-proxmox-darker transition-colors"},t('cancel')||'Cancel')))),activeTab==='info'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-white mb-3"},t('groupInfo')||'Group Information'),/*#__PURE__*/React.createElement("div",{className:"space-y-2 text-sm"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('groupId')||'Group ID'),/*#__PURE__*/React.createElement("span",{className:"text-white font-mono text-xs"},group.id)),/*#__PURE__*/React.createElement("div",{className:"flex justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('created')||'Created'),/*#__PURE__*/React.createElement("span",{className:"text-white"},group.created?new Date(group.created).toLocaleString():'-')),group.tenant_id&&/*#__PURE__*/React.createElement("div",{className:"flex justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('tenant')||'Tenant'),/*#__PURE__*/React.createElement("span",{className:"text-white"},group.tenant_id)))),group.cross_cluster_lb_enabled&&/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-white mb-3"},t('lbStatus')||'Load Balancing Status'),/*#__PURE__*/React.createElement("div",{className:"space-y-2 text-sm"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('lastRun')||'Last LB Run'),/*#__PURE__*/React.createElement("span",{className:"text-white"},group.last_lb_run?new Date(group.last_lb_run).toLocaleString():t('neverRun')||'Never run')),/*#__PURE__*/React.createElement("div",{className:"flex justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('mode')||'Mode'),/*#__PURE__*/React.createElement("span",{className:group.cross_cluster_dry_run?'text-yellow-400':'text-green-400'},group.cross_cluster_dry_run?t('simulation')||'Simulation':t('active')||'Active')))),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-blue-500/5 border border-blue-500/20 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-3"},/*#__PURE__*/React.createElement(Icons.Info,{className:"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"}),/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400"},/*#__PURE__*/React.createElement("p",{className:"mb-2"},t('lbExplanation')||'Cross-Cluster Load Balancing monitors CPU and RAM usage across all clusters in this group. When a cluster exceeds the configured threshold, VMs are automatically migrated to a less loaded cluster.'),/*#__PURE__*/React.createElement("p",null,t('lbDryRunExplanation')||'Enable Dry Run mode first to review what actions would be taken before enabling live migrations.')))))),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-end gap-3 p-5 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"px-4 py-2 text-sm text-gray-400 hover:text-white transition-colors"},t('cancel')||'Cancel'),/*#__PURE__*/React.createElement("button",{onClick:handleSave,disabled:saving||!form.name.trim(),className:"px-5 py-2 bg-proxmox-orange hover:bg-orange-600 disabled:opacity-50 rounded-lg text-sm font-medium text-white transition-colors flex items-center gap-2"},saving?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-4 h-4 animate-spin"})," ",t('saving')||'Saving...'):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Icons.Save,{className:"w-4 h-4"})," ",t('save')||'Save')))));}// Cluster Health Widget
function ClusterHealth({metrics,isCorporate}){const{t}=useTranslation();const nodes=Object.entries(metrics);if(nodes.length===0)return null;const avgCpu=nodes.reduce((acc,[,m])=>acc+m.cpu_percent,0)/nodes.length;const avgMem=nodes.reduce((acc,[,m])=>acc+m.mem_percent,0)/nodes.length;const avgScore=nodes.reduce((acc,[,m])=>acc+m.score,0)/nodes.length;const onlineNodes=nodes.filter(([,m])=>m.status==='online'&&!m.maintenance_mode).length;const maintenanceNodes=nodes.filter(([,m])=>m.maintenance_mode).length;const healthScore=Math.max(0,100-avgScore/2);const healthLabel=healthScore>=80?t('excellent'):healthScore>=60?t('good'):healthScore>=40?t('warning'):t('critical');const healthColor=healthScore>=80?'#22c55e':healthScore>=60?'#84cc16':healthScore>=40?'#eab308':'#ef4444';// LW: Feb 2026 - corporate compact variant (Clarity dark theme)
const corpHealthColor=healthScore>=80?'#60b515':healthScore>=60?'#60b515':healthScore>=40?'#efc006':'#f54f47';if(isCorporate){return/*#__PURE__*/React.createElement("div",{className:"p-3",style:{background:'#22343c',border:'1px solid #485764'}},/*#__PURE__*/React.createElement("h3",{className:"text-[11px] font-semibold uppercase tracking-wider mb-2",style:{color:'#728b9a'}},t('clusterHealth')),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4 flex-wrap"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("div",{className:"w-20 h-2 overflow-hidden",style:{background:'#1b2a32',borderRadius:'1px'}},/*#__PURE__*/React.createElement("div",{className:"h-full",style:{width:`${healthScore}%`,backgroundColor:corpHealthColor,borderRadius:'1px'}})),/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium",style:{color:'#e9ecef'}},healthScore.toFixed(0)),/*#__PURE__*/React.createElement("span",{className:"text-[11px]",style:{color:'#728b9a'}},healthLabel)),/*#__PURE__*/React.createElement("span",{className:"text-[12px]",style:{color:'#adbbc4'}},t('nodesOnline'),": ",/*#__PURE__*/React.createElement("span",{style:{color:'#e9ecef'}},onlineNodes,"/",nodes.length)),/*#__PURE__*/React.createElement("span",{className:"text-[12px]",style:{color:'#adbbc4'}},"CPU: ",/*#__PURE__*/React.createElement("span",{style:{color:'#e9ecef'}},avgCpu.toFixed(1),"%")),/*#__PURE__*/React.createElement("span",{className:"text-[12px]",style:{color:'#adbbc4'}},"RAM: ",/*#__PURE__*/React.createElement("span",{style:{color:'#e9ecef'}},avgMem.toFixed(1),"%")),maintenanceNodes>0&&/*#__PURE__*/React.createElement("span",{className:"text-[12px] flex items-center gap-1",style:{color:'#efc006'}},/*#__PURE__*/React.createElement(Icons.Wrench,{className:"w-3 h-3"})," ",maintenanceNodes," ",t('maintenance'))));}return/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-5"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4"},t('clusterHealth')),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center mb-6"},/*#__PURE__*/React.createElement("div",{className:"relative"},/*#__PURE__*/React.createElement("svg",{viewBox:"0 0 100 100",className:"w-32 h-32"},/*#__PURE__*/React.createElement("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#30363D",strokeWidth:"8"}),/*#__PURE__*/React.createElement("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:healthColor,strokeWidth:"8",strokeLinecap:"round",strokeDasharray:`${healthScore*2.83} 283`,transform:"rotate(-90 50 50)",className:"transition-all duration-1000"})),/*#__PURE__*/React.createElement("div",{className:"absolute inset-0 flex flex-col items-center justify-center"},/*#__PURE__*/React.createElement("span",{className:"text-2xl font-bold text-white"},healthScore.toFixed(0)),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-400"},healthLabel)))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",{className:"text-center"},/*#__PURE__*/React.createElement("div",{className:"text-2xl font-bold text-white"},onlineNodes,"/",nodes.length),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},t('nodesOnline'))),/*#__PURE__*/React.createElement("div",{className:"text-center"},/*#__PURE__*/React.createElement("div",{className:"text-2xl font-bold text-white"},avgScore.toFixed(0)),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},t('avgScore'))),/*#__PURE__*/React.createElement("div",{className:"text-center"},/*#__PURE__*/React.createElement("div",{className:"text-2xl font-bold text-white"},avgCpu.toFixed(1),"%"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},t('avgCpu'))),/*#__PURE__*/React.createElement("div",{className:"text-center"},/*#__PURE__*/React.createElement("div",{className:"text-2xl font-bold text-white"},avgMem.toFixed(1),"%"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},t('avgRam')))),maintenanceNodes>0&&/*#__PURE__*/React.createElement("div",{className:"mt-4 pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center gap-2 text-yellow-400"},/*#__PURE__*/React.createElement(Icons.Wrench,null),/*#__PURE__*/React.createElement("span",{className:"text-sm font-medium"},maintenanceNodes," Node(s) ",t('maintenance')))));}// Create Snapshot Modal - NS: Feb 2026 enhanced with efficient mode
function CreateSnapshotModal({isQemu,onSubmit,onClose,loading,efficientInfo}){const{t}=useTranslation();const[snapname,setSnapname]=useState(`snap_${Date.now()}`);const[description,setDescription]=useState('');const[vmstate,setVmstate]=useState(false);const[mode,setMode]=useState('standard');const[snapSizeGb,setSnapSizeGb]=useState(efficientInfo?.recommended_snap_size_gb||10);const isEfficient=mode==='efficient';const canEfficient=efficientInfo?.eligible;const handleSubmit=()=>{if(!snapname.trim())return;onSubmit(snapname.trim(),description,vmstate,isEfficient?{mode:'efficient',snap_size_gb:snapSizeGb}:{mode:'standard'});};return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:`w-full ${canEfficient?'max-w-lg':'max-w-md'} bg-proxmox-card border border-proxmox-border rounded-xl p-6 animate-scale-in`},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4"},t('createSnapshot')),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},canEfficient&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('snapshotMode')),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setMode('standard'),className:`flex-1 px-3 py-2 rounded-lg text-sm border transition-colors ${!isEfficient?'bg-blue-600/20 border-blue-500 text-blue-400':'bg-proxmox-dark border-proxmox-border text-gray-400 hover:border-gray-500'}`},t('normalMode')),/*#__PURE__*/React.createElement("button",{onClick:()=>setMode('efficient'),className:`flex-1 px-3 py-2 rounded-lg text-sm border transition-colors ${isEfficient?'bg-green-600/20 border-green-500 text-green-400':'bg-proxmox-dark border-proxmox-border text-gray-400 hover:border-gray-500'}`},/*#__PURE__*/React.createElement("span",{className:"flex items-center justify-center gap-1"},/*#__PURE__*/React.createElement(Icons.Zap,null),t('efficientMode'))))),isEfficient&&efficientInfo&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-proxmox-dark rounded-lg border border-green-500/30 space-y-3"},/*#__PURE__*/React.createElement("div",{className:"text-sm font-medium text-green-400 flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.Zap,null),t('spaceSavings'),": ",efficientInfo.savings_percent,"%"),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-xs text-gray-400 mb-1"},/*#__PURE__*/React.createElement("span",null,t('normalSnapshotSize')),/*#__PURE__*/React.createElement("span",null,efficientInfo.total_disk_size_gb?.toFixed(1)," GB")),/*#__PURE__*/React.createElement("div",{className:"w-full h-3 bg-gray-700 rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"h-full bg-red-500 rounded-full",style:{width:'100%'}}))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-xs text-gray-400 mb-1"},/*#__PURE__*/React.createElement("span",null,t('efficientSnapshotSize')),/*#__PURE__*/React.createElement("span",null,"~",snapSizeGb?.toFixed(1)," GB")),/*#__PURE__*/React.createElement("div",{className:"w-full h-3 bg-gray-700 rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"h-full bg-green-500 rounded-full",style:{width:`${Math.max(3,snapSizeGb/efficientInfo.total_disk_size_gb*100)}%`}}))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('snapshotSizeGb')," (",t('recommended'),": ",efficientInfo.recommended_snap_size_gb?.toFixed(1)," GB)"),/*#__PURE__*/React.createElement("input",{type:"number",value:snapSizeGb,onChange:e=>setSnapSizeGb(parseFloat(e.target.value)||1),min:"1",max:efficientInfo.vg_free_gb-2,step:"1",className:"w-full px-3 py-1.5 bg-proxmox-card border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",{className:`text-xs flex items-center gap-1 ${efficientInfo.has_guest_agent?'text-green-400':'text-yellow-400'}`},efficientInfo.has_guest_agent?/*#__PURE__*/React.createElement(Icons.CheckCircle,null):/*#__PURE__*/React.createElement(Icons.AlertTriangle,null),efficientInfo.has_guest_agent?t('guestAgentDetected'):t('noGuestAgent')),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 italic"},t('managedByPegaprox'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('name')),/*#__PURE__*/React.createElement("input",{type:"text",value:snapname,onChange:e=>setSnapname(e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white",placeholder:"snapshot-name"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('description')," (",t('optional'),")"),/*#__PURE__*/React.createElement("input",{type:"text",value:description,onChange:e=>setDescription(e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white",placeholder:t('snapshotDescription')})),isQemu&&!isEfficient&&/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:vmstate,onChange:e=>setVmstate(e.target.checked),className:"rounded"}),t('saveRamState'))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"px-4 py-2 text-gray-300 hover:text-white"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:handleSubmit,disabled:loading||!snapname.trim(),className:"flex items-center gap-2 px-4 py-2 rounded-lg text-white disabled:opacity-50 bg-green-600 hover:bg-green-700"},loading&&/*#__PURE__*/React.createElement(Icons.RotateCw,null),isEfficient&&/*#__PURE__*/React.createElement(Icons.Zap,null),t('create')))));}// Create Replication Modal
function CreateReplicationModal({nodes,onSubmit,onClose,loading}){const{t}=useTranslation();const[target,setTarget]=useState(nodes[0]||'');const[schedule,setSchedule]=useState('*/15');const[rate,setRate]=useState('');const[comment,setComment]=useState('');const scheduleOptions=[{value:'*/5',label:t('every5min')},{value:'*/15',label:t('every15min')},{value:'*/30',label:t('every30min')},{value:'0 *',label:t('hourly')},{value:'0 */2',label:t('every2hours')},{value:'0 */4',label:t('every4hours')},{value:'0 */6',label:t('every6hours')},{value:'0 */12',label:t('every12hours')},{value:'0 0',label:t('daily')}];const handleSubmit=()=>{if(!target)return;onSubmit(target,schedule,rate?parseInt(rate):null,comment);};return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-md bg-proxmox-card border border-proxmox-border rounded-xl p-6 animate-scale-in"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4"},t('createReplicationJob')),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('targetNode')),/*#__PURE__*/React.createElement("select",{value:target,onChange:e=>setTarget(e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},nodes.map(n=>/*#__PURE__*/React.createElement("option",{key:n,value:n},n)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Schedule"),/*#__PURE__*/React.createElement("select",{value:schedule,onChange:e=>setSchedule(e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},scheduleOptions.map(opt=>/*#__PURE__*/React.createElement("option",{key:opt.value,value:opt.value},opt.label)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('rateLimit')," (",t('optional'),")"),/*#__PURE__*/React.createElement("input",{type:"number",value:rate,onChange:e=>setRate(e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white",placeholder:t('unlimited'),min:"1"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('comment')," (",t('optional'),")"),/*#__PURE__*/React.createElement("input",{type:"text",value:comment,onChange:e=>setComment(e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white",placeholder:t('commentPlaceholder')}))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"px-4 py-2 text-gray-300 hover:text-white"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:handleSubmit,disabled:loading||!target,className:"flex items-center gap-2 px-4 py-2 bg-green-600 rounded-lg text-white hover:bg-green-700 disabled:opacity-50"},loading&&/*#__PURE__*/React.createElement(Icons.RotateCw,null),t('create')))));}// Shared form components (defined outside ConfigModal to prevent re-creation)
// ns: could use a form library but this is fine for now
const ConfigInputField=({label,value,onChange,type='text',disabled=false,suffix='',options=null,placeholder='',needsRestart=false,t})=>/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs font-medium text-gray-400 mb-1"},label,needsRestart&&/*#__PURE__*/React.createElement("span",{className:"ml-2 text-[10px] px-1.5 py-0.5 bg-red-500/20 text-red-400 rounded font-medium"},t?t('needsRestart'):'NEEDS RESTART')),options?/*#__PURE__*/React.createElement("select",{value:value,onChange:e=>onChange(e.target.value),disabled:disabled,className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-proxmox-orange disabled:opacity-50 disabled:cursor-not-allowed"},options.map(opt=>/*#__PURE__*/React.createElement("option",{key:typeof opt==='string'?opt:opt.value,value:typeof opt==='string'?opt:opt.value},typeof opt==='string'?opt:opt.label))):/*#__PURE__*/React.createElement("div",{className:"relative"},/*#__PURE__*/React.createElement("input",{type:type,value:value,onChange:e=>onChange(type==='number'?+e.target.value:e.target.value),disabled:disabled,placeholder:placeholder,className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-proxmox-orange disabled:opacity-50 disabled:cursor-not-allowed"}),suffix&&/*#__PURE__*/React.createElement("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 text-sm"},suffix)));// checkbox version
const ConfigCheckboxField=({label,checked,onChange,disabled=false,needsRestart=false,t})=>/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-3 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:checked,onChange:e=>onChange(e.target.checked?1:0),disabled:disabled,className:"w-4 h-4 rounded border-proxmox-border bg-proxmox-dark text-proxmox-orange focus:ring-proxmox-orange"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},label),needsRestart&&/*#__PURE__*/React.createElement("span",{className:"text-[10px] px-1.5 py-0.5 bg-red-500/20 text-red-400 rounded font-medium"},t?t('needsRestart'):'RESTART'));// LW: Memory input with MB/GB unit selector - makes it easier to set RAM values
const MemoryInputField=({label,value,onChange,disabled=false,needsRestart=false,minMB=128,stepMB=128,t})=>{// value is always in MB internally
const[unit,setUnit]=useState(value>=1024?'GB':'MB');const displayValue=unit==='GB'?value/1024:value;const step=unit==='GB'?0.5:stepMB;const min=unit==='GB'?minMB/1024:minMB;const handleValueChange=newValue=>{// Convert back to MB for storage
const mbValue=unit==='GB'?Math.round(newValue*1024):newValue;onChange(mbValue);};const handleUnitChange=newUnit=>{setUnit(newUnit);// Value stays the same in MB, just display changes
};return/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs font-medium text-gray-400 mb-1"},label,needsRestart&&/*#__PURE__*/React.createElement("span",{className:"ml-2 text-[10px] px-1.5 py-0.5 bg-red-500/20 text-red-400 rounded font-medium"},t?t('needsRestart'):'NEEDS RESTART')),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"number",value:displayValue,onChange:e=>handleValueChange(parseFloat(e.target.value)||0),min:min,step:step,disabled:disabled,className:"flex-1 px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-proxmox-orange disabled:opacity-50"}),/*#__PURE__*/React.createElement("select",{value:unit,onChange:e=>handleUnitChange(e.target.value),disabled:disabled,className:"w-20 px-2 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-proxmox-orange"},/*#__PURE__*/React.createElement("option",{value:"MB"},"MB"),/*#__PURE__*/React.createElement("option",{value:"GB"},"GB"))),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},unit==='MB'?`${(value/1024).toFixed(1)} GB`:`${value} MB`));};// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PegaProx - VM Configuration
// ConfigModal, disk/network/ISO management
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VM/Container Config Modal
// LW: This is the big one - handles all VM/CT configuration
// Tabs: General, Hardware (disks/NICs), Options, Snapshots, Replication
// Sep 2025: Major refactor to support both QEMU and LXC properly
// IP Set entries sub-component for VM Firewall
function IpsetEntries({clusterId,vm,ipsetName,authFetch,onRefresh,t}){const[entries,setEntries]=useState([]);const[loading,setLoading]=useState(true);const[newCidr,setNewCidr]=useState('');useEffect(()=>{loadEntries();},[ipsetName]);const loadEntries=async()=>{setLoading(true);try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall/ipset/${ipsetName}`);if(res?.ok)setEntries(await res.json());}catch(e){}setLoading(false);};return/*#__PURE__*/React.createElement("div",{className:"p-4"},loading?/*#__PURE__*/React.createElement("div",{className:"flex justify-center py-4"},/*#__PURE__*/React.createElement("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-proxmox-orange"})):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"flex gap-2 mb-3"},/*#__PURE__*/React.createElement("input",{type:"text",value:newCidr,onChange:e=>setNewCidr(e.target.value),placeholder:"e.g. 10.0.0.0/24",className:"flex-1 bg-proxmox-dark border border-proxmox-border rounded-lg px-3 py-1.5 text-sm",onKeyDown:async e=>{if(e.key==='Enter'&&newCidr){try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall/ipset/${ipsetName}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({cidr:newCidr})});if(res?.ok){loadEntries();setNewCidr('');}}catch(e){}}}}),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!newCidr)return;try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall/ipset/${ipsetName}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({cidr:newCidr})});if(res?.ok){loadEntries();setNewCidr('');}}catch(e){}},className:"px-3 py-1.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm text-white transition-colors"},t('add'))),entries.length===0?/*#__PURE__*/React.createElement("div",{className:"text-center text-gray-500 py-4 text-sm"},"Empty set"):/*#__PURE__*/React.createElement("div",{className:"space-y-1"},entries.map((entry,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"flex justify-between items-center p-2 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("span",{className:"font-mono text-sm"},entry.cidr),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},entry.comment&&/*#__PURE__*/React.createElement("span",{className:"text-gray-500 text-xs"},entry.comment),/*#__PURE__*/React.createElement("button",{onClick:async()=>{try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall/ipset/${ipsetName}/${encodeURIComponent(entry.cidr)}`,{method:'DELETE'});if(res?.ok)loadEntries();}catch(e){}},className:"p-1 hover:bg-red-500/20 rounded text-red-400 transition-colors"},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-3.5 h-3.5"}))))))));}function ConfigModal({vm,clusterId,allClusters=[],dashboardAuthFetch,onClose,addToast}){const{t}=useTranslation();const{getAuthHeaders}=useAuth();const[config,setConfig]=useState(null);const[configError,setConfigError]=useState(null);// MK: Track config load errors
const[loading,setLoading]=useState(true);const[saving,setSaving]=useState(false);const[activeTab,setActiveTab]=useState('general');const[changes,setChanges]=useState({});const[hasChanges,setHasChanges]=useState(false);// Additional states for hardware options and lists
const[hardwareOptions,setHardwareOptions]=useState(null);const[storageList,setStorageList]=useState([]);const[bridgeList,setBridgeList]=useState([]);const[isoList,setIsoList]=useState([]);// Snapshot states
const[snapshots,setSnapshots]=useState([]);const[snapshotLoading,setSnapshotLoading]=useState(false);const[showCreateSnapshot,setShowCreateSnapshot]=useState(false);// NS: Feb 2026 - Efficient snapshot states
const[efficientSnapshots,setEfficientSnapshots]=useState([]);const[efficientInfo,setEfficientInfo]=useState(null);// Replication states
const[replications,setReplications]=useState([]);// NS: Backup states - Dec 2025
const[vmBackups,setVmBackups]=useState([]);const[backupLoading,setBackupLoading]=useState(false);const[showCreateBackup,setShowCreateBackup]=useState(false);const[showRestoreBackup,setShowRestoreBackup]=useState(null);// MK: History states - Jan 2026
const[vmProxmoxTasks,setVmProxmoxTasks]=useState([]);const[vmPegaproxActions,setVmPegaproxActions]=useState([]);const[historyLoading,setHistoryLoading]=useState(false);const[historySubTab,setHistorySubTab]=useState('proxmox');// Local authFetch helper
const authFetch=async(url,options={})=>{try{const response=await fetch(url,{...options,credentials:'include',headers:{...options.headers,...getAuthHeaders()}});return response;}catch(err){console.error('Auth fetch error:',err);return null;}};const[replicationLoading,setReplicationLoading]=useState(false);const[showCreateReplication,setShowCreateReplication]=useState(false);const[clusterNodes,setClusterNodes]=useState([]);const[allClusterNodes,setAllClusterNodes]=useState([]);const[crossClusterRepls,setCrossClusterRepls]=useState([]);// MK: cross-cluster DR jobs
const[showCreateXRepl,setShowCreateXRepl]=useState(false);const[xReplForm,setXReplForm]=useState({target_cluster:'',target_storage:'',target_bridge:'vmbr0',schedule:'0 */6 * * *',retention:3});// NS: Target cluster resources for cross-cluster replication dropdowns
const[xReplTargetStorages,setXReplTargetStorages]=useState([]);const[xReplTargetBridges,setXReplTargetBridges]=useState([]);const[xReplLoadingResources,setXReplLoadingResources]=useState(false);// Modal states for sub-dialogs
const[showAddDisk,setShowAddDisk]=useState(false);const[showAddNetwork,setShowAddNetwork]=useState(false);const[showEditNetwork,setShowEditNetwork]=useState(null);const[showMoveDisk,setShowMoveDisk]=useState(null);const[showResizeDisk,setShowResizeDisk]=useState(null);const[showEditDisk,setShowEditDisk]=useState(null);// NS: Edit disk bus type
const[showReattachDisk,setShowReattachDisk]=useState(null);// MK: Reattach unused disk modal
const[showMountISO,setShowMountISO]=useState(false);const[showImportDisk,setShowImportDisk]=useState(false);// MK: Import disk from storage
const[showReassignOwner,setShowReassignOwner]=useState(null);// MK: Reassign disk to another VM
const[importableDisks,setImportableDisks]=useState([]);// MK: List of importable disk images
// PCI/USB/Serial Passthrough states
const[passthrough,setPassthrough]=useState({pci:[],usb:[],serial:[]});const[availablePci,setAvailablePci]=useState([]);const[availableUsb,setAvailableUsb]=useState([]);const[showAddPci,setShowAddPci]=useState(false);const[showAddUsb,setShowAddUsb]=useState(false);const[showAddSerial,setShowAddSerial]=useState(false);const[showAddEfiDisk,setShowAddEfiDisk]=useState(false);// NS: EFI Disk modal
const[showAddTpm,setShowAddTpm]=useState(false);// NS: TPM modal
const[efiStorage,setEfiStorage]=useState('');// NS: Selected storage for EFI
const[tpmStorage,setTpmStorage]=useState('');// NS: Selected storage for TPM
const[selectedPciDevice,setSelectedPciDevice]=useState(null);const[selectedUsbDevice,setSelectedUsbDevice]=useState(null);const[pciOptions,setPciOptions]=useState({pcie:true,rombar:true});const[usbOptions,setUsbOptions]=useState({usb3:false});const[serialType,setSerialType]=useState('socket');const[passthroughLoading,setPassthroughLoading]=useState(false);// Firewall states
const[fwOptions,setFwOptions]=useState({});const[fwRules,setFwRules]=useState([]);const[fwAliases,setFwAliases]=useState([]);const[fwIpsets,setFwIpsets]=useState([]);const[fwLog,setFwLog]=useState([]);const[fwRefs,setFwRefs]=useState([]);const[fwLoading,setFwLoading]=useState(false);const[showAddFwRule,setShowAddFwRule]=useState(false);const[newFwRule,setNewFwRule]=useState({type:'in',action:'ACCEPT',enable:1});const[showAddFwAlias,setShowAddFwAlias]=useState(false);const[newFwAlias,setNewFwAlias]=useState({name:'',cidr:'',comment:''});const[showAddFwIpset,setShowAddFwIpset]=useState(false);const[newFwIpset,setNewFwIpset]=useState({name:'',comment:''});const[expandedIpset,setExpandedIpset]=useState(null);const[newIpsetCidr,setNewIpsetCidr]=useState('');const[fwSubTab,setFwSubTab]=useState('rules');const isQemu=vm.type==='qemu';useEffect(()=>{fetchConfig();fetchHardwareOptions();fetchStorageList();fetchBridgeList();if(isQemu){fetchISOList();fetchPassthrough();}fetchSnapshots();fetchEfficientSnapshots();fetchEfficientInfo();fetchReplications();fetchCrossClusterRepls();fetchBackups();fetchClusterNodes();// NS: Listen for SSE vm_config events for live updates
const handleVmConfigUpdate=event=>{const{vmid:eventVmid,vm_type,config:newConfig}=event.detail;// Only update if this is our VM and user has no pending changes
if(eventVmid===vm.vmid&&vm_type===vm.type&&!hasChanges&&!saving){console.log('SSE: Updating config for',vm.vmid);setConfig(prev=>({...prev,...newConfig,// Preserve some local state
disks:newConfig.disks||prev?.disks,unused_disks:newConfig.unused_disks||prev?.unused_disks,options:{...prev?.options,...newConfig.options},raw:{...prev?.raw,...newConfig.raw}}));}};window.addEventListener('pegaprox-vm-config',handleVmConfigUpdate);return()=>window.removeEventListener('pegaprox-vm-config',handleVmConfigUpdate);},[vm,clusterId,hasChanges,saving]);// MK: Auto-fetch history when history tab is selected
useEffect(()=>{if(activeTab==='history'){fetchHistory();}},[activeTab]);useEffect(()=>{if(activeTab==='firewall'){fetchFirewallData();}},[activeTab]);const fetchPassthrough=async()=>{if(vm.type!=='qemu')return;try{// Fetch current passthrough config
const ptRes=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/qemu/${vm.vmid}/passthrough`);if(ptRes&&ptRes.ok){setPassthrough(await ptRes.json());}// Fetch available PCI devices
const pciRes=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${vm.node}/hardware/pci`);if(pciRes&&pciRes.ok){setAvailablePci(await pciRes.json());}// Fetch available USB devices
const usbRes=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${vm.node}/hardware/usb`);if(usbRes&&usbRes.ok){setAvailableUsb(await usbRes.json());}}catch(error){console.error('to load passthrough:',error);}};const handleAddPciDevice=async()=>{if(!selectedPciDevice)return;setPassthroughLoading(true);try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/qemu/${vm.vmid}/passthrough/pci`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({device_id:selectedPciDevice.id,pcie:pciOptions.pcie,rombar:pciOptions.rombar})});if(response&&response.ok){setShowAddPci(false);setSelectedPciDevice(null);fetchPassthrough();addToast(t('deviceAdded'));}else{const err=await response.json();addToast(err.error||t('operationFailed'),'error');}}catch(error){addToast(t('connectionError'),'error');}setPassthroughLoading(false);};const handleAddUsbDevice=async()=>{if(!selectedUsbDevice)return;setPassthroughLoading(true);try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/qemu/${vm.vmid}/passthrough/usb`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({vendorid:selectedUsbDevice.vendid,productid:selectedUsbDevice.prodid,usb3:usbOptions.usb3})});if(response&&response.ok){setShowAddUsb(false);setSelectedUsbDevice(null);fetchPassthrough();addToast(t('deviceAdded'));}else{const err=await response.json();addToast(err.error||t('operationFailed'),'error');}}catch(error){addToast(t('connectionError'),'error');}setPassthroughLoading(false);};const handleAddSerialPort=async()=>{setPassthroughLoading(true);try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/qemu/${vm.vmid}/passthrough/serial`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({type:serialType})});if(response&&response.ok){setShowAddSerial(false);fetchPassthrough();addToast(t('deviceAdded'));}else{const err=await response.json();addToast(err.error||t('operationFailed'),'error');}}catch(error){addToast(t('connectionError'),'error');}setPassthroughLoading(false);};const handleRemovePassthrough=async(type,key)=>{if(!confirm(`${key} ${t('remove')}?`))return;setPassthroughLoading(true);try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/qemu/${vm.vmid}/passthrough/${type}/${key}`,{method:'DELETE'});if(response&&response.ok){fetchPassthrough();addToast(t('deviceRemoved'));}else{addToast(t('operationFailed'),'error');}}catch(error){addToast(t('connectionError'),'error');}setPassthroughLoading(false);};const fetchConfig=async(retryCount=0)=>{setLoading(true);try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/config`);if(response&&response.ok){const data=await response.json();setConfig(data);setConfigError(null);// LW: Clear any previous error
}else if(response){// MK: API returned error status
const errText=await response.text();setConfigError(t('configLoadError')||'Could not load configuration');console.error('Config load failed:',errText);}}catch(error){console.error('Failed to load config:',error);// LW: Retry up to 2 times with increasing delay
if(retryCount<2){setTimeout(()=>fetchConfig(retryCount+1),1000*(retryCount+1));return;}setConfigError(t('configLoadError')||'Could not load configuration');}setLoading(false);};const fetchHardwareOptions=async()=>{try{const response=await authFetch(`${API_URL}/hardware-options`);if(response&&response.ok){setHardwareOptions(await response.json());}}catch(error){console.error('to load hardware options:',error);}};const fetchStorageList=async()=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${vm.node}/storage`);if(response&&response.ok){setStorageList(await response.json());}}catch(error){console.error('to load storage list:',error);}};const fetchBridgeList=async()=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${vm.node}/networks`);if(response&&response.ok){setBridgeList(await response.json());}}catch(error){console.error('to load bridge list:',error);}};const fetchISOList=async()=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${vm.node}/isos`);if(response&&response.ok){setIsoList(await response.json());}}catch(error){console.error('to load ISO list:',error);}};const fetchSnapshots=async()=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/snapshots`);if(response&&response.ok){setSnapshots(await response.json());}}catch(error){console.error('to load snapshots:',error);}};// NS: Feb 2026 - Fetch efficient snapshots + capability
const fetchEfficientSnapshots=async()=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/efficient-snapshots?refresh=true`);if(response&&response.ok){setEfficientSnapshots(await response.json());}}catch(error){console.error('Failed to load efficient snapshots:',error);}};const fetchEfficientInfo=async()=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/snapshot-capability`);if(response&&response.ok){const data=await response.json();setEfficientInfo(data.efficient_snapshot||null);}}catch(error){// Not critical - just means efficient snapshots won't be offered
}};const fetchReplications=async()=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/replication?vmid=${vm.vmid}`);if(response&&response.ok){setReplications(await response.json());}}catch(error){console.error('to load replications:',error);}};// MK: fetch cross-cluster replication jobs for this VM
const fetchCrossClusterRepls=async()=>{try{const response=await authFetch(`${API_URL}/cross-cluster-replications?vmid=${vm.vmid}`);if(response&&response.ok){setCrossClusterRepls(await response.json());}}catch(e){console.error('cross-cluster repl fetch:',e);}};// NS: Fetch target cluster storages/bridges when target cluster changes
useEffect(()=>{if(!xReplForm.target_cluster||!dashboardAuthFetch)return;let cancelled=false;const fetchTargetResources=async()=>{setXReplLoadingResources(true);setXReplTargetStorages([]);setXReplTargetBridges([]);try{const nodesRes=await dashboardAuthFetch(`${API_URL}/clusters/${xReplForm.target_cluster}/nodes`);if(!nodesRes.ok||cancelled)return;const nodesData=await nodesRes.json();const onlineNode=(Array.isArray(nodesData)?nodesData:nodesData.nodes||[]).find(n=>n.status==='online');if(!onlineNode||cancelled)return;const nodeName=onlineNode.node||onlineNode.name;const[storRes,netRes]=await Promise.all([dashboardAuthFetch(`${API_URL}/clusters/${xReplForm.target_cluster}/nodes/${nodeName}/storage`),dashboardAuthFetch(`${API_URL}/clusters/${xReplForm.target_cluster}/nodes/${nodeName}/networks`)]);if(cancelled)return;if(storRes.ok){const storData=await storRes.json();const storages=(Array.isArray(storData)?storData:storData.storages||[]).filter(s=>s.content&&(s.content.includes('images')||s.content.includes('rootdir')));setXReplTargetStorages(storages);}if(netRes.ok){const netData=await netRes.json();const bridges=(Array.isArray(netData)?netData:netData.networks||[]).filter(n=>n.type==='bridge'||n.type==='OVSBridge'||n.source==='sdn');setXReplTargetBridges(bridges);}}catch(err){console.error('Error fetching target cluster resources:',err);}if(!cancelled)setXReplLoadingResources(false);};fetchTargetResources();return()=>{cancelled=true;};},[xReplForm.target_cluster]);// NS: Fetch backups for this VM
const fetchBackups=async()=>{setBackupLoading(true);try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/backups`);if(response&&response.ok){setVmBackups(await response.json());}}catch(error){console.error('failed to load backups:',error);}finally{setBackupLoading(false);}};// MK: Fetch VM History (Proxmox Tasks + PegaProx Audit)
const fetchHistory=async()=>{setHistoryLoading(true);try{// Fetch Proxmox tasks for this VM
const tasksRes=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${vm.node}/tasks?vmid=${vm.vmid}&limit=50`);if(tasksRes&&tasksRes.ok){setVmProxmoxTasks(await tasksRes.json());}// Fetch PegaProx audit log for this VM
const auditRes=await authFetch(`${API_URL}/clusters/${clusterId}/audit?vmid=${vm.vmid}&limit=50`);if(auditRes&&auditRes.ok){setVmPegaproxActions(await auditRes.json());}}catch(error){console.error('Failed to load history:',error);}finally{setHistoryLoading(false);}};const fetchFirewallData=async()=>{setFwLoading(true);try{const base=`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall`;const[optRes,rulesRes,aliasRes,ipsetRes,refsRes]=await Promise.all([authFetch(`${base}/options`),authFetch(`${base}/rules`),authFetch(`${base}/aliases`),authFetch(`${base}/ipset`),authFetch(`${base}/refs`)]);if(optRes?.ok)setFwOptions(await optRes.json());if(rulesRes?.ok)setFwRules(await rulesRes.json());if(aliasRes?.ok)setFwAliases(await aliasRes.json());if(ipsetRes?.ok)setFwIpsets(await ipsetRes.json());if(refsRes?.ok)setFwRefs(await refsRes.json());}catch(e){console.error('Failed to load firewall data:',e);}setFwLoading(false);};const fetchFwLog=async()=>{try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall/log`);if(res?.ok)setFwLog(await res.json());}catch(e){}};const fetchClusterNodes=async()=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/metrics`);if(response&&response.ok){const metrics=await response.json();const allNodes=Object.keys(metrics);setAllClusterNodes(allNodes);setClusterNodes(allNodes.filter(n=>n!==vm.node));}}catch(error){console.error('to load cluster nodes:',error);}};// Snapshot operations - NS: Feb 2026 enhanced with efficient mode
const handleCreateSnapshot=async(snapname,description,vmstate,modeInfo)=>{setSnapshotLoading(true);try{if(modeInfo?.mode==='efficient'){// Create efficient (LVM COW) snapshot
const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/efficient-snapshots`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({snapname,description,snap_size_gb:modeInfo.snap_size_gb})});if(response&&response.ok){const data=await response.json();const savings=data.space_savings;addToast(`${t('efficientSnapshotCreated')}: '${snapname}' (${savings?.savings_percent}% ${t('spaceSavings').toLowerCase()})`);setShowCreateSnapshot(false);await fetchEfficientSnapshots();}else if(response){const err=await response.json();addToast(err.error||t('snapshotFailed'),'error');}}else{// Standard Proxmox snapshot
const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/snapshots`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({snapname,description,vmstate})});if(response&&response.ok){addToast(`${t('snapshotCreated')||'Snapshot created'}: '${snapname}'`);setShowCreateSnapshot(false);await fetchSnapshots();}else if(response){const err=await response.json();addToast(err.error||t('snapshotFailed'),'error');}}}catch(error){addToast(t('connectionError'),'error');}setSnapshotLoading(false);};// NS: quick confirm before delete, then refresh list
const handleDeleteSnapshot=async snapname=>{if(!confirm(`${t('confirmDelete')} '${snapname}'?`))return;setSnapshotLoading(true);try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/snapshots/${snapname}`,{method:'DELETE'});if(response?.ok){addToast(t('snapshotDeleted'));await fetchSnapshots();}else if(response){const err=await response.json();addToast(err.error||t('deleteFailed'),'error');}}catch(error){addToast(t('connectionError'),'error');}setSnapshotLoading(false);};const handleRollbackSnapshot=async snapname=>{if(!confirm(`${snapname}: ${t('rollbackConfirm')}`))return;setSnapshotLoading(true);try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/snapshots/${snapname}/rollback`,{method:'POST'});if(response&&response.ok){addToast(`${t('rollbackStarted')||'Rollback started'}: '${snapname}'`);}else if(response){const err=await response.json();addToast(err.error||t('rollbackFailed'),'error');}}catch(error){addToast(t('connectionError'),'error');}setSnapshotLoading(false);};// NS: Feb 2026 - Efficient snapshot delete/rollback
const handleDeleteEfficientSnapshot=async(snapId,snapname)=>{if(!confirm(`${t('confirmDelete')} '${snapname}'?`))return;setSnapshotLoading(true);try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/efficient-snapshots/${snapId}`,{method:'DELETE'});if(response?.ok){addToast(t('efficientSnapshotDeleted'));await fetchEfficientSnapshots();}else if(response){const err=await response.json();addToast(err.error||t('deleteFailed'),'error');}}catch(error){addToast(t('connectionError'),'error');}setSnapshotLoading(false);};const handleRollbackEfficientSnapshot=async(snapId,snapname)=>{if(!confirm(`${snapname}: ${t('rollbackConfirm')}\n\n${t('vmMustBeStopped')}`))return;setSnapshotLoading(true);try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/efficient-snapshots/${snapId}/rollback`,{method:'POST'});if(response&&response.ok){addToast(t('efficientSnapshotRollback'));await fetchEfficientSnapshots();}else if(response){const err=await response.json();addToast(err.error||t('rollbackFailed'),'error');}}catch(error){addToast(t('connectionError'),'error');}setSnapshotLoading(false);};// NS: Backup operations - Dec 2025
// finally got around to implementing this, been on the TODO list forever
const handleCreateBackup=async(storage,mode,compress,notes)=>{setBackupLoading(true);try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/backups/create`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({storage,mode,compress,notes})});if(response&&response.ok){addToast(t('backupStarted')||'Backup started');setShowCreateBackup(false);// TODO: maybe auto-refresh backup list after a delay?
}else if(response){const err=await response.json();addToast(err.error||'Backup failed','error');}}catch(error){addToast(t('connectionError'),'error');}setBackupLoading(false);};const handleRestoreBackup=async(volid,targetVmid,storage,startAfter)=>{// LW: confirmation before restore - learned this the hard way lol
if(!confirm(t('confirmRestore')||`Really restore this backup? ${targetVmid===vm.vmid?'VM will be overwritten!':''}`))return;setBackupLoading(true);try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/backups/restore`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({volid,target_vmid:targetVmid,storage,start:startAfter})});if(response&&response.ok){const result=await response.json();addToast(t('restoreStarted')||`Restore started (VMID: ${result.vmid})`);setShowRestoreBackup(null);}else if(response){const err=await response.json();addToast(err.error||'Restore failed','error');}}catch(error){addToast(t('connectionError'),'error');}setBackupLoading(false);};const handleDeleteBackup=async volid=>{if(!confirm(t('confirmDeleteBackup')||'Really delete this backup?'))return;setBackupLoading(true);try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/backups/${encodeURIComponent(volid)}`,{method:'DELETE'});if(response&&response.ok){addToast(t('backupDeleted')||'Backup deleted');await fetchBackups();}else if(response){const err=await response.json();addToast(err.error||'Delete failed','error');}}catch(error){addToast(t('connectionError'),'error');}setBackupLoading(false);};// Replication operations
const handleCreateReplication=async(target,schedule,rate,comment)=>{setReplicationLoading(true);try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/replication`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({vmid:vm.vmid,target,schedule,rate,comment})});if(response&&response.ok){addToast(t('replicationCreated'),'success');setShowCreateReplication(false);await fetchReplications();}else if(response){const err=await response.json();addToast(err.error||'Creation failed','error');}}catch(error){addToast(t('connectionError'),'error');}setReplicationLoading(false);};const handleDeleteReplication=async jobId=>{if(!confirm(t('confirmDeleteReplication')||`Really delete replication job '${jobId}'?`))return;setReplicationLoading(true);try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/replication/${jobId}`,{method:'DELETE'});if(response&&response.ok){addToast(t('replicationDeleted'),'success');await fetchReplications();}else if(response){const err=await response.json();addToast(err.error||'Delete failed','error');}}catch(error){addToast(t('connectionError'),'error');}setReplicationLoading(false);};const handleRunReplicationNow=async jobId=>{setReplicationLoading(true);try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/replication/${jobId}/run`,{method:'POST'});if(response&&response.ok){addToast(t('replicationStarted'),'success');}else if(response){const err=await response.json();addToast(err.error||t('startFailed'),'error');}}catch(error){addToast(t('connectionError'),'error');}setReplicationLoading(false);};// MK: cross-cluster replication handlers
const handleCreateXRepl=async()=>{try{const response=await authFetch(`${API_URL}/cross-cluster-replications`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({source_cluster:clusterId,vmid:vm.vmid,vm_type:vm.type||'qemu',...xReplForm})});if(response&&response.ok){addToast(t('xReplCreated'),'success');setShowCreateXRepl(false);setXReplForm({target_cluster:'',target_storage:'',target_bridge:'vmbr0',schedule:'0 */6 * * *',retention:3});await fetchCrossClusterRepls();}else if(response){const err=await response.json();addToast(err.error||t('xReplCreateFailed'),'error');}}catch(error){addToast(t('connectionError'),'error');}};const handleDeleteXRepl=async jobId=>{if(!confirm(t('confirmDeleteXRepl')))return;try{const response=await authFetch(`${API_URL}/cross-cluster-replications/${jobId}`,{method:'DELETE'});if(response&&response.ok){addToast(t('xReplDeleted'),'success');await fetchCrossClusterRepls();}else if(response){const err=await response.json();addToast(err.error||t('xReplDeleteFailed'),'error');}}catch(error){addToast(t('connectionError'),'error');}};const handleRunXReplNow=async jobId=>{try{const response=await authFetch(`${API_URL}/cross-cluster-replications/${jobId}/run`,{method:'POST'});if(response&&response.ok){addToast(t('xReplStarted'),'success');}else if(response){const err=await response.json();addToast(err.error||t('xReplStartFailed'),'error');}}catch(error){addToast(t('connectionError'),'error');}};const handleChange=(section,key,value)=>{setChanges(prev=>({...prev,[key]:value}));setHasChanges(true);};const handleSave=async()=>{if(Object.keys(changes).length===0)return;setSaving(true);try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/config`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(changes)});if(response&&response.ok){addToast(t('configSaved'),'success');setChanges({});setHasChanges(false);await fetchConfig();}else{const err=await response.json();addToast(err.error||t('saveFailed'),'error');}}catch(error){addToast(t('connectionError'),'error');}setSaving(false);};// Disk operations - LW: refactored this like 3 times, finally happy with it
// NS: Just don't touch the size parsing, that took forever to get right
const handleAddDisk=async diskConfig=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/disks`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(diskConfig)});if(response&&response.ok){addToast(t('diskAdded')||'Disk added');setShowAddDisk(false);// MK: Small delay to allow Proxmox to allocate the disk
await new Promise(resolve=>setTimeout(resolve,500));await fetchConfig();}else if(response){const err=await response.json();addToast(err.error||t('error'),'error');}}catch(error){addToast(t('connectionError'),'error');}};const handleRemoveDisk=async diskId=>{if(!confirm(`${t('removeDiskConfirm')||'Really remove disk'} ${diskId}? ${t('dataWillBeDeleted')||'Data will be permanently deleted!'}`))return;try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/disks/${diskId}?delete_data=true`,{method:'DELETE'});if(response&&response.ok){addToast(t('diskDeleted')||'Disk deleted');await fetchConfig();}else if(response){const err=await response.json();addToast(err.error||t('error'),'error');}}catch(error){addToast(t('connectionError'),'error');}};// MK: Detach disk - removes from VM but keeps as unused
const handleDetachDisk=async diskId=>{if(!confirm(`${t('detachDiskConfirm')||'Really detach disk?'} ${diskId}`))return;try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/disks/${diskId}`,{method:'DELETE'});if(response&&response.ok){addToast(t('diskDetached')||'Disk detached');await fetchConfig();}else if(response){const err=await response.json();addToast(err.error||t('error'),'error');}}catch(error){addToast(t('connectionError'),'error');}};const handleResizeDisk=async(diskId,newSize)=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/resize`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({disk:diskId,size:newSize})});if(response&&response.ok){addToast(t('diskResized')||'Disk resized');setShowResizeDisk(null);await fetchConfig();}else if(response){const err=await response.json();addToast(err.error||t('error'),'error');}}catch(error){addToast(t('connectionError'),'error');}};const handleMoveDisk=async(diskId,targetStorage,deleteOriginal=true)=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/disks/${diskId}/move`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({storage:targetStorage,delete:deleteOriginal})});if(response&&response.ok){addToast(t('moveStarted')||'Move started');setShowMoveDisk(null);await fetchConfig();}else if(response){const err=await response.json();addToast(err.error||t('error'),'error');}}catch(error){addToast(t('connectionError'),'error');}};// CD-ROM operations
const handleMountISO=async(isoPath,drive='ide2')=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/qemu/${vm.vmid}/cdrom`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({iso:isoPath,drive:drive})});if(response&&response.ok){addToast(isoPath?t('isoMounted')||`ISO mounted on ${drive}`:t('isoEjected')||`${drive} ejected`);setShowMountISO(false);await fetchConfig();}else if(response){const err=await response.json();addToast(err.error||t('error'),'error');}}catch(error){addToast(t('connectionError'),'error');}};// Network operations
const handleAddNetwork=async netConfig=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/networks`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(netConfig)});if(response&&response.ok){addToast(t('vmNetworkAdded'));setShowAddNetwork(false);await fetchConfig();}else if(response){const err=await response.json();addToast(err.error||t('error'),'error');}}catch(error){addToast(t('connectionError'),'error');}};const handleUpdateNetwork=async(netId,netConfig)=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/networks/${netId}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(netConfig)});if(response&&response.ok){addToast(t('vmNetworkUpdated'));setShowEditNetwork(null);await fetchConfig();}else if(response){const err=await response.json();addToast(err.error||t('error'),'error');}}catch(error){addToast(t('connectionError'),'error');}};const handleRemoveNetwork=async netId=>{if(!confirm(`${t('removeNetworkConfirm')||'Really remove network'} ${netId}?`))return;try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/networks/${netId}`,{method:'DELETE'});if(response&&response.ok){addToast(t('vmNetworkRemoved'));await fetchConfig();}else if(response){const err=await response.json();addToast(err.error||t('error'),'error');}}catch(error){addToast(t('connectionError'),'error');}};// LW: Toggle network link_down state (simulates cable unplug)
const handleToggleNetworkLink=async(netId,currentLinkDown)=>{try{const newLinkDown=!currentLinkDown;const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/networks/${netId}/link`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({link_down:newLinkDown})});if(response&&response.ok){addToast(newLinkDown?t('networkDisconnected'):t('connectNetwork'),newLinkDown?'warning':'success');await fetchConfig();}else if(response){const err=await response.json();addToast(err.error||t('error'),'error');}}catch(error){addToast(t('connectionError'),'error');}};// Helper functions
const generateMAC=()=>{const hex='0123456789ABCDEF';let mac='02';for(let i=0;i<5;i++){mac+=':'+hex[Math.floor(Math.random()*16)]+hex[Math.floor(Math.random()*16)];}return mac;};const getNextDiskId=(busType='scsi')=>{const existing=config?.disks?.filter(d=>d.id.startsWith(busType)).map(d=>parseInt(d.id.replace(busType,'')))||[];for(let i=0;i<30;i++){if(!existing.includes(i))return`${busType}${i}`;}return`${busType}0`;};const getNextNetId=()=>{const existing=config?.networks?.map(n=>parseInt(n.id.replace('net','')))||[];for(let i=0;i<10;i++){if(!existing.includes(i))return`net${i}`;}return'net0';};const getValue=(section,key)=>{if(key in changes)return changes[key];// Try parsed section first, then raw config as fallback
const parsedValue=config?.[section]?.[key];if(parsedValue!==undefined&&parsedValue!=='')return parsedValue;// Fallback to raw config
return config?.raw?.[key]??'';};const tabs=isQemu?[{id:'general',labelKey:'generalTab',icon:Icons.Server},{id:'hardware',labelKey:'hardware',icon:Icons.Cpu},{id:'disks',labelKey:'disks',icon:Icons.HardDrive},{id:'network',labelKey:'networkTab',icon:Icons.Network},{id:'snapshots',labelKey:'snapshotsTab',icon:Icons.Clock},{id:'backups',labelKey:'backupsTab',icon:Icons.Database},{id:'replication',labelKey:'replicationTab',icon:Icons.RefreshCw},{id:'history',labelKey:'historyTab',icon:Icons.List},{id:'firewall',labelKey:'firewall',icon:Icons.Shield},{id:'options',labelKey:'optionsTab',icon:Icons.Settings}]:[{id:'general',labelKey:'generalTab',icon:Icons.Server},{id:'resources',labelKey:'resourcesTab',icon:Icons.Cpu},{id:'disks',labelKey:'storageTab',icon:Icons.HardDrive},{id:'network',labelKey:'networkTab',icon:Icons.Network},{id:'snapshots',labelKey:'snapshotsTab',icon:Icons.Clock},{id:'backups',labelKey:'backupsTab',icon:Icons.Database},{id:'replication',labelKey:'replicationTab',icon:Icons.RefreshCw},{id:'history',labelKey:'historyTab',icon:Icons.List},{id:'firewall',labelKey:'firewall',icon:Icons.Shield},{id:'options',labelKey:'optionsTab',icon:Icons.Settings}];return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop bg-black/80"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-4xl max-h-[90vh] bg-proxmox-card border border-proxmox-border rounded-2xl shadow-2xl animate-scale-in overflow-hidden flex flex-col"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between px-6 py-4 border-b border-proxmox-border bg-proxmox-dark"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:`p-2 rounded-lg ${isQemu?'bg-blue-500/10':'bg-purple-500/10'}`},isQemu?/*#__PURE__*/React.createElement(Icons.VM,null):/*#__PURE__*/React.createElement(Icons.Container,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:"font-semibold text-white"},vm.name||`${isQemu?'VM':'CT'} ${vm.vmid}`),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-400"},isQemu?'QEMU Virtual Machine':'LXC Container'," \xB7 ID ",vm.vmid," \xB7 ",vm.node))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},hasChanges&&/*#__PURE__*/React.createElement("span",{className:"text-xs text-yellow-400 bg-yellow-500/10 px-2 py-1 rounded"},t('unsavedChanges')||'Unsaved Changes'),/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"p-2 rounded-lg hover:bg-red-500/20 text-gray-400 hover:text-red-400 transition-colors"},/*#__PURE__*/React.createElement(Icons.X,null)))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1 px-6 py-3 border-b border-proxmox-border bg-proxmox-dark/50 overflow-x-auto"},tabs.map(tab=>/*#__PURE__*/React.createElement("button",{key:tab.id,onClick:()=>setActiveTab(tab.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all whitespace-nowrap ${activeTab===tab.id?'bg-proxmox-orange text-white':'text-gray-400 hover:text-white hover:bg-proxmox-hover'}`},/*#__PURE__*/React.createElement(tab.icon,null),t(tab.labelKey)))),/*#__PURE__*/React.createElement("div",{className:"flex-1 overflow-y-auto p-6"},loading?/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center h-64"},/*#__PURE__*/React.createElement("div",{className:"animate-spin w-8 h-8 border-2 border-proxmox-orange border-t-transparent rounded-full"})):configError?/*#__PURE__*//* MK: Show error when config fails to load */React.createElement("div",{className:"flex flex-col items-center justify-center h-64 text-center"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-12 h-12 text-red-400 mb-4"}),/*#__PURE__*/React.createElement("p",{className:"text-red-400 font-medium mb-2"},configError),/*#__PURE__*/React.createElement("p",{className:"text-gray-500 text-sm mb-4"},t('checkConnectionAndRetry')||'Please check your connection and try again.'),/*#__PURE__*/React.createElement("button",{onClick:()=>{setConfigError(null);fetchConfig();},className:"px-4 py-2 bg-proxmox-orange rounded-lg text-white hover:bg-orange-600 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-4 h-4"}),t('retry')||'Retry')):config?/*#__PURE__*/React.createElement(React.Fragment,null,activeTab==='general'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement(ConfigInputField,{label:isQemu?t('name'):t('hostname'),value:getValue('general',isQemu?'name':'hostname'),onChange:v=>handleChange('general',isQemu?'name':'hostname',v)}),/*#__PURE__*/React.createElement(ConfigInputField,{label:t('tags'),value:getValue('general','tags'),onChange:v=>handleChange('general','tags',v)})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs font-medium text-gray-400 mb-1"},t('description')),/*#__PURE__*/React.createElement("textarea",{value:getValue('general','description'),onChange:e=>handleChange('general','description',e.target.value),rows:3,className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-proxmox-orange resize-none"})),config.status&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-4 p-4 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},t('status')),/*#__PURE__*/React.createElement("div",{className:`font-medium ${config.status.status==='running'?'text-green-400':'text-red-400'}`},config.status.status==='running'?t('running'):t('stopped'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},t('cpuUsage')),/*#__PURE__*/React.createElement("div",{className:"font-medium text-white"},((config.status.cpu||0)*100).toFixed(1),"%")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},t('ramUsage')),/*#__PURE__*/React.createElement("div",{className:"font-medium text-white"},((config.status.mem||0)/1073741824).toFixed(1)," GB"))),config.lock?.locked&&/*#__PURE__*/React.createElement("div",{className:"p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"text-yellow-400"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-yellow-400 font-medium"},t('vmLocked')),/*#__PURE__*/React.createElement("div",{className:"text-xs text-yellow-300/70"},config.lock?.description||config.lock?.reason||'Locked'))),/*#__PURE__*/React.createElement("button",{onClick:async()=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/unlock`,{method:'POST'});if(response&&response.ok){addToast(t('vmUnlocked'),'success');fetchConfig();// Reload config
}else{const err=await response.json();addToast(err.error||t('deleteFailed'),'error');}}catch(e){addToast(t('connectionError'),'error');}},className:"px-3 py-1.5 bg-yellow-500/20 hover:bg-yellow-500/30 border border-yellow-500/30 rounded-lg text-yellow-400 text-sm font-medium transition-colors"},t('unlockVm'))),/*#__PURE__*/React.createElement("div",{className:"mt-2 text-xs text-gray-500"},"CLI: ",/*#__PURE__*/React.createElement("code",{className:"text-green-400"},config.lock?.unlock_command)))),(activeTab==='hardware'||activeTab==='resources')&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement(ConfigInputField,{label:t('cpuCores'),type:"number",value:getValue('hardware','cores'),onChange:v=>handleChange('hardware','cores',v),needsRestart:vm.status==='running'}),isQemu&&/*#__PURE__*/React.createElement(ConfigInputField,{label:t('sockets'),type:"number",value:getValue('hardware','sockets'),onChange:v=>handleChange('hardware','sockets',v),needsRestart:true}),!isQemu&&/*#__PURE__*/React.createElement(ConfigInputField,{label:t('cpuLimit'),type:"number",value:getValue('hardware','cpulimit'),onChange:v=>handleChange('hardware','cpulimit',v),suffix:t('cores')})),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement(MemoryInputField,{label:t('memory'),value:getValue('hardware','memory')||2048,onChange:v=>handleChange('hardware','memory',v),minMB:128,stepMB:128,needsRestart:vm.status==='running'}),isQemu?/*#__PURE__*/React.createElement(MemoryInputField,{label:t('ballooningMinimum'),value:getValue('hardware','balloon')||0,onChange:v=>handleChange('hardware','balloon',v),minMB:0,stepMB:128}):/*#__PURE__*/React.createElement(MemoryInputField,{label:t('swap'),value:getValue('hardware','swap')||512,onChange:v=>handleChange('hardware','swap',v),minMB:0,stepMB:64})),isQemu&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement(ConfigInputField,{label:t('cpuType'),value:getValue('hardware','cpu'),onChange:v=>handleChange('hardware','cpu',v),options:hardwareOptions?.cpu_types||['host','kvm64','qemu64'],needsRestart:true}),/*#__PURE__*/React.createElement(ConfigInputField,{label:"VGA",value:getValue('hardware','vga'),onChange:v=>handleChange('hardware','vga',v),options:[{value:'std',label:'Standard VGA'},{value:'virtio',label:'VirtIO-GPU'},{value:'virtio-gl',label:'VirtIO-GPU (virgl)'},{value:'qxl',label:'SPICE (QXL)'},{value:'vmware',label:'VMware compatible'},{value:'cirrus',label:'Cirrus Logic'},{value:'none',label:t('none')}],needsRestart:true})),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement(ConfigInputField,{label:"BIOS",value:getValue('hardware','bios'),onChange:v=>handleChange('hardware','bios',v),options:[{value:'seabios',label:'SeaBIOS (Legacy)'},{value:'ovmf',label:'OVMF (UEFI)'}],needsRestart:true}),/*#__PURE__*/React.createElement(ConfigInputField,{label:t('scsiController'),value:getValue('hardware','scsihw'),onChange:v=>handleChange('hardware','scsihw',v),options:hardwareOptions?.scsi_controllers||[{value:'virtio-scsi-pci',label:'VirtIO SCSI'},{value:'virtio-scsi-single',label:'VirtIO SCSI Single'},{value:'lsi',label:'LSI 53C895A'}],needsRestart:true})),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement(ConfigInputField,{label:t('machineType'),value:getValue('hardware','machine'),onChange:v=>handleChange('hardware','machine',v),options:hardwareOptions?.machine_types||[{value:'',label:t('default')},// q35 versions
{value:'q35',label:'q35 (Latest)'},{value:'pc-q35-10.1',label:'q35 10.1'},{value:'pc-q35-10.0+pve1',label:'q35 10.0+pve1'},{value:'pc-q35-10.0',label:'q35 10.0'},{value:'pc-q35-9.2+pve1',label:'q35 9.2+pve1'},{value:'pc-q35-9.2',label:'q35 9.2'},{value:'pc-q35-9.1',label:'q35 9.1'},{value:'pc-q35-9.0',label:'q35 9.0'},{value:'pc-q35-8.2',label:'q35 8.2'},{value:'pc-q35-8.1',label:'q35 8.1'},{value:'pc-q35-8.0',label:'q35 8.0'},{value:'pc-q35-7.2',label:'q35 7.2'},{value:'pc-q35-7.1',label:'q35 7.1'},{value:'pc-q35-7.0',label:'q35 7.0'},{value:'pc-q35-6.2',label:'q35 6.2'},{value:'pc-q35-6.1',label:'q35 6.1'},{value:'pc-q35-6.0',label:'q35 6.0'},{value:'pc-q35-5.2',label:'q35 5.2'},{value:'pc-q35-5.1',label:'q35 5.1'},{value:'pc-q35-5.0',label:'q35 5.0'},{value:'pc-q35-4.2',label:'q35 4.2'},{value:'pc-q35-4.1',label:'q35 4.1'},{value:'pc-q35-4.0',label:'q35 4.0'},{value:'pc-q35-3.1',label:'q35 3.1'},{value:'pc-q35-3.0',label:'q35 3.0'},{value:'pc-q35-2.12',label:'q35 2.12'},{value:'pc-q35-2.11',label:'q35 2.11'},{value:'pc-q35-2.10',label:'q35 2.10'},// i440fx versions
{value:'i440fx',label:'i440fx (Latest)'},{value:'pc-i440fx-10.1',label:'i440fx 10.1'},{value:'pc-i440fx-10.0+pve1',label:'i440fx 10.0+pve1'},{value:'pc-i440fx-10.0',label:'i440fx 10.0'},{value:'pc-i440fx-9.2+pve1',label:'i440fx 9.2+pve1'},{value:'pc-i440fx-9.2',label:'i440fx 9.2'},{value:'pc-i440fx-9.1',label:'i440fx 9.1'},{value:'pc-i440fx-9.0',label:'i440fx 9.0'},{value:'pc-i440fx-8.2',label:'i440fx 8.2'},{value:'pc-i440fx-8.1',label:'i440fx 8.1'},{value:'pc-i440fx-8.0',label:'i440fx 8.0'},{value:'pc-i440fx-7.2',label:'i440fx 7.2'},{value:'pc-i440fx-7.1',label:'i440fx 7.1'},{value:'pc-i440fx-7.0',label:'i440fx 7.0'},{value:'pc-i440fx-6.2',label:'i440fx 6.2'},{value:'pc-i440fx-6.1',label:'i440fx 6.1'},{value:'pc-i440fx-6.0',label:'i440fx 6.0'},{value:'pc-i440fx-5.2',label:'i440fx 5.2'},{value:'pc-i440fx-5.1',label:'i440fx 5.1'},{value:'pc-i440fx-5.0',label:'i440fx 5.0'},{value:'pc-i440fx-4.2',label:'i440fx 4.2'},{value:'pc-i440fx-4.1',label:'i440fx 4.1'},{value:'pc-i440fx-4.0',label:'i440fx 4.0'},{value:'pc-i440fx-3.1',label:'i440fx 3.1'},{value:'pc-i440fx-3.0',label:'i440fx 3.0'},{value:'pc-i440fx-2.12',label:'i440fx 2.12'},{value:'pc-i440fx-2.11',label:'i440fx 2.11'},{value:'pc-i440fx-2.10',label:'i440fx 2.10'}],needsRestart:true}),/*#__PURE__*/React.createElement(ConfigInputField,{label:"vIOMMU",value:getValue('hardware','machine')?.includes('viommu=')?getValue('hardware','machine').split('viommu=')[1]?.split(',')[0]:'',onChange:v=>{const currentMachine=getValue('hardware','machine')||'';const baseMachine=currentMachine.split(',')[0];if(v&&v!=='none'){handleChange('hardware','machine',`${baseMachine},viommu=${v}`);}else{handleChange('hardware','machine',baseMachine);}},options:[{value:'',label:t('default')+' (None)'},{value:'intel',label:'Intel (VT-d)'},{value:'virtio',label:'VirtIO'}],needsRestart:true})),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4 pt-2"},/*#__PURE__*/React.createElement(ConfigCheckboxField,{label:t('enableNuma'),checked:getValue('hardware','numa')==1,onChange:v=>handleChange('hardware','numa',v),needsRestart:true,t:t})),/*#__PURE__*/React.createElement("div",null)),getValue('hardware','bios')==='ovmf'&&/*#__PURE__*/React.createElement("div",{className:"mt-6 pt-6 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"text-white font-medium mb-4 flex items-center gap-2"},"\uD83D\uDD10 ",t('efiTpmSettings')||'EFI & TPM Settings',vm.status==='running'&&/*#__PURE__*/React.createElement("span",{className:"text-xs text-yellow-400 bg-yellow-500/10 px-2 py-0.5 rounded"},t('changesAfterRestart'))),/*#__PURE__*/React.createElement("div",{className:"mb-4"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center mb-2"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-400"},t('efiDisk')||'EFI Disk')),config?.raw?.efidisk0?/*#__PURE__*/React.createElement("div",{className:"p-3 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.HardDrive,{className:"w-4 h-4 text-blue-400"}),/*#__PURE__*/React.createElement("span",{className:"text-sm font-mono text-gray-300"},config.raw.efidisk0)),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:"text-xs text-green-400 bg-green-500/10 px-2 py-0.5 rounded"},t('configured')||'Configured'),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!confirm(t('confirmDeleteEfiDisk')||'Delete EFI disk? This may prevent the VM from booting.'))return;try{const res=await fetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/config`,{method:'PUT',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({delete:'efidisk0'})});if(res.ok){addToast(t('efiDiskDeleted')||'EFI disk deleted','success');fetchConfig();}else{const err=await res.json();addToast(err.error||'Error deleting EFI disk','error');}}catch(e){addToast('Error deleting EFI disk','error');}},className:"text-xs px-2 py-1 text-red-400 hover:bg-red-500/20 rounded",title:t('delete')},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-3.5 h-3.5"}))))):/*#__PURE__*/React.createElement("div",{className:"p-3 bg-proxmox-dark rounded-lg border border-dashed border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-500"},t('noEfiDisk')||'No EFI disk configured'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddEfiDisk(true),className:"text-xs px-3 py-1.5 bg-blue-500/20 text-blue-400 rounded hover:bg-blue-500/30 flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.Plus,{className:"w-3 h-3"}),t('addEfiDisk')||'Add EFI Disk')),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-600 mt-2"},t('efiDiskRequired')||'Required for UEFI boot. Will be created automatically on first boot if not configured.'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center mb-2"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-400"},t('tpmChip')||'TPM Chip')),config?.raw?.tpmstate0?/*#__PURE__*/React.createElement("div",{className:"p-3 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Shield,{className:"w-4 h-4 text-green-400"}),/*#__PURE__*/React.createElement("span",{className:"text-sm font-mono text-gray-300"},config.raw.tpmstate0)),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:"text-xs text-green-400 bg-green-500/10 px-2 py-0.5 rounded"},"TPM 2.0"),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!confirm(t('confirmDeleteTpm')||'Delete TPM? Windows 11 and BitLocker will stop working.'))return;try{const res=await fetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/config`,{method:'PUT',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({delete:'tpmstate0'})});if(res.ok){addToast(t('tpmDeleted')||'TPM deleted','success');fetchConfig();}else{const err=await res.json();addToast(err.error||'Error deleting TPM','error');}}catch(e){addToast('Error deleting TPM','error');}},className:"text-xs px-2 py-1 text-red-400 hover:bg-red-500/20 rounded",title:t('delete')},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-3.5 h-3.5"}))))):/*#__PURE__*/React.createElement("div",{className:"p-3 bg-proxmox-dark rounded-lg border border-dashed border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-500"},t('noTpm')||'No TPM configured'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddTpm(true),className:"text-xs px-3 py-1.5 bg-green-500/20 text-green-400 rounded hover:bg-green-500/30 flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.Plus,{className:"w-3 h-3"}),t('addTpm')||'Add TPM')),/*#__PURE__*/React.createElement("p",{className:"text-xs text-yellow-500 mt-2 flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-3 h-3"}),t('win11NeedsTpm')||'Windows 11 requires TPM 2.0')))),/*#__PURE__*/React.createElement("div",{className:"mt-6 pt-6 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"text-white font-medium mb-4 flex items-center gap-2"},"\uD83D\uDD0C ",t('devicePassthrough'),vm.status==='running'&&/*#__PURE__*/React.createElement("span",{className:"text-xs text-yellow-400 bg-yellow-500/10 px-2 py-0.5 rounded"},t('changesAfterRestart'))),/*#__PURE__*/React.createElement("div",{className:"mb-4"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center mb-2"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-400"},t('pciDevices')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddPci(true),className:"text-xs px-2 py-1 bg-proxmox-orange/20 text-proxmox-orange rounded hover:bg-proxmox-orange/30"},"+ ",t('addPci'))),passthrough.pci?.length>0?/*#__PURE__*/React.createElement("div",{className:"space-y-1"},passthrough.pci.map((dev,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"flex items-center justify-between p-2 bg-proxmox-dark rounded text-sm"},/*#__PURE__*/React.createElement("span",{className:"font-mono text-gray-300"},dev.key,": ",dev.value),/*#__PURE__*/React.createElement("button",{onClick:()=>handleRemovePassthrough('pci',dev.key),className:"text-red-400 hover:text-red-300 p-1"},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-3 h-3"}))))):/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 italic"},t('noPciDevices'))),/*#__PURE__*/React.createElement("div",{className:"mb-4"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center mb-2"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-400"},t('usbDevices')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddUsb(true),className:"text-xs px-2 py-1 bg-proxmox-orange/20 text-proxmox-orange rounded hover:bg-proxmox-orange/30"},"+ ",t('addUsb'))),passthrough.usb?.length>0?/*#__PURE__*/React.createElement("div",{className:"space-y-1"},passthrough.usb.map((dev,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"flex items-center justify-between p-2 bg-proxmox-dark rounded text-sm"},/*#__PURE__*/React.createElement("span",{className:"font-mono text-gray-300"},dev.key,": ",dev.value),/*#__PURE__*/React.createElement("button",{onClick:()=>handleRemovePassthrough('usb',dev.key),className:"text-red-400 hover:text-red-300 p-1"},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-3 h-3"}))))):/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 italic"},t('noUsbDevices'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center mb-2"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-400"},t('serialPorts')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddSerial(true),className:"text-xs px-2 py-1 bg-proxmox-orange/20 text-proxmox-orange rounded hover:bg-proxmox-orange/30"},"+ ",t('addSerial'))),passthrough.serial?.length>0?/*#__PURE__*/React.createElement("div",{className:"space-y-1"},passthrough.serial.map((dev,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"flex items-center justify-between p-2 bg-proxmox-dark rounded text-sm"},/*#__PURE__*/React.createElement("span",{className:"font-mono text-gray-300"},dev.key,": ",dev.value),/*#__PURE__*/React.createElement("button",{onClick:()=>handleRemovePassthrough('serial',dev.key),className:"text-red-400 hover:text-red-300 p-1"},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-3 h-3"}))))):/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 italic"},t('noSerialPorts')))))),activeTab==='disks'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-medium text-white"},t('disks')),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},isQemu&&/*#__PURE__*/React.createElement("button",{onClick:()=>setShowMountISO(true),className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-sm text-gray-300 hover:text-white hover:border-proxmox-orange transition-colors"},/*#__PURE__*/React.createElement(Icons.Play,null),t('mountIso')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddDisk(true),className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-orange rounded-lg text-sm text-white hover:bg-orange-600 transition-colors"},/*#__PURE__*/React.createElement(Icons.Plus,null),t('addDisk')),isQemu&&/*#__PURE__*/React.createElement("button",{onClick:()=>setShowImportDisk(true),className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-sm text-gray-300 hover:text-white hover:border-proxmox-orange transition-colors"},/*#__PURE__*/React.createElement(Icons.Download,null),t('importDisk')||'Import Disk'))),config.disks?.length>0?config.disks.map(disk=>/*#__PURE__*/React.createElement("div",{key:disk.id,className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement(Icons.HardDrive,null),/*#__PURE__*/React.createElement("span",{className:"font-medium text-white"},disk.id),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 bg-proxmox-card px-2 py-0.5 rounded"},disk.storage)),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-proxmox-orange font-mono mr-2"},disk.size),isQemu&&disk.id!=='rootfs'&&!disk.id.includes('efidisk')&&!disk.id.includes('tpmstate')&&/*#__PURE__*/React.createElement("button",{onClick:()=>setShowEditDisk(disk),className:"p-1.5 rounded hover:bg-proxmox-hover text-gray-400 hover:text-yellow-400 transition-colors",title:t('editDiskType')||'Change Bus Type'},/*#__PURE__*/React.createElement(Icons.Edit,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowResizeDisk(disk),className:"p-1.5 rounded hover:bg-proxmox-hover text-gray-400 hover:text-green-400 transition-colors",title:t('resize')},/*#__PURE__*/React.createElement(Icons.Plus,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowMoveDisk(disk),className:"p-1.5 rounded hover:bg-proxmox-hover text-gray-400 hover:text-blue-400 transition-colors",title:t('move')},/*#__PURE__*/React.createElement(Icons.ArrowRight,null)),disk.id!=='rootfs'&&!disk.id.includes('efidisk')&&!disk.id.includes('tpmstate')&&/*#__PURE__*/React.createElement(React.Fragment,null,isQemu&&!disk.volume?.includes('iso')&&!disk.media?.includes('cdrom')&&!String(disk.value||'').includes('media=cdrom')&&/*#__PURE__*/React.createElement("button",{onClick:()=>setShowReassignOwner(disk),className:"p-1.5 rounded hover:bg-proxmox-hover text-gray-400 hover:text-purple-400 transition-colors",title:t('reassignOwner')||'Reassign Owner'},/*#__PURE__*/React.createElement(Icons.Users,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>handleDetachDisk(disk.id),className:"p-1.5 rounded hover:bg-proxmox-hover text-gray-400 hover:text-yellow-400 transition-colors",title:t('detachDisk')||'Detach'},/*#__PURE__*/React.createElement(Icons.Unplug,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>handleRemoveDisk(disk.id),className:"p-1.5 rounded hover:bg-proxmox-hover text-gray-400 hover:text-red-400 transition-colors",title:t('remove')},/*#__PURE__*/React.createElement(Icons.Trash,null))))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-4 gap-4 text-sm"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Volume:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-gray-300 font-mono text-xs"},disk.volume)),disk.cache&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Cache:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-gray-300"},disk.cache)),disk.iothread?/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-green-400"},"IOthread")):null,disk.ssd?/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-blue-400"},"SSD")):null,disk.mountpoint&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Mount:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-gray-300"},disk.mountpoint))))):/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},t('noDisksConfigured')),config.unused_disks?.length>0&&/*#__PURE__*/React.createElement("div",{className:"mt-6 pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 mb-3"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4 text-yellow-500"}),/*#__PURE__*/React.createElement("h4",{className:"font-medium text-yellow-400"},t('unusedDisks')||'Unused Disks'),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},"(",config.unused_disks.length,")")),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mb-3"},t('unusedDisksDesc')||'These disks are detached but still exist. You can reattach or delete them.'),config.unused_disks.map(disk=>/*#__PURE__*/React.createElement("div",{key:disk.id,className:"p-3 bg-yellow-500/5 rounded-lg border border-yellow-500/30 mb-2"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement(Icons.HardDrive,{className:"text-yellow-500"}),/*#__PURE__*/React.createElement("span",{className:"font-medium text-yellow-400"},disk.id),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-400 font-mono"},disk.value)),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowReattachDisk(disk),className:"px-2 py-1 text-xs bg-green-600/20 text-green-400 rounded hover:bg-green-600/30 transition-colors",title:t('reattachDisk')||'Reattach disk'},t('reattach')||'Reattach'),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!confirm(t('deleteUnusedDiskConfirm')||`Permanently delete ${disk.id}? This cannot be undone!`))return;try{// First delete the unused reference, then purge the actual volume
const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/config`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({delete:disk.id})});if(res&&res.ok){addToast(t('unusedDiskDeleted')||'Unused disk deleted','success');fetchConfig();}else{const err=await res.json();addToast(err.error||'Error deleting disk','error');}}catch(e){addToast('Error deleting disk','error');}},className:"px-2 py-1 text-xs bg-red-600/20 text-red-400 rounded hover:bg-red-600/30 transition-colors",title:t('deletePermanently')||'Delete permanently'},t('delete')))))))),activeTab==='network'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-medium text-white"},t('networkInterfaces')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddNetwork(true),className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-orange rounded-lg text-sm text-white hover:bg-orange-600 transition-colors"},/*#__PURE__*/React.createElement(Icons.Plus,null),t('addNetwork'))),config.networks?.length>0?config.networks.map(net=>/*#__PURE__*/React.createElement("div",{key:net.id,className:`p-4 bg-proxmox-dark rounded-lg border ${net.link_down?'border-red-500/50':'border-proxmox-border'}`},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement(Icons.Network,{className:net.link_down?'text-red-400':''}),/*#__PURE__*/React.createElement("span",{className:"font-medium text-white"},net.id),net.bridge&&(()=>{const bridgeInfo=bridgeList.find(b=>b.iface===net.bridge);const isSDN=bridgeInfo?.source==='sdn';// Check if it looks like an SDN VNet name (no vmbr prefix)
const looksLikeSDN=!bridgeInfo&&net.bridge&&!net.bridge.startsWith('vmbr');return/*#__PURE__*/React.createElement("span",{className:`text-xs px-2 py-0.5 rounded ${isSDN?'text-purple-400 bg-purple-500/10':looksLikeSDN?'text-purple-400 bg-purple-500/10':'text-gray-500 bg-proxmox-card'}`,title:bridgeInfo?.comments||(isSDN?`SDN Zone: ${bridgeInfo?.zone}`:looksLikeSDN?'Possible SDN VNet':'')},(isSDN||looksLikeSDN)&&/*#__PURE__*/React.createElement("span",{className:"mr-1"},"\uD83C\uDF10"),net.bridge,bridgeInfo?.zone?` (${bridgeInfo.zone})`:bridgeInfo?.comments?` (${bridgeInfo.comments})`:'',looksLikeSDN&&!bridgeInfo&&' (SDN?)');})(),net.link_down&&/*#__PURE__*/React.createElement("span",{className:"text-xs text-red-400 bg-red-500/10 px-2 py-0.5 rounded flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.WifiOff,{className:"w-3 h-3"}),t('networkDisconnected'))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},net.firewall?/*#__PURE__*/React.createElement("span",{className:"text-xs text-green-400 bg-green-500/10 px-2 py-0.5 rounded"},"Firewall"):null,isQemu&&/*#__PURE__*/React.createElement("button",{onClick:()=>handleToggleNetworkLink(net.id,net.link_down),className:`p-1.5 rounded hover:bg-proxmox-hover transition-colors ${net.link_down?'text-red-400 hover:text-green-400':'text-gray-400 hover:text-red-400'}`,title:net.link_down?t('connectNetwork'):t('disconnectNetwork')},net.link_down?/*#__PURE__*/React.createElement(Icons.Plug,null):/*#__PURE__*/React.createElement(Icons.Unplug,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowEditNetwork(net),className:"p-1.5 rounded hover:bg-proxmox-hover text-gray-400 hover:text-blue-400 transition-colors",title:t('edit')},/*#__PURE__*/React.createElement(Icons.Cog,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>handleRemoveNetwork(net.id),className:"p-1.5 rounded hover:bg-proxmox-hover text-gray-400 hover:text-red-400 transition-colors",title:t('remove')},/*#__PURE__*/React.createElement(Icons.Trash,null)))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-4 text-sm"},isQemu?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Model:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-gray-300"},net.model||'virtio')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"MAC:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-gray-300 font-mono text-xs"},net.macaddr||'auto')),net.queues&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Queues:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-gray-300"},net.queues))):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},t('name'),":"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-gray-300"},net.name||'eth0')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"IP:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-gray-300 font-mono"},net.ip||'dhcp')),net.gw&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Gateway:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-gray-300 font-mono"},net.gw))),net.tag&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"VLAN:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-gray-300"},net.tag)),net.rate&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Rate:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-gray-300"},net.rate," MB/s")),net.mtu&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"MTU:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-gray-300"},net.mtu))))):/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},t('noNetworksConfigured'))),activeTab==='snapshots'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-300"},"Snapshots"),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowCreateSnapshot(true),className:"flex items-center gap-2 px-3 py-1.5 bg-green-600 rounded-lg text-white text-sm hover:bg-green-700"},/*#__PURE__*/React.createElement(Icons.Plus,null),t('createSnapshot'))),snapshots.length>0?/*#__PURE__*/React.createElement("div",{className:"space-y-3"},snapshots.map(snap=>/*#__PURE__*/React.createElement("div",{key:snap.name,className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-2 bg-blue-500/10 rounded-lg"},/*#__PURE__*/React.createElement(Icons.Clock,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"font-medium text-white"},snap.name),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-400"},snap.snaptime?new Date(snap.snaptime*1000).toLocaleString():t('unknown'),snap.vmstate&&/*#__PURE__*/React.createElement("span",{className:"ml-2 text-blue-400"},"+ RAM")),snap.description&&/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-500 mt-1"},snap.description))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>handleRollbackSnapshot(snap.name),disabled:snapshotLoading,className:"p-2 rounded-lg bg-yellow-500/10 hover:bg-yellow-500/20 text-yellow-400 transition-colors disabled:opacity-50",title:t('rollback')},/*#__PURE__*/React.createElement(Icons.RotateCcw,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>handleDeleteSnapshot(snap.name),disabled:snapshotLoading,className:"p-2 rounded-lg bg-red-500/10 hover:bg-red-500/20 text-red-400 transition-colors disabled:opacity-50",title:t('delete')},/*#__PURE__*/React.createElement(Icons.Trash,null))))))):/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},/*#__PURE__*/React.createElement(Icons.Clock,null),/*#__PURE__*/React.createElement("p",{className:"mt-2"},t('noSnapshots'))),efficientSnapshots.length>0&&/*#__PURE__*/React.createElement("div",{className:"mt-6"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 mb-3"},/*#__PURE__*/React.createElement(Icons.Zap,{className:"text-green-400"}),/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-green-400"},t('spaceEfficientSnapshots')),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},"(",t('managedByPegaprox'),")")),/*#__PURE__*/React.createElement("div",{className:"space-y-3"},efficientSnapshots.map(snap=>{const isInvalidated=snap.status==='invalidated';return/*#__PURE__*/React.createElement("div",{key:snap.id,className:`p-4 rounded-lg border ${isInvalidated?'bg-gray-800/50 border-gray-700':'bg-proxmox-dark border-green-500/30'}`},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-2"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:`p-2 rounded-lg ${isInvalidated?'bg-gray-500/10':'bg-green-500/10'}`},/*#__PURE__*/React.createElement(Icons.Zap,{className:isInvalidated?'text-gray-500':''})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:`font-medium ${isInvalidated?'text-gray-500 line-through':'text-white'}`},snap.snapname),/*#__PURE__*/React.createElement("span",{className:"px-1.5 py-0.5 text-xs rounded bg-green-500/20 text-green-400"},t('cowSnapshot')),snap.fs_frozen&&/*#__PURE__*/React.createElement("span",{className:"px-1.5 py-0.5 text-xs rounded bg-blue-500/20 text-blue-400"},t('fsFrozen'))),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-400 mt-0.5"},snap.created_at?new Date(snap.created_at).toLocaleString():'',/*#__PURE__*/React.createElement("span",{className:"ml-2 text-gray-500"},snap.total_snap_alloc_gb?.toFixed(1)," GB / ",snap.total_disk_size_gb?.toFixed(1)," GB")),snap.description&&/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-500 mt-1"},snap.description),isInvalidated&&/*#__PURE__*/React.createElement("div",{className:"text-xs text-red-400 mt-1"},t('snapshotInvalidated')))),!isInvalidated&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>handleRollbackEfficientSnapshot(snap.id,snap.snapname),disabled:snapshotLoading,className:"p-2 rounded-lg bg-yellow-500/10 hover:bg-yellow-500/20 text-yellow-400 transition-colors disabled:opacity-50",title:t('rollback')},/*#__PURE__*/React.createElement(Icons.RotateCcw,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>handleDeleteEfficientSnapshot(snap.id,snap.snapname),disabled:snapshotLoading,className:"p-2 rounded-lg bg-red-500/10 hover:bg-red-500/20 text-red-400 transition-colors disabled:opacity-50",title:t('delete')},/*#__PURE__*/React.createElement(Icons.Trash,null))),isInvalidated&&/*#__PURE__*/React.createElement("button",{onClick:()=>handleDeleteEfficientSnapshot(snap.id,snap.snapname),disabled:snapshotLoading,className:"p-2 rounded-lg bg-red-500/10 hover:bg-red-500/20 text-red-400 transition-colors disabled:opacity-50",title:t('delete')},/*#__PURE__*/React.createElement(Icons.Trash,null))),!isInvalidated&&snap.disks?.length>0&&/*#__PURE__*/React.createElement("div",{className:"mt-2 space-y-1.5"},snap.disks.map(disk=>{const pct=disk.snap_used_percent||0;const barColor=pct>=80?pct>=95?'bg-red-500':'bg-yellow-500':'bg-green-500';return/*#__PURE__*/React.createElement("div",{key:disk.disk_key,className:"text-xs"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-gray-400 mb-0.5"},/*#__PURE__*/React.createElement("span",null,disk.disk_key," (",disk.original_lv,")"),/*#__PURE__*/React.createElement("span",{className:pct>=80?pct>=95?'text-red-400':'text-yellow-400':'text-gray-400'},pct.toFixed(1),"% ",t('snapshotUsage'),pct>=80&&' âš ')),/*#__PURE__*/React.createElement("div",{className:"w-full h-2 bg-gray-700 rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:`h-full ${barColor} rounded-full transition-all`,style:{width:`${Math.min(100,pct)}%`}})));}),snap.disks.some(d=>(d.snap_used_percent||0)>=80)&&/*#__PURE__*/React.createElement("div",{className:"text-xs text-yellow-400 flex items-center gap-1 mt-1"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,null),t('snapshotOverflow'))));}))),showCreateSnapshot&&/*#__PURE__*/React.createElement(CreateSnapshotModal,{isQemu:isQemu,onSubmit:handleCreateSnapshot,onClose:()=>setShowCreateSnapshot(false),loading:snapshotLoading,efficientInfo:efficientInfo})),activeTab==='backups'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-300"},t('backupsTab')||'Backups'),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:fetchBackups,disabled:backupLoading,className:"p-2 hover:bg-proxmox-hover rounded-lg text-gray-400",title:t('refresh')},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:backupLoading?'animate-spin':''})),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowCreateBackup(true),className:"flex items-center gap-2 px-3 py-1.5 bg-green-600 rounded-lg text-white text-sm hover:bg-green-700"},/*#__PURE__*/React.createElement(Icons.Plus,null),t('createBackup')||'Create Backup'))),backupLoading?/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center py-8"},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"animate-spin text-gray-400"})):vmBackups.length>0?/*#__PURE__*/React.createElement("div",{className:"space-y-3"},vmBackups.map(backup=>/*#__PURE__*/React.createElement("div",{key:backup.volid,className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-2 bg-purple-500/10 rounded-lg"},/*#__PURE__*/React.createElement(Icons.Database,{className:"text-purple-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"font-medium text-white"},backup.filename),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-400"},backup.ctime?new Date(backup.ctime*1000).toLocaleString():'',/*#__PURE__*/React.createElement("span",{className:"mx-2"},"\u2022"),(backup.size/(1024*1024*1024)).toFixed(2)," GB",/*#__PURE__*/React.createElement("span",{className:"mx-2"},"\u2022"),/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},backup.storage)),backup.notes&&/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-500 mt-1"},backup.notes))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowRestoreBackup(backup),disabled:backupLoading,className:"p-2 rounded-lg bg-blue-500/10 hover:bg-blue-500/20 text-blue-400 transition-colors disabled:opacity-50",title:t('restore')||'Restore'},/*#__PURE__*/React.createElement(Icons.RotateCcw,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>handleDeleteBackup(backup.volid),disabled:backupLoading,className:"p-2 rounded-lg bg-red-500/10 hover:bg-red-500/20 text-red-400 transition-colors disabled:opacity-50",title:t('delete')},/*#__PURE__*/React.createElement(Icons.Trash,null))))))):/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},/*#__PURE__*/React.createElement(Icons.Database,{className:"mx-auto opacity-50"}),/*#__PURE__*/React.createElement("p",{className:"mt-2"},t('noBackups')||'No backups found'),/*#__PURE__*/React.createElement("p",{className:"text-xs mt-1"},t('noBackupsHint')||'Create a backup or check your backup storages')),showCreateBackup&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-6 w-full max-w-md"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-4"},t('createBackup')||'Create Backup'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('storage')||'Storage'),/*#__PURE__*/React.createElement("select",{id:"backup-storage",defaultValue:"local",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},storageList.filter(s=>s.content?.includes('backup')).map(s=>/*#__PURE__*/React.createElement("option",{key:s.storage,value:s.storage},s.storage)),!storageList.some(s=>s.content?.includes('backup'))&&/*#__PURE__*/React.createElement("option",{value:"local"},"local"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('backupMode')||'Mode'),/*#__PURE__*/React.createElement("select",{id:"backup-mode",defaultValue:"snapshot",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:"snapshot"},t('backupModeSnapshot')||'Snapshot (no stop)'),/*#__PURE__*/React.createElement("option",{value:"suspend"},t('backupModeSuspend')||'Suspend (brief pause)'),/*#__PURE__*/React.createElement("option",{value:"stop"},t('backupModeStop')||'Stop (VM will stop)'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('compression')||'Compression'),/*#__PURE__*/React.createElement("select",{id:"backup-compress",defaultValue:"zstd",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:"zstd"},t('compressZstd')||'ZSTD (recommended)'),/*#__PURE__*/React.createElement("option",{value:"lzo"},t('compressLzo')||'LZO (fast)'),/*#__PURE__*/React.createElement("option",{value:"gzip"},t('compressGzip')||'GZIP'),/*#__PURE__*/React.createElement("option",{value:"0"},t('compressNone')||'None'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('backupNotes')||'Notes (optional)'),/*#__PURE__*/React.createElement("textarea",{id:"backup-notes",placeholder:t('backupNotesPlaceholder')||'e.g. Before major update, weekly backup...',className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white resize-none",rows:2})),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end pt-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowCreateBackup(false),className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover rounded-lg"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:()=>{const storage=document.getElementById('backup-storage').value;const mode=document.getElementById('backup-mode').value;const compress=document.getElementById('backup-compress').value;const notes=document.getElementById('backup-notes').value;handleCreateBackup(storage,mode,compress,notes);},disabled:backupLoading,className:"px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg disabled:opacity-50"},backupLoading?t('loading'):t('create')||'Create'))))),showRestoreBackup&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-6 w-full max-w-md"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-4"},t('restoreBackup')||'Restore Backup'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"p-3 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},t('selectedBackup')||'Selected Backup',":"),/*#__PURE__*/React.createElement("p",{className:"font-mono text-sm truncate"},showRestoreBackup.filename)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('targetVmid')||'Target VMID'),/*#__PURE__*/React.createElement("input",{type:"number",id:"restore-vmid",defaultValue:vm.vmid,className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-yellow-400 mt-1"},t('sameVmidWarning')||'Same VMID = VM will be overwritten!')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('targetStorage')||'Target Storage (optional)'),/*#__PURE__*/React.createElement("select",{id:"restore-storage",defaultValue:"",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:""},t('originalStorage')||'Keep original'),storageList.filter(s=>s.content?.includes('images')).map(s=>/*#__PURE__*/React.createElement("option",{key:s.storage,value:s.storage},s.storage)))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("input",{type:"checkbox",id:"restore-start",className:"w-4 h-4 rounded"}),/*#__PURE__*/React.createElement("label",{htmlFor:"restore-start",className:"text-sm text-gray-300"},t('startAfterRestore')||'Start after restore')),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end pt-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowRestoreBackup(null),className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover rounded-lg"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:()=>{const targetVmid=parseInt(document.getElementById('restore-vmid').value);const storage=document.getElementById('restore-storage').value;const startAfter=document.getElementById('restore-start').checked;handleRestoreBackup(showRestoreBackup.volid,targetVmid,storage,startAfter);},disabled:backupLoading,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg disabled:opacity-50"},backupLoading?t('loading'):t('restore')||'Restore')))))),activeTab==='replication'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-300"},t('replicationJobs')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowCreateReplication(true),disabled:allClusterNodes.length<2,className:"flex items-center gap-2 px-3 py-1.5 bg-green-600 rounded-lg text-white text-sm hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"},/*#__PURE__*/React.createElement(Icons.Plus,null),t('createReplication'))),allClusterNodes.length<2&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg text-sm text-yellow-400"},"\u26A0\uFE0F ",t('replicationNeedsTwoNodes')),replications.length>0?/*#__PURE__*/React.createElement("div",{className:"space-y-3"},replications.map(job=>/*#__PURE__*/React.createElement("div",{key:job.id,className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:`p-2 rounded-lg ${job.error?'bg-red-500/10':'bg-green-500/10'}`},/*#__PURE__*/React.createElement(Icons.RefreshCw,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"font-medium text-white"},"\u2191 ",job.target),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-400"},"Schedule: ",job.schedule||'*/15'," |",job.last_sync?` ${t('lastSync')}: ${new Date(job.last_sync*1000).toLocaleString()}`:` ${t('neverSynced')}`),job.error&&/*#__PURE__*/React.createElement("div",{className:"text-xs text-red-400 mt-1"},t('error'),": ",job.error),job.comment&&/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-500 mt-1"},job.comment))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>handleRunReplicationNow(job.id),disabled:replicationLoading,className:"p-2 rounded-lg bg-blue-500/10 hover:bg-blue-500/20 text-blue-400 transition-colors disabled:opacity-50",title:t('syncNow')},/*#__PURE__*/React.createElement(Icons.PlayCircle,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>handleDeleteReplication(job.id),disabled:replicationLoading,className:"p-2 rounded-lg bg-red-500/10 hover:bg-red-500/20 text-red-400 transition-colors disabled:opacity-50",title:t('delete')},/*#__PURE__*/React.createElement(Icons.Trash,null))))))):/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},/*#__PURE__*/React.createElement(Icons.RefreshCw,null),/*#__PURE__*/React.createElement("p",{className:"mt-2"},t('noReplicationJobs'))),showCreateReplication&&/*#__PURE__*/React.createElement(CreateReplicationModal,{nodes:clusterNodes,onSubmit:handleCreateReplication,onClose:()=>setShowCreateReplication(false),loading:replicationLoading}),/*#__PURE__*/React.createElement("div",{className:"mt-6"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-gray-300 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Globe,{className:"w-4 h-4 text-proxmox-orange"}),t('crossClusterReplication')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowCreateXRepl(true),className:"flex items-center gap-1.5 px-3 py-1.5 bg-proxmox-orange/10 text-proxmox-orange rounded-lg text-xs hover:bg-proxmox-orange/20 transition-colors"},/*#__PURE__*/React.createElement(Icons.Plus,{className:"w-3.5 h-3.5"}),t('addDrJob'))),crossClusterRepls.length===0?/*#__PURE__*/React.createElement("div",{className:"text-center py-6 text-gray-500 text-sm"},t('noReplicationJobs')):/*#__PURE__*/React.createElement("div",{className:"space-y-2"},crossClusterRepls.map(job=>/*#__PURE__*/React.createElement("div",{key:job.id,className:"bg-proxmox-darker rounded-lg p-3 flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex-1"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:`w-2 h-2 rounded-full ${job.enabled?'bg-green-500':'bg-gray-500'}`}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-white"},"\u2192 ",job.target_cluster),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},job.schedule)),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mt-1"},job.last_run?`${t('lastRunPrefix')}: ${new Date(job.last_run).toLocaleString()}`:t('neverRun'),job.last_status&&` \u00b7 ${job.last_status}`,job.last_error&&/*#__PURE__*/React.createElement("span",{className:"text-red-400 ml-1"},job.last_error))),/*#__PURE__*/React.createElement("div",{className:"flex gap-1"},/*#__PURE__*/React.createElement("button",{onClick:()=>handleRunXReplNow(job.id),className:"p-1.5 rounded hover:bg-green-500/10 text-gray-400 hover:text-green-400",title:t('runNow')},/*#__PURE__*/React.createElement(Icons.Play,{className:"w-3.5 h-3.5"})),/*#__PURE__*/React.createElement("button",{onClick:()=>handleDeleteXRepl(job.id),className:"p-1.5 rounded hover:bg-red-500/10 text-gray-400 hover:text-red-400",title:t('delete')},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-3.5 h-3.5"})))))),showCreateXRepl&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-lg p-4 mt-3"},/*#__PURE__*/React.createElement("h5",{className:"text-sm font-medium mb-3"},t('newCrossClusterReplication')),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('targetCluster')),/*#__PURE__*/React.createElement("select",{value:xReplForm.target_cluster,onChange:e=>setXReplForm(f=>({...f,target_cluster:e.target.value,target_storage:'',target_bridge:'vmbr0'})),className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},t('selectCluster')||'Select cluster...'),allClusters.filter(c=>c.id!==clusterId&&c.connected).map(c=>/*#__PURE__*/React.createElement("option",{key:c.id,value:c.id},c.name)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('targetStorage')),xReplLoadingResources?/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-gray-500 text-sm py-2"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-3.5 h-3.5 animate-spin"}),t('loading'),"..."):xReplForm.target_cluster?/*#__PURE__*/React.createElement("select",{value:xReplForm.target_storage,onChange:e=>setXReplForm(f=>({...f,target_storage:e.target.value})),className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},t('selectStorage')||'Select storage...'),xReplTargetStorages.map(s=>/*#__PURE__*/React.createElement("option",{key:s.storage,value:s.storage},s.storage," (",s.type,")"))):/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 py-2"},t('selectClusterFirst')||'Select a target cluster first')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('targetBridge')),xReplLoadingResources?/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-gray-500 text-sm py-2"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-3.5 h-3.5 animate-spin"}),t('loading'),"..."):xReplForm.target_cluster?/*#__PURE__*/React.createElement("select",{value:xReplForm.target_bridge,onChange:e=>setXReplForm(f=>({...f,target_bridge:e.target.value})),className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"},xReplTargetBridges.filter(b=>b.source!=='sdn').length>0&&/*#__PURE__*/React.createElement("optgroup",{label:"Local Bridges"},xReplTargetBridges.filter(b=>b.source!=='sdn').map(b=>/*#__PURE__*/React.createElement("option",{key:b.iface,value:b.iface},b.iface,b.comments?` - ${b.comments}`:''))),xReplTargetBridges.filter(b=>b.source==='sdn').length>0&&/*#__PURE__*/React.createElement("optgroup",{label:"SDN VNets"},xReplTargetBridges.filter(b=>b.source==='sdn').map(b=>/*#__PURE__*/React.createElement("option",{key:b.iface,value:b.iface},b.iface," - ",b.zone||'SDN',b.alias?` (${b.alias})`:'')))):/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 py-2"},t('selectClusterFirst')||'Select a target cluster first')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('scheduleCron')),/*#__PURE__*/React.createElement("input",{type:"text",value:xReplForm.schedule,onChange:e=>setXReplForm(f=>({...f,schedule:e.target.value})),placeholder:"0 */6 * * *",className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('replicationRetention')),/*#__PURE__*/React.createElement("input",{type:"number",min:"1",max:"30",value:xReplForm.retention,onChange:e=>setXReplForm(f=>({...f,retention:parseInt(e.target.value)||1})),className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"}))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 mt-3"},/*#__PURE__*/React.createElement("button",{onClick:handleCreateXRepl,className:"px-3 py-1.5 bg-proxmox-orange text-white rounded-lg text-sm hover:bg-proxmox-orange/90 transition-colors"},t('create')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowCreateXRepl(false),className:"px-3 py-1.5 bg-proxmox-dark border border-proxmox-border text-gray-300 rounded-lg text-sm hover:bg-proxmox-darker transition-colors"},t('cancel')))))),activeTab==='history'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex gap-2 border-b border-proxmox-border pb-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setHistorySubTab('proxmox');fetchHistory();},className:`px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${historySubTab==='proxmox'?'bg-proxmox-orange text-white':'text-gray-400 hover:text-white hover:bg-proxmox-dark'}`},t('proxmoxTasks')),/*#__PURE__*/React.createElement("button",{onClick:()=>{setHistorySubTab('pegaprox');fetchHistory();},className:`px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${historySubTab==='pegaprox'?'bg-proxmox-orange text-white':'text-gray-400 hover:text-white hover:bg-proxmox-dark'}`},t('pegaproxActions')),/*#__PURE__*/React.createElement("button",{onClick:fetchHistory,className:"ml-auto p-2 hover:bg-proxmox-dark rounded-lg text-gray-400 hover:text-white",title:"Refresh"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:`w-4 h-4 ${historyLoading?'animate-spin':''}`}))),historyLoading?/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center py-8"},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-6 h-6 animate-spin text-proxmox-orange"})):/*#__PURE__*/React.createElement(React.Fragment,null,historySubTab==='proxmox'&&/*#__PURE__*/React.createElement("div",{className:"space-y-2"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-gray-400 mb-2"},"Proxmox Tasks for ",isQemu?'VM':'CT'," ",vm.vmid),vmProxmoxTasks&&vmProxmoxTasks.length>0?/*#__PURE__*/React.createElement("div",{className:"overflow-x-auto max-h-96 overflow-y-auto"},/*#__PURE__*/React.createElement("table",{className:"w-full text-sm"},/*#__PURE__*/React.createElement("thead",{className:"sticky top-0 bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",{className:"text-left text-gray-400"},/*#__PURE__*/React.createElement("th",{className:"p-2"},"Time"),/*#__PURE__*/React.createElement("th",{className:"p-2"},"Type"),/*#__PURE__*/React.createElement("th",{className:"p-2"},"User"),/*#__PURE__*/React.createElement("th",{className:"p-2"},"Status"),/*#__PURE__*/React.createElement("th",{className:"p-2"},"Node"))),/*#__PURE__*/React.createElement("tbody",null,vmProxmoxTasks.map((task,idx)=>/*#__PURE__*/React.createElement("tr",{key:idx,className:"border-t border-proxmox-border hover:bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("td",{className:"p-2 text-gray-300 whitespace-nowrap"},task.starttime?new Date(task.starttime*1000).toLocaleString():'-'),/*#__PURE__*/React.createElement("td",{className:"p-2 font-mono text-xs"},/*#__PURE__*/React.createElement("span",{className:"px-2 py-0.5 bg-blue-500/20 text-blue-400 rounded"},task.type||'-')),/*#__PURE__*/React.createElement("td",{className:"p-2 text-gray-300"},task.user||'-'),/*#__PURE__*/React.createElement("td",{className:"p-2"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs ${task.status==='OK'?'bg-green-500/20 text-green-400':task.status&&task.status.includes('ERROR')?'bg-red-500/20 text-red-400':task.exitstatus==='OK'?'bg-green-500/20 text-green-400':!task.endtime?'bg-yellow-500/20 text-yellow-400':'bg-gray-500/20 text-gray-400'}`},task.status||task.exitstatus||(task.endtime?'completed':'running'))),/*#__PURE__*/React.createElement("td",{className:"p-2 text-gray-400 font-mono text-xs"},task.node||vm.node)))))):/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},/*#__PURE__*/React.createElement(Icons.List,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),/*#__PURE__*/React.createElement("p",null,"No Proxmox tasks found for this ",isQemu?'VM':'Container'))),historySubTab==='pegaprox'&&/*#__PURE__*/React.createElement("div",{className:"space-y-2"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-gray-400 mb-2"},"PegaProx Actions for ",isQemu?'VM':'CT'," ",vm.vmid),vmPegaproxActions&&vmPegaproxActions.length>0?/*#__PURE__*/React.createElement("div",{className:"overflow-x-auto max-h-96 overflow-y-auto"},/*#__PURE__*/React.createElement("table",{className:"w-full text-sm"},/*#__PURE__*/React.createElement("thead",{className:"sticky top-0 bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",{className:"text-left text-gray-400"},/*#__PURE__*/React.createElement("th",{className:"p-2"},"Time"),/*#__PURE__*/React.createElement("th",{className:"p-2"},"Action"),/*#__PURE__*/React.createElement("th",{className:"p-2"},"User"),/*#__PURE__*/React.createElement("th",{className:"p-2"},"Details"))),/*#__PURE__*/React.createElement("tbody",null,vmPegaproxActions.map((action,idx)=>/*#__PURE__*/React.createElement("tr",{key:idx,className:"border-t border-proxmox-border hover:bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("td",{className:"p-2 text-gray-300 whitespace-nowrap"},action.timestamp?new Date(action.timestamp).toLocaleString():'-'),/*#__PURE__*/React.createElement("td",{className:"p-2"},/*#__PURE__*/React.createElement("span",{className:"px-2 py-0.5 bg-proxmox-orange/20 text-proxmox-orange rounded text-xs font-mono"},action.action||'-')),/*#__PURE__*/React.createElement("td",{className:"p-2 text-gray-300 font-medium"},action.user||'-'),/*#__PURE__*/React.createElement("td",{className:"p-2 text-gray-400 text-xs max-w-xs truncate",title:action.details||''},action.details||'-')))))):/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},/*#__PURE__*/React.createElement(Icons.List,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),/*#__PURE__*/React.createElement("p",null,"No PegaProx actions found for this ",isQemu?'VM':'Container'))))),activeTab==='firewall'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},fwLoading?/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center py-12"},/*#__PURE__*/React.createElement("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-proxmox-orange"})):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"flex gap-1 border-b border-proxmox-border pb-2"},['rules','options','aliases','ipsets','log'].map(st=>/*#__PURE__*/React.createElement("button",{key:st,onClick:()=>{setFwSubTab(st);if(st==='log')fetchFwLog();},className:`px-3 py-1.5 rounded-lg text-sm transition-colors ${fwSubTab===st?'bg-proxmox-orange text-white':'text-gray-400 hover:text-white hover:bg-proxmox-dark'}`},st==='rules'?t('firewallRules')||'Rules':st==='options'?t('firewallOptions')||'Options':st==='aliases'?t('aliases')||'Aliases':st==='ipsets'?'IP Sets':t('log')||'Log'))),fwSubTab==='rules'&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},t('firewallRules')||'Firewall Rules'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddFwRule(true),className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm text-white transition-colors"},/*#__PURE__*/React.createElement(Icons.Plus,null)," ",t('add'))),/*#__PURE__*/React.createElement("div",{className:"overflow-x-auto"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"#"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('type')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('action')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Macro"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('source')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Dest"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Proto"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Port"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('enabled')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('comment')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"}))),/*#__PURE__*/React.createElement("tbody",null,!fwRules||fwRules.length===0?/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:"11",className:"p-8 text-center text-gray-500"},t('noFirewallRules')||'No firewall rules configured')):(Array.isArray(fwRules)?fwRules:[]).map((rule,idx)=>/*#__PURE__*/React.createElement("tr",{key:idx,className:"border-t border-proxmox-border hover:bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},rule.pos),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs ${rule.type==='in'?'bg-blue-500/20 text-blue-400':rule.type==='out'?'bg-purple-500/20 text-purple-400':'bg-yellow-500/20 text-yellow-400'}`},(rule.type||'in').toUpperCase())),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${rule.action==='ACCEPT'?'bg-green-500/20 text-green-400':rule.action==='DROP'?'bg-red-500/20 text-red-400':'bg-yellow-500/20 text-yellow-400'}`},rule.action)),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300"},rule.macro||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 font-mono text-xs text-gray-300"},rule.source||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 font-mono text-xs text-gray-300"},rule.dest||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300"},rule.proto||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 font-mono text-xs text-gray-300"},rule.dport||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall/rules/${rule.pos}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({enable:rule.enable?0:1})});if(res?.ok){setFwRules(prev=>prev.map(r=>r.pos===rule.pos?{...r,enable:rule.enable?0:1}:r));}}catch(e){}},className:`w-8 h-5 rounded-full transition-colors ${rule.enable?'bg-green-500':'bg-gray-600'}`},/*#__PURE__*/React.createElement("div",{className:`w-4 h-4 rounded-full bg-white transition-transform ${rule.enable?'translate-x-3.5':'translate-x-0.5'}`}))),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-500 text-xs max-w-32 truncate"},rule.comment||''),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!confirm(t('confirmDeleteRule')||'Delete this firewall rule?'))return;try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall/rules/${rule.pos}`,{method:'DELETE'});if(res?.ok)fetchFirewallData();}catch(e){}},className:"p-1.5 hover:bg-red-500/20 rounded text-red-400 transition-colors"},/*#__PURE__*/React.createElement(Icons.Trash,null))))))))),fwSubTab==='options'&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold flex items-center gap-2 mb-4"},/*#__PURE__*/React.createElement(Icons.Shield,null),t('firewallOptions')||'Firewall Options'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mb-2"},t('fwEnable')||'Firewall'),/*#__PURE__*/React.createElement("button",{onClick:async()=>{const newVal=fwOptions.enable?0:1;try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall/options`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({enable:newVal})});if(res?.ok)setFwOptions(prev=>({...prev,enable:newVal}));}catch(e){}},className:`px-4 py-2 rounded-lg font-medium transition-colors ${fwOptions.enable?'bg-green-500/20 text-green-400 hover:bg-green-500/30':'bg-red-500/20 text-red-400 hover:bg-red-500/30'}`},fwOptions.enable?t('enabled')||'Enabled':t('disabled')||'Disabled')),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mb-1"},"Policy In"),/*#__PURE__*/React.createElement("select",{value:fwOptions.policy_in||'DROP',onChange:async e=>{try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall/options`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({policy_in:e.target.value})});if(res?.ok)setFwOptions(prev=>({...prev,policy_in:e.target.value}));}catch(e){}},className:"w-full bg-proxmox-darker border border-proxmox-border rounded-lg p-2 text-white"},/*#__PURE__*/React.createElement("option",{value:"ACCEPT"},"ACCEPT"),/*#__PURE__*/React.createElement("option",{value:"DROP"},"DROP"),/*#__PURE__*/React.createElement("option",{value:"REJECT"},"REJECT"))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mb-1"},"Policy Out"),/*#__PURE__*/React.createElement("select",{value:fwOptions.policy_out||'ACCEPT',onChange:async e=>{try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall/options`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({policy_out:e.target.value})});if(res?.ok)setFwOptions(prev=>({...prev,policy_out:e.target.value}));}catch(e){}},className:"w-full bg-proxmox-darker border border-proxmox-border rounded-lg p-2 text-white"},/*#__PURE__*/React.createElement("option",{value:"ACCEPT"},"ACCEPT"),/*#__PURE__*/React.createElement("option",{value:"DROP"},"DROP"),/*#__PURE__*/React.createElement("option",{value:"REJECT"},"REJECT"))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mb-1"},t('fwDhcp')||'DHCP'),/*#__PURE__*/React.createElement("button",{onClick:async()=>{const newVal=fwOptions.dhcp?0:1;try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall/options`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({dhcp:newVal})});if(res?.ok)setFwOptions(prev=>({...prev,dhcp:newVal}));}catch(e){}},className:`px-3 py-1.5 rounded-lg text-sm transition-colors ${fwOptions.dhcp?'bg-green-500/20 text-green-400':'bg-gray-600/30 text-gray-400'}`},fwOptions.dhcp?'On':'Off')),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mb-1"},t('fwNdp')||'NDP'),/*#__PURE__*/React.createElement("button",{onClick:async()=>{const newVal=fwOptions.ndp?0:1;try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall/options`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({ndp:newVal})});if(res?.ok)setFwOptions(prev=>({...prev,ndp:newVal}));}catch(e){}},className:`px-3 py-1.5 rounded-lg text-sm transition-colors ${fwOptions.ndp?'bg-green-500/20 text-green-400':'bg-gray-600/30 text-gray-400'}`},fwOptions.ndp?'On':'Off')),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mb-1"},t('fwRadv')||'Router Adv.'),/*#__PURE__*/React.createElement("button",{onClick:async()=>{const newVal=fwOptions.radv?0:1;try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall/options`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({radv:newVal})});if(res?.ok)setFwOptions(prev=>({...prev,radv:newVal}));}catch(e){}},className:`px-3 py-1.5 rounded-lg text-sm transition-colors ${fwOptions.radv?'bg-green-500/20 text-green-400':'bg-gray-600/30 text-gray-400'}`},fwOptions.radv?'On':'Off')),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mb-1"},t('fwMacFilter')||'MAC Filter'),/*#__PURE__*/React.createElement("button",{onClick:async()=>{const newVal=fwOptions.macfilter?0:1;try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall/options`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({macfilter:newVal})});if(res?.ok)setFwOptions(prev=>({...prev,macfilter:newVal}));}catch(e){}},className:`px-3 py-1.5 rounded-lg text-sm transition-colors ${fwOptions.macfilter?'bg-green-500/20 text-green-400':'bg-gray-600/30 text-gray-400'}`},fwOptions.macfilter?'On':'Off')),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mb-1"},t('fwLogLevel')||'Log Level In'),/*#__PURE__*/React.createElement("select",{value:fwOptions.log_level_in||'nolog',onChange:async e=>{try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall/options`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({log_level_in:e.target.value})});if(res?.ok)setFwOptions(prev=>({...prev,log_level_in:e.target.value}));}catch(e){}},className:"w-full bg-proxmox-darker border border-proxmox-border rounded-lg p-2 text-white"},/*#__PURE__*/React.createElement("option",{value:"nolog"},"No Log"),/*#__PURE__*/React.createElement("option",{value:"emerg"},"Emergency"),/*#__PURE__*/React.createElement("option",{value:"alert"},"Alert"),/*#__PURE__*/React.createElement("option",{value:"crit"},"Critical"),/*#__PURE__*/React.createElement("option",{value:"err"},"Error"),/*#__PURE__*/React.createElement("option",{value:"warning"},"Warning"),/*#__PURE__*/React.createElement("option",{value:"notice"},"Notice"),/*#__PURE__*/React.createElement("option",{value:"info"},"Info"),/*#__PURE__*/React.createElement("option",{value:"debug"},"Debug"))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mb-1"},t('fwLogLevelOut')||'Log Level Out'),/*#__PURE__*/React.createElement("select",{value:fwOptions.log_level_out||'nolog',onChange:async e=>{try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall/options`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({log_level_out:e.target.value})});if(res?.ok)setFwOptions(prev=>({...prev,log_level_out:e.target.value}));}catch(e){}},className:"w-full bg-proxmox-darker border border-proxmox-border rounded-lg p-2 text-white"},/*#__PURE__*/React.createElement("option",{value:"nolog"},"No Log"),/*#__PURE__*/React.createElement("option",{value:"emerg"},"Emergency"),/*#__PURE__*/React.createElement("option",{value:"alert"},"Alert"),/*#__PURE__*/React.createElement("option",{value:"crit"},"Critical"),/*#__PURE__*/React.createElement("option",{value:"err"},"Error"),/*#__PURE__*/React.createElement("option",{value:"warning"},"Warning"),/*#__PURE__*/React.createElement("option",{value:"notice"},"Notice"),/*#__PURE__*/React.createElement("option",{value:"info"},"Info"),/*#__PURE__*/React.createElement("option",{value:"debug"},"Debug"))))),fwSubTab==='aliases'&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},t('aliases')||'Aliases'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddFwAlias(true),className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm text-white transition-colors"},/*#__PURE__*/React.createElement(Icons.Plus,null)," ",t('add'))),/*#__PURE__*/React.createElement("div",{className:"overflow-x-auto"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('name')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"CIDR"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('comment')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"}))),/*#__PURE__*/React.createElement("tbody",null,!fwAliases||fwAliases.length===0?/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:"4",className:"p-8 text-center text-gray-500"},t('noAliases')||'No aliases configured')):fwAliases.map((alias,idx)=>/*#__PURE__*/React.createElement("tr",{key:idx,className:"border-t border-proxmox-border hover:bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("td",{className:"p-3 font-medium"},alias.name),/*#__PURE__*/React.createElement("td",{className:"p-3 font-mono text-sm text-gray-300"},alias.cidr),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-500 text-sm"},alias.comment||''),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!confirm(`Delete alias "${alias.name}"?`))return;try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall/aliases/${alias.name}`,{method:'DELETE'});if(res?.ok)fetchFirewallData();}catch(e){}},className:"p-1.5 hover:bg-red-500/20 rounded text-red-400 transition-colors"},/*#__PURE__*/React.createElement(Icons.Trash,null))))))))),fwSubTab==='ipsets'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},"IP Sets"),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddFwIpset(true),className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm text-white transition-colors"},/*#__PURE__*/React.createElement(Icons.Plus,null)," ",t('add'))),!fwIpsets||fwIpsets.length===0?/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-8 text-center text-gray-500"},t('noIpsets')||'No IP sets configured'):fwIpsets.map((ipset,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 flex justify-between items-center cursor-pointer hover:bg-proxmox-dark/50",onClick:()=>setExpandedIpset(expandedIpset===ipset.name?null:ipset.name)},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement(Icons.ChevronRight,{className:`w-4 h-4 transition-transform ${expandedIpset===ipset.name?'rotate-90':''}`}),/*#__PURE__*/React.createElement("span",{className:"font-medium"},ipset.name),ipset.comment&&/*#__PURE__*/React.createElement("span",{className:"text-gray-500 text-sm"},"- ",ipset.comment)),/*#__PURE__*/React.createElement("button",{onClick:async e=>{e.stopPropagation();if(!confirm(`Delete IP set "${ipset.name}"?`))return;try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall/ipset/${ipset.name}`,{method:'DELETE'});if(res?.ok)fetchFirewallData();}catch(e){}},className:"p-1.5 hover:bg-red-500/20 rounded text-red-400 transition-colors"},/*#__PURE__*/React.createElement(Icons.Trash,null))),expandedIpset===ipset.name&&/*#__PURE__*/React.createElement("div",{className:"border-t border-proxmox-border"},/*#__PURE__*/React.createElement(IpsetEntries,{clusterId:clusterId,vm:vm,ipsetName:ipset.name,authFetch:authFetch,onRefresh:fetchFirewallData,t:t}))))),fwSubTab==='log'&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},t('firewallLog')||'Firewall Log'),/*#__PURE__*/React.createElement("button",{onClick:fetchFwLog,className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-dark hover:bg-proxmox-hover rounded-lg text-sm transition-colors"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-4 h-4"})," ",t('refresh')||'Refresh')),/*#__PURE__*/React.createElement("div",{className:"p-4 max-h-96 overflow-y-auto"},!fwLog||fwLog.length===0?/*#__PURE__*/React.createElement("div",{className:"text-center text-gray-500 py-8"},t('noLogEntries')||'No log entries'):/*#__PURE__*/React.createElement("div",{className:"space-y-1 font-mono text-xs"},(Array.isArray(fwLog)?fwLog:[]).map((entry,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"p-2 bg-proxmox-dark rounded text-gray-300 whitespace-pre-wrap break-all"},typeof entry==='string'?entry:entry.t||entry.n||JSON.stringify(entry)))))),showAddFwRule&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 modal-backdrop",onClick:()=>setShowAddFwRule(false)},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-lg bg-proxmox-card border border-proxmox-border rounded-2xl shadow-2xl overflow-hidden",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},t('addFirewallRule')||'Add Firewall Rule')),/*#__PURE__*/React.createElement("div",{className:"p-4 space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"Direction"),/*#__PURE__*/React.createElement("select",{value:newFwRule.type||'in',onChange:e=>setNewFwRule(p=>({...p,type:e.target.value})),className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"},/*#__PURE__*/React.createElement("option",{value:"in"},"IN"),/*#__PURE__*/React.createElement("option",{value:"out"},"OUT"),/*#__PURE__*/React.createElement("option",{value:"group"},"GROUP"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"Action"),/*#__PURE__*/React.createElement("select",{value:newFwRule.action||'ACCEPT',onChange:e=>setNewFwRule(p=>({...p,action:e.target.value})),className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"},/*#__PURE__*/React.createElement("option",{value:"ACCEPT"},"ACCEPT"),/*#__PURE__*/React.createElement("option",{value:"DROP"},"DROP"),/*#__PURE__*/React.createElement("option",{value:"REJECT"},"REJECT")))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"Macro"),/*#__PURE__*/React.createElement("select",{value:newFwRule.macro||'',onChange:e=>setNewFwRule(p=>({...p,macro:e.target.value||undefined})),className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"},/*#__PURE__*/React.createElement("option",{value:""},"None"),(()=>{const dynamicMacros=(Array.isArray(fwRefs)?fwRefs:[]).filter(r=>r.type==='macro').map(r=>r.name);const allMacros=dynamicMacros.length>0?dynamicMacros:['Amanda','Auth','BGP','BitTorrent','Ceph','CephMon','CephOSD','CephMGR','CephMDS','DHCPfwd','DHCPv6','DNS','Dropbox','FTP','GNUnet','GRE','HKP','HTTP','HTTPS','ICMP','ICMPv6','IMAP','IMAPS','IPsec-ah','IPsec-esp','IRC','Jabber','JetDirect','L2TP','LDAP','LDAPS','MDNS','MSSQL','MySQL','NFS','NTP','OSPF','OpenVPN','PCA','PMG','POP3','POP3S','PPtP','Ping','PostgreSQL','Printer','RDP','RIP','RNDC','Razor','Rsh','SANE','SMB','SMBv2','SMTP','SMTPS','SNMP','SPAMD','SSH','SVN','SixXS','Squid','Submission','Syslog','TFTP','Telnet','Tinc','Traceroute','VNC','VXLAN','Webmin','NFS','Razor'];return allMacros.sort().map(name=>/*#__PURE__*/React.createElement("option",{key:name,value:name},name));})())),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"Interface"),/*#__PURE__*/React.createElement("select",{value:newFwRule.iface||'',onChange:e=>setNewFwRule(p=>({...p,iface:e.target.value})),className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"},/*#__PURE__*/React.createElement("option",{value:""},"Any"),(config?.networks||[]).map(n=>/*#__PURE__*/React.createElement("option",{key:n.id,value:n.id},n.id,n.bridge?` (${n.bridge})`:'')),(!config?.networks||config.networks.length===0)&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("option",{value:"net0"},"net0"),/*#__PURE__*/React.createElement("option",{value:"net1"},"net1"))))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"Protocol"),/*#__PURE__*/React.createElement("select",{value:newFwRule.proto||'',onChange:e=>setNewFwRule(p=>({...p,proto:e.target.value})),className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"},/*#__PURE__*/React.createElement("option",{value:""},"Any"),/*#__PURE__*/React.createElement("option",{value:"tcp"},"TCP"),/*#__PURE__*/React.createElement("option",{value:"udp"},"UDP"),/*#__PURE__*/React.createElement("option",{value:"icmp"},"ICMP"),/*#__PURE__*/React.createElement("option",{value:"sctp"},"SCTP"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"Dest. Port"),/*#__PURE__*/React.createElement("input",{type:"text",value:newFwRule.dport||'',onChange:e=>setNewFwRule(p=>({...p,dport:e.target.value})),placeholder:"e.g. 22, 80, 443",className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"Source"),/*#__PURE__*/React.createElement("input",{type:"text",value:newFwRule.source||'',onChange:e=>setNewFwRule(p=>({...p,source:e.target.value})),placeholder:"10.0.0.0/24 or 10.0.0.1",className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"Destination"),/*#__PURE__*/React.createElement("input",{type:"text",value:newFwRule.dest||'',onChange:e=>setNewFwRule(p=>({...p,dest:e.target.value})),placeholder:"192.168.1.0/24 or 192.168.1.1",className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"}))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"Comment"),/*#__PURE__*/React.createElement("input",{type:"text",value:newFwRule.comment||'',onChange:e=>setNewFwRule(p=>({...p,comment:e.target.value})),placeholder:"Optional description",className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"})),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newFwRule.enable!==0,onChange:e=>setNewFwRule(p=>({...p,enable:e.target.checked?1:0})),className:"w-4 h-4 rounded"}),/*#__PURE__*/React.createElement("span",null,"Enable rule"))),/*#__PURE__*/React.createElement("div",{className:"p-4 border-t border-proxmox-border flex gap-3 justify-end"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddFwRule(false),className:"px-4 py-2 bg-proxmox-dark rounded-lg hover:bg-proxmox-hover transition-colors"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{try{const ruleData={...newFwRule};Object.keys(ruleData).forEach(k=>{if(!ruleData[k]&&ruleData[k]!==0)delete ruleData[k];});const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall/rules`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(ruleData)});if(res?.ok){fetchFirewallData();setShowAddFwRule(false);setNewFwRule({type:'in',action:'ACCEPT',enable:1});if(addToast)addToast(t('firewallRuleCreated')||'Firewall rule created','success');}else{const err=await res?.json().catch(()=>({}));let errMsg='Failed to create rule';if(err?.error&&typeof err.error==='object'){errMsg=Object.entries(err.error).map(([k,v])=>`${k}: ${String(v).trim()}`).join('; ');}else if(err?.error){errMsg=String(err.error);}else if(err?.message){errMsg=String(err.message);}if(addToast)addToast(errMsg,'error');}}catch(e){if(addToast)addToast('Connection error','error');}},className:"px-4 py-2 bg-proxmox-orange rounded-lg text-white hover:bg-orange-600 transition-colors"},t('add'))))),showAddFwAlias&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 modal-backdrop",onClick:()=>setShowAddFwAlias(false)},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-md bg-proxmox-card border border-proxmox-border rounded-2xl shadow-2xl overflow-hidden",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},t('fwAddAlias')||'Add Alias')),/*#__PURE__*/React.createElement("div",{className:"p-4 space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},t('name')),/*#__PURE__*/React.createElement("input",{type:"text",value:newFwAlias.name,onChange:e=>setNewFwAlias(p=>({...p,name:e.target.value})),placeholder:"e.g. myserver",className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},"CIDR"),/*#__PURE__*/React.createElement("input",{type:"text",value:newFwAlias.cidr,onChange:e=>setNewFwAlias(p=>({...p,cidr:e.target.value})),placeholder:"e.g. 10.0.0.1/32",className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},t('comment')),/*#__PURE__*/React.createElement("input",{type:"text",value:newFwAlias.comment,onChange:e=>setNewFwAlias(p=>({...p,comment:e.target.value})),className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"}))),/*#__PURE__*/React.createElement("div",{className:"p-4 border-t border-proxmox-border flex gap-3 justify-end"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddFwAlias(false),className:"px-4 py-2 bg-proxmox-dark rounded-lg hover:bg-proxmox-hover transition-colors"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!newFwAlias.name||!newFwAlias.cidr)return;try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall/aliases`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(newFwAlias)});if(res?.ok){fetchFirewallData();setShowAddFwAlias(false);setNewFwAlias({name:'',cidr:'',comment:''});}}catch(e){}},className:"px-4 py-2 bg-proxmox-orange rounded-lg text-white hover:bg-orange-600 transition-colors"},t('add'))))),showAddFwIpset&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 modal-backdrop",onClick:()=>setShowAddFwIpset(false)},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-md bg-proxmox-card border border-proxmox-border rounded-2xl shadow-2xl overflow-hidden",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},t('fwAddIpset')||'Add IP Set')),/*#__PURE__*/React.createElement("div",{className:"p-4 space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},t('name')),/*#__PURE__*/React.createElement("input",{type:"text",value:newFwIpset.name,onChange:e=>setNewFwIpset(p=>({...p,name:e.target.value})),placeholder:"e.g. allowed-hosts",className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-400 mb-1 block"},t('comment')),/*#__PURE__*/React.createElement("input",{type:"text",value:newFwIpset.comment,onChange:e=>setNewFwIpset(p=>({...p,comment:e.target.value})),className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2"}))),/*#__PURE__*/React.createElement("div",{className:"p-4 border-t border-proxmox-border flex gap-3 justify-end"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddFwIpset(false),className:"px-4 py-2 bg-proxmox-dark rounded-lg hover:bg-proxmox-hover transition-colors"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!newFwIpset.name)return;try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/firewall/ipset`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(newFwIpset)});if(res?.ok){fetchFirewallData();setShowAddFwIpset(false);setNewFwIpset({name:'',comment:''});}}catch(e){}},className:"px-4 py-2 bg-proxmox-orange rounded-lg text-white hover:bg-orange-600 transition-colors"},t('add'))))))),activeTab==='options'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border space-y-3"},/*#__PURE__*/React.createElement(ConfigCheckboxField,{label:t('startOnBoot'),checked:getValue('options','onboot')==1,onChange:v=>handleChange('options','onboot',v),t:t}),/*#__PURE__*/React.createElement(ConfigCheckboxField,{label:t('protection'),checked:getValue('options','protection')==1,onChange:v=>handleChange('options','protection',v),t:t})),isQemu&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-2"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:getValue('options','agent')?.toString().includes('1'),onChange:e=>{const current=getValue('options','agent')||'';if(e.target.checked){handleChange('options','agent','1');}else{handleChange('options','agent','0');}},className:"w-4 h-4 rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm font-medium text-gray-300"},t('qemuGuestAgent')),/*#__PURE__*/React.createElement("span",{className:"text-[10px] px-1.5 py-0.5 bg-red-500/20 text-red-400 rounded font-medium"},t('needsRestart')))),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mb-3"},t('qemuGuestAgentHint')),getValue('options','agent')?.toString().includes('1')&&/*#__PURE__*/React.createElement("div",{className:"mt-3 pt-3 border-t border-proxmox-border space-y-2"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-400"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:getValue('options','agent')?.toString().includes('fstrim_cloned_disks=1'),onChange:e=>{let agent=getValue('options','agent')||'1';if(e.target.checked){agent=agent.includes(',')?agent+',fstrim_cloned_disks=1':'1,fstrim_cloned_disks=1';}else{agent=agent.replace(/,?fstrim_cloned_disks=1/,'').replace(/^,/,'');}handleChange('options','agent',agent||'1');},className:"w-4 h-4 rounded"}),t('fstrim')))),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("label",{className:"text-sm font-medium text-gray-300 block mb-2"},t('hotplug')),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mb-3"},t('hotplugHint')),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-4"},[{key:'disk',label:t('hotplugDisk')},{key:'network',label:t('hotplugNetwork')},{key:'usb',label:t('hotplugUsb')},{key:'memory',label:t('hotplugMemory')},{key:'cpu',label:t('hotplugCpu')}].map(hp=>{const hotplugValue=getValue('options','hotplug')||'disk,network,usb';const isEnabled=hotplugValue==='1'||hotplugValue.includes(hp.key);return/*#__PURE__*/React.createElement("label",{key:hp.key,className:"flex items-center gap-2 text-sm text-gray-400"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:isEnabled,onChange:e=>{let current=getValue('options','hotplug')||'disk,network,usb';if(current==='1')current='disk,network,usb,memory,cpu';if(current==='0')current='';let parts=current.split(',').filter(p=>p);if(e.target.checked&&!parts.includes(hp.key)){parts.push(hp.key);}else if(!e.target.checked){parts=parts.filter(p=>p!==hp.key);}handleChange('options','hotplug',parts.join(',')||'0');},className:"w-4 h-4 rounded"}),hp.label);}))),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border space-y-3"},/*#__PURE__*/React.createElement(ConfigCheckboxField,{label:t('kvmVirtualization'),checked:getValue('options','kvm')==1,onChange:v=>handleChange('options','kvm',v),needsRestart:true,t:t}),/*#__PURE__*/React.createElement(ConfigCheckboxField,{label:"ACPI",checked:getValue('options','acpi')==1,onChange:v=>handleChange('options','acpi',v),needsRestart:true,t:t}))),!isQemu&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(ConfigCheckboxField,{label:t('unprivilegedContainer'),checked:getValue('options','unprivileged')==1,onChange:v=>handleChange('options','unprivileged',v),disabled:true,needsRestart:true,t:t}))),isQemu&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement(ConfigInputField,{label:t('osType'),value:getValue('options','ostype'),onChange:v=>handleChange('options','ostype',v),options:[{value:'l26',label:'Linux 2.6+'},{value:'l24',label:'Linux 2.4'},{value:'win11',label:'Windows 11'},{value:'win10',label:'Windows 10'},{value:'win8',label:'Windows 8'},{value:'win7',label:'Windows 7'},{value:'wxp',label:'Windows XP'},{value:'other',label:t('other')}]})),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("label",{className:"text-sm font-medium text-gray-300"},t('bootOrder')||'Boot Order'),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},t('bootOrderHint')||'Click to toggle, use arrows to reorder')),(()=>{const currentBoot=getValue('options','boot')||'';const bootDevices=currentBoot.includes('order=')?currentBoot.split('order=')[1].split(';').filter(d=>d):[];// LW: Collect all bootable devices from config
const allDevices=[];if(config.disks){config.disks.forEach(d=>{if(!d.id.includes('cloudinit'))allDevices.push(d.id);});}if(config.networks){config.networks.forEach(n=>allDevices.push(n.id));}// Add common devices that might not be in disks array
['ide2','ide0','sata0','scsi0','virtio0','net0'].forEach(dev=>{if(!allDevices.includes(dev)){// Check if device exists in raw config
if(config[dev])allDevices.push(dev);}});// Sort: boot devices first in order, then others
const sortedDevices=[...bootDevices.filter(d=>allDevices.includes(d)),...allDevices.filter(d=>!bootDevices.includes(d))].filter((v,i,a)=>a.indexOf(v)===i);// unique
const toggleDevice=device=>{const newOrder=bootDevices.includes(device)?bootDevices.filter(d=>d!==device):[...bootDevices,device];handleChange('options','boot',newOrder.length>0?'order='+newOrder.join(';'):'');};const moveDevice=(device,direction)=>{const idx=bootDevices.indexOf(device);if(idx===-1)return;const newOrder=[...bootDevices];const newIdx=direction==='up'?idx-1:idx+1;if(newIdx<0||newIdx>=newOrder.length)return;[newOrder[idx],newOrder[newIdx]]=[newOrder[newIdx],newOrder[idx]];handleChange('options','boot','order='+newOrder.join(';'));};return/*#__PURE__*/React.createElement("div",{className:"space-y-1.5"},(()=>{let enabledCounter=0;return sortedDevices.map((device,idx)=>{const isEnabled=bootDevices.includes(device);if(isEnabled)enabledCounter++;const displayNum=enabledCounter;const bootIdx=bootDevices.indexOf(device);const isFirst=bootIdx===0;const isLast=bootIdx===bootDevices.length-1;// NS: Determine device type icon + color
const isDisk=device.match(/^(scsi|virtio|ide|sata)\d+$/);const isNet=device.match(/^net\d+$/);const isCdrom=device==='ide2'||config[device]&&String(config[device]).includes('media=cdrom');const iconColor=isCdrom?'text-yellow-400':isNet?'text-cyan-400':isDisk?'text-blue-400':'text-gray-400';const iconBg=isCdrom?'bg-yellow-500/10':isNet?'bg-cyan-500/10':isDisk?'bg-blue-500/10':'bg-gray-500/10';// Get device detail from config
const deviceDetail=config[device]?String(config[device]).split(',')[0]:'';return/*#__PURE__*/React.createElement("div",{key:device,className:`flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all ${isEnabled?'bg-gradient-to-r from-proxmox-orange/5 to-transparent border border-proxmox-orange/30':'bg-proxmox-darker/50 border border-transparent hover:border-proxmox-border'}`},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:isEnabled,onChange:()=>toggleDevice(device),className:"w-4 h-4 rounded border-gray-600 text-proxmox-orange focus:ring-proxmox-orange shrink-0"}),/*#__PURE__*/React.createElement("span",{className:`w-6 text-center text-xs font-bold shrink-0 ${isEnabled?'text-proxmox-orange':'text-gray-600'}`},isEnabled?`${displayNum}.`:'-'),/*#__PURE__*/React.createElement("div",{className:`p-1.5 rounded-md ${iconBg} shrink-0`},isCdrom?/*#__PURE__*/React.createElement(Icons.Disc,{className:`w-4 h-4 ${iconColor}`}):isNet?/*#__PURE__*/React.createElement(Icons.Globe,{className:`w-4 h-4 ${iconColor}`}):isDisk?/*#__PURE__*/React.createElement(Icons.HardDrive,{className:`w-4 h-4 ${iconColor}`}):/*#__PURE__*/React.createElement(Icons.Database,{className:`w-4 h-4 ${iconColor}`})),/*#__PURE__*/React.createElement("div",{className:"flex-1 min-w-0"},/*#__PURE__*/React.createElement("span",{className:`font-mono text-sm ${isEnabled?'text-white font-medium':'text-gray-500'}`},device),deviceDetail&&/*#__PURE__*/React.createElement("span",{className:"ml-2 text-xs text-gray-500 truncate"},deviceDetail.length>40?deviceDetail.substring(0,40)+'...':deviceDetail)),isEnabled&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-0.5 shrink-0"},/*#__PURE__*/React.createElement("button",{onClick:()=>moveDevice(device,'up'),disabled:isFirst,className:"p-1.5 rounded-md hover:bg-white/5 disabled:opacity-20 disabled:cursor-not-allowed transition-colors",title:"Move up"},/*#__PURE__*/React.createElement(Icons.ChevronUp,{className:"w-4 h-4"})),/*#__PURE__*/React.createElement("button",{onClick:()=>moveDevice(device,'down'),disabled:isLast,className:"p-1.5 rounded-md hover:bg-white/5 disabled:opacity-20 disabled:cursor-not-allowed transition-colors",title:"Move down"},/*#__PURE__*/React.createElement(Icons.ChevronDown,{className:"w-4 h-4"}))));});})(),sortedDevices.length===0&&/*#__PURE__*/React.createElement("div",{className:"text-center py-4 text-gray-500 text-sm"},t('noBootDevices')||'No boot devices found'));})()),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("label",{className:"text-sm font-medium text-gray-300 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Cpu,null),t('smbiosSettings')||'SMBIOS Settings'),/*#__PURE__*/React.createElement("span",{className:"text-[10px] px-1.5 py-0.5 bg-red-500/20 text-red-400 rounded font-medium"},t('needsRestart'))),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mb-4"},t('smbiosHint')||'System Management BIOS settings - useful for Windows licensing and VM identification'),getValue('options','smbios1')&&/*#__PURE__*/React.createElement("div",{className:"mb-4 p-3 bg-black/50 rounded-lg border border-green-500/30"},/*#__PURE__*/React.createElement("label",{className:"block text-[10px] text-green-400 mb-1 font-medium"},t('currentValue')||'Current Value'," (smbios1):"),/*#__PURE__*/React.createElement("code",{className:"text-xs text-green-300 font-mono break-all"},getValue('options','smbios1'))),(()=>{// Parse existing smbios1 value
const smbiosRaw=getValue('options','smbios1')||'';const parseSmbios=raw=>{const result={uuid:'',manufacturer:'',product:'',version:'',serial:'',sku:'',family:''};if(!raw)return result;raw.split(',').forEach(part=>{const[key,...valueParts]=part.split('=');const value=valueParts.join('=');// Handle values with = in them
if(key&&result.hasOwnProperty(key)){result[key]=value||'';}});return result;};const smbios=parseSmbios(smbiosRaw);// Sanitize for Proxmox SMBIOS - only A-Za-z0-9, learned the hard way that underscores dont work either
const sanitizeSmbios=value=>{if(!value)return'';return value.replace(/\s+/g,'')// Remove spaces
.replace(/[^A-Za-z0-9]/g,'');// Remove ALL other chars including underscores
};const buildSmbios=newValues=>{const parts=[];Object.entries(newValues).forEach(([key,value])=>{if(value&&value.trim()){// UUID is special - don't sanitize
const finalValue=key==='uuid'?value:sanitizeSmbios(value);if(finalValue){parts.push(`${key}=${finalValue}`);}}});return parts.join(',');};const updateSmbios=(field,value)=>{const newSmbios={...smbios,[field]:value};const encoded=buildSmbios(newSmbios);handleChange('options','smbios1',encoded||null);};const generateUuid=()=>{return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,c=>{const r=Math.random()*16|0;const v=c==='x'?r:r&0x3|0x8;return v.toString(16);});};return/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"UUID ",/*#__PURE__*/React.createElement("span",{className:"text-gray-600"},"(",t('managedByProxmox')||'managed by Proxmox',")")),/*#__PURE__*/React.createElement("div",{className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-gray-500 text-sm font-mono"},smbios.uuid?smbios.uuid:/*#__PURE__*/React.createElement("span",{className:"italic"},t('willBeAutoGenerated')||'Will be auto-generated on save'))),/*#__PURE__*/React.createElement("p",{className:"text-[10px] text-yellow-500/70"},"\u26A0\uFE0F ",t('smbiosFormatHint')||'Only letters and numbers allowed (A-Za-z0-9)'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('manufacturer')||'Manufacturer'),/*#__PURE__*/React.createElement("input",{type:"text",value:smbios.manufacturer,onChange:e=>updateSmbios('manufacturer',e.target.value),placeholder:"e.g. Dell",className:"w-full px-3 py-2 bg-proxmox-card border border-proxmox-border rounded-lg text-white text-sm"}),smbios.manufacturer&&sanitizeSmbios(smbios.manufacturer)!==smbios.manufacturer&&/*#__PURE__*/React.createElement("p",{className:"text-[10px] text-yellow-400 mt-0.5"},"\u2191 ",sanitizeSmbios(smbios.manufacturer))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('product')||'Product'),/*#__PURE__*/React.createElement("input",{type:"text",value:smbios.product,onChange:e=>updateSmbios('product',e.target.value),placeholder:"e.g. PowerEdgeR740",className:"w-full px-3 py-2 bg-proxmox-card border border-proxmox-border rounded-lg text-white text-sm"}),smbios.product&&sanitizeSmbios(smbios.product)!==smbios.product&&/*#__PURE__*/React.createElement("p",{className:"text-[10px] text-yellow-400 mt-0.5"},"\u2191 ",sanitizeSmbios(smbios.product))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('version')||'Version'),/*#__PURE__*/React.createElement("input",{type:"text",value:smbios.version,onChange:e=>updateSmbios('version',e.target.value),placeholder:"e.g. v1",className:"w-full px-3 py-2 bg-proxmox-card border border-proxmox-border rounded-lg text-white text-sm"}),smbios.version&&sanitizeSmbios(smbios.version)!==smbios.version&&/*#__PURE__*/React.createElement("p",{className:"text-[10px] text-yellow-400 mt-0.5"},"\u2191 ",sanitizeSmbios(smbios.version))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('serialNumber')||'Serial Number'),/*#__PURE__*/React.createElement("input",{type:"text",value:smbios.serial,onChange:e=>updateSmbios('serial',e.target.value),placeholder:"e.g. ABC123",className:"w-full px-3 py-2 bg-proxmox-card border border-proxmox-border rounded-lg text-white text-sm"}),smbios.serial&&sanitizeSmbios(smbios.serial)!==smbios.serial&&/*#__PURE__*/React.createElement("p",{className:"text-[10px] text-yellow-400 mt-0.5"},"\u2191 ",sanitizeSmbios(smbios.serial))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"SKU"),/*#__PURE__*/React.createElement("input",{type:"text",value:smbios.sku,onChange:e=>updateSmbios('sku',e.target.value),placeholder:"e.g. SKU12345",className:"w-full px-3 py-2 bg-proxmox-card border border-proxmox-border rounded-lg text-white text-sm"}),smbios.sku&&sanitizeSmbios(smbios.sku)!==smbios.sku&&/*#__PURE__*/React.createElement("p",{className:"text-[10px] text-yellow-400 mt-0.5"},"\u2191 ",sanitizeSmbios(smbios.sku))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('family')||'Family'),/*#__PURE__*/React.createElement("input",{type:"text",value:smbios.family,onChange:e=>updateSmbios('family',e.target.value),placeholder:"e.g. Server",className:"w-full px-3 py-2 bg-proxmox-card border border-proxmox-border rounded-lg text-white text-sm"}),smbios.family&&sanitizeSmbios(smbios.family)!==smbios.family&&/*#__PURE__*/React.createElement("p",{className:"text-[10px] text-yellow-400 mt-0.5"},"\u2191 ",sanitizeSmbios(smbios.family)))),(smbios.uuid||smbios.manufacturer||smbios.product||smbios.version||smbios.serial||smbios.sku||smbios.family)&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-black/50 rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("label",{className:"block text-[10px] text-gray-500 mb-1"},t('preview')||'Preview'," (smbios1):"),/*#__PURE__*/React.createElement("code",{className:"text-xs text-green-400 font-mono break-all"},buildSmbios(smbios))),/*#__PURE__*/React.createElement("div",{className:"pt-2 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-2"},t('presets')||'Quick Presets'),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>{const base=smbios.uuid?`uuid=${smbios.uuid},`:'';handleChange('options','smbios1',`${base}manufacturer=Dell,product=PowerEdgeR740,version=v1,serial=DELL${Math.random().toString(36).substr(2,8).toUpperCase()},family=Server`);},className:"px-2 py-1 bg-proxmox-card border border-proxmox-border rounded text-xs text-gray-400 hover:text-white hover:bg-proxmox-border"},"Dell Server"),/*#__PURE__*/React.createElement("button",{onClick:()=>{const base=smbios.uuid?`uuid=${smbios.uuid},`:'';handleChange('options','smbios1',`${base}manufacturer=HP,product=ProLiantDL380,version=v1,serial=MXQ${Math.random().toString(36).substr(2,8).toUpperCase()},family=Server`);},className:"px-2 py-1 bg-proxmox-card border border-proxmox-border rounded text-xs text-gray-400 hover:text-white hover:bg-proxmox-border"},"HP Server"),/*#__PURE__*/React.createElement("button",{onClick:()=>{const base=smbios.uuid?`uuid=${smbios.uuid},`:'';handleChange('options','smbios1',`${base}manufacturer=Lenovo,product=ThinkPadX1,version=v1,serial=PF${Math.random().toString(36).substr(2,8).toUpperCase()},family=ThinkPad`);},className:"px-2 py-1 bg-proxmox-card border border-proxmox-border rounded text-xs text-gray-400 hover:text-white hover:bg-proxmox-border"},"Lenovo Laptop"),/*#__PURE__*/React.createElement("button",{onClick:async()=>{// NS: fetch smbios settings from cluster config
const sanitize=v=>(v||'').replace(/\s+/g,'').replace(/[^A-Za-z0-9]/g,'');try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/smbios-autoconfig`);const settings=res?.ok?await res.json():{};const mfg=sanitize(settings.manufacturer)||'Proxmox';const prod=sanitize(settings.product)||'PegaProxManagment';const ver=sanitize(settings.version)||'v1';const fam=sanitize(settings.family)||'ProxmoxVE';const timestamp=new Date().toISOString().replace(/[-:T.Z]/g,'').slice(2,14);const randomPart=Math.floor(Math.random()*9000+1000);const base=smbios.uuid?`uuid=${smbios.uuid},`:'';handleChange('options','smbios1',`${base}manufacturer=${mfg},product=${prod},version=${ver},serial=PVE${timestamp}${randomPart},family=${fam}`);}catch(e){// fallback to defaults
const base=smbios.uuid?`uuid=${smbios.uuid},`:'';const timestamp=new Date().toISOString().replace(/[-:T.Z]/g,'').slice(2,14);const randomPart=Math.floor(Math.random()*9000+1000);handleChange('options','smbios1',`${base}manufacturer=Proxmox,product=PegaProxManagment,version=v1,serial=PVE${timestamp}${randomPart},family=ProxmoxVE`);}},className:"px-2 py-1 bg-proxmox-orange/20 border border-proxmox-orange/50 rounded text-xs text-proxmox-orange hover:bg-proxmox-orange/30",title:t('applySmbiosFromClusterConfig')||'Apply SMBIOS settings from cluster configuration'},"\uD83E\uDD84 PegaProx"),/*#__PURE__*/React.createElement("button",{onClick:()=>{const base=smbios.uuid?`uuid=${smbios.uuid},`:'';handleChange('options','smbios1',`${base}manufacturer=Microsoft,product=VirtualMachine,version=HyperV,serial=0000000000000000,family=VirtualMachine`);},className:"px-2 py-1 bg-proxmox-card border border-proxmox-border rounded text-xs text-gray-400 hover:text-white hover:bg-proxmox-border"},"Hyper-V"),/*#__PURE__*/React.createElement("button",{onClick:()=>{handleChange('options','smbios1','');},className:"px-2 py-1 bg-red-500/10 border border-red-500/30 rounded text-xs text-red-400 hover:bg-red-500/20"},t('clear')||'Clear'))));})())),!isQemu&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement(ConfigInputField,{label:"Nameserver",value:getValue('options','nameserver'),onChange:v=>handleChange('options','nameserver',v)}),/*#__PURE__*/React.createElement(ConfigInputField,{label:"Search Domain",value:getValue('options','searchdomain'),onChange:v=>handleChange('options','searchdomain',v)})))):/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-red-400"},"Konfiguration konnte nicht geladen werden")),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between px-6 py-4 border-t border-proxmox-border bg-proxmox-dark"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},vm.status==='running'&&/*#__PURE__*/React.createElement("span",{className:"text-yellow-400"},t('changesRequireRestart'))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"px-4 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-gray-300 font-medium hover:bg-proxmox-hover transition-colors"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:handleSave,disabled:!hasChanges||saving,className:"flex items-center gap-2 px-4 py-2 bg-proxmox-orange rounded-lg text-white font-medium hover:bg-orange-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},saving?/*#__PURE__*/React.createElement(Icons.RotateCw,null):/*#__PURE__*/React.createElement(Icons.Save,null),t('save'))))),showAddDisk&&/*#__PURE__*/React.createElement(AddDiskModal,{isQemu:isQemu,storageList:storageList,hardwareOptions:hardwareOptions,getNextDiskId:getNextDiskId,onAdd:handleAddDisk,onClose:()=>setShowAddDisk(false)}),showResizeDisk&&/*#__PURE__*/React.createElement(ResizeDiskModal,{disk:showResizeDisk,onResize:size=>handleResizeDisk(showResizeDisk.id,size),onClose:()=>setShowResizeDisk(null)}),showMoveDisk&&/*#__PURE__*/React.createElement(MoveDiskModal,{disk:showMoveDisk,storageList:storageList,onMove:(storage,deleteSource)=>handleMoveDisk(showMoveDisk.id,storage,deleteSource),onClose:()=>setShowMoveDisk(null)}),showEditDisk&&/*#__PURE__*/React.createElement(EditDiskBusModal,{disk:showEditDisk,hardwareOptions:hardwareOptions,vmStatus:config?.status?.status,onSave:async newBusType=>{// MK: Double-check VM is stopped before changing bus type
if(config?.status?.status==='running'){addToast(t('vmMustBeStopped')||'VM must be stopped to change disk bus type','error');return;}const oldId=showEditDisk.id;const oldBusMatch=oldId.match(/^([a-z]+)(\d+)$/);if(!oldBusMatch){addToast('Invalid disk ID format','error');return;}const oldBus=oldBusMatch[1];const oldNum=oldBusMatch[2];// Find next available ID for new bus type
const existingIds=(config?.disks||[]).map(d=>d.id);let newNum=0;while(existingIds.includes(`${newBusType}${newNum}`)){newNum++;}const newId=`${newBusType}${newNum}`;if(oldId===newId){setShowEditDisk(null);return;}try{// LW: Get current disk value and clean it for new bus type
let currentValue=config?.raw?.[oldId]||showEditDisk.volume;// MK: Strip unsupported options based on target bus type
// iothread only supported on scsi/virtio
if(!['scsi','virtio'].includes(newBusType)){currentValue=currentValue.replace(/,iothread=\d+/g,'');}// ssd only supported on scsi/virtio/sata (not ide)
if(!['scsi','virtio','sata'].includes(newBusType)){currentValue=currentValue.replace(/,ssd=\d+/g,'');}// MK: IMPORTANT - Remove size= parameter! 
// If size is present, Proxmox thinks we want to CREATE a new disk
// For reattaching existing volumes, size must be omitted
currentValue=currentValue.replace(/,size=\d+[KMGT]?/gi,'');// LW: Two-step process to avoid creating new volume:
// Delete old disk config (volume becomes "unused")
const deleteRes=await fetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/config`,{method:'PUT',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({delete:oldId})});if(!deleteRes.ok){const err=await deleteRes.json();addToast(err.error||'Error detaching old disk','error');return;}// MK: Small delay to let Proxmox process the detach
await new Promise(r=>setTimeout(r,500));// Attach volume with new bus type
const attachRes=await fetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/config`,{method:'PUT',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({[newId]:currentValue})});if(attachRes.ok){addToast(`${t('diskBusChanged')||'Disk bus changed'}: ${oldId} â†‘ ${newId}`,'success');fetchConfig();setShowEditDisk(null);}else{const err=await attachRes.json();addToast(err.error||'Error attaching disk with new bus type','error');// LW: Try to restore old config on failure
await fetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/config`,{method:'PUT',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({[oldId]:config?.raw?.[oldId]||showEditDisk.volume})});fetchConfig();}}catch(e){addToast('Error changing disk bus','error');}},onClose:()=>setShowEditDisk(null)}),showReattachDisk&&/*#__PURE__*/React.createElement(ReattachDiskModal,{disk:showReattachDisk,getNextDiskId:getNextDiskId,onReattach:async(diskId,diskValue)=>{try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/config`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({[diskId]:diskValue})});if(res&&res.ok){addToast(`${t('diskReattached')||'Disk reattached as'} ${diskId}`,'success');fetchConfig();setShowReattachDisk(null);}else{const err=await res.json();addToast(err.error||'Error reattaching disk','error');}}catch(e){addToast('Error reattaching disk','error');}},onClose:()=>setShowReattachDisk(null)}),showImportDisk&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-lg bg-proxmox-card border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-2"},t('importDisk')||'Import Disk'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mb-4"},t('importDiskDesc')||'Import existing disk image from storage'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('selectImportStorage')||'Source Storage'),/*#__PURE__*/React.createElement("select",{id:"importStorage",className:"w-full bg-proxmox-dark border border-proxmox-border rounded px-3 py-2 text-white",onChange:async e=>{const storage=e.target.value;if(!storage){setImportableDisks([]);return;}try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${vm.node}/storage/${storage}/content?content=images`);if(res&&res.ok){const data=await res.json();// Filter for disk images that could be imported
const disks=(data||[]).filter(item=>item.format&&['raw','qcow2','vmdk'].includes(item.format));setImportableDisks(disks);}}catch(e){setImportableDisks([]);}}},/*#__PURE__*/React.createElement("option",{value:""},"-- ",t('selectStorage')||'Select Storage'," --"),storageList.filter(s=>s.type!=='iso'&&s.type!=='vztmpl').map(s=>/*#__PURE__*/React.createElement("option",{key:s.storage,value:s.storage},s.storage," (",s.type,")")))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('selectDiskImage')||'Select Disk Image'),/*#__PURE__*/React.createElement("select",{id:"importDiskImage",className:"w-full bg-proxmox-dark border border-proxmox-border rounded px-3 py-2 text-white"},/*#__PURE__*/React.createElement("option",{value:""},"-- ",t('selectDiskImage')||'Select Image'," --"),importableDisks.map(disk=>/*#__PURE__*/React.createElement("option",{key:disk.volid,value:disk.volid},disk.volid," (",disk.format,", ",Math.round((disk.size||0)/1024/1024/1024)," GB)"))),importableDisks.length===0&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-yellow-500 mt-1"},t('noImportableDisks')||'No importable disk images found')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('targetBus')||'Target Bus'),/*#__PURE__*/React.createElement("select",{id:"importTargetBus",defaultValue:"scsi",className:"w-full bg-proxmox-dark border border-proxmox-border rounded px-3 py-2 text-white"},/*#__PURE__*/React.createElement("option",{value:"scsi"},"SCSI"),/*#__PURE__*/React.createElement("option",{value:"virtio"},"VirtIO"),/*#__PURE__*/React.createElement("option",{value:"sata"},"SATA"),/*#__PURE__*/React.createElement("option",{value:"ide"},"IDE"))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end pt-4"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowImportDisk(false);setImportableDisks([]);},className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover rounded text-gray-300"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{const volid=document.getElementById('importDiskImage').value;const sourceStorage=document.getElementById('importStorage').value;const targetBus=document.getElementById('importTargetBus').value;if(!volid){addToast('Please select a disk image','error');return;}// MK: Ensure volid has storage prefix (some APIs return just volume name)
let fullVolid=volid;if(!volid.includes(':')&&sourceStorage){fullVolid=`${sourceStorage}:${volid}`;}// Get next available disk ID for the bus type
const nextId=getNextDiskId(targetBus);try{// Import by setting the disk config
const res=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/config`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({[nextId]:fullVolid})});if(res&&res.ok){addToast(t('diskImported')||'Disk imported','success');await new Promise(resolve=>setTimeout(resolve,500));fetchConfig();setShowImportDisk(false);setImportableDisks([]);}else{const err=await res.json();addToast(err.error||'Error importing disk','error');}}catch(e){addToast('Error importing disk','error');}},className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded text-white"},t('import')||'Import'))))),showReassignOwner&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-lg bg-proxmox-card border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-2"},t('reassignOwner')||'Reassign Owner'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mb-4"},t('reassignOwnerDesc')||'Assign disk to a different VM'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"p-3 bg-proxmox-dark rounded"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('disk')||'Disk',":"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-white font-mono"},showReassignOwner.id),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-gray-500"},"(",showReassignOwner.volume,")")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('targetVm')||'Target VM'),/*#__PURE__*/React.createElement("select",{id:"reassignTargetVm",className:"w-full bg-proxmox-dark border border-proxmox-border rounded px-3 py-2 text-white"},/*#__PURE__*/React.createElement("option",{value:""},"-- ",t('selectVm')||'Select VM'," --"),(window.pegaproxVmList||[]).filter(v=>v.type==='qemu'&&v.vmid!==vm.vmid).map(v=>/*#__PURE__*/React.createElement("option",{key:v.vmid,value:v.vmid},v.vmid," - ",v.name)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('targetBus')||'Target Bus'),/*#__PURE__*/React.createElement("select",{id:"reassignTargetBus",defaultValue:"scsi",className:"w-full bg-proxmox-dark border border-proxmox-border rounded px-3 py-2 text-white"},/*#__PURE__*/React.createElement("option",{value:"scsi"},"SCSI"),/*#__PURE__*/React.createElement("option",{value:"virtio"},"VirtIO"),/*#__PURE__*/React.createElement("option",{value:"sata"},"SATA"))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end pt-4"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowReassignOwner(null),className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover rounded text-gray-300"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{const targetVmid=document.getElementById('reassignTargetVm').value;const targetBus=document.getElementById('reassignTargetBus').value;if(!targetVmid){addToast('Please select a target VM','error');return;}try{// Detach from current VM
const detachRes=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/disks/${showReassignOwner.id}`,{method:'DELETE'});if(!detachRes||!detachRes.ok){const err=await detachRes.json();addToast(err.error||'Error detaching disk','error');return;}// Attach to target VM
// Need to get the next available disk ID for target VM
const configRes=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/qemu/${targetVmid}/config`);let nextId=`${targetBus}0`;if(configRes&&configRes.ok){const targetConfig=await configRes.json();// Find next available ID
for(let i=0;i<30;i++){const testId=`${targetBus}${i}`;if(!targetConfig[testId]){nextId=testId;break;}}}// MK: Use full volume path (storage:volume) - disk.value has the complete string
// But we need to strip any extra options like ,size=32G
let volumePath=showReassignOwner.value||`${showReassignOwner.storage}:${showReassignOwner.volume}`;// Extract just the storage:volume part (before any comma)
volumePath=volumePath.split(',')[0];const attachRes=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/qemu/${targetVmid}/config`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({[nextId]:volumePath})});if(attachRes&&attachRes.ok){addToast(t('diskReassigned')||'Disk reassigned','success');await new Promise(resolve=>setTimeout(resolve,500));fetchConfig();setShowReassignOwner(null);}else{const err=await attachRes.json();addToast(err.error||'Error attaching to target VM','error');}}catch(e){addToast('Error reassigning disk','error');}},className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded text-white"},t('reassign')||'Reassign'))))),showMountISO&&/*#__PURE__*/React.createElement(MountISOModal,{isoList:isoList,existingDrives:// Extract existing drives from config.disks array
(config?.disks||[]).map(disk=>({key:disk.id,isCdrom:String(disk.value||'').includes('media=cdrom')})),onMount:handleMountISO,onClose:()=>setShowMountISO(false)}),showAddNetwork&&/*#__PURE__*/React.createElement(AddNetworkModal,{isQemu:isQemu,bridgeList:bridgeList,hardwareOptions:hardwareOptions,getNextNetId:getNextNetId,generateMAC:generateMAC,onAdd:handleAddNetwork,onClose:()=>setShowAddNetwork(false)}),showEditNetwork&&/*#__PURE__*/React.createElement(EditNetworkModal,{isQemu:isQemu,network:showEditNetwork,bridgeList:bridgeList,hardwareOptions:hardwareOptions,generateMAC:generateMAC,onUpdate:config=>handleUpdateNetwork(showEditNetwork.id,config),onClose:()=>setShowEditNetwork(null)}),showAddPci&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-lg bg-proxmox-card border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4"},t('addPci')),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('availableDevices')),/*#__PURE__*/React.createElement("select",{value:selectedPciDevice?.id||'',onChange:e=>setSelectedPciDevice(availablePci.find(d=>d.id===e.target.value)),className:"w-full bg-proxmox-dark border border-proxmox-border rounded px-3 py-2 text-white"},/*#__PURE__*/React.createElement("option",{value:""},"-- ",t('selectDevice')," --"),availablePci.filter(d=>d.iommugroup>=0).map(dev=>/*#__PURE__*/React.createElement("option",{key:dev.id,value:dev.id},dev.id," - ",dev.vendor_name," ",dev.device_name," (IOMMU: ",dev.iommugroup,")")))),selectedPciDevice&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-proxmox-dark rounded text-sm"},/*#__PURE__*/React.createElement("div",{className:"text-gray-400"},t('vendor'),": ",/*#__PURE__*/React.createElement("span",{className:"text-white"},selectedPciDevice.vendor_name)),/*#__PURE__*/React.createElement("div",{className:"text-gray-400"},"Device: ",/*#__PURE__*/React.createElement("span",{className:"text-white"},selectedPciDevice.device_name)),/*#__PURE__*/React.createElement("div",{className:"text-gray-400"},t('iommuGroup'),": ",/*#__PURE__*/React.createElement("span",{className:"text-white"},selectedPciDevice.iommugroup))),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:pciOptions.pcie,onChange:e=>setPciOptions({...pciOptions,pcie:e.target.checked}),className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},t('pcie'))),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:pciOptions.rombar,onChange:e=>setPciOptions({...pciOptions,rombar:e.target.checked}),className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},t('romBar')))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end pt-4"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowAddPci(false);setSelectedPciDevice(null);},className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover rounded"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:handleAddPciDevice,disabled:!selectedPciDevice||passthroughLoading,className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded disabled:opacity-50"},passthroughLoading?t('adding'):t('add')))))),showAddUsb&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-lg bg-proxmox-card border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4"},t('addUsb')),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('availableDevices')),/*#__PURE__*/React.createElement("select",{value:selectedUsbDevice?`${selectedUsbDevice.vendid}:${selectedUsbDevice.prodid}`:'',onChange:e=>{const[vid,pid]=e.target.value.split(':');setSelectedUsbDevice(availableUsb.find(d=>d.vendid===vid&&d.prodid===pid));},className:"w-full bg-proxmox-dark border border-proxmox-border rounded px-3 py-2 text-white"},/*#__PURE__*/React.createElement("option",{value:""},"-- ",t('selectDevice')," --"),availableUsb.map((dev,idx)=>/*#__PURE__*/React.createElement("option",{key:idx,value:`${dev.vendid}:${dev.prodid}`},dev.manufacturer||dev.vendid," - ",dev.product||dev.prodid)))),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:usbOptions.usb3,onChange:e=>setUsbOptions({...usbOptions,usb3:e.target.checked}),className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},t('usb3'))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end pt-4"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowAddUsb(false);setSelectedUsbDevice(null);},className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover rounded"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:handleAddUsbDevice,disabled:!selectedUsbDevice||passthroughLoading,className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded disabled:opacity-50"},passthroughLoading?t('adding'):t('add')))))),showAddSerial&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-md bg-proxmox-card border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4"},t('addSerial')),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('serialType')),/*#__PURE__*/React.createElement("select",{value:serialType,onChange:e=>setSerialType(e.target.value),className:"w-full bg-proxmox-dark border border-proxmox-border rounded px-3 py-2 text-white"},/*#__PURE__*/React.createElement("option",{value:"socket"},t('socketConsole')),/*#__PURE__*/React.createElement("option",{value:"/dev/ttyUSB0"},"/dev/ttyUSB0"),/*#__PURE__*/React.createElement("option",{value:"/dev/ttyUSB1"},"/dev/ttyUSB1"),/*#__PURE__*/React.createElement("option",{value:"/dev/ttyS0"},"/dev/ttyS0"),/*#__PURE__*/React.createElement("option",{value:"/dev/ttyS1"},"/dev/ttyS1"))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end pt-4"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddSerial(false),className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover rounded"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:handleAddSerialPort,disabled:passthroughLoading,className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded disabled:opacity-50"},passthroughLoading?t('adding'):t('add')))))),showAddEfiDisk&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-md bg-proxmox-card border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.HardDrive,{className:"text-blue-400"}),t('addEfiDisk')||'Add EFI Disk'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg text-sm text-blue-300"},t('efiDiskInfo')||'EFI disk stores UEFI firmware variables and is required for UEFI boot. Size is automatically set to 4MB.'),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('storage')||'Storage'),/*#__PURE__*/React.createElement("select",{value:efiStorage,onChange:e=>setEfiStorage(e.target.value),className:"w-full bg-proxmox-dark border border-proxmox-border rounded px-3 py-2 text-white"},/*#__PURE__*/React.createElement("option",{value:""},t('selectStorage')||'Select storage...'),storageList.filter(s=>s.content?.includes('images')).map(s=>/*#__PURE__*/React.createElement("option",{key:s.storage,value:s.storage},s.storage)))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end pt-4"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddEfiDisk(false),className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover rounded"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!efiStorage)return;setPassthroughLoading(true);try{const res=await fetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/config`,{method:'PUT',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({efidisk0:`${efiStorage}:1,efitype=4m,pre-enrolled-keys=1`})});if(res.ok){addToast(t('efiDiskAdded')||'EFI disk added','success');setShowAddEfiDisk(false);fetchConfig();}else{const err=await res.json();addToast(err.error||'Error adding EFI disk','error');}}catch(e){addToast('Error adding EFI disk','error');}setPassthroughLoading(false);},disabled:!efiStorage||passthroughLoading,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded disabled:opacity-50"},passthroughLoading?t('adding'):t('add')))))),showAddTpm&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-md bg-proxmox-card border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Shield,{className:"text-green-400"}),t('addTpm')||'Add TPM'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg text-sm text-yellow-300"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),/*#__PURE__*/React.createElement("div",null,t('tpmInfo')||'TPM (Trusted Platform Module) is required for Windows 11 and provides hardware-based security features like BitLocker.'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('storage')||'Storage'),/*#__PURE__*/React.createElement("select",{value:tpmStorage,onChange:e=>setTpmStorage(e.target.value),className:"w-full bg-proxmox-dark border border-proxmox-border rounded px-3 py-2 text-white"},/*#__PURE__*/React.createElement("option",{value:""},t('selectStorage')||'Select storage...'),storageList.filter(s=>s.content?.includes('images')).map(s=>/*#__PURE__*/React.createElement("option",{key:s.storage,value:s.storage},s.storage)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('tpmVersion')||'TPM Version'),/*#__PURE__*/React.createElement("select",{className:"w-full bg-proxmox-dark border border-proxmox-border rounded px-3 py-2 text-white",defaultValue:"v2.0"},/*#__PURE__*/React.createElement("option",{value:"v2.0"},"TPM 2.0 (",t('recommended')||'Recommended',")"),/*#__PURE__*/React.createElement("option",{value:"v1.2"},"TPM 1.2"))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end pt-4"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddTpm(false),className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover rounded"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!tpmStorage)return;setPassthroughLoading(true);try{const res=await fetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/config`,{method:'PUT',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({tpmstate0:`${tpmStorage}:1,version=v2.0`})});if(res.ok){addToast(t('tpmAdded')||'TPM added','success');setShowAddTpm(false);fetchConfig();}else{const err=await res.json();addToast(err.error||'Error adding TPM','error');}}catch(e){addToast('Error adding TPM','error');}setPassthroughLoading(false);},disabled:!tpmStorage||passthroughLoading,className:"px-4 py-2 bg-green-500 hover:bg-green-600 rounded disabled:opacity-50"},passthroughLoading?t('adding'):t('add')))))));}// Sub-modals for disk/network operations
// LW: Disk creation modal - handles both QEMU and LXC
// TODO(LW): Maybe add RAID level selection for ZFS pools?
function AddDiskModal({isQemu,storageList,hardwareOptions,getNextDiskId,onAdd,onClose}){const{t}=useTranslation();const[diskConfig,setDiskConfig]=useState({disk_id:'scsi1',storage:storageList[0]?.storage||'local-lvm',size:32,cache:'',iothread:true,ssd:false,discard:true});// MK: Get current bus type from disk_id (e.g. "scsi0" -> "scsi")
const currentBus=diskConfig.disk_id.replace(/[0-9]/g,'');// LW: iothread needs virtio-scsi-pci controller, won't work with IDE/SATA
const supportsIothread=['scsi','virtio'].includes(currentBus);// MK: ssd emulation for TRIM support - IDE doesn't support it at all
const supportsSsd=['scsi','virtio','sata'].includes(currentBus);useEffect(()=>{if(getNextDiskId){setDiskConfig(prev=>({...prev,disk_id:getNextDiskId('scsi')}));}},[]);// NS: Handle bus type change - reset unsupported options
const handleBusChange=newBus=>{const newId=getNextDiskId?getNextDiskId(newBus):newBus+'0';const busSupportsIothread=['scsi','virtio'].includes(newBus);const busSupportsSsd=['scsi','virtio','sata'].includes(newBus);setDiskConfig({...diskConfig,disk_id:newId,iothread:busSupportsIothread?diskConfig.iothread:false,ssd:busSupportsSsd?diskConfig.ssd:false});};// NS: Filter out unsupported options before sending to API
const handleAdd=()=>{const configToSend={disk_id:diskConfig.disk_id,storage:diskConfig.storage,size:diskConfig.size,discard:diskConfig.discard};// Only add cache if set
if(diskConfig.cache){configToSend.cache=diskConfig.cache;}// Only add iothread for scsi/virtio
if(supportsIothread&&diskConfig.iothread){configToSend.iothread=true;}// Only add ssd for scsi/virtio/sata
if(supportsSsd&&diskConfig.ssd){configToSend.ssd=true;}onAdd(configToSend);};return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-md bg-proxmox-card border border-proxmox-border rounded-xl p-6 animate-scale-in"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4"},t('addDisk')),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},isQemu&&hardwareOptions&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Bus/Device"),/*#__PURE__*/React.createElement("select",{value:currentBus,onChange:e=>handleBusChange(e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},(hardwareOptions?.disk_bus_types||[{value:'scsi',label:'SCSI'}]).map(bus=>/*#__PURE__*/React.createElement("option",{key:bus.value,value:bus.value},bus.label)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"ID"),/*#__PURE__*/React.createElement("input",{type:"text",value:diskConfig.disk_id,onChange:e=>setDiskConfig({...diskConfig,disk_id:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Storage"),/*#__PURE__*/React.createElement("select",{value:diskConfig.storage,onChange:e=>setDiskConfig({...diskConfig,storage:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},storageList.map(s=>{const freeBytes=s.avail||s.free||0;const totalBytes=s.total||0;const usedPercent=totalBytes>0?Math.round((1-freeBytes/totalBytes)*100):0;const freeGB=(freeBytes/(1024*1024*1024)).toFixed(1);const totalGB=(totalBytes/(1024*1024*1024)).toFixed(1);return/*#__PURE__*/React.createElement("option",{key:s.storage,value:s.storage},s.storage," (",freeGB," GB ",t('free')," / ",totalGB," GB - ",usedPercent,"% ",t('used'),")");})),diskConfig.storage&&storageList.length>0&&(()=>{const selected=storageList.find(s=>s.storage===diskConfig.storage);if(!selected)return null;const freeBytes=selected.avail||selected.free||0;const totalBytes=selected.total||0;const usedPercent=totalBytes>0?Math.round((1-freeBytes/totalBytes)*100):0;const freeGB=(freeBytes/(1024*1024*1024)).toFixed(1);return/*#__PURE__*/React.createElement("div",{className:"mt-2 p-2 bg-proxmox-darker rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-xs mb-1"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('freeSpace')||'Free',":"),/*#__PURE__*/React.createElement("span",{className:`font-medium ${freeBytes<diskConfig.size*1024*1024*1024?'text-red-400':'text-green-400'}`},freeGB," GB")),/*#__PURE__*/React.createElement("div",{className:"h-1.5 bg-proxmox-dark rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:`h-full rounded-full transition-all ${usedPercent>90?'bg-red-500':usedPercent>70?'bg-yellow-500':'bg-green-500'}`,style:{width:`${usedPercent}%`}})),freeBytes<diskConfig.size*1024*1024*1024&&diskConfig.size>0&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-red-400 mt-1"},"\u26A0\uFE0F ",t('notEnoughSpace')||'Not enough space!'));})()),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('size')," (GB)"),/*#__PURE__*/React.createElement("input",{type:"number",value:diskConfig.size,onChange:e=>setDiskConfig({...diskConfig,size:parseInt(e.target.value)||0}),min:"1",placeholder:"32",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"}))),isQemu&&hardwareOptions&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Cache"),/*#__PURE__*/React.createElement("select",{value:diskConfig.cache,onChange:e=>setDiskConfig({...diskConfig,cache:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},(hardwareOptions?.cache_modes||[{value:'',label:'Default'}]).map(c=>/*#__PURE__*/React.createElement("option",{key:c.value,value:c.value},c.label)))),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-4"},supportsIothread&&/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:diskConfig.iothread,onChange:e=>setDiskConfig({...diskConfig,iothread:e.target.checked}),className:"rounded"}),"IO Thread"),supportsSsd&&/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:diskConfig.ssd,onChange:e=>setDiskConfig({...diskConfig,ssd:e.target.checked}),className:"rounded"}),"SSD Emulation"),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:diskConfig.discard,onChange:e=>setDiskConfig({...diskConfig,discard:e.target.checked}),className:"rounded"}),"Discard")))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"px-4 py-2 text-gray-300 hover:text-white"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:handleAdd,className:"px-4 py-2 bg-proxmox-orange rounded-lg text-white hover:bg-orange-600"},t('add')))));}function ResizeDiskModal({disk,onResize,onClose}){const{t}=useTranslation();const[size,setSize]=useState('+10G');return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-sm bg-proxmox-card border border-proxmox-border rounded-xl p-6 animate-scale-in"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4"},t('resizeDisk')||'Resize Disk'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mb-4"},"Aktuelle Groesse: ",disk.size),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('resizeDiskHint')||'Increase by (e.g. +10G) or new size'),/*#__PURE__*/React.createElement("input",{type:"text",value:size,onChange:e=>setSize(e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"px-4 py-2 text-gray-300 hover:text-white"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:()=>onResize(size),className:"px-4 py-2 bg-green-600 rounded-lg text-white hover:bg-green-700"},"Vergroessern"))));}// MK: Modal for reattaching unused disks with bus type selection
// LW: Jan 2026 - Makes it easier to reattach disks with correct settings
function ReattachDiskModal({disk,getNextDiskId,onReattach,onClose}){const{t}=useTranslation();const[busType,setBusType]=useState('scsi');const[diskId,setDiskId]=useState(getNextDiskId('scsi'));const[iothread,setIothread]=useState(true);const[ssd,setSsd]=useState(false);const[discard,setDiscard]=useState(true);const[loading,setLoading]=useState(false);// MK: Update disk ID when bus type changes
const handleBusChange=newBus=>{setBusType(newBus);setDiskId(getNextDiskId(newBus));// Reset unsupported options
if(!['scsi','virtio'].includes(newBus)){setIothread(false);}if(!['scsi','virtio','sata'].includes(newBus)){setSsd(false);}};// LW: Check which options are supported
const supportsIothread=['scsi','virtio'].includes(busType);const supportsSsd=['scsi','virtio','sata'].includes(busType);const busTypes=[{value:'scsi',label:'SCSI',desc:t('scsiDesc')||'Best performance with VirtIO SCSI controller'},{value:'virtio',label:'VirtIO Block',desc:t('virtioDesc')||'Legacy VirtIO, good performance'},{value:'sata',label:'SATA',desc:t('sataDesc')||'Good compatibility, moderate performance'},{value:'ide',label:'IDE',desc:t('ideDesc')||'Maximum compatibility, lowest performance'}];const handleReattach=async()=>{if(loading)return;setLoading(true);// MK: Build disk options string
let options=[];if(supportsIothread&&iothread)options.push('iothread=1');if(supportsSsd&&ssd)options.push('ssd=1');if(discard)options.push('discard=on');const diskValue=options.length>0?`${disk.value},${options.join(',')}`:disk.value;try{await onReattach(diskId,diskValue);}finally{setLoading(false);}};return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-md bg-proxmox-card border border-proxmox-border rounded-xl p-6 animate-scale-in"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-2 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.HardDrive,{className:"text-green-400"}),t('reattachDisk')||'Reattach Disk'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mb-4"},t('volume')||'Volume',": ",/*#__PURE__*/React.createElement("span",{className:"font-mono text-white"},disk.value)),/*#__PURE__*/React.createElement("div",{className:"mb-4"},/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-2"},t('selectBusType')||'Select Bus Type'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-2"},busTypes.map(bus=>/*#__PURE__*/React.createElement("button",{key:bus.value,onClick:()=>handleBusChange(bus.value),disabled:loading,className:`p-3 rounded-lg text-left transition-all ${busType===bus.value?'bg-green-600/20 border border-green-500':'bg-proxmox-dark border border-proxmox-border hover:border-gray-500'}`},/*#__PURE__*/React.createElement("div",{className:"font-medium text-white text-sm"},bus.label),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mt-0.5"},bus.desc))))),/*#__PURE__*/React.createElement("div",{className:"mb-4"},/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('diskId')||'Disk ID'),/*#__PURE__*/React.createElement("input",{type:"text",value:diskId,onChange:e=>setDiskId(e.target.value),disabled:loading,className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm font-mono"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('nextAvailableId')||'Next available ID for selected bus type')),/*#__PURE__*/React.createElement("div",{className:"mb-4 p-3 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-2"},t('diskOptions')||'Disk Options'),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-4"},supportsIothread&&/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:iothread,onChange:e=>setIothread(e.target.checked),disabled:loading,className:"rounded"}),"IO Thread"),supportsSsd&&/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:ssd,onChange:e=>setSsd(e.target.checked),disabled:loading,className:"rounded"}),"SSD Emulation"),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:discard,onChange:e=>setDiscard(e.target.checked),disabled:loading,className:"rounded"}),"Discard (TRIM)")),!supportsIothread&&!supportsSsd&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-yellow-500 mt-2"},t('ideLimitedOptions')||'IDE has limited options available')),/*#__PURE__*/React.createElement("div",{className:"mb-4 p-3 bg-proxmox-dark/50 rounded-lg border border-dashed border-proxmox-border"},/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('preview')||'Preview'),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:"text-green-400 font-mono font-medium"},diskId),/*#__PURE__*/React.createElement(Icons.ArrowRight,{className:"w-4 h-4 text-gray-500"}),/*#__PURE__*/React.createElement("span",{className:"text-gray-300 font-mono text-sm truncate"},disk.value))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3"},/*#__PURE__*/React.createElement("button",{onClick:onClose,disabled:loading,className:"px-4 py-2 text-gray-300 hover:text-white disabled:opacity-50"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:handleReattach,disabled:loading||!diskId,className:"px-4 py-2 bg-green-600 rounded-lg text-white hover:bg-green-700 disabled:opacity-50 flex items-center gap-2"},loading&&/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-4 h-4 animate-spin"}),loading?t('attaching')||'Attaching...':t('reattach')||'Reattach'))));}// NS: Simple modal for moving disks between storages
// Works with both local and shared storage
function MoveDiskModal({disk,storageList,onMove,onClose}){const{t}=useTranslation();const[storage,setStorage]=useState(storageList.filter(s=>s.storage!==disk.storage)[0]?.storage||'');const[deleteSource,setDeleteSource]=useState(true);return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-sm bg-proxmox-card border border-proxmox-border rounded-xl p-6 animate-scale-in"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4"},t('moveDisk')||'Move Disk'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mb-4"},disk.id," - ",t('from')||'from'," ",/*#__PURE__*/React.createElement("span",{className:"text-white font-mono"},disk.storage)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('targetStorage')),/*#__PURE__*/React.createElement("select",{value:storage,onChange:e=>setStorage(e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},storageList.filter(s=>s.storage!==disk.storage).map(s=>/*#__PURE__*/React.createElement("option",{key:s.storage,value:s.storage},s.storage)))),/*#__PURE__*/React.createElement("div",{className:"mt-4 flex items-center gap-3 p-3 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement(Toggle,{checked:deleteSource,onChange:setDeleteSource,label:t('deleteSourceDisk')||'Delete source after move'})),!deleteSource&&/*#__PURE__*/React.createElement("p",{className:"mt-2 text-xs text-yellow-400/80"},t('deleteSourceDiskWarning')||'The original disk will remain on the source storage. You can remove it manually later.'),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"px-4 py-2 text-gray-300 hover:text-white"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:()=>onMove(storage,deleteSource),className:"px-4 py-2 bg-blue-600 rounded-lg text-white hover:bg-blue-700"},t('move')||'Move'))));}// MK: Edit Disk Bus Type Modal - allows changing disk from SCSI to IDE/SATA/VirtIO etc.
// LW: Added Jan 2026 - users kept asking for this in Discord
function EditDiskBusModal({disk,hardwareOptions,vmStatus,onSave,onClose}){const{t}=useTranslation();const currentBus=disk.id.replace(/[0-9]/g,'');const[newBus,setNewBus]=useState(currentBus);const[loading,setLoading]=useState(false);// MK: Check if VM is running - bus type change requires VM to be stopped
const isVmRunning=vmStatus==='running';// MK: Check which options will be stripped - use Boolean to avoid JSX rendering 0
const hasIothread=Boolean(disk.iothread&&disk.iothread>0);const hasSsd=Boolean(disk.ssd&&disk.ssd>0);const willStripIothread=hasIothread&&!['scsi','virtio'].includes(newBus);const willStripSsd=hasSsd&&!['scsi','virtio','sata'].includes(newBus);const handleSave=async()=>{if(loading||isVmRunning)return;// Prevent double-click and running VM
setLoading(true);try{await onSave(newBus);}finally{setLoading(false);}};const busTypes=[{value:'scsi',label:'SCSI',desc:t('scsiDesc')||'Best performance with VirtIO SCSI controller'},{value:'virtio',label:'VirtIO Block',desc:t('virtioDesc')||'Legacy VirtIO, good performance'},{value:'sata',label:'SATA',desc:t('sataDesc')||'Good compatibility, moderate performance'},{value:'ide',label:'IDE',desc:t('ideDesc')||'Maximum compatibility, lowest performance'}];return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-md bg-proxmox-card border border-proxmox-border rounded-xl p-6 animate-scale-in"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-2 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Edit,{className:"text-yellow-400"}),t('changeDiskBusType')||'Change Disk Bus Type'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mb-4"},t('currentDisk')||'Current',": ",/*#__PURE__*/React.createElement("span",{className:"font-mono text-white"},disk.id)," (",disk.size,")",disk.iothread&&/*#__PURE__*/React.createElement("span",{className:"ml-2 text-xs bg-green-500/20 text-green-400 px-1.5 py-0.5 rounded"},"IOthread"),disk.ssd&&/*#__PURE__*/React.createElement("span",{className:"ml-1 text-xs bg-blue-500/20 text-blue-400 px-1.5 py-0.5 rounded"},"SSD")),isVmRunning?/*#__PURE__*/React.createElement("div",{className:"p-4 bg-red-500/20 border border-red-500/50 rounded-lg mb-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-3"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-6 h-6 text-red-400 flex-shrink-0"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"font-medium text-red-400 mb-1"},t('vmIsRunning')||'VM is running'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-red-300"},t('vmMustBeStoppedForBusChange')||'The VM must be stopped before changing the disk bus type. Please shut down the VM first.')))):/*#__PURE__*/React.createElement("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg text-sm text-yellow-300 mb-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),/*#__PURE__*/React.createElement("div",null,t('diskBusWarning')||'Changing the bus type requires the VM to be stopped. The guest OS may need driver updates.'))),(willStripIothread||willStripSsd)&&!isVmRunning&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-sm text-red-300 mb-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-2"},/*#__PURE__*/React.createElement(Icons.Info,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),/*#__PURE__*/React.createElement("div",null,t('optionsWillBeRemoved')||'The following options are not supported and will be removed',":",willStripIothread&&/*#__PURE__*/React.createElement("span",{className:"ml-2 font-mono bg-red-500/20 px-1.5 py-0.5 rounded"},"IO Thread"),willStripSsd&&/*#__PURE__*/React.createElement("span",{className:"ml-2 font-mono bg-red-500/20 px-1.5 py-0.5 rounded"},"SSD")))),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-2"},t('selectNewBusType')||'Select new bus type'),busTypes.map(bus=>/*#__PURE__*/React.createElement("label",{key:bus.value,className:`flex items-center p-3 rounded-lg cursor-pointer transition-all ${newBus===bus.value?'bg-proxmox-orange/20 border border-proxmox-orange':'bg-proxmox-dark border border-proxmox-border hover:border-gray-500'} ${loading||isVmRunning?'opacity-50 pointer-events-none':''}`},/*#__PURE__*/React.createElement("input",{type:"radio",name:"busType",value:bus.value,checked:newBus===bus.value,onChange:e=>setNewBus(e.target.value),disabled:loading||isVmRunning,className:"mr-3"}),/*#__PURE__*/React.createElement("div",{className:"flex-1"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:"font-medium text-white"},bus.label),currentBus===bus.value&&/*#__PURE__*/React.createElement("span",{className:"text-xs bg-gray-600 px-2 py-0.5 rounded"},t('current')||'Current')),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-0.5"},bus.desc))))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:onClose,disabled:loading,className:"px-4 py-2 text-gray-300 hover:text-white disabled:opacity-50"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:handleSave,disabled:newBus===currentBus||loading||isVmRunning,className:"px-4 py-2 bg-yellow-600 rounded-lg text-white hover:bg-yellow-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},loading&&/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-4 h-4 animate-spin"}),isVmRunning?t('vmMustBeStopped')||'VM must be stopped':loading?t('saving')||'Saving...':t('changeBusType')||'Change Bus Type'))));}function MountISOModal({isoList,existingDrives,onMount,onClose}){const{t}=useTranslation();const[iso,setIso]=useState('');const[driveType,setDriveType]=useState('ide');const[driveNum,setDriveNum]=useState('2');// calc which drives are already in use
const usedDrives=existingDrives||[];// Available drive options
const driveOptions=[{type:'ide',nums:['0','1','2','3'],label:'IDE'},{type:'scsi',nums:['0','1','2','3','4','5'],label:'SCSI'},{type:'sata',nums:['0','1','2','3','4','5'],label:'SATA'}];const currentDrive=`${driveType}${driveNum}`;const currentDriveInfo=usedDrives.find(d=>d.key===currentDrive);const isDriveUsedByDisk=currentDriveInfo&&!currentDriveInfo.isCdrom;const isDriveCdrom=currentDriveInfo?.isCdrom;// Find first free or cdrom slot when changing drive type
const findBestSlot=type=>{const nums=driveOptions.find(o=>o.type===type)?.nums||[];// First try to find existing CD-ROM
for(const num of nums){const drive=`${type}${num}`;const info=usedDrives.find(d=>d.key===drive);if(info?.isCdrom)return num;}// Then find free slot
for(const num of nums){const drive=`${type}${num}`;const info=usedDrives.find(d=>d.key===drive);if(!info)return num;}// Default to first
return nums[0];};return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-md bg-proxmox-card border border-proxmox-border rounded-xl p-6 animate-scale-in"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4"},t('mountIso')),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('isoImage')),/*#__PURE__*/React.createElement("select",{value:iso,onChange:e=>setIso(e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"-- ",t('noIsoEject')," --"),isoList.map(i=>/*#__PURE__*/React.createElement("option",{key:i.volid,value:i.volid},i.volid.split('/').pop())))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('busType')),/*#__PURE__*/React.createElement("select",{value:driveType,onChange:e=>{const newType=e.target.value;setDriveType(newType);setDriveNum(findBestSlot(newType));},className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},driveOptions.map(opt=>/*#__PURE__*/React.createElement("option",{key:opt.type,value:opt.type},opt.label)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('device')),/*#__PURE__*/React.createElement("select",{value:driveNum,onChange:e=>setDriveNum(e.target.value),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},driveOptions.find(o=>o.type===driveType)?.nums.map(num=>{const drive=`${driveType}${num}`;const info=usedDrives.find(d=>d.key===drive);const isUsedByDisk=info&&!info.isCdrom;const isCdrom=info?.isCdrom;let label=drive;if(isCdrom)label+=` (${t('cdrom')})`;else if(isUsedByDisk)label+=` (${t('hardDisk')})`;return/*#__PURE__*/React.createElement("option",{key:num,value:num,disabled:isUsedByDisk,style:isUsedByDisk?{color:'#666'}:{}},label);})))),/*#__PURE__*/React.createElement("div",{className:"text-xs"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},t('target'),": "),/*#__PURE__*/React.createElement("span",{className:"text-proxmox-orange font-mono"},currentDrive),isDriveCdrom&&/*#__PURE__*/React.createElement("span",{className:"text-green-500 ml-2"},"\u2713 ",t('existingCdrom')),isDriveUsedByDisk&&/*#__PURE__*/React.createElement("span",{className:"text-red-500 ml-2"},"\u2717 ",t('hardDiskNotAvailable')),!currentDriveInfo&&/*#__PURE__*/React.createElement("span",{className:"text-blue-400 ml-2"},"\u25CB ",t('freeSlot')))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"px-4 py-2 text-gray-300 hover:text-white"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:()=>onMount(iso||null,currentDrive),disabled:isDriveUsedByDisk,className:`px-4 py-2 rounded-lg text-white ${isDriveUsedByDisk?'bg-gray-600 cursor-not-allowed':'bg-proxmox-orange hover:bg-orange-600'}`},iso?t('mount'):t('eject')))));}function AddNetworkModal({isQemu,bridgeList,hardwareOptions,getNextNetId,generateMAC,onAdd,onClose}){const{t}=useTranslation();const[netConfig,setNetConfig]=useState({net_id:'net1',bridge:bridgeList[0]?.iface||'vmbr0',model:'virtio',macaddr:'',firewall:true,tag:'',rate:'',mtu:'',queues:'',name:'eth0',ip:'dhcp',gw:'',ip6:'',gw6:'',hwaddr:''});useEffect(()=>{if(getNextNetId){setNetConfig(prev=>({...prev,net_id:getNextNetId()}));}},[]);return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-lg bg-proxmox-card border border-proxmox-border rounded-xl p-6 animate-scale-in max-h-[80vh] overflow-y-auto"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4"},t('addNetwork')),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Interface ID"),/*#__PURE__*/React.createElement("input",{type:"text",value:netConfig.net_id,onChange:e=>setNetConfig({...netConfig,net_id:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Bridge / VNet"),/*#__PURE__*/React.createElement("select",{value:netConfig.bridge,onChange:e=>setNetConfig({...netConfig,bridge:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},bridgeList.filter(b=>b.source!=='sdn').length>0&&/*#__PURE__*/React.createElement("optgroup",{label:"Local Bridges"},bridgeList.filter(b=>b.source!=='sdn').map(b=>/*#__PURE__*/React.createElement("option",{key:b.iface,value:b.iface},b.iface,b.comments?` - ${b.comments}`:''))),bridgeList.filter(b=>b.source==='sdn').length>0&&/*#__PURE__*/React.createElement("optgroup",{label:"SDN VNets"},bridgeList.filter(b=>b.source==='sdn').map(b=>/*#__PURE__*/React.createElement("option",{key:b.iface,value:b.iface},b.iface," - ",b.zone||'SDN',b.alias?` (${b.alias})`:''))),bridgeList.length===0&&/*#__PURE__*/React.createElement("option",{value:"vmbr0"},"vmbr0")))),isQemu&&hardwareOptions&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Model"),/*#__PURE__*/React.createElement("select",{value:netConfig.model,onChange:e=>setNetConfig({...netConfig,model:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},(hardwareOptions?.network_models||[{value:'virtio',label:'VirtIO'}]).map(m=>/*#__PURE__*/React.createElement("option",{key:m.value,value:m.value},m.label)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"MAC Adresse"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"text",value:netConfig.macaddr,onChange:e=>setNetConfig({...netConfig,macaddr:e.target.value}),placeholder:"auto",className:"flex-1 px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm font-mono"}),/*#__PURE__*/React.createElement("button",{onClick:()=>setNetConfig({...netConfig,macaddr:generateMAC()}),className:"px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-gray-400 hover:text-white text-sm"},/*#__PURE__*/React.createElement(Icons.RefreshCw,null))))),!isQemu&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Interface Name"),/*#__PURE__*/React.createElement("input",{type:"text",value:netConfig.name,onChange:e=>setNetConfig({...netConfig,name:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"MAC Adresse"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"text",value:netConfig.hwaddr,onChange:e=>setNetConfig({...netConfig,hwaddr:e.target.value}),placeholder:"auto",className:"flex-1 px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm font-mono"}),/*#__PURE__*/React.createElement("button",{onClick:()=>setNetConfig({...netConfig,hwaddr:generateMAC()}),className:"px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-gray-400 hover:text-white"},/*#__PURE__*/React.createElement(Icons.RefreshCw,null))))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"IPv4"),/*#__PURE__*/React.createElement("input",{type:"text",value:netConfig.ip,onChange:e=>setNetConfig({...netConfig,ip:e.target.value}),placeholder:"dhcp or 10.0.0.10/24",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Gateway"),/*#__PURE__*/React.createElement("input",{type:"text",value:netConfig.gw,onChange:e=>setNetConfig({...netConfig,gw:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"VLAN Tag"),/*#__PURE__*/React.createElement("input",{type:"text",value:netConfig.tag,onChange:e=>setNetConfig({...netConfig,tag:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Rate (MB/s)"),/*#__PURE__*/React.createElement("input",{type:"text",value:netConfig.rate,onChange:e=>setNetConfig({...netConfig,rate:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"MTU"),/*#__PURE__*/React.createElement("input",{type:"text",value:netConfig.mtu,onChange:e=>setNetConfig({...netConfig,mtu:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"}))),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:netConfig.firewall,onChange:e=>setNetConfig({...netConfig,firewall:e.target.checked}),className:"rounded"}),t('enableFirewall'))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"px-4 py-2 text-gray-300 hover:text-white"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:()=>onAdd(netConfig),className:"px-4 py-2 bg-proxmox-orange rounded-lg text-white hover:bg-orange-600"},t('add')))));}function EditNetworkModal({isQemu,network,bridgeList,hardwareOptions,generateMAC,onUpdate,onClose}){const{t}=useTranslation();const[editConfig,setEditConfig]=useState({bridge:network.bridge||'vmbr0',model:network.model||'virtio',macaddr:network.macaddr||'',firewall:network.firewall||false,tag:network.tag||'',rate:network.rate||'',mtu:network.mtu||'',queues:network.queues||'',// LW: Multiqueue support
link_down:network.link_down||false,// NS: Disconnect checkbox
name:network.name||'eth0',ip:network.ip||'dhcp',gw:network.gw||'',hwaddr:network.hwaddr||''});return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-lg bg-proxmox-card border border-proxmox-border rounded-xl p-6 animate-scale-in max-h-[80vh] overflow-y-auto"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4"},t('editNetwork'),": ",network.id),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},isQemu&&/*#__PURE__*/React.createElement("div",{className:`p-3 rounded-lg border ${editConfig.link_down?'bg-red-500/10 border-red-500/30':'bg-proxmox-dark border-proxmox-border'}`},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-3 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:editConfig.link_down,onChange:e=>setEditConfig({...editConfig,link_down:e.target.checked}),className:"w-4 h-4 rounded"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:`text-sm font-medium ${editConfig.link_down?'text-red-400':'text-gray-300'}`},t('disconnectNetwork')),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},t('disconnectNetworkHint'))))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Bridge / VNet"),/*#__PURE__*/React.createElement("select",{value:editConfig.bridge,onChange:e=>setEditConfig({...editConfig,bridge:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},editConfig.bridge&&!bridgeList.find(b=>b.iface===editConfig.bridge)&&/*#__PURE__*/React.createElement("option",{value:editConfig.bridge},editConfig.bridge," (current)"),bridgeList.filter(b=>b.source!=='sdn').length>0&&/*#__PURE__*/React.createElement("optgroup",{label:"Local Bridges"},bridgeList.filter(b=>b.source!=='sdn').map(b=>/*#__PURE__*/React.createElement("option",{key:b.iface,value:b.iface},b.iface,b.comments?` - ${b.comments}`:''))),bridgeList.filter(b=>b.source==='sdn').length>0&&/*#__PURE__*/React.createElement("optgroup",{label:"SDN VNets"},bridgeList.filter(b=>b.source==='sdn').map(b=>/*#__PURE__*/React.createElement("option",{key:b.iface,value:b.iface},b.iface," - ",b.zone||'SDN',b.alias?` (${b.alias})`:''))),bridgeList.length===0&&/*#__PURE__*/React.createElement("option",{value:"vmbr0"},"vmbr0"))),isQemu&&hardwareOptions&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Model"),/*#__PURE__*/React.createElement("select",{value:editConfig.model,onChange:e=>setEditConfig({...editConfig,model:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},(hardwareOptions?.network_models||[{value:'virtio',label:'VirtIO'}]).map(m=>/*#__PURE__*/React.createElement("option",{key:m.value,value:m.value},m.label)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"MAC Adresse"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"text",value:editConfig.macaddr,onChange:e=>setEditConfig({...editConfig,macaddr:e.target.value}),className:"flex-1 px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm font-mono"}),/*#__PURE__*/React.createElement("button",{onClick:()=>setEditConfig({...editConfig,macaddr:generateMAC()}),className:"px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-gray-400 hover:text-white"},/*#__PURE__*/React.createElement(Icons.RefreshCw,null))))),!isQemu&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Interface Name"),/*#__PURE__*/React.createElement("input",{type:"text",value:editConfig.name,onChange:e=>setEditConfig({...editConfig,name:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"MAC"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"text",value:editConfig.hwaddr,onChange:e=>setEditConfig({...editConfig,hwaddr:e.target.value}),className:"flex-1 px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm font-mono"}),/*#__PURE__*/React.createElement("button",{onClick:()=>setEditConfig({...editConfig,hwaddr:generateMAC()}),className:"px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-gray-400 hover:text-white"},/*#__PURE__*/React.createElement(Icons.RefreshCw,null))))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"IPv4"),/*#__PURE__*/React.createElement("input",{type:"text",value:editConfig.ip,onChange:e=>setEditConfig({...editConfig,ip:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Gateway"),/*#__PURE__*/React.createElement("input",{type:"text",value:editConfig.gw,onChange:e=>setEditConfig({...editConfig,gw:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"VLAN Tag"),/*#__PURE__*/React.createElement("input",{type:"text",value:editConfig.tag,onChange:e=>setEditConfig({...editConfig,tag:e.target.value}),placeholder:"z.B. 100",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"MTU"),/*#__PURE__*/React.createElement("input",{type:"number",value:editConfig.mtu,onChange:e=>setEditConfig({...editConfig,mtu:e.target.value}),placeholder:"1500",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Rate Limit (MB/s)"),/*#__PURE__*/React.createElement("input",{type:"number",value:editConfig.rate,onChange:e=>setEditConfig({...editConfig,rate:e.target.value}),placeholder:t('unlimited'),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),isQemu&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Multiqueue"),/*#__PURE__*/React.createElement("input",{type:"number",value:editConfig.queues,onChange:e=>setEditConfig({...editConfig,queues:e.target.value}),placeholder:"1",min:"1",max:"64",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},"1-64 Queues (nur VirtIO)"))),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:editConfig.firewall,onChange:e=>setEditConfig({...editConfig,firewall:e.target.checked}),className:"rounded"}),t('enableFirewall'))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"px-4 py-2 text-gray-300 hover:text-white"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:()=>onUpdate(editConfig),className:"px-4 py-2 bg-proxmox-orange rounded-lg text-white hover:bg-orange-600"},t('save')))));}// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PegaProx - Node Modals
// NodeShell terminal, NodeModal, ConsoleModal
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Node Shell Terminal Component using xterm.js with SSH
function NodeShellTerminal({node,clusterId,addToast}){const{t}=useTranslation();const terminalRef=useRef(null);const initRef=useRef(false);const[status,setStatus]=useState('loading');const[showLogin,setShowLogin]=useState(false);const[nodeInfo,setNodeInfo]=useState({});const[sshPort,setSshPort]=useState(null);const[credentials,setCredentials]=useState({username:'root',password:'',privateKey:'',authMethod:'password',// 'password' or 'key'
host:''// SSH host/IP (can be edited by user)
});const wsRef=useRef(null);const termRef=useRef(null);const statusRef=useRef('loading');const{sessionId}=useAuth();// NS: Get session for WebSocket auth
// Keep statusRef in sync
useEffect(()=>{statusRef.current=status;},[status]);const sendCredentials=()=>{if(wsRef.current&&wsRef.current.readyState===WebSocket.OPEN){const authData={username:credentials.username,password:credentials.authMethod==='password'?credentials.password:'',privateKey:credentials.authMethod==='key'?credentials.privateKey:'',host:credentials.host||nodeInfo.ip// Send host/IP
};wsRef.current.send(JSON.stringify(authData));setShowLogin(false);setStatus('connecting');if(termRef.current){const targetHost=credentials.host||nodeInfo.ip;const method=credentials.authMethod==='key'?'(SSH Key)':'';termRef.current.write(`\r\nVerbinde als ${credentials.username}@${targetHost} ${method}...\r\n`);}}};useEffect(()=>{if(initRef.current)return;initRef.current=true;if(!terminalRef.current)return;let term=null;let ws=null;let fitAddon=null;let cleanup=false;const loadTerminal=async()=>{try{// Load xterm CSS - try local first
if(!document.getElementById('xterm-css')){const link=document.createElement('link');link.id='xterm-css';link.rel='stylesheet';link.href='/static/css/xterm.min.css';link.onerror=()=>{link.href='https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css';};document.head.appendChild(link);}// Load xterm.js - try local first, with SRI for CDN
if(!window.Terminal){await new Promise((resolve,reject)=>{const script=document.createElement('script');script.src='/static/js/xterm.min.js';script.onload=resolve;script.onerror=()=>{script.src='https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js';if(SRI_HASHES['xterm@5.3.0']){script.integrity=SRI_HASHES['xterm@5.3.0'];script.crossOrigin='anonymous';}script.onload=resolve;script.onerror=reject;};document.head.appendChild(script);});}// Load fit addon - try local first
if(!window.FitAddon){await new Promise((resolve,reject)=>{const script=document.createElement('script');script.src='/static/js/xterm-addon-fit.min.js';script.onload=resolve;script.onerror=()=>{script.src='https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js';if(SRI_HASHES['xterm-addon-fit@0.8.0']){script.integrity=SRI_HASHES['xterm-addon-fit@0.8.0'];script.crossOrigin='anonymous';}script.onload=resolve;script.onerror=reject;};document.head.appendChild(script);});}if(cleanup)return;// Create terminal
term=new window.Terminal({cursorBlink:true,fontSize:14,fontFamily:'Menlo, Monaco, "Courier New", monospace',theme:{background:'#1a1a2e',foreground:'#e4e4e7',cursor:'#e4e4e7'}});termRef.current=term;fitAddon=new window.FitAddon.FitAddon();term.loadAddon(fitAddon);term.open(terminalRef.current);setTimeout(()=>fitAddon&&fitAddon.fit(),50);// idk why 50ms but it works
setStatus('connecting');term.write('Verbinde zum Server...\r\n');// First, try to get the node IP via API
let nodeIp='';try{term.write('Ermittle Node-IP...\r\n');const ipResponse=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/ip`,{credentials:'include',headers:{'X-Session-ID':sessionId}});if(ipResponse.ok){const ipData=await ipResponse.json();nodeIp=ipData.ip||'';if(nodeIp){term.write(`Node-IP: ${nodeIp} (${ipData.source})\r\n`);}}}catch(e){console.log('Could not fetch node IP:',e);term.write(`\x1b[33m${t('ipFetchFailed')}: ${e.message}\x1b[0m\r\n`);}// Connect WebSocket - Shell runs on main port + 2
const wsProtocol=window.location.protocol==='https:'?'wss:':'ws:';const mainPort=parseInt(window.location.port)||(window.location.protocol==='https:'?443:80);const sshPortNum=mainPort+2;setSshPort(sshPortNum);const wsUrl=`${wsProtocol}//${window.location.hostname}:${sshPortNum}/api/clusters/${clusterId}/nodes/${node}/shellws?session=${sessionId||''}&ip=${encodeURIComponent(nodeIp)}`;term.write(`${t('connectingWs')} (Port ${sshPortNum})...\r\n`);console.log('SSH WebSocket connecting to:',wsUrl);ws=new WebSocket(wsUrl);wsRef.current=ws;ws.onopen=()=>{console.log('SSH WebSocket connected');term.write(`${t('wsConnected')}\r\n`);};ws.onmessage=event=>{const data=event.data;// Check for JSON status messages
if(typeof data==='string'){// Try to parse as JSON
if(data.startsWith('{')){try{const msg=JSON.parse(data);// console.log('ws msg:', msg);  // very spammy
if(msg.status==='need_credentials'){setNodeInfo({node:msg.node,ip:msg.ip||'',allowManualIp:msg.allowManualIp||!msg.ip});// Pre-fill host if we have an IP
if(msg.ip){setCredentials(prev=>({...prev,host:msg.ip}));}setShowLogin(true);setStatus('login');return;}else if(msg.status==='connecting'){term.write('SSH Verbindung wird aufgebaut...\r\n');return;}else if(msg.status==='connected'){setStatus('connected');statusRef.current='connected';term.clear();return;}else if(msg.status==='error'){term.write(`\r\n\x1b[31m${msg.message}\x1b[0m\r\n`);setStatus('error');// Show login again on auth failure
if(msg.message.includes('Login')||msg.message.includes('auth')||msg.message.includes('Host')){setTimeout(()=>{setShowLogin(true);setStatus('login');},1500);}return;}}catch(e){// Not valid JSON, write to terminal
term.write(data);}}else{// Regular string data
term.write(data);}}else if(data instanceof ArrayBuffer){term.write(new TextDecoder().decode(data));}else if(data instanceof Blob){data.arrayBuffer().then(buf=>{term.write(new TextDecoder().decode(buf));});}};ws.onerror=err=>{console.error('WebSocket error:',err);if(!cleanup){const isHttps=window.location.protocol==='https:';const displayPort=sshPort||sshPortNum;// Get translated messages
const errorTitle=t('wsConnectionFailed');const certTitle=t('certInstructions');const step1=t('certStep1');const step2=t('certStep2');const step3=t('certStep3');const checkLogs=t('checkServerLogs');term.write('\r\n\x1b[31mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\x1b[0m\r\n');term.write(`\x1b[31m  ${errorTitle}\x1b[0m\r\n`);term.write('\x1b[31mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\x1b[0m\r\n\r\n');if(isHttps){term.write(`\x1b[33mâš ï¸  ${certTitle}\x1b[0m\r\n\r\n`);term.write(`\x1b[36m${step1}\x1b[0m\r\n`);term.write(`   \x1b[4mhttps://${window.location.hostname}:${displayPort}/\x1b[0m\r\n\r\n`);term.write(`\x1b[36m${step2}\x1b[0m\r\n\r\n`);term.write(`\x1b[36m${step3}\x1b[0m\r\n\r\n`);}else{term.write(`\x1b[90m${checkLogs}\x1b[0m\r\n`);}setStatus('error');}};ws.onclose=event=>{console.log('WebSocket closed:',event.code,event.reason);if(!cleanup){// Different messages based on close code
let msg='Verbindung beendet';if(event.code===1006){msg='Verbindung unerwartet getrennt';}else if(event.code===1011){msg='Server-Fehler';}else if(event.reason){msg=event.reason;}term.write(`\r\n\x1b[33m${msg}\x1b[0m\r\n`);term.write(`\x1b[90m(${t('switchTabToReconnect')||'Switch tab and back to reconnect'})\x1b[0m\r\n`);setStatus('disconnected');}};// Terminal input -> WebSocket (only when connected)
term.onData(data=>{if(ws&&ws.readyState===WebSocket.OPEN&&statusRef.current==='connected'){ws.send(data);}});// handle resize
const handleResize=()=>{if(fitAddon){fitAddon.fit();if(ws&&ws.readyState===WebSocket.OPEN&&term&&statusRef.current==='connected'){ws.send(JSON.stringify({type:'resize',cols:term.cols,rows:term.rows}));}}};window.addEventListener('resize',handleResize);}catch(err){console.error('Terminal error:',err);setStatus('error');}};loadTerminal();return()=>{cleanup=true;if(ws)ws.close();if(term)term.dispose();};},[node,clusterId]);return/*#__PURE__*/React.createElement("div",{className:"w-full h-full relative"},/*#__PURE__*/React.createElement("div",{ref:terminalRef,className:"w-full h-full"}),status==='loading'&&/*#__PURE__*/React.createElement("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80"},/*#__PURE__*/React.createElement("div",{className:"text-center"},/*#__PURE__*/React.createElement("div",{className:"animate-spin w-8 h-8 border-2 border-proxmox-orange border-t-transparent rounded-full mx-auto mb-2"}),/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"Lade Terminal..."))),showLogin&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 flex items-center justify-center bg-black/90 z-[100] p-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-6 w-full max-w-md shadow-2xl max-h-[85vh] overflow-y-auto"},/*#__PURE__*/React.createElement("h3",{className:"text-white font-semibold mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Terminal,null),"SSH Login - ",nodeInfo.node),/*#__PURE__*/React.createElement("div",{className:"mb-4"},/*#__PURE__*/React.createElement("label",{className:"block text-gray-400 text-sm mb-1"},"Host / IP",nodeInfo.allowManualIp&&/*#__PURE__*/React.createElement("span",{className:"text-yellow-500 ml-2 text-xs"},"(",t('autoDetectionFailed'),")")),/*#__PURE__*/React.createElement("input",{type:"text",value:credentials.host||nodeInfo.ip||'',onChange:e=>setCredentials({...credentials,host:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white focus:border-proxmox-orange focus:outline-none font-mono",placeholder:"192.168.1.100 oder hostname"})),/*#__PURE__*/React.createElement("div",{className:"flex mb-4 bg-proxmox-dark rounded-lg p-1"},/*#__PURE__*/React.createElement("button",{onClick:()=>setCredentials({...credentials,authMethod:'password'}),className:`flex-1 py-2 px-3 rounded-md text-sm font-medium transition-colors ${credentials.authMethod==='password'?'bg-proxmox-orange text-white':'text-gray-400 hover:text-white'}`},/*#__PURE__*/React.createElement(Icons.Key,{className:"inline w-4 h-4 mr-1"}),"Password"),/*#__PURE__*/React.createElement("button",{onClick:()=>setCredentials({...credentials,authMethod:'key'}),className:`flex-1 py-2 px-3 rounded-md text-sm font-medium transition-colors ${credentials.authMethod==='key'?'bg-proxmox-orange text-white':'text-gray-400 hover:text-white'}`},/*#__PURE__*/React.createElement(Icons.FileKey,{className:"inline w-4 h-4 mr-1"}),"SSH Key")),/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-gray-400 text-sm mb-1"},"Username"),/*#__PURE__*/React.createElement("input",{type:"text",value:credentials.username,onChange:e=>setCredentials({...credentials,username:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white focus:border-proxmox-orange focus:outline-none",placeholder:"root"})),credentials.authMethod==='password'?/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-gray-400 text-sm mb-1"},"Password"),/*#__PURE__*/React.createElement("input",{type:"password",value:credentials.password,onChange:e=>setCredentials({...credentials,password:e.target.value}),onKeyDown:e=>e.key==='Enter'&&credentials.password&&sendCredentials(),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white focus:border-proxmox-orange focus:outline-none",placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"})):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-gray-400 text-sm mb-1"},"Private Key",/*#__PURE__*/React.createElement("span",{className:"text-gray-500 ml-1 text-xs"},"(id_rsa, id_ed25519, etc.)")),/*#__PURE__*/React.createElement("div",{className:"mb-2 border-2 border-dashed border-proxmox-border rounded-lg p-4 text-center cursor-pointer hover:border-proxmox-orange transition-colors",onClick:()=>document.getElementById('ssh-key-file-input').click(),onDragOver:e=>{e.preventDefault();e.currentTarget.classList.add('border-proxmox-orange');},onDragLeave:e=>{e.preventDefault();e.currentTarget.classList.remove('border-proxmox-orange');},onDrop:e=>{e.preventDefault();e.currentTarget.classList.remove('border-proxmox-orange');const file=e.dataTransfer.files[0];if(file){const reader=new FileReader();reader.onload=ev=>setCredentials({...credentials,privateKey:ev.target.result});reader.readAsText(file);}}},/*#__PURE__*/React.createElement("div",{className:"w-8 h-8 mx-auto mb-2 text-gray-500"},/*#__PURE__*/React.createElement("svg",{className:"w-full h-full",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"}))),/*#__PURE__*/React.createElement("span",{className:"text-gray-400 text-sm"},t('dropKeyFileHere')||'Drop key file here or click'),/*#__PURE__*/React.createElement("input",{id:"ssh-key-file-input",type:"file",className:"hidden",onChange:e=>{const file=e.target.files[0];if(file){const reader=new FileReader();reader.onload=ev=>setCredentials({...credentials,privateKey:ev.target.result});reader.readAsText(file);}}})),/*#__PURE__*/React.createElement("textarea",{value:credentials.privateKey,onChange:e=>setCredentials({...credentials,privateKey:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white focus:border-proxmox-orange focus:outline-none font-mono text-xs resize-y",placeholder:"-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAA...\n-----END OPENSSH PRIVATE KEY-----",rows:8,style:{minHeight:'120px'}}),credentials.privateKey&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-green-400 mt-1"},"\u2713 ",t('keyLoaded')||'Key loaded'," (",credentials.privateKey.split('\n').length," ",t('lines')||'lines',")")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-gray-400 text-sm mb-1"},t('keyPassphrase')||'Key Passphrase'," ",/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"(",t('optional')||'optional',")")),/*#__PURE__*/React.createElement("input",{type:"password",value:credentials.password,onChange:e=>setCredentials({...credentials,password:e.target.value}),onKeyDown:e=>e.key==='Enter'&&credentials.privateKey&&sendCredentials(),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white focus:border-proxmox-orange focus:outline-none",placeholder:t('ifKeyEncrypted')||'If key is encrypted...'}))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 pt-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowLogin(false);setStatus('disconnected');if(wsRef.current)wsRef.current.close();if(termRef.current)termRef.current.write('\r\n\x1b[33mCancelled\x1b[0m\r\n');},className:"flex-1 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-500 transition-colors"},t('cancel')||'Cancel'),/*#__PURE__*/React.createElement("button",{onClick:sendCredentials,disabled:!(credentials.host||nodeInfo.ip)||(credentials.authMethod==='password'?!credentials.password:!credentials.privateKey),className:"flex-1 py-2 bg-proxmox-orange text-white rounded-lg hover:bg-orange-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},t('connect')||'Connect'))))));}// Node Management Modal Component
// NS: Full node management - shell, network, disks, etc.
// Shell tab uses xterm.js (web terminal), pretty cool
// LW: I did the UI, Marcus handled the backend websocket stuff
function NodeModal({node,clusterId,onClose,addToast}){const{t}=useTranslation();const{getAuthHeaders}=useAuth();// NS: Fix - need auth!
const[activeTab,setActiveTab]=useState('summary');const[loading,setLoading]=useState(true);const[data,setData]=useState({});// NS: Disk creation modal state - Dec 2025
const[diskModal,setDiskModal]=useState({open:false,type:null});const[diskForm,setDiskForm]=useState({device:'',name:'',vgname:'',thinpool:'',devices:[],raidlevel:'single',compression:'on',ashift:12,filesystem:'ext4',add_storage:true});const[diskCreating,setDiskCreating]=useState(false);const[perfTimeframe,setPerfTimeframe]=useState('hour');// NS: For performance metrics
const authHeaders=getAuthHeaders();// NS: Get auth headers
const tabs=[{id:'summary',label:'Summary',icon:Icons.Activity},{id:'performance',label:'Performance',icon:Icons.BarChart},{id:'shell',label:'Shell',icon:Icons.Terminal},{id:'network',label:'Network',icon:Icons.Network},{id:'system',label:'System',icon:Icons.Cog},{id:'disks',label:'Disks',icon:Icons.HardDrive},{id:'repos',label:'Repositories',icon:Icons.Package},{id:'tasks',label:'Tasks',icon:Icons.Play},{id:'subscription',label:'Subscription',icon:Icons.Shield},{id:'ceph',label:'Ceph',icon:Icons.Database}];useEffect(()=>{loadTabData(activeTab);},[activeTab,perfTimeframe]);const loadTabData=async tab=>{setLoading(true);try{const endpoints={summary:[`${API_URL}/clusters/${clusterId}/nodes/${node}/summary`],performance:[`${API_URL}/clusters/${clusterId}/nodes/${node}/rrddata?timeframe=${perfTimeframe}`],network:[`${API_URL}/clusters/${clusterId}/nodes/${node}/network`],system:[`${API_URL}/clusters/${clusterId}/nodes/${node}/dns`,`${API_URL}/clusters/${clusterId}/nodes/${node}/hosts`,`${API_URL}/clusters/${clusterId}/nodes/${node}/time`,`${API_URL}/clusters/${clusterId}/nodes/${node}/syslog?limit=100`,`${API_URL}/clusters/${clusterId}/nodes/${node}/certificates`],disks:[`${API_URL}/clusters/${clusterId}/nodes/${node}/disks`,`${API_URL}/clusters/${clusterId}/nodes/${node}/disks/lvm`,`${API_URL}/clusters/${clusterId}/nodes/${node}/disks/lvmthin`,`${API_URL}/clusters/${clusterId}/nodes/${node}/disks/zfs`],repos:[`${API_URL}/clusters/${clusterId}/nodes/${node}/repos`],tasks:[`${API_URL}/clusters/${clusterId}/nodes/${node}/tasks?limit=50`],subscription:[`${API_URL}/clusters/${clusterId}/nodes/${node}/subscription`],ceph:[`${API_URL}/clusters/${clusterId}/nodes/${node}/ceph/status`,`${API_URL}/clusters/${clusterId}/nodes/${node}/ceph/osd`,`${API_URL}/clusters/${clusterId}/nodes/${node}/ceph/mon`,`${API_URL}/clusters/${clusterId}/nodes/${node}/ceph/pool`]};const urls=endpoints[tab]||[];// NS: Fixed - now using auth headers and credentials!
const results=await Promise.all(urls.map(u=>fetch(u,{credentials:'include',headers:authHeaders}).then(r=>r.ok?r.json():null).catch(()=>null)));const newData={...data};if(tab==='summary')newData.summary=results[0];else if(tab==='network')newData.network=results[0];else if(tab==='system'){newData.dns=results[0]||{};newData.hosts=results[1]?.data||'';newData.time=results[2]||{};newData.syslog=results[3]||[];newData.certificates=results[4]||[];}else if(tab==='disks'){newData.disks=results[0]||[];newData.lvm=results[1]||[];newData.lvmthin=results[2]||[];newData.zfs=results[3]||[];}else if(tab==='performance')newData.performance=results[0]||{};else if(tab==='repos')newData.repos=results[0]?.repositories||[];else if(tab==='tasks')newData.tasks=results[0]||[];else if(tab==='subscription')newData.subscription=results[0]||{};else if(tab==='ceph'){// Ceph might not be installed - handle gracefully
newData.ceph={status:results[0],osd:results[1]||[],mon:results[2]||[],pools:results[3]||[],available:results[0]!==null};}setData(newData);}catch(e){console.error(e);}setLoading(false);};// NS: minified helpers for this component, dont judge me
const formatBytes=b=>{if(!b)return'0 B';const k=1024,s=['B','KB','MB','GB','TB'],i=Math.floor(Math.log(b)/Math.log(k));return(b/Math.pow(k,i)).toFixed(1)+' '+s[i];};const formatUptime=s=>{if(!s)return'0s';const d=Math.floor(s/86400),h=Math.floor(s%86400/3600),m=Math.floor(s%3600/60);return`${d}d ${h}h ${m}m`;};const handleSave=async(endpoint,payload,msg)=>{try{const res=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/${endpoint}`,{credentials:'include',method:endpoint.includes('hosts')?'POST':'PUT',headers:{'Content-Type':'application/json',...authHeaders},body:JSON.stringify(payload)});addToast(res.ok?msg:t('error')||'Error',res.ok?'success':'error');if(res.ok)loadTabData(activeTab);}catch(e){addToast(t('error')||'Error','error');}};// NS: Disk creation functions - Dec 2025
const unusedDisks=(data.disks||[]).filter(d=>d.used==='unused'||!d.used);const openDiskModal=async type=>{setDiskForm({device:'',name:'',vgname:'',thinpool:'',devices:[],raidlevel:'single',compression:'on',ashift:12,filesystem:'ext4',add_storage:true});// NS: Make sure disk data is loaded before opening modal
if(!data.disks||data.disks.length===0){await loadTabData('disks');}setDiskModal({open:true,type});};const createDisk=async()=>{const{type}=diskModal;let endpoint,body;if(type==='lvm'){if(!diskForm.device||!diskForm.name){addToast('Device and name required','error');return;}endpoint='disks/lvm';body={device:diskForm.device,name:diskForm.name,add_storage:diskForm.add_storage};}else if(type==='lvmthin'){// NS: For LVM-thin, device = VG name where thin pool is created
if(!diskForm.vgname||!diskForm.name){addToast('Volume group and pool name required','error');return;}endpoint='disks/lvmthin';body={device:diskForm.vgname,name:diskForm.name,add_storage:diskForm.add_storage};}else if(type==='zfs'){if(diskForm.devices.length===0||!diskForm.name){addToast('Device(s) and name required','error');return;}endpoint='disks/zfs';body={devices:diskForm.devices,name:diskForm.name,raidlevel:diskForm.raidlevel,compression:diskForm.compression,ashift:diskForm.ashift,add_storage:diskForm.add_storage};}else if(type==='directory'){if(!diskForm.device||!diskForm.name){addToast('Device and name required','error');return;}endpoint='disks/directory';body={device:diskForm.device,name:diskForm.name,filesystem:diskForm.filesystem,add_storage:diskForm.add_storage};}if(!endpoint){addToast('Unknown storage type','error');return;}setDiskCreating(true);try{console.log('Creating disk:',endpoint,body);const res=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/${endpoint}`,{method:'POST',credentials:'include',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});const result=await res.json();console.log('Create disk response:',res.status,result);if(res.ok){addToast(`${type.toUpperCase()} created successfully`,'success');setDiskModal({open:false,type:null});await loadTabData('disks');}else{addToast(result.error||'Failed to create','error');}}catch(e){console.error('Error creating storage:',e);addToast('Error creating storage','error');}finally{setDiskCreating(false);}};// Disk Create Modal Component
const DiskCreateModal=()=>{if(!diskModal.open)return null;const{type}=diskModal;return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/70",onClick:()=>setDiskModal({open:false,type:null})},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-lg",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex items-center justify-between"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold text-white"},type==='lvm'&&'Create LVM Volume Group',type==='lvmthin'&&'Create LVM-Thin Pool',type==='zfs'&&'Create ZFS Pool',type==='directory'&&'Create Directory Storage'),/*#__PURE__*/React.createElement("button",{onClick:()=>setDiskModal({open:false,type:null}),className:"p-1 hover:bg-proxmox-dark rounded"},/*#__PURE__*/React.createElement(Icons.X,null))),/*#__PURE__*/React.createElement("div",{className:"p-4 space-y-4"},(type==='lvm'||type==='directory')&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Device *"),/*#__PURE__*/React.createElement("select",{value:diskForm.device,onChange:e=>setDiskForm({...diskForm,device:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Select disk..."),unusedDisks.map(d=>/*#__PURE__*/React.createElement("option",{key:d.devpath,value:d.devpath},d.devpath," - ",formatBytes(d.size)," (",d.type||'hdd',")"))),unusedDisks.length===0&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-yellow-400 mt-1"},"No unused disks available")),type==='lvmthin'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Volume Group *"),/*#__PURE__*/React.createElement("select",{value:diskForm.vgname,onChange:e=>setDiskForm({...diskForm,vgname:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Select VG..."),Array.isArray(data.lvm)&&data.lvm.map(v=>/*#__PURE__*/React.createElement("option",{key:v.vg,value:v.vg},v.vg," - ",formatBytes(v.free)," free of ",formatBytes(v.size)))),(!Array.isArray(data.lvm)||data.lvm.length===0)&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-yellow-400 mt-1"},"\u26A0\uFE0F No LVM Volume Groups found. Create an LVM VG first before creating a thin pool.")),type==='zfs'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Devices *"),/*#__PURE__*/React.createElement("div",{className:"space-y-1 max-h-32 overflow-y-auto bg-proxmox-dark border border-proxmox-border rounded p-2"},unusedDisks.length>0?unusedDisks.map(d=>/*#__PURE__*/React.createElement("label",{key:d.devpath,className:"flex items-center gap-2 text-sm cursor-pointer hover:bg-proxmox-hover p-1 rounded"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:diskForm.devices.includes(d.devpath),onChange:e=>{if(e.target.checked){setDiskForm({...diskForm,devices:[...diskForm.devices,d.devpath]});}else{setDiskForm({...diskForm,devices:diskForm.devices.filter(x=>x!==d.devpath)});}},className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"font-mono"},d.devpath),/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"(",formatBytes(d.size),", ",d.type||'hdd',")"))):/*#__PURE__*/React.createElement("p",{className:"text-xs text-yellow-400"},"No unused disks available")),diskForm.devices.length>0&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},diskForm.devices.length," disk(s) selected")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},type==='lvmthin'?'Pool Name *':type==='zfs'?'Pool Name *':'Name *'),/*#__PURE__*/React.createElement("input",{value:diskForm.name,onChange:e=>setDiskForm({...diskForm,name:e.target.value}),placeholder:type==='lvm'?'myvg':type==='lvmthin'?'data':type==='zfs'?'tank':'storage',className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"})),type==='zfs'&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"RAID Level"),/*#__PURE__*/React.createElement("select",{value:diskForm.raidlevel,onChange:e=>setDiskForm({...diskForm,raidlevel:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:"single"},"Single"),/*#__PURE__*/React.createElement("option",{value:"mirror"},"Mirror"),/*#__PURE__*/React.createElement("option",{value:"raid10"},"RAID10"),/*#__PURE__*/React.createElement("option",{value:"raidz"},"RAIDZ"),/*#__PURE__*/React.createElement("option",{value:"raidz2"},"RAIDZ2"),/*#__PURE__*/React.createElement("option",{value:"raidz3"},"RAIDZ3"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Compression"),/*#__PURE__*/React.createElement("select",{value:diskForm.compression,onChange:e=>setDiskForm({...diskForm,compression:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:"on"},"On (LZ4)"),/*#__PURE__*/React.createElement("option",{value:"off"},"Off"),/*#__PURE__*/React.createElement("option",{value:"lz4"},"LZ4"),/*#__PURE__*/React.createElement("option",{value:"zstd"},"ZSTD"),/*#__PURE__*/React.createElement("option",{value:"gzip"},"GZIP"),/*#__PURE__*/React.createElement("option",{value:"lzjb"},"LZJB"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"ashift"),/*#__PURE__*/React.createElement("select",{value:diskForm.ashift,onChange:e=>setDiskForm({...diskForm,ashift:parseInt(e.target.value)}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:9},"9 (512B)"),/*#__PURE__*/React.createElement("option",{value:12},"12 (4K)"),/*#__PURE__*/React.createElement("option",{value:13},"13 (8K)")))),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},"\u2139\uFE0F Use ashift=12 for modern drives (4K sectors). Mirror needs 2+ disks, RAIDZ needs 3+, RAIDZ2 needs 4+.")),type==='directory'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Filesystem"),/*#__PURE__*/React.createElement("select",{value:diskForm.filesystem,onChange:e=>setDiskForm({...diskForm,filesystem:e.target.value}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded p-2 text-sm"},/*#__PURE__*/React.createElement("option",{value:"ext4"},"ext4 (recommended)"),/*#__PURE__*/React.createElement("option",{value:"xfs"},"XFS"))),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:diskForm.add_storage,onChange:e=>setDiskForm({...diskForm,add_storage:e.target.checked}),className:"rounded"}),"Add to Proxmox VE storage configuration")),/*#__PURE__*/React.createElement("div",{className:"p-4 border-t border-proxmox-border flex justify-end gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setDiskModal({open:false,type:null}),disabled:diskCreating,className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover disabled:opacity-50 rounded-lg text-sm"},"Cancel"),/*#__PURE__*/React.createElement("button",{onClick:createDisk,disabled:diskCreating||!diskForm.name||type==='lvm'&&!diskForm.device||type==='lvmthin'&&!diskForm.vgname||type==='zfs'&&diskForm.devices.length===0||type==='directory'&&!diskForm.device,className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg text-sm text-white flex items-center gap-2"},diskCreating&&/*#__PURE__*/React.createElement("span",{className:"animate-spin"},"\u23F3"),diskCreating?'Creating...':'Create'))));};return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop bg-black/80"},/*#__PURE__*/React.createElement(DiskCreateModal,null),/*#__PURE__*/React.createElement("div",{className:"w-full max-w-6xl max-h-[90vh] bg-proxmox-card border border-proxmox-border rounded-2xl shadow-2xl animate-scale-in overflow-hidden flex flex-col"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between px-6 py-4 border-b border-proxmox-border bg-proxmox-dark"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-2 rounded-lg bg-green-500/10"},/*#__PURE__*/React.createElement(Icons.Server,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:"font-semibold text-white"},node),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-400"},"Proxmox Node"))),/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"p-2 rounded-lg hover:bg-red-500/20 text-gray-400 hover:text-red-400"},/*#__PURE__*/React.createElement(Icons.X,null))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1 px-6 py-3 border-b border-proxmox-border bg-proxmox-dark/50 overflow-x-auto"},tabs.map(tab=>/*#__PURE__*/React.createElement("button",{key:tab.id,onClick:()=>setActiveTab(tab.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all whitespace-nowrap ${activeTab===tab.id?'bg-proxmox-orange text-white':'text-gray-400 hover:text-white hover:bg-proxmox-hover'}`},/*#__PURE__*/React.createElement(tab.icon,null),tab.label))),/*#__PURE__*/React.createElement("div",{className:"flex-1 overflow-y-auto p-6"},loading?/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center h-64"},/*#__PURE__*/React.createElement("div",{className:"animate-spin w-8 h-8 border-2 border-proxmox-orange border-t-transparent rounded-full"})):/*#__PURE__*/React.createElement(React.Fragment,null,activeTab==='summary'&&data.summary&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-4 gap-4"},[{label:'Status',value:data.summary.status,color:'text-green-400'},{label:'Uptime',value:formatUptime(data.summary.uptime),color:'text-white'},{label:'CPU',value:`${((data.summary.cpu||0)*100).toFixed(1)}%`,color:'text-proxmox-orange'},{label:'Load',value:(data.summary.loadavg||[]).join(', '),color:'text-white'}].map((item,i)=>/*#__PURE__*/React.createElement("div",{key:i,className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-1"},item.label),/*#__PURE__*/React.createElement("div",{className:`text-lg font-semibold ${item.color}`},item.value)))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-4"},[{label:'Memory',used:data.summary.memory?.used,total:data.summary.memory?.total,color:'bg-proxmox-orange'},{label:'Swap',used:data.summary.swap?.used,total:data.summary.swap?.total,color:'bg-blue-500'},{label:'Root FS',used:data.summary.rootfs?.used,total:data.summary.rootfs?.total,color:'bg-green-500'}].map((item,i)=>/*#__PURE__*/React.createElement("div",{key:i,className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"text-sm font-medium text-white mb-3"},item.label),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-sm"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"Used"),/*#__PURE__*/React.createElement("span",{className:"text-white"},formatBytes(item.used))),/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-sm"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"Total"),/*#__PURE__*/React.createElement("span",{className:"text-white"},formatBytes(item.total))),/*#__PURE__*/React.createElement("div",{className:"w-full bg-proxmox-hover rounded-full h-2"},/*#__PURE__*/React.createElement("div",{className:`${item.color} h-2 rounded-full`,style:{width:`${(item.used||0)/(item.total||1)*100}%`}})))))),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"text-sm font-medium text-white mb-3"},"System Info"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4 text-sm"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"Kernel:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-white font-mono"},data.summary.kversion)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"PVE:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-white"},data.summary.pveversion)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"CPU:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-white"},data.summary.cpuinfo?.model)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"Cores:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-white"},data.summary.cpuinfo?.cores," (",data.summary.cpuinfo?.cpus," CPUs)"))))),activeTab==='performance'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.BarChart,null)," Performance Metrics"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},['hour','day','week','month','year'].map(tf=>/*#__PURE__*/React.createElement("button",{key:tf,onClick:()=>setPerfTimeframe(tf),className:`px-3 py-1.5 rounded-lg text-sm ${perfTimeframe===tf?'bg-proxmox-orange text-white':'bg-proxmox-dark text-gray-400 hover:text-white'}`},tf.charAt(0).toUpperCase()+tf.slice(1))))),data.performance?.metrics?/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement(LineChart,{data:data.performance.metrics.cpu,timestamps:data.performance.timestamps,label:"CPU Usage",color:"#f97316",unit:"%",yMin:0,yMax:100}),/*#__PURE__*/React.createElement(LineChart,{data:data.performance.metrics.memory,timestamps:data.performance.timestamps,label:"Memory Usage",color:"#3b82f6",unit:"%",yMin:0,yMax:100}),/*#__PURE__*/React.createElement(LineChart,{data:data.performance.metrics.iowait,timestamps:data.performance.timestamps,label:"IO Wait",color:"#eab308",unit:"%"}),/*#__PURE__*/React.createElement(LineChart,{data:data.performance.metrics.loadavg,timestamps:data.performance.timestamps,label:"Load Average",color:"#22c55e",unit:""})),/*#__PURE__*/React.createElement(LineChart,{datasets:[{label:'Net In',data:data.performance.metrics.net_in,color:'#06b6d4'},{label:'Net Out',data:data.performance.metrics.net_out,color:'#8b5cf6'}],timestamps:data.performance.timestamps,label:"Network I/O",unit:" KB/s"}),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement(LineChart,{data:data.performance.metrics.swap,timestamps:data.performance.timestamps,label:"Swap Usage",color:"#ec4899",unit:"%",yMin:0,yMax:100}),/*#__PURE__*/React.createElement(LineChart,{data:data.performance.metrics.rootfs,timestamps:data.performance.timestamps,label:"Root FS Usage",color:"#a855f7",unit:"%",yMin:0,yMax:100})),data.performance.metrics.pressurecpusome&&/*#__PURE__*/React.createElement(LineChart,{datasets:[{label:'Some',data:data.performance.metrics.pressurecpusome,color:'#3b82f6'},{label:'Full',data:data.performance.metrics.pressurecpufull,color:'#ef4444'}],timestamps:data.performance.timestamps,label:"CPU Pressure Stall",unit:"%",yMin:0,yMax:100}),data.performance.metrics.pressurememorysome&&/*#__PURE__*/React.createElement(LineChart,{datasets:[{label:'Some',data:data.performance.metrics.pressurememorysome,color:'#22c55e'},{label:'Full',data:data.performance.metrics.pressurememoryfull,color:'#ef4444'}],timestamps:data.performance.timestamps,label:"Memory Pressure Stall",unit:"%",yMin:0,yMax:100}),data.performance.metrics.pressureiosome&&/*#__PURE__*/React.createElement(LineChart,{datasets:[{label:'Some',data:data.performance.metrics.pressureiosome,color:'#eab308'},{label:'Full',data:data.performance.metrics.pressureiofull,color:'#ef4444'}],timestamps:data.performance.timestamps,label:"IO Pressure Stall",unit:"%",yMin:0,yMax:100}),data.performance.timestamps?.length>0&&/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 text-center mt-2"},formatTime(data.performance.timestamps[0])," - ",formatTime(data.performance.timestamps[data.performance.timestamps.length-1]))):/*#__PURE__*/React.createElement("div",{className:"text-center text-gray-500 py-12"},/*#__PURE__*/React.createElement(Icons.BarChart,{className:"mx-auto mb-3 w-12 h-12 opacity-50"}),/*#__PURE__*/React.createElement("p",null,"No performance data available"),/*#__PURE__*/React.createElement("p",{className:"text-sm mt-1"},"Try refreshing or selecting a different timeframe"))),activeTab==='shell'&&/*#__PURE__*/React.createElement("div",{className:"h-full flex flex-col"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement(Icons.Terminal,null),/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},"Node Shell")),/*#__PURE__*/React.createElement("button",{onClick:()=>setData({...data,shellFullscreen:true}),className:"flex items-center gap-2 px-3 py-1.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-gray-300 hover:text-white text-sm"},/*#__PURE__*/React.createElement(Icons.Maximize,null),"Fullscreen")),/*#__PURE__*/React.createElement("div",{className:"flex-1 bg-black rounded-lg border border-proxmox-border overflow-hidden min-h-[400px]"},/*#__PURE__*/React.createElement(NodeShellTerminal,{node:node,clusterId:clusterId,addToast:addToast}))),activeTab==='network'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3 flex-wrap"},/*#__PURE__*/React.createElement("div",{className:"relative"},/*#__PURE__*/React.createElement("button",{onClick:()=>setData({...data,showCreateMenu:!data.showCreateMenu}),className:"flex items-center gap-2 px-4 py-2 bg-proxmox-orange rounded-lg text-white text-sm hover:bg-orange-600"},/*#__PURE__*/React.createElement(Icons.Plus,null),"Create"),data.showCreateMenu&&/*#__PURE__*/React.createElement("div",{className:"absolute top-full left-0 mt-1 bg-proxmox-card border border-proxmox-border rounded-lg shadow-xl z-10 min-w-[160px]"},['bridge','bond','vlan','OVSBridge','OVSBond','OVSIntPort'].map(ifaceType=>/*#__PURE__*/React.createElement("button",{key:ifaceType,onClick:()=>{setData({...data,showCreateMenu:false,editIface:{type:ifaceType,iface:'',isNew:true}});},className:"w-full px-4 py-2 text-left text-sm text-gray-300 hover:bg-proxmox-hover hover:text-white"},"Linux ",ifaceType.charAt(0).toUpperCase()+ifaceType.slice(1))))),/*#__PURE__*/React.createElement("button",{onClick:async()=>{try{const res=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/network`,{method:'PUT',credentials:'include'});if(res.ok){addToast(t('networkChangesApplied')||'Network changes applied');loadTabData('network');}else{const err=await res.json();addToast(err.error||t('error'),'error');}}catch(e){addToast(t('error')||'Error','error');}},className:"px-4 py-2 bg-green-600 rounded-lg text-white text-sm hover:bg-green-700"},"Apply Configuration"),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!confirm(t('discardUnappliedChanges')))return;try{const res=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/network`,{method:'DELETE',credentials:'include'});if(res.ok){addToast(t('changesReverted')||'Changes reverted');loadTabData('network');}else{const err=await res.json();addToast(err.error||t('error'),'error');}}catch(e){addToast(t('error')||'Error','error');}},className:"px-4 py-2 bg-proxmox-card border border-proxmox-border rounded-lg text-gray-300 text-sm hover:text-white"},"Revert")),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},(data.network||[]).map(iface=>/*#__PURE__*/React.createElement("div",{key:iface.iface,className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-2"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement(Icons.Network,null),/*#__PURE__*/React.createElement("span",{className:"font-medium text-white"},iface.iface),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 bg-proxmox-card px-2 py-0.5 rounded"},iface.type),iface.active&&/*#__PURE__*/React.createElement("span",{className:"text-xs text-green-400 bg-green-500/10 px-2 py-0.5 rounded"},"Active")),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setData({...data,editIface:{...iface,isNew:false}}),className:"p-1.5 rounded hover:bg-proxmox-hover text-gray-400 hover:text-white",title:"Edit"},/*#__PURE__*/React.createElement(Icons.Cog,null)),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!confirm(`${iface.iface}: ${t('deleteInterfaceConfirm')}`))return;try{const res=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/network/${iface.iface}`,{method:'DELETE',credentials:'include'});if(res.ok){addToast(`${iface.iface} ${t('deleted')}`);loadTabData('network');}else{const err=await res.json();addToast(err.error||t('error'),'error');}}catch(e){addToast(t('error')||'Error','error');}},className:"p-1.5 rounded hover:bg-red-500/20 text-gray-400 hover:text-red-400",title:"Delete"},/*#__PURE__*/React.createElement(Icons.Trash,null)))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-4 gap-4 text-sm"},iface.address&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"IP:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-white font-mono"},iface.address,"/",iface.netmask||iface.cidr?.split('/')[1]||'')),iface.gateway&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Gateway:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-white font-mono"},iface.gateway)),iface.bridge_ports&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Ports:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-white"},iface.bridge_ports)),iface.slaves&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Slaves:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-white"},iface.slaves)),iface['vlan-raw-device']&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"VLAN Device:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-white"},iface['vlan-raw-device'])),iface['vlan-id']&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"VLAN ID:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-white"},iface['vlan-id'])),iface.bond_mode&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Bond Mode:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-white"},iface.bond_mode)),iface.comments&&/*#__PURE__*/React.createElement("div",{className:"col-span-4"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Comment:"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-gray-400"},iface.comments))))),(!data.network||data.network.length===0)&&/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},t('noNetworkInterfaces')||'No network interfaces')),data.editIface&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/80"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-xl bg-proxmox-card border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4"},data.editIface.isNew?`Create: Linux ${data.editIface.type}`:`Edit: ${data.editIface.iface}`),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Name"),/*#__PURE__*/React.createElement("input",{type:"text",value:data.editIface.iface||'',onChange:e=>setData({...data,editIface:{...data.editIface,iface:e.target.value}}),disabled:!data.editIface.isNew,placeholder:data.editIface.type==='bridge'?'vmbr0':data.editIface.type==='bond'?'bond0':'vlan0',className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm disabled:opacity-50"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"IPv4/CIDR"),/*#__PURE__*/React.createElement("input",{type:"text",value:data.editIface.cidr||'',onChange:e=>setData({...data,editIface:{...data.editIface,cidr:e.target.value}}),placeholder:"192.168.1.1/24",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Gateway (IPv4)"),/*#__PURE__*/React.createElement("input",{type:"text",value:data.editIface.gateway||'',onChange:e=>setData({...data,editIface:{...data.editIface,gateway:e.target.value}}),placeholder:"192.168.1.1",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"IPv6/CIDR"),/*#__PURE__*/React.createElement("input",{type:"text",value:data.editIface.cidr6||'',onChange:e=>setData({...data,editIface:{...data.editIface,cidr6:e.target.value}}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Gateway (IPv6)"),/*#__PURE__*/React.createElement("input",{type:"text",value:data.editIface.gateway6||'',onChange:e=>setData({...data,editIface:{...data.editIface,gateway6:e.target.value}}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"MTU"),/*#__PURE__*/React.createElement("input",{type:"number",value:data.editIface.mtu||'',onChange:e=>setData({...data,editIface:{...data.editIface,mtu:e.target.value}}),placeholder:"1500",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"}))),data.editIface.type==='bridge'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Bridge Ports"),/*#__PURE__*/React.createElement("input",{type:"text",value:data.editIface.bridge_ports||'',onChange:e=>setData({...data,editIface:{...data.editIface,bridge_ports:e.target.value}}),placeholder:"ens18",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4 pt-5"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:data.editIface.bridge_vlan_aware||false,onChange:e=>setData({...data,editIface:{...data.editIface,bridge_vlan_aware:e.target.checked}})}),"VLAN aware"))),data.editIface.type==='bond'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Slaves"),/*#__PURE__*/React.createElement("input",{type:"text",value:data.editIface.slaves||'',onChange:e=>setData({...data,editIface:{...data.editIface,slaves:e.target.value}}),placeholder:"ens18 ens19",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Mode"),/*#__PURE__*/React.createElement("select",{value:data.editIface.bond_mode||'balance-rr',onChange:e=>setData({...data,editIface:{...data.editIface,bond_mode:e.target.value}}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:"balance-rr"},"balance-rr"),/*#__PURE__*/React.createElement("option",{value:"active-backup"},"active-backup"),/*#__PURE__*/React.createElement("option",{value:"balance-xor"},"balance-xor"),/*#__PURE__*/React.createElement("option",{value:"broadcast"},"broadcast"),/*#__PURE__*/React.createElement("option",{value:"802.3ad"},"LACP (802.3ad)"),/*#__PURE__*/React.createElement("option",{value:"balance-tlb"},"balance-tlb"),/*#__PURE__*/React.createElement("option",{value:"balance-alb"},"balance-alb"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Hash Policy"),/*#__PURE__*/React.createElement("select",{value:data.editIface.bond_xmit_hash_policy||'',onChange:e=>setData({...data,editIface:{...data.editIface,bond_xmit_hash_policy:e.target.value}}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Default"),/*#__PURE__*/React.createElement("option",{value:"layer2"},"layer2"),/*#__PURE__*/React.createElement("option",{value:"layer2+3"},"layer2+3"),/*#__PURE__*/React.createElement("option",{value:"layer3+4"},"layer3+4"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Bond Primary"),/*#__PURE__*/React.createElement("input",{type:"text",value:data.editIface['bond-primary']||'',onChange:e=>setData({...data,editIface:{...data.editIface,'bond-primary':e.target.value}}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"}))),data.editIface.type==='vlan'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"VLAN raw device"),/*#__PURE__*/React.createElement("input",{type:"text",value:data.editIface['vlan-raw-device']||'',onChange:e=>setData({...data,editIface:{...data.editIface,'vlan-raw-device':e.target.value}}),placeholder:"vmbr0",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"VLAN Tag"),/*#__PURE__*/React.createElement("input",{type:"number",value:data.editIface['vlan-id']||'',onChange:e=>setData({...data,editIface:{...data.editIface,'vlan-id':e.target.value}}),placeholder:"100",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:data.editIface.autostart!==0,onChange:e=>setData({...data,editIface:{...data.editIface,autostart:e.target.checked?1:0}})}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},"Autostart")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Comment"),/*#__PURE__*/React.createElement("input",{type:"text",value:data.editIface.comments||'',onChange:e=>setData({...data,editIface:{...data.editIface,comments:e.target.value}}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:()=>setData({...data,editIface:null}),className:"px-4 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-gray-300 hover:text-white"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{const iface=data.editIface;if(!iface.iface){addToast(t('nameRequired')||'Name required','error');return;}try{const payload={...iface};delete payload.isNew;delete payload.active;delete payload.exists;delete payload.families;delete payload.method;delete payload.method6;delete payload.priority;const url=iface.isNew?`${API_URL}/clusters/${clusterId}/nodes/${node}/network`:`${API_URL}/clusters/${clusterId}/nodes/${node}/network/${iface.iface}`;const method=iface.isNew?'POST':'PUT';const res=await fetch(url,{method,headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(res.ok){addToast(iface.isNew?t('interfaceCreated')||'Interface created':t('interfaceUpdated')||'Interface updated');setData({...data,editIface:null});loadTabData('network');}else{const err=await res.json();addToast(err.error||t('error'),'error');}}catch(e){addToast(t('error')||'Error','error');}},className:"px-4 py-2 bg-proxmox-orange rounded-lg text-white hover:bg-orange-600"},data.editIface.isNew?'Create':'Save'))))),activeTab==='system'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center mb-4"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},"DNS"),/*#__PURE__*/React.createElement("button",{onClick:()=>handleSave('dns',data.dns,t('dnsSaved')||'DNS saved'),className:"px-3 py-1 bg-proxmox-orange rounded text-white text-sm hover:bg-orange-600"},t('save'))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('searchDomain')||'Search Domain'),/*#__PURE__*/React.createElement("input",{type:"text",value:data.dns?.search||'',onChange:e=>setData({...data,dns:{...data.dns,search:e.target.value}}),className:"w-full px-3 py-2 bg-proxmox-card border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('dnsServer')||'DNS Server'," 1"),/*#__PURE__*/React.createElement("input",{type:"text",value:data.dns?.dns1||'',onChange:e=>setData({...data,dns:{...data.dns,dns1:e.target.value}}),className:"w-full px-3 py-2 bg-proxmox-card border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('dnsServer')||'DNS Server'," 2"),/*#__PURE__*/React.createElement("input",{type:"text",value:data.dns?.dns2||'',onChange:e=>setData({...data,dns:{...data.dns,dns2:e.target.value}}),className:"w-full px-3 py-2 bg-proxmox-card border border-proxmox-border rounded-lg text-white text-sm"})))),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white mb-3"},t('time')||'Time'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4 text-sm"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('timezone')||'Timezone',":"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-white"},data.time?.timezone||'UTC')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('localTime')||'Local Time',":"),/*#__PURE__*/React.createElement("span",{className:"ml-2 text-white font-mono"},data.time?.localtime?new Date(data.time.localtime*1000).toLocaleString():'N/A')))),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center mb-4"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},"/etc/hosts"),/*#__PURE__*/React.createElement("button",{onClick:()=>handleSave('hosts',{data:data.hosts},t('hostsSaved')||'Hosts saved'),className:"px-3 py-1 bg-proxmox-orange rounded text-white text-sm hover:bg-orange-600"},t('save'))),/*#__PURE__*/React.createElement("textarea",{value:data.hosts||'',onChange:e=>setData({...data,hosts:e.target.value}),rows:5,className:"w-full px-3 py-2 bg-proxmox-card border border-proxmox-border rounded-lg text-white text-sm font-mono resize-none"})),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center mb-4"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},t('sslCertificates')||'SSL Certificates'),/*#__PURE__*/React.createElement("button",{onClick:()=>setData({...data,showCertUpload:!data.showCertUpload}),className:"px-3 py-1 bg-proxmox-card border border-proxmox-border rounded text-gray-300 text-sm hover:text-white hover:border-proxmox-orange"},data.showCertUpload?t('cancel'):t('uploadCustomCert')||'Upload Custom Certificate')),/*#__PURE__*/React.createElement("div",{className:"space-y-2 mb-4"},(data.certificates||[]).length>0?(data.certificates||[]).map((c,i)=>/*#__PURE__*/React.createElement("div",{key:i,className:"flex justify-between items-center py-3 px-4 bg-proxmox-card rounded-lg"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-white font-medium"},c.filename||'Certificate'),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},c.subject||'N/A'),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},t('issuer')||'Issuer',": ",c.issuer||'N/A')),/*#__PURE__*/React.createElement("div",{className:"text-right"},/*#__PURE__*/React.createElement("div",{className:`text-sm ${c.notafter&&c.notafter*1000>Date.now()?'text-green-400':'text-red-400'}`},c.notafter?new Date(c.notafter*1000).toLocaleDateString():'N/A'),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},c.notafter?c.notafter*1000>Date.now()?t('valid')||'Valid':t('expired')||'Expired':'')))):/*#__PURE__*/React.createElement("div",{className:"text-gray-500 text-sm"},t('noCertificates')||'No certificates found')),data.showCertUpload&&/*#__PURE__*/React.createElement("div",{className:"mt-4 p-4 bg-proxmox-card rounded-lg border border-proxmox-border space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-2"},t('certificate')||'Certificate'," (PEM ",t('format')||'Format',")"),/*#__PURE__*/React.createElement("textarea",{value:data.newCert||'',onChange:e=>setData({...data,newCert:e.target.value}),placeholder:"-----BEGIN CERTIFICATE-----\n...\n-----END CERTIFICATE-----",rows:6,className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm font-mono resize-none"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('certChainHint')||'Can contain multiple certificates (chain)')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-2"},t('privateKey')||'Private Key'," (PEM ",t('format')||'Format',")"),/*#__PURE__*/React.createElement("textarea",{value:data.newKey||'',onChange:e=>setData({...data,newKey:e.target.value}),placeholder:"-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----",rows:6,className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm font-mono resize-none"})),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:data.certRestart!==false,onChange:e=>setData({...data,certRestart:e.target.checked}),className:"rounded"}),t('restartPveproxyAfterUpload')||'Restart pveproxy after upload')),/*#__PURE__*/React.createElement("div",{className:"flex gap-3"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!data.newCert||!data.newKey){addToast(t('certAndKeyRequired')||'Certificate and key required','error');return;}try{const res=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/certificates/custom`,{method:'POST',credentials:'include',headers:{'Content-Type':'application/json'},body:JSON.stringify({certificates:data.newCert,key:data.newKey,restart:data.certRestart!==false,force:true})});if(res.ok){addToast(t('certUploaded')||'Certificate uploaded!');setData({...data,newCert:'',newKey:'',showCertUpload:false});loadTabData('system');}else{const err=await res.json();addToast(err.error||t('uploadFailed')||'Upload failed','error');}}catch(e){addToast(t('connectionError'),'error');}},className:"flex items-center gap-2 px-4 py-2 bg-proxmox-orange rounded-lg text-white text-sm hover:bg-orange-600"},/*#__PURE__*/React.createElement(Icons.Shield,null),t('uploadCertificate')||'Upload Certificate'),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!confirm(t('deleteCertConfirm')||'Delete custom certificate and revert to self-signed?'))return;try{const res=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/certificates/custom?restart=true`,{method:'DELETE',credentials:'include'});if(res.ok){addToast(t('certDeleted')||'Certificate deleted');loadTabData('system');}else{const err=await res.json();addToast(err.error||t('deleteFailed'),'error');}}catch(e){addToast(t('connectionError'),'error');}},className:"px-4 py-2 bg-red-500/20 border border-red-500/50 rounded-lg text-red-400 text-sm hover:bg-red-500/30"},t('deleteCustomCert')||'Delete Custom Cert')))),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center mb-3"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},t('syslogLatest')||'Syslog (latest entries)'),/*#__PURE__*/React.createElement("button",{onClick:()=>loadTabData('system'),className:"p-1.5 rounded hover:bg-proxmox-hover text-gray-400 hover:text-white",title:t('refresh')||'Refresh'},/*#__PURE__*/React.createElement(Icons.RefreshCw,null))),/*#__PURE__*/React.createElement("div",{className:"max-h-64 overflow-y-auto bg-black/50 rounded p-3"},(data.syslog||[]).length>0?/*#__PURE__*/React.createElement("pre",{className:"text-xs text-gray-300 font-mono whitespace-pre-wrap leading-relaxed"},(data.syslog||[]).join('\n')):/*#__PURE__*/React.createElement("div",{className:"text-gray-500 text-sm"},t('noLogEntries')||'No log entries')))),activeTab==='disks'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex items-center justify-between"},/*#__PURE__*/React.createElement("h3",{className:"font-medium text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.HardDrive,null),"Physical Disks"),/*#__PURE__*/React.createElement("button",{onClick:()=>loadTabData('disks'),className:"p-2 hover:bg-proxmox-hover rounded-lg text-gray-400 hover:text-white"},/*#__PURE__*/React.createElement(Icons.RefreshCw,null))),/*#__PURE__*/React.createElement("div",{className:"overflow-x-auto"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Device"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Model"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Size"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Type"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Usage"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Health"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Actions"))),/*#__PURE__*/React.createElement("tbody",null,(data.disks||[]).length>0?(data.disks||[]).map((d,idx)=>/*#__PURE__*/React.createElement("tr",{key:d.devpath||idx,className:"border-t border-proxmox-border hover:bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:"font-mono text-white"},d.devpath||'Unknown'),d.serial&&/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 font-mono"},d.serial)),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400 text-sm max-w-48 truncate"},d.model||'Unknown'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-proxmox-orange font-medium"},formatBytes(d.size)),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs ${d.type==='ssd'?'bg-blue-500/20 text-blue-400':d.type==='nvme'?'bg-purple-500/20 text-purple-400':'bg-gray-500/20 text-gray-400'}`},(d.type||'hdd').toUpperCase())),/*#__PURE__*/React.createElement("td",{className:"p-3"},d.used==='unused'||!d.used?/*#__PURE__*/React.createElement("span",{className:"text-green-400 text-sm"},"\u2713 Unused"):/*#__PURE__*/React.createElement("span",{className:"text-yellow-400 text-sm"},d.used)),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs ${d.health==='PASSED'?'bg-green-500/20 text-green-400':d.health==='FAILED'?'bg-red-500/20 text-red-400':'bg-gray-500/20 text-gray-400'}`},d.health||'N/A')),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("div",{className:"flex gap-1"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{try{const diskPath=(d.devpath||'').replace('/dev/','');const res=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/disks/${encodeURIComponent(diskPath)}/smart`,{credentials:'include'});if(res.ok){const smart=await res.json();alert(`SMART Data for ${d.devpath}:\n\n${JSON.stringify(smart,null,2)}`);}else{alert(t('smartNotAvailable'));}}catch(e){alert(t('smartFetchError'));}},className:"p-1.5 hover:bg-blue-500/20 rounded text-gray-400 hover:text-blue-400",title:"SMART Data"},/*#__PURE__*/React.createElement(Icons.Activity,null)),(d.used==='unused'||!d.used)&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!confirm(`Initialize ${d.devpath} with GPT partition table?\n\nThis will ERASE all data on the disk!`))return;try{const res=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/disks/initgpt`,{method:'POST',credentials:'include',headers:{'Content-Type':'application/json'},body:JSON.stringify({disk:d.devpath})});if(res.ok){addToast('GPT partition table initialized','success');loadTabData('disks');}else{const err=await res.json();addToast(err.error||'Failed to initialize','error');}}catch(e){addToast('Error initializing disk','error');}},className:"p-1.5 hover:bg-green-500/20 rounded text-gray-400 hover:text-green-400",title:"Initialize GPT"},/*#__PURE__*/React.createElement(Icons.Plus,null)),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!confirm(`âš ï¸ DANGER: Wipe disk ${d.devpath}?\n\nThis will DESTROY ALL DATA on the disk!`))return;if(!confirm(`Are you ABSOLUTELY SURE?\n\nThis action cannot be undone!`))return;try{const res=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/disks/wipe`,{method:'POST',credentials:'include',headers:{'Content-Type':'application/json'},body:JSON.stringify({disk:d.devpath})});if(res.ok){addToast('Disk wiped successfully','success');loadTabData('disks');}else{const err=await res.json();addToast(err.error||'Failed to wipe','error');}}catch(e){addToast('Error wiping disk','error');}},className:"p-1.5 hover:bg-red-500/20 rounded text-gray-400 hover:text-red-400",title:"Wipe Disk"},/*#__PURE__*/React.createElement(Icons.Trash,null))))))):/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:"7",className:"p-8 text-center text-gray-500"},"No physical disks found")))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex items-center justify-between"},/*#__PURE__*/React.createElement("h3",{className:"font-medium text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Database,null),"LVM Volume Groups"),/*#__PURE__*/React.createElement("button",{onClick:()=>openDiskModal('lvm'),className:"px-3 py-1.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm"},/*#__PURE__*/React.createElement(Icons.Plus,{className:"inline mr-1"})," Create LVM")),/*#__PURE__*/React.createElement("div",{className:"p-4"},(data.lvm||[]).length>0?/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3"},data.lvm.map((v,idx)=>/*#__PURE__*/React.createElement("div",{key:v.vg||idx,className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center mb-2"},/*#__PURE__*/React.createElement("span",{className:"font-medium text-white"},v.vg||'Unknown'),/*#__PURE__*/React.createElement("span",{className:"text-proxmox-orange font-medium"},formatBytes(v.size))),v.free&&v.size&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"h-2 bg-proxmox-darker rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"h-full bg-proxmox-orange rounded-full",style:{width:`${Math.round((1-v.free/v.size)*100)}%`}})),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mt-1"},formatBytes(v.free)," free"))))):/*#__PURE__*/React.createElement("div",{className:"text-gray-500 text-sm text-center py-4"},"No LVM Volume Groups"))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex items-center justify-between"},/*#__PURE__*/React.createElement("h3",{className:"font-medium text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Database,null),"LVM-Thin Pools"),/*#__PURE__*/React.createElement("button",{onClick:()=>openDiskModal('lvmthin'),className:"px-3 py-1.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm"},/*#__PURE__*/React.createElement(Icons.Plus,{className:"inline mr-1"})," Create LVM-Thin")),/*#__PURE__*/React.createElement("div",{className:"p-4"},(data.lvmthin||[]).length>0?/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3"},data.lvmthin.map((p,idx)=>/*#__PURE__*/React.createElement("div",{key:p.lv||idx,className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center mb-2"},/*#__PURE__*/React.createElement("span",{className:"font-medium text-white"},p.lv||'Unknown'),/*#__PURE__*/React.createElement("span",{className:"text-proxmox-orange font-medium"},formatBytes(p.lv_size))),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-2"},"VG: ",p.vg||'?'),/*#__PURE__*/React.createElement("div",{className:"h-2 bg-proxmox-darker rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:`h-full rounded-full ${(p.usage||0)>80?'bg-red-500':(p.usage||0)>60?'bg-yellow-500':'bg-green-500'}`,style:{width:`${p.usage||0}%`}})),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mt-1"},p.usage||0,"% used")))):/*#__PURE__*/React.createElement("div",{className:"text-gray-500 text-sm text-center py-4"},"No LVM-Thin Pools"))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex items-center justify-between"},/*#__PURE__*/React.createElement("h3",{className:"font-medium text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Database,null),"ZFS Pools"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>openDiskModal('directory'),className:"px-3 py-1.5 bg-proxmox-dark hover:bg-proxmox-hover border border-proxmox-border rounded-lg text-sm"},/*#__PURE__*/React.createElement(Icons.Folder,{className:"inline mr-1"})," Directory"),/*#__PURE__*/React.createElement("button",{onClick:()=>openDiskModal('zfs'),className:"px-3 py-1.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm"},/*#__PURE__*/React.createElement(Icons.Plus,{className:"inline mr-1"})," Create ZFS"))),/*#__PURE__*/React.createElement("div",{className:"p-4"},(data.zfs||[]).length>0?/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3"},data.zfs.map((z,idx)=>/*#__PURE__*/React.createElement("div",{key:z.name||idx,className:"p-4 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center mb-2"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:"font-medium text-white"},z.name||'Unknown'),/*#__PURE__*/React.createElement("span",{className:`text-xs px-2 py-0.5 rounded ${z.health==='ONLINE'?'bg-green-500/20 text-green-400':'bg-red-500/20 text-red-400'}`},z.health||'N/A')),/*#__PURE__*/React.createElement("span",{className:"text-proxmox-orange font-medium"},formatBytes(z.size))),z.alloc&&z.size&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"h-2 bg-proxmox-darker rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"h-full bg-blue-500 rounded-full",style:{width:`${Math.round(z.alloc/z.size*100)}%`}})),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mt-1"},formatBytes(z.free||z.size-z.alloc)," free"))))):/*#__PURE__*/React.createElement("div",{className:"text-gray-500 text-sm text-center py-4"},"No ZFS Pools")))),activeTab==='repos'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-medium text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Package,{className:"w-5 h-5 text-proxmox-orange"}),"APT ",t('repositories')||'Repositories'),/*#__PURE__*/React.createElement("button",{onClick:async()=>{try{const r=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/repos/refresh`,{method:'POST',credentials:'include',headers:authHeaders});if(r.ok){addToast(t('packageListRefreshStarted')||'Package list refresh started','success');}else{addToast(t('error')||'Error','error');}}catch(e){addToast(t('error')||'Error','error');}},className:"px-3 py-1.5 bg-proxmox-orange/20 hover:bg-proxmox-orange/30 text-proxmox-orange rounded-lg text-sm flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-4 h-4"}),"apt update")),/*#__PURE__*/React.createElement("div",{className:"p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg text-sm"},/*#__PURE__*/React.createElement("p",{className:"text-gray-300"},t('repoInfo')||'Manage APT repositories for this node. Enable/disable repositories to control which packages are available.')),/*#__PURE__*/React.createElement("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg text-sm"},/*#__PURE__*/React.createElement("p",{className:"text-yellow-400 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4 flex-shrink-0"}),t('repoProxmoxNotice')||"Note: Due to Proxmox's switch to a new source format, the display may currently be inaccurate. We're working on it.")),loading?/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-6 h-6 animate-spin mx-auto mb-2"}),t('loading'),"..."):(data.repos||[]).length>0?/*#__PURE__*/React.createElement("div",{className:"space-y-3"},(data.repos||[]).map(repo=>/*#__PURE__*/React.createElement("div",{key:repo.id,className:`p-4 rounded-lg border transition-all ${repo.enabled?'bg-green-500/5 border-green-500/30':'bg-proxmox-dark border-proxmox-border'}`},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${repo.enabled?'bg-green-500/20':'bg-gray-500/20'}`},repo.requires_subscription?/*#__PURE__*/React.createElement(Icons.Shield,{className:repo.enabled?'text-green-400':'text-gray-500'}):/*#__PURE__*/React.createElement(Icons.Package,{className:repo.enabled?'text-green-400':'text-gray-500'})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},repo.name),repo.is_other&&/*#__PURE__*/React.createElement("span",{className:"text-xs px-1.5 py-0.5 rounded bg-blue-500/20 text-blue-400"},t('detected')||'Detected')),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},repo.description),repo.requires_subscription&&/*#__PURE__*/React.createElement("span",{className:"inline-block mt-1 text-xs px-2 py-0.5 rounded bg-yellow-500/20 text-yellow-400"},t('requiresSubscription')||'Requires Subscription'),repo.uri&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-600 mt-1 font-mono truncate max-w-xs"},repo.uri))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("span",{className:`text-xs px-2 py-1 rounded ${repo.enabled?'bg-green-500/20 text-green-400':'bg-gray-500/20 text-gray-400'}`},repo.enabled?t('enabled')||'Enabled':t('disabled')||'Disabled'),repo.exists&&/*#__PURE__*/React.createElement("button",{onClick:async()=>{try{// For "other" repos, include file and index
const bodyData={enabled:!repo.enabled};if(repo.is_other){bodyData.file=repo.file;bodyData.index=repo.index;bodyData.name=repo.name;}const r=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/repos/${repo.id}`,{method:'PUT',credentials:'include',headers:{'Content-Type':'application/json',...authHeaders},body:JSON.stringify(bodyData)});if(r.ok){addToast(`${repo.name} ${!repo.enabled?'enabled':'disabled'}`,'success');loadTabData('repos');}else{const err=await r.json();addToast(err.error||t('error'),'error');}}catch(e){addToast(t('error')||'Error','error');}},className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${repo.enabled?'bg-red-500/20 hover:bg-red-500/30 text-red-400':'bg-green-500/20 hover:bg-green-500/30 text-green-400'}`},repo.enabled?t('disable')||'Disable':t('enable')||'Enable'),!repo.exists&&/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},t('notConfigured')||'Not configured'))),repo.file&&/*#__PURE__*/React.createElement("div",{className:"mt-2 text-xs text-gray-500 font-mono"},repo.file)))):/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},t('noReposFound')||'No repositories found'),/*#__PURE__*/React.createElement("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-5 h-5 text-yellow-500 flex-shrink-0 mt-0.5"}),/*#__PURE__*/React.createElement("div",{className:"text-sm text-yellow-200"},/*#__PURE__*/React.createElement("strong",null,t('warning')||'Warning',":")," ",t('repoWarning')||'Mixing enterprise and no-subscription repositories is not recommended. After changing repositories, run "apt update" to refresh the package list.')))),activeTab==='tasks'&&/*#__PURE__*/React.createElement("div",{className:"space-y-2"},(data.tasks||[]).length>0?(data.tasks||[]).map((t,idx)=>/*#__PURE__*/React.createElement("div",{key:t.upid||idx,className:"p-3 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-white"},t.type||'Unknown'),/*#__PURE__*/React.createElement("span",{className:`ml-2 text-xs px-2 py-0.5 rounded ${t.status==='OK'?'text-green-400 bg-green-500/10':t.status?'text-red-400 bg-red-500/10':'text-yellow-400 bg-yellow-500/10'}`},t.status||'running')),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},t.starttime?new Date(t.starttime*1000).toLocaleString():'N/A')),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mt-1"},t.user||'unknown'," - ",t.id||'N/A'))):/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},t('noTasks')||'No tasks')),activeTab==='subscription'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"p-6 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-4"},/*#__PURE__*/React.createElement("h3",{className:"font-medium text-white"},t('subscriptionStatus')),/*#__PURE__*/React.createElement("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${data.subscription?.status==='Active'||data.subscription?.status==='active'?'bg-green-500/20 text-green-400':'bg-yellow-500/20 text-yellow-400'}`},data.subscription?.status==='Active'||data.subscription?.status==='active'?t('licensed'):t('notLicensed'))),data.subscription?.status==='Active'||data.subscription?.status==='active'?/*#__PURE__*/React.createElement("div",{className:"space-y-3 text-sm"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between py-2 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('product')),/*#__PURE__*/React.createElement("span",{className:"text-white"},data.subscription?.productname||'Proxmox VE Subscription')),/*#__PURE__*/React.createElement("div",{className:"flex justify-between py-2 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('licenseKey')),/*#__PURE__*/React.createElement("span",{className:"text-white font-mono"},data.subscription?.key||'N/A')),/*#__PURE__*/React.createElement("div",{className:"flex justify-between py-2 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"Server ID"),/*#__PURE__*/React.createElement("span",{className:"text-white font-mono"},data.subscription?.serverid||'N/A')),/*#__PURE__*/React.createElement("div",{className:"flex justify-between py-2 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('validUntil')),/*#__PURE__*/React.createElement("span",{className:"text-white"},data.subscription?.nextduedate||'N/A')),/*#__PURE__*/React.createElement("div",{className:"flex justify-between py-2"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('supportLevel')),/*#__PURE__*/React.createElement("span",{className:"text-white"},data.subscription?.level||'N/A'))):/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-3"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,null),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-yellow-400 font-medium"},t('noActiveSubscription')),/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mt-1"},t('noSubscriptionDesc'))))),data.subscription?.serverid&&/*#__PURE__*/React.createElement("div",{className:"text-sm"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"Server ID: "),/*#__PURE__*/React.createElement("span",{className:"text-white font-mono"},data.subscription.serverid)))),/*#__PURE__*/React.createElement("div",{className:"p-6 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white mb-4"},t('enterLicenseKey')),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-2"},t('subscriptionKey')),/*#__PURE__*/React.createElement("input",{type:"text",value:data.newLicenseKey||'',onChange:e=>setData({...data,newLicenseKey:e.target.value}),placeholder:"pve1c-xxxxxxxxxx",className:"w-full px-4 py-3 bg-proxmox-card border border-proxmox-border rounded-lg text-white font-mono focus:outline-none focus:border-proxmox-orange"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-2"},"Format: pve1c-xxxxxxxxxx, pve2c-xxxxxxxxxx, pve4c-xxxxxxxxxx, etc.")),/*#__PURE__*/React.createElement("div",{className:"flex gap-3"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!data.newLicenseKey){addToast(t('pleaseEnterLicenseKey'),'error');return;}try{const res=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/subscription`,{method:'PUT',credentials:'include',headers:{'Content-Type':'application/json'},body:JSON.stringify({key:data.newLicenseKey})});if(res.ok){addToast(t('licenseActivated'));setData({...data,newLicenseKey:''});loadTabData('subscription');}else{const err=await res.json();addToast(err.error||t('activationFailed'),'error');}}catch(e){addToast(t('connectionError'),'error');}},disabled:!data.newLicenseKey,className:"flex items-center gap-2 px-4 py-2 bg-proxmox-orange rounded-lg text-white font-medium hover:bg-orange-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},/*#__PURE__*/React.createElement(Icons.Shield,null),t('activateLicense')),/*#__PURE__*/React.createElement("button",{onClick:()=>loadTabData('subscription'),className:"flex items-center gap-2 px-4 py-2 bg-proxmox-card border border-proxmox-border rounded-lg text-gray-300 hover:text-white transition-colors"},/*#__PURE__*/React.createElement(Icons.RefreshCw,null),t('refreshStatus'))))),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-3"},/*#__PURE__*/React.createElement(Icons.Info,null),/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-300"},/*#__PURE__*/React.createElement("p",{className:"mb-2"},t('subscriptionBenefits'),":"),/*#__PURE__*/React.createElement("ul",{className:"list-disc list-inside space-y-1 text-gray-400"},/*#__PURE__*/React.createElement("li",null,t('subscriptionBenefit1')),/*#__PURE__*/React.createElement("li",null,t('subscriptionBenefit2')),/*#__PURE__*/React.createElement("li",null,t('subscriptionBenefit3'))))))),activeTab==='ceph'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},loading?/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center py-12"},/*#__PURE__*/React.createElement("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-proxmox-orange"})):!data.ceph?.available?/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-8 text-center"},/*#__PURE__*/React.createElement(Icons.Database,{className:"w-12 h-12 mx-auto text-gray-600 mb-4"}),/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-2"},t('cephNotInstalled')||'Ceph Not Installed'),/*#__PURE__*/React.createElement("p",{className:"text-gray-400 mb-4"},t('cephNotInstalledOnNode')||'Ceph is not configured on this node.'),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!confirm('Initialize Ceph on this node? This will install and configure Ceph.'))return;try{const res=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/ceph/init`,{method:'POST',credentials:'include',headers:{'Content-Type':'application/json',...authHeaders}});if(res.ok){addToast('Ceph initialization started','success');loadTabData('ceph');}else{const err=await res.json().catch(()=>({}));addToast(err.error||'Failed to initialize Ceph','error');}}catch(e){addToast('Connection error','error');}},className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-white font-medium transition-colors"},t('cephInit')||'Initialize Ceph')):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-4"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Activity,null),t('cephStatus')||'Ceph Status'),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},['start','stop','restart'].map(action=>/*#__PURE__*/React.createElement("button",{key:action,onClick:async()=>{if(!confirm(`${action.charAt(0).toUpperCase()+action.slice(1)} Ceph services on ${node}?`))return;try{const res=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/ceph/${action}`,{method:'POST',credentials:'include',headers:authHeaders});addToast(res.ok?`Ceph ${action} initiated`:`Failed to ${action}`,res.ok?'success':'error');if(res.ok)setTimeout(()=>loadTabData('ceph'),2000);}catch(e){addToast('Error','error');}},className:`px-3 py-1.5 rounded-lg text-sm transition-colors ${action==='stop'?'bg-red-500/20 text-red-400 hover:bg-red-500/30':action==='restart'?'bg-yellow-500/20 text-yellow-400 hover:bg-yellow-500/30':'bg-green-500/20 text-green-400 hover:bg-green-500/30'}`},action.charAt(0).toUpperCase()+action.slice(1))))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mb-1"},t('health')||'Health'),/*#__PURE__*/React.createElement("div",{className:`text-xl font-bold ${data.ceph?.status?.health?.status==='HEALTH_OK'?'text-green-400':data.ceph?.status?.health?.status==='HEALTH_WARN'?'text-yellow-400':'text-red-400'}`},data.ceph?.status?.health?.status||'Unknown')),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mb-1"},"OSDs"),/*#__PURE__*/React.createElement("div",{className:"text-xl font-bold text-blue-400"},(data.ceph?.osd||[]).length),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-400"},(data.ceph?.osd||[]).filter(o=>o.status==='up').length," up, ",(data.ceph?.osd||[]).filter(o=>o.in).length," in")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400 mb-1"},t('cephMons')||'Monitors'),/*#__PURE__*/React.createElement("div",{className:"text-xl font-bold text-purple-400"},(data.ceph?.mon||[]).length)))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},"OSDs (",(data.ceph?.osd||[]).length,")")),/*#__PURE__*/React.createElement("div",{className:"overflow-x-auto"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"ID"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('name')||'Name'),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('status')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"In/Out"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Class"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('actions')))),/*#__PURE__*/React.createElement("tbody",null,!data.ceph?.osd||data.ceph.osd.length===0?/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:"6",className:"p-8 text-center text-gray-500"},"No OSDs on this node")):data.ceph.osd.map(osd=>/*#__PURE__*/React.createElement("tr",{key:osd.id,className:"border-t border-proxmox-border hover:bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("td",{className:"p-3"},osd.id),/*#__PURE__*/React.createElement("td",{className:"p-3 font-medium"},osd.name||`osd.${osd.id}`),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs ${osd.status==='up'?'bg-green-500/20 text-green-400':'bg-red-500/20 text-red-400'}`},osd.status||'unknown')),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs ${osd.in?'bg-blue-500/20 text-blue-400':'bg-yellow-500/20 text-yellow-400'}`},osd.in?'In':'Out')),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300"},osd.device_class||osd.class||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("div",{className:"flex gap-1"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{const action=osd.in?'out':'in';if(!confirm(`Mark OSD ${osd.id} as ${action.toUpperCase()}?`))return;try{await fetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/ceph/osd/${osd.id}/${action}`,{method:'POST',credentials:'include',headers:authHeaders});loadTabData('ceph');}catch(e){}},className:"px-2 py-1 text-xs bg-proxmox-dark hover:bg-proxmox-hover rounded transition-colors"},osd.in?'Out':'In'),/*#__PURE__*/React.createElement("button",{onClick:async()=>{try{await fetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/ceph/osd/${osd.id}/scrub`,{method:'POST',credentials:'include',headers:authHeaders});addToast('Scrub started','success');}catch(e){}},className:"px-2 py-1 text-xs bg-proxmox-dark hover:bg-proxmox-hover rounded transition-colors"},"Scrub"))))))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},t('cephMons')||'Monitors'," (",(data.ceph?.mon||[]).length,")")),/*#__PURE__*/React.createElement("div",{className:"divide-y divide-proxmox-border"},(data.ceph?.mon||[]).map((mon,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"p-4 flex justify-between items-center"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"font-medium"},mon.name),mon.addr&&/*#__PURE__*/React.createElement("span",{className:"text-gray-400 ml-2 font-mono text-xs"},mon.addr)),/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs ${mon.quorum!==false?'bg-green-500/20 text-green-400':'bg-red-500/20 text-red-400'}`},mon.quorum!==false?'In Quorum':'Not in Quorum'))),(!data.ceph?.mon||data.ceph.mon.length===0)&&/*#__PURE__*/React.createElement("div",{className:"p-8 text-center text-gray-500"},"No monitors"))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold"},t('cephPools')||'Pools'," (",(data.ceph?.pools||[]).length,")")),/*#__PURE__*/React.createElement("div",{className:"overflow-x-auto"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},t('name')),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"Size"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-sm text-gray-400"},"PGs"))),/*#__PURE__*/React.createElement("tbody",null,!data.ceph?.pools||data.ceph.pools.length===0?/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:"3",className:"p-8 text-center text-gray-500"},"No pools")):data.ceph.pools.map((pool,idx)=>/*#__PURE__*/React.createElement("tr",{key:idx,className:"border-t border-proxmox-border hover:bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("td",{className:"p-3 font-medium"},pool.pool_name||pool.name),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300"},pool.size||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300"},pool.pg_num||'-')))))))))))),data.shellFullscreen&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[70] bg-black flex flex-col"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between px-4 py-2 bg-proxmox-dark border-b border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement(Icons.Terminal,null),/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},node," - Shell")),/*#__PURE__*/React.createElement("button",{onClick:()=>setData({...data,shellFullscreen:false}),className:"p-2 rounded-lg hover:bg-red-500/20 text-gray-400 hover:text-red-400"},/*#__PURE__*/React.createElement(Icons.X,null))),/*#__PURE__*/React.createElement("div",{className:"flex-1"},/*#__PURE__*/React.createElement(NodeShellTerminal,{node:node,clusterId:clusterId,addToast:addToast}))));}// Console Modal Component with noVNC
// NS: Getting noVNC to work in a React component was... interesting
// The cleanup logic is important - otherwise you get zombie connections
function ConsoleModal({vm,consoleInfo,clusterId,onClose}){const{t}=useTranslation();const canvasRef=useRef(null);const[isFullscreen,setIsFullscreen]=useState(false);const[connectionStatus,setConnectionStatus]=useState('connecting');const[vncPort,setVncPort]=useState(null);const[rfb,setRfb]=useState(null);const rfbRef=useRef(null);const containerRef=useRef(null);const{getAuthHeaders,sessionId}=useAuth();useEffect(()=>{if(!consoleInfo||!canvasRef.current)return;let cancelled=false;const startVNC=async()=>{try{setConnectionStatus('connecting');console.log('VNC: Starting connection...');// Get VNC ticket from backend
console.log('VNC: Getting ticket...');const ticketResponse=await fetch(`${API_URL}/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/console`,{headers:getAuthHeaders()});if(!ticketResponse.ok){console.error('VNC: Failed to get ticket');setConnectionStatus('error');return;}const ticketData=await ticketResponse.json();if(!ticketData.success){console.error('VNC: Ticket error:',ticketData.error);setConnectionStatus('error');return;}const vncPassword=ticketData.ticket;console.log('VNC: Got ticket');if(cancelled)return;// Build WebSocket URL - VNC runs on main port + 1
const wsProtocol=window.location.protocol==='https:'?'wss:':'ws:';const mainPort=parseInt(window.location.port)||(window.location.protocol==='https:'?443:80);const vncPortNum=mainPort+1;setVncPort(vncPortNum);const wsUrl=`${wsProtocol}//${window.location.hostname}:${vncPortNum}/api/clusters/${clusterId}/vms/${vm.node}/${vm.type}/${vm.vmid}/vncwebsocket?session=${encodeURIComponent(sessionId)}`;console.log('VNC WebSocket URL:',wsUrl);// Load noVNC - try local first (if downloaded), then CDN
if(!window.RFB){console.log('VNC: Loading noVNC...');await new Promise((resolve,reject)=>{const script=document.createElement('script');script.type='module';// NS: local path works if --download-static was run
const localPath='/static/js/novnc/rfb.min.js';const cdnPath='https://cdn.jsdelivr.net/npm/@novnc/novnc@1.4.0/core/rfb.js';script.textContent=`
                                    let RFB;
                                    try {
                                        // Try local bundled version first
                                        const resp = await fetch('${localPath}', {method: 'HEAD'});
                                        if (resp.ok) {
                                            RFB = (await import('${localPath}')).default;
                                            console.log('VNC: loaded from local');
                                        } else {
                                            throw new Error('local not found');
                                        }
                                    } catch(e) {
                                        // Fallback to CDN
                                        RFB = (await import('${cdnPath}')).default;
                                        console.log('VNC: loaded from CDN');
                                    }
                                    if (RFB) {
                                        window.RFB = RFB;
                                        window.dispatchEvent(new CustomEvent('novnc-loaded'));
                                    } else {
                                        window.dispatchEvent(new CustomEvent('novnc-failed'));
                                    }
                                `;const onLoaded=()=>{window.removeEventListener('novnc-loaded',onLoaded);window.removeEventListener('novnc-failed',onFailed);console.log('VNC: noVNC ready');resolve();};const onFailed=()=>{window.removeEventListener('novnc-loaded',onLoaded);window.removeEventListener('novnc-failed',onFailed);reject(new Error('Failed to load noVNC'));};window.addEventListener('novnc-loaded',onLoaded);window.addEventListener('novnc-failed',onFailed);document.head.appendChild(script);setTimeout(()=>{if(!window.RFB){window.removeEventListener('novnc-loaded',onLoaded);window.removeEventListener('novnc-failed',onFailed);reject(new Error('noVNC load timeout'));}},10000);});}if(cancelled||!window.RFB){setConnectionStatus('load_error');return;}console.log('VNC: Connecting to',wsUrl);// Create RFB with credentials
const rfbInstance=new window.RFB(canvasRef.current,wsUrl,{credentials:{password:vncPassword}});rfbInstance.scaleViewport=true;rfbInstance.resizeSession=true;rfbInstance.addEventListener('connect',()=>{console.log('VNC: Connected!');setConnectionStatus('connected');});rfbInstance.addEventListener('disconnect',e=>{console.log('VNC: Disconnected',e.detail);setConnectionStatus(e.detail.clean?'disconnected':'error');});rfbInstance.addEventListener('securityfailure',e=>{console.error('VNC: Security failure',e);setConnectionStatus('auth_failed');});// handle credentials request
rfbInstance.addEventListener('credentialsrequired',()=>{console.log('VNC: Credentials required, sending...');rfbInstance.sendCredentials({password:vncPassword});});setRfb(rfbInstance);rfbRef.current=rfbInstance;}catch(e){console.error('VNC: Error:',e);if(!cancelled){setConnectionStatus('load_error');}}};startVNC();return()=>{cancelled=true;if(rfbRef.current){try{rfbRef.current.disconnect();}catch(e){}rfbRef.current=null;}};},[consoleInfo,clusterId,vm]);const handleFullscreen=()=>{if(!document.fullscreenElement){containerRef.current?.requestFullscreen();setIsFullscreen(true);}else{document.exitFullscreen();setIsFullscreen(false);}};const handleCtrlAltDel=()=>{if(rfb){rfb.sendCtrlAltDel();}};const openInProxmox=()=>{const url=`https://${consoleInfo.host}:8006/?console=${vm.type}&novnc=1&vmid=${vm.vmid}&node=${vm.node}`;window.open(url,'_blank');};return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop bg-black/80"},/*#__PURE__*/React.createElement("div",{ref:containerRef,className:`bg-proxmox-card border border-proxmox-border rounded-2xl shadow-2xl animate-scale-in overflow-hidden flex flex-col ${isFullscreen?'w-full h-full rounded-none':'w-full max-w-5xl h-[80vh]'}`},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between px-4 py-3 border-b border-proxmox-border bg-proxmox-dark"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement(Icons.Monitor,null),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:"font-semibold text-white"},vm.name||`VM ${vm.vmid}`),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-400"},vm.type.toUpperCase()," \xB7 ",vm.node," \xB7",/*#__PURE__*/React.createElement("span",{className:`ml-1 ${connectionStatus==='connected'?'text-green-400':connectionStatus==='connecting'?'text-yellow-400':'text-red-400'}`},connectionStatus==='connected'?'Connected':connectionStatus==='connecting'?'Connecting...':'Error')))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},vm.type==='qemu'&&connectionStatus==='connected'&&/*#__PURE__*/React.createElement("button",{onClick:handleCtrlAltDel,className:"px-3 py-1.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-xs text-gray-300 hover:text-white hover:border-proxmox-orange transition-colors"},"Ctrl+Alt+Del"),/*#__PURE__*/React.createElement("button",{onClick:openInProxmox,className:"px-3 py-1.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-xs text-gray-300 hover:text-white hover:border-proxmox-orange transition-colors"},"External"),/*#__PURE__*/React.createElement("button",{onClick:handleFullscreen,className:"p-2 rounded-lg hover:bg-proxmox-hover transition-colors"},isFullscreen?/*#__PURE__*/React.createElement(Icons.Minimize,null):/*#__PURE__*/React.createElement(Icons.Maximize,null)),/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"p-2 rounded-lg hover:bg-red-500/20 text-gray-400 hover:text-red-400 transition-colors"},/*#__PURE__*/React.createElement(Icons.X,null)))),/*#__PURE__*/React.createElement("div",{className:"flex-1 bg-black relative overflow-hidden"},connectionStatus==='connecting'&&/*#__PURE__*/React.createElement("div",{className:"absolute inset-0 flex items-center justify-center bg-proxmox-darker"},/*#__PURE__*/React.createElement("div",{className:"text-center"},/*#__PURE__*/React.createElement("div",{className:"animate-spin w-8 h-8 border-2 border-proxmox-orange border-t-transparent rounded-full mx-auto mb-4"}),/*#__PURE__*/React.createElement("p",{className:"text-gray-400"},"Connecting to console..."))),(connectionStatus==='error'||connectionStatus==='load_error'||connectionStatus==='auth_failed')&&/*#__PURE__*/React.createElement("div",{className:"absolute inset-0 flex items-center justify-center bg-proxmox-darker"},/*#__PURE__*/React.createElement("div",{className:"text-center max-w-md p-6"},/*#__PURE__*/React.createElement("div",{className:"text-red-400 text-xl mb-4"},"\u26A0\uFE0F ",t('connectionError')),window.location.protocol==='https:'&&/*#__PURE__*/React.createElement("div",{className:"text-gray-400 text-sm mb-4 p-4 bg-proxmox-dark rounded-lg text-left"},/*#__PURE__*/React.createElement("p",{className:"mb-3 font-medium text-white"},t('certInstructions')),/*#__PURE__*/React.createElement("p",{className:"mb-2"},t('certStep1')),/*#__PURE__*/React.createElement("a",{href:`https://${window.location.hostname}:${vncPort||(parseInt(window.location.port)||443)+1}/`,target:"_blank",rel:"noopener noreferrer",className:"block text-proxmox-orange hover:underline mb-3 break-all"},"https://",window.location.hostname,":",vncPort||(parseInt(window.location.port)||443)+1,"/"),/*#__PURE__*/React.createElement("p",{className:"mb-2"},t('certStep2')),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},t('certStep3'))),/*#__PURE__*/React.createElement("div",{className:"flex gap-3 justify-center"},/*#__PURE__*/React.createElement("button",{onClick:()=>{const port=vncPort||(parseInt(window.location.port)||443)+1;window.open(`https://${window.location.hostname}:${port}/`,'_blank');},className:"px-4 py-2 bg-blue-600 rounded-lg text-white hover:bg-blue-700 transition-colors text-sm"},t('acceptCert')),/*#__PURE__*/React.createElement("button",{onClick:openInProxmox,className:"px-4 py-2 bg-proxmox-orange rounded-lg text-white hover:bg-orange-600 transition-colors text-sm"},t('openInProxmox'))))),/*#__PURE__*/React.createElement("div",{ref:canvasRef,className:"w-full h-full"}))));}// LW: Feb 2026 - Corporate Node Detail View (experimental)
function CorporateNodeDetailView({node,clusterId,clusterMetrics,clusterResources,onBack,onOpenNodeConfig,onMaintenanceToggle,onNodeAction,onStartUpdate,onSelectVm,addToast}){const{t}=useTranslation();const{getAuthHeaders}=useAuth();const[activeDetailTab,setActiveDetailTab]=useState('summary');const[showActionsMenu,setShowActionsMenu]=useState(false);const[configSubTab,setConfigSubTab]=useState('network');const[monitorSubTab,setMonitorSubTab]=useState('performance');const[perfTimeframe,setPerfTimeframe]=useState('hour');const[loading,setLoading]=useState(false);const[data,setData]=useState({});// LW: Feb 2026 - edit states for configure tab
const[editingDns,setEditingDns]=useState(false);const[editingHosts,setEditingHosts]=useState(false);const[dnsForm,setDnsForm]=useState({});const[hostsForm,setHostsForm]=useState('');const[showCertUpload,setShowCertUpload]=useState(false);const[certForm,setCertForm]=useState({cert:'',key:'',restart:true});const[saving,setSaving]=useState(false);const metrics=clusterMetrics?.[node]||{};const nodeOnline=metrics.status!=='offline';const isMaint=metrics.maintenance_mode;const authFetch=async(url,opts={})=>{try{return await fetch(url,{...opts,credentials:'include',headers:{...opts.headers,...getAuthHeaders()}});}catch(e){console.error(e);return null;}};// LW: Feb 2026 - save handler for configure tab edits
const handleSave=async(endpoint,payload,successMsg,method)=>{setSaving(true);try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/${endpoint}`,{method:method||'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(res&&res.ok){addToast(successMsg,'success');// Reload relevant data
if(endpoint.includes('dns')||endpoint.includes('hosts')||endpoint.includes('time')||endpoint.includes('certificates')||endpoint.includes('syslog'))loadTabData('system');else if(endpoint.includes('disk'))loadTabData('disks');else if(endpoint.includes('repo'))loadTabData('repos');else if(endpoint.includes('network'))loadTabData('network');}else{const err=res?await res.json().catch(()=>({})):{};addToast(err.error||'Error','error');}}catch(e){addToast('Error','error');}setSaving(false);};const handleRepoToggle=async repo=>{const payload={enabled:!repo.Enabled};if(repo.is_other){payload.file=repo.file;payload.index=repo.index;payload.name=repo.name;}await handleSave(`repos/${repo.id||repo.index}`,payload,repo.Enabled?'Repository disabled':'Repository enabled');};const handleCertUpload=async()=>{setSaving(true);try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/certificates/custom`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({certificates:certForm.cert,key:certForm.key,restart:certForm.restart,force:true})});if(res&&res.ok){addToast('Certificate uploaded','success');setShowCertUpload(false);setCertForm({cert:'',key:'',restart:true});loadTabData('system');}else{const err=res?await res.json().catch(()=>({})):{};addToast(err.error||'Upload failed','error');}}catch(e){addToast('Upload failed','error');}setSaving(false);};const formatBytes=b=>{if(!b)return'0 B';const k=1024,sizes=['B','KB','MB','GB','TB'];const i=Math.floor(Math.log(b)/Math.log(k));return`${(b/Math.pow(k,i)).toFixed(1)} ${sizes[i]}`;};const formatUptime=s=>{if(!s)return'-';const d=Math.floor(s/86400),h=Math.floor(s%86400/3600),m=Math.floor(s%3600/60);if(d>0)return`${d}d ${h}h ${m}m`;if(h>0)return`${h}h ${m}m`;return`${m}m`;};// Close actions menu on outside click
useEffect(()=>{if(!showActionsMenu)return;const close=()=>setShowActionsMenu(false);document.addEventListener('click',close);return()=>document.removeEventListener('click',close);},[showActionsMenu]);// Fetch tab data
const loadTabData=async(tab,tf)=>{setLoading(true);try{const endpoints={summary:[`${API_URL}/clusters/${clusterId}/nodes/${node}/summary`],performance:[`${API_URL}/clusters/${clusterId}/nodes/${node}/rrddata?timeframe=${tf||perfTimeframe}`],tasks:[`${API_URL}/clusters/${clusterId}/nodes/${node}/tasks?limit=50`],network:[`${API_URL}/clusters/${clusterId}/nodes/${node}/network`],system:[`${API_URL}/clusters/${clusterId}/nodes/${node}/dns`,`${API_URL}/clusters/${clusterId}/nodes/${node}/hosts`,`${API_URL}/clusters/${clusterId}/nodes/${node}/time`,`${API_URL}/clusters/${clusterId}/nodes/${node}/syslog?limit=100`,`${API_URL}/clusters/${clusterId}/nodes/${node}/certificates`],disks:[`${API_URL}/clusters/${clusterId}/nodes/${node}/disks`,`${API_URL}/clusters/${clusterId}/nodes/${node}/disks/lvm`,`${API_URL}/clusters/${clusterId}/nodes/${node}/disks/lvmthin`,`${API_URL}/clusters/${clusterId}/nodes/${node}/disks/zfs`],repos:[`${API_URL}/clusters/${clusterId}/nodes/${node}/repos`],subscription:[`${API_URL}/clusters/${clusterId}/nodes/${node}/subscription`],ceph:[`${API_URL}/clusters/${clusterId}/nodes/${node}/ceph/status`,`${API_URL}/clusters/${clusterId}/nodes/${node}/ceph/osd`,`${API_URL}/clusters/${clusterId}/nodes/${node}/ceph/mon`,`${API_URL}/clusters/${clusterId}/nodes/${node}/ceph/pool`]};const urls=endpoints[tab]||[];if(urls.length===0){setLoading(false);return;}const results=await Promise.all(urls.map(u=>authFetch(u).then(r=>r&&r.ok?r.json():null).catch(()=>null)));// NS: Feb 2026 - Use functional setData to avoid stale closure bugs
setData(prev=>{const newData={...prev};if(tab==='summary')newData.summary=results[0];else if(tab==='performance')newData.performance=results[0];else if(tab==='tasks')newData.tasks=results[0];else if(tab==='network')newData.network=results[0];else if(tab==='system'){newData.dns=results[0]||{};newData.hosts=results[1]?.data||'';newData.time=results[2]||{};newData.syslog=results[3]||[];newData.certificates=results[4]||[];}else if(tab==='disks'){newData.disks=results[0]||[];newData.lvm=results[1]||[];newData.lvmthin=results[2]||[];newData.zfs=results[3]||[];}else if(tab==='repos')newData.repos=results[0]?.repositories||[];else if(tab==='subscription')newData.subscription=results[0]||{};else if(tab==='ceph'){newData.ceph={status:results[0],osd:results[1]||[],mon:results[2]||[],pools:results[3]||[],available:results[0]!==null};}return newData;});}catch(e){console.error(e);}setLoading(false);};// LW: Feb 2026 - reset data and load summary when node changes
useEffect(()=>{setData({});setConfigSubTab('network');setMonitorSubTab('performance');setActiveDetailTab('summary');loadTabData('summary');},[node]);// Load data when tab changes
useEffect(()=>{if(activeDetailTab==='summary'&&!data.summary)loadTabData('summary');else if(activeDetailTab==='monitor'){if(monitorSubTab==='performance'&&!data.performance)loadTabData('performance');else if(monitorSubTab==='tasks'&&!data.tasks)loadTabData('tasks');}else if(activeDetailTab==='configure'){if(configSubTab==='network'&&!data.network)loadTabData('network');else if(['dns','hosts','time','certs','syslog'].includes(configSubTab)&&!data.dns)loadTabData('system');else if(['disks','lvm','lvmthin','zfs'].includes(configSubTab)&&!data.disks)loadTabData('disks');else if(configSubTab==='repos'&&!data.repos)loadTabData('repos');else if(configSubTab==='ceph'&&!data.ceph)loadTabData('ceph');}else if(activeDetailTab==='subscription'&&!data.subscription)loadTabData('subscription');},[activeDetailTab,configSubTab,monitorSubTab]);const handlePerfTimeframeChange=tf=>{setPerfTimeframe(tf);loadTabData('performance',tf);};const nodeVms=(clusterResources||[]).filter(r=>r.node===node&&(r.type==='qemu'||r.type==='lxc'));const runningVms=nodeVms.filter(v=>v.status==='running').length;// LW: Feb 2026 - backend sends flat fields: cpu_percent, mem_used, mem_total, disk_used, disk_total
// Swap only available from summary API, not clusterMetrics
const cpuPercent=metrics.cpu_percent?.toFixed(1)||'0.0';const ramUsed=metrics.mem_used||0;const ramTotal=metrics.mem_total||0;const ramPercent=ramTotal>0?(ramUsed/ramTotal*100).toFixed(1):'0.0';const swapUsed=data.summary?.swap?.used||0;const swapTotal=data.summary?.swap?.total||0;const swapPercent=swapTotal>0?(swapUsed/swapTotal*100).toFixed(1):'0.0';const rootUsed=metrics.disk_used||0;const rootTotal=metrics.disk_total||0;const rootPercent=rootTotal>0?(rootUsed/rootTotal*100).toFixed(1):'0.0';return/*#__PURE__*/React.createElement("div",{className:"space-y-0"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between px-4 py-2 border-b border-proxmox-border",style:{background:'#22343c'}},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:onBack,className:"p-1 hover:text-white",style:{color:'#adbbc4'},title:t('backToList')},/*#__PURE__*/React.createElement(Icons.ChevronLeft,{className:"w-4 h-4"})),/*#__PURE__*/React.createElement(Icons.Server,{className:"w-4 h-4",style:{color:nodeOnline?'#49afd9':'#f54f47'}}),/*#__PURE__*/React.createElement("span",{className:"text-[14px] font-medium",style:{color:'#e9ecef'}},node),/*#__PURE__*/React.createElement("span",{className:`corp-badge ${nodeOnline?isMaint?'corp-badge-maintenance':'corp-badge-online':'corp-badge-offline'}`},isMaint?t('maintenance'):nodeOnline?t('online'):t('offline'))),/*#__PURE__*/React.createElement("div",{className:"corp-toolbar flex items-center gap-1"},/*#__PURE__*/React.createElement("div",{className:"relative"},/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();setShowActionsMenu(!showActionsMenu);}},t('actions')," ",/*#__PURE__*/React.createElement(Icons.ChevronDown,{className:"w-3 h-3"})),showActionsMenu&&/*#__PURE__*/React.createElement("div",{className:"corp-dropdown absolute right-0 top-full mt-1 w-52 z-50 py-1",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("button",{onClick:()=>{onMaintenanceToggle(node,!isMaint);setShowActionsMenu(false);},className:"w-full text-left px-3 py-1.5 text-[13px] flex items-center gap-2",style:{color:'#adbbc4'}},/*#__PURE__*/React.createElement(Icons.Wrench,{className:"w-3.5 h-3.5"})," ",isMaint?t('disableMaintenance')||'Disable Maintenance':t('maintenance')),/*#__PURE__*/React.createElement("button",{onClick:()=>{onNodeAction(node,'reboot');setShowActionsMenu(false);},className:"w-full text-left px-3 py-1.5 text-[13px] flex items-center gap-2",style:{color:'#adbbc4'}},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-3.5 h-3.5"})," ",t('rebootNode')),/*#__PURE__*/React.createElement("button",{onClick:()=>{onNodeAction(node,'shutdown');setShowActionsMenu(false);},className:"w-full text-left px-3 py-1.5 text-[13px] flex items-center gap-2",style:{color:'#f54f47'}},/*#__PURE__*/React.createElement(Icons.Power,{className:"w-3.5 h-3.5"})," ",t('shutdownNode')),/*#__PURE__*/React.createElement("button",{onClick:()=>{onStartUpdate(node);setShowActionsMenu(false);},className:"w-full text-left px-3 py-1.5 text-[13px] flex items-center gap-2",style:{color:'#adbbc4'}},/*#__PURE__*/React.createElement(Icons.Download,{className:"w-3.5 h-3.5"})," ",t('update')||'Update'),/*#__PURE__*/React.createElement("div",{className:"my-1",style:{borderTop:'1px solid #485764'}}),/*#__PURE__*/React.createElement("button",{onClick:()=>{onOpenNodeConfig(node);setShowActionsMenu(false);},className:"w-full text-left px-3 py-1.5 text-[13px] flex items-center gap-2",style:{color:'#adbbc4'}},/*#__PURE__*/React.createElement(Icons.Settings,{className:"w-3.5 h-3.5"})," ",t('nodeSettings')))))),/*#__PURE__*/React.createElement("div",{className:"corp-tab-strip px-4",style:{background:'#22343c'}},['summary','monitor','configure','vms','shell','subscription'].map(tab=>/*#__PURE__*/React.createElement("button",{key:tab,className:activeDetailTab===tab?'active':'',onClick:()=>setActiveDetailTab(tab)},tab==='summary'?t('summary'):tab==='monitor'?t('monitor'):tab==='configure'?t('configure'):tab==='vms'?'VMs':tab==='shell'?'Shell':t('subscriptionInfo')))),/*#__PURE__*/React.createElement("div",{className:"p-4"},loading&&!data.summary&&/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center h-32"},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-5 h-5 animate-spin",style:{color:'#49afd9'}})),activeDetailTab==='summary'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",{style:{border:'1px solid #485764'}},/*#__PURE__*/React.createElement("div",{className:"px-3 py-2",style:{background:'#22343c',borderBottom:'1px solid #485764'}},/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium",style:{color:'#e9ecef'}},t('hostDetails'))),/*#__PURE__*/React.createElement("table",{className:"corp-property-grid"},/*#__PURE__*/React.createElement("tbody",null,/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('status')),/*#__PURE__*/React.createElement("td",{className:"flex items-center gap-1.5"},/*#__PURE__*/React.createElement("span",{className:"w-2 h-2 rounded-full",style:{background:nodeOnline?'#60b515':'#f54f47'}})," ",isMaint?t('maintenance'):nodeOnline?t('online'):t('offline'))),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('pveVersion')),/*#__PURE__*/React.createElement("td",null,data.summary?.pveversion||metrics.pveversion||'-')),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('kernelVersion')),/*#__PURE__*/React.createElement("td",{style:{fontFamily:'monospace',fontSize:'12px'}},data.summary?.kversion||'-')),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('cpuModel')),/*#__PURE__*/React.createElement("td",null,data.summary?.cpuinfo?.model||'-')),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('cores')),/*#__PURE__*/React.createElement("td",null,data.summary?.cpuinfo?.cores||'-'," (",data.summary?.cpuinfo?.cpus||'-'," ",t('logicalProcessors'),")")),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('cpuSockets')),/*#__PURE__*/React.createElement("td",null,data.summary?.cpuinfo?.sockets||'-')),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"VMs"),/*#__PURE__*/React.createElement("td",null,nodeVms.length," (",runningVms," ",t('running').toLowerCase(),")")),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('uptime')),/*#__PURE__*/React.createElement("td",null,formatUptime(data.summary?.uptime||metrics.uptime)))))),/*#__PURE__*/React.createElement("div",{style:{border:'1px solid #485764'}},/*#__PURE__*/React.createElement("div",{className:"px-3 py-2",style:{background:'#22343c',borderBottom:'1px solid #485764'}},/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium",style:{color:'#e9ecef'}},t('capacityUsage'))),/*#__PURE__*/React.createElement("div",{className:"p-3 space-y-3"},[{label:'CPU',percent:cpuPercent,used:`${cpuPercent}%`,total:`${data.summary?.cpuinfo?.cpus||'-'} ${t('logicalProcessors')}`,color:'#49afd9'},{label:'RAM',percent:ramPercent,used:formatBytes(ramUsed),total:formatBytes(ramTotal),color:'#9b59b6'},{label:'Swap',percent:swapPercent,used:formatBytes(swapUsed),total:formatBytes(swapTotal),color:'#ec4899'},{label:'Root FS',percent:rootPercent,used:formatBytes(rootUsed),total:formatBytes(rootTotal),color:'#60b515'}].map(item=>/*#__PURE__*/React.createElement("div",{key:item.label},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-1"},/*#__PURE__*/React.createElement("span",{className:"text-[12px]",style:{color:'#adbbc4'}},item.label),/*#__PURE__*/React.createElement("span",{className:"text-[12px]",style:{color:'#e9ecef'}},item.used," / ",item.total)),/*#__PURE__*/React.createElement("div",{className:"corp-capacity-bar"},/*#__PURE__*/React.createElement("div",{style:{width:`${Math.min(item.percent,100)}%`,background:item.color}})))))),/*#__PURE__*/React.createElement("div",{style:{border:'1px solid #485764'}},/*#__PURE__*/React.createElement("div",{className:"px-3 py-2",style:{background:'#22343c',borderBottom:'1px solid #485764'}},/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium",style:{color:'#e9ecef'}},t('hardwareInfo'))),/*#__PURE__*/React.createElement("table",{className:"corp-property-grid"},/*#__PURE__*/React.createElement("tbody",null,/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"CPU"),/*#__PURE__*/React.createElement("td",null,data.summary?.cpuinfo?.model||'-')),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('totalRam')),/*#__PURE__*/React.createElement("td",null,formatBytes(ramTotal))),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('networkInterfaces')),/*#__PURE__*/React.createElement("td",null,data.network?Array.isArray(data.network)?data.network.length:'-':'-')),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('rootFilesystem')),/*#__PURE__*/React.createElement("td",null,formatBytes(rootTotal)))))),/*#__PURE__*/React.createElement("div",{style:{border:'1px solid #485764'}},/*#__PURE__*/React.createElement("div",{className:"px-3 py-2",style:{background:'#22343c',borderBottom:'1px solid #485764'}},/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium",style:{color:'#e9ecef'}},t('relatedObjects'))),/*#__PURE__*/React.createElement("table",{className:"corp-property-grid"},/*#__PURE__*/React.createElement("tbody",null,/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"QEMU VMs"),/*#__PURE__*/React.createElement("td",null,nodeVms.filter(v=>v.type==='qemu').length)),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"LXC CTs"),/*#__PURE__*/React.createElement("td",null,nodeVms.filter(v=>v.type==='lxc').length)),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('running')),/*#__PURE__*/React.createElement("td",null,runningVms)),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('stopped')),/*#__PURE__*/React.createElement("td",null,nodeVms.length-runningVms)))))),activeDetailTab==='monitor'&&/*#__PURE__*/React.createElement("div",{className:"flex gap-0",style:{minHeight:'400px'}},/*#__PURE__*/React.createElement("div",{className:"corp-subnav"},/*#__PURE__*/React.createElement("button",{className:`corp-subnav-item ${monitorSubTab==='performance'?'active':''}`,onClick:()=>setMonitorSubTab('performance')},t('performance')),/*#__PURE__*/React.createElement("button",{className:`corp-subnav-item ${monitorSubTab==='tasks'?'active':''}`,onClick:()=>{setMonitorSubTab('tasks');if(!data.tasks)loadTabData('tasks');}},t('tasks'))),/*#__PURE__*/React.createElement("div",{className:"flex-1 pl-4"},monitorSubTab==='performance'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium",style:{color:'#e9ecef'}},t('performance')),/*#__PURE__*/React.createElement("div",{className:"flex gap-1"},['hour','day','week','month','year'].map(tf=>/*#__PURE__*/React.createElement("button",{key:tf,onClick:()=>handlePerfTimeframeChange(tf),className:"px-2 py-1 text-[11px]",style:perfTimeframe===tf?{background:'#324f61',color:'#e9ecef',border:'1px solid #49afd9'}:{color:'#adbbc4',border:'1px solid #485764'}},tf.charAt(0).toUpperCase()+tf.slice(1))))),loading&&!data.performance?/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center h-32"},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-5 h-5 animate-spin",style:{color:'#49afd9'}})):data.performance?.metrics?/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3"},/*#__PURE__*/React.createElement(LineChart,{data:data.performance.metrics.cpu,timestamps:data.performance.timestamps,label:"CPU",color:"#49afd9",unit:"%",yMin:0,yMax:100}),/*#__PURE__*/React.createElement(LineChart,{data:data.performance.metrics.memory,timestamps:data.performance.timestamps,label:"Memory",color:"#9b59b6",unit:"%",yMin:0,yMax:100}),/*#__PURE__*/React.createElement(LineChart,{data:data.performance.metrics.iowait,timestamps:data.performance.timestamps,label:"IO Wait",color:"#eab308",unit:"%"}),/*#__PURE__*/React.createElement(LineChart,{data:data.performance.metrics.loadavg,timestamps:data.performance.timestamps,label:"Load Average",color:"#22c55e",unit:""})),/*#__PURE__*/React.createElement(LineChart,{datasets:[{label:'Net In',data:data.performance.metrics.net_in,color:'#06b6d4'},{label:'Net Out',data:data.performance.metrics.net_out,color:'#8b5cf6'}],timestamps:data.performance.timestamps,label:"Network I/O",unit:" KB/s"}),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3"},/*#__PURE__*/React.createElement(LineChart,{data:data.performance.metrics.swap,timestamps:data.performance.timestamps,label:"Swap",color:"#ec4899",unit:"%",yMin:0,yMax:100}),/*#__PURE__*/React.createElement(LineChart,{data:data.performance.metrics.rootfs,timestamps:data.performance.timestamps,label:"Root FS",color:"#a855f7",unit:"%",yMin:0,yMax:100}))):/*#__PURE__*/React.createElement("div",{className:"text-center py-8",style:{color:'#728b9a'}},/*#__PURE__*/React.createElement(Icons.BarChart,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),/*#__PURE__*/React.createElement("p",{className:"text-[13px]"},"No performance data available"))),monitorSubTab==='tasks'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium mb-3 block",style:{color:'#e9ecef'}},t('tasks')),loading&&!data.tasks?/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center h-32"},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-5 h-5 animate-spin",style:{color:'#49afd9'}})):/*#__PURE__*/React.createElement("table",{className:"corp-datagrid"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",null,t('type')),/*#__PURE__*/React.createElement("th",null,t('status')),/*#__PURE__*/React.createElement("th",null,"UPID"),/*#__PURE__*/React.createElement("th",null,t('started')||'Started'))),/*#__PURE__*/React.createElement("tbody",null,(data.tasks||[]).slice(0,50).map((task,i)=>/*#__PURE__*/React.createElement("tr",{key:i},/*#__PURE__*/React.createElement("td",null,task.type||'-'),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("span",{className:`corp-badge ${task.status==='OK'||task.status==='running'?'corp-badge-running':task.status?'corp-badge-offline':'corp-badge-stopped'}`},task.status||'-')),/*#__PURE__*/React.createElement("td",{className:"text-[11px] font-mono",style:{color:'#728b9a'}},task.upid?task.upid.substring(0,30)+'...':'-'),/*#__PURE__*/React.createElement("td",null,task.starttime?new Date(task.starttime*1000).toLocaleString():'-'))),(!data.tasks||data.tasks.length===0)&&/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:4,className:"text-center py-4",style:{color:'#728b9a'}},"No tasks"))))))),activeDetailTab==='configure'&&/*#__PURE__*/React.createElement("div",{className:"flex gap-0",style:{minHeight:'400px'}},/*#__PURE__*/React.createElement("div",{className:"corp-subnav"},/*#__PURE__*/React.createElement("div",{className:"corp-subnav-header"},t('network')),/*#__PURE__*/React.createElement("button",{className:`corp-subnav-item ${configSubTab==='network'?'active':''}`,onClick:()=>setConfigSubTab('network')},t('network')),/*#__PURE__*/React.createElement("div",{className:"corp-subnav-header"},t('systemInfo')),/*#__PURE__*/React.createElement("button",{className:`corp-subnav-item ${configSubTab==='dns'?'active':''}`,onClick:()=>{setConfigSubTab('dns');if(!data.dns)loadTabData('system');}},t('dns')),/*#__PURE__*/React.createElement("button",{className:`corp-subnav-item ${configSubTab==='hosts'?'active':''}`,onClick:()=>{setConfigSubTab('hosts');if(!data.dns)loadTabData('system');}},t('hostsFile')),/*#__PURE__*/React.createElement("button",{className:`corp-subnav-item ${configSubTab==='time'?'active':''}`,onClick:()=>{setConfigSubTab('time');if(!data.dns)loadTabData('system');}},t('timeConfig')),/*#__PURE__*/React.createElement("button",{className:`corp-subnav-item ${configSubTab==='certs'?'active':''}`,onClick:()=>{setConfigSubTab('certs');if(!data.dns)loadTabData('system');}},t('certificates')),/*#__PURE__*/React.createElement("button",{className:`corp-subnav-item ${configSubTab==='syslog'?'active':''}`,onClick:()=>{setConfigSubTab('syslog');if(!data.dns)loadTabData('system');}},t('syslog')),/*#__PURE__*/React.createElement("div",{className:"corp-subnav-header"},t('storage')),/*#__PURE__*/React.createElement("button",{className:`corp-subnav-item ${configSubTab==='disks'?'active':''}`,onClick:()=>{setConfigSubTab('disks');if(!data.disks)loadTabData('disks');}},t('disks')),/*#__PURE__*/React.createElement("button",{className:`corp-subnav-item ${configSubTab==='lvm'?'active':''}`,onClick:()=>{setConfigSubTab('lvm');if(!data.disks)loadTabData('disks');}},t('lvmStorage')),/*#__PURE__*/React.createElement("button",{className:`corp-subnav-item ${configSubTab==='lvmthin'?'active':''}`,onClick:()=>{setConfigSubTab('lvmthin');if(!data.disks)loadTabData('disks');}},t('lvmThinStorage')),/*#__PURE__*/React.createElement("button",{className:`corp-subnav-item ${configSubTab==='zfs'?'active':''}`,onClick:()=>{setConfigSubTab('zfs');if(!data.disks)loadTabData('disks');}},t('zfsStorage')),/*#__PURE__*/React.createElement("div",{className:"corp-subnav-header"},"Extras"),/*#__PURE__*/React.createElement("button",{className:`corp-subnav-item ${configSubTab==='repos'?'active':''}`,onClick:()=>{setConfigSubTab('repos');if(!data.repos)loadTabData('repos');}},t('repositories')),/*#__PURE__*/React.createElement("button",{className:`corp-subnav-item ${configSubTab==='ceph'?'active':''}`,onClick:()=>{setConfigSubTab('ceph');if(!data.ceph)loadTabData('ceph');}},"Ceph")),/*#__PURE__*/React.createElement("div",{className:"flex-1 pl-4"},loading&&!data.network&&!data.dns&&!data.disks?/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center h-32"},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-5 h-5 animate-spin",style:{color:'#49afd9'}})):/*#__PURE__*/React.createElement(React.Fragment,null,configSubTab==='network'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium",style:{color:'#e9ecef'}},t('network')),/*#__PURE__*/React.createElement("div",{className:"flex gap-1"},/*#__PURE__*/React.createElement("div",{className:"relative"},/*#__PURE__*/React.createElement("button",{onClick:()=>setData(prev=>({...prev,showCreateMenu:!prev.showCreateMenu})),className:"px-2 py-1 text-[11px] flex items-center gap-1",style:{color:'#49afd9',border:'1px solid #485764'}},/*#__PURE__*/React.createElement(Icons.Plus,{className:"w-3 h-3"})," Create"),data.showCreateMenu&&/*#__PURE__*/React.createElement("div",{className:"absolute top-full right-0 mt-1 z-10 min-w-[160px]",style:{background:'#22343c',border:'1px solid #485764'}},['bridge','bond','vlan','OVSBridge','OVSBond','OVSIntPort'].map(ifType=>/*#__PURE__*/React.createElement("button",{key:ifType,onClick:()=>setData(prev=>({...prev,showCreateMenu:false,editIface:{type:ifType,iface:'',isNew:true}})),className:"w-full px-3 py-1.5 text-left text-[12px] hover:bg-[#324f61]",style:{color:'#adbbc4'}},"Linux ",ifType.charAt(0).toUpperCase()+ifType.slice(1))))),/*#__PURE__*/React.createElement("button",{onClick:async()=>{const res=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/network`,{method:'PUT'});addToast(res&&res.ok?'Network config applied':'Error',res&&res.ok?'success':'error');loadTabData('network');},className:"px-2 py-1 text-[11px]",style:{color:'#60b515',border:'1px solid rgba(96,181,21,0.3)'}},"Apply"),/*#__PURE__*/React.createElement("button",{onClick:async()=>{const res=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/network`,{method:'DELETE'});addToast(res&&res.ok?'Changes reverted':'Error',res&&res.ok?'success':'error');loadTabData('network');},className:"px-2 py-1 text-[11px]",style:{color:'#efc006',border:'1px solid rgba(239,192,6,0.3)'}},"Revert"))),/*#__PURE__*/React.createElement("table",{className:"corp-datagrid"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",null,t('name')),/*#__PURE__*/React.createElement("th",null,t('type')),/*#__PURE__*/React.createElement("th",null,"CIDR"),/*#__PURE__*/React.createElement("th",null,"Gateway"),/*#__PURE__*/React.createElement("th",null,t('active')||'Active'),/*#__PURE__*/React.createElement("th",{style:{width:'60px'}}))),/*#__PURE__*/React.createElement("tbody",null,(Array.isArray(data.network)?data.network:[]).map((iface,i)=>/*#__PURE__*/React.createElement("tr",{key:i},/*#__PURE__*/React.createElement("td",{style:{fontFamily:'monospace',fontSize:'12px'}},iface.iface||iface.name||'-'),/*#__PURE__*/React.createElement("td",null,iface.type||'-'),/*#__PURE__*/React.createElement("td",{style:{fontFamily:'monospace',fontSize:'12px'}},iface.cidr||iface.address||'-'),/*#__PURE__*/React.createElement("td",{style:{fontFamily:'monospace',fontSize:'12px'}},iface.gateway||'-'),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("span",{className:"w-2 h-2 rounded-full inline-block",style:{background:iface.active?'#60b515':'#728b9a'}})),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("div",{className:"flex gap-1"},/*#__PURE__*/React.createElement("button",{onClick:()=>setData(prev=>({...prev,editIface:{...iface,isNew:false}})),className:"p-1 hover:bg-[#324f61]",title:"Edit",style:{color:'#49afd9'}},/*#__PURE__*/React.createElement(Icons.Cog,{className:"w-3 h-3"})),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!confirm(`${t('delete')} ${iface.iface}?`))return;const res=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/network/${iface.iface}`,{method:'DELETE'});addToast(res&&res.ok?`${iface.iface} ${t('deleted')}`:'Error',res&&res.ok?'success':'error');loadTabData('network');},className:"p-1 hover:bg-[#324f61]",title:"Delete",style:{color:'#e57373'}},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-3 h-3"})))))),(!data.network||data.network.length===0)&&/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:6,className:"text-center py-4",style:{color:'#728b9a'}},"No network interfaces")))),data.editIface&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",style:{background:'rgba(0,0,0,0.7)'}},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-xl",style:{background:'#1b2a32',border:'1px solid #485764'}},/*#__PURE__*/React.createElement("div",{className:"px-4 py-3 flex items-center justify-between",style:{borderBottom:'1px solid #485764',background:'#22343c'}},/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium",style:{color:'#e9ecef'}},data.editIface.isNew?`Create: Linux ${data.editIface.type}`:`Edit: ${data.editIface.iface}`),/*#__PURE__*/React.createElement("button",{onClick:()=>setData(prev=>({...prev,editIface:null})),style:{color:'#728b9a'}},/*#__PURE__*/React.createElement(Icons.X,{className:"w-4 h-4"}))),/*#__PURE__*/React.createElement("div",{className:"p-4 space-y-3"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-[11px] block mb-1",style:{color:'#728b9a'}},t('name')),/*#__PURE__*/React.createElement("input",{type:"text",value:data.editIface.iface||'',disabled:!data.editIface.isNew,onChange:e=>setData(prev=>({...prev,editIface:{...prev.editIface,iface:e.target.value}})),placeholder:data.editIface.type==='bridge'?'vmbr0':data.editIface.type==='bond'?'bond0':'vlan0',className:"w-full px-2 py-1.5 text-[12px] bg-proxmox-dark border border-proxmox-border text-white disabled:opacity-50"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-[11px] block mb-1",style:{color:'#728b9a'}},"IPv4/CIDR"),/*#__PURE__*/React.createElement("input",{type:"text",value:data.editIface.cidr||'',onChange:e=>setData(prev=>({...prev,editIface:{...prev.editIface,cidr:e.target.value}})),placeholder:"192.168.1.1/24",className:"w-full px-2 py-1.5 text-[12px] bg-proxmox-dark border border-proxmox-border text-white font-mono"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-[11px] block mb-1",style:{color:'#728b9a'}},"Gateway (IPv4)"),/*#__PURE__*/React.createElement("input",{type:"text",value:data.editIface.gateway||'',onChange:e=>setData(prev=>({...prev,editIface:{...prev.editIface,gateway:e.target.value}})),placeholder:"192.168.1.1",className:"w-full px-2 py-1.5 text-[12px] bg-proxmox-dark border border-proxmox-border text-white font-mono"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-[11px] block mb-1",style:{color:'#728b9a'}},"IPv6/CIDR"),/*#__PURE__*/React.createElement("input",{type:"text",value:data.editIface.cidr6||'',onChange:e=>setData(prev=>({...prev,editIface:{...prev.editIface,cidr6:e.target.value}})),className:"w-full px-2 py-1.5 text-[12px] bg-proxmox-dark border border-proxmox-border text-white font-mono"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-[11px] block mb-1",style:{color:'#728b9a'}},"Gateway (IPv6)"),/*#__PURE__*/React.createElement("input",{type:"text",value:data.editIface.gateway6||'',onChange:e=>setData(prev=>({...prev,editIface:{...prev.editIface,gateway6:e.target.value}})),className:"w-full px-2 py-1.5 text-[12px] bg-proxmox-dark border border-proxmox-border text-white font-mono"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-[11px] block mb-1",style:{color:'#728b9a'}},"MTU"),/*#__PURE__*/React.createElement("input",{type:"number",value:data.editIface.mtu||'',onChange:e=>setData(prev=>({...prev,editIface:{...prev.editIface,mtu:e.target.value}})),placeholder:"1500",className:"w-full px-2 py-1.5 text-[12px] bg-proxmox-dark border border-proxmox-border text-white"}))),data.editIface.type==='bridge'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-[11px] block mb-1",style:{color:'#728b9a'}},"Bridge Ports"),/*#__PURE__*/React.createElement("input",{type:"text",value:data.editIface.bridge_ports||'',onChange:e=>setData(prev=>({...prev,editIface:{...prev.editIface,bridge_ports:e.target.value}})),placeholder:"ens18",className:"w-full px-2 py-1.5 text-[12px] bg-proxmox-dark border border-proxmox-border text-white"})),/*#__PURE__*/React.createElement("div",{className:"flex items-center pt-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-[12px]",style:{color:'#adbbc4'}},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:data.editIface.bridge_vlan_aware||false,onChange:e=>setData(prev=>({...prev,editIface:{...prev.editIface,bridge_vlan_aware:e.target.checked}}))}),"VLAN aware"))),data.editIface.type==='bond'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-[11px] block mb-1",style:{color:'#728b9a'}},"Slaves"),/*#__PURE__*/React.createElement("input",{type:"text",value:data.editIface.slaves||'',onChange:e=>setData(prev=>({...prev,editIface:{...prev.editIface,slaves:e.target.value}})),placeholder:"ens18 ens19",className:"w-full px-2 py-1.5 text-[12px] bg-proxmox-dark border border-proxmox-border text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-[11px] block mb-1",style:{color:'#728b9a'}},"Mode"),/*#__PURE__*/React.createElement("select",{value:data.editIface.bond_mode||'balance-rr',onChange:e=>setData(prev=>({...prev,editIface:{...prev.editIface,bond_mode:e.target.value}})),className:"w-full px-2 py-1.5 text-[12px] bg-proxmox-dark border border-proxmox-border text-white"},/*#__PURE__*/React.createElement("option",{value:"balance-rr"},"balance-rr"),/*#__PURE__*/React.createElement("option",{value:"active-backup"},"active-backup"),/*#__PURE__*/React.createElement("option",{value:"balance-xor"},"balance-xor"),/*#__PURE__*/React.createElement("option",{value:"broadcast"},"broadcast"),/*#__PURE__*/React.createElement("option",{value:"802.3ad"},"LACP (802.3ad)"),/*#__PURE__*/React.createElement("option",{value:"balance-tlb"},"balance-tlb"),/*#__PURE__*/React.createElement("option",{value:"balance-alb"},"balance-alb"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-[11px] block mb-1",style:{color:'#728b9a'}},"Hash Policy"),/*#__PURE__*/React.createElement("select",{value:data.editIface.bond_xmit_hash_policy||'',onChange:e=>setData(prev=>({...prev,editIface:{...prev.editIface,bond_xmit_hash_policy:e.target.value}})),className:"w-full px-2 py-1.5 text-[12px] bg-proxmox-dark border border-proxmox-border text-white"},/*#__PURE__*/React.createElement("option",{value:""},"Default"),/*#__PURE__*/React.createElement("option",{value:"layer2"},"layer2"),/*#__PURE__*/React.createElement("option",{value:"layer2+3"},"layer2+3"),/*#__PURE__*/React.createElement("option",{value:"layer3+4"},"layer3+4"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-[11px] block mb-1",style:{color:'#728b9a'}},"Bond Primary"),/*#__PURE__*/React.createElement("input",{type:"text",value:data.editIface['bond-primary']||'',onChange:e=>setData(prev=>({...prev,editIface:{...prev.editIface,'bond-primary':e.target.value}})),className:"w-full px-2 py-1.5 text-[12px] bg-proxmox-dark border border-proxmox-border text-white"}))),data.editIface.type==='vlan'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-[11px] block mb-1",style:{color:'#728b9a'}},"VLAN raw device"),/*#__PURE__*/React.createElement("input",{type:"text",value:data.editIface['vlan-raw-device']||'',onChange:e=>setData(prev=>({...prev,editIface:{...prev.editIface,'vlan-raw-device':e.target.value}})),placeholder:"vmbr0",className:"w-full px-2 py-1.5 text-[12px] bg-proxmox-dark border border-proxmox-border text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-[11px] block mb-1",style:{color:'#728b9a'}},"VLAN Tag"),/*#__PURE__*/React.createElement("input",{type:"number",value:data.editIface['vlan-id']||'',onChange:e=>setData(prev=>({...prev,editIface:{...prev.editIface,'vlan-id':e.target.value}})),placeholder:"100",className:"w-full px-2 py-1.5 text-[12px] bg-proxmox-dark border border-proxmox-border text-white"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-[12px]",style:{color:'#adbbc4'}},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:data.editIface.autostart!==0,onChange:e=>setData(prev=>({...prev,editIface:{...prev.editIface,autostart:e.target.checked?1:0}}))}),"Autostart")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-[11px] block mb-1",style:{color:'#728b9a'}},"Comment"),/*#__PURE__*/React.createElement("input",{type:"text",value:data.editIface.comments||'',onChange:e=>setData(prev=>({...prev,editIface:{...prev.editIface,comments:e.target.value}})),className:"w-full px-2 py-1.5 text-[12px] bg-proxmox-dark border border-proxmox-border text-white"})))),/*#__PURE__*/React.createElement("div",{className:"px-4 py-3 flex justify-end gap-2",style:{borderTop:'1px solid #485764'}},/*#__PURE__*/React.createElement("button",{onClick:()=>setData(prev=>({...prev,editIface:null})),className:"px-3 py-1.5 text-[12px]",style:{color:'#adbbc4',border:'1px solid #485764'}},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{const iface=data.editIface;if(!iface.iface){addToast(t('nameRequired')||'Name required','error');return;}const payload={...iface};delete payload.isNew;delete payload.active;delete payload.exists;delete payload.families;delete payload.method;delete payload.method6;delete payload.priority;const url=iface.isNew?`${API_URL}/clusters/${clusterId}/nodes/${node}/network`:`${API_URL}/clusters/${clusterId}/nodes/${node}/network/${iface.iface}`;const method=iface.isNew?'POST':'PUT';const res=await authFetch(url,{method,headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(res&&res.ok){addToast(iface.isNew?t('interfaceCreated')||'Interface created':t('interfaceUpdated')||'Interface updated','success');setData(prev=>({...prev,editIface:null}));loadTabData('network');}else{addToast('Error','error');}},className:"px-3 py-1.5 text-[12px]",style:{color:'#fff',background:'#49afd9',border:'none'}},data.editIface.isNew?'Create':t('save')))))),configSubTab==='dns'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium",style:{color:'#e9ecef'}},t('dns')),!editingDns?/*#__PURE__*/React.createElement("button",{onClick:()=>{setEditingDns(true);setDnsForm({search:data.dns?.search||'',dns1:data.dns?.dns1||'',dns2:data.dns?.dns2||'',dns3:data.dns?.dns3||''});},className:"px-2 py-1 text-[11px]",style:{color:'#49afd9',border:'1px solid #485764'}},t('edit')):/*#__PURE__*/React.createElement("div",{className:"flex gap-1"},/*#__PURE__*/React.createElement("button",{onClick:()=>setEditingDns(false),className:"px-2 py-1 text-[11px]",style:{color:'#adbbc4',border:'1px solid #485764'}},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:()=>{handleSave('dns',dnsForm,'DNS saved');setEditingDns(false);},disabled:saving,className:"px-2 py-1 text-[11px]",style:{color:'#60b515',border:'1px solid rgba(96,181,21,0.3)'}},saving?'...':t('save')))),editingDns?/*#__PURE__*/React.createElement("div",{className:"space-y-2"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-[11px] block mb-1",style:{color:'#728b9a'}},"Search Domain"),/*#__PURE__*/React.createElement("input",{value:dnsForm.search,onChange:e=>setDnsForm({...dnsForm,search:e.target.value}),className:"w-full px-2 py-1.5 text-[13px] bg-proxmox-dark border border-proxmox-border text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-[11px] block mb-1",style:{color:'#728b9a'}},"DNS 1"),/*#__PURE__*/React.createElement("input",{value:dnsForm.dns1,onChange:e=>setDnsForm({...dnsForm,dns1:e.target.value}),className:"w-full px-2 py-1.5 text-[13px] bg-proxmox-dark border border-proxmox-border text-white font-mono"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-[11px] block mb-1",style:{color:'#728b9a'}},"DNS 2"),/*#__PURE__*/React.createElement("input",{value:dnsForm.dns2,onChange:e=>setDnsForm({...dnsForm,dns2:e.target.value}),className:"w-full px-2 py-1.5 text-[13px] bg-proxmox-dark border border-proxmox-border text-white font-mono"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-[11px] block mb-1",style:{color:'#728b9a'}},"DNS 3"),/*#__PURE__*/React.createElement("input",{value:dnsForm.dns3,onChange:e=>setDnsForm({...dnsForm,dns3:e.target.value}),className:"w-full px-2 py-1.5 text-[13px] bg-proxmox-dark border border-proxmox-border text-white font-mono"}))):/*#__PURE__*/React.createElement("table",{className:"corp-property-grid"},/*#__PURE__*/React.createElement("tbody",null,/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"Search Domain"),/*#__PURE__*/React.createElement("td",null,data.dns?.search||'-')),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"DNS 1"),/*#__PURE__*/React.createElement("td",{style:{fontFamily:'monospace',fontSize:'12px'}},data.dns?.dns1||'-')),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"DNS 2"),/*#__PURE__*/React.createElement("td",{style:{fontFamily:'monospace',fontSize:'12px'}},data.dns?.dns2||'-')),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"DNS 3"),/*#__PURE__*/React.createElement("td",{style:{fontFamily:'monospace',fontSize:'12px'}},data.dns?.dns3||'-'))))),configSubTab==='hosts'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium",style:{color:'#e9ecef'}},t('hostsFile')),!editingHosts?/*#__PURE__*/React.createElement("button",{onClick:()=>{setEditingHosts(true);setHostsForm(data.hosts||'');},className:"px-2 py-1 text-[11px]",style:{color:'#49afd9',border:'1px solid #485764'}},t('edit')):/*#__PURE__*/React.createElement("div",{className:"flex gap-1"},/*#__PURE__*/React.createElement("button",{onClick:()=>setEditingHosts(false),className:"px-2 py-1 text-[11px]",style:{color:'#adbbc4',border:'1px solid #485764'}},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:()=>{handleSave('hosts',{data:hostsForm},'Hosts saved','POST');setEditingHosts(false);},disabled:saving,className:"px-2 py-1 text-[11px]",style:{color:'#60b515',border:'1px solid rgba(96,181,21,0.3)'}},saving?'...':t('save')))),editingHosts?/*#__PURE__*/React.createElement("textarea",{value:hostsForm,onChange:e=>setHostsForm(e.target.value),rows:8,className:"w-full px-3 py-2 text-[12px] bg-proxmox-dark border border-proxmox-border text-white font-mono",style:{resize:'vertical'}}):/*#__PURE__*/React.createElement("pre",{className:"text-[12px] p-3 overflow-auto",style:{background:'#17242b',border:'1px solid #485764',color:'#adbbc4',fontFamily:'monospace',maxHeight:'300px'}},data.hosts||'No data')),configSubTab==='time'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium mb-3 block",style:{color:'#e9ecef'}},t('timeConfig')),/*#__PURE__*/React.createElement("table",{className:"corp-property-grid"},/*#__PURE__*/React.createElement("tbody",null,/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"Timezone"),/*#__PURE__*/React.createElement("td",null,data.time?.timezone||'-')),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"Local Time"),/*#__PURE__*/React.createElement("td",null,data.time?.localtime||'-')),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"UTC Time"),/*#__PURE__*/React.createElement("td",null,data.time?.utctime||'-'))))),configSubTab==='certs'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium",style:{color:'#e9ecef'}},t('certificates')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowCertUpload(!showCertUpload),className:"px-2 py-1 text-[11px]",style:{color:'#49afd9',border:'1px solid #485764'}},showCertUpload?t('cancel'):'Upload')),showCertUpload&&/*#__PURE__*/React.createElement("div",{className:"mb-3 p-3 space-y-2",style:{background:'#17242b',border:'1px solid #485764'}},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-[11px] block mb-1",style:{color:'#728b9a'}},"Certificate (PEM)"),/*#__PURE__*/React.createElement("textarea",{value:certForm.cert,onChange:e=>setCertForm({...certForm,cert:e.target.value}),rows:4,className:"w-full px-2 py-1.5 text-[11px] bg-proxmox-dark border border-proxmox-border text-white font-mono",placeholder:"-----BEGIN CERTIFICATE-----"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-[11px] block mb-1",style:{color:'#728b9a'}},"Private Key (PEM)"),/*#__PURE__*/React.createElement("textarea",{value:certForm.key,onChange:e=>setCertForm({...certForm,key:e.target.value}),rows:4,className:"w-full px-2 py-1.5 text-[11px] bg-proxmox-dark border border-proxmox-border text-white font-mono",placeholder:"-----BEGIN PRIVATE KEY-----"})),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-[12px]",style:{color:'#adbbc4'}},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:certForm.restart,onChange:e=>setCertForm({...certForm,restart:e.target.checked})})," Restart pveproxy after upload"),/*#__PURE__*/React.createElement("button",{onClick:handleCertUpload,disabled:saving||!certForm.cert||!certForm.key,className:"px-3 py-1.5 text-[12px] disabled:opacity-40",style:{color:'#fff',background:'#49afd9',border:'none'}},saving?'...':'Upload Certificate')),/*#__PURE__*/React.createElement("table",{className:"corp-datagrid"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",null,"Filename"),/*#__PURE__*/React.createElement("th",null,"Subject"),/*#__PURE__*/React.createElement("th",null,"Issuer"),/*#__PURE__*/React.createElement("th",null,"Expires"))),/*#__PURE__*/React.createElement("tbody",null,(Array.isArray(data.certificates)?data.certificates:[]).map((cert,i)=>/*#__PURE__*/React.createElement("tr",{key:i},/*#__PURE__*/React.createElement("td",null,cert.filename||'-'),/*#__PURE__*/React.createElement("td",{className:"text-[11px]",style:{maxWidth:'200px',overflow:'hidden',textOverflow:'ellipsis'}},cert.subject||'-'),/*#__PURE__*/React.createElement("td",{className:"text-[11px]",style:{maxWidth:'200px',overflow:'hidden',textOverflow:'ellipsis'}},cert.issuer||'-'),/*#__PURE__*/React.createElement("td",null,cert.notafter?new Date(cert.notafter*1000).toLocaleDateString():'-'))),(!data.certificates||data.certificates.length===0)&&/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:4,className:"text-center py-4",style:{color:'#728b9a'}},"No certificates"))))),configSubTab==='syslog'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium",style:{color:'#e9ecef'}},t('syslog')),/*#__PURE__*/React.createElement("button",{onClick:()=>loadTabData('system'),className:"px-2 py-1 text-[11px] flex items-center gap-1",style:{color:'#49afd9',border:'1px solid #485764'}},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-3 h-3"})," Refresh")),/*#__PURE__*/React.createElement("pre",{className:"text-[11px] p-3 overflow-auto",style:{background:'#17242b',border:'1px solid #485764',color:'#adbbc4',fontFamily:'monospace',maxHeight:'400px'}},Array.isArray(data.syslog)?data.syslog.map(l=>l.t||l.n||l).join('\n'):data.syslog||'No data')),configSubTab==='disks'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium mb-3 block",style:{color:'#e9ecef'}},t('disks')),/*#__PURE__*/React.createElement("table",{className:"corp-datagrid"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",null,"Device"),/*#__PURE__*/React.createElement("th",null,t('type')),/*#__PURE__*/React.createElement("th",null,"Size"),/*#__PURE__*/React.createElement("th",null,t('status')))),/*#__PURE__*/React.createElement("tbody",null,(Array.isArray(data.disks)?data.disks:[]).map((disk,i)=>/*#__PURE__*/React.createElement("tr",{key:i},/*#__PURE__*/React.createElement("td",{style:{fontFamily:'monospace',fontSize:'12px'}},disk.devpath||'-'),/*#__PURE__*/React.createElement("td",null,disk.type||'-'),/*#__PURE__*/React.createElement("td",null,formatBytes(disk.size)),/*#__PURE__*/React.createElement("td",null,disk.health||disk.used||'-'))),(!data.disks||data.disks.length===0)&&/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:4,className:"text-center py-4",style:{color:'#728b9a'}},"No disks"))))),configSubTab==='lvm'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium mb-3 block",style:{color:'#e9ecef'}},t('lvmStorage')),/*#__PURE__*/React.createElement("table",{className:"corp-datagrid"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",null,"VG"),/*#__PURE__*/React.createElement("th",null,"Size"),/*#__PURE__*/React.createElement("th",null,"Free"))),/*#__PURE__*/React.createElement("tbody",null,(Array.isArray(data.lvm)?data.lvm:[]).map((vg,i)=>/*#__PURE__*/React.createElement("tr",{key:i},/*#__PURE__*/React.createElement("td",null,vg.vg||'-'),/*#__PURE__*/React.createElement("td",null,formatBytes(vg.size)),/*#__PURE__*/React.createElement("td",null,formatBytes(vg.free)))),(!data.lvm||data.lvm.length===0)&&/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:3,className:"text-center py-4",style:{color:'#728b9a'}},"No LVM volumes"))))),configSubTab==='lvmthin'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium mb-3 block",style:{color:'#e9ecef'}},t('lvmThinStorage')),/*#__PURE__*/React.createElement("table",{className:"corp-datagrid"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",null,"Pool"),/*#__PURE__*/React.createElement("th",null,"VG"),/*#__PURE__*/React.createElement("th",null,"Size"),/*#__PURE__*/React.createElement("th",null,"Used"))),/*#__PURE__*/React.createElement("tbody",null,(Array.isArray(data.lvmthin)?data.lvmthin:[]).map((tp,i)=>/*#__PURE__*/React.createElement("tr",{key:i},/*#__PURE__*/React.createElement("td",null,tp.lv||'-'),/*#__PURE__*/React.createElement("td",null,tp.vg||'-'),/*#__PURE__*/React.createElement("td",null,formatBytes(tp.lv_size)),/*#__PURE__*/React.createElement("td",null,tp.metadata_usage?`${(tp.metadata_usage*100).toFixed(1)}%`:'-'))),(!data.lvmthin||data.lvmthin.length===0)&&/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:4,className:"text-center py-4",style:{color:'#728b9a'}},"No LVM-Thin pools"))))),configSubTab==='zfs'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium mb-3 block",style:{color:'#e9ecef'}},t('zfsStorage')),/*#__PURE__*/React.createElement("table",{className:"corp-datagrid"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",null,t('name')),/*#__PURE__*/React.createElement("th",null,"Size"),/*#__PURE__*/React.createElement("th",null,"Free"),/*#__PURE__*/React.createElement("th",null,"Health"))),/*#__PURE__*/React.createElement("tbody",null,(Array.isArray(data.zfs)?data.zfs:[]).map((pool,i)=>/*#__PURE__*/React.createElement("tr",{key:i},/*#__PURE__*/React.createElement("td",null,pool.name||'-'),/*#__PURE__*/React.createElement("td",null,formatBytes(pool.size)),/*#__PURE__*/React.createElement("td",null,formatBytes(pool.free)),/*#__PURE__*/React.createElement("td",null,pool.health||'-'))),(!data.zfs||data.zfs.length===0)&&/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:4,className:"text-center py-4",style:{color:'#728b9a'}},"No ZFS pools"))))),configSubTab==='repos'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium",style:{color:'#e9ecef'}},t('repositories')),/*#__PURE__*/React.createElement("button",{onClick:async()=>{const res=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${node}/repos/refresh`,{method:'POST'});addToast(res&&res.ok?'apt update started':'Error',res&&res.ok?'success':'error');},className:"px-2 py-1 text-[11px] flex items-center gap-1",style:{color:'#49afd9',border:'1px solid #485764'}},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-3 h-3"})," apt update")),/*#__PURE__*/React.createElement("table",{className:"corp-datagrid"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",null,t('name')),/*#__PURE__*/React.createElement("th",null,"URI"),/*#__PURE__*/React.createElement("th",null,t('enabled')),/*#__PURE__*/React.createElement("th",null,t('actions')))),/*#__PURE__*/React.createElement("tbody",null,(Array.isArray(data.repos)?data.repos:[]).map((repo,i)=>/*#__PURE__*/React.createElement("tr",{key:i},/*#__PURE__*/React.createElement("td",null,repo.Name||repo.Components?.join(', ')||'-'),/*#__PURE__*/React.createElement("td",{className:"text-[11px] font-mono",style:{color:'#728b9a'}},repo.URIs?.join(', ')||'-'),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("span",{className:`corp-badge ${repo.Enabled?'corp-badge-online':'corp-badge-stopped'}`},repo.Enabled?t('enabled'):t('disabled'))),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("button",{onClick:()=>handleRepoToggle(repo),className:"px-2 py-0.5 text-[11px]",style:repo.Enabled?{color:'#f54f47',border:'1px solid rgba(245,79,71,0.3)'}:{color:'#60b515',border:'1px solid rgba(96,181,21,0.3)'}},repo.Enabled?t('disable'):t('enable'))))),(!data.repos||data.repos.length===0)&&/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:4,className:"text-center py-4",style:{color:'#728b9a'}},"No repositories"))))),configSubTab==='ceph'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium mb-3 block",style:{color:'#e9ecef'}},"Ceph"),data.ceph&&!data.ceph.available?/*#__PURE__*/React.createElement("div",{className:"text-center py-8",style:{color:'#728b9a'}},/*#__PURE__*/React.createElement(Icons.Database,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),/*#__PURE__*/React.createElement("p",{className:"text-[13px]"},"Ceph not configured on this node")):/*#__PURE__*/React.createElement("div",{className:"space-y-3"},data.ceph?.status&&/*#__PURE__*/React.createElement("table",{className:"corp-property-grid"},/*#__PURE__*/React.createElement("tbody",null,/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"Health"),/*#__PURE__*/React.createElement("td",{style:{color:data.ceph.status.health?.status==='HEALTH_OK'?'#60b515':'#efc006'}},data.ceph.status.health?.status||'-')),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"OSDs"),/*#__PURE__*/React.createElement("td",null,data.ceph.osd?.length||0)),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"MONs"),/*#__PURE__*/React.createElement("td",null,data.ceph.mon?.length||0)),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"Pools"),/*#__PURE__*/React.createElement("td",null,data.ceph.pools?.length||0))))))))),activeDetailTab==='vms'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium mb-3 block",style:{color:'#e9ecef'}},t('vmsOnNode')," (",nodeVms.length,")"),/*#__PURE__*/React.createElement("table",{className:"corp-datagrid"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",null,t('name')),/*#__PURE__*/React.createElement("th",null,"VMID"),/*#__PURE__*/React.createElement("th",null,t('type')),/*#__PURE__*/React.createElement("th",null,t('status')),/*#__PURE__*/React.createElement("th",null,"CPU"),/*#__PURE__*/React.createElement("th",null,t('memory')||'Memory'))),/*#__PURE__*/React.createElement("tbody",null,nodeVms.sort((a,b)=>(a.name||'').localeCompare(b.name||'')).map(vm=>/*#__PURE__*/React.createElement("tr",{key:vm.vmid,className:"cursor-pointer",onClick:()=>onSelectVm&&onSelectVm(vm)},/*#__PURE__*/React.createElement("td",{className:"flex items-center gap-1.5"},vm.type==='lxc'?/*#__PURE__*/React.createElement(Icons.Box,{className:"w-3 h-3",style:{color:vm.status==='running'?'#49afd9':'#728b9a'}}):/*#__PURE__*/React.createElement(Icons.Monitor,{className:"w-3 h-3",style:{color:vm.status==='running'?'#60b515':'#728b9a'}}),/*#__PURE__*/React.createElement("span",{style:{color:'#49afd9'}},vm.name||'-')),/*#__PURE__*/React.createElement("td",null,vm.vmid),/*#__PURE__*/React.createElement("td",null,vm.type==='qemu'?'QEMU':'LXC'),/*#__PURE__*/React.createElement("td",null,/*#__PURE__*/React.createElement("span",{className:`corp-badge ${vm.status==='running'?'corp-badge-running':'corp-badge-stopped'}`},vm.status==='running'?t('running'):t('stopped'))),/*#__PURE__*/React.createElement("td",null,vm.maxcpu?`${((vm.cpu||0)*100).toFixed(1)}%`:'-'),/*#__PURE__*/React.createElement("td",null,vm.maxmem?`${formatBytes(vm.mem)} / ${formatBytes(vm.maxmem)}`:'-'))),nodeVms.length===0&&/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:6,className:"text-center py-4",style:{color:'#728b9a'}},"No VMs on this node"))))),activeDetailTab==='shell'&&/*#__PURE__*/React.createElement("div",{className:"bg-black border border-proxmox-border overflow-hidden",style:{height:'500px'}},/*#__PURE__*/React.createElement(NodeShellTerminal,{node:node,clusterId:clusterId,addToast:addToast})),activeDetailTab==='subscription'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium mb-3 block",style:{color:'#e9ecef'}},t('subscriptionInfo')),loading&&!data.subscription?/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center h-32"},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-5 h-5 animate-spin",style:{color:'#49afd9'}})):/*#__PURE__*/React.createElement("table",{className:"corp-property-grid"},/*#__PURE__*/React.createElement("tbody",null,/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,t('status')),/*#__PURE__*/React.createElement("td",{style:{color:data.subscription?.status==='Active'?'#60b515':data.subscription?.status==='notfound'?'#728b9a':'#efc006'}},data.subscription?.status||'No subscription')),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"Server ID"),/*#__PURE__*/React.createElement("td",{style:{fontFamily:'monospace',fontSize:'12px'}},data.subscription?.serverid||'-')),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"Product"),/*#__PURE__*/React.createElement("td",null,data.subscription?.productname||'-')),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"Key"),/*#__PURE__*/React.createElement("td",{style:{fontFamily:'monospace',fontSize:'12px'}},data.subscription?.key||'-')),/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",null,"Next Due"),/*#__PURE__*/React.createElement("td",null,data.subscription?.nextduedate||'-')))))));}// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PegaProx - Create Modals
// CreateVM, AddCluster, UserProfile
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Create VM/CT Modal Component
// LW: This handles both QEMU VMs and LXC containers
// The wizard steps are a bit complex but users seem to like it
// ChatGPT helped with the step indicator UI - looks pretty clean
// TODO: add template support for quick vm creation
function CreateVmModal({vmType,clusterId,nodes:initialNodes,onCreate,onClose}){const{t}=useTranslation();const{getAuthHeaders}=useAuth();const[activeStep,setActiveStep]=useState(0);const[loading,setLoading]=useState(false);const[storageList,setStorageList]=useState([]);const[bridgeList,setBridgeList]=useState([]);const[isoList,setIsoList]=useState([]);const[templateList,setTemplateList]=useState([]);const[nextVmid,setNextVmid]=useState('');const[nodes,setNodes]=useState(initialNodes||[]);// const [advancedMode, setAdvancedMode] = useState(false);  // someday
const isQemu=vmType==='qemu';// Local authFetch helper
const authFetch=async(url,options={})=>{try{const response=await fetch(url,{...options,credentials:'include',headers:{...options.headers,...getAuthHeaders()}});return response;}catch(err){console.error('Auth fetch error:',err);return null;}};// Fetch nodes if not provided
useEffect(()=>{const fetchNodes=async()=>{if(nodes.length===0){try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/nodes`);if(response&&response.ok){const data=await response.json();const nodeNames=data.map(n=>n.node||n.name).filter(Boolean);setNodes(nodeNames);if(nodeNames.length>0){setConfig(prev=>({...prev,node:nodeNames[0]}));}}}catch(e){console.error('fetching nodes:',e);}}};fetchNodes();},[clusterId]);const[config,setConfig]=useState({// General
node:nodes[0]||'',vmid:'',name:'',// OS (QEMU)
ostype:'l26',iso:'',virtio_iso:'',// VirtIO drivers ISO for Windows
// Template (LXC)
template:'',password:'',// Hardware
cores:2,sockets:1,memory:2048,memoryUnit:'GB',// LW: easier to work with GB by default
// MK: Advanced CPU (QEMU)
cpu_affinity:'',// CPU affinity string e.g. "0-3" or "0,2,4"
numa:false,// Enable NUMA
// MK: Advanced Memory (QEMU)
min_memory:'',// Minimum memory for ballooning (MB)
min_memoryUnit:'MB',// MK: Unit for minimum memory
ballooning:true,// Ballooning device enabled
shares:1000,// Memory shares (0-50000)
// Disk
storage:'local-lvm',disk_size:isQemu?'32':'8',disk_type:'scsi',// scsi, virtio, ide, sata
disk_format:'',// raw, qcow2, vmdk (empty = storage default)
disk_cache:'',// none, directsync, writethrough, writeback, unsafe
disk_discard:true,disk_iothread:true,disk_ssd:false,additional_disks:[],// MK: Array of additional disks {storage, size, type, format}
// Network
net_bridge:'vmbr0',net_model:'virtio',net_firewall:true,net_tag:'',net_ip:'dhcp',net_gw:'',// MK: Advanced Network
net_macaddr:'',// Custom MAC address
net_disconnect:false,// Disconnect network
net_mtu:'',// MTU (1-65520)
net_rate:'',// Rate limit in MB/s
// Advanced (QEMU)
cpu:'host',bios:'seabios',machine:'i440fx',scsihw:'virtio-scsi-pci',vga:'std',agent:true,efi_storage:'',// Storage for EFI disk
efi_pre_enroll:true,// Pre-enroll Microsoft keys
tpm_storage:'',// Storage for TPM state
tpm_version:'v2.0',// TPM version
ha_enabled:false,// MK: Enable Proxmox native HA
ha_group:'',// MK: HA group name
// Advanced (LXC)
unprivileged:true,nesting:false,swap:512,swapUnit:'MB',// NS: unit selector for swap
ssh_public_keys:'',// Network (extended for LXC)
net_ip_type:'dhcp',// dhcp, static, manual
net_ip6_type:'dhcp',// dhcp, static, slaac, manual
net_ip6:'',net_gw6:'',net_disconnected:false,// DNS
dns_domain:'',dns_servers:'',// Options
onboot:false,start:false});useEffect(()=>{// Set default node if available
if(nodes.length>0&&!config.node){setConfig(prev=>({...prev,node:nodes[0]}));}},[nodes]);useEffect(()=>{if(config.node){fetchStorageList();fetchBridgeList();if(isQemu)fetchIsoList();else fetchTemplateList();fetchNextVmid();}},[config.node]);const fetchStorageList=async()=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${config.node}/storage`);if(response&&response.ok){const data=await response.json();setStorageList(data);// Set default storage if current is not in list
if(data.length>0&&!data.find(s=>s.storage===config.storage)){const defaultStorage=data.find(s=>s.storage==='local-lvm')||data[0];setConfig(prev=>({...prev,storage:defaultStorage.storage}));}}}catch(e){console.error(e);}};const fetchBridgeList=async()=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${config.node}/networks`);if(response&&response.ok){const data=await response.json();setBridgeList(data);// Set default bridge (prefer vmbr0, then any local bridge, then SDN vnet, then first available)
if(data.length>0&&!data.find(b=>b.iface===config.net_bridge)){const defaultBridge=data.find(b=>b.iface==='vmbr0')||data.find(b=>b.type==='bridge'||b.type==='OVSBridge')||data.find(b=>b.source==='sdn')||data[0];if(defaultBridge)setConfig(prev=>({...prev,net_bridge:defaultBridge.iface}));}}}catch(e){console.error(e);}};const fetchIsoList=async()=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${config.node}/isos`);if(response&&response.ok){const data=await response.json();setIsoList(data);console.log('Loaded ISOs:',data);}}catch(e){console.error('loading ISOs:',e);}};const fetchTemplateList=async()=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${config.node}/templates`);if(response&&response.ok)setTemplateList(await response.json());}catch(e){console.error(e);}};const fetchNextVmid=async()=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/nodes/${config.node}/nextid`);if(response&&response.ok){const data=await response.json();setNextVmid(data.vmid);if(!config.vmid)setConfig(prev=>({...prev,vmid:data.vmid}));}}catch(e){console.error(e);}};const handleCreate=async()=>{setLoading(true);await onCreate(vmType,config.node,config);setLoading(false);};const steps=isQemu?[t('general'),t('os'),t('hardware'),t('disk'),t('network'),t('advanced')]:[t('general'),t('template'),t('resources'),t('disk'),t('network'),t('options')];const osTypes=[{value:'l26',label:'Linux 2.6+ Kernel'},{value:'l24',label:'Linux 2.4 Kernel'},{value:'win11',label:'Windows 11/2022'},{value:'win10',label:'Windows 10/2016/2019'},{value:'win8',label:'Windows 8/2012'},{value:'win7',label:'Windows 7/2008'},{value:'wxp',label:'Windows XP/2003'},{value:'other',label:'Other'}];const cpuTypes=['host','kvm64','kvm32','qemu64','qemu32','max','Broadwell','Broadwell-IBRS','Broadwell-noTSX','Broadwell-noTSX-IBRS','Cascadelake-Server','Cascadelake-Server-noTSX','Conroe','EPYC','EPYC-IBPB','EPYC-Milan','EPYC-Rome','Haswell','Haswell-IBRS','Haswell-noTSX','Haswell-noTSX-IBRS','Icelake-Client','Icelake-Client-noTSX','Icelake-Server','Icelake-Server-noTSX','IvyBridge','IvyBridge-IBRS','KnightsMill','Nehalem','Nehalem-IBRS','Opteron_G1','Opteron_G2','Opteron_G3','Opteron_G4','Opteron_G5','Penryn','SandyBridge','SandyBridge-IBRS','Skylake-Client','Skylake-Client-IBRS','Skylake-Client-noTSX-IBRS','Skylake-Server','Skylake-Server-IBRS','Skylake-Server-noTSX-IBRS','Westmere','Westmere-IBRS','athlon','core2duo','coreduo','n270','pentium','pentium2','pentium3','phenom','x86-64-v2','x86-64-v2-AES','x86-64-v3','x86-64-v4'];const vgaTypes=[{value:'std',label:'Standard VGA'},{value:'vmware',label:'VMware compatible'},{value:'qxl',label:'SPICE (QXL)'},{value:'qxl2',label:'SPICE (QXL) 2 heads'},{value:'qxl3',label:'SPICE (QXL) 3 heads'},{value:'qxl4',label:'SPICE (QXL) 4 heads'},{value:'virtio',label:'VirtIO-GPU'},{value:'virtio-gl',label:'VirtIO-GPU (virgl)'},{value:'cirrus',label:'Cirrus Logic'},{value:'none',label:'None (headless)'}];const scsiControllers=[{value:'virtio-scsi-pci',label:'VirtIO SCSI'},{value:'virtio-scsi-single',label:'VirtIO SCSI Single'},{value:'lsi',label:'LSI 53C895A'},{value:'lsi53c810',label:'LSI 53C810'},{value:'megasas',label:'MegaRAID SAS'},{value:'pvscsi',label:'VMware PVSCSI'}];const renderStepContent=()=>{// Filter storages by content type
const diskStorages=storageList.filter(s=>{const content=s.content||'';return content.includes('images')||content.includes('rootdir')||s.type==='lvmthin'||s.type==='lvm'||s.type==='zfspool'||s.type==='rbd'||s.type==='dir';});const isoStorages=storageList.filter(s=>(s.content||'').includes('iso'));const templateStorages=storageList.filter(s=>(s.content||'').includes('vztmpl'));if(isQemu){switch(activeStep){case 0:// General
return/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('node')),/*#__PURE__*/React.createElement("select",{value:config.node,onChange:e=>setConfig({...config,node:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},nodes.map(n=>/*#__PURE__*/React.createElement("option",{key:n,value:n},n)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"VM ID"),/*#__PURE__*/React.createElement("input",{type:"number",value:config.vmid,onChange:e=>setConfig({...config,vmid:e.target.value}),placeholder:nextVmid?`${t('next')}: ${nextVmid}`:'',className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('name')),/*#__PURE__*/React.createElement("input",{type:"text",value:config.name,onChange:e=>setConfig({...config,name:e.target.value}),placeholder:"my-virtual-machine",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})));case 1:// OS
return/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('guestOs')),/*#__PURE__*/React.createElement("select",{value:config.ostype,onChange:e=>setConfig({...config,ostype:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},osTypes.map(os=>/*#__PURE__*/React.createElement("option",{key:os.value,value:os.value},os.label)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('isoImage')),/*#__PURE__*/React.createElement("select",{value:config.iso,onChange:e=>setConfig({...config,iso:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:""},t('noIso')),isoList.length===0&&/*#__PURE__*/React.createElement("option",{disabled:true},t('noIsoAvailable')),isoList.map(iso=>/*#__PURE__*/React.createElement("option",{key:iso.volid,value:iso.volid},iso.volid.split('/').pop()))),isoStorages.length===0&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-yellow-500 mt-1"},"\u26A0\uFE0F ",t('noIsoStorage'))),config.ostype.startsWith('win')&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('virtioDrivers')),/*#__PURE__*/React.createElement("select",{value:config.virtio_iso,onChange:e=>setConfig({...config,virtio_iso:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:""},t('noVirtioDrivers')),isoList.filter(iso=>iso.volid.toLowerCase().includes('virtio')).map(iso=>/*#__PURE__*/React.createElement("option",{key:iso.volid,value:iso.volid},iso.volid.split('/').pop())),/*#__PURE__*/React.createElement("optgroup",{label:t('allIsos')},isoList.map(iso=>/*#__PURE__*/React.createElement("option",{key:iso.volid,value:iso.volid},iso.volid.split('/').pop())))),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('virtioDriversHint'))));case 2:// Hardware
return/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('sockets')),/*#__PURE__*/React.createElement("input",{type:"number",min:"1",max:"4",value:config.sockets,onChange:e=>setConfig({...config,sockets:parseInt(e.target.value)}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('cores')),/*#__PURE__*/React.createElement("input",{type:"number",min:"1",max:"128",value:config.cores,onChange:e=>setConfig({...config,cores:parseInt(e.target.value)}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('memory')),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"number",min:config.memoryUnit==='GB'?0.5:128,step:config.memoryUnit==='GB'?0.5:128,value:config.memoryUnit==='GB'?config.memory/1024:config.memory,onChange:e=>{const val=parseFloat(e.target.value)||0;setConfig({...config,memory:config.memoryUnit==='GB'?Math.round(val*1024):val});},className:"flex-1 px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}),/*#__PURE__*/React.createElement("select",{value:config.memoryUnit||'MB',onChange:e=>setConfig({...config,memoryUnit:e.target.value}),className:"w-20 px-2 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:"MB"},"MB"),/*#__PURE__*/React.createElement("option",{value:"GB"},"GB"))),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},config.memoryUnit==='GB'?`${config.memory} MB`:`${(config.memory/1024).toFixed(1)} GB`)),/*#__PURE__*/React.createElement("details",{className:"group"},/*#__PURE__*/React.createElement("summary",{className:"flex items-center justify-between cursor-pointer p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg hover:bg-blue-500/20"},/*#__PURE__*/React.createElement("span",{className:"text-sm font-medium text-blue-400"},t('advancedCpu')||'Advanced CPU'),/*#__PURE__*/React.createElement(Icons.ChevronDown,{className:"w-4 h-4 text-blue-400 group-open:rotate-180 transition-transform"})),/*#__PURE__*/React.createElement("div",{className:"mt-3 space-y-3 p-3 bg-proxmox-dark/50 rounded-lg"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('cpuAffinity')||'CPU Affinity'),/*#__PURE__*/React.createElement("input",{type:"text",value:config.cpu_affinity,onChange:e=>setConfig({...config,cpu_affinity:e.target.value}),placeholder:"e.g. 0-3 or 0,2,4,6",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('cpuAffinityHint')||'Pin vCPUs to specific host CPUs')),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:config.numa,onChange:e=>setConfig({...config,numa:e.target.checked}),className:"rounded"}),t('enableNuma')||'Enable NUMA'))),/*#__PURE__*/React.createElement("details",{className:"group"},/*#__PURE__*/React.createElement("summary",{className:"flex items-center justify-between cursor-pointer p-3 bg-purple-500/10 border border-purple-500/30 rounded-lg hover:bg-purple-500/20"},/*#__PURE__*/React.createElement("span",{className:"text-sm font-medium text-purple-400"},t('advancedMemory')||'Advanced Memory'),/*#__PURE__*/React.createElement(Icons.ChevronDown,{className:"w-4 h-4 text-purple-400 group-open:rotate-180 transition-transform"})),/*#__PURE__*/React.createElement("div",{className:"mt-3 space-y-3 p-3 bg-proxmox-dark/50 rounded-lg"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('minimumMemory')||'Minimum Memory'),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"number",min:"0",value:config.min_memoryUnit==='GB'?config.min_memory?config.min_memory/1024:'':config.min_memory||'',onChange:e=>{const val=parseFloat(e.target.value)||'';if(val===''){setConfig({...config,min_memory:''});}else{setConfig({...config,min_memory:config.min_memoryUnit==='GB'?Math.round(val*1024):val});}},placeholder:t('sameAsMemory')||'Same as Memory',className:"flex-1 px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}),/*#__PURE__*/React.createElement("select",{value:config.min_memoryUnit||'MB',onChange:e=>setConfig({...config,min_memoryUnit:e.target.value}),className:"w-20 px-2 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:"MB"},"MB"),/*#__PURE__*/React.createElement("option",{value:"GB"},"GB"))),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('minimumMemoryHint')||'Lower limit for memory ballooning')),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:config.ballooning,onChange:e=>setConfig({...config,ballooning:e.target.checked}),className:"rounded"}),t('ballooningDevice')||'Ballooning Device')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('memoryShares')||'Memory Shares'),/*#__PURE__*/React.createElement("input",{type:"number",min:"0",max:"50000",value:config.shares,onChange:e=>setConfig({...config,shares:parseInt(e.target.value)||0}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('memorySharesHint')||'Weight for memory auto-ballooning (0-50000, default: 1000)')))));case 3:// Disk
// MK: Helper to render storage bar
const renderStorageBar=selectedStorage=>{const storageInfo=diskStorages.find(s=>s.storage===selectedStorage);if(!storageInfo)return null;const total=storageInfo.total||storageInfo.maxdisk||storageInfo.avail||0;const avail=storageInfo.avail||0;if(total<=0)return null;const usedPercent=total>0?(total-avail)/total*100:0;const freeGB=(avail/1024/1024/1024).toFixed(1);return/*#__PURE__*/React.createElement("div",{className:"mt-2"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-xs text-gray-500 mb-1"},/*#__PURE__*/React.createElement("span",null,freeGB," GB ",t('free')),/*#__PURE__*/React.createElement("span",null,usedPercent.toFixed(0),"% ",t('used'))),/*#__PURE__*/React.createElement("div",{className:"h-1.5 bg-proxmox-dark rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:`h-full ${usedPercent>90?'bg-red-500':usedPercent>70?'bg-yellow-500':'bg-green-500'}`,style:{width:`${usedPercent}%`}})));};return/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark/50 rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-white mb-3"},t('primaryDisk')||'Disk'," 0 (",config.disk_type,"0)"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-4 gap-3 mb-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('busType')),/*#__PURE__*/React.createElement("select",{value:config.disk_type,onChange:e=>setConfig({...config,disk_type:e.target.value}),className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:"scsi"},"SCSI"),/*#__PURE__*/React.createElement("option",{value:"virtio"},"VirtIO Block"),/*#__PURE__*/React.createElement("option",{value:"ide"},"IDE"),/*#__PURE__*/React.createElement("option",{value:"sata"},"SATA"))),/*#__PURE__*/React.createElement("div",{className:"col-span-2"},/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('storage')),/*#__PURE__*/React.createElement("select",{value:config.storage,onChange:e=>setConfig({...config,storage:e.target.value}),className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"},diskStorages.map(s=>/*#__PURE__*/React.createElement("option",{key:s.storage,value:s.storage},s.storage," (",s.type,")"))),renderStorageBar(config.storage)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('size')," (GB)"),/*#__PURE__*/React.createElement("input",{type:"number",min:"1",value:config.disk_size,onChange:e=>setConfig({...config,disk_size:e.target.value}),className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-4 gap-3 mb-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('format')),/*#__PURE__*/React.createElement("select",{value:config.disk_format,onChange:e=>setConfig({...config,disk_format:e.target.value}),className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},t('storageDefault')||'Default'),/*#__PURE__*/React.createElement("option",{value:"raw"},"Raw"),/*#__PURE__*/React.createElement("option",{value:"qcow2"},"QCOW2"),/*#__PURE__*/React.createElement("option",{value:"vmdk"},"VMDK"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('cache')),/*#__PURE__*/React.createElement("select",{value:config.disk_cache,onChange:e=>setConfig({...config,disk_cache:e.target.value}),className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},t('default')||'Default'),/*#__PURE__*/React.createElement("option",{value:"directsync"},"Direct Sync"),/*#__PURE__*/React.createElement("option",{value:"writethrough"},"Write Through"),/*#__PURE__*/React.createElement("option",{value:"writeback"},"Write Back"),/*#__PURE__*/React.createElement("option",{value:"none"},t('none')||'None'))),config.disk_type==='scsi'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('scsiController')),/*#__PURE__*/React.createElement("select",{value:config.scsihw,onChange:e=>setConfig({...config,scsihw:e.target.value}),className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"},scsiControllers.map(sc=>/*#__PURE__*/React.createElement("option",{key:sc.value,value:sc.value},sc.label))))),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-xs text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:config.disk_discard,onChange:e=>setConfig({...config,disk_discard:e.target.checked}),className:"rounded"}),t('discard')," (TRIM)"),config.disk_type==='scsi'&&/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-xs text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:config.disk_iothread,onChange:e=>setConfig({...config,disk_iothread:e.target.checked}),className:"rounded"}),t('ioThread')),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-xs text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:config.disk_ssd,onChange:e=>setConfig({...config,disk_ssd:e.target.checked}),className:"rounded"}),t('ssdEmulation')))),config.additional_disks.map((disk,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"p-4 bg-proxmox-dark/50 rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-white"},t('disk')||'Disk'," ",idx+1," (",disk.type,idx+1,")"),/*#__PURE__*/React.createElement("button",{onClick:()=>setConfig({...config,additional_disks:config.additional_disks.filter((_,i)=>i!==idx)}),className:"p-1 text-red-400 hover:bg-red-500/20 rounded"},/*#__PURE__*/React.createElement(Icons.Trash2,{className:"w-4 h-4"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-4 gap-3 mb-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('busType')),/*#__PURE__*/React.createElement("select",{value:disk.type,onChange:e=>{const newDisks=[...config.additional_disks];newDisks[idx]={...disk,type:e.target.value};setConfig({...config,additional_disks:newDisks});},className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:"scsi"},"SCSI"),/*#__PURE__*/React.createElement("option",{value:"virtio"},"VirtIO Block"),/*#__PURE__*/React.createElement("option",{value:"sata"},"SATA"))),/*#__PURE__*/React.createElement("div",{className:"col-span-2"},/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('storage')),/*#__PURE__*/React.createElement("select",{value:disk.storage,onChange:e=>{const newDisks=[...config.additional_disks];newDisks[idx]={...disk,storage:e.target.value};setConfig({...config,additional_disks:newDisks});},className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"},diskStorages.map(s=>/*#__PURE__*/React.createElement("option",{key:s.storage,value:s.storage},s.storage," (",s.type,")"))),renderStorageBar(disk.storage)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('size')," (GB)"),/*#__PURE__*/React.createElement("input",{type:"number",min:"1",value:disk.size,onChange:e=>{const newDisks=[...config.additional_disks];newDisks[idx]={...disk,size:e.target.value};setConfig({...config,additional_disks:newDisks});},className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-4 gap-3 mb-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('format')),/*#__PURE__*/React.createElement("select",{value:disk.format||'',onChange:e=>{const newDisks=[...config.additional_disks];newDisks[idx]={...disk,format:e.target.value};setConfig({...config,additional_disks:newDisks});},className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},t('storageDefault')||'Default'),/*#__PURE__*/React.createElement("option",{value:"raw"},"Raw"),/*#__PURE__*/React.createElement("option",{value:"qcow2"},"QCOW2"),/*#__PURE__*/React.createElement("option",{value:"vmdk"},"VMDK"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('cache')),/*#__PURE__*/React.createElement("select",{value:disk.cache||'',onChange:e=>{const newDisks=[...config.additional_disks];newDisks[idx]={...disk,cache:e.target.value};setConfig({...config,additional_disks:newDisks});},className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},t('default')||'Default'),/*#__PURE__*/React.createElement("option",{value:"directsync"},"Direct Sync"),/*#__PURE__*/React.createElement("option",{value:"writethrough"},"Write Through"),/*#__PURE__*/React.createElement("option",{value:"writeback"},"Write Back"),/*#__PURE__*/React.createElement("option",{value:"none"},t('none')||'None'))),disk.type==='scsi'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('scsiController')),/*#__PURE__*/React.createElement("select",{value:disk.scsihw||config.scsihw,onChange:e=>{const newDisks=[...config.additional_disks];newDisks[idx]={...disk,scsihw:e.target.value};setConfig({...config,additional_disks:newDisks});},className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:"virtio-scsi-pci"},"VirtIO SCSI"),/*#__PURE__*/React.createElement("option",{value:"virtio-scsi-single"},"VirtIO Single"),/*#__PURE__*/React.createElement("option",{value:"lsi"},"LSI 53C895A"),/*#__PURE__*/React.createElement("option",{value:"megasas"},"MegaRAID SAS")))),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-xs text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:disk.discard!==false,onChange:e=>{const newDisks=[...config.additional_disks];newDisks[idx]={...disk,discard:e.target.checked};setConfig({...config,additional_disks:newDisks});},className:"rounded"}),t('discard')," (TRIM)"),disk.type==='scsi'&&/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-xs text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:disk.iothread!==false,onChange:e=>{const newDisks=[...config.additional_disks];newDisks[idx]={...disk,iothread:e.target.checked};setConfig({...config,additional_disks:newDisks});},className:"rounded"}),t('ioThread')),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-xs text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:disk.ssd||false,onChange:e=>{const newDisks=[...config.additional_disks];newDisks[idx]={...disk,ssd:e.target.checked};setConfig({...config,additional_disks:newDisks});},className:"rounded"}),t('ssdEmulation'))))),/*#__PURE__*/React.createElement("button",{onClick:()=>setConfig({...config,additional_disks:[...config.additional_disks,{type:'scsi',storage:config.storage,size:'32',format:'',cache:'',discard:true,iothread:true,ssd:false}]}),className:"w-full px-4 py-2 border-2 border-dashed border-proxmox-border rounded-lg text-gray-400 hover:text-white hover:border-proxmox-orange transition-colors"},"+ ",t('addDisk')||'Add Disk'));case 4:// Network
return/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('bridge')," / VNet"),/*#__PURE__*/React.createElement("select",{value:config.net_bridge,onChange:e=>setConfig({...config,net_bridge:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},bridgeList.filter(b=>b.source!=='sdn').length>0&&/*#__PURE__*/React.createElement("optgroup",{label:"Local Bridges"},bridgeList.filter(b=>b.source!=='sdn').map(b=>/*#__PURE__*/React.createElement("option",{key:b.iface,value:b.iface},b.iface,b.comments?` - ${b.comments}`:''))),bridgeList.filter(b=>b.source==='sdn').length>0&&/*#__PURE__*/React.createElement("optgroup",{label:"SDN VNets"},bridgeList.filter(b=>b.source==='sdn').map(b=>/*#__PURE__*/React.createElement("option",{key:b.iface,value:b.iface},b.iface," - ",b.zone||'SDN',b.alias?` (${b.alias})`:''))),bridgeList.length===0&&/*#__PURE__*/React.createElement("option",{value:"vmbr0"},"vmbr0"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('model')),/*#__PURE__*/React.createElement("select",{value:config.net_model,onChange:e=>setConfig({...config,net_model:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:"virtio"},"VirtIO (paravirtualized)"),/*#__PURE__*/React.createElement("option",{value:"e1000"},"Intel E1000"),/*#__PURE__*/React.createElement("option",{value:"rtl8139"},"Realtek RTL8139"),/*#__PURE__*/React.createElement("option",{value:"vmxnet3"},"VMware vmxnet3")))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('vlanTag')),/*#__PURE__*/React.createElement("input",{type:"text",value:config.net_tag,onChange:e=>setConfig({...config,net_tag:e.target.value}),placeholder:t('vlanExample'),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('macAddress')||'MAC Address'),/*#__PURE__*/React.createElement("input",{type:"text",value:config.net_macaddr,onChange:e=>setConfig({...config,net_macaddr:e.target.value}),placeholder:t('autoGenerate')||'Auto-generate (leave empty)',className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}))),/*#__PURE__*/React.createElement("details",{className:"group"},/*#__PURE__*/React.createElement("summary",{className:"flex items-center justify-between cursor-pointer p-3 bg-green-500/10 border border-green-500/30 rounded-lg hover:bg-green-500/20"},/*#__PURE__*/React.createElement("span",{className:"text-sm font-medium text-green-400"},t('advancedNetwork')||'Advanced Network'),/*#__PURE__*/React.createElement(Icons.ChevronDown,{className:"w-4 h-4 text-green-400 group-open:rotate-180 transition-transform"})),/*#__PURE__*/React.createElement("div",{className:"mt-3 space-y-3 p-3 bg-proxmox-dark/50 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"MTU"),/*#__PURE__*/React.createElement("input",{type:"number",min:"1",max:"65520",value:config.net_mtu,onChange:e=>setConfig({...config,net_mtu:e.target.value}),placeholder:t('inheritBridge')||'Inherit from bridge',className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('rateLimit')||'Rate Limit'," (MB/s)"),/*#__PURE__*/React.createElement("input",{type:"number",min:"0",step:"0.1",value:config.net_rate,onChange:e=>setConfig({...config,net_rate:e.target.value}),placeholder:t('unlimited')||'Unlimited',className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}))),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:config.net_disconnect,onChange:e=>setConfig({...config,net_disconnect:e.target.checked}),className:"rounded"}),t('disconnected')||'Disconnected'," (",t('noLinkOnStart')||'No network link on start',")"))),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:config.net_firewall,onChange:e=>setConfig({...config,net_firewall:e.target.checked}),className:"rounded"}),t('enableFirewall')));case 5:// Advanced
return/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('cpuType')),/*#__PURE__*/React.createElement("select",{value:config.cpu,onChange:e=>setConfig({...config,cpu:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},cpuTypes.map(cpu=>/*#__PURE__*/React.createElement("option",{key:cpu,value:cpu},cpu)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"BIOS"),/*#__PURE__*/React.createElement("select",{value:config.bios,onChange:e=>{const newBios=e.target.value;setConfig({...config,bios:newBios,machine:newBios==='ovmf'?'q35':config.machine,efi_storage:newBios==='ovmf'?config.storage:''});},className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:"seabios"},"SeaBIOS (Legacy BIOS)"),/*#__PURE__*/React.createElement("option",{value:"ovmf"},"OVMF (UEFI)")))),config.bios==='ovmf'&&/*#__PURE__*/React.createElement("div",{className:"p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg space-y-3"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-blue-400"},t('efiSettings')),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('efiDiskStorage')),/*#__PURE__*/React.createElement("select",{value:config.efi_storage||config.storage,onChange:e=>setConfig({...config,efi_storage:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},diskStorages.map(s=>/*#__PURE__*/React.createElement("option",{key:s.storage,value:s.storage},s.storage)))),/*#__PURE__*/React.createElement("div",{className:"flex items-end"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:config.efi_pre_enroll,onChange:e=>setConfig({...config,efi_pre_enroll:e.target.checked}),className:"rounded"}),t('preEnrollKeys'))))),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-purple-500/10 border border-purple-500/30 rounded-lg space-y-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-purple-400"},t('tpmSettings')),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:!!config.tpm_storage,onChange:e=>setConfig({...config,tpm_storage:e.target.checked?config.storage:''}),className:"rounded"}),t('enableTpm'))),config.tpm_storage&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('tpmStorage')),/*#__PURE__*/React.createElement("select",{value:config.tpm_storage,onChange:e=>setConfig({...config,tpm_storage:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},diskStorages.map(s=>/*#__PURE__*/React.createElement("option",{key:s.storage,value:s.storage},s.storage)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('tpmVersion')),/*#__PURE__*/React.createElement("select",{value:config.tpm_version,onChange:e=>setConfig({...config,tpm_version:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:"v2.0"},"TPM 2.0 (",t('recommended'),")"),/*#__PURE__*/React.createElement("option",{value:"v1.2"},"TPM 1.2")))),config.ostype.startsWith('win11')&&!config.tpm_storage&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-yellow-400"},"\u26A0\uFE0F ",t('win11NeedsTpm'))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('machineType')),/*#__PURE__*/React.createElement("select",{value:config.machine,onChange:e=>setConfig({...config,machine:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("optgroup",{label:"i440fx (Standard)"},/*#__PURE__*/React.createElement("option",{value:"i440fx"},"i440fx (Latest)"),/*#__PURE__*/React.createElement("option",{value:"pc-i440fx-10.1"},"i440fx 10.1"),/*#__PURE__*/React.createElement("option",{value:"pc-i440fx-9.2+pve1"},"i440fx 9.2+pve1"),/*#__PURE__*/React.createElement("option",{value:"pc-i440fx-8.2"},"i440fx 8.2"),/*#__PURE__*/React.createElement("option",{value:"pc-i440fx-7.2"},"i440fx 7.2")),/*#__PURE__*/React.createElement("optgroup",{label:"q35 (Modern, PCIe)"},/*#__PURE__*/React.createElement("option",{value:"q35"},"q35 (Latest)"),/*#__PURE__*/React.createElement("option",{value:"pc-q35-10.1"},"q35 10.1"),/*#__PURE__*/React.createElement("option",{value:"pc-q35-9.2+pve1"},"q35 9.2+pve1"),/*#__PURE__*/React.createElement("option",{value:"pc-q35-8.2"},"q35 8.2"),/*#__PURE__*/React.createElement("option",{value:"pc-q35-7.2"},"q35 7.2")))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"VGA"),/*#__PURE__*/React.createElement("select",{value:config.vga,onChange:e=>setConfig({...config,vga:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},vgaTypes.map(v=>/*#__PURE__*/React.createElement("option",{key:v.value,value:v.value},v.label))))),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-red-500/10 border border-red-500/30 rounded-lg space-y-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-red-400"},t('highAvailability')||'High Availability'),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:config.ha_enabled,onChange:e=>setConfig({...config,ha_enabled:e.target.checked}),className:"rounded"}),t('enableHa')||'Add to Proxmox Native HA')),config.ha_enabled&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('haGroup')||'HA Group'),/*#__PURE__*/React.createElement("input",{type:"text",value:config.ha_group,onChange:e=>setConfig({...config,ha_group:e.target.value}),placeholder:t('defaultGroup')||'Default group (leave empty)',className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}))),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:config.agent,onChange:e=>setConfig({...config,agent:e.target.checked}),className:"rounded"}),t('enableQemuAgent')),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:config.onboot,onChange:e=>setConfig({...config,onboot:e.target.checked}),className:"rounded"}),t('startOnBoot')),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:config.start,onChange:e=>setConfig({...config,start:e.target.checked}),className:"rounded"}),t('startAfterCreate'))));}}else{// LXC Container
switch(activeStep){case 0:// Allgemein
return/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Node"),/*#__PURE__*/React.createElement("select",{value:config.node,onChange:e=>setConfig({...config,node:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},nodes.map(n=>/*#__PURE__*/React.createElement("option",{key:n,value:n},n)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"CT ID"),/*#__PURE__*/React.createElement("input",{type:"number",value:config.vmid,onChange:e=>setConfig({...config,vmid:e.target.value}),placeholder:nextVmid?`NÃ¤chste: ${nextVmid}`:'',className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Hostname"),/*#__PURE__*/React.createElement("input",{type:"text",value:config.name,onChange:e=>setConfig({...config,name:e.target.value}),placeholder:"my-container",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})));case 1:// Template
return/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Template"),/*#__PURE__*/React.createElement("select",{value:config.template,onChange:e=>setConfig({...config,template:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:""},t('selectTemplate')),templateList.filter(tpl=>tpl.type==='lxc').map(tpl=>/*#__PURE__*/React.createElement("option",{key:tpl.volid,value:tpl.volid},tpl.name)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('rootPassword')),/*#__PURE__*/React.createElement("input",{type:"password",value:config.password,onChange:e=>setConfig({...config,password:e.target.value}),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-1"},/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400"},t('sshPublicKeys')),/*#__PURE__*/React.createElement("label",{className:"text-xs text-proxmox-orange cursor-pointer hover:text-orange-400"},/*#__PURE__*/React.createElement("input",{type:"file",accept:".pub,.txt",className:"hidden",onChange:e=>{const file=e.target.files[0];if(file){const reader=new FileReader();reader.onload=event=>{const content=event.target.result;setConfig(prev=>({...prev,ssh_public_keys:prev.ssh_public_keys?prev.ssh_public_keys+'\n'+content.trim():content.trim()}));};reader.readAsText(file);}e.target.value='';}}),"\uD83D\uDCC2 ",t('loadSshKeyFile')||'Load SSH Key File')),/*#__PURE__*/React.createElement("textarea",{value:config.ssh_public_keys,onChange:e=>setConfig({...config,ssh_public_keys:e.target.value}),placeholder:"ssh-rsa AAAAB3... user@host",rows:3,className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm font-mono resize-none"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('sshKeyHintMultiple')||'One key per line. Paste or load from file.')));case 2:// Ressourcen
return/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('cpuCoresLabel')),/*#__PURE__*/React.createElement("input",{type:"number",min:"1",max:"128",value:config.cores,onChange:e=>setConfig({...config,cores:parseInt(e.target.value)}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"RAM"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"number",min:config.memoryUnit==='GB'?0.1:16,step:config.memoryUnit==='GB'?0.25:64,value:config.memoryUnit==='GB'?config.memory/1024:config.memory,onChange:e=>{const val=parseFloat(e.target.value)||0;setConfig({...config,memory:config.memoryUnit==='GB'?Math.round(val*1024):val});},className:"flex-1 px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}),/*#__PURE__*/React.createElement("select",{value:config.memoryUnit||'MB',onChange:e=>setConfig({...config,memoryUnit:e.target.value}),className:"w-20 px-2 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:"MB"},"MB"),/*#__PURE__*/React.createElement("option",{value:"GB"},"GB"))),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},config.memoryUnit==='GB'?`${config.memory} MB`:`${(config.memory/1024).toFixed(1)} GB`)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('swapMemory')),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"number",min:config.swapUnit==='GB'?0:0,step:config.swapUnit==='GB'?0.25:64,value:config.swapUnit==='GB'?config.swap/1024:config.swap,onChange:e=>{const val=parseFloat(e.target.value)||0;setConfig({...config,swap:config.swapUnit==='GB'?Math.round(val*1024):val});},className:"flex-1 px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}),/*#__PURE__*/React.createElement("select",{value:config.swapUnit||'MB',onChange:e=>setConfig({...config,swapUnit:e.target.value}),className:"w-20 px-2 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:"MB"},"MB"),/*#__PURE__*/React.createElement("option",{value:"GB"},"GB")))));case 3:// Disk
// MK: Helper to render storage bar for LXC
const renderLxcStorageBar=selectedStorage=>{const storageInfo=storageList.find(s=>s.storage===selectedStorage);if(!storageInfo)return null;const total=storageInfo.total||storageInfo.maxdisk||0;const used=storageInfo.used||storageInfo.disk||0;const avail=total-used;if(total<=0)return null;const usedPercent=total>0?used/total*100:0;const freeGB=(avail/1024/1024/1024).toFixed(1);return/*#__PURE__*/React.createElement("div",{className:"mt-2"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-xs text-gray-500 mb-1"},/*#__PURE__*/React.createElement("span",null,freeGB," GB ",t('free')),/*#__PURE__*/React.createElement("span",null,usedPercent.toFixed(0),"% ",t('used'))),/*#__PURE__*/React.createElement("div",{className:"h-1.5 bg-proxmox-dark rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:`h-full ${usedPercent>90?'bg-red-500':usedPercent>70?'bg-yellow-500':'bg-green-500'}`,style:{width:`${usedPercent}%`}})));};return/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark/50 rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-white mb-3"},t('rootFilesystem')||'Root Filesystem'," (rootfs)"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-4"},/*#__PURE__*/React.createElement("div",{className:"col-span-2"},/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Storage"),/*#__PURE__*/React.createElement("select",{value:config.storage,onChange:e=>setConfig({...config,storage:e.target.value}),className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"},storageList.map(s=>/*#__PURE__*/React.createElement("option",{key:s.storage,value:s.storage},s.storage," (",s.type||'storage',")"))),renderLxcStorageBar(config.storage)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('size')," (GB)"),/*#__PURE__*/React.createElement("input",{type:"number",min:"1",value:config.disk_size,onChange:e=>setConfig({...config,disk_size:e.target.value}),className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"})))),config.additional_disks.map((mp,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"p-4 bg-proxmox-dark/50 rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-white"},t('mountPoint')||'Mount Point'," ",idx," (mp",idx,")"),/*#__PURE__*/React.createElement("button",{onClick:()=>setConfig({...config,additional_disks:config.additional_disks.filter((_,i)=>i!==idx)}),className:"p-1 text-red-400 hover:bg-red-500/20 rounded"},/*#__PURE__*/React.createElement(Icons.Trash2,{className:"w-4 h-4"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-4 gap-3"},/*#__PURE__*/React.createElement("div",{className:"col-span-2"},/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Storage"),/*#__PURE__*/React.createElement("select",{value:mp.storage,onChange:e=>{const newMps=[...config.additional_disks];newMps[idx]={...mp,storage:e.target.value};setConfig({...config,additional_disks:newMps});},className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"},storageList.map(s=>/*#__PURE__*/React.createElement("option",{key:s.storage,value:s.storage},s.storage," (",s.type||'storage',")"))),renderLxcStorageBar(mp.storage)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('size')," (GB)"),/*#__PURE__*/React.createElement("input",{type:"number",min:"1",value:mp.size,onChange:e=>{const newMps=[...config.additional_disks];newMps[idx]={...mp,size:e.target.value};setConfig({...config,additional_disks:newMps});},className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('path')||'Path'),/*#__PURE__*/React.createElement("input",{type:"text",value:mp.path||'',onChange:e=>{const newMps=[...config.additional_disks];newMps[idx]={...mp,path:e.target.value};setConfig({...config,additional_disks:newMps});},placeholder:"/mnt/data",className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"}))))),/*#__PURE__*/React.createElement("button",{onClick:()=>setConfig({...config,additional_disks:[...config.additional_disks,{storage:config.storage,size:'8',path:'/mnt/data'+config.additional_disks.length}]}),className:"w-full px-4 py-2 border-2 border-dashed border-proxmox-border rounded-lg text-gray-400 hover:text-white hover:border-proxmox-orange transition-colors"},"+ ",t('addMountPoint')||'Add Mount Point'));case 4:// Netzwerk
return/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Bridge / VNet"),/*#__PURE__*/React.createElement("select",{value:config.net_bridge,onChange:e=>setConfig({...config,net_bridge:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},bridgeList.filter(b=>b.source!=='sdn').length>0&&/*#__PURE__*/React.createElement("optgroup",{label:"Local Bridges"},bridgeList.filter(b=>b.source!=='sdn').map(b=>/*#__PURE__*/React.createElement("option",{key:b.iface,value:b.iface},b.iface,b.comments?` - ${b.comments}`:''))),bridgeList.filter(b=>b.source==='sdn').length>0&&/*#__PURE__*/React.createElement("optgroup",{label:"SDN VNets"},bridgeList.filter(b=>b.source==='sdn').map(b=>/*#__PURE__*/React.createElement("option",{key:b.iface,value:b.iface},b.iface," - ",b.zone||'SDN',b.alias?` (${b.alias})`:''))),bridgeList.length===0&&/*#__PURE__*/React.createElement("option",{value:"vmbr0"},"vmbr0"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"VLAN Tag"),/*#__PURE__*/React.createElement("input",{type:"text",value:config.net_tag,onChange:e=>setConfig({...config,net_tag:e.target.value}),placeholder:t('optional')||'optional',className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('macAddress')||'MAC Address'),/*#__PURE__*/React.createElement("input",{type:"text",value:config.net_macaddr,onChange:e=>setConfig({...config,net_macaddr:e.target.value}),placeholder:t('autoGenerate')||'Auto-generate',className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"MTU"),/*#__PURE__*/React.createElement("input",{type:"number",min:"1",max:"65520",value:config.net_mtu,onChange:e=>setConfig({...config,net_mtu:e.target.value}),placeholder:t('inheritBridge')||'Inherit',className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('rateLimit')||'Rate Limit'," (MB/s)"),/*#__PURE__*/React.createElement("input",{type:"number",min:"0",step:"0.1",value:config.net_rate,onChange:e=>setConfig({...config,net_rate:e.target.value}),placeholder:t('unlimited')||'Unlimited',className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}))),/*#__PURE__*/React.createElement("div",{className:"p-3 bg-proxmox-dark/50 rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("span",{className:"text-sm font-medium text-white"},"IPv4"),/*#__PURE__*/React.createElement("select",{value:config.net_ip_type,onChange:e=>setConfig({...config,net_ip_type:e.target.value,net_ip:e.target.value==='dhcp'?'dhcp':''}),className:"px-2 py-1 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:"dhcp"},"DHCP"),/*#__PURE__*/React.createElement("option",{value:"static"},"Static"),/*#__PURE__*/React.createElement("option",{value:"manual"},t('manual')||'Manual'))),config.net_ip_type==='static'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('ipAddress')||'IP Address'),/*#__PURE__*/React.createElement("input",{type:"text",value:config.net_ip,onChange:e=>setConfig({...config,net_ip:e.target.value}),placeholder:"192.168.1.100/24",className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Gateway"),/*#__PURE__*/React.createElement("input",{type:"text",value:config.net_gw,onChange:e=>setConfig({...config,net_gw:e.target.value}),placeholder:"192.168.1.1",className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"})))),/*#__PURE__*/React.createElement("div",{className:"p-3 bg-proxmox-dark/50 rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("span",{className:"text-sm font-medium text-white"},"IPv6"),/*#__PURE__*/React.createElement("select",{value:config.net_ip6_type,onChange:e=>setConfig({...config,net_ip6_type:e.target.value,net_ip6:e.target.value==='dhcp'?'dhcp':e.target.value==='slaac'?'auto':''}),className:"px-2 py-1 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:"dhcp"},"DHCP"),/*#__PURE__*/React.createElement("option",{value:"slaac"},"SLAAC"),/*#__PURE__*/React.createElement("option",{value:"static"},"Static"),/*#__PURE__*/React.createElement("option",{value:"manual"},t('manual')||'Manual'))),config.net_ip6_type==='static'&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('ipAddress')||'IP Address'),/*#__PURE__*/React.createElement("input",{type:"text",value:config.net_ip6,onChange:e=>setConfig({...config,net_ip6:e.target.value}),placeholder:"2001:db8::100/64",className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},"Gateway"),/*#__PURE__*/React.createElement("input",{type:"text",value:config.net_gw6,onChange:e=>setConfig({...config,net_gw6:e.target.value}),placeholder:"2001:db8::1",className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"})))),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:config.net_firewall,onChange:e=>setConfig({...config,net_firewall:e.target.checked}),className:"rounded"}),t('enableFirewall')),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:config.net_disconnected,onChange:e=>setConfig({...config,net_disconnected:e.target.checked}),className:"rounded"}),t('disconnected')||'Disconnected')));case 5:// Optionen
return/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"p-4 bg-red-500/10 border border-red-500/30 rounded-lg space-y-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-red-400"},t('highAvailability')||'High Availability'),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:config.ha_enabled,onChange:e=>setConfig({...config,ha_enabled:e.target.checked}),className:"rounded"}),t('enableHa')||'Add to Proxmox Native HA')),config.ha_enabled&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('haGroup')||'HA Group'),/*#__PURE__*/React.createElement("input",{type:"text",value:config.ha_group,onChange:e=>setConfig({...config,ha_group:e.target.value}),placeholder:t('defaultGroup')||'Default group (leave empty)',className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"}))),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:config.unprivileged,onChange:e=>setConfig({...config,unprivileged:e.target.checked}),className:"rounded"}),"Unprivileged Container (",t('recommended')||'recommended',")"),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:config.nesting,onChange:e=>setConfig({...config,nesting:e.target.checked}),className:"rounded"}),"Nesting (",t('dockerSupport')||'Docker support',")"),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:config.onboot,onChange:e=>setConfig({...config,onboot:e.target.checked}),className:"rounded"}),t('startOnBoot')),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-300"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:config.start,onChange:e=>setConfig({...config,start:e.target.checked}),className:"rounded"}),t('startAfterCreate'))),/*#__PURE__*/React.createElement("div",{className:"p-3 bg-proxmox-dark/50 rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-white mb-3"},"DNS"),/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('dnsDomain')||'DNS Domain'),/*#__PURE__*/React.createElement("input",{type:"text",value:config.dns_domain,onChange:e=>setConfig({...config,dns_domain:e.target.value}),placeholder:t('useHostSettings')||'Use host settings',className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('dnsServers')||'DNS Servers'),/*#__PURE__*/React.createElement("input",{type:"text",value:config.dns_servers,onChange:e=>setConfig({...config,dns_servers:e.target.value}),placeholder:t('useHostSettings')||'Use host settings (e.g. 8.8.8.8 1.1.1.1)',className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('dnsServersHint')||'Space-separated list of DNS servers')))));}}};return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-2xl bg-proxmox-card border border-proxmox-border rounded-xl shadow-2xl animate-scale-in overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between px-6 py-4 border-b border-proxmox-border bg-proxmox-dark"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:`p-2 rounded-lg ${isQemu?'bg-blue-500/10':'bg-purple-500/10'}`},isQemu?/*#__PURE__*/React.createElement(Icons.VM,null):/*#__PURE__*/React.createElement(Icons.Container,null)),/*#__PURE__*/React.createElement("h2",{className:"font-semibold text-white"},isQemu?t('createVm'):t('createContainer'))),/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"p-2 hover:bg-proxmox-hover rounded-lg text-gray-400 hover:text-white"},/*#__PURE__*/React.createElement(Icons.X,null))),nodes.length===0&&/*#__PURE__*/React.createElement("div",{className:"p-4 bg-yellow-500/10 border-b border-yellow-500/30"},/*#__PURE__*/React.createElement("p",{className:"text-yellow-400 text-sm"},"\u26A0\uFE0F ",t('noNodesAvailable')||'No nodes available. Please wait for cluster data to load.')),storageList.length===0&&config.node&&/*#__PURE__*/React.createElement("div",{className:"px-6 pt-2"},/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},t('loadingStorage')||'Lade Storage-Liste...'," (Node: ",config.node,")")),/*#__PURE__*/React.createElement("div",{className:"flex border-b border-proxmox-border bg-proxmox-dark/50"},steps.map((step,idx)=>/*#__PURE__*/React.createElement("button",{key:step,onClick:()=>setActiveStep(idx),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors ${activeStep===idx?'text-proxmox-orange border-b-2 border-proxmox-orange':'text-gray-400 hover:text-white'}`},step))),/*#__PURE__*/React.createElement("div",{className:"p-6 min-h-[300px]"},renderStepContent()),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between px-6 py-4 border-t border-proxmox-border bg-proxmox-dark"},/*#__PURE__*/React.createElement("button",{onClick:()=>setActiveStep(Math.max(0,activeStep-1)),disabled:activeStep===0,className:"px-4 py-2 text-gray-400 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed"},t('back')),/*#__PURE__*/React.createElement("div",{className:"flex gap-3"},/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"px-4 py-2 text-gray-300 hover:text-white"},t('cancel')),activeStep<steps.length-1?/*#__PURE__*/React.createElement("button",{onClick:()=>setActiveStep(activeStep+1),className:"px-4 py-2 bg-proxmox-orange rounded-lg text-white hover:bg-orange-600"},t('next')):/*#__PURE__*/React.createElement("button",{onClick:handleCreate,disabled:loading||!isQemu&&!config.template,className:"flex items-center gap-2 px-4 py-2 bg-green-600 rounded-lg text-white hover:bg-green-700 disabled:opacity-50"},loading&&/*#__PURE__*/React.createElement(Icons.RotateCw,null),isQemu?t('createVm'):t('createContainer'))))));}// Add Cluster Modal
// LW: Wizard for adding new Proxmox clusters
// Defaults are pretty sensible, most users just need host + credentials
function AddClusterModal({isOpen,onClose,onSubmit,onAddPBS,onAddVMware,loading,error,initialType='proxmox'}){const{t}=useTranslation();const[connectionType,setConnectionType]=useState(initialType);// Sync with initialType when modal opens with different type
useEffect(()=>{if(isOpen)setConnectionType(initialType);},[isOpen,initialType]);// Proxmox config
const[config,setConfig]=useState({name:'',host:'',user:'root@pam',pass:'',ssl_verification:false,migration_threshold:20,check_interval:300,auto_migrate:true,balance_containers:false,balance_local_disks:false,dry_run:false,ssh_key:''});const[showSshSettings,setShowSshSettings]=useState(false);// PBS config
const[pbsConfig,setPbsConfig]=useState({name:'',host:'',port:8007,user:'root@pam',password:'',api_token_id:'',api_token_secret:'',fingerprint:'',ssl_verify:false,linked_clusters:[],notes:''});// VMware config
const[vmwConfig,setVmwConfig]=useState({name:'',host:'',port:443,username:'root',password:'',ssl_verify:false,notes:''});if(!isOpen)return null;const handleSubmit=e=>{e.preventDefault();if(connectionType==='proxmox')onSubmit(config);else if(connectionType==='pbs')onAddPBS(pbsConfig);else if(connectionType==='vmware')onAddVMware(vmwConfig);};return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop bg-black/60",onClick:onClose},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-lg bg-proxmox-card border border-proxmox-border rounded-2xl shadow-2xl animate-scale-in overflow-hidden max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"p-6 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("h2",{className:"text-xl font-bold text-white"},t('addCluster')),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 mt-3"},[{id:'proxmox',label:'Proxmox VE',icon:Icons.Server,active:'bg-orange-500/20 text-orange-400 border-orange-500/40',inactive:'bg-proxmox-dark text-gray-500 border-transparent hover:text-gray-300 hover:border-proxmox-border'},{id:'pbs',label:'PBS',icon:Icons.Shield,active:'bg-blue-500/20 text-blue-400 border-blue-500/40',inactive:'bg-proxmox-dark text-gray-500 border-transparent hover:text-gray-300 hover:border-proxmox-border'},{id:'vmware',label:'ESXi / vCenter',icon:Icons.Cloud,active:'bg-emerald-500/20 text-emerald-400 border-emerald-500/40',inactive:'bg-proxmox-dark text-gray-500 border-transparent hover:text-gray-300 hover:border-proxmox-border'}].map(tab=>/*#__PURE__*/React.createElement("button",{key:tab.id,onClick:()=>setConnectionType(tab.id),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium border transition-all ${connectionType===tab.id?tab.active:tab.inactive}`},/*#__PURE__*/React.createElement(tab.icon,{className:"w-3.5 h-3.5"}),tab.label)))),error&&/*#__PURE__*/React.createElement("div",{className:"mx-6 mt-4 p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm"},error),/*#__PURE__*/React.createElement("form",{onSubmit:handleSubmit,className:"p-6 space-y-5"},connectionType==='proxmox'&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-2"},t('clusterName')),/*#__PURE__*/React.createElement("input",{type:"text",value:config.name,onChange:e=>setConfig({...config,name:e.target.value}),required:true,className:"w-full px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-proxmox-orange transition-colors",placeholder:"Production Cluster"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-2"},t('host')),/*#__PURE__*/React.createElement("input",{type:"text",value:config.host,onChange:e=>setConfig({...config,host:e.target.value}),required:true,className:"w-full px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-proxmox-orange transition-colors",placeholder:"proxmox.example.com"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-2"},t('username')),/*#__PURE__*/React.createElement("input",{type:"text",value:config.user,onChange:e=>setConfig({...config,user:e.target.value}),required:true,className:"w-full px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-proxmox-orange transition-colors",placeholder:"root@pam or user@pam!tokenid"}),/*#__PURE__*/React.createElement("p",{className:"mt-1 text-xs text-gray-500"},t('apiTokenHint')||'For API tokens use: user@realm!tokenid')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-2"},t('passwordOrToken')||t('password')),/*#__PURE__*/React.createElement("input",{type:"password",value:config.pass,onChange:e=>setConfig({...config,pass:e.target.value}),required:true,className:"w-full px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-proxmox-orange transition-colors",placeholder:config.user.includes('!')?'Token Secret':'Password'}))),config.user.includes('!')&&/*#__PURE__*/React.createElement("div",{className:"p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-3"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-5 h-5 text-yellow-400 shrink-0 mt-0.5"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("p",{className:"font-medium text-yellow-200"},t('apiTokenWarningTitle')||'API Token Authentication'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-yellow-300/80 mt-1"},t('apiTokenWarningDesc')||'Using API tokens is supported but not all features will work correctly.')))),/*#__PURE__*/React.createElement("div",{className:"pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("button",{type:"button",onClick:()=>setShowSshSettings(!showSshSettings),className:"flex items-center gap-2 text-sm text-gray-400 hover:text-white transition-colors"},/*#__PURE__*/React.createElement(Icons.ChevronRight,{className:`w-3 h-3 transform transition-transform ${showSshSettings?'rotate-90':''}`}),t('sshKeyOptional')||'SSH Key (Optional)'),showSshSettings&&/*#__PURE__*/React.createElement("div",{className:"mt-4 space-y-4 p-4 bg-proxmox-dark/50 rounded-lg"},/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-400"},t('sshKeyExplanation')||'SSH features use your login credentials automatically. Only add a key here if password authentication is disabled on your nodes.'),/*#__PURE__*/React.createElement("textarea",{value:config.ssh_key,onChange:e=>setConfig({...config,ssh_key:e.target.value}),className:"w-full px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-proxmox-orange transition-colors font-mono text-xs",placeholder:"-----BEGIN OPENSSH PRIVATE KEY-----",rows:4}))),/*#__PURE__*/React.createElement("div",{className:"space-y-4 pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement(Slider,{label:t('migrationThreshold'),description:t('migrationThresholdDesc'),value:config.migration_threshold,onChange:v=>setConfig({...config,migration_threshold:v}),min:5,max:100}),/*#__PURE__*/React.createElement(Slider,{label:t('checkInterval'),description:t('checkIntervalDesc'),value:config.check_interval,onChange:v=>setConfig({...config,check_interval:v}),min:60,max:3600,step:60,unit:"s"})),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-4 pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement(Toggle,{checked:config.ssl_verification,onChange:v=>setConfig({...config,ssl_verification:v}),label:t('sslVerification')}),/*#__PURE__*/React.createElement(Toggle,{checked:config.auto_migrate,onChange:v=>setConfig({...config,auto_migrate:v}),label:t('autoMigrate')}),/*#__PURE__*/React.createElement(Toggle,{checked:config.dry_run,onChange:v=>setConfig({...config,dry_run:v}),label:t('dryRunShort')})),/*#__PURE__*/React.createElement("div",{className:"pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-3"},/*#__PURE__*/React.createElement(Toggle,{checked:config.balance_containers,onChange:v=>setConfig({...config,balance_containers:v}),label:t('balanceContainers')})),/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-3 pt-3 mt-3 border-t border-gray-700/50"},/*#__PURE__*/React.createElement(Toggle,{checked:config.balance_local_disks,onChange:v=>setConfig({...config,balance_local_disks:v}),label:t('balanceLocalDisks')})),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mt-1"},t('balanceLocalDisksDesc')))),connectionType==='pbs'&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-2"},t('name')),/*#__PURE__*/React.createElement("input",{type:"text",value:pbsConfig.name,onChange:e=>setPbsConfig({...pbsConfig,name:e.target.value}),required:true,className:"w-full px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-blue-400 transition-colors",placeholder:"Backup Server 1"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-2"},t('host')),/*#__PURE__*/React.createElement("input",{type:"text",value:pbsConfig.host,onChange:e=>setPbsConfig({...pbsConfig,host:e.target.value}),required:true,className:"w-full px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-blue-400 transition-colors",placeholder:"pbs.example.com"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-2"},t('username')),/*#__PURE__*/React.createElement("input",{type:"text",value:pbsConfig.user,onChange:e=>setPbsConfig({...pbsConfig,user:e.target.value}),required:true,className:"w-full px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-blue-400 transition-colors",placeholder:"root@pam"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-2"},t('password')),/*#__PURE__*/React.createElement("input",{type:"password",value:pbsConfig.password,onChange:e=>setPbsConfig({...pbsConfig,password:e.target.value}),required:true,className:"w-full px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-blue-400 transition-colors",placeholder:"Password"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-2"},"Port"),/*#__PURE__*/React.createElement("input",{type:"number",value:pbsConfig.port,onChange:e=>setPbsConfig({...pbsConfig,port:parseInt(e.target.value)||8007}),className:"w-full px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-white focus:outline-none focus:border-blue-400 transition-colors"}))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-2"},"Fingerprint (",t('optional')||'Optional',")"),/*#__PURE__*/React.createElement("input",{type:"text",value:pbsConfig.fingerprint,onChange:e=>setPbsConfig({...pbsConfig,fingerprint:e.target.value}),className:"w-full px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-blue-400 transition-colors font-mono text-xs",placeholder:"XX:XX:XX:..."})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-2"},t('notes')||'Notes'," (",t('optional')||'Optional',")"),/*#__PURE__*/React.createElement("input",{type:"text",value:pbsConfig.notes,onChange:e=>setPbsConfig({...pbsConfig,notes:e.target.value}),className:"w-full px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-blue-400 transition-colors",placeholder:"Backup for production cluster"}))),connectionType==='vmware'&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-2"},t('name')),/*#__PURE__*/React.createElement("input",{type:"text",value:vmwConfig.name,onChange:e=>setVmwConfig({...vmwConfig,name:e.target.value}),required:true,className:"w-full px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-emerald-400 transition-colors",placeholder:"ESXi Host 1"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-2"},t('host')),/*#__PURE__*/React.createElement("input",{type:"text",value:vmwConfig.host,onChange:e=>setVmwConfig({...vmwConfig,host:e.target.value}),required:true,className:"w-full px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-emerald-400 transition-colors",placeholder:"esxi.example.com"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-2"},t('username')),/*#__PURE__*/React.createElement("input",{type:"text",value:vmwConfig.username,onChange:e=>setVmwConfig({...vmwConfig,username:e.target.value}),required:true,className:"w-full px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-emerald-400 transition-colors",placeholder:"root"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-2"},t('password')),/*#__PURE__*/React.createElement("input",{type:"password",value:vmwConfig.password,onChange:e=>setVmwConfig({...vmwConfig,password:e.target.value}),required:true,className:"w-full px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-emerald-400 transition-colors",placeholder:"Password"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-2"},"Port"),/*#__PURE__*/React.createElement("input",{type:"number",value:vmwConfig.port,onChange:e=>setVmwConfig({...vmwConfig,port:parseInt(e.target.value)||443}),className:"w-full px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-white focus:outline-none focus:border-emerald-400 transition-colors"}))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement(Toggle,{checked:vmwConfig.ssl_verify,onChange:v=>setVmwConfig({...vmwConfig,ssl_verify:v}),label:t('sslVerification')})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm font-medium text-gray-300 mb-2"},t('notes')||'Notes'," (",t('optional')||'Optional',")"),/*#__PURE__*/React.createElement("input",{type:"text",value:vmwConfig.notes,onChange:e=>setVmwConfig({...vmwConfig,notes:e.target.value}),className:"w-full px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-emerald-400 transition-colors",placeholder:"Production ESXi host"}))),/*#__PURE__*/React.createElement("div",{className:"flex gap-3 pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("button",{type:"button",onClick:onClose,className:"flex-1 px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-lg text-gray-300 font-medium hover:bg-proxmox-hover transition-colors"},t('cancel')),/*#__PURE__*/React.createElement("button",{type:"submit",disabled:loading,className:`flex-1 px-4 py-2.5 rounded-lg text-white font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed ${connectionType==='pbs'?'bg-blue-500 hover:bg-blue-600':connectionType==='vmware'?'bg-emerald-500 hover:bg-emerald-600':'bg-proxmox-orange hover:bg-orange-600'}`},loading?t('connecting'):connectionType==='pbs'?t('addPbsServer')||'Add Backup Server':connectionType==='vmware'?t('addVmwareServer')||'Add VMware':t('addCluster'))))));}// User Profile Modal with Password Change and 2FA Setup
function UserProfileModal({isOpen,onClose,addToast}){const{t}=useTranslation();const{getAuthHeaders,user,updatePreferences}=useAuth();const[activeTab,setActiveTab]=useState('appearance');const[loading,setLoading]=useState(false);const[selectedTheme,setSelectedTheme]=useState(user?.theme||'proxmoxDark');// Password change
const[currentPassword,setCurrentPassword]=useState('');const[newPassword,setNewPassword]=useState('');const[confirmPassword,setConfirmPassword]=useState('');// 2FA setup
const[twoFAStatus,setTwoFAStatus]=useState({enabled:false,available:false});const[setupData,setSetupData]=useState(null);const[totpCode,setTotpCode]=useState('');const[disablePassword,setDisablePassword]=useState('');// MK: Feb 2026 - API Token management
const[tokens,setTokens]=useState([]);const[tokensLoading,setTokensLoading]=useState(false);const[newTokenName,setNewTokenName]=useState('');const[newTokenRole,setNewTokenRole]=useState('');const[newTokenExpiry,setNewTokenExpiry]=useState('');const[createdToken,setCreatedToken]=useState(null);const[tokenCopied,setTokenCopied]=useState(false);// Password Policy state - NS Jan 2026
const[passwordPolicy,setPasswordPolicy]=useState({min_length:8,require_uppercase:true,require_lowercase:true,require_numbers:true,require_special:false});// Generate password policy hint text
const getPasswordPolicyHint=()=>{const hints=[];hints.push(`${t('minChars')||'Min.'} ${passwordPolicy.min_length} ${t('characters')||'characters'}`);if(passwordPolicy.require_uppercase)hints.push(t('uppercase')||'uppercase');if(passwordPolicy.require_lowercase)hints.push(t('lowercase')||'lowercase');if(passwordPolicy.require_numbers)hints.push(t('numbers')||'number');if(passwordPolicy.require_special)hints.push(t('specialChar')||'special char');return hints.join(', ');};// Fetch password policy
const fetchPasswordPolicy=async()=>{try{const r=await fetch(`${API_URL}/password-policy`,{credentials:'include'});if(r.ok){const data=await r.json();setPasswordPolicy(data);}}catch(e){console.error('Failed to fetch password policy:',e);}};useEffect(()=>{if(isOpen){fetch2FAStatus();fetchPasswordPolicy();fetchTokens();// MK: Load API tokens
}},[isOpen]);// LW: Feb 2026 - API Token management functions
const fetchTokens=async()=>{setTokensLoading(true);try{const response=await fetch(`${API_URL}/auth/tokens`,{credentials:'include',headers:getAuthHeaders()});if(response.ok){const data=await response.json();setTokens(data.tokens||[]);}}catch(e){console.error('fetchTokens error:',e);}finally{setTokensLoading(false);}};const createToken=async()=>{if(!newTokenName.trim())return;setLoading(true);try{const body={name:newTokenName.trim()};if(newTokenRole)body.role=newTokenRole;if(newTokenExpiry)body.expires_days=parseInt(newTokenExpiry);const response=await fetch(`${API_URL}/auth/tokens`,{method:'POST',credentials:'include',headers:{'Content-Type':'application/json',...getAuthHeaders()},body:JSON.stringify(body)});const data=await response.json();if(data.success){setCreatedToken(data.token);setNewTokenName('');setNewTokenRole('');setNewTokenExpiry('');fetchTokens();if(addToast)addToast('Token created - copy it now, it won\'t be shown again!','warning');}else{if(addToast)addToast(data.error||'Failed to create token','error');}}catch(e){if(addToast)addToast('Network error','error');}finally{setLoading(false);}};const revokeToken=async tokenId=>{try{const response=await fetch(`${API_URL}/auth/tokens/${tokenId}`,{method:'DELETE',credentials:'include',headers:getAuthHeaders()});if(response.ok){fetchTokens();if(addToast)addToast('Token revoked','success');}}catch(e){if(addToast)addToast('Failed to revoke token','error');}};const copyToken=token=>{navigator.clipboard.writeText(token).then(()=>{setTokenCopied(true);setTimeout(()=>setTokenCopied(false),3000);});};const fetch2FAStatus=async()=>{try{const response=await fetch(`${API_URL}/auth/2fa/status`,{credentials:'include',// MK: Fix - need cookies for session auth
headers:getAuthHeaders()});if(response&&response.ok){setTwoFAStatus(await response.json());}}catch(err){console.error('fetching 2FA status:',err);}};const handleChangePassword=async e=>{e.preventDefault();if(newPassword!==confirmPassword){addToast(t('passwordsDoNotMatch'),'error');return;}if(newPassword.length<4){addToast(t('passwordTooShort'),'error');return;}setLoading(true);try{const response=await fetch(`${API_URL}/auth/change-password`,{method:'POST',credentials:'include',// MK: Fix - need cookies for session auth
headers:{'Content-Type':'application/json',...getAuthHeaders()},body:JSON.stringify({current_password:currentPassword,new_password:newPassword})});if(response&&response.ok){addToast(t('passwordResetSuccess'),'success');setCurrentPassword('');setNewPassword('');setConfirmPassword('');}else{const data=await response.json();addToast(data.error||'Error','error');}}catch(err){addToast(t('connectionError'),'error');}setLoading(false);};const handleSetup2FA=async()=>{setLoading(true);try{const response=await fetch(`${API_URL}/auth/2fa/setup`,{method:'POST',credentials:'include',// MK: Fix - need cookies for session auth
headers:getAuthHeaders()});if(response&&response.ok){setSetupData(await response.json());}else{const data=await response.json();addToast(data.error||'Error','error');}}catch(err){addToast(t('connectionError'),'error');}setLoading(false);};const handleVerify2FA=async()=>{if(totpCode.length!==6)return;setLoading(true);try{const response=await fetch(`${API_URL}/auth/2fa/verify`,{method:'POST',credentials:'include',// MK: Fix - need cookies for session auth
headers:{'Content-Type':'application/json',...getAuthHeaders()},body:JSON.stringify({code:totpCode})});if(response&&response.ok){addToast(t('twoFactorEnabled'),'success');setSetupData(null);setTotpCode('');fetch2FAStatus();}else{const data=await response.json();addToast(data.error||t('invalid2FACode'),'error');}}catch(err){addToast(t('connectionError'),'error');}setLoading(false);};const handleDisable2FA=async()=>{if(!disablePassword){addToast(t('currentPassword')+' required','error');return;}setLoading(true);try{const response=await fetch(`${API_URL}/auth/2fa/disable`,{method:'POST',credentials:'include',// MK: Fix - need cookies for session auth
headers:{'Content-Type':'application/json',...getAuthHeaders()},body:JSON.stringify({password:disablePassword})});if(response&&response.ok){addToast(t('twoFactorDisabled'),'success');setDisablePassword('');fetch2FAStatus();}else{const data=await response.json();addToast(data.error||'Error','error');}}catch(err){addToast(t('connectionError'),'error');}setLoading(false);};if(!isOpen)return null;return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/80",onClick:onClose},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-2xl max-h-[90vh] bg-proxmox-card border border-proxmox-border rounded-2xl shadow-2xl overflow-hidden flex flex-col",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between p-6 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"w-10 h-10 rounded-full bg-proxmox-orange/20 flex items-center justify-center text-proxmox-orange font-semibold"},user?.username?.[0]?.toUpperCase()||'U'),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:"text-xl font-bold text-white"},t('myProfile')),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},user?.display_name||user?.username))),/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"p-2 rounded-lg hover:bg-proxmox-dark text-gray-400 hover:text-white"},/*#__PURE__*/React.createElement(Icons.X,null))),/*#__PURE__*/React.createElement("div",{className:"flex border-b border-proxmox-border"},/*#__PURE__*/React.createElement("button",{onClick:()=>setActiveTab('appearance'),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors flex items-center justify-center gap-2 ${activeTab==='appearance'?'text-proxmox-orange border-b-2 border-proxmox-orange':'text-gray-400 hover:text-white'}`},/*#__PURE__*/React.createElement(Icons.Palette,null),t('appearance')||'Appearance'),/*#__PURE__*/React.createElement("button",{onClick:()=>setActiveTab('security'),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors flex items-center justify-center gap-2 ${activeTab==='security'?'text-proxmox-orange border-b-2 border-proxmox-orange':'text-gray-400 hover:text-white'}`},/*#__PURE__*/React.createElement(Icons.Lock,null),t('security')),/*#__PURE__*/React.createElement("button",{onClick:()=>setActiveTab('tokens'),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors flex items-center justify-center gap-2 ${activeTab==='tokens'?'text-proxmox-orange border-b-2 border-proxmox-orange':'text-gray-400 hover:text-white'}`},/*#__PURE__*/React.createElement(Icons.Key,null),"API Tokens")),/*#__PURE__*/React.createElement("div",{className:"flex-1 overflow-auto p-6"},activeTab==='appearance'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-2 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Palette,null),t('chooseTheme')||'Choose Your Theme'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mb-4"},t('themePersonal')||'Select a theme that suits your style. This setting is personal and only affects your account.')),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3"},Object.entries(PEGAPROX_THEMES).map(([key,theme])=>{const isActive=(user?.theme||'proxmoxDark')===key;return/*#__PURE__*/React.createElement("button",{key:key,onClick:async()=>{setSelectedTheme(key);const result=await updatePreferences({theme:key});if(result.success){addToast(`${t('themeChanged')||'Theme changed to'} ${theme.name}`,'success');}else{addToast(t('themeChangeFailed')||'Failed to save theme','error');}},className:`p-3 rounded-xl border-2 transition-all hover:scale-105 ${isActive?'border-proxmox-orange ring-2 ring-proxmox-orange/30':'border-proxmox-border hover:border-gray-500'}`,title:theme.description||theme.name},/*#__PURE__*/React.createElement("div",{className:"h-16 rounded-lg mb-2 relative overflow-hidden",style:{background:theme.colors.darker,border:`1px solid ${theme.colors.border}`}},/*#__PURE__*/React.createElement("div",{className:"absolute left-0 top-0 bottom-0 w-4",style:{background:theme.colors.dark}}),/*#__PURE__*/React.createElement("div",{className:"absolute right-2 top-2 bottom-2 left-6 rounded",style:{background:theme.colors.card,border:`1px solid ${theme.colors.border}`}},/*#__PURE__*/React.createElement("div",{className:"w-3/4 h-1.5 rounded-full m-1.5",style:{background:theme.colors.primary}})),isActive&&/*#__PURE__*/React.createElement("div",{className:"absolute top-1 right-1 bg-proxmox-orange rounded-full p-0.5"},/*#__PURE__*/React.createElement(Icons.Check,{className:"w-3 h-3 text-white"}))),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center gap-1.5"},/*#__PURE__*/React.createElement("span",{className:"text-lg"},theme.icon),/*#__PURE__*/React.createElement("span",{className:"text-xs font-medium"},theme.name)));})),/*#__PURE__*/React.createElement("div",{className:"pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-white mb-1 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Grid,{className:"w-4 h-4"}),t('layoutStyle')||'Layout Style'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-400 mb-3"},t('layoutStyleDesc')||'Choose between modern dashboard or corporate enterprise style.'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{const result=await updatePreferences({ui_layout:'modern'});if(result.success)addToast(`${t('layoutStyle')}: ${t('layoutModern')||'Modern'}`,'success');},className:`p-3 rounded-xl border-2 transition-all hover:scale-105 text-left ${(user?.ui_layout||'modern')==='modern'?'border-proxmox-orange ring-2 ring-proxmox-orange/30':'border-proxmox-border hover:border-gray-500'}`},/*#__PURE__*/React.createElement("div",{className:"h-16 rounded-lg mb-2 relative overflow-hidden bg-proxmox-dark border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"absolute left-0 top-0 bottom-0 w-5 bg-gradient-to-b from-proxmox-orange/30 to-purple-500/20"}),/*#__PURE__*/React.createElement("div",{className:"absolute right-1.5 top-1.5 left-7 h-2 rounded-full bg-proxmox-orange/40"}),/*#__PURE__*/React.createElement("div",{className:"absolute right-1.5 top-5 left-7 bottom-1.5 rounded-lg bg-proxmox-card border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex gap-1 p-1"},/*#__PURE__*/React.createElement("div",{className:"w-2 h-1.5 rounded-full bg-proxmox-orange/50"}),/*#__PURE__*/React.createElement("div",{className:"w-2 h-1.5 rounded-full bg-gray-600"}),/*#__PURE__*/React.createElement("div",{className:"w-2 h-1.5 rounded-full bg-gray-600"}))),(user?.ui_layout||'modern')==='modern'&&/*#__PURE__*/React.createElement("div",{className:"absolute top-1 right-1 bg-proxmox-orange rounded-full p-0.5"},/*#__PURE__*/React.createElement(Icons.Check,{className:"w-3 h-3 text-white"}))),/*#__PURE__*/React.createElement("div",{className:"text-center"},/*#__PURE__*/React.createElement("span",{className:"text-xs font-medium"},t('layoutModern')||'Modern'),/*#__PURE__*/React.createElement("p",{className:"text-[10px] text-gray-500 mt-0.5"},t('layoutModernDesc')||'Cards, animations, gradients'))),/*#__PURE__*/React.createElement("button",{onClick:async()=>{const result=await updatePreferences({ui_layout:'corporate'});if(result.success)addToast(`${t('layoutStyle')}: ${t('layoutCorporate')||'Corporate'}`,'success');},className:`p-3 rounded-xl border-2 transition-all hover:scale-105 text-left ${user?.ui_layout==='corporate'?'border-proxmox-orange ring-2 ring-proxmox-orange/30':'border-proxmox-border hover:border-gray-500'}`},/*#__PURE__*/React.createElement("div",{className:"h-16 rounded mb-2 relative overflow-hidden bg-proxmox-dark border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"absolute left-0 top-0 bottom-0 w-5 bg-proxmox-card border-r border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"mt-2 ml-1 space-y-1"},/*#__PURE__*/React.createElement("div",{className:"w-3 h-0.5 bg-gray-500"}),/*#__PURE__*/React.createElement("div",{className:"w-2.5 h-0.5 bg-gray-600 ml-1"}),/*#__PURE__*/React.createElement("div",{className:"w-2.5 h-0.5 bg-gray-600 ml-1"}))),/*#__PURE__*/React.createElement("div",{className:"absolute right-1.5 top-1.5 left-7 h-2 bg-proxmox-card border-b border-proxmox-border flex items-end gap-1 px-1"},/*#__PURE__*/React.createElement("div",{className:"w-3 h-0.5 bg-proxmox-orange"}),/*#__PURE__*/React.createElement("div",{className:"w-3 h-0.5 bg-gray-600"}),/*#__PURE__*/React.createElement("div",{className:"w-3 h-0.5 bg-gray-600"})),/*#__PURE__*/React.createElement("div",{className:"absolute right-1.5 top-5 left-7 bottom-1.5 bg-proxmox-card border border-proxmox-border"}),user?.ui_layout==='corporate'&&/*#__PURE__*/React.createElement("div",{className:"absolute top-1 right-1 bg-proxmox-orange rounded-full p-0.5"},/*#__PURE__*/React.createElement(Icons.Check,{className:"w-3 h-3 text-white"}))),/*#__PURE__*/React.createElement("div",{className:"text-center"},/*#__PURE__*/React.createElement("span",{className:"text-xs font-medium"},t('layoutCorporate')||'Corporate'),/*#__PURE__*/React.createElement("p",{className:"text-[10px] text-gray-500 mt-0.5"},t('layoutCorporateDesc')||'Enterprise style, dense'))))),/*#__PURE__*/React.createElement("div",{className:"pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-2 rounded-lg bg-blue-500/10"},/*#__PURE__*/React.createElement(Icons.Layers,{className:"w-5 h-5 text-blue-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("p",{className:"text-sm font-medium text-white"},t('taskbarAutoExpand')||'TaskBar Auto-Expand'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-400"},t('taskbarAutoExpandDesc')||'Automatically expand TaskBar when new tasks start'))),/*#__PURE__*/React.createElement("button",{onClick:async()=>{// NS: Toggle current value - if true/undefined -> false, if false -> true
const currentValue=user?.taskbar_auto_expand!==false;const newValue=!currentValue;console.log('TaskBar auto-expand toggle:',currentValue,'->',newValue);const result=await updatePreferences({taskbar_auto_expand:newValue});if(result.success){addToast(newValue?t('taskbarAutoExpandEnabled')||'TaskBar auto-expand enabled':t('taskbarAutoExpandDisabled')||'TaskBar auto-expand disabled','success');}},className:`relative w-12 h-6 rounded-full transition-colors ${user?.taskbar_auto_expand!==false?'bg-proxmox-orange':'bg-gray-600'}`},/*#__PURE__*/React.createElement("span",{className:`absolute top-1 w-4 h-4 rounded-full bg-white transition-transform ${user?.taskbar_auto_expand!==false?'left-7':'left-1'}`})))),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 text-center"},t('themeNote')||'Theme changes are applied immediately and saved to your account.')),activeTab==='security'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"text-white font-medium mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})),t('resetPassword')),/*#__PURE__*/React.createElement("form",{onSubmit:handleChangePassword,className:"space-y-3"},/*#__PURE__*/React.createElement("input",{type:"password",value:currentPassword,onChange:e=>setCurrentPassword(e.target.value),placeholder:t('currentPassword'),className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm",required:true}),/*#__PURE__*/React.createElement("input",{type:"password",value:newPassword,onChange:e=>setNewPassword(e.target.value),placeholder:t('newPassword'),className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm",required:true}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 -mt-1 mb-1"},getPasswordPolicyHint()),/*#__PURE__*/React.createElement("input",{type:"password",value:confirmPassword,onChange:e=>setConfirmPassword(e.target.value),placeholder:t('confirmPassword'),className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm",required:true}),/*#__PURE__*/React.createElement("button",{type:"submit",disabled:loading,className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm font-medium disabled:opacity-50"},t('resetPassword')))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"text-white font-medium mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Shield,null),t('twoFactorAuth')),!twoFAStatus.available?/*#__PURE__*/React.createElement("p",{className:"text-gray-400 text-sm"},"2FA nicht verf\xFCgbar. Server ben\xF6tigt: pip install pyotp qrcode[pil]"):twoFAStatus.enabled?/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-green-400"},/*#__PURE__*/React.createElement(Icons.Check,null),/*#__PURE__*/React.createElement("span",null,t('twoFactorEnabled'))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"password",value:disablePassword,onChange:e=>setDisablePassword(e.target.value),placeholder:t('currentPassword'),className:"flex-1 px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"}),/*#__PURE__*/React.createElement("button",{onClick:handleDisable2FA,disabled:loading||!disablePassword,className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm font-medium disabled:opacity-50"},t('disable2FA')))):setupData?/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("p",{className:"text-gray-400 text-sm"},t('scan2FACode')),/*#__PURE__*/React.createElement("div",{className:"flex justify-center"},/*#__PURE__*/React.createElement("img",{src:setupData.qr_code,alt:"QR Code",className:"rounded-lg"})),/*#__PURE__*/React.createElement("div",{className:"text-center"},/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mb-1"},t('secretKey'),":"),/*#__PURE__*/React.createElement("code",{className:"text-xs text-proxmox-orange bg-proxmox-darker px-2 py-1 rounded"},setupData.secret)),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"text",value:totpCode,onChange:e=>setTotpCode(e.target.value.replace(/\D/g,'').slice(0,6)),placeholder:t('enter2FACode'),maxLength:6,className:"flex-1 px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-center text-lg tracking-widest"}),/*#__PURE__*/React.createElement("button",{onClick:handleVerify2FA,disabled:loading||totpCode.length!==6,className:"px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-sm font-medium disabled:opacity-50"},t('verify2FA'))),/*#__PURE__*/React.createElement("button",{onClick:()=>setSetupData(null),className:"text-sm text-gray-400 hover:text-white"},t('cancel'))):/*#__PURE__*/React.createElement("button",{onClick:handleSetup2FA,disabled:loading,className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm font-medium disabled:opacity-50"},t('setup2FA')))),activeTab==='tokens'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},createdToken&&/*#__PURE__*/React.createElement("div",{className:"p-4 bg-yellow-500/10 border border-yellow-500/40 rounded-xl"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-2 mb-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-5 h-5 text-yellow-400 shrink-0 mt-0.5"}),/*#__PURE__*/React.createElement("p",{className:"text-yellow-400 font-medium text-sm"},"Copy your token now - it won't be shown again!")),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 mt-2"},/*#__PURE__*/React.createElement("code",{className:"flex-1 bg-proxmox-dark px-3 py-2 rounded text-sm text-green-400 font-mono break-all select-all border border-proxmox-border"},createdToken),/*#__PURE__*/React.createElement("button",{onClick:()=>copyToken(createdToken),className:"px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded hover:bg-proxmox-hover text-sm shrink-0"},tokenCopied?/*#__PURE__*/React.createElement(Icons.CheckCircle,{className:"w-4 h-4 text-green-400"}):/*#__PURE__*/React.createElement(Icons.Copy,{className:"w-4 h-4 text-gray-400"}))),/*#__PURE__*/React.createElement("button",{onClick:()=>setCreatedToken(null),className:"text-xs text-gray-500 hover:text-gray-300 mt-2"},"Dismiss")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"text-white font-medium mb-3 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Plus,{className:"w-4 h-4 text-proxmox-orange"}),"Create API Token"),/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Token Name"),/*#__PURE__*/React.createElement("input",{type:"text",value:newTokenName,onChange:e=>setNewTokenName(e.target.value),placeholder:"e.g. ci-pipeline, monitoring, backup-script",maxLength:64,className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",{className:`grid ${user?.role==='admin'?'grid-cols-2':'grid-cols-1'} gap-3`},user?.role==='admin'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Role"),/*#__PURE__*/React.createElement("select",{value:newTokenRole,onChange:e=>setNewTokenRole(e.target.value),className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Same as my role"),/*#__PURE__*/React.createElement("option",{value:"viewer"},"Viewer"),/*#__PURE__*/React.createElement("option",{value:"user"},"User"),/*#__PURE__*/React.createElement("option",{value:"admin"},"Admin"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Expires (optional)"),/*#__PURE__*/React.createElement("select",{value:newTokenExpiry,onChange:e=>setNewTokenExpiry(e.target.value),className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Never"),/*#__PURE__*/React.createElement("option",{value:"7"},"7 days"),/*#__PURE__*/React.createElement("option",{value:"30"},"30 days"),/*#__PURE__*/React.createElement("option",{value:"90"},"90 days"),/*#__PURE__*/React.createElement("option",{value:"180"},"180 days"),/*#__PURE__*/React.createElement("option",{value:"365"},"1 year")))),/*#__PURE__*/React.createElement("button",{onClick:createToken,disabled:loading||!newTokenName.trim(),className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 disabled:opacity-50 rounded-lg text-white text-sm flex items-center gap-2"},loading?/*#__PURE__*/React.createElement(Icons.Loader,{className:"w-4 h-4 animate-spin"}):/*#__PURE__*/React.createElement(Icons.Key,{className:"w-4 h-4"}),"Generate Token"))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"text-white font-medium mb-3 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Key,{className:"w-4 h-4 text-blue-400"}),"Your Tokens",/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 ml-auto"},tokens.filter(t=>!t.revoked).length," active")),tokensLoading?/*#__PURE__*/React.createElement("div",{className:"text-center py-4"},/*#__PURE__*/React.createElement(Icons.Loader,{className:"w-5 h-5 animate-spin text-gray-400 mx-auto"})):tokens.length===0?/*#__PURE__*/React.createElement("p",{className:"text-gray-500 text-sm text-center py-4"},"No API tokens yet"):/*#__PURE__*/React.createElement("div",{className:"space-y-2"},tokens.map(token=>/*#__PURE__*/React.createElement("div",{key:token.id,className:`flex items-center gap-3 p-3 rounded-lg border ${token.revoked?'border-red-500/20 bg-red-500/5 opacity-50':'border-proxmox-border bg-proxmox-secondary'}`},/*#__PURE__*/React.createElement("div",{className:"flex-1 min-w-0"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 flex-wrap"},/*#__PURE__*/React.createElement("span",{className:"text-white text-sm font-medium"},token.name),/*#__PURE__*/React.createElement("code",{className:"text-xs text-gray-500 font-mono"},"pgx_",token.token_prefix,"_..."),/*#__PURE__*/React.createElement("span",{className:`text-xs px-1.5 py-0.5 rounded ${token.role==='admin'?'bg-red-500/20 text-red-400':token.role==='user'?'bg-blue-500/20 text-blue-400':'bg-gray-500/20 text-gray-400'}`},token.role),token.revoked?/*#__PURE__*/React.createElement("span",{className:"text-xs text-red-400"},"revoked"):null),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mt-1 flex gap-3 flex-wrap"},/*#__PURE__*/React.createElement("span",null,"Created: ",new Date(token.created_at).toLocaleDateString()),token.expires_at&&/*#__PURE__*/React.createElement("span",{className:new Date(token.expires_at)<new Date()?'text-red-400':''},"Expires: ",new Date(token.expires_at).toLocaleDateString()),token.last_used_at?/*#__PURE__*/React.createElement("span",null,"Last used: ",new Date(token.last_used_at).toLocaleDateString()," from ",token.last_used_ip):/*#__PURE__*/React.createElement("span",{className:"text-gray-600"},"Never used"))),!token.revoked&&/*#__PURE__*/React.createElement("button",{onClick:()=>{if(confirm(`Revoke token "${token.name}"? This cannot be undone.`))revokeToken(token.id);},className:"px-3 py-1.5 bg-red-500/10 text-red-400 rounded-lg text-xs hover:bg-red-500/20 border border-red-500/20 shrink-0"},"Revoke"))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark/50 border border-proxmox-border rounded-xl p-4 text-sm text-gray-400 space-y-2"},/*#__PURE__*/React.createElement("h4",{className:"text-gray-300 font-medium flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Info,{className:"w-4 h-4"})," Usage"),/*#__PURE__*/React.createElement("p",null,"Use API tokens for scripts, CI/CD pipelines, and monitoring integrations:"),/*#__PURE__*/React.createElement("code",{className:"block bg-proxmox-dark px-3 py-2 rounded text-xs font-mono text-green-400 border border-proxmox-border"},"curl -H \"Authorization: Bearer pgx_...\" ",window.location.origin,"/api/clusters"))))));}// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PegaProx - Settings Modal
// PegaProxSettingsModal (Server, SSL, SMTP, RBAC, Audit, Tenants)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PegaProx Settings Modal with User Management and Audit Log
function PegaProxSettingsModal({isOpen,onClose,addToast}){const{t}=useTranslation();const{getAuthHeaders,user:currentUser}=useAuth();const{isCorporate}=useLayout();// LW: Feb 2026 - Corporate styling
const[activeTab,setActiveTab]=useState('users');const[users,setUsers]=useState([]);const[auditLogs,setAuditLogs]=useState([]);const[loading,setLoading]=useState(false);const[showAddUser,setShowAddUser]=useState(false);const[editingUser,setEditingUser]=useState(null);const[userFilter,setUserFilter]=useState('');const[actionFilter,setActionFilter]=useState('');const[passwordResetUser,setPasswordResetUser]=useState(null);const[newPasswordValue,setNewPasswordValue]=useState('');// tenant state - NS
const[tenants,setTenants]=useState([]);const[showAddTenant,setShowAddTenant]=useState(false);const[newTenant,setNewTenant]=useState({name:'',clusters:[],groups:[]});const[editingTenant,setEditingTenant]=useState(null);const[clusters,setClusters]=useState([]);// for tenant cluster dropdown
// Cluster Groups state - NS Jan 2026
const[clusterGroups,setClusterGroups]=useState([]);const[showAddGroup,setShowAddGroup]=useState(false);const[newGroup,setNewGroup]=useState({name:'',description:'',color:'#E86F2D'});const[editingGroup,setEditingGroup]=useState(null);// MK: Feb 2026 - LDAP/AD settings
const[ldapConfig,setLdapConfig]=useState({ldap_enabled:false,ldap_server:'',ldap_port:389,ldap_use_ssl:false,ldap_use_starttls:false,ldap_bind_dn:'',ldap_bind_password:'',ldap_base_dn:'',ldap_user_filter:'(&(objectClass=person)(sAMAccountName={username}))',ldap_username_attribute:'sAMAccountName',ldap_email_attribute:'mail',ldap_display_name_attribute:'displayName',ldap_group_base_dn:'',ldap_group_filter:'(&(objectClass=group)(member={user_dn}))',ldap_admin_group:'',ldap_user_group:'',ldap_viewer_group:'',ldap_default_role:'viewer',ldap_auto_create_users:true,ldap_group_mappings:[]// LW: [{group_dn, role, tenant, tenant_role, permissions}]
});const[ldapTesting,setLdapTesting]=useState(false);const[ldapTestResult,setLdapTestResult]=useState(null);const[ldapTestUser,setLdapTestUser]=useState('');// NS: Feb 2026 - OIDC / Entra ID state
const[oidcConfig,setOidcConfig]=useState({oidc_enabled:false,oidc_provider:'entra',oidc_cloud_environment:'commercial',// NS: GCC High/DoD support
oidc_client_id:'',oidc_client_secret:'',oidc_tenant_id:'',oidc_authority:'',oidc_scopes:'openid profile email',oidc_redirect_uri:'',oidc_admin_group_id:'',oidc_user_group_id:'',oidc_viewer_group_id:'',oidc_default_role:'viewer',oidc_auto_create_users:true,oidc_button_text:'Sign in with Microsoft',oidc_group_mappings:[]});const[oidcTesting,setOidcTesting]=useState(false);const[oidcTestResult,setOidcTestResult]=useState(null);// permissions state - LW: this got complex fast
const[allPermissions,setAllPermissions]=useState([]);const[rolePermissions,setRolePermissions]=useState({});const[selectedUser,setSelectedUser]=useState(null);const[userPermissions,setUserPermissions]=useState(null);// custom roles state - NS: Dec 2025
const[allRoles,setAllRoles]=useState([]);const[showAddRole,setShowAddRole]=useState(false);const[newRole,setNewRole]=useState({id:'',name:'',permissions:[],tenant_id:''});const[editingRole,setEditingRole]=useState(null);const[selectedTenantForPerms,setSelectedTenantForPerms]=useState('');// for per-tenant user perms
// Pool Permissions state - MK Jan 2026
const[permSubTab,setPermSubTab]=useState('users');// users, vms, pools
const[pools,setPools]=useState([]);const[selectedPoolCluster,setSelectedPoolCluster]=useState('');const[selectedPool,setSelectedPool]=useState(null);const[poolPermissions,setPoolPermissions]=useState([]);const[showPoolPermModal,setShowPoolPermModal]=useState(false);const[poolPermForm,setPoolPermForm]=useState({subject_type:'user',subject_id:'',permissions:[]});const[availablePoolPerms,setAvailablePoolPerms]=useState([]);// Pool Management state - NS Jan 2026
const[showPoolManager,setShowPoolManager]=useState(false);const[showCreatePool,setShowCreatePool]=useState(false);const[newPoolForm,setNewPoolForm]=useState({poolid:'',comment:''});const[editingPool,setEditingPool]=useState(null);const[poolManagerLoading,setPoolManagerLoading]=useState(false);const[vmsWithoutPool,setVmsWithoutPool]=useState([]);const[showAddVmToPool,setShowAddVmToPool]=useState(null);// pool_id when open
const[filterDate,setFilterDate]=useState('');const[snapshotsSubTab,setSnapshotsTab]=useState('overview');const[snapshots,setSnapshots]=useState([]);// Server settings state
const[serverSettings,setServerSettings]=useState({domain:'',port:5000,http_redirect_port:0,// NS: 0=auto, -1=disabled, >0=specific port
ssl_enabled:false,ssl_cert:'',ssl_key:'',ssl_cert_file:null,ssl_key_file:null,logo_url:'',app_name:'PegaProx',default_theme:'proxmoxDark',// NS: Default theme for new users - Jan 2026
// NS: SMTP Settings - Dec 2025
smtp_enabled:false,smtp_host:'',smtp_port:587,smtp_user:'',smtp_password:'',smtp_from_email:'',smtp_from_name:'PegaProx Alerts',smtp_tls:true,smtp_ssl:false,alert_email_recipients:[],alert_cooldown:300});const[serverLoading,setServerLoading]=useState(false);const[showRestartConfirm,setShowRestartConfirm]=useState(false);const[restartLoading,setRestartLoading]=useState(false);const[testEmailLoading,setTestEmailLoading]=useState(false);const[testEmailAddress,setTestEmailAddress]=useState('');// Password policy state - NS Jan 2026
const[passwordPolicy,setPasswordPolicy]=useState({min_length:8,require_uppercase:true,require_lowercase:true,require_numbers:true,require_special:false});// update checker
const[updateInfo,setUpdateInfo]=useState(null);const[updateLoading,setUpdateLoading]=useState(false);const[updateError,setUpdateError]=useState(null);const[updateProgress,setUpdateProgress]=useState(null);// { status: 'downloading'|'installing'|'restarting', message: '' }
const[availableBackups,setAvailableBackups]=useState([]);const[showRollbackModal,setShowRollbackModal]=useState(false);// New user form - MK: added tenant_id for multi-tenant support
const[newUser,setNewUser]=useState({username:'',password:'',display_name:'',email:'',role:'user',tenant_id:'default'});useEffect(()=>{if(isOpen){fetchUsers();fetchAuditLogs();fetchServerSettings();fetchTenants();fetchPermissions();fetchClusters();fetchClusterGroups();fetchRoles();fetchTemplates();fetchPasswordPolicy();}},[isOpen]);// NS: Listen for navigate-to-updates event from update notification modal
useEffect(()=>{const handleNavigateUpdates=()=>{setActiveTab('updates');checkForUpdates();};window.addEventListener('pegaprox-navigate-updates',handleNavigateUpdates);return()=>window.removeEventListener('pegaprox-navigate-updates',handleNavigateUpdates);},[]);// Fetch password policy - NS Jan 2026
const fetchPasswordPolicy=async()=>{try{const r=await fetch(`${API_URL}/password-policy`,{credentials:'include'});if(r.ok){const data=await r.json();setPasswordPolicy(data);}}catch(e){console.error('fetchPasswordPolicy error:',e);}};// Generate password policy hint from fetched policy - NS Jan 2026
const getSettingsPasswordPolicyHint=()=>{const hints=[];hints.push(`${t('minChars')||'Min.'} ${passwordPolicy.min_length||8} ${t('characters')||'characters'}`);if(passwordPolicy.require_uppercase!==false)hints.push(t('uppercase')||'uppercase');if(passwordPolicy.require_lowercase!==false)hints.push(t('lowercase')||'lowercase');if(passwordPolicy.require_numbers!==false)hints.push(t('numbers')||'number');if(passwordPolicy.require_special)hints.push(t('specialChar')||'special char');return hints.join(', ');};// fetch tenants - NS
// LW: added error logging after it silently failed once during testing
const fetchTenants=async()=>{try{const r=await fetch(`${API_URL}/tenants`,{credentials:'include',headers:getAuthHeaders()});if(r.ok)setTenants(await r.json());else console.warn('Failed to fetch tenants:',r.status);}catch(e){console.error('fetchTenants error:',e);}};// fetch clusters for tenant assignment
const fetchClusters=async()=>{try{const r=await fetch(`${API_URL}/clusters`,{credentials:'include',headers:getAuthHeaders()});if(r.ok)setClusters(await r.json());}catch(e){}};// fetch cluster groups - NS Jan 2026
const fetchClusterGroups=async()=>{try{const r=await fetch(`${API_URL}/cluster-groups`,{credentials:'include',headers:getAuthHeaders()});if(r.ok)setClusterGroups(await r.json());}catch(e){console.error('fetchClusterGroups error:',e);}};// fetch all roles (builtin + custom) - NS
const fetchRoles=async()=>{try{const r=await fetch(`${API_URL}/roles`,{credentials:'include',headers:getAuthHeaders()});if(r.ok)setAllRoles(await r.json());}catch(e){}};// check for updates on component mount
const checkForUpdates=async()=>{setUpdateLoading(true);setUpdateError(null);try{const r=await fetch(`${API_URL}/pegaprox/check-update`,{credentials:'include',headers:getAuthHeaders()});const data=await r.json();setUpdateInfo(data);// Show error if present but still have version info
if(data.error){setUpdateError(data.error);}}catch(e){setUpdateError('Network error checking for updates');}finally{setUpdateLoading(false);}};// Perform update
const performUpdate=async()=>{if(!confirm(t('confirmUpdate')||'This will download and install the update. A backup will be created. The server will restart automatically. Continue?'))return;setUpdateLoading(true);setUpdateProgress({status:'downloading',message:t('downloadingUpdate')||'Downloading update...'});try{const r=await fetch(`${API_URL}/pegaprox/update`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({})});const data=await r.json();if(r.ok&&data.success){if(data.restarting){setUpdateProgress({status:'restarting',message:t('serverRestarting')||`Server restarting in ${data.restart_delay||3} seconds...`});addToast(t('updateSuccessRestarting')||'Update installed! Server is restarting...','success');// Wait and then try to reconnect
setTimeout(()=>{setUpdateProgress({status:'reconnecting',message:t('reconnecting')||'Reconnecting...'});// Poll until server is back
const pollInterval=setInterval(async()=>{try{const healthCheck=await fetch(`${API_URL}/pegaprox/version`,{credentials:'include',headers:getAuthHeaders()});if(healthCheck.ok){clearInterval(pollInterval);setUpdateProgress(null);addToast(t('updateComplete')||'Update complete! Please refresh the page.','success');// Refresh page after short delay
setTimeout(()=>window.location.reload(),2000);}}catch(e){// Server still restarting
}},2000);// Stop polling after 60 seconds
setTimeout(()=>clearInterval(pollInterval),60000);},(data.restart_delay||3)*1000+2000);}else{addToast(t('updatePrepared')||'Update prepared! Check instructions below.','success');setUpdateInfo(prev=>({...prev,instructions:data.instructions,backup_path:data.backup_path}));setUpdateProgress(null);}}else if(data.message==='Already up to date'){addToast(t('alreadyUpToDate')||'Already up to date!','info');setUpdateProgress(null);}else{addToast(data.error||t('updateFailed')||'Update failed','error');setUpdateProgress(null);}}catch(e){addToast(t('errorPerformingUpdate')||'Error performing update','error');setUpdateProgress(null);}finally{setUpdateLoading(false);}};// NS: Load available backups for rollback - Jan 2026
const loadBackups=async()=>{try{const r=await fetch(`${API_URL}/pegaprox/update/rollback`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({})});const data=await r.json();if(data.backups){setAvailableBackups(data.backups);}}catch(e){console.error('Error loading backups:',e);}};// NS: Perform rollback - Jan 2026
const performRollback=async backupName=>{if(!confirm(t('confirmRollback')||`This will restore PegaProx from backup "${backupName}". The server will restart. Continue?`))return;setUpdateLoading(true);setUpdateProgress({status:'restoring',message:t('restoringBackup')||'Restoring from backup...'});try{const r=await fetch(`${API_URL}/pegaprox/update/rollback`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({backup:backupName})});const data=await r.json();if(r.ok&&data.success){setShowRollbackModal(false);addToast(t('rollbackSuccess')||'Rollback successful! Server is restarting...','success');setUpdateProgress({status:'restarting',message:t('serverRestarting')||'Server restarting...'});// Poll for reconnection
setTimeout(()=>{const pollInterval=setInterval(async()=>{try{const healthCheck=await fetch(`${API_URL}/pegaprox/version`,{credentials:'include',headers:getAuthHeaders()});if(healthCheck.ok){clearInterval(pollInterval);setUpdateProgress(null);setTimeout(()=>window.location.reload(),2000);}}catch(e){}},2000);setTimeout(()=>clearInterval(pollInterval),60000);},5000);}else{addToast(data.error||t('rollbackFailed')||'Rollback failed','error');setUpdateProgress(null);}}catch(e){addToast(t('errorRollback')||'Error performing rollback','error');setUpdateProgress(null);}finally{setUpdateLoading(false);}};// create custom role
const handleCreateRole=async e=>{e&&e.preventDefault();try{const r=await fetch(`${API_URL}/roles`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify(newRole)});if(r.ok){setShowAddRole(false);setNewRole({id:'',name:'',permissions:[],tenant_id:''});fetchRoles();addToast(t('roleCreated')||'Role created','success');}else{const err=await r.json();addToast(err.error||'Failed','error');}}catch(e){addToast('Error creating role','error');}};// update custom role
const handleUpdateRole=async(roleId,data)=>{try{const r=await fetch(`${API_URL}/roles/${roleId}`,{method:'PUT',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify(data)});if(r.ok){setEditingRole(null);fetchRoles();addToast(t('roleSaved')||'Role saved','success');}}catch(e){}};// delete custom role
const handleDeleteRole=async(roleId,tenantId)=>{if(!confirm(t('confirmDeleteRole')||'Delete this role?'))return;try{let url=`${API_URL}/roles/${roleId}`;if(tenantId)url+=`?tenant_id=${tenantId}`;const r=await fetch(url,{method:'DELETE',headers:getAuthHeaders()});if(r.ok){fetchRoles();addToast(t('roleDeleted')||'Role deleted','success');}}catch(e){}};// role templates state - NS
const[roleTemplates,setRoleTemplates]=useState([]);const[showTemplateModal,setShowTemplateModal]=useState(false);const[selectedTemplate,setSelectedTemplate]=useState(null);const[templateConfig,setTemplateConfig]=useState({role_id:'',name:'',tenant_id:''});// fetch role templates
const fetchTemplates=async()=>{try{const r=await fetch(`${API_URL}/roles/templates`,{credentials:'include',headers:getAuthHeaders()});if(r.ok)setRoleTemplates(await r.json());}catch(e){}};// apply template
const handleApplyTemplate=async()=>{if(!selectedTemplate)return;try{const r=await fetch(`${API_URL}/roles/templates/${selectedTemplate.id}/apply`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify(templateConfig)});if(r.ok){setShowTemplateModal(false);setSelectedTemplate(null);setTemplateConfig({role_id:'',name:'',tenant_id:''});fetchRoles();addToast(t('roleCreatedFromTemplate')||'Role created from template','success');}else{const err=await r.json();addToast(err.error||'Failed','error');}}catch(e){addToast('Error','error');}};// VM ACL state - NS: Dec 2025
// AI-assisted: Claude helped with the ACL data structure
const[vmAcls,setVmAcls]=useState([]);const[selectedVmForAcl,setSelectedVmForAcl]=useState(null);const[showVmAclModal,setShowVmAclModal]=useState(false);const[vmAclUsers,setVmAclUsers]=useState([]);const[vmAclPerms,setVmAclPerms]=useState([]);const[vmAclInherit,setVmAclInherit]=useState(true);const[availableVms,setAvailableVms]=useState([]);const[selectedClusterForAcl,setSelectedClusterForAcl]=useState('');// fetch VMs for ACL management - LW: Dec 2025
const fetchVmsForAcl=async clusterId=>{if(!clusterId)return;try{const r=await fetch(`${API_URL}/clusters/${clusterId}/vms`,{credentials:'include',headers:getAuthHeaders()});if(r.ok){const data=await r.json();setAvailableVms(data.vms||[]);}}catch(e){/* silently fail, user will see empty list */}};// fetch VM ACLs for a cluster
const fetchVmAcls=async clusterId=>{if(!clusterId)return;try{const r=await fetch(`${API_URL}/clusters/${clusterId}/vm-acls`,{credentials:'include',headers:getAuthHeaders()});if(r.ok)setVmAcls(await r.json());}catch(e){}};// save VM ACL
const saveVmAcl=async()=>{if(!selectedClusterForAcl||!selectedVmForAcl)return;try{const r=await fetch(`${API_URL}/clusters/${selectedClusterForAcl}/vm-acls/${selectedVmForAcl}`,{method:'PUT',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({users:vmAclUsers,permissions:vmAclPerms,inherit_role:vmAclInherit})});if(r.ok){setShowVmAclModal(false);fetchVmAcls(selectedClusterForAcl);addToast(t('vmAclSaved')||'VM permissions saved','success');}}catch(e){addToast('Error','error');}};// delete VM ACL
const deleteVmAcl=async vmid=>{if(!selectedClusterForAcl)return;if(!confirm(t('confirmDeleteVmAcl')||'Remove custom permissions for this VM?'))return;try{const r=await fetch(`${API_URL}/clusters/${selectedClusterForAcl}/vm-acls/${vmid}`,{method:'DELETE',credentials:'include',headers:getAuthHeaders()});if(r.ok){fetchVmAcls(selectedClusterForAcl);addToast(t('vmAclDeleted')||'VM permissions removed','success');}}catch(e){}};// Pool Permissions functions - MK Jan 2026
const fetchPools=async clusterId=>{if(!clusterId)return;try{const r=await fetch(`${API_URL}/clusters/${clusterId}/pools`,{credentials:'include',headers:getAuthHeaders()});if(r.ok){const data=await r.json();setPools(data);}}catch(e){console.error('Failed to fetch pools:',e);}};const fetchPoolPermissions=async(clusterId,poolId)=>{if(!clusterId||!poolId)return;try{const r=await fetch(`${API_URL}/clusters/${clusterId}/pools/${poolId}/permissions`,{credentials:'include',headers:getAuthHeaders()});if(r.ok){const data=await r.json();setPoolPermissions(data.permissions||[]);setAvailablePoolPerms(data.available_permissions||[]);}}catch(e){console.error('Failed to fetch pool permissions:',e);}};const savePoolPermission=async()=>{if(!selectedPoolCluster||!selectedPool||!poolPermForm.subject_id)return;try{const r=await fetch(`${API_URL}/clusters/${selectedPoolCluster}/pools/${selectedPool}/permissions`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify(poolPermForm)});if(r.ok){setShowPoolPermModal(false);fetchPoolPermissions(selectedPoolCluster,selectedPool);addToast(t('poolPermSaved')||'Pool permission saved','success');setPoolPermForm({subject_type:'user',subject_id:'',permissions:[]});}else{const err=await r.json();addToast(err.error||'Error saving permission','error');}}catch(e){addToast('Error saving permission','error');}};const deletePoolPermission=async(subjectType,subjectId)=>{if(!selectedPoolCluster||!selectedPool)return;if(!confirm(t('confirmDeletePoolPerm')||`Remove permission for ${subjectId}?`))return;try{const r=await fetch(`${API_URL}/clusters/${selectedPoolCluster}/pools/${selectedPool}/permissions/${subjectType}/${subjectId}`,{method:'DELETE',credentials:'include',headers:getAuthHeaders()});if(r.ok){fetchPoolPermissions(selectedPoolCluster,selectedPool);addToast(t('poolPermDeleted')||'Pool permission removed','success');}}catch(e){}};// MK: Refresh pool cache from Proxmox
const refreshPoolCache=async clusterId=>{if(!clusterId)return;try{const r=await fetch(`${API_URL}/clusters/${clusterId}/pools/refresh-cache`,{method:'POST',credentials:'include',headers:getAuthHeaders()});if(r.ok){const data=await r.json();addToast(data.message||'Pool cache refreshed','success');// Refresh pools list
fetchPools(clusterId);}else{addToast('Failed to refresh pool cache','error');}}catch(e){addToast('Failed to refresh pool cache','error');}};// ================================================================
// Pool Management Functions - NS Jan 2026
// ================================================================
const createPool=async()=>{if(!selectedPoolCluster||!newPoolForm.poolid.trim()){addToast(t('poolIdRequired')||'Pool ID is required','error');return;}setPoolManagerLoading(true);try{const r=await fetch(`${API_URL}/clusters/${selectedPoolCluster}/pools`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({poolid:newPoolForm.poolid.trim(),comment:newPoolForm.comment.trim()})});const data=await r.json();if(r.ok){addToast(data.message||t('poolCreated')||'Pool created successfully','success');setShowCreatePool(false);setNewPoolForm({poolid:'',comment:''});// Small delay to let Proxmox process the change
setTimeout(()=>fetchPools(selectedPoolCluster),300);}else{addToast(data.error||'Failed to create pool','error');}}catch(e){addToast('Failed to create pool','error');}finally{setPoolManagerLoading(false);}};const updatePool=async()=>{if(!selectedPoolCluster||!editingPool)return;setPoolManagerLoading(true);try{const r=await fetch(`${API_URL}/clusters/${selectedPoolCluster}/pools/${editingPool.poolid}`,{method:'PUT',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({comment:editingPool.comment||''})});const data=await r.json();if(r.ok){addToast(data.message||t('poolUpdated')||'Pool updated successfully','success');setEditingPool(null);setTimeout(()=>fetchPools(selectedPoolCluster),300);}else{addToast(data.error||'Failed to update pool','error');}}catch(e){addToast('Failed to update pool','error');}finally{setPoolManagerLoading(false);}};const deletePool=async poolId=>{if(!selectedPoolCluster||!poolId)return;if(!confirm(t('confirmDeletePool')||`Are you sure you want to delete pool "${poolId}"? This cannot be undone.`))return;setPoolManagerLoading(true);try{const r=await fetch(`${API_URL}/clusters/${selectedPoolCluster}/pools/${poolId}`,{method:'DELETE',credentials:'include',headers:getAuthHeaders()});const data=await r.json();if(r.ok){addToast(data.message||t('poolDeleted')||'Pool deleted successfully','success');if(selectedPool===poolId){setSelectedPool(null);setPoolPermissions([]);}setTimeout(()=>fetchPools(selectedPoolCluster),300);}else{addToast(data.error||'Failed to delete pool','error');}}catch(e){addToast('Failed to delete pool','error');}finally{setPoolManagerLoading(false);}};const fetchVmsWithoutPool=async clusterId=>{if(!clusterId)return;try{const r=await fetch(`${API_URL}/clusters/${clusterId}/vms-without-pool`,{credentials:'include',headers:getAuthHeaders()});if(r.ok){const data=await r.json();setVmsWithoutPool(data);}}catch(e){console.error('Failed to fetch VMs without pool:',e);}};const addVmToPool=async(poolId,vmid)=>{if(!selectedPoolCluster||!poolId||!vmid)return;setPoolManagerLoading(true);try{const r=await fetch(`${API_URL}/clusters/${selectedPoolCluster}/pools/${poolId}/members`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({vmid:vmid})});const data=await r.json();if(r.ok){addToast(data.message||t('vmAddedToPool')||'VM added to pool','success');setTimeout(()=>{fetchPools(selectedPoolCluster);fetchVmsWithoutPool(selectedPoolCluster);},300);}else{addToast(data.error||'Failed to add VM to pool','error');}}catch(e){addToast('Failed to add VM to pool','error');}finally{setPoolManagerLoading(false);}};const removeVmFromPool=async(poolId,vmid)=>{if(!selectedPoolCluster||!poolId||!vmid)return;if(!confirm(t('confirmRemoveVmFromPool')||`Remove VM ${vmid} from pool "${poolId}"?`))return;setPoolManagerLoading(true);try{const r=await fetch(`${API_URL}/clusters/${selectedPoolCluster}/pools/${poolId}/members/${vmid}`,{method:'DELETE',credentials:'include',headers:getAuthHeaders()});const data=await r.json();if(r.ok){addToast(data.message||t('vmRemovedFromPool')||'VM removed from pool','success');setTimeout(()=>fetchPools(selectedPoolCluster),300);}else{addToast(data.error||'Failed to remove VM from pool','error');}}catch(e){addToast('Failed to remove VM from pool','error');}finally{setPoolManagerLoading(false);}};// fetch all permissions
const fetchPermissions=async()=>{try{const[permsRes,rolesRes]=await Promise.all([fetch(`${API_URL}/permissions`,{credentials:'include',headers:getAuthHeaders()}),fetch(`${API_URL}/permissions/roles`,{credentials:'include',headers:getAuthHeaders()})]);if(permsRes.ok)setAllPermissions(await permsRes.json());if(rolesRes.ok)setRolePermissions(await rolesRes.json());}catch(e){}};// fetch user permissions
const fetchUserPermissions=async username=>{try{const r=await fetch(`${API_URL}/users/${username}/permissions`,{credentials:'include',headers:getAuthHeaders()});if(r.ok)setUserPermissions(await r.json());}catch(e){}};const fetchServerSettings=async()=>{try{const response=await fetch(`${API_URL}/settings/server`,{credentials:'include',headers:getAuthHeaders()});if(response&&response.ok){const data=await response.json();setServerSettings(prev=>({...prev,// Server settings
domain:data.domain||'',port:data.port||5000,ssl_enabled:data.ssl_enabled||false,ssl_cert:data.ssl_cert_exists?'(Zertifikat vorhanden)':'',ssl_key:data.ssl_key_exists?'(SchlÃ¼ssel vorhanden)':'',http_redirect_port:data.http_redirect_port||0,default_theme:data.default_theme||'proxmoxDark',// SMTP settings
smtp_enabled:data.smtp_enabled||false,smtp_host:data.smtp_host||'',smtp_port:data.smtp_port||587,smtp_user:data.smtp_user||'',smtp_password:data.smtp_password||'',smtp_from_email:data.smtp_from_email||'',smtp_from_name:data.smtp_from_name||'PegaProx Alerts',smtp_tls:data.smtp_tls!==false,smtp_ssl:data.smtp_ssl||false,// Alert settings
alert_email_recipients:data.alert_email_recipients||[],alert_cooldown:data.alert_cooldown||300,// Security settings
login_max_attempts:data.login_max_attempts||5,login_lockout_time:data.login_lockout_time||300,login_attempt_window:data.login_attempt_window||300,// Password policy
password_min_length:data.password_min_length||8,password_require_uppercase:data.password_require_uppercase||false,password_require_lowercase:data.password_require_lowercase||false,password_require_numbers:data.password_require_numbers||false,password_require_special:data.password_require_special||false,// Password expiry
password_expiry_enabled:data.password_expiry_enabled||false,password_expiry_days:data.password_expiry_days||90,password_expiry_warning_days:data.password_expiry_warning_days||14,password_expiry_email_enabled:data.password_expiry_email_enabled!==false,password_expiry_include_admins:data.password_expiry_include_admins||false,force_2fa:data.force_2fa||false,force_2fa_exclude_admins:data.force_2fa_exclude_admins||false,// Session
session_timeout:data.session_timeout||86400}));// MK: Feb 2026 - Load LDAP settings
setLdapConfig(prev=>({...prev,ldap_enabled:data.ldap_enabled||false,ldap_server:data.ldap_server||'',ldap_port:data.ldap_port||389,ldap_use_ssl:data.ldap_use_ssl||false,ldap_use_starttls:data.ldap_use_starttls||false,ldap_bind_dn:data.ldap_bind_dn||'',ldap_bind_password:data.ldap_bind_password?'********':'',ldap_base_dn:data.ldap_base_dn||'',ldap_user_filter:data.ldap_user_filter||'(&(objectClass=person)(sAMAccountName={username}))',ldap_username_attribute:data.ldap_username_attribute||'sAMAccountName',ldap_email_attribute:data.ldap_email_attribute||'mail',ldap_display_name_attribute:data.ldap_display_name_attribute||'displayName',ldap_group_base_dn:data.ldap_group_base_dn||'',ldap_group_filter:data.ldap_group_filter||'(&(objectClass=group)(member={user_dn}))',ldap_admin_group:data.ldap_admin_group||'',ldap_user_group:data.ldap_user_group||'',ldap_viewer_group:data.ldap_viewer_group||'',ldap_default_role:data.ldap_default_role||'viewer',ldap_auto_create_users:data.ldap_auto_create_users!==false,ldap_group_mappings:data.ldap_group_mappings||[]}));// NS: Load OIDC / Entra ID settings
setOidcConfig(prev=>({...prev,oidc_enabled:data.oidc_enabled||false,oidc_provider:data.oidc_provider||'entra',oidc_cloud_environment:data.oidc_cloud_environment||'commercial',oidc_client_id:data.oidc_client_id||'',oidc_client_secret:'',// Never returned from server
oidc_tenant_id:data.oidc_tenant_id||'',oidc_authority:data.oidc_authority||'',oidc_scopes:data.oidc_scopes||'openid profile email',oidc_redirect_uri:data.oidc_redirect_uri||'',oidc_admin_group_id:data.oidc_admin_group_id||'',oidc_user_group_id:data.oidc_user_group_id||'',oidc_viewer_group_id:data.oidc_viewer_group_id||'',oidc_default_role:data.oidc_default_role||'viewer',oidc_auto_create_users:data.oidc_auto_create_users!==false,oidc_button_text:data.oidc_button_text||'Sign in with Microsoft',oidc_group_mappings:data.oidc_group_mappings||[]}));}}catch(err){console.error('fetching server settings:',err);}};// LW: Feb 2026 - LDAP save and test functions
const saveLdapSettings=async()=>{setLoading(true);try{const res=await fetch(`${API_URL}/settings/server`,{method:'POST',credentials:'include',headers:{'Content-Type':'application/json',...getAuthHeaders()},body:JSON.stringify(ldapConfig)});if(res.ok){const result=await res.json();addToast('LDAP settings saved','success');// NS: Feb 2026 - Show warnings if LDAP config is incomplete
if(result.warnings&&result.warnings.length>0){result.warnings.forEach(w=>addToast(`âš ï¸ ${w}`,'warning'));}fetchServerSettings();}else{const err=await res.json();addToast(err.error||'Failed to save','error');}}catch(e){addToast('Network error','error');}finally{setLoading(false);}};const testLdapConnection=async()=>{setLdapTesting(true);setLdapTestResult(null);try{const res=await fetch(`${API_URL}/settings/ldap/test`,{method:'POST',credentials:'include',headers:{'Content-Type':'application/json',...getAuthHeaders()},body:JSON.stringify({...ldapConfig,test_username:ldapTestUser})});const data=await res.json();setLdapTestResult(data);if(data.success)addToast('LDAP connection successful!','success');else addToast(data.error||'Connection failed','error');}catch(e){addToast('Network error','error');}finally{setLdapTesting(false);}};// NS: Feb 2026 - OIDC / Entra ID save and test
const saveOidcSettings=async()=>{setLoading(true);try{// MK: Auto-detect redirect URI if not set
const configToSave={...oidcConfig};if(!configToSave.oidc_redirect_uri){configToSave.oidc_redirect_uri=`${window.location.origin}/oidc/callback`;}if(!configToSave.oidc_client_secret){configToSave.oidc_client_secret='********';// Don't overwrite
}const res=await fetch(`${API_URL}/settings/server`,{method:'POST',credentials:'include',headers:{'Content-Type':'application/json',...getAuthHeaders()},body:JSON.stringify(configToSave)});if(res.ok)addToast('OIDC settings saved','success');else addToast('Failed to save OIDC settings','error');}catch(e){addToast('Network error','error');}finally{setLoading(false);}};const testOidcConnection=async()=>{setOidcTesting(true);setOidcTestResult(null);try{const res=await fetch(`${API_URL}/settings/oidc/test`,{method:'POST',credentials:'include',headers:{'Content-Type':'application/json',...getAuthHeaders()},body:JSON.stringify(oidcConfig)});const data=await res.json();setOidcTestResult(data);if(data.success)addToast('OIDC endpoints reachable!','success');else addToast('Some checks failed','warning');}catch(e){addToast('Network error','error');}finally{setOidcTesting(false);}};const handleSaveServerSettings=async()=>{setServerLoading(true);try{const formData=new FormData();formData.append('domain',serverSettings.domain);formData.append('port',serverSettings.port);formData.append('http_redirect_port',serverSettings.http_redirect_port||0);formData.append('ssl_enabled',serverSettings.ssl_enabled);formData.append('default_theme',serverSettings.default_theme||'proxmoxDark');if(serverSettings.ssl_cert_file){formData.append('ssl_cert',serverSettings.ssl_cert_file);}if(serverSettings.ssl_key_file){formData.append('ssl_key',serverSettings.ssl_key_file);}const response=await fetch(`${API_URL}/settings/server`,{method:'POST',credentials:'include',body:formData});if(response&&response.ok){const data=await response.json();addToast(t('serverSettingsSaved'),'success');if(data.restart_required){addToast(t('restartRequired'),'info');}fetchServerSettings();}else{const err=await response.json();addToast(err.error||t('errorSavingSettings'),'error');}}catch(err){addToast(t('errorSavingSettings'),'error');}setServerLoading(false);};const handleCertFileChange=(e,type)=>{const file=e.target.files[0];if(file){if(type==='cert'){setServerSettings(prev=>({...prev,ssl_cert_file:file,ssl_cert:file.name}));}else{setServerSettings(prev=>({...prev,ssl_key_file:file,ssl_key:file.name}));}}};// Save SMTP Settings - NS Jan 2026
const[smtpLoading,setSmtpLoading]=useState(false);const handleSaveSMTPSettings=async()=>{setSmtpLoading(true);try{const response=await fetch(`${API_URL}/settings/server`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({smtp_enabled:serverSettings.smtp_enabled,smtp_host:serverSettings.smtp_host,smtp_port:serverSettings.smtp_port,smtp_user:serverSettings.smtp_user,smtp_password:serverSettings.smtp_password,smtp_from_email:serverSettings.smtp_from_email,smtp_from_name:serverSettings.smtp_from_name,smtp_tls:serverSettings.smtp_tls,smtp_ssl:serverSettings.smtp_ssl,alert_email_recipients:serverSettings.alert_email_recipients,alert_cooldown:serverSettings.alert_cooldown})});if(response&&response.ok){addToast(t('smtpSettingsSaved')||'SMTP settings saved!','success');fetchServerSettings();}else{const err=await response.json();addToast(err.error||t('errorSavingSettings'),'error');}}catch(err){console.error('Save SMTP error:',err);addToast(t('errorSavingSettings'),'error');}setSmtpLoading(false);};// Test Email Function - NS Jan 2026
const handleTestEmail=async()=>{if(!testEmailAddress){addToast(t('enterEmailAddress')||'Please enter an email address','error');return;}// Validate required SMTP fields before sending
if(!serverSettings.smtp_host){addToast(t('smtpHostRequired')||'SMTP host is required','error');return;}if(!serverSettings.smtp_from_email){addToast(t('smtpFromEmailRequired')||'From email address is required','error');return;}setTestEmailLoading(true);try{const response=await fetch(`${API_URL}/settings/smtp/test`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({email:testEmailAddress,// Include current SMTP settings in case they haven't been saved yet
smtp_host:serverSettings.smtp_host,smtp_port:serverSettings.smtp_port||587,smtp_user:serverSettings.smtp_user||'',smtp_password:serverSettings.smtp_password||'',smtp_from_email:serverSettings.smtp_from_email,smtp_from_name:serverSettings.smtp_from_name||'PegaProx Alerts',smtp_tls:serverSettings.smtp_tls!==false,smtp_ssl:serverSettings.smtp_ssl||false})});const data=await response.json();if(response.ok&&data.success){addToast(data.message||t('testEmailSuccess')||'Test email sent!','success');}else{addToast(data.error||t('testEmailFailed')||'Failed to send test email','error');}}catch(err){console.error('Test email error:',err);addToast(t('testEmailFailed')||'Failed to send test email','error');}setTestEmailLoading(false);};const handleRestartServer=async()=>{setRestartLoading(true);try{const response=await fetch(`${API_URL}/settings/server/restart`,{method:'POST',credentials:'include',headers:getAuthHeaders()});if(response&&response.ok){addToast(t('restartInitiated'),'success');setShowRestartConfirm(false);// Show reconnecting message after a short delay
setTimeout(()=>{addToast(t('reconnecting'),'info');},2000);// Try to reconnect after server restart
setTimeout(()=>{window.location.reload();},5000);}else{const err=await response.json();addToast(err.error||t('restartFailed'),'error');}}catch(err){// Expected - server is restarting
addToast(t('restartInitiated'),'success');setShowRestartConfirm(false);setTimeout(()=>{window.location.reload();},5000);}setRestartLoading(false);};const fetchUsers=async()=>{try{const response=await fetch(`${API_URL}/users`,{credentials:'include',headers:getAuthHeaders()});if(response&&response.ok){const data=await response.json();setUsers(data);}}catch(err){console.error('fetching users:',err);}};const fetchAuditLogs=async()=>{try{const response=await fetch(`${API_URL}/audit`,{credentials:'include',headers:getAuthHeaders()});if(response&&response.ok){const data=await response.json();setAuditLogs(data);}}catch(err){console.error('fetching audit logs:',err);}};const fetchSnapshots=async(body=null)=>{try{const res=await fetch(`${API_URL}/snapshots/overview`,{method:body?'POST':'GET',headers:body?{'Content-Type':'application/json',...getAuthHeaders()}:getAuthHeaders(),credentials:'include',body:body?JSON.stringify(body):undefined});if(!res.ok){throw new Error(`HTTP ${res.status}`);}const data=await res.json();setSnapshots(data.snapshots??data??[]);}catch(err){console.error('Snapshot fetch failed:',err);setSnapshots([]);}};const applySnapshotFilter=async()=>{await fetchSnapshots({date:filterDate,tab:snapshotsSubTab});};const deleteSnapshot=async snap=>{if(!window.confirm(`Delete snapshot "${snap.snapshot_name}" from VM ${snap.vmid}?`)){return;}try{await fetch(`${API_URL}/snapshots/delete`,{method:'POST',headers:{'Content-Type':'application/json',...getAuthHeaders()},credentials:'include',body:JSON.stringify({snapshots:[snap]})});addToast('Snapshot deleted','success');await fetchSnapshots(filterDate?{date:filterDate,tab:snapshotsSubTab}:null);}catch(err){console.error('Snapshot delete failed:',err);addToast('Failed to delete snapshot','error');}};const handleResetPassword=async username=>{if(!newPasswordValue||newPasswordValue.length<4){addToast(t('passwordTooShort'),'error');return;}try{const response=await fetch(`${API_URL}/users/${username}/password`,{method:'PUT',credentials:'include',headers:{'Content-Type':'application/json',...getAuthHeaders()},body:JSON.stringify({password:newPasswordValue})});if(response&&response.ok){addToast(t('passwordResetSuccess'),'success');setPasswordResetUser(null);setNewPasswordValue('');fetchAuditLogs();}else{const data=await response.json();addToast(data.error||'Error resetting password','error');}}catch(err){addToast('Error resetting password','error');}};const handleDisable2FA=async username=>{if(!confirm(`${t('disable2FA')} fÃ¼r ${username}?`))return;try{const response=await fetch(`${API_URL}/users/${username}/2fa`,{method:'DELETE',credentials:'include',// MK: Fix - need cookies for session auth
headers:getAuthHeaders()});if(response&&response.ok){addToast(t('twoFactorDisabled'),'success');fetchUsers();fetchAuditLogs();}else{const data=await response.json();addToast(data.error||'Error disabling 2FA','error');}}catch(err){addToast('Error disabling 2FA','error');}};const handleCreateUser=async e=>{e.preventDefault();setLoading(true);try{const response=await fetch(`${API_URL}/users`,{method:'POST',credentials:'include',headers:{'Content-Type':'application/json',...getAuthHeaders()},body:JSON.stringify(newUser)});if(response&&response.ok){addToast(t('userCreated'),'success');setShowAddUser(false);setNewUser({username:'',password:'',display_name:'',email:'',role:'user',tenant_id:'default'});fetchUsers();fetchAuditLogs();fetchTenants();// LW: refresh tenant user counts
}else{const data=await response.json();addToast(data.error||'Error creating user','error');}}catch(err){addToast('Error creating user','error');}setLoading(false);};const handleUpdateUser=async(username,updates)=>{try{const response=await fetch(`${API_URL}/users/${username}`,{method:'PUT',credentials:'include',headers:{'Content-Type':'application/json',...getAuthHeaders()},body:JSON.stringify(updates)});if(response&&response.ok){addToast(t('userUpdated'),'success');setEditingUser(null);fetchUsers();fetchAuditLogs();fetchTenants();// NS: refresh tenant user counts
}else{const data=await response.json();addToast(data.error||'Error updating user','error');}}catch(err){console.error('Error updating user:',err);addToast('Error updating user','error');}};const handleDeleteUser=async username=>{if(!confirm(t('deleteUserConfirm')))return;try{const response=await fetch(`${API_URL}/users/${username}`,{method:'DELETE',credentials:'include',headers:getAuthHeaders()});if(response&&response.ok){addToast(t('userDeleted'),'success');fetchUsers();fetchAuditLogs();}else{const data=await response.json();addToast(data.error||'Error deleting user','error');}}catch(err){addToast('Error deleting user','error');}};const exportAuditLog=()=>{const csv=[['Timestamp','User','Cluster','Action','Details','IP Address'].join(','),...filteredLogs.map(log=>[log.timestamp,log.user,log.cluster||'',log.action,`"${(log.details||'').replace(/"/g,'""')}"`,log.ip_address||''].join(','))].join('\n');const blob=new Blob([csv],{type:'text/csv'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`pegaprox-audit-${new Date().toISOString().split('T')[0]}.csv`;a.click();URL.revokeObjectURL(url);};const getActionLabel=action=>{const labels={'user.login':t('userLogin'),'user.logout':t('userLogout'),'user.created':t('userCreated'),'user.updated':t('userUpdated'),'user.deleted':t('userDeleted'),'user.password_changed':t('passwordChanged'),'cluster.added':t('clusterAdded'),'cluster.deleted':t('clusterDeleted'),'cluster.config_changed':t('clusterConfigChanged'),'vm.started':t('vmStarted'),'vm.stopped':t('vmStopped'),'vm.restarted':t('vmRestarted'),'vm.created':t('vmCreated'),'vm.deleted':t('vmDeleted'),'vm.cloned':t('vmCloned'),'vm.migrated':t('vmMigrated'),'vm.bulk_migrated':t('vmBulkMigrated'),'vm.config_changed':t('vmConfigChanged'),'vm.suspended':t('vmSuspended'),'vm.resumed':t('vmResumed'),'vm.disk_added':t('vmDiskAdded'),'vm.disk_removed':t('vmDiskRemoved'),'vm.disk_resized':t('vmDiskResized'),'vm.disk_moved':t('vmDiskMoved'),'vm.network_added':t('vmNetworkAdded'),'vm.network_removed':t('vmNetworkRemoved'),'vm.network_updated':t('vmNetworkUpdated'),'snapshot.created':t('snapshotCreated'),'snapshot.deleted':t('snapshotDeleted'),'snapshot.restored':t('snapshotRestored'),'replication.created':t('replicationCreated'),'replication.deleted':t('replicationDeleted'),'replication.triggered':t('replicationTriggered'),'ha.enabled':t('haEnabled'),'ha.disabled':t('haDisabled'),'ha.vm_added':t('haVmAdded'),'ha.vm_removed':t('haVmRemoved'),'node.maintenance_entered':t('nodeMaintenanceEntered'),'node.maintenance_exited':t('nodeMaintenanceExited'),'node.update_started':t('nodeUpdateStarted')};return labels[action]||action;};const uniqueUsers=[...new Set(auditLogs.map(log=>log.user))];const uniqueActions=[...new Set(auditLogs.map(log=>log.action))];const filteredLogs=auditLogs.filter(log=>{if(userFilter&&log.user!==userFilter)return false;if(actionFilter&&log.action!==actionFilter)return false;return true;});if(!isOpen)return null;return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/80",onClick:onClose},/*#__PURE__*/React.createElement("div",{className:`w-full max-w-5xl max-h-[90vh] bg-proxmox-card border border-proxmox-border overflow-hidden flex flex-col ${isCorporate?'shadow-lg':'rounded-2xl shadow-2xl'}`,onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:`border-b border-proxmox-border flex items-center justify-between ${isCorporate?'px-4 py-2':'p-6'}`},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},!isCorporate&&/*#__PURE__*/React.createElement("div",{className:"w-10 h-10 rounded-xl bg-proxmox-orange/20 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Settings,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:isCorporate?'text-sm font-semibold text-white':'text-xl font-bold text-white'},isCorporate&&/*#__PURE__*/React.createElement(Icons.Settings,{className:"w-4 h-4 inline mr-2 text-gray-400"}),t('pegaproxSettings')),!isCorporate&&/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},"PegaProx ",PEGAPROX_VERSION))),/*#__PURE__*/React.createElement("button",{onClick:onClose,className:"p-1.5 hover:bg-proxmox-dark text-gray-400 hover:text-white"},/*#__PURE__*/React.createElement(Icons.X,{className:isCorporate?'w-4 h-4':undefined}))),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap border-b border-proxmox-border"},/*#__PURE__*/React.createElement("button",{onClick:()=>setActiveTab('users'),className:`flex items-center gap-2 ${isCorporate?'px-3 py-1.5 text-[13px]':'px-4 py-2.5 text-sm'} font-medium transition-colors whitespace-nowrap ${activeTab==='users'?isCorporate?'text-white border-b-2 border-blue-500 font-medium':'text-proxmox-orange border-b-2 border-proxmox-orange bg-proxmox-dark/50':'text-gray-400 hover:text-white hover:bg-proxmox-dark/30'}`},/*#__PURE__*/React.createElement(Icons.Users,{className:"w-4 h-4"}),/*#__PURE__*/React.createElement("span",{className:"hidden sm:inline"},t('userManagement')),/*#__PURE__*/React.createElement("span",{className:"sm:hidden"},t('users')||'Users')),/*#__PURE__*/React.createElement("button",{onClick:()=>setActiveTab('tenants'),className:`flex items-center gap-2 ${isCorporate?'px-3 py-1.5 text-[13px]':'px-4 py-2.5 text-sm'} font-medium transition-colors whitespace-nowrap ${activeTab==='tenants'?isCorporate?'text-white border-b-2 border-blue-500 font-medium':'text-proxmox-orange border-b-2 border-proxmox-orange bg-proxmox-dark/50':'text-gray-400 hover:text-white hover:bg-proxmox-dark/30'}`},/*#__PURE__*/React.createElement(Icons.Building,{className:"w-4 h-4"}),/*#__PURE__*/React.createElement("span",null,t('tenants')||'Tenants')),/*#__PURE__*/React.createElement("button",{onClick:()=>setActiveTab('groups'),className:`flex items-center gap-2 ${isCorporate?'px-3 py-1.5 text-[13px]':'px-4 py-2.5 text-sm'} font-medium transition-colors whitespace-nowrap ${activeTab==='groups'?isCorporate?'text-white border-b-2 border-blue-500 font-medium':'text-proxmox-orange border-b-2 border-proxmox-orange bg-proxmox-dark/50':'text-gray-400 hover:text-white hover:bg-proxmox-dark/30'}`},/*#__PURE__*/React.createElement(Icons.Folder,{className:"w-4 h-4"}),/*#__PURE__*/React.createElement("span",{className:"hidden sm:inline"},t('clusterGroups')||'Cluster Groups'),/*#__PURE__*/React.createElement("span",{className:"sm:hidden"},t('groups')||'Groups')),/*#__PURE__*/React.createElement("button",{onClick:()=>setActiveTab('permissions'),className:`flex items-center gap-2 ${isCorporate?'px-3 py-1.5 text-[13px]':'px-4 py-2.5 text-sm'} font-medium transition-colors whitespace-nowrap ${activeTab==='permissions'?isCorporate?'text-white border-b-2 border-blue-500 font-medium':'text-proxmox-orange border-b-2 border-proxmox-orange bg-proxmox-dark/50':'text-gray-400 hover:text-white hover:bg-proxmox-dark/30'}`},/*#__PURE__*/React.createElement(Icons.Key,{className:"w-4 h-4"}),/*#__PURE__*/React.createElement("span",null,t('permissions')||'Permissions')),/*#__PURE__*/React.createElement("button",{onClick:()=>setActiveTab('roles'),className:`flex items-center gap-2 ${isCorporate?'px-3 py-1.5 text-[13px]':'px-4 py-2.5 text-sm'} font-medium transition-colors whitespace-nowrap ${activeTab==='roles'?isCorporate?'text-white border-b-2 border-blue-500 font-medium':'text-proxmox-orange border-b-2 border-proxmox-orange bg-proxmox-dark/50':'text-gray-400 hover:text-white hover:bg-proxmox-dark/30'}`},/*#__PURE__*/React.createElement(Icons.Shield,{className:"w-4 h-4"}),/*#__PURE__*/React.createElement("span",null,t('roles')||'Roles')),/*#__PURE__*/React.createElement("button",{onClick:()=>setActiveTab('security'),className:`flex items-center gap-2 ${isCorporate?'px-3 py-1.5 text-[13px]':'px-4 py-2.5 text-sm'} font-medium transition-colors whitespace-nowrap ${activeTab==='security'?isCorporate?'text-white border-b-2 border-blue-500 font-medium':'text-proxmox-orange border-b-2 border-proxmox-orange bg-proxmox-dark/50':'text-gray-400 hover:text-white hover:bg-proxmox-dark/30'}`},/*#__PURE__*/React.createElement(Icons.Lock,{className:"w-4 h-4"}),/*#__PURE__*/React.createElement("span",{className:"hidden sm:inline"},t('securitySettings')),/*#__PURE__*/React.createElement("span",{className:"sm:hidden"},t('security')||'Security')),/*#__PURE__*/React.createElement("button",{onClick:()=>setActiveTab('ldap'),className:`flex items-center gap-2 ${isCorporate?'px-3 py-1.5 text-[13px]':'px-4 py-2.5 text-sm'} font-medium transition-colors whitespace-nowrap ${activeTab==='ldap'?isCorporate?'text-white border-b-2 border-blue-500 font-medium':'text-proxmox-orange border-b-2 border-proxmox-orange bg-proxmox-dark/50':'text-gray-400 hover:text-white hover:bg-proxmox-dark/30'}`},/*#__PURE__*/React.createElement(Icons.Users,{className:"w-4 h-4"}),"LDAP / AD"),/*#__PURE__*/React.createElement("button",{onClick:()=>setActiveTab('oidc'),className:`flex items-center gap-2 ${isCorporate?'px-3 py-1.5 text-[13px]':'px-4 py-2.5 text-sm'} font-medium transition-colors whitespace-nowrap ${activeTab==='oidc'?isCorporate?'text-white border-b-2 border-blue-500 font-medium':'text-proxmox-orange border-b-2 border-proxmox-orange bg-proxmox-dark/50':'text-gray-400 hover:text-white hover:bg-proxmox-dark/30'}`},/*#__PURE__*/React.createElement(Icons.Shield,{className:"w-4 h-4"}),"OIDC / Entra ID"),/*#__PURE__*/React.createElement("button",{onClick:()=>setActiveTab('compliance'),className:`flex items-center gap-2 ${isCorporate?'px-3 py-1.5 text-[13px]':'px-4 py-2.5 text-sm'} font-medium transition-colors whitespace-nowrap ${activeTab==='compliance'?isCorporate?'text-white border-b-2 border-blue-500 font-medium':'text-proxmox-orange border-b-2 border-proxmox-orange bg-proxmox-dark/50':'text-gray-400 hover:text-white hover:bg-proxmox-dark/30'}`},/*#__PURE__*/React.createElement(Icons.Check,{className:"w-4 h-4"}),/*#__PURE__*/React.createElement("span",{className:"hidden sm:inline"},t('compliance')||'Compliance'),/*#__PURE__*/React.createElement("span",{className:"sm:hidden"},"HIPAA")),/*#__PURE__*/React.createElement("button",{onClick:()=>setActiveTab('server'),className:`flex items-center gap-2 ${isCorporate?'px-3 py-1.5 text-[13px]':'px-4 py-2.5 text-sm'} font-medium transition-colors whitespace-nowrap ${activeTab==='server'?isCorporate?'text-white border-b-2 border-blue-500 font-medium':'text-proxmox-orange border-b-2 border-proxmox-orange bg-proxmox-dark/50':'text-gray-400 hover:text-white hover:bg-proxmox-dark/30'}`},/*#__PURE__*/React.createElement(Icons.Server,{className:"w-4 h-4"}),/*#__PURE__*/React.createElement("span",null,t('server')||'Server')),/*#__PURE__*/React.createElement("button",{onClick:()=>setActiveTab('audit'),className:`flex items-center gap-2 ${isCorporate?'px-3 py-1.5 text-[13px]':'px-4 py-2.5 text-sm'} font-medium transition-colors whitespace-nowrap ${activeTab==='audit'?isCorporate?'text-white border-b-2 border-blue-500 font-medium':'text-proxmox-orange border-b-2 border-proxmox-orange bg-proxmox-dark/50':'text-gray-400 hover:text-white hover:bg-proxmox-dark/30'}`},/*#__PURE__*/React.createElement(Icons.ClipboardList,{className:"w-4 h-4"}),/*#__PURE__*/React.createElement("span",{className:"hidden sm:inline"},t('auditLog')),/*#__PURE__*/React.createElement("span",{className:"sm:hidden"},"Audit")),/*#__PURE__*/React.createElement("button",{onClick:()=>{setActiveTab('updates');checkForUpdates();},className:`flex items-center gap-2 ${isCorporate?'px-3 py-1.5 text-[13px]':'px-4 py-2.5 text-sm'} font-medium transition-colors whitespace-nowrap ${activeTab==='updates'?isCorporate?'text-white border-b-2 border-blue-500 font-medium':'text-proxmox-orange border-b-2 border-proxmox-orange bg-proxmox-dark/50':'text-gray-400 hover:text-white hover:bg-proxmox-dark/30'}`},/*#__PURE__*/React.createElement(Icons.Download,{className:"w-4 h-4"}),/*#__PURE__*/React.createElement("span",null,"Updates"),updateInfo?.update_available&&/*#__PURE__*/React.createElement("span",{className:"px-1.5 py-0.5 text-xs bg-green-500 text-white rounded-full"},"NEW")),/*#__PURE__*/React.createElement("button",{onClick:()=>setActiveTab('about'),className:`flex items-center gap-2 ${isCorporate?'px-3 py-1.5 text-[13px]':'px-4 py-2.5 text-sm'} font-medium transition-colors whitespace-nowrap ${activeTab==='about'?isCorporate?'text-white border-b-2 border-blue-500 font-medium':'text-proxmox-orange border-b-2 border-proxmox-orange bg-proxmox-dark/50':'text-gray-400 hover:text-white hover:bg-proxmox-dark/30'}`},/*#__PURE__*/React.createElement(Icons.Info,{className:"w-4 h-4"}),/*#__PURE__*/React.createElement("span",null,t('about')||'About')),/*#__PURE__*/React.createElement("button",{onClick:()=>setActiveTab('support'),className:`flex items-center gap-2 ${isCorporate?'px-3 py-1.5 text-[13px]':'px-4 py-2.5 text-sm'} font-medium transition-colors whitespace-nowrap ${activeTab==='support'?isCorporate?'text-white border-b-2 border-blue-500 font-medium':'text-proxmox-orange border-b-2 border-proxmox-orange bg-proxmox-dark/50':'text-gray-400 hover:text-white hover:bg-proxmox-dark/30'}`},/*#__PURE__*/React.createElement(Icons.LifeBuoy,{className:"w-4 h-4"}),/*#__PURE__*/React.createElement("span",null,t('support')||'Support'))),/*#__PURE__*/React.createElement("div",{className:`flex-1 overflow-auto ${isCorporate?'p-4':'p-6'}`},activeTab==='users'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white"},t('users')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddUser(true),className:"flex items-center gap-2 px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm font-medium transition-colors"},/*#__PURE__*/React.createElement(Icons.UserPlus,null),t('addUser'))),showAddUser&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h4",{className:"text-white font-medium mb-4"},t('addUser')),/*#__PURE__*/React.createElement("form",{onSubmit:handleCreateUser,className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('usernameLabel')),/*#__PURE__*/React.createElement("input",{type:"text",value:newUser.username,onChange:e=>setNewUser({...newUser,username:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-proxmox-orange",required:true})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('passwordLabel')),/*#__PURE__*/React.createElement("input",{type:"password",value:newUser.password,onChange:e=>setNewUser({...newUser,password:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-proxmox-orange",required:true}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},getSettingsPasswordPolicyHint())),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('displayName')),/*#__PURE__*/React.createElement("input",{type:"text",value:newUser.display_name,onChange:e=>setNewUser({...newUser,display_name:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-proxmox-orange"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('email')),/*#__PURE__*/React.createElement("input",{type:"email",value:newUser.email,onChange:e=>setNewUser({...newUser,email:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-proxmox-orange"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('role')),/*#__PURE__*/React.createElement("select",{value:newUser.role,onChange:e=>{const selectedRole=e.target.value;// NS: Auto-select tenant when tenant-specific role is chosen
const roleObj=allRoles.find(r=>r.id===selectedRole);if(roleObj&&roleObj.scope==='tenant'&&roleObj.tenant_id){setNewUser({...newUser,role:selectedRole,tenant_id:roleObj.tenant_id});}else{setNewUser({...newUser,role:selectedRole});}},className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-proxmox-orange"},/*#__PURE__*/React.createElement("optgroup",{label:t('builtinRole')||'Builtin Roles'},/*#__PURE__*/React.createElement("option",{value:"admin"},t('roleAdmin')),/*#__PURE__*/React.createElement("option",{value:"user"},t('roleUser')),/*#__PURE__*/React.createElement("option",{value:"viewer"},t('roleViewer'))),allRoles.filter(r=>!r.builtin&&r.scope==='global').length>0&&/*#__PURE__*/React.createElement("optgroup",{label:t('customRoles')||'Custom Roles (Global)'},allRoles.filter(r=>!r.builtin&&r.scope==='global').map(r=>/*#__PURE__*/React.createElement("option",{key:r.id,value:r.id},r.name||r.id))),tenants.filter(t=>t.id!=='default').map(tenant=>{const tenantRoles=allRoles.filter(r=>!r.builtin&&r.scope==='tenant'&&r.tenant_id===tenant.id);if(tenantRoles.length===0)return null;return/*#__PURE__*/React.createElement("optgroup",{key:tenant.id,label:`${tenant.name} Roles`},tenantRoles.map(r=>/*#__PURE__*/React.createElement("option",{key:r.id,value:r.id},r.name||r.id)));}))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('tenant')||'Tenant'),/*#__PURE__*/React.createElement("select",{value:newUser.tenant_id||'default',onChange:e=>setNewUser({...newUser,tenant_id:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-proxmox-orange"},tenants.map(t=>/*#__PURE__*/React.createElement("option",{key:t.id,value:t.id},t.name))),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('tenantAutoHint')||'Auto-set when using tenant role')),/*#__PURE__*/React.createElement("div",{className:"flex items-end gap-2"},/*#__PURE__*/React.createElement("button",{type:"submit",disabled:loading,className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm font-medium transition-colors disabled:opacity-50"},t('create')),/*#__PURE__*/React.createElement("button",{type:"button",onClick:()=>setShowAddUser(false),className:"px-4 py-2 bg-proxmox-border hover:bg-gray-600 rounded-lg text-sm font-medium transition-colors"},t('cancel'))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",{className:"border-b border-proxmox-border"},/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase"},t('usernameLabel')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase"},t('displayName')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase"},t('role')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase"},t('tenant')||'Tenant'),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase"},"2FA"),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase"},t('lastLogin')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase"},t('status')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-400 uppercase"},t('actions')))),/*#__PURE__*/React.createElement("tbody",null,users.map(user=>/*#__PURE__*/React.createElement("tr",{key:user.username,className:"border-b border-gray-700/50 hover:bg-proxmox-hover"},/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("div",{className:"w-8 h-8 rounded-full bg-proxmox-orange/20 flex items-center justify-center text-proxmox-orange text-sm font-semibold"},user.username[0].toUpperCase()),/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},user.username))),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-gray-300"},user.display_name||'-'),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},editingUser===user.username?/*#__PURE__*/React.createElement("select",{defaultValue:user.role,onChange:e=>{const selectedRole=e.target.value;// LW: Auto-include tenant_id for tenant roles
const roleObj=allRoles.find(r=>r.id===selectedRole);if(roleObj&&roleObj.scope==='tenant'&&roleObj.tenant_id){handleUpdateUser(user.username,{role:selectedRole,tenant_id:roleObj.tenant_id});}else{handleUpdateUser(user.username,{role:selectedRole});}},className:"px-2 py-1 bg-proxmox-darker border border-proxmox-border rounded text-sm text-white"},/*#__PURE__*/React.createElement("optgroup",{label:t('builtinRole')||'Builtin'},/*#__PURE__*/React.createElement("option",{value:"admin"},t('roleAdmin')),/*#__PURE__*/React.createElement("option",{value:"user"},t('roleUser')),/*#__PURE__*/React.createElement("option",{value:"viewer"},t('roleViewer'))),allRoles.filter(r=>!r.builtin).length>0&&/*#__PURE__*/React.createElement("optgroup",{label:t('customRoles')||'Custom'},allRoles.filter(r=>!r.builtin).map(r=>/*#__PURE__*/React.createElement("option",{key:r.id,value:r.id},r.name||r.id)))):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("span",{className:`px-2 py-1 rounded text-xs font-medium ${user.role==='admin'?'bg-red-500/10 text-red-400':user.role==='user'?'bg-blue-500/10 text-blue-400':user.role==='viewer'?'bg-gray-500/10 text-gray-400':'bg-purple-500/10 text-purple-400'}`},user.role==='admin'?t('roleAdmin'):user.role==='user'?t('roleUser'):user.role==='viewer'?t('roleViewer'):user.role),user.auth_source==='ldap'&&/*#__PURE__*/React.createElement("span",{className:"px-1.5 py-0.5 rounded text-xs bg-blue-500/10 text-blue-400 border border-blue-500/20"},"LDAP"),user.auth_source==='entra'&&/*#__PURE__*/React.createElement("span",{className:"px-1.5 py-0.5 rounded text-xs bg-cyan-500/10 text-cyan-400 border border-cyan-500/20"},"Entra ID"),user.auth_source==='oidc'&&/*#__PURE__*/React.createElement("span",{className:"px-1.5 py-0.5 rounded text-xs bg-purple-500/10 text-purple-400 border border-purple-500/20"},"OIDC"))),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-gray-400 text-sm"},editingUser===user.username?/*#__PURE__*/React.createElement("select",{defaultValue:user.tenant_id||'default',onChange:e=>handleUpdateUser(user.username,{tenant_id:e.target.value}),className:"px-2 py-1 bg-proxmox-darker border border-proxmox-border rounded text-sm text-white"},tenants.map(t=>/*#__PURE__*/React.createElement("option",{key:t.id,value:t.id},t.name))):/*#__PURE__*/React.createElement("span",{className:"px-2 py-1 rounded text-xs bg-cyan-500/10 text-cyan-400"},tenants.find(t=>t.id===user.tenant_id)?.name||user.tenant_id||'Default')),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-1 rounded text-xs font-medium ${user.totp_enabled?'bg-green-500/10 text-green-400':'bg-gray-500/10 text-gray-500'}`},user.totp_enabled?'âœ“ 2FA':'-')),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-gray-400 text-sm"},user.last_login?new Date(user.last_login).toLocaleString():t('never')),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-1 rounded text-xs font-medium ${user.enabled?'bg-green-500/10 text-green-400':'bg-red-500/10 text-red-400'}`},user.enabled?t('enabled'):t('disabled'))),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-right"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-end gap-1"},passwordResetUser===user.username?/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1"},/*#__PURE__*/React.createElement("input",{type:"password",value:newPasswordValue,onChange:e=>setNewPasswordValue(e.target.value),placeholder:t('newPassword'),title:getSettingsPasswordPolicyHint(),className:"w-24 px-2 py-1 bg-proxmox-darker border border-proxmox-border rounded text-sm text-white"}),/*#__PURE__*/React.createElement("button",{onClick:()=>handleResetPassword(user.username),className:"p-1.5 rounded bg-green-500/20 text-green-400 hover:bg-green-500/30",title:"Save"},/*#__PURE__*/React.createElement(Icons.Check,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>{setPasswordResetUser(null);setNewPasswordValue('');},className:"p-1.5 rounded bg-red-500/20 text-red-400 hover:bg-red-500/30",title:"Cancel"},/*#__PURE__*/React.createElement(Icons.X,null))):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("button",{onClick:()=>setPasswordResetUser(user.username),className:"p-1.5 rounded hover:bg-proxmox-border text-gray-400 hover:text-yellow-400",title:t('resetPassword')},/*#__PURE__*/React.createElement("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"}))),user.totp_enabled&&/*#__PURE__*/React.createElement("button",{onClick:()=>handleDisable2FA(user.username),className:"p-1.5 rounded hover:bg-proxmox-border text-gray-400 hover:text-orange-400",title:t('disable2FA')},/*#__PURE__*/React.createElement(Icons.Shield,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>setEditingUser(editingUser===user.username?null:user.username),className:"p-1.5 rounded hover:bg-proxmox-border text-gray-400 hover:text-white",title:t('editUser')},/*#__PURE__*/React.createElement(Icons.Edit,null)),/*#__PURE__*/React.createElement("button",{onClick:()=>handleUpdateUser(user.username,{enabled:!user.enabled}),className:`p-1.5 rounded hover:bg-proxmox-border ${user.enabled?'text-green-400':'text-red-400'}`,title:user.enabled?t('disable'):t('enable')},user.enabled?/*#__PURE__*/React.createElement(Icons.Check,null):/*#__PURE__*/React.createElement(Icons.X,null)),user.username!==currentUser?.username&&/*#__PURE__*/React.createElement("button",{onClick:()=>handleDeleteUser(user.username),className:"p-1.5 rounded hover:bg-red-500/10 text-gray-400 hover:text-red-400",title:t('deleteUser')},/*#__PURE__*/React.createElement(Icons.Trash,null))))))))))),activeTab==='tenants'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white"},t('tenants')||'Tenants'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddTenant(true),className:"flex items-center gap-2 px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm font-medium transition-colors"},/*#__PURE__*/React.createElement(Icons.Plus,null),t('addTenant')||'Add Tenant')),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},t('tenantsDesc')||'Tenants allow you to separate users and restrict access to specific clusters.'),showAddTenant&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h4",{className:"text-white font-medium mb-4"},t('addTenant')||'Add Tenant'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Name"),/*#__PURE__*/React.createElement("input",{type:"text",value:newTenant.name,onChange:e=>setNewTenant({...newTenant,name:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm",placeholder:"Company Name"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('clusters')||'Clusters'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mb-2"},"Select clusters this tenant can access (empty = all)"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-2 max-h-40 overflow-y-auto"},clusters.map(c=>/*#__PURE__*/React.createElement("label",{key:c.id,className:"flex items-center gap-2 p-2 bg-proxmox-darker rounded cursor-pointer hover:bg-proxmox-hover"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newTenant.clusters.includes(c.id),onChange:e=>{if(e.target.checked){setNewTenant({...newTenant,clusters:[...newTenant.clusters,c.id]});}else{setNewTenant({...newTenant,clusters:newTenant.clusters.filter(x=>x!==c.id)});}},className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-white"},c.name))))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{try{const r=await fetch(`${API_URL}/tenants`,{method:'POST',credentials:'include',headers:{'Content-Type':'application/json',...getAuthHeaders()},body:JSON.stringify(newTenant)});if(r.ok){addToast('Tenant created','success');setShowAddTenant(false);setNewTenant({name:'',clusters:[]});fetchTenants();}else{const err=await r.json();addToast(err.error||'Error','error');}}catch(e){addToast('Error','error');}},className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm font-medium"},t('create')||'Create'),/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowAddTenant(false);setNewTenant({name:'',clusters:[]});},className:"px-4 py-2 bg-proxmox-dark border border-proxmox-border hover:bg-proxmox-hover rounded-lg text-sm text-gray-300"},t('cancel'))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",{className:"border-b border-proxmox-border bg-proxmox-darker"},/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase"},"Name"),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase"},t('clusters')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase"},t('users')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-400 uppercase"},t('actions')))),/*#__PURE__*/React.createElement("tbody",{className:"divide-y divide-proxmox-border"},tenants.map(tenant=>/*#__PURE__*/React.createElement("tr",{key:tenant.id,className:"hover:bg-proxmox-hover/50"},/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Building,{className:"w-4 h-4 text-gray-400"}),/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},tenant.name),tenant.id==='default'&&/*#__PURE__*/React.createElement("span",{className:"px-2 py-0.5 text-xs bg-blue-500/20 text-blue-400 rounded"},"Default"))),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-sm text-gray-400"},tenant.clusters.length===0?'All clusters':tenant.clusters.length+' clusters'),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-sm text-gray-400"},tenant.user_count||0),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-right"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-end gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setEditingTenant({...tenant}),className:"p-1.5 text-gray-400 hover:text-white hover:bg-proxmox-border rounded",title:t('edit')||'Edit'},/*#__PURE__*/React.createElement(Icons.Edit,{className:"w-4 h-4"})),tenant.id!=='default'&&/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!confirm(`Delete tenant "${tenant.name}"?`))return;try{const r=await fetch(`${API_URL}/tenants/${tenant.id}`,{method:'DELETE',credentials:'include',headers:getAuthHeaders()});if(r.ok){addToast('Tenant deleted','success');fetchTenants();}else{const err=await r.json();addToast(err.error||'Error','error');}}catch(e){}},className:"p-1.5 text-red-400 hover:bg-red-500/20 rounded"},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-4 h-4"}))))))))),editingTenant&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker border border-proxmox-border rounded-xl p-6 w-full max-w-lg"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4"},t('editTenant')||'Edit Tenant',": ",editingTenant.name),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Name"),/*#__PURE__*/React.createElement("input",{type:"text",value:editingTenant.name,onChange:e=>setEditingTenant({...editingTenant,name:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('clusters')||'Clusters'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mb-2"},t('tenantClustersHint')||'Select which clusters this tenant can access (empty = all)'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto bg-proxmox-dark rounded-lg p-3"},clusters.map(c=>/*#__PURE__*/React.createElement("label",{key:c.id,className:"flex items-center gap-2 p-2 hover:bg-proxmox-hover rounded cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:editingTenant.clusters?.includes(c.id),onChange:e=>{if(e.target.checked){setEditingTenant({...editingTenant,clusters:[...(editingTenant.clusters||[]),c.id]});}else{setEditingTenant({...editingTenant,clusters:(editingTenant.clusters||[]).filter(x=>x!==c.id)});}},className:"rounded border-gray-600"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-white"},c.name)))))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{try{const r=await fetch(`${API_URL}/tenants/${editingTenant.id}`,{method:'PUT',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({name:editingTenant.name,clusters:editingTenant.clusters||[]})});if(r.ok){addToast(t('tenantSaved')||'Tenant saved','success');setEditingTenant(null);fetchTenants();}else{const err=await r.json();addToast(err.error||'Error','error');}}catch(e){addToast('Error','error');}},className:"flex-1 px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm font-medium"},t('save')||'Save'),/*#__PURE__*/React.createElement("button",{onClick:()=>setEditingTenant(null),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm"},t('cancel')||'Cancel'))))),activeTab==='groups'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white"},t('clusterGroups')||'Cluster Groups'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mt-1"},t('clusterGroupsDesc'))),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddGroup(true),className:"flex items-center gap-2 px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm font-medium"},/*#__PURE__*/React.createElement(Icons.Plus,{className:"w-4 h-4"}),t('addGroup')||'Add Group')),/*#__PURE__*/React.createElement("div",{className:"space-y-3"},clusterGroups.length===0?/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},/*#__PURE__*/React.createElement(Icons.Folder,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),/*#__PURE__*/React.createElement("p",null,t('noGroupsYet')),/*#__PURE__*/React.createElement("p",{className:"text-sm mt-1"},t('createGroupFirst'))):clusterGroups.map(group=>{const groupClusters=clusters.filter(c=>c.group_id===group.id);const tenant=tenants.find(t=>t.id===group.tenant_id);return/*#__PURE__*/React.createElement("div",{key:group.id,className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:group.color||'#E86F2D'}}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},group.name),group.description&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},group.description))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},tenant&&/*#__PURE__*/React.createElement("span",{className:"px-2 py-1 bg-blue-500/20 text-blue-400 rounded text-xs"},"Tenant: ",tenant.name),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-400"},groupClusters.length," cluster(s)"),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1"},/*#__PURE__*/React.createElement("button",{onClick:()=>setEditingGroup(group),className:"p-1.5 text-gray-400 hover:text-white hover:bg-proxmox-hover rounded"},/*#__PURE__*/React.createElement(Icons.Edit,{className:"w-4 h-4"})),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!confirm(`Delete group "${group.name}"?`))return;try{const r=await fetch(`${API_URL}/cluster-groups/${group.id}`,{method:'DELETE',credentials:'include',headers:getAuthHeaders()});if(r.ok){addToast('Group deleted','success');fetchClusterGroups();}else{const err=await r.json();addToast(err.error||'Error','error');}}catch(e){}},className:"p-1.5 text-red-400 hover:bg-red-500/20 rounded"},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-4 h-4"}))))),groupClusters.length>0&&/*#__PURE__*/React.createElement("div",{className:"mt-3 pt-3 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-2"},groupClusters.map(c=>/*#__PURE__*/React.createElement("span",{key:c.id,className:"px-2 py-1 bg-proxmox-card border border-proxmox-border rounded text-xs text-gray-300"},c.display_name||c.name||c.host)))));})),(showAddGroup||editingGroup)&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-md p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold mb-4"},editingGroup?'Edit Group':'Add Cluster Group'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Name *"),/*#__PURE__*/React.createElement("input",{type:"text",value:editingGroup?editingGroup.name:newGroup.name,onChange:e=>editingGroup?setEditingGroup({...editingGroup,name:e.target.value}):setNewGroup({...newGroup,name:e.target.value}),placeholder:"Production Clusters",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Description"),/*#__PURE__*/React.createElement("input",{type:"text",value:editingGroup?editingGroup.description:newGroup.description,onChange:e=>editingGroup?setEditingGroup({...editingGroup,description:e.target.value}):setNewGroup({...newGroup,description:e.target.value}),placeholder:"Production environment clusters",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Color"),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("input",{type:"color",value:editingGroup?editingGroup.color:newGroup.color,onChange:e=>editingGroup?setEditingGroup({...editingGroup,color:e.target.value}):setNewGroup({...newGroup,color:e.target.value}),className:"w-10 h-10 rounded cursor-pointer"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-400"},editingGroup?editingGroup.color:newGroup.color))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Assign to Tenant (optional)"),/*#__PURE__*/React.createElement("select",{value:editingGroup?editingGroup.tenant_id||'':newGroup.tenant_id||'',onChange:e=>editingGroup?setEditingGroup({...editingGroup,tenant_id:e.target.value||null}):setNewGroup({...newGroup,tenant_id:e.target.value||null}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white"},/*#__PURE__*/React.createElement("option",{value:""},"No tenant (visible to all)"),tenants.filter(t=>t.id!=='default').map(t=>/*#__PURE__*/React.createElement("option",{key:t.id,value:t.id},t.name))),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},"If assigned, only this tenant can see clusters in this group"))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowAddGroup(false);setEditingGroup(null);setNewGroup({name:'',description:'',color:'#E86F2D'});},className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm"},"Cancel"),/*#__PURE__*/React.createElement("button",{onClick:async()=>{const data=editingGroup||newGroup;if(!data.name){addToast('Name required','error');return;}try{const url=editingGroup?`${API_URL}/cluster-groups/${editingGroup.id}`:`${API_URL}/cluster-groups`;const r=await fetch(url,{method:editingGroup?'PUT':'POST',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify(data)});if(r.ok){addToast(editingGroup?'Group updated':'Group created','success');setShowAddGroup(false);setEditingGroup(null);setNewGroup({name:'',description:'',color:'#E86F2D'});fetchClusterGroups();}else{const err=await r.json();addToast(err.error||'Error','error');}}catch(e){addToast('Error','error');}},className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm"},editingGroup?'Save':'Create'))))),activeTab==='permissions'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white"},t('permissions')||'Permissions')),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 border-b border-proxmox-border pb-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setPermSubTab('users'),className:`px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${permSubTab==='users'?'bg-proxmox-orange text-white':'bg-proxmox-dark text-gray-400 hover:text-white'}`},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.User,null),t('userPermissions')||'User Permissions')),/*#__PURE__*/React.createElement("button",{onClick:()=>setPermSubTab('vms'),className:`px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${permSubTab==='vms'?'bg-proxmox-orange text-white':'bg-proxmox-dark text-gray-400 hover:text-white'}`},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.VM,null),t('vmPermissions')||'VM Permissions')),/*#__PURE__*/React.createElement("button",{onClick:()=>setPermSubTab('pools'),className:`px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${permSubTab==='pools'?'bg-proxmox-orange text-white':'bg-proxmox-dark text-gray-400 hover:text-white'}`},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Layers,null),t('poolPermissions')||'Pool Permissions'))),permSubTab==='users'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mb-4"},t('permissionsDesc')||'Configure granular permissions for users. Role-based defaults can be overridden per user.'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white mb-3"},t('selectUser')||'Select User'),/*#__PURE__*/React.createElement("div",{className:"space-y-2 max-h-96 overflow-y-auto"},users.map(u=>/*#__PURE__*/React.createElement("button",{key:u.username,onClick:()=>{setSelectedUser(u.username);fetchUserPermissions(u.username);},className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors ${selectedUser===u.username?'bg-proxmox-orange text-white':'bg-proxmox-darker text-gray-300 hover:bg-proxmox-hover'}`},/*#__PURE__*/React.createElement("div",{className:"font-medium"},u.display_name||u.username),/*#__PURE__*/React.createElement("div",{className:"text-xs opacity-70"},u.role))))),/*#__PURE__*/React.createElement("div",{className:"col-span-2 bg-proxmox-dark border border-proxmox-border rounded-xl p-4"},selectedUser&&userPermissions?/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},"Permissions for ",selectedUser,/*#__PURE__*/React.createElement("span",{className:"ml-2 text-xs text-gray-400"},"(",userPermissions.role,")")),/*#__PURE__*/React.createElement("button",{onClick:async()=>{try{const r=await fetch(`${API_URL}/users/${selectedUser}/permissions`,{method:'PUT',credentials:'include',headers:{'Content-Type':'application/json',...getAuthHeaders()},body:JSON.stringify({permissions:userPermissions.extra_permissions,denied_permissions:userPermissions.denied_permissions})});if(r.ok){addToast('Permissions saved','success');fetchUserPermissions(selectedUser);}}catch(e){}},className:"px-3 py-1.5 bg-proxmox-orange hover:bg-orange-600 rounded text-sm font-medium"},t('save'))),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-2"},"\u2713 = granted by role | + = extra permission | \u2717 = denied"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4 max-h-80 overflow-y-auto"},Object.entries(allPermissions.reduce((acc,p)=>{const cat=p.category;if(!acc[cat])acc[cat]=[];acc[cat].push(p);return acc;},{})).map(([category,perms])=>/*#__PURE__*/React.createElement("div",{key:category,className:"bg-proxmox-darker rounded-lg p-3"},/*#__PURE__*/React.createElement("h5",{className:"text-sm font-medium text-white mb-2 capitalize"},category),/*#__PURE__*/React.createElement("div",{className:"space-y-1"},perms.map(p=>{const fromRole=userPermissions.role_permissions?.includes(p.permission);const extra=userPermissions.extra_permissions?.includes(p.permission);const denied=userPermissions.denied_permissions?.includes(p.permission);const effective=userPermissions.effective_permissions?.includes(p.permission);return/*#__PURE__*/React.createElement("div",{key:p.permission,className:"flex items-center justify-between py-1"},/*#__PURE__*/React.createElement("span",{className:`text-xs ${effective?'text-green-400':'text-gray-500'}`},p.permission.split('.')[1]),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1"},fromRole&&/*#__PURE__*/React.createElement("span",{className:"text-xs text-blue-400"},"\u2713"),/*#__PURE__*/React.createElement("button",{onClick:()=>{if(extra){setUserPermissions({...userPermissions,extra_permissions:userPermissions.extra_permissions.filter(x=>x!==p.permission)});}else{setUserPermissions({...userPermissions,extra_permissions:[...(userPermissions.extra_permissions||[]),p.permission],denied_permissions:(userPermissions.denied_permissions||[]).filter(x=>x!==p.permission)});}},className:`px-1.5 py-0.5 text-xs rounded ${extra?'bg-green-500/20 text-green-400':'bg-proxmox-dark text-gray-500 hover:text-green-400'}`},"+"),/*#__PURE__*/React.createElement("button",{onClick:()=>{if(denied){setUserPermissions({...userPermissions,denied_permissions:userPermissions.denied_permissions.filter(x=>x!==p.permission)});}else{setUserPermissions({...userPermissions,denied_permissions:[...(userPermissions.denied_permissions||[]),p.permission],extra_permissions:(userPermissions.extra_permissions||[]).filter(x=>x!==p.permission)});}},className:`px-1.5 py-0.5 text-xs rounded ${denied?'bg-red-500/20 text-red-400':'bg-proxmox-dark text-gray-500 hover:text-red-400'}`},"\u2717")));})))))):/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center h-64 text-gray-500"},t('selectUserToEdit')||'Select a user to edit permissions')))),permSubTab==='vms'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"pt-2"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center mb-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h4",{className:"text-md font-semibold text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Shield,null),t('vmAcl')||'VM Access Control'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('vmAclDesc')||'Grant specific users access to individual VMs'))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('selectCluster')||'Select Cluster'),/*#__PURE__*/React.createElement("select",{value:selectedClusterForAcl,onChange:e=>{setSelectedClusterForAcl(e.target.value);fetchVmAcls(e.target.value);fetchVmsForAcl(e.target.value);},className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},t('select')||'-- Select --'),clusters.map(c=>/*#__PURE__*/React.createElement("option",{key:c.id,value:c.id},c.name))),selectedClusterForAcl&&/*#__PURE__*/React.createElement("button",{onClick:()=>{setSelectedVmForAcl(null);setVmAclUsers([]);setVmAclPerms([]);setVmAclInherit(true);setShowVmAclModal(true);},className:"mt-3 w-full px-3 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm font-medium flex items-center justify-center gap-2"},/*#__PURE__*/React.createElement(Icons.Plus,null),t('addVmAcl')||'Add VM Permission')),/*#__PURE__*/React.createElement("div",{className:"col-span-2 bg-proxmox-dark border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white mb-3"},t('vmPermissions')||'VM Permissions'),selectedClusterForAcl?vmAcls.length>0?/*#__PURE__*/React.createElement("div",{className:"space-y-2 max-h-64 overflow-y-auto"},vmAcls.map(acl=>{const vm=availableVms.find(v=>v.vmid===acl.vmid);return/*#__PURE__*/React.createElement("div",{key:acl.vmid,className:"flex items-center justify-between p-3 bg-proxmox-darker rounded-lg"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-white text-sm font-medium"},vm?.name||`VM ${acl.vmid}`,/*#__PURE__*/React.createElement("span",{className:"ml-2 text-xs text-gray-500"},"(",acl.vmid,")")),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-400 mt-1"},acl.users?.length||0," users \u2022",acl.inherit_role?' Inherits role permissions':` ${acl.permissions?.length||0} custom permissions`)),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setSelectedVmForAcl(acl.vmid);setVmAclUsers(acl.users||[]);setVmAclPerms(acl.permissions||[]);setVmAclInherit(acl.inherit_role!==false);setShowVmAclModal(true);},className:"px-2 py-1 text-xs bg-proxmox-border hover:bg-gray-600 rounded"},t('edit')||'Edit'),/*#__PURE__*/React.createElement("button",{onClick:()=>deleteVmAcl(acl.vmid),className:"px-2 py-1 text-xs bg-red-500/20 text-red-400 hover:bg-red-500/30 rounded"},t('delete')||'Delete')));})):/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},t('noVmAcls')||'No VM-specific permissions configured. All VMs follow role-based access.'):/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},t('selectClusterFirst')||'Select a cluster to manage VM permissions')))),showVmAclModal&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker border border-proxmox-border rounded-xl p-6 w-full max-w-lg"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4"},selectedVmForAcl?t('editVmAcl')||'Edit VM Permission':t('addVmAcl')||'Add VM Permission'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},!selectedVmForAcl&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('selectVm')||'Select VM'),/*#__PURE__*/React.createElement("select",{value:selectedVmForAcl||'',onChange:e=>{const val=e.target.value;setSelectedVmForAcl(val?parseInt(val):null);},className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"-- ",t('selectVm')||'Select VM'," --"),availableVms.map(vm=>/*#__PURE__*/React.createElement("option",{key:vm.vmid,value:vm.vmid},vm.name||`VM ${vm.vmid}`," (",vm.vmid,") - ",vm.status))),availableVms.length===0&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-yellow-500 mt-1"},t('noVmsInCluster')||'No VMs found in this cluster')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('usersWithAccess')||'Users with Access'),/*#__PURE__*/React.createElement("div",{className:"max-h-40 overflow-y-auto bg-proxmox-dark rounded-lg p-2"},users.map(u=>/*#__PURE__*/React.createElement("label",{key:u.username,className:"flex items-center gap-2 p-2 hover:bg-proxmox-darker rounded cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:vmAclUsers.includes(u.username),onChange:e=>{if(e.target.checked){setVmAclUsers([...vmAclUsers,u.username]);}else{setVmAclUsers(vmAclUsers.filter(x=>x!==u.username));}},className:"rounded border-gray-600"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-white"},u.display_name||u.username),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},"(",u.role,")"))))),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:vmAclInherit,onChange:e=>setVmAclInherit(e.target.checked),className:"rounded border-gray-600"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},t('inheritRolePerms')||'Use role-based permissions')),!vmAclInherit&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('customPermissions')||'Custom Permissions'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-1 max-h-40 overflow-y-auto bg-proxmox-dark rounded-lg p-2"},allPermissions.filter(p=>p.permission.startsWith('vm.')).map(p=>/*#__PURE__*/React.createElement("label",{key:p.permission,className:"flex items-center gap-2 p-1 text-xs text-gray-300 cursor-pointer hover:text-white"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:vmAclPerms.includes(p.permission),onChange:e=>{if(e.target.checked){setVmAclPerms([...vmAclPerms,p.permission]);}else{setVmAclPerms(vmAclPerms.filter(x=>x!==p.permission));}},className:"rounded border-gray-600"}),p.permission))))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:saveVmAcl,disabled:!selectedVmForAcl||vmAclUsers.length===0,className:"flex-1 px-4 py-2 bg-proxmox-orange hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg text-sm font-medium"},t('save')||'Save'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowVmAclModal(false),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm"},t('cancel')||'Cancel'))))),permSubTab==='pools'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mb-4"},t('poolPermissionsDesc')||'Grant users or groups access to Proxmox resource pools. Permissions apply to all VMs within the pool.'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('selectCluster')||'Select Cluster'),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("select",{value:selectedPoolCluster,onChange:e=>{setSelectedPoolCluster(e.target.value);setSelectedPool(null);setPoolPermissions([]);if(e.target.value)fetchPools(e.target.value);},className:"flex-1 px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},t('select')||'-- Select --'),clusters.map(c=>/*#__PURE__*/React.createElement("option",{key:c.id,value:c.id},c.name))),selectedPoolCluster&&/*#__PURE__*/React.createElement("button",{onClick:()=>refreshPoolCache(selectedPoolCluster),className:"px-3 py-2 bg-proxmox-border hover:bg-gray-600 rounded-lg text-sm",title:t('refreshPools')||'Refresh pools from Proxmox'},/*#__PURE__*/React.createElement(Icons.Refresh,{className:"w-4 h-4"})),selectedPoolCluster&&/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowPoolManager(true);fetchVmsWithoutPool(selectedPoolCluster);},className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm",title:t('managePools')||'Manage Pools'},/*#__PURE__*/React.createElement(Icons.Settings,{className:"w-4 h-4"}))),selectedPoolCluster&&pools.length>0&&/*#__PURE__*/React.createElement("div",{className:"mt-4"},/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('selectPool')||'Select Pool'),/*#__PURE__*/React.createElement("div",{className:"space-y-2 max-h-64 overflow-y-auto"},pools.map(pool=>/*#__PURE__*/React.createElement("button",{key:pool.poolid,onClick:()=>{setSelectedPool(pool.poolid);fetchPoolPermissions(selectedPoolCluster,pool.poolid);},className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors ${selectedPool===pool.poolid?'bg-proxmox-orange text-white':'bg-proxmox-darker text-gray-300 hover:bg-proxmox-hover'}`},/*#__PURE__*/React.createElement("div",{className:"font-medium flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Layers,{className:"w-4 h-4"}),pool.poolid),/*#__PURE__*/React.createElement("div",{className:"text-xs opacity-70 mt-1"},pool.vms||0," VMs \u2022 ",pool.comment||t('noDescription')||'No description'))))),selectedPoolCluster&&pools.length===0&&/*#__PURE__*/React.createElement("div",{className:"mt-4 text-sm text-gray-500 text-center py-4"},t('noPools')||'No resource pools found in this cluster')),/*#__PURE__*/React.createElement("div",{className:"col-span-2 bg-proxmox-dark border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center mb-3"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},selectedPool?`${t('permissionsFor')||'Permissions for'} "${selectedPool}"`:t('poolPermissions')||'Pool Permissions'),selectedPool&&/*#__PURE__*/React.createElement("button",{onClick:()=>{setPoolPermForm({subject_type:'user',subject_id:'',permissions:[]});setShowPoolPermModal(true);},className:"px-3 py-1.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm font-medium flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Plus,{className:"w-4 h-4"}),t('addPermission')||'Add Permission')),selectedPool?poolPermissions.length>0?/*#__PURE__*/React.createElement("div",{className:"space-y-2 max-h-80 overflow-y-auto"},poolPermissions.map((perm,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"flex items-center justify-between p-3 bg-proxmox-darker rounded-lg"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-white text-sm font-medium flex items-center gap-2"},perm.subject_type==='user'?/*#__PURE__*/React.createElement(Icons.User,{className:"w-4 h-4"}):/*#__PURE__*/React.createElement(Icons.Users,{className:"w-4 h-4"}),perm.subject_id,/*#__PURE__*/React.createElement("span",{className:"text-xs px-1.5 py-0.5 rounded bg-gray-700 text-gray-400"},perm.subject_type)),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-1 mt-2"},perm.permissions.map((p,i)=>/*#__PURE__*/React.createElement("span",{key:i,className:"px-1.5 py-0.5 text-xs rounded bg-blue-500/20 text-blue-400"},p.replace('pool.','').replace('vm.',''))))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setPoolPermForm({subject_type:perm.subject_type,subject_id:perm.subject_id,permissions:perm.permissions});setShowPoolPermModal(true);},className:"px-2 py-1 text-xs bg-proxmox-border hover:bg-gray-600 rounded"},t('edit')||'Edit'),/*#__PURE__*/React.createElement("button",{onClick:()=>deletePoolPermission(perm.subject_type,perm.subject_id),className:"px-2 py-1 text-xs bg-red-500/20 text-red-400 hover:bg-red-500/30 rounded"},t('delete')||'Delete'))))):/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},t('noPoolPerms')||'No permissions configured for this pool'):/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},t('selectPoolFirst')||'Select a cluster and pool to manage permissions'))),showPoolPermModal&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker border border-proxmox-border rounded-xl p-6 w-full max-w-lg"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4"},poolPermForm.subject_id?t('editPoolPerm')||'Edit Pool Permission':t('addPoolPerm')||'Add Pool Permission'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('subjectType')||'Subject Type'),/*#__PURE__*/React.createElement("select",{value:poolPermForm.subject_type,onChange:e=>setPoolPermForm({...poolPermForm,subject_type:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:"user"},t('user')||'User'),/*#__PURE__*/React.createElement("option",{value:"group"},t('group')||'Group'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},poolPermForm.subject_type==='user'?t('selectUser')||'Select User':t('groupName')||'Group Name'),poolPermForm.subject_type==='user'?/*#__PURE__*/React.createElement("select",{value:poolPermForm.subject_id,onChange:e=>setPoolPermForm({...poolPermForm,subject_id:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},t('select')||'-- Select --'),users.map(u=>/*#__PURE__*/React.createElement("option",{key:u.username,value:u.username},u.display_name||u.username," (",u.role,")"))):/*#__PURE__*/React.createElement("input",{type:"text",value:poolPermForm.subject_id,onChange:e=>setPoolPermForm({...poolPermForm,subject_id:e.target.value}),placeholder:"developers",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('permissions')||'Permissions'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto bg-proxmox-dark p-3 rounded-lg border border-proxmox-border"},availablePoolPerms.map(perm=>/*#__PURE__*/React.createElement("label",{key:perm,className:"flex items-center gap-2 text-sm cursor-pointer hover:bg-proxmox-hover p-1 rounded"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:poolPermForm.permissions.includes(perm),onChange:e=>{if(e.target.checked){setPoolPermForm({...poolPermForm,permissions:[...poolPermForm.permissions,perm]});}else{setPoolPermForm({...poolPermForm,permissions:poolPermForm.permissions.filter(p=>p!==perm)});}},className:"w-4 h-4 rounded border-proxmox-border bg-proxmox-dark text-proxmox-orange"}),/*#__PURE__*/React.createElement("span",{className:poolPermForm.permissions.includes(perm)?'text-white':'text-gray-400'},perm.replace('pool.','').replace('vm.',''))))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 mt-2"},/*#__PURE__*/React.createElement("button",{type:"button",onClick:()=>setPoolPermForm({...poolPermForm,permissions:['pool.view','vm.start','vm.stop','vm.console']}),className:"px-2 py-1 text-xs bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 rounded"},"Operator"),/*#__PURE__*/React.createElement("button",{type:"button",onClick:()=>setPoolPermForm({...poolPermForm,permissions:['pool.view','vm.start','vm.stop','vm.console','vm.config','vm.snapshot','vm.backup']}),className:"px-2 py-1 text-xs bg-green-500/20 text-green-400 hover:bg-green-500/30 rounded"},"Power User"),/*#__PURE__*/React.createElement("button",{type:"button",onClick:()=>setPoolPermForm({...poolPermForm,permissions:['pool.admin']}),className:"px-2 py-1 text-xs bg-proxmox-orange/20 text-proxmox-orange hover:bg-proxmox-orange/30 rounded"},"Admin"),/*#__PURE__*/React.createElement("button",{type:"button",onClick:()=>setPoolPermForm({...poolPermForm,permissions:[]}),className:"px-2 py-1 text-xs bg-gray-500/20 text-gray-400 hover:bg-gray-500/30 rounded"},"Clear")))),/*#__PURE__*/React.createElement("div",{className:"flex gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:savePoolPermission,disabled:!poolPermForm.subject_id||poolPermForm.permissions.length===0,className:"flex-1 px-4 py-2 bg-proxmox-orange hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg text-sm font-medium"},t('save')||'Save'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowPoolPermModal(false),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm"},t('cancel')||'Cancel')))),showPoolManager&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-4xl max-h-[85vh] overflow-hidden flex flex-col"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex items-center justify-between"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Layers,null),t('managePools')||'Manage Pools'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowPoolManager(false),className:"p-1 hover:bg-proxmox-dark rounded"},/*#__PURE__*/React.createElement(Icons.X,null))),/*#__PURE__*/React.createElement("div",{className:"flex-1 overflow-auto p-4"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center mb-4"},/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},t('poolManagerDesc')||'Create, edit, and delete resource pools. Assign VMs to pools for organized permission management.'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowCreatePool(true),className:"flex items-center gap-2 px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm font-medium"},/*#__PURE__*/React.createElement(Icons.Plus,{className:"w-4 h-4"}),t('createPool')||'Create Pool')),/*#__PURE__*/React.createElement("div",{className:"space-y-3"},pools.length===0?/*#__PURE__*/React.createElement("div",{className:"text-center py-12 text-gray-500"},/*#__PURE__*/React.createElement(Icons.Layers,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),/*#__PURE__*/React.createElement("p",null,t('noPoolsYet')||'No pools yet'),/*#__PURE__*/React.createElement("p",{className:"text-sm mt-1"},t('createFirstPool')||'Create your first pool to organize VMs')):pools.map(pool=>/*#__PURE__*/React.createElement("div",{key:pool.poolid,className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-start justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex-1"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement(Icons.Layers,{className:"w-5 h-5 text-blue-400"}),/*#__PURE__*/React.createElement("h4",{className:"font-semibold text-white"},pool.poolid),/*#__PURE__*/React.createElement("span",{className:"px-2 py-0.5 bg-gray-700 rounded text-xs text-gray-400"},pool.members?.length||0," ",t('members')||'members')),pool.comment&&/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-500 mt-1 ml-8"},pool.comment),pool.members&&pool.members.length>0&&/*#__PURE__*/React.createElement("div",{className:"mt-3 ml-8"},/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mb-2"},t('poolMembers')||'Members',":"),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-2"},pool.members.filter(m=>m.type==='qemu'||m.type==='lxc').map(member=>/*#__PURE__*/React.createElement("div",{key:member.id,className:"flex items-center gap-1 px-2 py-1 bg-proxmox-darker rounded text-xs"},member.type==='qemu'?/*#__PURE__*/React.createElement(Icons.Monitor,{className:"w-3 h-3 text-blue-400"}):/*#__PURE__*/React.createElement(Icons.Box,{className:"w-3 h-3 text-yellow-400"}),/*#__PURE__*/React.createElement("span",{className:"text-gray-300"},member.vmid," - ",member.name||'unnamed'),/*#__PURE__*/React.createElement("button",{onClick:()=>removeVmFromPool(pool.poolid,member.vmid),className:"ml-1 text-red-400 hover:text-red-300",title:t('removeFromPool')||'Remove from pool'},/*#__PURE__*/React.createElement(Icons.X,{className:"w-3 h-3"}))))))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddVmToPool(pool.poolid),className:"px-3 py-1.5 bg-green-600 hover:bg-green-700 rounded text-xs flex items-center gap-1",title:t('addVmToPool')||'Add VM to pool'},/*#__PURE__*/React.createElement(Icons.Plus,{className:"w-3 h-3"}),"VM"),/*#__PURE__*/React.createElement("button",{onClick:()=>setEditingPool({poolid:pool.poolid,comment:pool.comment||''}),className:"p-1.5 text-gray-400 hover:text-white hover:bg-proxmox-hover rounded",title:t('edit')||'Edit'},/*#__PURE__*/React.createElement(Icons.Edit,{className:"w-4 h-4"})),/*#__PURE__*/React.createElement("button",{onClick:()=>deletePool(pool.poolid),className:"p-1.5 text-red-400 hover:text-red-300 hover:bg-red-500/20 rounded",title:t('delete')||'Delete'},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-4 h-4"})))))))))),showCreatePool&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker border border-proxmox-border rounded-xl p-6 w-full max-w-md"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Plus,null),t('createPool')||'Create Pool'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('poolId')||'Pool ID'," *"),/*#__PURE__*/React.createElement("input",{type:"text",value:newPoolForm.poolid,onChange:e=>setNewPoolForm({...newPoolForm,poolid:e.target.value.replace(/[^a-zA-Z0-9_-]/g,'')}),placeholder:"my-pool",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('poolIdHint')||'Letters, numbers, dashes and underscores only')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('comment')||'Description'),/*#__PURE__*/React.createElement("input",{type:"text",value:newPoolForm.comment,onChange:e=>setNewPoolForm({...newPoolForm,comment:e.target.value}),placeholder:t('optionalDescription')||'Optional description...',className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"}))),/*#__PURE__*/React.createElement("div",{className:"flex gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:createPool,disabled:poolManagerLoading||!newPoolForm.poolid.trim(),className:"flex-1 px-4 py-2 bg-proxmox-orange hover:bg-orange-600 disabled:opacity-50 rounded-lg text-sm font-medium flex items-center justify-center gap-2"},poolManagerLoading&&/*#__PURE__*/React.createElement(Icons.Loader,{className:"w-4 h-4 animate-spin"}),t('create')||'Create'),/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowCreatePool(false);setNewPoolForm({poolid:'',comment:''});},className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm"},t('cancel')||'Cancel')))),editingPool&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker border border-proxmox-border rounded-xl p-6 w-full max-w-md"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Edit,null),t('editPool')||'Edit Pool',": ",editingPool.poolid),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('poolId')||'Pool ID'),/*#__PURE__*/React.createElement("input",{type:"text",value:editingPool.poolid,disabled:true,className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-gray-500 text-sm cursor-not-allowed"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('poolIdCannotChange')||'Pool ID cannot be changed')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('comment')||'Description'),/*#__PURE__*/React.createElement("input",{type:"text",value:editingPool.comment,onChange:e=>setEditingPool({...editingPool,comment:e.target.value}),placeholder:t('optionalDescription')||'Optional description...',className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"}))),/*#__PURE__*/React.createElement("div",{className:"flex gap-3 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:updatePool,disabled:poolManagerLoading,className:"flex-1 px-4 py-2 bg-proxmox-orange hover:bg-orange-600 disabled:opacity-50 rounded-lg text-sm font-medium flex items-center justify-center gap-2"},poolManagerLoading&&/*#__PURE__*/React.createElement(Icons.Loader,{className:"w-4 h-4 animate-spin"}),t('save')||'Save'),/*#__PURE__*/React.createElement("button",{onClick:()=>setEditingPool(null),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm"},t('cancel')||'Cancel')))),showAddVmToPool&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[60]"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker border border-proxmox-border rounded-xl p-6 w-full max-w-lg max-h-[70vh] flex flex-col"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Plus,null),t('addVmToPool')||'Add VM to Pool',": ",showAddVmToPool),/*#__PURE__*/React.createElement("div",{className:"flex-1 overflow-auto"},vmsWithoutPool.length===0?/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},/*#__PURE__*/React.createElement(Icons.Check,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),/*#__PURE__*/React.createElement("p",null,t('allVmsInPools')||'All VMs are already in pools')):/*#__PURE__*/React.createElement("div",{className:"space-y-2"},/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mb-3"},t('selectVmToAdd')||'Select a VM to add to this pool',":"),vmsWithoutPool.map(vm=>/*#__PURE__*/React.createElement("button",{key:vm.vmid,onClick:()=>{addVmToPool(showAddVmToPool,vm.vmid);setShowAddVmToPool(null);},className:"w-full flex items-center gap-3 p-3 bg-proxmox-dark hover:bg-proxmox-hover border border-proxmox-border rounded-lg text-left transition-colors"},vm.type==='qemu'?/*#__PURE__*/React.createElement(Icons.Monitor,{className:"w-5 h-5 text-blue-400"}):/*#__PURE__*/React.createElement(Icons.Box,{className:"w-5 h-5 text-yellow-400"}),/*#__PURE__*/React.createElement("div",{className:"flex-1"},/*#__PURE__*/React.createElement("div",{className:"font-medium text-white"},vm.vmid," - ",vm.name),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},vm.node," \u2022 ",vm.type==='qemu'?'VM':'Container')),/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs ${vm.status==='running'?'bg-green-500/20 text-green-400':'bg-gray-500/20 text-gray-400'}`},vm.status))))),/*#__PURE__*/React.createElement("div",{className:"mt-4 pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddVmToPool(null),className:"w-full px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm"},t('close')||'Close')))))),activeTab==='roles'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white"},t('customRoles')||'Custom Roles'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddRole(true),className:"flex items-center gap-2 px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm font-medium"},/*#__PURE__*/React.createElement(Icons.Plus,null),t('createRole')||'Create Role')),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},t('rolesDesc')||'Create custom roles with specific permissions. Roles can be global or tenant-specific.'),showAddRole&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h4",{className:"text-white font-medium mb-4"},t('createRole')||'Create Role'),/*#__PURE__*/React.createElement("form",{onSubmit:handleCreateRole,className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('roleId')||'Role ID'),/*#__PURE__*/React.createElement("input",{type:"text",value:newRole.id,onChange:e=>setNewRole({...newRole,id:e.target.value.toLowerCase().replace(/[^a-z0-9_-]/g,'')}),placeholder:"operator",className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm",required:true})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('roleName')||'Display Name'),/*#__PURE__*/React.createElement("input",{type:"text",value:newRole.name,onChange:e=>setNewRole({...newRole,name:e.target.value}),placeholder:"Operator",className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('scope')||'Scope'),/*#__PURE__*/React.createElement("select",{value:newRole.tenant_id,onChange:e=>setNewRole({...newRole,tenant_id:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},t('global')||'Global'),tenants.map(t=>/*#__PURE__*/React.createElement("option",{key:t.id,value:t.id},t.name))))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},t('permissions')||'Permissions'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-4 gap-2 max-h-64 overflow-y-auto bg-proxmox-darker p-3 rounded-lg"},allPermissions.map(p=>/*#__PURE__*/React.createElement("label",{key:p.permission,className:"flex items-center gap-2 text-xs text-gray-300 cursor-pointer hover:text-white"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:newRole.permissions.includes(p.permission),onChange:e=>{if(e.target.checked){setNewRole({...newRole,permissions:[...newRole.permissions,p.permission]});}else{setNewRole({...newRole,permissions:newRole.permissions.filter(x=>x!==p.permission)});}},className:"rounded border-gray-600"}),p.permission)))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("button",{type:"submit",className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm"},t('create')||'Create'),/*#__PURE__*/React.createElement("button",{type:"button",onClick:()=>setShowAddRole(false),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm"},t('cancel')||'Cancel')))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-darker"},/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400"},t('role')||'Role'),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400"},t('scope')||'Scope'),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400"},t('permissions')||'Permissions'),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-400"},t('actions')||'Actions'))),/*#__PURE__*/React.createElement("tbody",{className:"divide-y divide-proxmox-border"},allRoles.map(role=>/*#__PURE__*/React.createElement("tr",{key:`${role.id}-${role.tenant_id||'global'}`,className:"hover:bg-proxmox-darker/50"},/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("div",{className:"font-medium text-white"},role.name||role.id),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},role.id)),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-1 text-xs rounded ${role.builtin?'bg-blue-500/20 text-blue-400':role.scope==='global'?'bg-purple-500/20 text-purple-400':'bg-green-500/20 text-green-400'}`},role.builtin?'Builtin':role.scope==='global'?'Global':`Tenant: ${role.tenant_id}`)),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-sm text-gray-400"},role.permissions?.length||0," permissions"),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-right"},!role.builtin&&/*#__PURE__*/React.createElement("button",{onClick:()=>handleDeleteRole(role.id,role.tenant_id),className:"text-red-400 hover:text-red-300 text-sm"},t('delete')||'Delete'))))))),/*#__PURE__*/React.createElement("div",{className:"mt-6"},/*#__PURE__*/React.createElement("h4",{className:"text-md font-semibold text-white mb-3 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.FileText,null),t('roleTemplates')||'Role Templates'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mb-4"},t('roleTemplatesDesc')||'Quick-start templates for common role configurations'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3"},roleTemplates.map(tpl=>/*#__PURE__*/React.createElement("div",{key:tpl.id,className:"bg-proxmox-dark border border-proxmox-border rounded-lg p-4 hover:border-proxmox-orange/50 cursor-pointer transition-colors",onClick:()=>{setSelectedTemplate(tpl);setTemplateConfig({role_id:tpl.id,name:tpl.name,tenant_id:''});setShowTemplateModal(true);}},/*#__PURE__*/React.createElement("div",{className:"font-medium text-white text-sm"},tpl.name),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mt-1"},tpl.description),/*#__PURE__*/React.createElement("div",{className:"text-xs text-proxmox-orange mt-2"},tpl.permission_count," ",t('permissions')||'permissions'))))),showTemplateModal&&selectedTemplate&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker border border-proxmox-border rounded-xl p-6 w-full max-w-md"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4"},t('createFromTemplate')||'Create from Template',": ",selectedTemplate.name),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('roleId')||'Role ID'),/*#__PURE__*/React.createElement("input",{type:"text",value:templateConfig.role_id,onChange:e=>setTemplateConfig({...templateConfig,role_id:e.target.value.toLowerCase().replace(/[^a-z0-9_-]/g,'')}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('roleName')||'Display Name'),/*#__PURE__*/React.createElement("input",{type:"text",value:templateConfig.name,onChange:e=>setTemplateConfig({...templateConfig,name:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('scope')||'Scope'),/*#__PURE__*/React.createElement("select",{value:templateConfig.tenant_id,onChange:e=>setTemplateConfig({...templateConfig,tenant_id:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},t('global')||'Global'),tenants.map(t=>/*#__PURE__*/React.createElement("option",{key:t.id,value:t.id},t.name)))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-3 max-h-40 overflow-y-auto"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-400 mb-2"},t('includedPermissions')||'Included Permissions',":"),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-1"},selectedTemplate.permissions.map(p=>/*#__PURE__*/React.createElement("span",{key:p,className:"px-2 py-0.5 bg-proxmox-darker text-xs text-gray-300 rounded"},p))))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:handleApplyTemplate,className:"flex-1 px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm font-medium"},t('create')||'Create'),/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowTemplateModal(false);setSelectedTemplate(null);},className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm"},t('cancel')||'Cancel'))))),activeTab==='security'&&/*#__PURE__*/React.createElement(SecuritySettingsSection,{addToast:addToast}),activeTab==='compliance'&&/*#__PURE__*/React.createElement(ComplianceSection,{addToast:addToast}),activeTab==='ldap'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Users,{className:"w-5 h-5 text-blue-400"}),"LDAP / Active Directory"),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-400"},"Enable LDAP"),/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:ldapConfig.ldap_enabled,onChange:e=>setLdapConfig(prev=>({...prev,ldap_enabled:e.target.checked})),className:"w-4 h-4 rounded accent-proxmox-orange"}))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4 space-y-4"},/*#__PURE__*/React.createElement("h4",{className:"text-white font-medium"},"Connection"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-3"},/*#__PURE__*/React.createElement("div",{className:"col-span-2"},/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Server (hostname or IP)"),/*#__PURE__*/React.createElement("input",{type:"text",value:ldapConfig.ldap_server,onChange:e=>setLdapConfig(prev=>({...prev,ldap_server:e.target.value})),placeholder:"ldap.example.com",className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Port"),/*#__PURE__*/React.createElement("input",{type:"number",value:ldapConfig.ldap_port,onChange:e=>setLdapConfig(prev=>({...prev,ldap_port:parseInt(e.target.value)||389})),className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm"}))),/*#__PURE__*/React.createElement("div",{className:"flex gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:ldapConfig.ldap_use_ssl,onChange:e=>setLdapConfig(prev=>({...prev,ldap_use_ssl:e.target.checked,ldap_port:e.target.checked?636:389})),className:"w-4 h-4 accent-proxmox-orange"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},"SSL (LDAPS, port 636)")),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:ldapConfig.ldap_use_starttls,onChange:e=>setLdapConfig(prev=>({...prev,ldap_use_starttls:e.target.checked})),className:"w-4 h-4 accent-proxmox-orange"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},"STARTTLS")))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4 space-y-4"},/*#__PURE__*/React.createElement("h4",{className:"text-white font-medium"},"Service Account (Bind)"),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Bind DN"),/*#__PURE__*/React.createElement("input",{type:"text",value:ldapConfig.ldap_bind_dn,onChange:e=>setLdapConfig(prev=>({...prev,ldap_bind_dn:e.target.value})),placeholder:"CN=svc-pegaprox,OU=Service Accounts,DC=example,DC=com",className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm font-mono"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Bind Password"),/*#__PURE__*/React.createElement("input",{type:"password",value:ldapConfig.ldap_bind_password,onChange:e=>setLdapConfig(prev=>({...prev,ldap_bind_password:e.target.value})),placeholder:"Service account password",className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm"}))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4 space-y-4"},/*#__PURE__*/React.createElement("h4",{className:"text-white font-medium"},"User Search"),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Base DN"),/*#__PURE__*/React.createElement("input",{type:"text",value:ldapConfig.ldap_base_dn,onChange:e=>setLdapConfig(prev=>({...prev,ldap_base_dn:e.target.value})),placeholder:"DC=example,DC=com",className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm font-mono"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"User Filter ",/*#__PURE__*/React.createElement("span",{className:"text-gray-600"},"(",'{username}'," = login name)")),/*#__PURE__*/React.createElement("input",{type:"text",value:ldapConfig.ldap_user_filter,onChange:e=>setLdapConfig(prev=>({...prev,ldap_user_filter:e.target.value})),className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm font-mono"})),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Username Attr"),/*#__PURE__*/React.createElement("input",{type:"text",value:ldapConfig.ldap_username_attribute,onChange:e=>setLdapConfig(prev=>({...prev,ldap_username_attribute:e.target.value})),className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm font-mono"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Email Attr"),/*#__PURE__*/React.createElement("input",{type:"text",value:ldapConfig.ldap_email_attribute,onChange:e=>setLdapConfig(prev=>({...prev,ldap_email_attribute:e.target.value})),className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm font-mono"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Display Name Attr"),/*#__PURE__*/React.createElement("input",{type:"text",value:ldapConfig.ldap_display_name_attribute,onChange:e=>setLdapConfig(prev=>({...prev,ldap_display_name_attribute:e.target.value})),className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm font-mono"})))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4 space-y-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("h4",{className:"text-white font-medium"},"Group \u2191 Role Mapping"),/*#__PURE__*/React.createElement("button",{onClick:()=>setLdapConfig(prev=>({...prev,ldap_group_mappings:[...prev.ldap_group_mappings,{group_dn:'',role:'viewer'}]})),className:"px-2 py-1 bg-proxmox-secondary border border-proxmox-border rounded text-xs text-gray-300 hover:text-white hover:bg-proxmox-hover flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.Plus,{className:"w-3 h-3"})," Add Mapping")),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},"Map AD/LDAP groups to PegaProx roles (including custom roles). Use full Distinguished Name (DN)."),ldapConfig.ldap_group_mappings.length===0?/*#__PURE__*/React.createElement("p",{className:"text-gray-600 text-sm text-center py-4 border border-dashed border-proxmox-border rounded-lg"},"No group mappings configured. Click \"Add Mapping\" to map an AD group to a role."):/*#__PURE__*/React.createElement("div",{className:"space-y-2"},ldapConfig.ldap_group_mappings.map((mapping,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"flex items-center gap-2 p-2 bg-proxmox-secondary rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex-1"},/*#__PURE__*/React.createElement("input",{type:"text",value:mapping.group_dn,placeholder:"CN=DevOps,OU=Groups,DC=example,DC=com",onChange:e=>{const m=[...ldapConfig.ldap_group_mappings];m[idx]={...m[idx],group_dn:e.target.value};setLdapConfig(prev=>({...prev,ldap_group_mappings:m}));},className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm font-mono"})),/*#__PURE__*/React.createElement(Icons.ArrowRight,{className:"w-4 h-4 text-gray-500 shrink-0"}),/*#__PURE__*/React.createElement("div",{className:"w-44 shrink-0"},/*#__PURE__*/React.createElement("select",{value:mapping.role||'viewer',onChange:e=>{const m=[...ldapConfig.ldap_group_mappings];m[idx]={...m[idx],role:e.target.value};setLdapConfig(prev=>({...prev,ldap_group_mappings:m}));},className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"},/*#__PURE__*/React.createElement("optgroup",{label:"Built-in"},/*#__PURE__*/React.createElement("option",{value:"admin"},"Admin"),/*#__PURE__*/React.createElement("option",{value:"user"},"User"),/*#__PURE__*/React.createElement("option",{value:"viewer"},"Viewer")),allRoles.filter(r=>!r.builtin).length>0&&/*#__PURE__*/React.createElement("optgroup",{label:"Custom Roles"},allRoles.filter(r=>!r.builtin).map(r=>/*#__PURE__*/React.createElement("option",{key:r.id,value:r.id},r.name))))),/*#__PURE__*/React.createElement("button",{onClick:()=>{const m=[...ldapConfig.ldap_group_mappings];m.splice(idx,1);setLdapConfig(prev=>({...prev,ldap_group_mappings:m}));},className:"p-1.5 text-red-400 hover:bg-red-500/10 rounded shrink-0"},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-4 h-4"}))))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3 pt-2 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Default Role (no group match)"),/*#__PURE__*/React.createElement("select",{value:ldapConfig.ldap_default_role,onChange:e=>setLdapConfig(prev=>({...prev,ldap_default_role:e.target.value})),className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:"viewer"},"Viewer"),/*#__PURE__*/React.createElement("option",{value:"user"},"User"),/*#__PURE__*/React.createElement("option",{value:"admin"},"Admin"),allRoles.filter(r=>!r.builtin).map(r=>/*#__PURE__*/React.createElement("option",{key:r.id,value:r.id},r.name)))),/*#__PURE__*/React.createElement("div",{className:"flex items-end pb-1"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:ldapConfig.ldap_auto_create_users,onChange:e=>setLdapConfig(prev=>({...prev,ldap_auto_create_users:e.target.checked})),className:"w-4 h-4 accent-proxmox-orange"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},"Auto-create users on first login"))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4 space-y-3"},/*#__PURE__*/React.createElement("h4",{className:"text-white font-medium"},"Test Connection"),/*#__PURE__*/React.createElement("div",{className:"flex items-end gap-3"},/*#__PURE__*/React.createElement("div",{className:"flex-1"},/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Test Username (optional)"),/*#__PURE__*/React.createElement("input",{type:"text",value:ldapTestUser,onChange:e=>setLdapTestUser(e.target.value),placeholder:"e.g. jdoe",className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("button",{onClick:testLdapConnection,disabled:ldapTesting||!ldapConfig.ldap_server,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 rounded-lg text-white text-sm flex items-center gap-2 shrink-0"},ldapTesting?/*#__PURE__*/React.createElement(Icons.Loader,{className:"w-4 h-4 animate-spin"}):/*#__PURE__*/React.createElement(Icons.Zap,{className:"w-4 h-4"}),"Test")),ldapTestResult&&/*#__PURE__*/React.createElement("div",{className:`p-3 rounded-lg border ${ldapTestResult.success?'bg-green-500/10 border-green-500/30':'bg-red-500/10 border-red-500/30'}`},/*#__PURE__*/React.createElement("p",{className:`font-medium text-sm ${ldapTestResult.success?'text-green-400':'text-red-400'}`},ldapTestResult.success?'âœ“ Connection Successful':`âœ— ${ldapTestResult.error}`),ldapTestResult.steps&&/*#__PURE__*/React.createElement("div",{className:"mt-2 space-y-1"},ldapTestResult.steps.map((step,i)=>/*#__PURE__*/React.createElement("div",{key:i,className:"flex items-center gap-2 text-xs"},/*#__PURE__*/React.createElement("span",{className:step.status==='ok'?'text-green-400':step.status==='warning'?'text-yellow-400':'text-red-400'},step.status==='ok'?'âœ“':step.status==='warning'?'âš ':'âœ—'),/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},step.step),step.detail&&typeof step.detail==='string'&&/*#__PURE__*/React.createElement("span",{className:"text-gray-500 font-mono"},step.detail),step.detail&&typeof step.detail==='object'&&/*#__PURE__*/React.createElement("span",{className:"text-gray-500 font-mono"},step.detail.dn," (",step.detail.groups," groups)")))))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3"},/*#__PURE__*/React.createElement("button",{onClick:saveLdapSettings,disabled:loading,className:"px-6 py-2 bg-proxmox-orange hover:bg-orange-600 disabled:opacity-50 rounded-lg text-white font-medium flex items-center gap-2"},loading?/*#__PURE__*/React.createElement(Icons.Loader,{className:"w-4 h-4 animate-spin"}):/*#__PURE__*/React.createElement(Icons.Save,{className:"w-4 h-4"}),"Save LDAP Settings"))),activeTab==='oidc'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Shield,{className:"w-5 h-5"})," OIDC / Entra ID Authentication")),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},"Configure OpenID Connect authentication with Microsoft Entra ID (Azure AD), Okta, Auth0, Keycloak, or any OIDC provider."),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4 space-y-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("h4",{className:"text-white font-medium"},"Connection"),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:oidcConfig.oidc_enabled,onChange:e=>setOidcConfig(prev=>({...prev,oidc_enabled:e.target.checked})),className:"w-4 h-4 rounded bg-proxmox-secondary border-proxmox-border"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},"Enable OIDC"))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Provider"),/*#__PURE__*/React.createElement("select",{value:oidcConfig.oidc_provider,onChange:e=>setOidcConfig(prev=>({...prev,oidc_provider:e.target.value})),className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:"entra"},"Microsoft Entra ID (Azure AD)"),/*#__PURE__*/React.createElement("option",{value:"okta"},"Okta"),/*#__PURE__*/React.createElement("option",{value:"generic"},"Generic OIDC"))),oidcConfig.oidc_provider==='entra'?/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Tenant ID"),/*#__PURE__*/React.createElement("input",{type:"text",value:oidcConfig.oidc_tenant_id,onChange:e=>setOidcConfig(prev=>({...prev,oidc_tenant_id:e.target.value})),placeholder:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm font-mono"})):/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Authority / Issuer URL"),/*#__PURE__*/React.createElement("input",{type:"text",value:oidcConfig.oidc_authority,onChange:e=>setOidcConfig(prev=>({...prev,oidc_authority:e.target.value})),placeholder:"https://login.example.com/realms/master",className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm"}))),oidcConfig.oidc_provider==='entra'&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Cloud Environment"),/*#__PURE__*/React.createElement("select",{value:oidcConfig.oidc_cloud_environment||'commercial',onChange:e=>setOidcConfig(prev=>({...prev,oidc_cloud_environment:e.target.value})),className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:"commercial"},"Commercial (Global)"),/*#__PURE__*/React.createElement("option",{value:"gcc"},"GCC (Government Community Cloud)"),/*#__PURE__*/React.createElement("option",{value:"gcc_high"},"GCC High (US Government)"),/*#__PURE__*/React.createElement("option",{value:"dod"},"DoD (Department of Defense)")),oidcConfig.oidc_cloud_environment&&oidcConfig.oidc_cloud_environment!=='commercial'&&oidcConfig.oidc_cloud_environment!=='gcc'&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-yellow-400 mt-1"},"\u26A0\uFE0F ",oidcConfig.oidc_cloud_environment==='gcc_high'?'GCC High':'DoD'," uses sovereign endpoints: login.microsoftonline.us / ",oidcConfig.oidc_cloud_environment==='dod'?'dod-graph.microsoft.us':'graph.microsoft.us')),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Client ID (Application ID)"),/*#__PURE__*/React.createElement("input",{type:"text",value:oidcConfig.oidc_client_id,onChange:e=>setOidcConfig(prev=>({...prev,oidc_client_id:e.target.value})),placeholder:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm font-mono"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Client Secret"),/*#__PURE__*/React.createElement("input",{type:"password",value:oidcConfig.oidc_client_secret,onChange:e=>setOidcConfig(prev=>({...prev,oidc_client_secret:e.target.value})),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Scopes"),/*#__PURE__*/React.createElement("input",{type:"text",value:oidcConfig.oidc_scopes,onChange:e=>setOidcConfig(prev=>({...prev,oidc_scopes:e.target.value})),placeholder:"openid profile email",className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Redirect URI"),/*#__PURE__*/React.createElement("input",{type:"text",value:oidcConfig.oidc_redirect_uri||`${window.location.origin}/oidc/callback`,onChange:e=>setOidcConfig(prev=>({...prev,oidc_redirect_uri:e.target.value})),className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm font-mono"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-600 mt-1"},"Register this URL in your identity provider"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Login Button Text"),/*#__PURE__*/React.createElement("input",{type:"text",value:oidcConfig.oidc_button_text,onChange:e=>setOidcConfig(prev=>({...prev,oidc_button_text:e.target.value})),placeholder:"Sign in with Microsoft",className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm"}))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4 space-y-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("h4",{className:"text-white font-medium"},"Group \u2191 Role Mapping"),/*#__PURE__*/React.createElement("button",{onClick:()=>setOidcConfig(prev=>({...prev,oidc_group_mappings:[...prev.oidc_group_mappings,{group_id:'',role:'viewer'}]})),className:"px-2 py-1 bg-proxmox-secondary border border-proxmox-border rounded text-xs text-gray-300 hover:text-white hover:bg-proxmox-hover flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.Plus,{className:"w-3 h-3"})," Add Mapping")),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},oidcConfig.oidc_provider==='entra'?'Map Entra groups to PegaProx roles. Use group Object IDs (Azure Portal â†‘ Groups â†‘ Overview).':'Map provider groups to PegaProx roles (including custom roles).'),oidcConfig.oidc_group_mappings.length===0?/*#__PURE__*/React.createElement("p",{className:"text-gray-600 text-sm text-center py-4 border border-dashed border-proxmox-border rounded-lg"},"No group mappings configured. Click \"Add Mapping\" to map a group to a role."):/*#__PURE__*/React.createElement("div",{className:"space-y-2"},oidcConfig.oidc_group_mappings.map((mapping,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"flex items-center gap-2 p-2 bg-proxmox-secondary rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex-1"},/*#__PURE__*/React.createElement("input",{type:"text",value:mapping.group_id,placeholder:oidcConfig.oidc_provider==='entra'?'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx':'GroupName',onChange:e=>{const m=[...oidcConfig.oidc_group_mappings];m[idx]={...m[idx],group_id:e.target.value};setOidcConfig(prev=>({...prev,oidc_group_mappings:m}));},className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm font-mono"})),/*#__PURE__*/React.createElement(Icons.ArrowRight,{className:"w-4 h-4 text-gray-500 shrink-0"}),/*#__PURE__*/React.createElement("div",{className:"w-44 shrink-0"},/*#__PURE__*/React.createElement("select",{value:mapping.role||'viewer',onChange:e=>{const m=[...oidcConfig.oidc_group_mappings];m[idx]={...m[idx],role:e.target.value};setOidcConfig(prev=>({...prev,oidc_group_mappings:m}));},className:"w-full px-2 py-1.5 bg-proxmox-dark border border-proxmox-border rounded text-white text-sm"},/*#__PURE__*/React.createElement("optgroup",{label:"Built-in"},/*#__PURE__*/React.createElement("option",{value:"admin"},"Admin"),/*#__PURE__*/React.createElement("option",{value:"user"},"User"),/*#__PURE__*/React.createElement("option",{value:"viewer"},"Viewer")),allRoles.filter(r=>!r.builtin).length>0&&/*#__PURE__*/React.createElement("optgroup",{label:"Custom Roles"},allRoles.filter(r=>!r.builtin).map(r=>/*#__PURE__*/React.createElement("option",{key:r.id,value:r.id},r.name))))),/*#__PURE__*/React.createElement("button",{onClick:()=>{const m=[...oidcConfig.oidc_group_mappings];m.splice(idx,1);setOidcConfig(prev=>({...prev,oidc_group_mappings:m}));},className:"p-1.5 text-red-400 hover:bg-red-500/10 rounded shrink-0"},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-4 h-4"}))))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3 pt-2 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Default Role (no group match)"),/*#__PURE__*/React.createElement("select",{value:oidcConfig.oidc_default_role,onChange:e=>setOidcConfig(prev=>({...prev,oidc_default_role:e.target.value})),className:"w-full px-3 py-2 bg-proxmox-secondary border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:"viewer"},"Viewer"),/*#__PURE__*/React.createElement("option",{value:"user"},"User"),/*#__PURE__*/React.createElement("option",{value:"admin"},"Admin"),allRoles.filter(r=>!r.builtin).map(r=>/*#__PURE__*/React.createElement("option",{key:r.id,value:r.id},r.name)))),/*#__PURE__*/React.createElement("div",{className:"flex items-end pb-1"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:oidcConfig.oidc_auto_create_users,onChange:e=>setOidcConfig(prev=>({...prev,oidc_auto_create_users:e.target.checked})),className:"w-4 h-4 rounded bg-proxmox-secondary border-proxmox-border"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},"Auto-create users on first login"))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4 space-y-3"},/*#__PURE__*/React.createElement("h4",{className:"text-white font-medium"},"Test Configuration"),/*#__PURE__*/React.createElement("button",{onClick:testOidcConnection,disabled:oidcTesting||!oidcConfig.oidc_client_id,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 rounded-lg text-white text-sm flex items-center gap-2"},oidcTesting?/*#__PURE__*/React.createElement(Icons.Loader,{className:"w-4 h-4 animate-spin"}):/*#__PURE__*/React.createElement(Icons.Zap,{className:"w-4 h-4"}),"Test Endpoints"),oidcTestResult&&/*#__PURE__*/React.createElement("div",{className:"space-y-1.5"},oidcTestResult.results&&oidcTestResult.results.map((r,i)=>/*#__PURE__*/React.createElement("div",{key:i,className:`flex items-center gap-2 text-sm ${r.status==='ok'?'text-green-400':r.status==='warning'?'text-yellow-400':'text-red-400'}`},r.status==='ok'?/*#__PURE__*/React.createElement(Icons.Check,{className:"w-4 h-4"}):r.status==='warning'?/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4"}):/*#__PURE__*/React.createElement(Icons.X,{className:"w-4 h-4"}),/*#__PURE__*/React.createElement("span",{className:"font-medium"},r.step,":")," ",/*#__PURE__*/React.createElement("span",{className:"text-gray-400 truncate"},r.detail))))),oidcConfig.oidc_provider==='entra'&&/*#__PURE__*/React.createElement("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-xl p-4 space-y-2"},/*#__PURE__*/React.createElement("h4",{className:"text-blue-400 font-medium flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Info,{className:"w-4 h-4"})," Entra ID Setup Guide"),/*#__PURE__*/React.createElement("ol",{className:"text-sm text-gray-400 space-y-1 list-decimal list-inside"},/*#__PURE__*/React.createElement("li",null,"Azure Portal \u2191 Entra ID \u2191 App registrations \u2191 New registration"),/*#__PURE__*/React.createElement("li",null,"Set Redirect URI to: ",/*#__PURE__*/React.createElement("code",{className:"text-blue-300 bg-proxmox-dark px-1 rounded"},oidcConfig.oidc_redirect_uri||`${window.location.origin}/oidc/callback`)),/*#__PURE__*/React.createElement("li",null,"Copy Application (client) ID \u2191 paste as Client ID above"),/*#__PURE__*/React.createElement("li",null,"Certificates & secrets \u2191 New client secret \u2191 paste above"),/*#__PURE__*/React.createElement("li",null,"API permissions \u2191 Add: ",/*#__PURE__*/React.createElement("code",{className:"text-blue-300 bg-proxmox-dark px-1 rounded"},"openid, profile, email, User.Read, GroupMember.Read.All")),/*#__PURE__*/React.createElement("li",null,"Token configuration \u2191 Add groups claim (Security groups)"),/*#__PURE__*/React.createElement("li",null,"Copy Directory (tenant) ID \u2191 paste as Tenant ID above"))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end pt-2"},/*#__PURE__*/React.createElement("button",{onClick:saveOidcSettings,disabled:loading,className:"px-6 py-2 bg-proxmox-orange hover:bg-orange-600 disabled:opacity-50 rounded-lg text-white font-medium flex items-center gap-2"},loading?/*#__PURE__*/React.createElement(Icons.Loader,{className:"w-4 h-4 animate-spin"}):/*#__PURE__*/React.createElement(Icons.Save,{className:"w-4 h-4"}),"Save OIDC Settings"))),activeTab==='server'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white"},t('serverSettings')),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4 space-y-4"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Palette,null),t('defaultTheme')||'Default Theme'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},t('defaultThemeDesc')||'Set the default theme for new users. Users can change their theme in My Profile.'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-2"},Object.entries(PEGAPROX_THEMES).map(([key,theme])=>{const isActive=(serverSettings.default_theme||'proxmoxDark')===key;return/*#__PURE__*/React.createElement("button",{key:key,onClick:()=>setServerSettings({...serverSettings,default_theme:key}),className:`p-2 rounded-lg border-2 transition-all hover:scale-105 ${isActive?'border-proxmox-orange ring-2 ring-proxmox-orange/30':'border-proxmox-border hover:border-gray-500'}`,title:theme.name},/*#__PURE__*/React.createElement("div",{className:"h-8 rounded mb-1 relative overflow-hidden",style:{background:theme.colors.darker,border:`1px solid ${theme.colors.border}`}},/*#__PURE__*/React.createElement("div",{className:"absolute inset-1 rounded",style:{background:theme.colors.card}},/*#__PURE__*/React.createElement("div",{className:"w-1/2 h-1 rounded-full m-1",style:{background:theme.colors.primary}})),isActive&&/*#__PURE__*/React.createElement("div",{className:"absolute top-0 right-0 bg-proxmox-orange rounded-full p-0.5"},/*#__PURE__*/React.createElement(Icons.Check,{className:"w-2 h-2 text-white"}))),/*#__PURE__*/React.createElement("div",{className:"text-center text-xs truncate"},theme.icon));})),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},t('currentDefault')||'Current default',": ",PEGAPROX_THEMES[serverSettings.default_theme||'proxmoxDark']?.name||'Proxmox Dark')),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4 space-y-4"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Globe,null),t('networkSettings')),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('domain')),/*#__PURE__*/React.createElement("input",{type:"text",value:serverSettings.domain,onChange:e=>setServerSettings({...serverSettings,domain:e.target.value}),placeholder:"pegaprox.example.com",className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-proxmox-orange"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('domainHint'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('port')),/*#__PURE__*/React.createElement("input",{type:"number",value:serverSettings.port,onChange:e=>setServerSettings({...serverSettings,port:parseInt(e.target.value)}),min:"1",max:"65535",className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-proxmox-orange"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('portHint'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('httpRedirectPort')||'HTTP Redirect Port'),/*#__PURE__*/React.createElement("input",{type:"number",value:serverSettings.http_redirect_port||0,onChange:e=>setServerSettings({...serverSettings,http_redirect_port:parseInt(e.target.value)}),min:"-1",max:"65535",className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-proxmox-orange"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('httpRedirectPortHint')||'0 = auto (80 if root), -1 = disabled')))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4 space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Shield,null),t('sslSettings')),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:serverSettings.ssl_enabled,onChange:e=>setServerSettings({...serverSettings,ssl_enabled:e.target.checked}),className:"rounded border-proxmox-border bg-proxmox-darker"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},t('enableSsl')))),serverSettings.ssl_enabled&&/*#__PURE__*/React.createElement("div",{className:"space-y-4 pt-2"},/*#__PURE__*/React.createElement("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg"},/*#__PURE__*/React.createElement("p",{className:"text-sm text-yellow-400"},"\u26A0\uFE0F ",t('sslWarning'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('sslCertificate')," (.pem, .crt)"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"text",value:serverSettings.ssl_cert,readOnly:true,placeholder:t('noCertSelected'),className:"flex-1 px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"}),/*#__PURE__*/React.createElement("label",{className:"px-4 py-2 bg-proxmox-hover hover:bg-proxmox-border rounded-lg text-sm cursor-pointer transition-colors"},/*#__PURE__*/React.createElement("input",{type:"file",accept:".pem,.crt,.cer",onChange:e=>handleCertFileChange(e,'cert'),className:"hidden"}),t('browse')))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('sslKey')," (.pem, .key)"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"text",value:serverSettings.ssl_key,readOnly:true,placeholder:t('noKeySelected'),className:"flex-1 px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"}),/*#__PURE__*/React.createElement("label",{className:"px-4 py-2 bg-proxmox-hover hover:bg-proxmox-border rounded-lg text-sm cursor-pointer transition-colors"},/*#__PURE__*/React.createElement("input",{type:"file",accept:".pem,.key",onChange:e=>handleCertFileChange(e,'key'),className:"hidden"}),t('browse')))),/*#__PURE__*/React.createElement("div",{className:"p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg"},/*#__PURE__*/React.createElement("p",{className:"text-sm text-blue-400"},"\uD83D\uDCA1 ",t('sslHint'))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4 space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Mail,null),t('smtpSettings')),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:serverSettings.smtp_enabled,onChange:e=>setServerSettings({...serverSettings,smtp_enabled:e.target.checked}),className:"rounded border-proxmox-border bg-proxmox-darker"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},t('enabled')))),serverSettings.smtp_enabled&&/*#__PURE__*/React.createElement("div",{className:"space-y-4 pt-2"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('smtpHost')),/*#__PURE__*/React.createElement("input",{type:"text",value:serverSettings.smtp_host,onChange:e=>setServerSettings({...serverSettings,smtp_host:e.target.value}),placeholder:"smtp.gmail.com",className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('smtpPort')),/*#__PURE__*/React.createElement("input",{type:"number",value:serverSettings.smtp_port,onChange:e=>setServerSettings({...serverSettings,smtp_port:parseInt(e.target.value)}),className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('smtpUser')),/*#__PURE__*/React.createElement("input",{type:"text",value:serverSettings.smtp_user,onChange:e=>setServerSettings({...serverSettings,smtp_user:e.target.value}),placeholder:"user@example.com",className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('smtpPassword')),/*#__PURE__*/React.createElement("input",{type:"password",value:serverSettings.smtp_password,onChange:e=>setServerSettings({...serverSettings,smtp_password:e.target.value}),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('smtpFromEmail')),/*#__PURE__*/React.createElement("input",{type:"email",value:serverSettings.smtp_from_email,onChange:e=>setServerSettings({...serverSettings,smtp_from_email:e.target.value}),placeholder:"noreply@example.com",className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('smtpFromName')),/*#__PURE__*/React.createElement("input",{type:"text",value:serverSettings.smtp_from_name,onChange:e=>setServerSettings({...serverSettings,smtp_from_name:e.target.value}),placeholder:"PegaProx Alerts",className:"w-full px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"}))),/*#__PURE__*/React.createElement("div",{className:"flex gap-6"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:serverSettings.smtp_tls,onChange:e=>setServerSettings({...serverSettings,smtp_tls:e.target.checked,smtp_ssl:e.target.checked?false:serverSettings.smtp_ssl}),className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},t('smtpTls')," (STARTTLS)")),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:serverSettings.smtp_ssl,onChange:e=>setServerSettings({...serverSettings,smtp_ssl:e.target.checked,smtp_tls:e.target.checked?false:serverSettings.smtp_tls}),className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},t('smtpSsl')," (SSL/TLS)"))),/*#__PURE__*/React.createElement("div",{className:"pt-3 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('testEmail')),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"email",value:testEmailAddress,onChange:e=>setTestEmailAddress(e.target.value),placeholder:"test@example.com",className:"flex-1 px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"}),/*#__PURE__*/React.createElement("button",{onClick:handleTestEmail,disabled:testEmailLoading||!serverSettings.smtp_host,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm font-medium transition-colors disabled:opacity-50"},testEmailLoading?'...':t('testEmail')))),/*#__PURE__*/React.createElement("div",{className:"pt-3 flex justify-end"},/*#__PURE__*/React.createElement("button",{onClick:handleSaveSMTPSettings,disabled:smtpLoading,className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm font-medium transition-colors disabled:opacity-50 flex items-center gap-2"},smtpLoading&&/*#__PURE__*/React.createElement(Icons.Loader,{className:"w-4 h-4 animate-spin"}),t('saveSmtpSettings')||'Save SMTP Settings'))),!serverSettings.smtp_enabled&&/*#__PURE__*/React.createElement("div",{className:"pt-3 flex justify-end border-t border-proxmox-border mt-3"},/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mr-auto my-auto"},t('enableSmtpHint')||'Enable SMTP to configure email settings'),/*#__PURE__*/React.createElement("button",{onClick:handleSaveSMTPSettings,disabled:smtpLoading,className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm font-medium transition-colors disabled:opacity-50 flex items-center gap-2"},smtpLoading&&/*#__PURE__*/React.createElement(Icons.Loader,{className:"w-4 h-4 animate-spin"}),t('save')||'Save'))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-4 space-y-4"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Bell,null),t('emailRecipients')),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},t('alertsDesc')),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},(serverSettings.alert_email_recipients||[]).map((email,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:"flex-1 px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"},email),/*#__PURE__*/React.createElement("button",{onClick:()=>setServerSettings({...serverSettings,alert_email_recipients:serverSettings.alert_email_recipients.filter((_,i)=>i!==idx)}),className:"p-2 text-red-400 hover:text-red-300"},/*#__PURE__*/React.createElement(Icons.Trash,null)))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"email",id:"newRecipientEmail",placeholder:"admin@example.com",className:"flex-1 px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"}),/*#__PURE__*/React.createElement("button",{onClick:()=>{const input=document.getElementById('newRecipientEmail');if(input.value&&input.value.includes('@')){setServerSettings({...serverSettings,alert_email_recipients:[...(serverSettings.alert_email_recipients||[]),input.value]});input.value='';}},className:"px-4 py-2 bg-proxmox-hover hover:bg-proxmox-border rounded-lg text-sm"},t('addRecipient')))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('alertCooldown')),/*#__PURE__*/React.createElement("input",{type:"number",value:serverSettings.alert_cooldown,onChange:e=>setServerSettings({...serverSettings,alert_cooldown:parseInt(e.target.value)}),min:"60",className:"w-32 px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded-lg text-white text-sm"}),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 ml-2"},"(min 60s)"))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3"},/*#__PURE__*/React.createElement("button",{onClick:handleSaveServerSettings,disabled:serverLoading,className:"flex items-center gap-2 px-6 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm font-medium transition-colors disabled:opacity-50"},serverLoading?/*#__PURE__*/React.createElement(Icons.RotateCw,null):/*#__PURE__*/React.createElement(Icons.Save,null),t('saveSettings'))),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-red-500/10 border border-red-500/30 rounded-xl"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.RefreshCw,null),t('restartServer')),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mt-1"},t('restartServerDesc'))),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowRestartConfirm(true),className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm font-medium transition-colors"},/*#__PURE__*/React.createElement(Icons.Power,null),t('restartNow')))),/*#__PURE__*/React.createElement("div",{className:"p-4 bg-proxmox-dark border border-proxmox-border rounded-xl"},/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white mb-2"},t('restartInfo')),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},t('restartInfoDesc')))),showRestartConfirm&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/80"},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-md bg-proxmox-card border border-red-500/30 rounded-xl overflow-hidden animate-scale-in"},/*#__PURE__*/React.createElement("div",{className:"p-6 border-b border-red-500/30 bg-red-500/10"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"p-3 rounded-full bg-red-500/20"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white"},t('confirmRestart')),/*#__PURE__*/React.createElement("p",{className:"text-sm text-red-400"},t('restartWarning'))))),/*#__PURE__*/React.createElement("div",{className:"p-6"},/*#__PURE__*/React.createElement("p",{className:"text-gray-300 mb-4"},t('restartConfirmText')),/*#__PURE__*/React.createElement("ul",{className:"text-sm text-gray-400 space-y-1 mb-4"},/*#__PURE__*/React.createElement("li",null,"\u2022 ",t('restartEffect1')),/*#__PURE__*/React.createElement("li",null,"\u2022 ",t('restartEffect2')),/*#__PURE__*/React.createElement("li",null,"\u2022 ",t('restartEffect3')))),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-proxmox-border bg-proxmox-dark"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowRestartConfirm(false),className:"px-4 py-2 text-gray-300 hover:text-white"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:handleRestartServer,disabled:restartLoading,className:"flex items-center gap-2 px-4 py-2 bg-red-600 rounded-lg text-white hover:bg-red-700 disabled:opacity-50"},restartLoading?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Icons.RotateCw,null),t('restarting')):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Icons.Power,null),t('yesRestart')))))),activeTab==='audit'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between gap-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("select",{value:userFilter,onChange:e=>setUserFilter(e.target.value),className:"px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-sm text-white focus:outline-none focus:border-proxmox-orange"},/*#__PURE__*/React.createElement("option",{value:""},t('allUsers')),uniqueUsers.map(u=>/*#__PURE__*/React.createElement("option",{key:u,value:u},u))),/*#__PURE__*/React.createElement("select",{value:actionFilter,onChange:e=>setActionFilter(e.target.value),className:"px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-sm text-white focus:outline-none focus:border-proxmox-orange"},/*#__PURE__*/React.createElement("option",{value:""},t('allActions')),uniqueActions.map(a=>/*#__PURE__*/React.createElement("option",{key:a,value:a},getActionLabel(a))))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:fetchAuditLogs,className:"flex items-center gap-2 px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-sm text-gray-300 hover:text-white hover:border-proxmox-orange transition-colors"},/*#__PURE__*/React.createElement(Icons.RefreshCw,null),t('refreshAuditLog')),/*#__PURE__*/React.createElement("button",{onClick:exportAuditLog,className:"flex items-center gap-2 px-3 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm font-medium transition-colors"},/*#__PURE__*/React.createElement(Icons.Download,null),t('exportAuditLog')))),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},t('auditLogDescription')),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"max-h-[400px] overflow-auto"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"sticky top-0 bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",{className:"border-b border-proxmox-border"},/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase"},t('timestamp')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase"},t('usernameLabel')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase"},t('cluster')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase"},t('action')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase"},t('details')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase"},t('ipAddress')))),/*#__PURE__*/React.createElement("tbody",null,filteredLogs.length===0?/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:"6",className:"px-4 py-8 text-center text-gray-400"},t('noAuditLogs'))):filteredLogs.map((log,idx)=>/*#__PURE__*/React.createElement("tr",{key:idx,className:"border-b border-gray-700/50 hover:bg-proxmox-hover"},/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-gray-400 text-sm whitespace-nowrap"},new Date(log.timestamp).toLocaleString()),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-white font-medium"},log.user),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-sm"},log.cluster?/*#__PURE__*/React.createElement("span",{className:"px-2 py-1 rounded bg-proxmox-dark border border-proxmox-border text-proxmox-orange text-xs"},log.cluster):/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"-")),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-1 rounded text-xs font-medium ${log.action.includes('login')?'bg-green-500/10 text-green-400':log.action.includes('logout')?'bg-yellow-500/10 text-yellow-400':log.action.includes('delete')?'bg-red-500/10 text-red-400':log.action.includes('create')||log.action.includes('added')?'bg-blue-500/10 text-blue-400':'bg-gray-500/10 text-gray-400'}`},getActionLabel(log.action))),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-gray-300 text-sm max-w-xs truncate",title:log.details},log.details||'-'),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-gray-400 text-sm font-mono"},log.ip_address||'-')))))))),activeTab==='updates'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Package,null),"Current Version"),/*#__PURE__*/React.createElement("div",{className:"mt-2 space-y-1"},/*#__PURE__*/React.createElement("p",{className:"text-2xl font-bold text-proxmox-orange"},"PegaProx ",updateInfo?.current_version||PEGAPROX_VERSION),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},"Build: ",updateInfo?.current_build||'2026.01'))),/*#__PURE__*/React.createElement("button",{onClick:checkForUpdates,disabled:updateLoading,className:"flex items-center gap-2 px-4 py-2 bg-proxmox-orange hover:bg-orange-600 disabled:bg-gray-600 rounded-lg text-sm font-medium transition-colors"},updateLoading?/*#__PURE__*/React.createElement(Icons.Loader,{className:"animate-spin"}):/*#__PURE__*/React.createElement(Icons.RefreshCw,null),"Check for Updates"))),updateError&&/*#__PURE__*/React.createElement("div",{className:"bg-red-500/10 border border-red-500/30 rounded-xl p-4 flex items-center gap-3"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"text-red-400"}),/*#__PURE__*/React.createElement("span",{className:"text-red-400"},updateError)),updateInfo?.update_available&&/*#__PURE__*/React.createElement("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-6"},/*#__PURE__*/React.createElement("div",{className:"flex items-start justify-between"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-green-400 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Download,null),t('updateAvailable')||'Update Available!'),/*#__PURE__*/React.createElement("p",{className:"text-2xl font-bold text-white mt-2"},"Version ",updateInfo.latest_version),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mt-1"},t('released')||'Released',": ",updateInfo.release_date||'Unknown')),/*#__PURE__*/React.createElement("button",{onClick:performUpdate,disabled:updateLoading||updateProgress,className:"flex items-center gap-2 px-6 py-3 bg-green-500 hover:bg-green-600 disabled:bg-gray-600 rounded-lg font-medium transition-colors"},updateLoading?/*#__PURE__*/React.createElement(Icons.Loader,{className:"animate-spin"}):/*#__PURE__*/React.createElement(Icons.Download,null),t('installUpdate')||'Install Update')),updateInfo.changelog&&updateInfo.changelog.length>0&&/*#__PURE__*/React.createElement("div",{className:"mt-4 pt-4 border-t border-green-500/30"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-gray-300 mb-2"},t('whatsNew')||"What's New",":"),/*#__PURE__*/React.createElement("ul",{className:"space-y-1"},updateInfo.changelog.map((item,idx)=>/*#__PURE__*/React.createElement("li",{key:idx,className:"text-sm text-gray-400 flex items-start gap-2"},/*#__PURE__*/React.createElement("span",{className:"text-green-400 mt-1"},"\u2022"),item)))),updateInfo.breaking_changes&&updateInfo.breaking_changes.length>0&&/*#__PURE__*/React.createElement("div",{className:"mt-4 pt-4 border-t border-yellow-500/30 bg-yellow-500/5 rounded-lg p-3"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-yellow-400 mb-2 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,null),t('breakingChanges')||'Breaking Changes',":"),/*#__PURE__*/React.createElement("ul",{className:"space-y-1"},updateInfo.breaking_changes.map((item,idx)=>/*#__PURE__*/React.createElement("li",{key:idx,className:"text-sm text-yellow-300"},item))))),updateProgress&&/*#__PURE__*/React.createElement("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-6"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("div",{className:"relative"},/*#__PURE__*/React.createElement(Icons.Loader,{className:"w-8 h-8 text-blue-400 animate-spin"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-blue-400"},updateProgress.status==='downloading'&&(t('downloadingUpdate')||'Downloading Update...'),updateProgress.status==='installing'&&(t('installingUpdate')||'Installing Update...'),updateProgress.status==='restarting'&&(t('serverRestarting')||'Server Restarting...'),updateProgress.status==='reconnecting'&&(t('reconnecting')||'Reconnecting...'),updateProgress.status==='restoring'&&(t('restoringBackup')||'Restoring from Backup...')),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mt-1"},updateProgress.message))),/*#__PURE__*/React.createElement("div",{className:"mt-4 w-full bg-proxmox-dark rounded-full h-2 overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"h-full bg-blue-500 animate-pulse",style:{width:'100%'}})),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-2"},t('doNotCloseWindow')||'Please do not close this window...')),updateInfo&&!updateInfo.update_available&&!updateInfo.error&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-6 text-center"},/*#__PURE__*/React.createElement(Icons.CheckCircle,{className:"w-12 h-12 text-green-400 mx-auto mb-3"}),/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white"},"You're up to date!"),/*#__PURE__*/React.createElement("p",{className:"text-gray-400 mt-1"},"PegaProx ",updateInfo.current_version," is the latest version.")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.RotateCcw,null),t('rollback')||'Rollback'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mt-1"},t('rollbackDesc')||'Restore a previous version from backup')),/*#__PURE__*/React.createElement("button",{onClick:()=>{loadBackups();setShowRollbackModal(true);},disabled:updateLoading||updateProgress,className:"flex items-center gap-2 px-4 py-2 bg-yellow-600 hover:bg-yellow-700 disabled:bg-gray-600 rounded-lg text-sm font-medium transition-colors"},/*#__PURE__*/React.createElement(Icons.RotateCcw,null),t('viewBackups')||'View Backups'))),updateInfo?.instructions&&/*#__PURE__*/React.createElement("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-blue-400 flex items-center gap-2 mb-4"},/*#__PURE__*/React.createElement(Icons.FileText,null),"Update Instructions"),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-4 font-mono text-sm"},updateInfo.instructions.map((line,idx)=>/*#__PURE__*/React.createElement("p",{key:idx,className:`${line.startsWith('#')?'text-gray-500':'text-gray-300'} ${line===''?'h-4':''}`},line||'\u00A0'))),updateInfo.backup_path&&/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mt-3"},"\u2713 Backup created: ",/*#__PURE__*/React.createElement("code",{className:"text-green-400"},updateInfo.backup_path)),updateInfo.download_url&&/*#__PURE__*/React.createElement("a",{href:updateInfo.download_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 mt-4 px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded-lg text-sm font-medium transition-colors"},/*#__PURE__*/React.createElement(Icons.ExternalLink,null),"Open GitHub Release")),/*#__PURE__*/React.createElement("div",{className:"text-center text-sm text-gray-500"},/*#__PURE__*/React.createElement("a",{href:"https://github.com/PegaProx/project-pegaprox",target:"_blank",rel:"noopener noreferrer",className:"hover:text-proxmox-orange transition-colors inline-flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.Github,null),"View on GitHub"))),activeTab==='support'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Package,{className:"w-5 h-5 text-proxmox-orange"}),t('supportBundle')||'Support Bundle'),/*#__PURE__*/React.createElement("p",{className:"text-gray-400 text-sm mb-4"},t('supportBundleDesc')||'Generate a diagnostic bundle containing logs, configuration, and system information for troubleshooting. Sensitive data (passwords, tokens, secrets) is automatically redacted.'),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker rounded-lg p-4 mb-4"},/*#__PURE__*/React.createElement("h4",{className:"text-white font-medium mb-2"},t('bundleContents')||'Bundle Contents',":"),/*#__PURE__*/React.createElement("ul",{className:"text-sm text-gray-400 space-y-1"},/*#__PURE__*/React.createElement("li",null,"\u2022 ",t('bundleSystemInfo')||'System information (version, platform, Python)'),/*#__PURE__*/React.createElement("li",null,"\u2022 ",t('bundleClusterStatus')||'Cluster connection status'),/*#__PURE__*/React.createElement("li",null,"\u2022 ",t('bundleAuditLogs')||'Recent audit log entries (last 500)'),/*#__PURE__*/React.createElement("li",null,"\u2022 ",t('bundleAppLogs')||'Application logs (last 1000 lines)'),/*#__PURE__*/React.createElement("li",null,"\u2022 ",t('bundleDbSchema')||'Database schema and statistics'),/*#__PURE__*/React.createElement("li",null,"\u2022 ",t('bundleServerSettings')||'Server settings (passwords redacted)'),/*#__PURE__*/React.createElement("li",null,"\u2022 ",t('bundleUserList')||'User list (no sensitive data)'),/*#__PURE__*/React.createElement("li",null,"\u2022 ",t('bundleRecentTasks')||'Recent Proxmox tasks'),/*#__PURE__*/React.createElement("li",null,"\u2022 ",t('bundleSseStats')||'SSE/SSH connection statistics'))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{try{addToast(t('generatingBundle')||'Generating support bundle...','info');const response=await fetch(`${API_URL}/support-bundle`,{method:'GET',credentials:'include'});if(response.ok){const blob=await response.blob();const url=window.URL.createObjectURL(blob);const a=document.createElement('a');const disposition=response.headers.get('Content-Disposition');const filename=disposition?disposition.split('filename=')[1]?.replace(/"/g,''):`pegaprox_support_${new Date().toISOString().slice(0,10)}.zip`;a.href=url;a.download=filename;document.body.appendChild(a);a.click();window.URL.revokeObjectURL(url);a.remove();addToast(t('bundleDownloaded')||'Support bundle downloaded successfully','success');}else{// Try to parse JSON error, but handle text/HTML responses too
try{const err=await response.json();addToast(err.error||'Failed to generate bundle','error');}catch{addToast(`Server error: ${response.status} ${response.statusText}`,'error');}}}catch(e){console.error('Support bundle error:',e);addToast(t('bundleError')||'Failed to generate support bundle','error');}},className:"flex items-center gap-2 px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm font-medium transition-colors"},/*#__PURE__*/React.createElement(Icons.Download,{className:"w-4 h-4"}),t('downloadBundle')||'Download Support Bundle'),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},t('bundleSize')||'Typical size: 50-500 KB'))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.LifeBuoy,{className:"w-5 h-5 text-blue-400"}),t('supportResources')||'Support Resources'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("a",{href:"https://github.com/PegaProx/project-pegaprox/issues",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-4 bg-proxmox-darker rounded-lg hover:bg-proxmox-border/50 transition-colors"},/*#__PURE__*/React.createElement("div",{className:"w-10 h-10 rounded-lg bg-gray-500/20 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Github,{className:"w-5 h-5 text-gray-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},t('reportIssue')||'Report an Issue'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},"GitHub Issues")),/*#__PURE__*/React.createElement(Icons.ExternalLink,{className:"w-4 h-4 text-gray-500 ml-auto"})),/*#__PURE__*/React.createElement("a",{href:"https://github.com/PegaProx/project-pegaprox/discussions",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-4 bg-proxmox-darker rounded-lg hover:bg-proxmox-border/50 transition-colors"},/*#__PURE__*/React.createElement("div",{className:"w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.MessageSquare,{className:"w-5 h-5 text-blue-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},t('discussions')||'Discussions'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},"Community Forum")),/*#__PURE__*/React.createElement(Icons.ExternalLink,{className:"w-4 h-4 text-gray-500 ml-auto"})),/*#__PURE__*/React.createElement("a",{href:"https://github.com/PegaProx/project-pegaprox/wiki",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-4 bg-proxmox-darker rounded-lg hover:bg-proxmox-border/50 transition-colors"},/*#__PURE__*/React.createElement("div",{className:"w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Book,{className:"w-5 h-5 text-green-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},t('documentation')||'Documentation'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},"Wiki & Guides")),/*#__PURE__*/React.createElement(Icons.ExternalLink,{className:"w-4 h-4 text-gray-500 ml-auto"})),/*#__PURE__*/React.createElement("a",{href:"https://github.com/PegaProx/project-pegaprox/releases",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-4 bg-proxmox-darker rounded-lg hover:bg-proxmox-border/50 transition-colors"},/*#__PURE__*/React.createElement("div",{className:"w-10 h-10 rounded-lg bg-proxmox-orange/20 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Download,{className:"w-5 h-5 text-proxmox-orange"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},t('releases')||'Releases'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},"Download & Changelog")),/*#__PURE__*/React.createElement(Icons.ExternalLink,{className:"w-4 h-4 text-gray-500 ml-auto"})))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Info,{className:"w-5 h-5 text-blue-400"}),t('quickSystemInfo')||'Quick System Info'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker rounded-lg p-3"},/*#__PURE__*/React.createElement("p",{className:"text-gray-400"},t('version')||'Version'),/*#__PURE__*/React.createElement("p",{className:"text-white font-medium"},PEGAPROX_VERSION)),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker rounded-lg p-3"},/*#__PURE__*/React.createElement("p",{className:"text-gray-400"},t('clusters')||'Clusters'),/*#__PURE__*/React.createElement("p",{className:"text-white font-medium"},clusters?.length||0)),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker rounded-lg p-3"},/*#__PURE__*/React.createElement("p",{className:"text-gray-400"},t('users')),/*#__PURE__*/React.createElement("p",{className:"text-white font-medium"},users?.length||0)),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker rounded-lg p-3"},/*#__PURE__*/React.createElement("p",{className:"text-gray-400"},t('browser')||'Browser'),/*#__PURE__*/React.createElement("p",{className:"text-white font-medium truncate",title:navigator.userAgent},navigator.userAgent.includes('Chrome')?'Chrome':navigator.userAgent.includes('Firefox')?'Firefox':navigator.userAgent.includes('Safari')?'Safari':navigator.userAgent.includes('Edge')?'Edge':'Other'))))),activeTab==='about'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-6 text-center"},/*#__PURE__*/React.createElement("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-2xl mb-4"},/*#__PURE__*/React.createElement("img",{src:"/images/pegaprox.png",alt:"PegaProx",className:"w-20 h-20 object-contain"})),/*#__PURE__*/React.createElement("h2",{className:"text-3xl font-bold text-white"},"PegaProx"),/*#__PURE__*/React.createElement("p",{className:"text-xl text-proxmox-orange mt-1"},PEGAPROX_VERSION),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mt-2"},"Multi-Cluster Proxmox Management"),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},"Build 2026.01 \u2022 \xA9 2025-2026 PegaProx Team")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Users,null),t('developmentTeam')||'Development Team'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker rounded-lg p-4 text-center"},/*#__PURE__*/React.createElement("div",{className:"w-12 h-12 rounded-full bg-proxmox-orange/20 flex items-center justify-center mx-auto mb-2"},/*#__PURE__*/React.createElement("span",{className:"text-proxmox-orange font-bold"},"NS")),/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},"Nico Schmidt"),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},"Lead Developer & Founder")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker rounded-lg p-4 text-center"},/*#__PURE__*/React.createElement("div",{className:"w-12 h-12 rounded-full bg-blue-500/20 flex items-center justify-center mx-auto mb-2"},/*#__PURE__*/React.createElement("span",{className:"text-blue-400 font-bold"},"MK")),/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},"Marcus Kellermann"),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},"Backend Developer")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker rounded-lg p-4 text-center"},/*#__PURE__*/React.createElement("div",{className:"w-12 h-12 rounded-full bg-pink-500/20 flex items-center justify-center mx-auto mb-2"},/*#__PURE__*/React.createElement("span",{className:"text-pink-400 font-bold"},"LW")),/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},"Laura Weber"),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},"Frontend Developer")))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Heart,null),t('creditsAcknowledgments')||'Credits & Acknowledgments'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-4"},/*#__PURE__*/React.createElement("div",{className:"w-12 h-12 rounded-lg bg-green-500/20 flex items-center justify-center flex-shrink-0"},/*#__PURE__*/React.createElement(Icons.Scale,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},t('proxlbCredit')||'ProxLB by gyptazy'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mt-1"},t('proxlbCreditDesc')||'Our load balancing functionality is based on the excellent work from ProxLB. Special thanks to gyptazy for creating and open-sourcing this amazing tool!'),/*#__PURE__*/React.createElement("a",{href:"https://github.com/gyptazy/ProxLB",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-proxmox-orange hover:underline mt-2"},/*#__PURE__*/React.createElement(Icons.Github,{className:"w-4 h-4"}),"github.com/gyptazy/ProxLB",/*#__PURE__*/React.createElement(Icons.ExternalLink,{className:"w-3 h-3"}))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker rounded-lg p-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-4"},/*#__PURE__*/React.createElement("div",{className:"w-12 h-12 rounded-lg bg-blue-500/20 flex items-center justify-center flex-shrink-0"},/*#__PURE__*/React.createElement(Icons.Camera,null)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},"ProxSnap by gyptazy"),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mt-1"},"The snapshot overview feature was inspired by ProxSnap - a powerful CLI tool for managing Proxmox snapshots. Thanks to gyptazy for the great contribution!"),/*#__PURE__*/React.createElement("a",{href:"https://github.com/gyptazy/ProxSnap",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-proxmox-orange hover:underline mt-2"},/*#__PURE__*/React.createElement(Icons.Github,{className:"w-4 h-4"}),"github.com/gyptazy/ProxSnap",/*#__PURE__*/React.createElement(Icons.ExternalLink,{className:"w-3 h-3"}))))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-center text-sm"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker rounded-lg p-3"},/*#__PURE__*/React.createElement("p",{className:"text-gray-400"},"Proxmox VE"),/*#__PURE__*/React.createElement("p",{className:"text-white font-medium"},"API Integration")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker rounded-lg p-3"},/*#__PURE__*/React.createElement("p",{className:"text-gray-400"},"noVNC"),/*#__PURE__*/React.createElement("p",{className:"text-white font-medium"},"Console Access")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker rounded-lg p-3"},/*#__PURE__*/React.createElement("p",{className:"text-gray-400"},"xterm.js"),/*#__PURE__*/React.createElement("p",{className:"text-white font-medium"},"Terminal Emulator")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-darker rounded-lg p-3"},/*#__PURE__*/React.createElement("p",{className:"text-gray-400"},"React"),/*#__PURE__*/React.createElement("p",{className:"text-white font-medium"},"UI Framework"))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-6"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Link,null),t('links')||'Links'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3"},/*#__PURE__*/React.createElement("a",{href:"https://pegaprox.com",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-3 bg-proxmox-darker rounded-lg hover:bg-proxmox-hover transition-colors"},/*#__PURE__*/React.createElement(Icons.Globe,{className:"text-proxmox-orange"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},"pegaprox.com")),/*#__PURE__*/React.createElement("a",{href:"https://github.com/PegaProx/project-pegaprox",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-3 bg-proxmox-darker rounded-lg hover:bg-proxmox-hover transition-colors"},/*#__PURE__*/React.createElement(Icons.Github,{className:"text-gray-400"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},"GitHub")),/*#__PURE__*/React.createElement("a",{href:"https://docs.pegaprox.com",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-3 bg-proxmox-darker rounded-lg hover:bg-proxmox-hover transition-colors"},/*#__PURE__*/React.createElement(Icons.Book,{className:"text-blue-400"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},"Documentation")),/*#__PURE__*/React.createElement("a",{href:"mailto:sponsor@pegaprox.com",className:"flex items-center gap-2 p-3 bg-proxmox-darker rounded-lg hover:bg-proxmox-hover transition-colors"},/*#__PURE__*/React.createElement(Icons.Heart,{className:"text-pink-400"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},"Sponsor")))),/*#__PURE__*/React.createElement("div",{className:"text-center text-sm text-gray-500 space-y-1"},/*#__PURE__*/React.createElement("p",null,"PegaProx is open source software licensed under the AGPL-3.0 License."),/*#__PURE__*/React.createElement("p",null,"Made with \u2764\uFE0F in Austria and Germany"),/*#__PURE__*/React.createElement("p",null,"\xA9 2025-2026 PegaProx Team")))))),showRollbackModal&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/80",onClick:()=>setShowRollbackModal(false)},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-lg bg-proxmox-card border border-proxmox-border rounded-xl shadow-2xl overflow-hidden",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex items-center justify-between"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.RotateCcw,{className:"text-yellow-400"}),t('selectBackup')||'Select Backup to Restore'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowRollbackModal(false),className:"p-1 hover:bg-proxmox-dark rounded"},/*#__PURE__*/React.createElement(Icons.X,null))),/*#__PURE__*/React.createElement("div",{className:"p-4 max-h-[400px] overflow-y-auto"},availableBackups.length===0?/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},/*#__PURE__*/React.createElement(Icons.Archive,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),/*#__PURE__*/React.createElement("p",null,t('noBackupsFound')||'No backups found')):/*#__PURE__*/React.createElement("div",{className:"space-y-2"},availableBackups.map((backup,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"bg-proxmox-dark border border-proxmox-border rounded-lg p-4 hover:border-yellow-500/50 transition-colors"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("p",{className:"font-medium text-white"},backup.name),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('created')||'Created',": ",new Date(backup.created).toLocaleString()),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},t('files')||'Files',": ",backup.files?.join(', ')||'unknown')),/*#__PURE__*/React.createElement("button",{onClick:()=>performRollback(backup.name),disabled:updateLoading,className:"px-3 py-1.5 bg-yellow-600 hover:bg-yellow-700 disabled:bg-gray-600 rounded-lg text-sm font-medium transition-colors"},t('restore')||'Restore')))))),/*#__PURE__*/React.createElement("div",{className:"p-4 border-t border-proxmox-border bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 text-center"},t('rollbackWarning')||'âš ï¸ Rollback will restart the server. Make sure you have saved any unsaved work.')))));}// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PegaProx - Dashboard & App
// TaskBar, Dashboard, App component, ReactDOM.render
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Task Bar Component with Task Viewer
function TaskBar({tasks,onClear,onClose,onCancel,onRefresh,clusterId,autoExpandEnabled=true}){const{t}=useTranslation();const[expanded,setExpanded]=useState(false);const[selectedTask,setSelectedTask]=useState(null);const[taskLog,setTaskLog]=useState('');const[taskLogLoading,setTaskLogLoading]=useState(false);const[filter,setFilter]=useState('all');// all, running, error, today
const{getAuthHeaders}=useAuth();const prevRunningCount=React.useRef(0);// LW: Resizable height - Feb 2026
const[height,setHeight]=useState(()=>{const saved=localStorage.getItem('pegaprox-taskbar-height');return saved?parseInt(saved):384;// default h-96 = 384px
});const[isResizing,setIsResizing]=useState(false);const resizeRef=React.useRef(null);// Ensure tasks is an array
const safeTasks=Array.isArray(tasks)?tasks:[];const runningCount=safeTasks.filter(task=>task&&task.status==='running').length;const failedCount=safeTasks.filter(task=>task&&(task.status==='failed'||task.status==='error')).length;// NS: Auto-expand when new task starts (if enabled in user preferences)
React.useEffect(()=>{if(autoExpandEnabled&&runningCount>prevRunningCount.current&&runningCount>0){setExpanded(true);}prevRunningCount.current=runningCount;},[runningCount,autoExpandEnabled]);// NS: Handle resize drag
React.useEffect(()=>{if(!isResizing)return;// Set cursor on body during resize
document.body.style.cursor='ns-resize';document.body.style.userSelect='none';const handleMouseMove=e=>{const newHeight=window.innerHeight-e.clientY;// Limit between 150px and 80% of viewport
const clampedHeight=Math.max(150,Math.min(newHeight,window.innerHeight*0.8));setHeight(clampedHeight);};const handleMouseUp=()=>{setIsResizing(false);document.body.style.cursor='';document.body.style.userSelect='';// Save to localStorage
localStorage.setItem('pegaprox-taskbar-height',height.toString());};document.addEventListener('mousemove',handleMouseMove);document.addEventListener('mouseup',handleMouseUp);return()=>{document.removeEventListener('mousemove',handleMouseMove);document.removeEventListener('mouseup',handleMouseUp);document.body.style.cursor='';document.body.style.userSelect='';};},[isResizing,height]);// Filter tasks
const filteredTasks=safeTasks.filter(task=>{if(!task)return false;if(filter==='running')return task.status==='running';if(filter==='error')return task.status==='failed'||task.status==='error';if(filter==='today'){const today=new Date();today.setHours(0,0,0,0);return task.starttime&&task.starttime*1000>=today.getTime();}return true;});const formatTaskType=type=>{if(!type)return'Task';const types={'qmigrate':'VM Migration','vzmigrate':'CT Migration','qmstart':'VM Start','vzstart':'CT Start','qmstop':'VM Stop','vzstop':'CT Stop','qmshutdown':'VM Shutdown','vzshutdown':'CT Shutdown','qmreboot':'VM Reboot','vzreboot':'CT Reboot','qmcreate':'VM Create','vzcreate':'CT Create','qmdestroy':'VM Delete','vzdestroy':'CT Delete','qmclone':'VM Clone','vzclone':'CT Clone','qmsnapshot':'Snapshot','vzsnapshot':'Snapshot','imgcopy':'Disk Copy','move_volume':'Disk Move','resize':'Disk Resize','download':'Download','vzdump':'Backup','qmrestore':'Restore','vzrestore':'Restore'};return types[type]||type;};const formatDuration=(start,end)=>{if(!start)return'-';const endTime=end||Math.floor(Date.now()/1000);const duration=endTime-start;const hours=Math.floor(duration/3600);const mins=Math.floor(duration%3600/60);const secs=duration%60;if(hours>0)return`${hours}h ${mins}m ${secs}s`;if(mins>0)return`${mins}m ${secs}s`;return`${secs}s`;};// Fetch task log
const fetchTaskLog=async task=>{if(!task||!task.node||!task.upid||!clusterId)return;setTaskLogLoading(true);setTaskLog('');try{const response=await fetch(`${API_URL}/clusters/${clusterId}/nodes/${task.node}/tasks/${encodeURIComponent(task.upid)}/log`,{headers:getAuthHeaders()});if(response.ok){const data=await response.json();setTaskLog(data.log||t('noOutput'));}else{setTaskLog(t('errorLoadingLog'));}}catch(err){setTaskLog(t('errorLoadingLog'));}finally{setTaskLogLoading(false);}};// Open task detail
const openTaskDetail=task=>{setSelectedTask(task);fetchTaskLog(task);};return/*#__PURE__*/React.createElement("div",{className:`fixed bottom-0 left-0 right-0 z-40 transition-all ${isResizing?'':'duration-300'}`,style:{height:expanded?`${height}px`:'40px'}},expanded&&/*#__PURE__*/React.createElement("div",{className:"absolute top-0 left-0 right-0 h-2 cursor-ns-resize group z-10",onMouseDown:e=>{e.preventDefault();setIsResizing(true);},title:t('dragToResize')||'Drag to resize'},/*#__PURE__*/React.createElement("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-16 h-1 bg-gray-600 rounded-full group-hover:bg-proxmox-orange transition-colors"})),selectedTask&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70",onClick:()=>setSelectedTask(null)},/*#__PURE__*/React.createElement("div",{className:"w-full max-w-3xl bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between p-4 border-b border-proxmox-border bg-proxmox-dark"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("span",{className:`w-3 h-3 rounded-full ${selectedTask.status==='running'?'bg-blue-500 animate-pulse':selectedTask.status==='failed'||selectedTask.status==='error'?'bg-red-500':'bg-green-500'}`}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-white font-semibold"},formatTaskType(selectedTask.type)," ",selectedTask.vmid?`(${selectedTask.vmid})`:''),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-400"},selectedTask.node," \u2022 ",selectedTask.pegaprox_user||(selectedTask.user?selectedTask.user.split('@')[0]:'-')))),/*#__PURE__*/React.createElement("button",{onClick:()=>setSelectedTask(null),className:"p-2 hover:bg-proxmox-border rounded"},/*#__PURE__*/React.createElement(Icons.X,null))),/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border grid grid-cols-4 gap-4 text-sm"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500 block"},t('status')),/*#__PURE__*/React.createElement("span",{className:`font-medium ${selectedTask.status==='running'?'text-blue-400':selectedTask.status==='failed'||selectedTask.status==='error'?'text-red-400':'text-green-400'}`},selectedTask.status||'-')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500 block"},t('startTime')),/*#__PURE__*/React.createElement("span",{className:"text-white"},selectedTask.starttime?new Date(selectedTask.starttime*1000).toLocaleString():'-')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500 block"},t('endTime')),/*#__PURE__*/React.createElement("span",{className:"text-white"},selectedTask.endtime?new Date(selectedTask.endtime*1000).toLocaleString():'-')),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500 block"},t('duration')),/*#__PURE__*/React.createElement("span",{className:"text-white"},formatDuration(selectedTask.starttime,selectedTask.endtime)))),/*#__PURE__*/React.createElement("div",{className:"p-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-2"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-400"},t('taskOutput')),/*#__PURE__*/React.createElement("button",{onClick:()=>fetchTaskLog(selectedTask),className:"text-xs text-gray-400 hover:text-white"},/*#__PURE__*/React.createElement(Icons.RefreshCw,null))),/*#__PURE__*/React.createElement("div",{className:`h-64 overflow-auto rounded-lg font-mono text-xs p-3 ${selectedTask.status==='failed'||selectedTask.status==='error'?'bg-red-500/5 border border-red-500/20 text-red-300':'bg-proxmox-darker border border-proxmox-border text-gray-300'}`},taskLogLoading?/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},t('loading'),"..."):/*#__PURE__*/React.createElement("pre",{className:"whitespace-pre-wrap"},taskLog||selectedTask.error||selectedTask.exitstatus||t('noOutput')))),selectedTask.status==='running'&&onCancel&&/*#__PURE__*/React.createElement("div",{className:"p-4 border-t border-proxmox-border bg-proxmox-dark"},/*#__PURE__*/React.createElement("button",{onClick:()=>{onCancel(selectedTask);setSelectedTask(null);},className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white text-sm"},t('cancelTask'))))),/*#__PURE__*/React.createElement("div",{className:"h-full bg-proxmox-darker border-t border-proxmox-border flex flex-col"},/*#__PURE__*/React.createElement("div",{className:"h-10 min-h-[40px] px-4 flex items-center justify-between cursor-pointer hover:bg-proxmox-dark/50",onClick:()=>setExpanded(!expanded)},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement(Icons.Layers,null),/*#__PURE__*/React.createElement("span",{className:"font-medium"},t('tasks'))),runningCount>0&&/*#__PURE__*/React.createElement("span",{className:"px-2 py-0.5 rounded-full bg-blue-500 text-white text-xs font-medium animate-pulse flex items-center gap-1"},/*#__PURE__*/React.createElement("span",{className:"w-2 h-2 bg-white rounded-full animate-ping"}),runningCount," ",t('running')),failedCount>0&&/*#__PURE__*/React.createElement("span",{className:"px-2 py-0.5 rounded-full bg-red-500 text-white text-xs font-medium"},failedCount," ",t('failed'))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:`transition-transform ${expanded?'rotate-180':''}`},/*#__PURE__*/React.createElement(Icons.ChevronDown,null)))),expanded&&/*#__PURE__*/React.createElement("div",{className:"flex-1 flex flex-col overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"px-4 py-2 border-b border-proxmox-border flex items-center justify-between bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("select",{value:filter,onChange:e=>setFilter(e.target.value),className:"px-2 py-1 bg-proxmox-dark border border-proxmox-border rounded text-sm text-white"},/*#__PURE__*/React.createElement("option",{value:"all"},t('allTasks')),/*#__PURE__*/React.createElement("option",{value:"running"},t('runningTasks')),/*#__PURE__*/React.createElement("option",{value:"error"},t('failedTasks')),/*#__PURE__*/React.createElement("option",{value:"today"},t('todaysTasks'))),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},filteredTasks.length," ",t('tasksShown'))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},onRefresh&&/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();onRefresh();},className:"p-1.5 text-gray-400 hover:text-white hover:bg-proxmox-border rounded",title:t('refresh')},/*#__PURE__*/React.createElement(Icons.RefreshCw,null)),/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();onClear();},className:"px-2 py-1 text-xs text-gray-400 hover:text-white hover:bg-proxmox-border rounded"},t('clearCompleted')),/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();onClose();},className:"p-1.5 text-gray-400 hover:text-white hover:bg-proxmox-border rounded"},/*#__PURE__*/React.createElement(Icons.X,null)))),/*#__PURE__*/React.createElement("div",{className:"flex-1 overflow-auto bg-proxmox-darker"},/*#__PURE__*/React.createElement("table",{className:"w-full text-sm"},/*#__PURE__*/React.createElement("thead",{className:"sticky top-0 bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",{className:"border-b border-proxmox-border text-left"},/*#__PURE__*/React.createElement("th",{className:"px-4 py-2 text-gray-400 font-medium w-10"}),/*#__PURE__*/React.createElement("th",{className:"px-4 py-2 text-gray-400 font-medium"},t('startTime')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-2 text-gray-400 font-medium"},t('endTime')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-2 text-gray-400 font-medium"},t('node')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-2 text-gray-400 font-medium",title:t('userColumnHint')||'Shows PegaProx user if available, otherwise Proxmox user'},t('user')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-2 text-gray-400 font-medium"},t('description')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-2 text-gray-400 font-medium"},t('status')))),/*#__PURE__*/React.createElement("tbody",null,filteredTasks.length===0?/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("td",{colSpan:"7",className:"px-4 py-8 text-center text-gray-500"},t('noTasks'))):filteredTasks.map((task,idx)=>{if(!task)return null;const isRunning=task.status==='running';const isFailed=task.status==='failed'||task.status==='error';return/*#__PURE__*/React.createElement("tr",{key:task.upid||`task-${idx}`,className:"border-b border-gray-700/50 hover:bg-proxmox-dark/50 cursor-pointer",onClick:()=>openTaskDetail(task)},/*#__PURE__*/React.createElement("td",{className:"px-4 py-2"},/*#__PURE__*/React.createElement("span",{className:`inline-block w-2 h-2 rounded-full ${isRunning?'bg-blue-500 animate-pulse':isFailed?'bg-red-500':'bg-green-500'}`})),/*#__PURE__*/React.createElement("td",{className:"px-4 py-2 text-gray-400 whitespace-nowrap"},task.starttime?new Date(task.starttime*1000).toLocaleString():'-'),/*#__PURE__*/React.createElement("td",{className:"px-4 py-2 text-gray-400 whitespace-nowrap"},task.endtime?new Date(task.endtime*1000).toLocaleString():'-'),/*#__PURE__*/React.createElement("td",{className:"px-4 py-2 text-white"},task.node||'-'),/*#__PURE__*/React.createElement("td",{className:"px-4 py-2 text-gray-300",title:task.pegaprox_user?`PegaProx: ${task.pegaprox_user}\nProxmox: ${task.user||'-'}`:task.user||'-'},task.pegaprox_user||(task.user?task.user.split('@')[0]:'-'),task.pegaprox_user&&/*#__PURE__*/React.createElement("span",{className:"ml-1 text-proxmox-orange text-xs"},"\u25CF")),/*#__PURE__*/React.createElement("td",{className:"px-4 py-2 text-white"},formatTaskType(task.type),task.vmid&&/*#__PURE__*/React.createElement("span",{className:"text-gray-500 ml-1"},"(",task.vmid,")")),/*#__PURE__*/React.createElement("td",{className:"px-4 py-2"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs ${isRunning?'bg-blue-500/20 text-blue-400':isFailed?'bg-red-500/20 text-red-400':'bg-green-500/20 text-green-400'}`},task.status||'-')));})))))));}// Main Dashboard Component
// NS: This is the heart of the app, everything connects here
// State management is a bit messy but it works // shrug
// LW: Password Expiry Warning Banner - Dec 2025
// Shows a warning when user's password is about to expire or has expired
function PasswordExpiryBanner({onChangePassword}){const{t}=useTranslation();const{passwordExpiry,user}=useAuth();const[dismissed,setDismissed]=useState(false);// Don't show if no expiry info or dismissed
// NS: removed admin check here - backend now handles include_admins setting
if(!passwordExpiry||!passwordExpiry.enabled||dismissed)return null;const{expired,warning,days_until_expiry}=passwordExpiry;// only show if expired or in warning period
if(!expired&&!warning)return null;return/*#__PURE__*/React.createElement("div",{className:`px-4 py-3 ${expired?'bg-red-500/20 border-red-500/50':'bg-yellow-500/20 border-yellow-500/50'} border-b`},/*#__PURE__*/React.createElement("div",{className:"max-w-7xl mx-auto flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:`p-1.5 rounded-full ${expired?'bg-red-500/30':'bg-yellow-500/30'}`},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:`w-4 h-4 ${expired?'text-red-400':'text-yellow-400'}`})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:`font-medium ${expired?'text-red-400':'text-yellow-400'}`},expired?t('passwordExpired')||'Ihr Passwort ist abgelaufen!':(t('passwordExpiresIn')||`Ihr Passwort lÃ¤uft in ${days_until_expiry} Tagen ab`).replace('{days}',days_until_expiry)),/*#__PURE__*/React.createElement("span",{className:"text-gray-400 ml-2 text-sm"},expired?t('pleaseChangeNow')||'Bitte Ã¤ndern Sie es jetzt.':t('pleaseChangeSoon')||'Bitte Ã¤ndern Sie es rechtzeitig.'))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:onChangePassword,className:`px-4 py-1.5 rounded-lg text-sm font-medium transition-colors ${expired?'bg-red-500 hover:bg-red-600 text-white':'bg-yellow-500 hover:bg-yellow-600 text-black'}`},t('changePassword')||'Passwort Ã¤ndern'),!expired&&/*#__PURE__*/React.createElement("button",{onClick:()=>setDismissed(true),className:"p-1.5 text-gray-400 hover:text-white rounded",title:t('dismissForNow')||'SpÃ¤ter erinnern'},/*#__PURE__*/React.createElement(Icons.X,{className:"w-4 h-4"})))));}// Cluster Sidebar Item Component - NS Jan 2026
function ClusterSidebarItem({cluster,idx,selectedCluster,setSelectedCluster,nodeAlerts,clusterGroups,isAdmin,handleDeleteCluster,setShowAssignGroup,t,getAuthHeaders,fetchClusters,addToast,isCorporate,expandedSidebarClusters,toggleSidebarCluster}){const offlineNodesCount=Object.values(nodeAlerts||{}).filter(alert=>alert.cluster_id===cluster.id&&alert.status==='offline').length;const hasOfflineNodes=offlineNodesCount>0;const statusColor=cluster.connected===false?'bg-red-500':hasOfflineNodes?'bg-orange-500':cluster.status==='running'?'bg-green-500':'bg-gray-500';// LW: Feb 2026 - Corporate tree-style sidebar item with tree connectors
if(isCorporate){const isSelected=selectedCluster?.id===cluster.id;const isExpanded=expandedSidebarClusters?.[cluster.id];const clrStatusDot=cluster.connected===false?'#f54f47':hasOfflineNodes?'#efc006':cluster.status==='running'?'#60b515':'#728b9a';const clusterIcon=cluster.connected===false?/*#__PURE__*/React.createElement(Icons.Server,{className:"w-3.5 h-3.5 flex-shrink-0",style:{color:'#f54f47'}}):hasOfflineNodes?/*#__PURE__*/React.createElement(Icons.Database,{className:"w-3.5 h-3.5 flex-shrink-0",style:{color:'#efc006'}}):/*#__PURE__*/React.createElement(Icons.Database,{className:"w-3.5 h-3.5 flex-shrink-0",style:{color:'#49afd9'}});return/*#__PURE__*/React.createElement("div",{onClick:()=>setSelectedCluster(cluster),tabIndex:0,onKeyDown:e=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();setSelectedCluster(cluster);}},className:"corp-tree-item cursor-pointer flex items-center gap-1.5 pl-1 pr-2 py-0.5 text-[13px] leading-5",style:isSelected?{background:'#324f61',color:'#e9ecef'}:{color:'#adbbc4'},onMouseEnter:e=>{if(!isSelected){e.currentTarget.style.background='#29414e';e.currentTarget.style.color='#e9ecef';}},onMouseLeave:e=>{if(!isSelected){e.currentTarget.style.background='';e.currentTarget.style.color='#adbbc4';}}},/*#__PURE__*/React.createElement("span",{onClick:e=>{e.stopPropagation();toggleSidebarCluster&&toggleSidebarCluster(cluster.id);},className:"flex-shrink-0 p-0.5 hover:bg-white/10 rounded"},isExpanded?/*#__PURE__*/React.createElement(Icons.ChevronDown,{className:"w-3 h-3",style:{color:'#728b9a'}}):/*#__PURE__*/React.createElement(Icons.ChevronRight,{className:"w-3 h-3",style:{color:'#728b9a'}})),clusterIcon,/*#__PURE__*/React.createElement("span",{className:"truncate flex-1 font-medium"},cluster.name),cluster.connected===false&&/*#__PURE__*/React.createElement("span",{className:"text-[9px] px-1 py-0 font-medium",style:{background:'rgba(245,79,71,0.15)',color:'#f54f47'}},"OFFLINE"),hasOfflineNodes&&cluster.connected!==false&&/*#__PURE__*/React.createElement("span",{className:"text-[9px] px-1 py-0 font-medium",style:{background:'rgba(239,192,6,0.15)',color:'#efc006'}},offlineNodesCount,"\u26A0"),/*#__PURE__*/React.createElement("div",{className:"w-1.5 h-1.5 rounded-full flex-shrink-0",style:{background:clrStatusDot}}));}return/*#__PURE__*/React.createElement("div",{onClick:()=>setSelectedCluster(cluster),className:`card-hover cursor-pointer rounded-lg p-2 border transition-all animate-slide-up ${selectedCluster?.id===cluster.id?'bg-proxmox-orange/10 border-proxmox-orange/50':cluster.connected===false?'bg-red-500/5 border-red-500/30':hasOfflineNodes?'bg-orange-500/5 border-orange-500/30':'bg-proxmox-card border-proxmox-border hover:border-proxmox-orange/30'}`,style:{animationDelay:`${idx*30}ms`}},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("div",{className:`w-2 h-2 rounded-full flex-shrink-0 ${statusColor} ${cluster.connected===false?'animate-pulse':hasOfflineNodes?'animate-pulse':cluster.status==='running'?'status-online':''}`}),/*#__PURE__*/React.createElement("div",{className:"min-w-0"},/*#__PURE__*/React.createElement("h3",{className:"font-medium text-sm truncate"},cluster.name),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 truncate"},cluster.host))),/*#__PURE__*/React.createElement("div",{className:"flex gap-0.5 flex-shrink-0"},/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();handleDeleteCluster(cluster.id);},className:"p-1 rounded hover:bg-red-500/10 text-gray-500 hover:text-red-400 transition-colors",title:t('delete')},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-3.5 h-3.5"})),isAdmin&&/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();setShowAssignGroup(cluster);},className:"p-1 rounded hover:bg-blue-500/10 text-gray-500 hover:text-blue-400 transition-colors",title:t('assignToGroup')},/*#__PURE__*/React.createElement(Icons.FolderInput,{className:"w-3.5 h-3.5"})))),/*#__PURE__*/React.createElement("div",{className:"flex gap-1 mt-2 flex-wrap"},cluster.connected===false&&/*#__PURE__*/React.createElement("span",{className:"text-[10px] bg-red-500/10 text-red-400 px-1.5 py-0.5 rounded"},"Offline"),hasOfflineNodes&&cluster.connected!==false&&/*#__PURE__*/React.createElement("span",{className:"text-[10px] bg-orange-500/10 text-orange-400 px-1.5 py-0.5 rounded animate-pulse"},offlineNodesCount," Node",offlineNodesCount>1?'s':''," \u26A0"),cluster.dry_run&&/*#__PURE__*/React.createElement("span",{className:"text-[10px] bg-yellow-500/10 text-yellow-400 px-1.5 py-0.5 rounded"},"Dry"),cluster.auto_migrate&&/*#__PURE__*/React.createElement("span",{className:"text-[10px] bg-green-500/10 text-green-400 px-1.5 py-0.5 rounded"},"Auto"),!cluster.enabled&&/*#__PURE__*/React.createElement("span",{className:"text-[10px] bg-gray-500/10 text-gray-400 px-1.5 py-0.5 rounded"},"Paused")));}function PegaProxDashboard(){const{t}=useTranslation();const{user,sessionId,logout,getAuthHeaders,isAdmin,passwordExpiry}=useAuth();const{isCorporate}=useLayout();// LW: Feb 2026 - corporate layout
const[clusters,setClusters]=useState([]);const[clusterGroups,setClusterGroups]=useState([]);// NS Jan 2026 - for grouping
const[collapsedGroups,setCollapsedGroups]=useState({});// Track which groups are collapsed
const[showGroupManager,setShowGroupManager]=useState(false);// Group management modal
const[showAssignGroup,setShowAssignGroup]=useState(null);// Cluster to assign to group
const[selectedGroup,setSelectedGroup]=useState(null);// LW: Feb 2026 - folder overlay
const[showGroupSettings,setShowGroupSettings]=useState(null);// group settings modal
const[selectedCluster,setSelectedCluster]=useState(null);const[clusterMetrics,setClusterMetrics]=useState({});const[allClusterMetrics,setAllClusterMetrics]=useState({});// LW: metrics cache for overview page
const[topGuests,setTopGuests]=useState([]);// top vms for overview table
const[knownNodes,setKnownNodes]=useState({});// NS: Track all nodes ever seen to show offline ones
const[clusterResources,setClusterResources]=useState([]);const[lastUpdate,setLastUpdate]=useState(null);const[migrationLogs,setMigrationLogs]=useState([]);const[nodeAlerts,setNodeAlerts]=useState({});// Track node offline/online alerts
const[showAddModal,setShowAddModal]=useState(false);const[showAddDropdown,setShowAddDropdown]=useState(false);const[addClusterType,setAddClusterType]=useState('proxmox');const[showCreateVm,setShowCreateVm]=useState(null);// 'qemu' or 'lxc'
const[loading,setLoading]=useState(false);const[error,setError]=useState(null);const[toasts,setToasts]=useState([]);const[activeTab,setActiveTab]=useState('overview');const[resourcesSubTab,setResourcesSubTab]=useState('management');const[showUserMenu,setShowUserMenu]=useState(false);const[showSettings,setShowSettings]=useState(false);const[showProfile,setShowProfile]=useState(false);const[wsConnected,setWsConnected]=useState(false);const wsConnectedRef=useRef(false);// NS: Ref for health check access
const[tasks,setTasks]=useState([]);const[showUpdateNotification,setShowUpdateNotification]=useState(false);// LW: Show update modal on login
const[pendingUpdate,setPendingUpdate]=useState(null);// LW: Store update info for notification
// LW: Feb 2026 - Proxmox Backup Server state
const[pbsServers,setPbsServers]=useState([]);const[selectedPBS,setSelectedPBS]=useState(null);const[pbsStatus,setPbsStatus]=useState(null);const[pbsDatastores,setPbsDatastores]=useState([]);const[pbsSnapshots,setPbsSnapshots]=useState([]);const[pbsGroups,setPbsGroups]=useState([]);const[pbsTasks,setPbsTasks]=useState([]);const[pbsJobs,setPbsJobs]=useState({});const[pbsActiveTab,setPbsActiveTab]=useState('dashboard');const[pbsSelectedStore,setPbsSelectedStore]=useState(null);const[showAddPBS,setShowAddPBS]=useState(false);const[pbsLoading,setPbsLoading]=useState(false);const[editingPBS,setEditingPBS]=useState(null);// null = add mode, object = edit mode
const[pbsForm,setPbsForm]=useState({name:'',host:'',port:8007,user:'root@pam',password:'',api_token_id:'',api_token_secret:'',fingerprint:'',ssl_verify:false,linked_clusters:[],notes:''});const[pbsTestResult,setPbsTestResult]=useState(null);const[pbsTestLoading,setPbsTestLoading]=useState(false);const[pbsActionLoading,setPbsActionLoading]=useState({});const[pbsPruneForm,setPbsPruneForm]=useState({keep_last:3,keep_daily:7,keep_weekly:4,keep_monthly:6,keep_yearly:1,dry_run:true});const[pbsSelectedGroup,setPbsSelectedGroup]=useState(null);const[pbsTaskLog,setPbsTaskLog]=useState(null);const[pbsNamespaces,setPbsNamespaces]=useState([]);const[pbsDisks,setPbsDisks]=useState([]);const[pbsRemotes,setPbsRemotes]=useState([]);const[pbsNotifications,setPbsNotifications]=useState({targets:[],matchers:[]});const[pbsTrafficControl,setPbsTrafficControl]=useState([]);const[pbsSyslog,setPbsSyslog]=useState([]);const[pbsCatalog,setPbsCatalog]=useState([]);const[pbsCatalogPath,setPbsCatalogPath]=useState('/');const[pbsCatalogSnapshot,setPbsCatalogSnapshot]=useState(null);const[showPbsFileBrowser,setShowPbsFileBrowser]=useState(false);const[pbsEditingNotes,setPbsEditingNotes]=useState(null);const[pbsNotesText,setPbsNotesText]=useState('');// VMware Server state
const[vmwareServers,setVmwareServers]=useState([]);const[selectedVMware,setSelectedVMware]=useState(null);const[vmwareVms,setVmwareVms]=useState([]);const[vmwareHosts,setVmwareHosts]=useState([]);const[vmwareDatastores,setVmwareDatastores]=useState([]);const[vmwareNetworks,setVmwareNetworks]=useState([]);const[vmwareLoading,setVmwareLoading]=useState(false);const[vmwareActiveTab,setVmwareActiveTab]=useState('vms');const[vmwareSelectedVm,setVmwareSelectedVm]=useState(null);const[vmwareVmDetail,setVmwareVmDetail]=useState(null);const[vmwareActionLoading,setVmwareActionLoading]=useState({});const[showAddVMware,setShowAddVMware]=useState(false);const[vmwareForm,setVmwareForm]=useState({name:'',host:'',port:443,username:'root',password:'',ssl_verify:false,notes:''});const[vmwareTestResult,setVmwareTestResult]=useState(null);const[vmwareTestLoading,setVmwareTestLoading]=useState(false);const[vmwareVmTab,setVmwareVmTab]=useState('overview');const[showVmwareClone,setShowVmwareClone]=useState(false);const[vmwareCloneName,setVmwareCloneName]=useState('');const[showVmwareDelete,setShowVmwareDelete]=useState(false);const[vmwareConfigEdit,setVmwareConfigEdit]=useState({cpu:'',memory:'',notes:'',cpu_hot_add:false,memory_hot_add:false});const[vmwareConfigSaving,setVmwareConfigSaving]=useState(false);const[showVmwareMigrate,setShowVmwareMigrate]=useState(false);const[vmwareMigrationPlan,setVmwareMigrationPlan]=useState(null);const[vmwareMigrations,setVmwareMigrations]=useState([]);const[vmwareMigrateForm,setVmwareMigrateForm]=useState({target_cluster:'',target_node:'',target_storage:'',esxi_password:'',network_bridge:'vmbr0',start_after:true,remove_source:false,transfer_mode:'auto'});const[vmwareMigrateLoading,setVmwareMigrateLoading]=useState(false);const[vmwareConsoleUrl,setVmwareConsoleUrl]=useState(null);const[showVmwareConsole,setShowVmwareConsole]=useState(false);const[vmwareHealthData,setVmwareHealthData]=useState(null);const[vmwareRenameName,setVmwareRenameName]=useState('');const[vmwareEvents,setVmwareEvents]=useState([]);const[vmwareEventsLoading,setVmwareEventsLoading]=useState(false);const[vmwareSelectedDs,setVmwareSelectedDs]=useState(null);const[vmwareDsDetail,setVmwareDsDetail]=useState(null);const[vmwareClusters,setVmwareClusters]=useState([]);const[vmwareConnectionOk,setVmwareConnectionOk]=useState(true);const[vmwareSelectedMigration,setVmwareSelectedMigration]=useState(null);const[vmwareMigrationDetail,setVmwareMigrationDetail]=useState(null);const[showVmwareRename,setShowVmwareRename]=useState(false);const[vmwareSearch,setVmwareSearch]=useState('');const[vmwareFilter,setVmwareFilter]=useState('all');// all, running, stopped
const[vmwareSortBy,setVmwareSortBy]=useState('name');const[editingVMware,setEditingVMware]=useState(null);// LW: Feb 2026 - corporate sidebar inventory tree state
const[expandedSidebarNodes,setExpandedSidebarNodes]=useState({});const[selectedSidebarVm,setSelectedSidebarVm]=useState(null);const[selectedSidebarNode,setSelectedSidebarNode]=useState(null);// LW: Feb 2026 - corporate node detail
const[expandedVmwareSidebarHosts,setExpandedVmwareSidebarHosts]=useState({});// LW: Feb 2026 - multi-cluster sidebar expansion (independent of selectedCluster)
const[expandedSidebarClusters,setExpandedSidebarClusters]=useState({});const[sidebarClusterData,setSidebarClusterData]=useState({});// { clusterId: { metrics: {}, resources: [] } }
// LW: Feb 2026 - clear VM/Node selection on cluster/tab change, auto-expand selected
useEffect(()=>{setSelectedSidebarVm(null);setSelectedSidebarNode(null);if(selectedCluster&&isCorporate)setExpandedSidebarClusters(prev=>({...prev,[selectedCluster.id]:true}));},[selectedCluster?.id]);useEffect(()=>{if(activeTab!=='resources')setSelectedSidebarVm(null);if(activeTab!=='overview')setSelectedSidebarNode(null);},[activeTab]);// LW: Feb 2026 - keep selectedSidebarVm fresh with latest metrics (preserve _clusterId)
useEffect(()=>{if(!selectedSidebarVm||!clusterResources)return;// Only update if the VM is in the currently selected cluster
if(selectedSidebarVm._clusterId&&selectedSidebarVm._clusterId!==selectedCluster?.id)return;const updated=clusterResources.find(r=>r.vmid===selectedSidebarVm.vmid&&r.type===selectedSidebarVm.type);if(updated&&(updated.cpu!==selectedSidebarVm.cpu||updated.mem!==selectedSidebarVm.mem||updated.status!==selectedSidebarVm.status)){setSelectedSidebarVm({...updated,_clusterId:selectedSidebarVm._clusterId});}},[clusterResources]);// NS: Duration formatter for PBS tasks (needs to be in this scope)
const pbsFormatDuration=(start,end)=>{if(!start)return'-';const endTime=end||Math.floor(Date.now()/1000);const duration=endTime-start;const hours=Math.floor(duration/3600);const mins=Math.floor(duration%3600/60);const secs=duration%60;if(hours>0)return`${hours}h ${mins}m ${secs}s`;if(mins>0)return`${mins}m ${secs}s`;return`${secs}s`;};// NS: Task update timestamp to prevent race conditions
// This was causing tasks to "jump back" when SSE and polling raced
const taskUpdateTimestamp=useRef(0);const initialTaskFetchPending=useRef(true);// NS: skip stale check on initial load
const[showTaskBar,setShowTaskBar]=useState(true);// localStorage.getItem('showTaskBar') !== 'false'
const[actionLoading,setActionLoading]=useState({});const[warningBannerDismissed,setWarningBannerDismissed]=useState(false);// LW: Feb 2026 - corporate sidebar resize
const[sidebarWidth,setSidebarWidth]=useState(()=>parseInt(localStorage.getItem('corp-sidebar-w'))||224);const sidebarResizing=useRef(false);const wsRef=useRef(null);const retryCount=useRef(0);// unused but might need later
const selectedClusterRef=useRef(null);// for ws callback, dont ask
const selectedVMwareRef=useRef(null);// for SSE VMware events
const vmwareSelectedVmRef=useRef(null);// for SSE VMware VM detail
const vmwareSelectedMigrationRef=useRef(null);// for SSE migration updates
// NS: Keep wsConnectedRef in sync with state for health check
useEffect(()=>{wsConnectedRef.current=wsConnected;},[wsConnected]);const[connectionError,setConnectionError]=useState(null);const[lastRefresh,setLastRefresh]=useState(null);// not used yet
// HA Settings state
// NS: these defaults should probably come from backend
const[haSettings,setHaSettings]=useState({quorum_enabled:true,quorum_hosts:'',quorum_gateway:'',quorum_required_votes:2,self_fence_enabled:true,verify_network:true,recovery_delay:30,// seconds
failure_threshold:3,// 2-Node Cluster Mode - NS Jan 2026
two_node_mode:false,// Storage-based Split-Brain Protection - NS Jan 2026
storage_heartbeat_enabled:false,storage_heartbeat_path:'',storage_heartbeat_timeout:30,poison_pill_enabled:true,strict_fencing:false});const[haStatus,setHaStatus]=useState(null);const[showHaSettings,setShowHaSettings]=useState(false);// NS: Global Search state - Jan 2026
const[globalSearchQuery,setGlobalSearchQuery]=useState('');const[globalSearchResults,setGlobalSearchResults]=useState(null);const[globalSearchLoading,setGlobalSearchLoading]=useState(false);const[showGlobalSearch,setShowGlobalSearch]=useState(false);const[globalSearchIndex,setGlobalSearchIndex]=useState(0);const globalSearchRef=React.useRef(null);const globalSearchTimerRef=React.useRef(null);const[highlightedVm,setHighlightedVm]=useState(null);// {vmid, node} - for scrolling to VM in table
// NS: User Favorites state
const[favorites,setFavorites]=useState({vms:[],nodes:[],clusters:[]});const[datacenterSummary,setDatacenterSummary]=useState(null);// NS: VM Tags state - Jan 2026
const[vmTags,setVmTags]=useState({});// cluster -> vmid -> tags
const[clusterTags,setClusterTags]=useState([]);// available tags in current cluster
const[showTagEditor,setShowTagEditor]=useState(null);// {clusterId, vmid, vmName}
const[newTagName,setNewTagName]=useState('');const[snapshotFilterDate,setSnapshotFilterDate]=useState('');const[globalSnapshots,setGlobalSnapshots]=useState([]);const[snapshotSortBy,setSnapshotSortBy]=useState('age');// vmid, vm_name, node, snapshot_name, snapshot_date, age
const[snapshotSortDir,setSnapshotSortDir]=useState('desc');// NS: Scheduled Actions state
const[schedules,setSchedules]=useState([]);const[showScheduleModal,setShowScheduleModal]=useState(false);const[editingSchedule,setEditingSchedule]=useState(null);// NS: Automation Tab state - Jan 2026
const[automationSubTab,setAutomationSubTab]=useState('schedules');const[clusterAlerts,setClusterAlerts]=useState([]);const[showAlertModal,setShowAlertModal]=useState(false);const[clusterAffinityRules,setClusterAffinityRules]=useState([]);const[showAffinityModal,setShowAffinityModal]=useState(false);// Custom Scripts state - MK Jan 2026
const[customScripts,setCustomScripts]=useState([]);const[showScriptModal,setShowScriptModal]=useState(false);const[editingScript,setEditingScript]=useState(null);// Script execution state - MK Jan 2026
const[showScriptRunModal,setShowScriptRunModal]=useState(null);// script to run
const[scriptRunPassword,setScriptRunPassword]=useState('');const[scriptRunning,setScriptRunning]=useState(false);const[scriptOutput,setScriptOutput]=useState(null);// {name, output, results}
// NS: Reports/Analytics state
const[reportData,setReportData]=useState(null);const[reportPeriod,setReportPeriod]=useState('day');const[reportLoading,setReportLoading]=useState(false);const[topVms,setTopVms]=useState([]);// Auth fetch helper - simple version without timeout abort
// TODO: add retry logic? - LW
// TODO: maybe use axios instead? -ns
const authFetch=async(url,opts={})=>{try{const res=await fetch(url,{...opts,credentials:'include',headers:{...opts.headers,...getAuthHeaders()}});setConnectionError(null);return res;}catch(err){console.error('authFetch err:',err);// setConnectionError('Network error');  // too annoying
return null;}};// Keep ref in sync with state
// NS: this is a hack for the websocket callback closure issue
// NS: Reset ref IMMEDIATELY when cluster changes to prevent cross-cluster data leaks
useEffect(()=>{// First update the ref synchronously
selectedClusterRef.current=selectedCluster;},[selectedCluster]);useEffect(()=>{selectedVMwareRef.current=selectedVMware;},[selectedVMware]);useEffect(()=>{vmwareSelectedVmRef.current=vmwareSelectedVm;},[vmwareSelectedVm]);useEffect(()=>{vmwareSelectedMigrationRef.current=vmwareSelectedMigration;},[vmwareSelectedMigration]);const addToast=(message,type='success')=>{const id=Date.now();setToasts(prev=>[...prev,{id,message,type}]);// auto remove after 5 seconds
setTimeout(()=>{setToasts(prev=>prev.filter(t=>t.id!==id));},5000);};const removeToast=id=>{setToasts(prev=>prev.filter(toast=>toast.id!==id));};// LW: Feb 2026 - corporate sidebar resize handlers
const handleSidebarResizeStart=e=>{e.preventDefault();sidebarResizing.current=true;const startX=e.clientX;const startW=sidebarWidth;let lastW=startW;const onMove=ev=>{if(!sidebarResizing.current)return;lastW=Math.max(150,Math.min(450,startW+ev.clientX-startX));setSidebarWidth(lastW);};const onUp=()=>{sidebarResizing.current=false;localStorage.setItem('corp-sidebar-w',String(lastW));document.removeEventListener('mousemove',onMove);document.removeEventListener('mouseup',onUp);document.body.style.cursor='';document.body.style.userSelect='';};document.body.style.cursor='col-resize';document.body.style.userSelect='none';document.addEventListener('mousemove',onMove);document.addEventListener('mouseup',onUp);};// LW: Feb 2026 - task tracking stubs (used by VM actions)
const addRecentTask=()=>Date.now();const updateRecentTask=()=>{};// LW: Feb 2026 - corporate inline inventory tree: nodes + VMs flat under cluster
const renderInlineNodeTree=clusterId=>{if(!isCorporate||!expandedSidebarClusters[clusterId])return null;// LW: use selectedCluster data or cached sidebar data
const isSelected=selectedCluster&&selectedCluster.id===clusterId;const cMetrics=isSelected?clusterMetrics:sidebarClusterData[clusterId]?.metrics||{};const cResources=isSelected?clusterResources:sidebarClusterData[clusterId]?.resources||[];// LW: merge live nodes + offline from knownNodes + nodeAlerts
const allNodes={};Object.entries(cMetrics).forEach(([name,metrics])=>{if(name==='error'||name==='offline')return;allNodes[name]={name,metrics,online:metrics.status!=='offline'};});if(isSelected){Object.entries(knownNodes).forEach(([name,data])=>{if(!allNodes[name]&&data.status==='offline'){allNodes[name]={name,metrics:null,online:false};}});}Object.entries(nodeAlerts).forEach(([name,alert])=>{if(!allNodes[name]&&alert.cluster_id===clusterId&&alert.status==='offline'){allNodes[name]={name,metrics:null,online:false};}});const sortedNodes=Object.values(allNodes).sort((a,b)=>a.name.localeCompare(b.name));// LW: all VMs/CTs across all nodes, sorted alphabetically
const allVms=(cResources||[]).filter(r=>r.type==='qemu'||r.type==='lxc').sort((a,b)=>(a.name||'').localeCompare(b.name||''));if(sortedNodes.length===0&&allVms.length===0)return null;// LW: keyboard nav helper, all items in one flat list
const treeNavDown=e=>{e.preventDefault();const all=Array.from(e.currentTarget.closest('.corp-inline-tree').querySelectorAll('[tabindex="0"]'));const idx=all.indexOf(e.currentTarget);if(idx>=0&&idx<all.length-1)all[idx+1].focus();};const treeNavUp=e=>{e.preventDefault();const all=Array.from(e.currentTarget.closest('.corp-inline-tree').querySelectorAll('[tabindex="0"]'));const idx=all.indexOf(e.currentTarget);if(idx>0)all[idx-1].focus();};return/*#__PURE__*/React.createElement("div",{className:"ml-5 corp-inline-tree"},sortedNodes.map(({name:nodeName,metrics:nodeMetrics,online:nodeOnline})=>{const isMaint=nodeMetrics?.maintenance_mode;const isUpdating=nodeMetrics?.is_updating;const statusSuffix=isMaint?` (${t('maintenance')})`:isUpdating?` (${t('updating')})`:!nodeOnline?' (Offline)':'';const isNodeSelected=selectedSidebarNode?.name===nodeName&&selectedSidebarNode?.clusterId===clusterId;return/*#__PURE__*/React.createElement("div",{key:`node-${nodeName}`,className:"corp-tree-child flex items-center gap-1.5 pl-1 pr-2 py-0.5 text-[13px] leading-5 cursor-pointer",tabIndex:0,onClick:()=>{setSelectedSidebarNode({name:nodeName,clusterId});setSelectedSidebarVm(null);setActiveTab('overview');},onKeyDown:e=>{if(e.key==='Enter'){e.preventDefault();setSelectedSidebarNode({name:nodeName,clusterId});setSelectedSidebarVm(null);setActiveTab('overview');}else if(e.key==='ArrowDown')treeNavDown(e);else if(e.key==='ArrowUp')treeNavUp(e);},style:isNodeSelected?{background:'#324f61',color:'#e9ecef'}:{color:nodeOnline?'#adbbc4':'#728b9a'},onMouseEnter:e=>{if(!isNodeSelected){e.currentTarget.style.background='#29414e';e.currentTarget.style.color='#e9ecef';}},onMouseLeave:e=>{if(!isNodeSelected){e.currentTarget.style.background='';e.currentTarget.style.color=nodeOnline?'#adbbc4':'#728b9a';}}},isMaint?/*#__PURE__*/React.createElement(Icons.Wrench,{className:"w-3.5 h-3.5 flex-shrink-0",style:{color:'#efc006'}}):isUpdating?/*#__PURE__*/React.createElement(Icons.Download,{className:"w-3.5 h-3.5 flex-shrink-0",style:{color:'#49afd9'}}):!nodeOnline?/*#__PURE__*/React.createElement(Icons.Server,{className:"w-3.5 h-3.5 flex-shrink-0",style:{color:'#f54f47'}}):/*#__PURE__*/React.createElement(Icons.Server,{className:"w-3.5 h-3.5 flex-shrink-0",style:{color:'#49afd9'}}),/*#__PURE__*/React.createElement("span",{className:"truncate flex-1",style:{opacity:nodeOnline?1:0.5}},nodeName,statusSuffix));}),allVms.map(vm=>{const vmRunning=vm.status==='running';const isVmSelected=selectedSidebarVm?.vmid===vm.vmid&&selectedSidebarVm?._clusterId===clusterId;return/*#__PURE__*/React.createElement("div",{key:`vm-${clusterId}-${vm.vmid}`,tabIndex:0,onClick:()=>{setSelectedSidebarVm({...vm,_clusterId:clusterId});setSelectedSidebarNode(null);setActiveTab('resources');setResourcesSubTab('management');},onKeyDown:e=>{if(e.key==='Enter'){e.preventDefault();setSelectedSidebarVm({...vm,_clusterId:clusterId});setSelectedSidebarNode(null);setActiveTab('resources');setResourcesSubTab('management');}else if(e.key==='ArrowDown')treeNavDown(e);else if(e.key==='ArrowUp')treeNavUp(e);},className:"corp-tree-child flex items-center gap-1.5 pl-1 pr-2 py-0.5 text-[13px] leading-5 cursor-pointer",style:isVmSelected?{background:'#324f61',color:'#e9ecef'}:{color:'#adbbc4'},onMouseEnter:e=>{if(!isVmSelected){e.currentTarget.style.background='#29414e';e.currentTarget.style.color='#e9ecef';}},onMouseLeave:e=>{if(!isVmSelected){e.currentTarget.style.background='';e.currentTarget.style.color='#adbbc4';}}},/*#__PURE__*/React.createElement("span",{className:"relative flex-shrink-0",style:{width:'14px',height:'14px'}},vm.type==='lxc'?/*#__PURE__*/React.createElement(Icons.Box,{className:"w-3.5 h-3.5",style:{color:vmRunning?'#49afd9':'#728b9a'}}):/*#__PURE__*/React.createElement(Icons.Monitor,{className:"w-3.5 h-3.5",style:{color:vmRunning?'#60b515':'#728b9a'}}),vmRunning&&/*#__PURE__*/React.createElement("span",{className:"absolute -top-0.5 -right-0.5 w-1.5 h-1.5 rounded-full",style:{background:vm.type==='lxc'?'#49afd9':'#60b515'}})),/*#__PURE__*/React.createElement("span",{className:"truncate flex-1"},vm.name||`${vm.type==='lxc'?'CT':'VM'} ${vm.vmid}`));}));};// NS: Global Search function - Jan 2026
const performGlobalSearch=async query=>{if(!query||query.length<2){setGlobalSearchResults(null);return;}setGlobalSearchLoading(true);try{const response=await authFetch(`${API_URL}/global/search?q=${encodeURIComponent(query)}`);if(response&&response.ok){const data=await response.json();setGlobalSearchResults(data);setGlobalSearchIndex(0);}}catch(err){console.error('Global search error:',err);}setGlobalSearchLoading(false);};// MK: debounce so we dont spam the API on every keystroke
// claude helped rewrite the whole search dropdown, chatgpt did the keyboard nav
const debouncedSearch=query=>{if(globalSearchTimerRef.current)clearTimeout(globalSearchTimerRef.current);if(!query||query.length<2){setGlobalSearchResults(null);return;}globalSearchTimerRef.current=setTimeout(()=>performGlobalSearch(query),300);};// NS: ctrl+k shortcut like every other app these days
React.useEffect(()=>{const handleKeyDown=e=>{if((e.ctrlKey||e.metaKey)&&e.key==='k'){e.preventDefault();if(globalSearchRef.current){globalSearchRef.current.focus();setShowGlobalSearch(true);}}};document.addEventListener('keydown',handleKeyDown);return()=>document.removeEventListener('keydown',handleKeyDown);},[]);// LW: jump to VM in the right cluster when clicking a search result
const navigateToResult=result=>{const cluster=clusters.find(c=>c.id===result.cluster_id);if(cluster){setSelectedCluster(cluster);if(result.type==='vm'||result.type==='ct'||result.type==='qemu'||result.type==='lxc'){setTimeout(()=>{setHighlightedVm({vmid:result.vmid,node:result.node});setTimeout(()=>setHighlightedVm(null),3000);},300);}}setShowGlobalSearch(false);setGlobalSearchQuery('');};// NS: Load user favorites
const loadFavorites=async()=>{try{const response=await authFetch(`${API_URL}/user/favorites`);if(response&&response.ok){const data=await response.json();setFavorites(data);}}catch(err){console.error('Load favorites error:',err);}};// NS: Toggle favorite
const toggleFavorite=async(type,clusterId,vmid=null,vmType=null,nodeName=null)=>{const currentFavs=favorites[type+'s']||[];let isFavorite=false;if(type==='vm'){isFavorite=currentFavs.some(f=>f.cluster_id===clusterId&&f.vmid===vmid);}else if(type==='node'){isFavorite=currentFavs.some(f=>f.cluster_id===clusterId&&f.node===nodeName);}else if(type==='cluster'){isFavorite=currentFavs.includes(clusterId);}const action=isFavorite?'remove':'add';try{const body={action,type,cluster_id:clusterId};if(vmid)body.vmid=vmid;if(vmType)body.vm_type=vmType;if(nodeName)body.node=nodeName;const response=await authFetch(`${API_URL}/user/favorites`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});if(response&&response.ok){const data=await response.json();setFavorites(data.favorites);}}catch(err){console.error('Toggle favorite error:',err);}};// NS: Check if item is favorite
const isFavorite=(type,clusterId,vmid=null,nodeName=null)=>{if(type==='vm'){return(favorites.vms||[]).some(f=>f.cluster_id===clusterId&&f.vmid===vmid);}else if(type==='node'){return(favorites.nodes||[]).some(f=>f.cluster_id===clusterId&&f.node===nodeName);}else if(type==='cluster'){return(favorites.clusters||[]).includes(clusterId);}return false;};// NS: Load datacenter summary
const loadDatacenterSummary=async()=>{try{const response=await authFetch(`${API_URL}/global/summary`);if(response&&response.ok){const data=await response.json();setDatacenterSummary(data);}}catch(err){console.error('Datacenter summary error:',err);}};// ============================================
// VM Tags Functions - NS Jan 2026
// ============================================
const loadClusterTags=async clusterId=>{if(!clusterId)return;try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/tags`);if(response&&response.ok){const data=await response.json();setClusterTags(data);}}catch(err){console.error('Failed to load cluster tags:',err);}};const loadVmTags=async(clusterId,vmid)=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vmid}/tags`);if(response&&response.ok){const data=await response.json();setVmTags(prev=>({...prev,[clusterId]:{...(prev[clusterId]||{}),[vmid]:data}}));}}catch(err){console.error('Failed to load VM tags:',err);}};const addTagToVm=async(clusterId,vmid,tagName,color=null)=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vmid}/tags`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({tag:tagName,color})});if(response&&response.ok){const data=await response.json();setVmTags(prev=>({...prev,[clusterId]:{...(prev[clusterId]||{}),[vmid]:data.tags}}));loadClusterTags(clusterId);return true;}}catch(err){console.error('Failed to add tag:',err);}return false;};const removeTagFromVm=async(clusterId,vmid,tagName)=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/vms/${vmid}/tags/${encodeURIComponent(tagName)}`,{method:'DELETE'});if(response&&response.ok){// Remove from local state
setVmTags(prev=>{const clusterTags=prev[clusterId]||{};const vmTagList=(clusterTags[vmid]||[]).filter(t=>(t.name||t)!==tagName);return{...prev,[clusterId]:{...clusterTags,[vmid]:vmTagList}};});}}catch(err){console.error('Failed to remove tag:',err);}};// Get tags for a VM (from local state)
const getVmTags=(clusterId,vmid)=>{return vmTags[clusterId]?.[vmid]||[];};// ============================================
// LW: Added cluster filter and sorting
// ============================================
const fetchGlobalSnapshots=async(clusterId=null,filterDate=null)=>{try{const body={};if(clusterId)body.cluster_id=clusterId;if(filterDate)body.date=filterDate;const res=await authFetch(`${API_URL}/snapshots/overview`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});if(res&&res.ok){const data=await res.json();setGlobalSnapshots(data.snapshots??data??[]);}else{setGlobalSnapshots([]);}}catch(err){console.error('Snapshot fetch failed:',err);setGlobalSnapshots([]);}};const applySnapshotFilter=async clusterId=>{await fetchGlobalSnapshots(clusterId,snapshotFilterDate||null);};const deleteGlobalSnapshot=async(snap,clusterId)=>{if(!window.confirm(`Delete snapshot "${snap.snapshot_name}" from VM ${snap.vmid}?`)){return;}try{await authFetch(`${API_URL}/snapshots/delete`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({snapshots:[snap]})});addToast('Snapshot deleted','success');await fetchGlobalSnapshots(clusterId,snapshotFilterDate||null);}catch(err){console.error('Snapshot delete failed:',err);addToast('Failed to delete snapshot','error');}};const sortedSnapshots=useMemo(()=>{if(!globalSnapshots||globalSnapshots.length===0)return[];return[...globalSnapshots].sort((a,b)=>{let aVal=a[snapshotSortBy];let bVal=b[snapshotSortBy];// Handle age specially - extract number
if(snapshotSortBy==='age'){const extractNum=val=>{if(!val)return 0;const match=val.match(/(\d+)/);return match?parseInt(match[1]):0;};aVal=extractNum(aVal);bVal=extractNum(bVal);}// Handle numeric fields
if(snapshotSortBy==='vmid'){aVal=parseInt(aVal)||0;bVal=parseInt(bVal)||0;}if(aVal<bVal)return snapshotSortDir==='asc'?-1:1;if(aVal>bVal)return snapshotSortDir==='asc'?1:-1;return 0;});},[globalSnapshots,snapshotSortBy,snapshotSortDir]);const toggleSnapshotSort=field=>{if(snapshotSortBy===field){setSnapshotSortDir(snapshotSortDir==='asc'?'desc':'asc');}else{setSnapshotSortBy(field);setSnapshotSortDir('asc');}};// ============================================
// Scheduled Actions Functions - MK Jan 2026  
// ============================================
const loadSchedules=async()=>{try{const response=await authFetch(`${API_URL}/schedules`);if(response&&response.ok){const data=await response.json();setSchedules(data);}}catch(err){console.error('Failed to load schedules:',err);}};const createSchedule=async scheduleData=>{try{const response=await authFetch(`${API_URL}/schedules`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(scheduleData)});if(response&&response.ok){await loadSchedules();addToast(t('scheduleCreated')||'Schedule created','success');return true;}else{const err=await response.json();addToast(err.error||'Failed to create schedule','error');}}catch(err){console.error('Failed to create schedule:',err);addToast('Failed to create schedule','error');}return false;};const deleteSchedule=async scheduleId=>{try{const response=await authFetch(`${API_URL}/schedules/${scheduleId}`,{method:'DELETE'});if(response&&response.ok){setSchedules(prev=>prev.filter(s=>s.id!==scheduleId));addToast(t('scheduleDeleted')||'Schedule deleted','success');}}catch(err){console.error('Failed to delete schedule:',err);}};const toggleScheduleEnabled=async(scheduleId,enabled)=>{try{const response=await authFetch(`${API_URL}/schedules/${scheduleId}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({enabled})});if(response&&response.ok){setSchedules(prev=>prev.map(s=>s.id===scheduleId?{...s,enabled}:s));}}catch(err){console.error('Failed to toggle schedule:',err);}};// ============================================
// Cluster Alerts Functions - NS Jan 2026
// ============================================
const loadClusterAlerts=async clusterId=>{if(!clusterId)return;try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/alerts`);if(response&&response.ok){const data=await response.json();setClusterAlerts(data.alerts||[]);}else{setClusterAlerts([]);}}catch(err){console.error('Failed to load cluster alerts:',err);setClusterAlerts([]);}};const createClusterAlert=async alertData=>{if(!selectedCluster?.id)return;try{const response=await authFetch(`${API_URL}/clusters/${selectedCluster.id}/alerts`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(alertData)});if(response&&response.ok){setShowAlertModal(false);loadClusterAlerts(selectedCluster.id);addToast(t('alertCreated')||'Alert created','success');}}catch(err){console.error('Failed to create alert:',err);}};const deleteClusterAlert=async alertId=>{if(!selectedCluster?.id)return;try{const response=await authFetch(`${API_URL}/clusters/${selectedCluster.id}/alerts/${alertId}`,{method:'DELETE'});if(response&&response.ok){setClusterAlerts(prev=>prev.filter(a=>a.id!==alertId));}}catch(err){console.error('Failed to delete alert:',err);}};const toggleAlertEnabled=async(alertId,enabled)=>{if(!selectedCluster?.id)return;try{const response=await authFetch(`${API_URL}/clusters/${selectedCluster.id}/alerts/${alertId}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({enabled})});if(response&&response.ok){setClusterAlerts(prev=>prev.map(a=>a.id===alertId?{...a,enabled}:a));}}catch(err){console.error('Failed to toggle alert:',err);}};// ============================================
// Cluster Affinity Rules Functions - NS Jan 2026
// ============================================
const loadClusterAffinityRules=async clusterId=>{if(!clusterId)return;try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/affinity-rules`);if(response&&response.ok){const data=await response.json();setClusterAffinityRules(data.rules||[]);}else{setClusterAffinityRules([]);}}catch(err){console.error('Failed to load affinity rules:',err);setClusterAffinityRules([]);}};const createClusterAffinityRule=async ruleData=>{if(!selectedCluster?.id)return;try{const response=await authFetch(`${API_URL}/clusters/${selectedCluster.id}/affinity-rules`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(ruleData)});if(response&&response.ok){setShowAffinityModal(false);loadClusterAffinityRules(selectedCluster.id);addToast(t('ruleCreated')||'Rule created','success');}}catch(err){console.error('Failed to create affinity rule:',err);}};const deleteClusterAffinityRule=async ruleId=>{if(!selectedCluster?.id)return;try{const response=await authFetch(`${API_URL}/clusters/${selectedCluster.id}/affinity-rules/${ruleId}`,{method:'DELETE'});if(response&&response.ok){setClusterAffinityRules(prev=>prev.filter(r=>r.id!==ruleId));}}catch(err){console.error('Failed to delete affinity rule:',err);}};// ============================================
// Reports/Analytics Functions - NS Jan 2026
// Now cluster-based, not global
// ============================================
const loadReportSummary=async(period='day',clusterId=null)=>{const clId=clusterId||selectedCluster?.id;if(!clId)return;setReportLoading(true);try{const response=await authFetch(`${API_URL}/clusters/${clId}/reports/summary?period=${period}`);if(response&&response.ok){const data=await response.json();setReportData(data);}else{setReportData(null);}}catch(err){console.error('Failed to load report:',err);setReportData(null);}setReportLoading(false);};const loadTopVms=async(metric='cpu',limit=10,clusterId=null)=>{const clId=clusterId||selectedCluster?.id;if(!clId)return;try{const response=await authFetch(`${API_URL}/clusters/${clId}/reports/top-vms?metric=${metric}&limit=${limit}`);if(response&&response.ok){const data=await response.json();setTopVms(data);}else{setTopVms([]);}}catch(err){console.error('Failed to load top VMs:',err);setTopVms([]);}};// Load favorites and summary on mount
useEffect(()=>{if(user){loadFavorites();loadDatacenterSummary();loadSchedules();// Also load schedules
}},[user]);// Load reports when tab changes to reports OR cluster changes
useEffect(()=>{if(activeTab==='reports'&&selectedCluster?.id){loadReportSummary(reportPeriod,selectedCluster.id);loadTopVms('cpu',10,selectedCluster.id);}},[activeTab,reportPeriod,selectedCluster?.id]);// Load automation data when tab changes to automation OR cluster changes
useEffect(()=>{if(activeTab==='automation'&&selectedCluster?.id){loadClusterTags(selectedCluster.id);loadClusterAlerts(selectedCluster.id);loadClusterAffinityRules(selectedCluster.id);loadCustomScripts(selectedCluster.id);}},[activeTab,selectedCluster?.id]);// Load custom scripts
const loadCustomScripts=async clusterId=>{if(!clusterId)return;console.log('[Scripts] Loading scripts for cluster:',clusterId);try{const res=await authFetch(`${API_URL}/clusters/${clusterId}/scripts`);console.log('[Scripts] Response:',res?.status,res?.ok);if(res&&res.ok){const data=await res.json();console.log('[Scripts] Loaded:',data?.length,'scripts',data);setCustomScripts(data||[]);}else{const errorData=await res.json().catch(()=>({}));console.error('[Scripts] Failed to load, status:',res?.status,'error:',errorData);setCustomScripts([]);}}catch(e){console.error('[Scripts] Error loading scripts:',e);setCustomScripts([]);}};// HA Settings functions
const fetchHAStatus=async clusterId=>{if(!clusterId)return;try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/ha/status`);if(response&&response.ok){const data=await response.json();setHaStatus(data);setHaSettings({quorum_enabled:data.split_brain_prevention?.quorum_enabled??true,quorum_hosts:(data.split_brain_prevention?.quorum_hosts||[]).join(', '),quorum_gateway:data.split_brain_prevention?.quorum_gateway||'',quorum_required_votes:data.split_brain_prevention?.quorum_required_votes||2,self_fence_enabled:data.split_brain_prevention?.self_fence_enabled??true,verify_network:data.split_brain_prevention?.verify_network??true,recovery_delay:data.split_brain_prevention?.recovery_delay||30,failure_threshold:data.failure_threshold||3,// 2-Node Mode
two_node_mode:data.split_brain_prevention?.two_node_mode??false,// Storage-based Split-Brain Protection - NS Jan 2026
storage_heartbeat_enabled:data.split_brain_prevention?.storage_heartbeat_enabled??false,storage_heartbeat_path:data.split_brain_prevention?.storage_heartbeat_path||'',storage_heartbeat_timeout:data.split_brain_prevention?.storage_heartbeat_timeout||30,poison_pill_enabled:data.split_brain_prevention?.poison_pill_enabled??true,strict_fencing:data.split_brain_prevention?.strict_fencing??false});// update nodeAlerts based on HA status
// LW: Include cluster_id to filter correctly!
if(data.nodes&&clusterId){const newAlerts={...nodeAlerts};Object.entries(data.nodes).forEach(([nodeName,nodeData])=>{if(nodeData.status==='offline'){// Add to alerts if not already there
if(!newAlerts[nodeName]){newAlerts[nodeName]={status:'offline',message:`Node ${nodeName} is offline`,timestamp:nodeData.last_seen||new Date().toISOString(),severity:'critical',cluster_id:clusterId// Important for filtering!
};}}else if(nodeData.status==='online'&&newAlerts[nodeName]){// Remove from alerts if back online
delete newAlerts[nodeName];}});setNodeAlerts(newAlerts);}}}catch(err){console.error('fetching HA status:',err);}};const handleSaveHASettings=async()=>{if(!selectedCluster)return;try{const response=await authFetch(`${API_URL}/clusters/${selectedCluster.id}/ha/config`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({quorum_enabled:haSettings.quorum_enabled,quorum_hosts:haSettings.quorum_hosts.split(',').map(h=>h.trim()).filter(h=>h),quorum_gateway:haSettings.quorum_gateway,quorum_required_votes:parseInt(haSettings.quorum_required_votes)||2,self_fence_enabled:haSettings.self_fence_enabled,verify_network:haSettings.verify_network,recovery_delay:parseInt(haSettings.recovery_delay)||30,failure_threshold:parseInt(haSettings.failure_threshold)||3,// 2-Node Cluster Mode - uses cluster credentials automatically
two_node_mode:haSettings.two_node_mode,force_quorum_on_failure:haSettings.two_node_mode,// Storage-based Split-Brain Protection - NS Jan 2026
storage_heartbeat_enabled:haSettings.storage_heartbeat_enabled,storage_heartbeat_path:haSettings.storage_heartbeat_path,storage_heartbeat_timeout:parseInt(haSettings.storage_heartbeat_timeout)||30,poison_pill_enabled:haSettings.poison_pill_enabled,strict_fencing:haSettings.strict_fencing})});if(response&&response.ok){addToast(t('haSettingsSaved'));setShowHaSettings(false);fetchHAStatus(selectedCluster.id);}else{const err=await response?.json();addToast(err?.error||t('operationFailed'),'error');}}catch(err){addToast(t('operationFailed'),'error');}};// Task management
const addTask=task=>{if(!task)return;taskUpdateTimestamp.current=Date.now();setTasks(prev=>{// update existing task or add new one
const existing=prev.findIndex(item=>item&&item.upid===task.upid);if(existing>=0){const updated=[...prev];updated[existing]={...updated[existing],...task};return updated;}// Add new task and sort by starttime
return[task,...prev].sort((a,b)=>(b.starttime||0)-(a.starttime||0)).slice(0,50);});};const clearCompletedTasks=()=>{taskUpdateTimestamp.current=Date.now();setTasks(prev=>prev.filter(item=>item&&item.status==='running'));};// Cancel a running task
const cancelTask=async task=>{if(!selectedCluster||!task||!task.upid||!task.node)return;try{const response=await authFetch(`${API_URL}/clusters/${selectedCluster.id}/nodes/${task.node}/tasks/${encodeURIComponent(task.upid)}`,{method:'DELETE'});if(response&&response.ok){addToast(t('taskCancelled'),'success');// update task status locally
setTasks(prev=>prev.map(t=>t&&t.upid===task.upid?{...t,status:'cancelled'}:t));}else{const err=await response?.json();addToast(err?.error||t('taskCancelFailed'),'error');}}catch(error){console.error('cancelling task:',error);addToast(t('taskCancelFailed'),'error');}};// Fetch tasks from cluster
const fetchTasks=async clusterId=>{const fetchStartTime=Date.now();const isInitialFetch=initialTaskFetchPending.current;try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/tasks`);if(response&&response.ok){const data=await response.json();if(Array.isArray(data)){// NS: On initial fetch, always accept response (no stale check)
// SSE events during fetch would otherwise cause "stale" rejection
if(!isInitialFetch&&fetchStartTime<taskUpdateTimestamp.current){console.log('Skipping stale task fetch response');return;}// Mark initial fetch as done
if(isInitialFetch){initialTaskFetchPending.current=false;}taskUpdateTimestamp.current=Date.now();setTasks(prev=>{// If no new data, keep existing
if(data.length===0)return prev;const taskMap=new Map();// Add existing tasks
prev.forEach(task=>{if(task&&task.upid)taskMap.set(task.upid,task);});// Add/update new tasks
data.forEach(task=>{if(task&&task.upid){const existing=taskMap.get(task.upid);taskMap.set(task.upid,existing?{...existing,...task}:task);}});// Convert back to array, sort by starttime desc, limit to 50
return Array.from(taskMap.values()).sort((a,b)=>(b.starttime||0)-(a.starttime||0)).slice(0,50);});}}}catch(err){console.error('fetching tasks:',err);}};// Fetch tasks when cluster changes
useEffect(()=>{if(selectedCluster){console.log('Cluster changed, fetching tasks for:',selectedCluster.id);// NS: Reset flags for new cluster - allows initial fetch to bypass stale check
taskUpdateTimestamp.current=0;initialTaskFetchPending.current=true;setTasks([]);// Clear old tasks immediately
fetchTasks(selectedCluster.id);fetchHAStatus(selectedCluster.id);// Poll HA status every 30 seconds to detect offline nodes
const haInterval=setInterval(()=>{fetchHAStatus(selectedCluster.id);},30000);return()=>clearInterval(haInterval);}else{setTasks([]);setNodeAlerts({});}},[selectedCluster?.id]);// Use ID, not whole object to prevent loop
// SSE (Server-Sent Events) connection for live updates
// More reliable than WebSocket - no threading issues on server
useEffect(()=>{if(!user||!sessionId){console.log('SSE: Waiting for user/session',{user:!!user,sessionId:!!sessionId});return;}let eventSource=null;let reconnectTimeout=null;let reconnectAttempts=0;let isClosing=false;let sseToken=null;let tokenRefreshInterval=null;// Get SSE token (more secure than session ID in URL)
const getSseToken=async()=>{try{const resp=await authFetch(`${API_URL}/sse/token`,{method:'POST'});if(resp&&resp.ok){const data=await resp.json();sseToken=data.token;console.log('SSE token obtained (expires in',data.expires_in,'s)');return true;}}catch(e){console.warn('Failed to get SSE token, falling back to session:',e);}return false;};const connectSSE=async()=>{if(isClosing)return;console.log('Connecting to SSE...');// Try to get SSE token first (preferred - doesn't expose session in logs)
await getSseToken();// Use token if available, otherwise fall back to session
let sseUrl;if(sseToken){sseUrl=`${API_URL}/sse/updates?token=${encodeURIComponent(sseToken)}`;}else{// Fallback to session (legacy, less secure)
console.warn('SSE: Using session ID (token unavailable)');sseUrl=`${API_URL}/sse/updates?session=${encodeURIComponent(sessionId)}`;}eventSource=new EventSource(sseUrl,{withCredentials:true});eventSource.onopen=()=>{console.log('SSE connected');reconnectAttempts=0;setWsConnected(true);// NS: Refresh token every 5 minutes (token valid for 10 min now)
// This gives us buffer time if refresh fails
if(tokenRefreshInterval)clearInterval(tokenRefreshInterval);tokenRefreshInterval=setInterval(async()=>{console.log('SSE: Token refresh cycle starting...');const gotToken=await getSseToken();if(gotToken){console.log('SSE: Got new token, reconnecting...');// Close current connection - onerror will NOT trigger reconnect
// because we set isClosing temporarily
const wasClosing=isClosing;isClosing=true;// Prevent onerror from reconnecting
if(eventSource){eventSource.close();}isClosing=wasClosing;// Now reconnect with new token
setTimeout(connectSSE,100);// Small delay to ensure clean close
}else{console.warn('SSE: Token refresh failed, keeping existing connection');// Don't reconnect - existing connection might still work
}},5*60*1000);// 5 minutes
};eventSource.onmessage=event=>{try{const data=JSON.parse(event.data);const currentCluster=selectedClusterRef.current;if(data.type==='connected'){console.log('SSE authenticated');}else if(data.type==='tasks'){// Tasks kommen mit cluster_id - nur vom aktuellen Cluster anzeigen
if(currentCluster&&data.cluster_id===currentCluster.id){if(Array.isArray(data.data)){console.log(`SSE tasks received for cluster ${data.cluster_id}:`,data.data.length);// NS: Use merge logic same as fetchTasks to prevent jumping
taskUpdateTimestamp.current=Date.now();setTasks(prev=>{const taskMap=new Map();// Add existing tasks first
prev.forEach(task=>{if(task&&task.upid)taskMap.set(task.upid,task);});// SSE data is authoritative - update/add all
data.data.forEach(task=>{if(task&&task.upid){taskMap.set(task.upid,task);}});// Sort by starttime desc, limit to 50
return Array.from(taskMap.values()).sort((a,b)=>(b.starttime||0)-(a.starttime||0)).slice(0,50);});}}else if(!currentCluster){// MK: Feb 2026 - Fixed oscillation bug in "Alle Cluster" view
// Old logic: replace cluster tasks + global slice(50) = constant flickering
// because each cluster's update would cut the other cluster's tasks
// New logic: Map-based merge with per-cluster fair-share limit
if(Array.isArray(data.data)){setTasks(prev=>{const taskMap=new Map();// Keep existing tasks from ALL clusters
prev.forEach(task=>{if(task&&task.upid)taskMap.set(task.upid,task);});// Update/add tasks from this cluster
data.data.forEach(task=>{if(task&&task.upid){taskMap.set(task.upid,{...task,cluster_id:data.cluster_id});}});// Remove tasks from this cluster that are no longer reported
// (task completed and fell off the Proxmox task list)
const reportedUpids=new Set(data.data.map(t=>t.upid).filter(Boolean));for(const[upid,task]of taskMap){if(task.cluster_id===data.cluster_id&&!reportedUpids.has(upid)){taskMap.delete(upid);}}const sorted=Array.from(taskMap.values()).sort((a,b)=>(b.starttime||0)-(a.starttime||0)).slice(0,100);// Skip re-render if nothing actually changed
if(sorted.length===prev.length&&sorted.every((t,i)=>prev[i]?.upid===t.upid&&prev[i]?.status===t.status)){return prev;}taskUpdateTimestamp.current=Date.now();return sorted;});}}}else if(data.type==='metrics'){// Only update detailed clusterMetrics for the selected cluster
// LW: allClusterMetrics is updated via fetchClusters using datacenter/status API
if(currentCluster&&data.cluster_id===currentCluster.id){setClusterMetrics(data.data);setLastUpdate(new Date());// NS: Track all nodes - nodes in metrics are online
setKnownNodes(prev=>{const updated={...prev};const now=new Date().toISOString();// Mark all nodes in metrics as online
Object.keys(data.data||{}).forEach(nodeName=>{updated[nodeName]={status:'online',lastSeen:now,metrics:data.data[nodeName]};});// DON'T mark nodes as offline based on metrics
// Let the node_status SSE event handle offline detection
return updated;});}}else if(data.type==='resources'){// NS: ONLY process resources for the currently selected cluster
if(currentCluster&&data.cluster_id===currentCluster.id){setClusterResources(data.data);// MK: Store in window for access from ConfigModal reassign feature
window.pegaproxVmList=data.data;setLastUpdate(new Date());}}else if(data.type==='vm_config'){// NS: Live VM config updates - dispatch event for modals to listen
if(currentCluster&&data.cluster_id===currentCluster.id){const vmConfig=data.data;console.log(`SSE vm_config update for ${vmConfig.vm_type}/${vmConfig.vmid}`);// Dispatch custom event that modals can listen to
window.dispatchEvent(new CustomEvent('pegaprox-vm-config',{detail:{vmid:vmConfig.vmid,node:vmConfig.node,vm_type:vmConfig.vm_type,config:vmConfig.config,cluster_id:data.cluster_id}}));}}else if(data.type==='action'){const action=data.data;const currentUser=user?.username;// NS: Optimistic UI update - immediately update VM status in the list
if(currentCluster&&data.cluster_id===currentCluster.id&&action.resource_id){const vmid=parseInt(action.resource_id);const newStatus={'start':'running','stop':'stopped','shutdown':'stopped','reboot':'running','delete':null// Will be removed
}[action.action];if(newStatus!==undefined){setClusterResources(prev=>{if(!prev)return prev;if(newStatus===null){// Delete - remove from list
return prev.filter(r=>r.vmid!==vmid);}// Update status
return prev.map(r=>r.vmid===vmid?{...r,status:newStatus}:r);});}}// Show toast for other users' actions
if(action.user&&action.user!==currentUser){const actionNames={'start':t('started'),'stop':t('stopped'),'shutdown':t('stopped'),'reboot':t('restarted'),'delete':t('deleted'),'create':t('created')};const actionName=actionNames[action.action]||action.action;const resourceType=action.resource_type==='qemu'?'VM':'CT';addToast(`${action.user}: ${resourceType} ${action.resource_id} ${actionName}`,'info');}}else if(data.type==='node_status'){// handle node online/offline events
// NS: ONLY process events for the currently selected cluster!
const nodeEvent=data.data;// NS: Feb 2026 - Cluster reconnect events are shown for ANY cluster
if(nodeEvent.event==='cluster_reconnected'){addToast(`âœ“ ${nodeEvent.message}`,'success');}else if(currentCluster&&nodeEvent.cluster_id===currentCluster.id){if(nodeEvent.event==='node_offline'){// Show critical alert for node offline
addToast(`âš ï¸ CRITICAL: ${nodeEvent.message}`,'error');setNodeAlerts(prev=>({...prev,[nodeEvent.node]:{status:'offline',message:nodeEvent.message,timestamp:new Date().toISOString(),severity:'critical',cluster_id:nodeEvent.cluster_id}}));}else if(nodeEvent.event==='node_online'){// Node is back online
addToast(`âœ“ ${nodeEvent.message}`,'success');setNodeAlerts(prev=>{const newAlerts={...prev};delete newAlerts[nodeEvent.node];return newAlerts;});}}// â”€â”€ VMware SSE Events â”€â”€
}else if(data.type==='vmware_servers'){// Update VMware servers list from SSE
if(Array.isArray(data.data)){setVmwareServers(prev=>{// Merge: SSE data is authoritative
const merged=[...data.data];// Keep any extra fields from previous state
prev.forEach(old=>{const idx=merged.findIndex(n=>n.id===old.id);if(idx>=0)merged[idx]={...old,...merged[idx]};});return merged;});}}else if(data.type==='vmware_vms'){// Update VM list for a specific VMware server
const payload=data.data;const curVmw=selectedVMwareRef.current;if(payload&&curVmw?.id===payload.vmware_id&&Array.isArray(payload.vms)){setVmwareVms(payload.vms);}}else if(data.type==='vmware_vm_detail'){// Update VM detail for a specific VM
const payload=data.data;const curVmw=selectedVMwareRef.current;const curVm=vmwareSelectedVmRef.current;if(payload&&curVmw?.id===payload.vmware_id&&curVm===payload.vm_id&&payload.data){setVmwareVmDetail(payload.data);}}else if(data.type==='vmware_migration'){// Real-time migration status update via SSE
const m=data.data;if(m&&m.id){setVmwareMigrations(prev=>{const idx=prev.findIndex(x=>x.id===m.id);if(idx>=0){const updated=[...prev];updated[idx]={...updated[idx],...m};return updated;}return[m,...prev];});// Update selected migration detail if viewing it
if(vmwareSelectedMigrationRef.current===m.id){setVmwareMigrationDetail(prev=>prev?{...prev,...m}:m);}}}else if(data.type==='vmware_migration_log'){// Real-time log line for active migration
const m=data.data;if(m&&m.id&&vmwareSelectedMigrationRef.current===m.id){setVmwareMigrationDetail(prev=>{if(!prev)return prev;const newLog=[...(prev.log||[])];if(m.line&&!newLog.includes(m.line))newLog.push(m.line);return{...prev,log:newLog,progress:m.progress||prev.progress,phase:m.phase||prev.phase};});}}}catch(e){console.error('SSE message error:',e);}};eventSource.onerror=error=>{console.error('SSE error:',error);setWsConnected(false);// Only close if not already closed
if(eventSource&&eventSource.readyState!==EventSource.CLOSED){eventSource.close();}if(!isClosing){// NS: Get fresh token before reconnecting
const delay=Math.min(1000*Math.pow(2,reconnectAttempts),30000);reconnectAttempts++;console.log(`SSE: Reconnecting in ${delay}ms (attempt ${reconnectAttempts})...`);reconnectTimeout=setTimeout(async()=>{// Get fresh token first
await getSseToken();connectSSE();},delay);}};};connectSSE();// NS: Health check - if disconnected for >30 seconds, force reconnect
const healthCheckInterval=setInterval(()=>{if(!wsConnectedRef.current&&!isClosing&&eventSource?.readyState===EventSource.CLOSED){console.log('SSE: Health check detected closed connection, reconnecting...');reconnectAttempts=0;// Reset attempts
connectSSE();}},30000);return()=>{isClosing=true;if(reconnectTimeout)clearTimeout(reconnectTimeout);if(tokenRefreshInterval)clearInterval(tokenRefreshInterval);if(healthCheckInterval)clearInterval(healthCheckInterval);if(eventSource)eventSource.close();};},[user,sessionId]);// React to both user and sessionId changes
// update WebSocket subscription when selected cluster changes
useEffect(()=>{if(wsRef.current&&wsRef.current.readyState===WebSocket.OPEN&&selectedCluster){wsRef.current.send(JSON.stringify({type:'subscribe',clusters:[selectedCluster.id]}));}},[selectedCluster?.id]);useEffect(()=>{fetchClusters();fetchClusterGroups();const interval=setInterval(fetchClusters,30000);return()=>clearInterval(interval);},[]);// LW: Feb 2026 - PBS fetch functions
const fetchPBSServers=async()=>{try{const resp=await authFetch(`${API_URL}/pbs`);if(resp&&resp.ok){const data=await resp.json();setPbsServers(data);}}catch(e){console.warn('PBS fetch error:',e);}};const fetchPBSStatus=async pbsId=>{setPbsLoading(true);try{const resp=await authFetch(`${API_URL}/pbs/${pbsId}/status`);if(resp&&resp.ok)setPbsStatus(await resp.json());}catch(e){console.warn('PBS status error:',e);}finally{setPbsLoading(false);}};const fetchPBSDatastores=async pbsId=>{try{const resp=await authFetch(`${API_URL}/pbs/${pbsId}/datastores`);if(resp&&resp.ok)setPbsDatastores(await resp.json());}catch(e){console.warn('PBS datastores error:',e);}};const fetchPBSSnapshots=async(pbsId,store)=>{try{const resp=await authFetch(`${API_URL}/pbs/${pbsId}/datastores/${store}/snapshots`);if(resp&&resp.ok)setPbsSnapshots(await resp.json());}catch(e){console.warn('PBS snapshots error:',e);}};const fetchPBSGroups=async(pbsId,store)=>{try{const resp=await authFetch(`${API_URL}/pbs/${pbsId}/datastores/${store}/groups`);if(resp&&resp.ok)setPbsGroups(await resp.json());}catch(e){console.warn('PBS groups error:',e);}};const fetchPBSTasks=async pbsId=>{try{const resp=await authFetch(`${API_URL}/pbs/${pbsId}/tasks?limit=30`);if(resp&&resp.ok)setPbsTasks(await resp.json());}catch(e){console.warn('PBS tasks error:',e);}};const fetchPBSJobs=async pbsId=>{try{const resp=await authFetch(`${API_URL}/pbs/${pbsId}/jobs`);if(resp&&resp.ok)setPbsJobs(await resp.json());}catch(e){console.warn('PBS jobs error:',e);}};const fetchPBSNamespaces=async(pbsId,store)=>{try{const resp=await authFetch(`${API_URL}/pbs/${pbsId}/datastores/${store}/namespaces`);if(resp&&resp.ok)setPbsNamespaces(await resp.json());else setPbsNamespaces([]);}catch(e){setPbsNamespaces([]);}};const fetchPBSDisks=async pbsId=>{try{const resp=await authFetch(`${API_URL}/pbs/${pbsId}/disks`);if(resp&&resp.ok)setPbsDisks(await resp.json());}catch(e){console.warn('PBS disks error:',e);}};const fetchPBSRemotes=async pbsId=>{try{const resp=await authFetch(`${API_URL}/pbs/${pbsId}/remotes`);if(resp&&resp.ok)setPbsRemotes(await resp.json());}catch(e){console.warn('PBS remotes error:',e);}};const fetchPBSNotifications=async pbsId=>{try{const resp=await authFetch(`${API_URL}/pbs/${pbsId}/notifications`);if(resp&&resp.ok)setPbsNotifications(await resp.json());}catch(e){console.warn('PBS notifications error:',e);}};const fetchPBSTrafficControl=async pbsId=>{try{const resp=await authFetch(`${API_URL}/pbs/${pbsId}/traffic-control`);if(resp&&resp.ok)setPbsTrafficControl(await resp.json());}catch(e){console.warn('PBS traffic control error:',e);}};const fetchPBSSyslog=async(pbsId,limit=100)=>{try{const resp=await authFetch(`${API_URL}/pbs/${pbsId}/syslog?limit=${limit}`);if(resp&&resp.ok)setPbsSyslog(await resp.json());}catch(e){console.warn('PBS syslog error:',e);}};const fetchPBSCatalog=async(pbsId,store,snapshot,filepath='/')=>{try{const params=new URLSearchParams({'backup-type':snapshot['backup-type'],'backup-id':snapshot['backup-id'],'backup-time':snapshot['backup-time'],filepath});const resp=await authFetch(`${API_URL}/pbs/${pbsId}/datastores/${store}/catalog?${params}`);if(resp&&resp.ok){setPbsCatalog(await resp.json());}else{setPbsCatalog([]);addToast('Catalog not available for this snapshot (may be encrypted or non-pxar)','warning');}}catch(e){console.warn('PBS catalog error:',e);setPbsCatalog([]);}};const pbsOpenFileBrowser=snapshot=>{setPbsCatalogSnapshot(snapshot);setPbsCatalogPath('/');setPbsCatalog([]);setShowPbsFileBrowser(true);fetchPBSCatalog(selectedPBS.id,pbsSelectedStore,snapshot,'/');};const pbsNavigateCatalog=path=>{setPbsCatalogPath(path);fetchPBSCatalog(selectedPBS.id,pbsSelectedStore,pbsCatalogSnapshot,path);};const pbsDownloadFile=filepath=>{const snap=pbsCatalogSnapshot;const params=new URLSearchParams({'backup-type':snap['backup-type'],'backup-id':snap['backup-id'],'backup-time':snap['backup-time'],filepath});// Open download in new tab/trigger download
window.open(`${API_URL}/pbs/${selectedPBS.id}/datastores/${pbsSelectedStore}/file-download?${params}`,'_blank');};const pbsSaveNotes=async(type,params)=>{try{const endpoint=type==='snapshot'?'notes':'group-notes';const resp=await authFetch(`${API_URL}/pbs/${selectedPBS.id}/datastores/${pbsSelectedStore}/${endpoint}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({...params,notes:pbsNotesText})});if(resp&&resp.ok){addToast('Notes saved','success');setPbsEditingNotes(null);// Refresh data
if(type==='snapshot')fetchPBSSnapshots(selectedPBS.id,pbsSelectedStore);else fetchPBSGroups(selectedPBS.id,pbsSelectedStore);}else{addToast('Failed to save notes','error');}}catch(e){addToast('Error saving notes: '+e.message,'error');}};const pbsToggleProtected=async snapshot=>{try{const newState=!snapshot.protected;const resp=await authFetch(`${API_URL}/pbs/${selectedPBS.id}/datastores/${pbsSelectedStore}/protected`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({'backup-type':snapshot['backup-type'],'backup-id':snapshot['backup-id'],'backup-time':snapshot['backup-time'],'protected':newState})});if(resp&&resp.ok){addToast(`Snapshot ${newState?'protected':'unprotected'}`,'success');fetchPBSSnapshots(selectedPBS.id,pbsSelectedStore);}else{addToast('Failed to update protection','error');}}catch(e){addToast('Error: '+e.message,'error');}};// Load PBS when selected
useEffect(()=>{if(selectedPBS){fetchPBSStatus(selectedPBS.id);fetchPBSDatastores(selectedPBS.id);fetchPBSTasks(selectedPBS.id);fetchPBSJobs(selectedPBS.id);fetchPBSDisks(selectedPBS.id);fetchPBSRemotes(selectedPBS.id);fetchPBSNotifications(selectedPBS.id);fetchPBSTrafficControl(selectedPBS.id);const interval=setInterval(()=>{fetchPBSStatus(selectedPBS.id);fetchPBSDatastores(selectedPBS.id);},30000);return()=>clearInterval(interval);}},[selectedPBS?.id]);// Load PBS datastore detail when selected
useEffect(()=>{if(selectedPBS&&pbsSelectedStore){fetchPBSSnapshots(selectedPBS.id,pbsSelectedStore);fetchPBSGroups(selectedPBS.id,pbsSelectedStore);fetchPBSNamespaces(selectedPBS.id,pbsSelectedStore);}},[selectedPBS?.id,pbsSelectedStore]);// Initial PBS load
useEffect(()=>{fetchPBSServers();const pbsInterval=setInterval(fetchPBSServers,60000);return()=>clearInterval(pbsInterval);},[]);// LW: Feb 2026 - PBS action functions
const handleAddPBS=async config=>{try{const resp=await authFetch(`${API_URL}/pbs`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(config)});if(resp&&resp.ok){const data=await resp.json();addToast('PBS server added successfully','success');setShowAddPBS(false);fetchPBSServers();setSelectedPBS(data);setSelectedCluster(null);setPbsActiveTab('dashboard');return{success:true};}else{const err=resp?await resp.json().catch(()=>({})):{};return{success:false,error:err.error||`HTTP ${resp?.status}`};}}catch(e){return{success:false,error:e.message};}};const handleUpdatePBS=async(pbsId,config)=>{try{const resp=await authFetch(`${API_URL}/pbs/${pbsId}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(config)});if(resp&&resp.ok){addToast('PBS server updated','success');fetchPBSServers();if(selectedPBS?.id===pbsId)fetchPBSStatus(pbsId);return{success:true};}const err=resp?await resp.json().catch(()=>({})):{};return{success:false,error:err.error||'Update failed'};}catch(e){return{success:false,error:e.message};}};const handleDeletePBS=async pbsId=>{if(!confirm('Delete this PBS server? This cannot be undone.'))return;try{const resp=await authFetch(`${API_URL}/pbs/${pbsId}`,{method:'DELETE'});if(resp&&resp.ok){addToast('PBS server deleted','success');if(selectedPBS?.id===pbsId)setSelectedPBS(null);fetchPBSServers();}}catch(e){addToast('Delete failed: '+e.message,'error');}};const handleTestPBS=async config=>{try{const resp=await authFetch(`${API_URL}/pbs/test-connection`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(config)});if(resp&&resp.ok)return await resp.json();const err=resp?await resp.json().catch(()=>({})):{};return{success:false,error:err.error||`HTTP ${resp?.status}`};}catch(e){return{success:false,error:e.message};}};const pbsAction=async(action,store,data={})=>{if(!selectedPBS)return;const pbsId=selectedPBS.id;try{let url,method='POST';if(action==='gc')url=`${API_URL}/pbs/${pbsId}/datastores/${store}/gc`;else if(action==='verify')url=`${API_URL}/pbs/${pbsId}/datastores/${store}/verify`;else if(action==='prune')url=`${API_URL}/pbs/${pbsId}/datastores/${store}/prune`;else if(action==='delete-snapshot'){url=`${API_URL}/pbs/${pbsId}/datastores/${store}/snapshots`;method='DELETE';}const resp=await authFetch(url,{method,headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});if(resp&&resp.ok){const result=await resp.json();const upid=result?.data;addToast(`${action} started on ${store}${upid?' (task: '+String(upid).slice(-8)+')':''}`,'success');// Refresh tasks
setTimeout(()=>{fetchPBSTasks(pbsId);if(action==='delete-snapshot'||action==='prune'){fetchPBSSnapshots(pbsId,store);fetchPBSGroups(pbsId,store);}},1000);return result;}const err=resp?await resp.json().catch(()=>({})):{};addToast(`${action} failed: ${err.error||'unknown'}`,'error');}catch(e){addToast(`${action} error: ${e.message}`,'error');}};const pbsRunJob=async(jobType,jobId)=>{if(!selectedPBS)return;try{const resp=await authFetch(`${API_URL}/pbs/${selectedPBS.id}/jobs/${jobType}/${jobId}/run`,{method:'POST'});if(resp&&resp.ok){addToast(`${jobType} job '${jobId}' started`,'success');setTimeout(()=>fetchPBSTasks(selectedPBS.id),1000);}else{const err=resp?await resp.json().catch(()=>({})):{};addToast(`Job failed: ${err.error||'unknown'}`,'error');}}catch(e){addToast('Job error: '+e.message,'error');}};const viewPBSTaskLog=async upid=>{if(!selectedPBS)return;try{const resp=await authFetch(`${API_URL}/pbs/${selectedPBS.id}/tasks/${encodeURIComponent(upid)}`);if(resp&&resp.ok){const data=await resp.json();setPbsTaskLog({upid,...data});}}catch(e){addToast('Failed to load task log','error');}};// PBS prune dialog  
const[showPbsPrune,setShowPbsPrune]=useState(null);// ============================================================
// VMware Server Functions
// ============================================================
const fetchVMwareServers=async()=>{try{const resp=await authFetch(`${API_URL}/vmware`);if(resp&&resp.ok){const data=await resp.json();setVmwareServers(Array.isArray(data)?data:data.data||[]);}}catch(e){console.warn('VMware fetch error:',e);}};const fetchVMwareVms=async vmwId=>{if(!vmwId)return;setVmwareLoading(true);try{const resp=await authFetch(`${API_URL}/vmware/${vmwId}/vms`);if(resp&&resp.ok){const data=await resp.json();setVmwareVms(Array.isArray(data)?data:data.data||[]);setVmwareConnectionOk(true);}else{setVmwareConnectionOk(false);}}catch(e){console.warn('VMware VMs error:',e);setVmwareConnectionOk(false);}setVmwareLoading(false);};const fetchVMwareHosts=async vmwId=>{try{const resp=await authFetch(`${API_URL}/vmware/${vmwId}/hosts`);if(resp&&resp.ok){const data=await resp.json();setVmwareHosts(Array.isArray(data)?data:data.data||[]);}}catch(e){console.warn('VMware hosts error:',e);}};const fetchVMwareDatastores=async vmwId=>{try{const resp=await authFetch(`${API_URL}/vmware/${vmwId}/datastores`);if(resp&&resp.ok){const data=await resp.json();setVmwareDatastores(Array.isArray(data)?data:data.data||[]);}}catch(e){console.warn('VMware datastores error:',e);}};const fetchVMwareDsDetail=async(vmwId,dsId)=>{try{const resp=await authFetch(`${API_URL}/vmware/${vmwId}/datastores/${dsId}`);if(resp&&resp.ok){const data=await resp.json();setVmwareDsDetail(data);}}catch(e){console.warn('VMware DS detail error:',e);}};const fetchVMwareNetworks=async vmwId=>{try{const resp=await authFetch(`${API_URL}/vmware/${vmwId}/networks`);if(resp&&resp.ok){const data=await resp.json();setVmwareNetworks(Array.isArray(data)?data:data.data||[]);}}catch(e){console.warn('VMware networks error:',e);}};const fetchVMwareClusters=async vmwId=>{try{const resp=await authFetch(`${API_URL}/vmware/${vmwId}/clusters`);if(resp&&resp.ok){const data=await resp.json();setVmwareClusters(Array.isArray(data)?data:data.data||[]);}}catch(e){console.warn('VMware clusters error:',e);}};const toggleVMwareDRS=async(vmwId,clusterId,enabled,automation)=>{try{const resp=await authFetch(`${API_URL}/vmware/${vmwId}/clusters/${clusterId}/drs`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({enabled,automation:automation||'FULLY_AUTOMATED'})});if(resp&&resp.ok){addToast(`DRS ${enabled?'enabled':'disabled'}`,'success');fetchVMwareClusters(vmwId);}else{const err=await resp.json().catch(()=>({}));addToast(err.error||'DRS toggle failed','error');}}catch(e){addToast('DRS toggle error: '+e.message,'error');}};const toggleVMwareHA=async(vmwId,clusterId,enabled)=>{try{const resp=await authFetch(`${API_URL}/vmware/${vmwId}/clusters/${clusterId}/ha`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({enabled})});if(resp&&resp.ok){addToast(`HA ${enabled?'enabled':'disabled'}`,'success');fetchVMwareClusters(vmwId);}else{const err=await resp.json().catch(()=>({}));addToast(err.error||'HA toggle failed','error');}}catch(e){addToast('HA toggle error: '+e.message,'error');}};const fetchVMwareVmDetail=async(vmwId,vmId)=>{try{const resp=await authFetch(`${API_URL}/vmware/${vmwId}/vms/${vmId}`);if(resp&&resp.ok){const data=await resp.json();setVmwareVmDetail(data.data||data);}}catch(e){console.warn('VMware VM detail error:',e);}};const vmwarePowerAction=async(vmId,action)=>{if(!selectedVMware)return;setVmwareActionLoading(prev=>({...prev,[vmId]:action}));try{const resp=await authFetch(`${API_URL}/vmware/${selectedVMware.id}/vms/${vmId}/power/${action}`,{method:'POST'});if(resp&&resp.ok){addToast(`VM ${action} initiated`,'success');setTimeout(()=>fetchVMwareVms(selectedVMware.id),2000);}else{const err=resp?await resp.json().catch(()=>({})):{};addToast(`Power action failed: ${err.error||'unknown'}`,'error');}}catch(e){addToast('Power action error: '+e.message,'error');}setVmwareActionLoading(prev=>({...prev,[vmId]:null}));};const vmwareSnapshotAction=async(vmId,action,data={})=>{if(!selectedVMware)return;try{const method=action==='delete'?'DELETE':'POST';const url=action==='delete'?`${API_URL}/vmware/${selectedVMware.id}/vms/${vmId}/snapshots/${data.snapshot_id}`:`${API_URL}/vmware/${selectedVMware.id}/vms/${vmId}/snapshots`;const resp=await authFetch(url,{method,headers:{'Content-Type':'application/json'},body:action!=='delete'?JSON.stringify(data):undefined});if(resp&&resp.ok){addToast(`Snapshot ${action} successful`,'success');if(vmwareSelectedVm)fetchVMwareVmDetail(selectedVMware.id,vmId);}else{const err=resp?await resp.json().catch(()=>({})):{};addToast(`Snapshot ${action} failed: ${err.error||'unknown'}`,'error');}}catch(e){addToast('Snapshot error: '+e.message,'error');}};const handleAddVMware=async config=>{try{const resp=await authFetch(`${API_URL}/vmware`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(config)});if(resp&&resp.ok){addToast('ESXi server added','success');setShowAddVMware(false);setVmwareForm({name:'',host:'',port:443,username:'root',password:'',ssl_verify:false,notes:''});fetchVMwareServers();}else{const err=resp?await resp.json().catch(()=>({})):{};addToast(`Failed: ${err.error||'unknown'}`,'error');}}catch(e){addToast('Error: '+e.message,'error');}};const handleUpdateVMware=async(vmwId,config)=>{try{const resp=await authFetch(`${API_URL}/vmware/${vmwId}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(config)});if(resp&&resp.ok){addToast('ESXi server updated','success');setShowAddVMware(false);setEditingVMware(null);fetchVMwareServers();}else{const err=resp?await resp.json().catch(()=>({})):{};addToast(`Update failed: ${err.error||'unknown'}`,'error');}}catch(e){addToast('Error: '+e.message,'error');}};const handleDeleteVMware=async vmwId=>{if(!confirm('Delete this ESXi server?'))return;try{const resp=await authFetch(`${API_URL}/vmware/${vmwId}`,{method:'DELETE'});if(resp&&resp.ok){addToast('ESXi server deleted','success');if(selectedVMware?.id===vmwId)setSelectedVMware(null);fetchVMwareServers();}}catch(e){addToast('Delete error: '+e.message,'error');}};const handleTestVMware=async config=>{setVmwareTestLoading(true);setVmwareTestResult(null);try{const resp=await authFetch(`${API_URL}/vmware/test-connection`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(config)});const data=resp&&resp.ok?await resp.json():{error:'Connection failed'};setVmwareTestResult(data);}catch(e){setVmwareTestResult({error:e.message});}setVmwareTestLoading(false);};// VMware initial load (SSE handles ongoing updates)
useEffect(()=>{fetchVMwareServers();// Fallback poll at 120s in case SSE disconnects
const vmwInterval=setInterval(fetchVMwareServers,120000);return()=>clearInterval(vmwInterval);},[]);// Fetch VMs when a VMware server is selected
useEffect(()=>{if(selectedVMware?.id){fetchVMwareVms(selectedVMware.id);fetchVMwareHosts(selectedVMware.id);fetchVMwareDatastores(selectedVMware.id);fetchVMwareNetworks(selectedVMware.id);fetchVMwareClusters(selectedVMware.id);// SSE pushes vmware_vms every ~10s -- keep a slow fallback
const interval=setInterval(()=>{fetchVMwareHosts(selectedVMware.id);fetchVMwareDatastores(selectedVMware.id);},60000);const clInterval=setInterval(()=>fetchVMwareClusters(selectedVMware.id),120000);return()=>{clearInterval(interval);clearInterval(clInterval);};}},[selectedVMware?.id]);// Watch VM detail via SSE (replaces 10s polling)
useEffect(()=>{if(selectedVMware?.id&&vmwareSelectedVm){// Initial fetch
fetchVMwareVmDetail(selectedVMware.id,vmwareSelectedVm);// Register watch -- SSE will push detail every ~5s
const watchVm=()=>{authFetch(`${API_URL}/vmware/${selectedVMware.id}/vms/${vmwareSelectedVm}/watch`,{method:'POST'}).catch(()=>{});};watchVm();// Renew watch every 60s (TTL is 120s)
const renewInterval=setInterval(watchVm,60000);// Fallback poll at 30s in case SSE is down
const fallbackInterval=setInterval(()=>{fetchVMwareVmDetail(selectedVMware.id,vmwareSelectedVm);},30000);return()=>{clearInterval(renewInterval);clearInterval(fallbackInterval);// Unwatch
authFetch(`${API_URL}/vmware/${selectedVMware.id}/vms/${vmwareSelectedVm}/watch`,{method:'DELETE'}).catch(()=>{});};}else{setVmwareVmDetail(null);}},[selectedVMware?.id,vmwareSelectedVm]);// Fetch datastore detail when selected
useEffect(()=>{if(selectedVMware?.id&&vmwareSelectedDs){const dsId=typeof vmwareSelectedDs==='object'?vmwareSelectedDs.datastore||vmwareSelectedDs.id:vmwareSelectedDs;if(dsId)fetchVMwareDsDetail(selectedVMware.id,dsId);}else{setVmwareDsDetail(null);}},[selectedVMware?.id,vmwareSelectedDs]);// VMware Clone VM
const handleVmwareClone=async(vmId,cloneName)=>{try{const resp=await authFetch(`${API_URL}/vmware/${selectedVMware.id}/vms/${vmId}/clone`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name:cloneName})});if(resp?.ok){addToast(t('success')||'Success',`VM cloned as '${cloneName}'`,'success');setShowVmwareClone(false);fetchVMwareVms(selectedVMware.id);}else{const err=await resp?.json().catch(()=>({}));addToast(t('error')||'Error',err.error||'Clone failed','error');}}catch(e){addToast('Error',e.message,'error');}};// VMware Delete VM
const handleVmwareDeleteVm=async vmId=>{try{const resp=await authFetch(`${API_URL}/vmware/${selectedVMware.id}/vms/${vmId}`,{method:'DELETE'});if(resp?.ok){addToast(t('success')||'Success','VM deleted','success');setShowVmwareDelete(false);setVmwareSelectedVm(null);fetchVMwareVms(selectedVMware.id);}else{const err=await resp?.json().catch(()=>({}));addToast(t('error')||'Error',err.error||'Delete failed','error');}}catch(e){addToast('Error',e.message,'error');}};// VMware Rename VM
const handleVmwareRename=async(vmId,newName)=>{try{const resp=await authFetch(`${API_URL}/vmware/${selectedVMware.id}/vms/${vmId}/rename`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name:newName})});if(resp?.ok){addToast(t('success')||'Success',`VM renamed to '${newName}'`,'success');setShowVmwareRename(false);fetchVMwareVms(selectedVMware.id);fetchVMwareVmDetail(selectedVMware.id,vmId);}else{const err=await resp?.json().catch(()=>({}));addToast(t('error')||'Error',err.error||'Rename failed','error');}}catch(e){addToast('Error',e.message,'error');}};// VMware VM Config Save
const handleVmwareConfigSave=async vmId=>{setVmwareConfigSaving(true);try{const payload={};if(vmwareConfigEdit.cpu)payload.cpu_count=parseInt(vmwareConfigEdit.cpu);if(vmwareConfigEdit.memory)payload.memory_mb=parseInt(vmwareConfigEdit.memory);if(vmwareConfigEdit.notes!==undefined&&vmwareConfigEdit.notes!==null)payload.notes=vmwareConfigEdit.notes;if(vmwareConfigEdit.cpu_hot_add!==undefined)payload.cpu_hot_add=vmwareConfigEdit.cpu_hot_add;if(vmwareConfigEdit.memory_hot_add!==undefined)payload.memory_hot_add=vmwareConfigEdit.memory_hot_add;if(Object.keys(payload).length===0){addToast('No changes','warning');setVmwareConfigSaving(false);return;}const resp=await authFetch(`${API_URL}/vmware/${selectedVMware.id}/vms/${vmId}/config`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(resp?.ok){addToast('VM configuration updated','success');fetchVMwareVmDetail(selectedVMware.id,vmId);fetchVMwareVms(selectedVMware.id);}else{const err=await resp?.json().catch(()=>({}));addToast(err.error||'Config update failed','error');}}catch(e){addToast('Error: '+e.message,'error');}setVmwareConfigSaving(false);};const handleVmwareNetworkChange=async(vmId,nicKey,networkName)=>{try{const resp=await authFetch(`${API_URL}/vmware/${selectedVMware.id}/vms/${vmId}/network`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({nic_key:nicKey,network:networkName})});if(resp?.ok){addToast(`Network changed to '${networkName}'`,'success');fetchVMwareVmDetail(selectedVMware.id,vmId);}else{const err=await resp?.json().catch(()=>({}));addToast(err.error||'Network change failed','error');}}catch(e){addToast('Error: '+e.message,'error');}};const handleVmwareBootOrderSave=async(vmId,bootOrder)=>{try{const resp=await authFetch(`${API_URL}/vmware/${selectedVMware.id}/vms/${vmId}/boot-order`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({boot_order:bootOrder})});if(resp?.ok){addToast('Boot order updated','success');fetchVMwareVmDetail(selectedVMware.id,vmId);}else{const err=await resp?.json().catch(()=>({}));addToast(err.error||'Boot order change failed','error');}}catch(e){addToast('Error: '+e.message,'error');}};// VMware Migration Plan
const fetchMigrationPlan=async vmId=>{try{setVmwareMigrateLoading(true);const resp=await authFetch(`${API_URL}/vmware/${selectedVMware.id}/vms/${vmId}/migration-plan`);if(resp?.ok){const data=await resp.json();setVmwareMigrationPlan(data);setShowVmwareMigrate(true);}else{const err=await resp?.json().catch(()=>({}));addToast('Error',err.error||'Failed to get migration plan','error');}}catch(e){addToast('Error',e.message,'error');}finally{setVmwareMigrateLoading(false);}};// Start VMware Migration
const startVmwareMigration=async vmId=>{try{setVmwareMigrateLoading(true);const resp=await authFetch(`${API_URL}/vmware/${selectedVMware.id}/vms/${vmId}/migrate`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(vmwareMigrateForm)});if(resp?.ok){const data=await resp.json();addToast('Migration Started',`Migration ID: ${data.migration_id}`,'success');setShowVmwareMigrate(false);fetchVmwareMigrations();}else{const err=await resp?.json().catch(()=>({}));addToast('Migration Error',err.error||'Failed to start migration','error');}}catch(e){addToast('Error',e.message,'error');}finally{setVmwareMigrateLoading(false);}};// List VMware Migrations
const fetchVmwareMigrations=async()=>{try{const resp=await authFetch(`${API_URL}/vmware/migrations`);if(resp?.ok){const data=await resp.json();setVmwareMigrations(Array.isArray(data)?data:[]);}}catch(e){}};// VMware Events/Tasks
const fetchVmwareEvents=async()=>{try{setVmwareEventsLoading(true);const resp=await authFetch(`${API_URL}/audit?action=vmware&limit=100`);if(resp?.ok){const data=await resp.json();setVmwareEvents(Array.isArray(data)?data:[]);}}catch(e){}finally{setVmwareEventsLoading(false);}};const fetchMigrationDetail=async mid=>{try{const resp=await authFetch(`${API_URL}/vmware/migrations/${mid}`);if(resp?.ok){const data=await resp.json();setVmwareMigrationDetail(data);}}catch(e){}};React.useEffect(()=>{if(selectedVMware&&vmwareActiveTab==='tasks'){fetchVmwareEvents();fetchVmwareMigrations();// SSE handles real-time updates; polling is just a fallback
const pollInterval=wsConnected?30000:5000;const intv=setInterval(()=>fetchVmwareMigrations(),pollInterval);return()=>clearInterval(intv);}},[selectedVMware?.id,vmwareActiveTab,wsConnected]);React.useEffect(()=>{if(vmwareSelectedMigration){fetchMigrationDetail(vmwareSelectedMigration);// SSE streams logs in real-time; poll less aggressively as fallback
const pollInterval=wsConnected?15000:3000;const intv=setInterval(()=>fetchMigrationDetail(vmwareSelectedMigration),pollInterval);return()=>clearInterval(intv);}},[vmwareSelectedMigration,wsConnected]);// VMware Console Ticket
const openVmwareConsole=async vmId=>{try{const resp=await authFetch(`${API_URL}/vmware/${selectedVMware.id}/vms/${vmId}/console`,{method:'POST'});if(resp?.ok){const data=await resp.json();// Priority: web_url (works in browser) > vmrc_url > url (websocket)
if(data.web_url){window.open(data.web_url,'_blank','width=1024,height=768,menubar=no,toolbar=no');addToast(`Console opened for VM`,'success');}else if(data.vmrc_url){// Try VMRC protocol link
window.location.href=data.vmrc_url;addToast('Opening VMRC...','info');}else if(data.url){// WebSocket URL -- need WebMKS viewer (fallback: open ESXi UI)
const fallbackUrl=`https://${selectedVMware.host}/ui/`;window.open(fallbackUrl,'_blank');addToast('Console ticket obtained - opening vSphere UI','info');}else{// Direct fallback: open vSphere web UI
const directUrl=selectedVMware.server_type==='esxi'?`https://${selectedVMware.host}/ui/#/host/vms`:`https://${selectedVMware.host}/ui/`;window.open(directUrl,'_blank');addToast('Opening vSphere web console','info');}}else{const err=await resp?.json().catch(()=>({}));// Fallback: just open the web UI
const directUrl=`https://${selectedVMware.host}/ui/`;window.open(directUrl,'_blank');addToast('Could not get ticket - opened vSphere UI instead','warning');}}catch(e){// Even on error, try to open the web UI
window.open(`https://${selectedVMware.host}/ui/`,'_blank');addToast('Opening vSphere web UI','info');}};// LW: Check for updates on login (admins only)
useEffect(()=>{if(!isAdmin)return;const checkForUpdate=async()=>{try{const resp=await fetch(`${API_URL}/pegaprox/check-update`,{credentials:'include',headers:getAuthHeaders()});if(resp.ok){const data=await resp.json();if(data.update_available){setPendingUpdate(data);setShowUpdateNotification(true);}}}catch(e){console.log('Update check failed:',e);}};// Delay check slightly to let UI settle
const timer=setTimeout(checkForUpdate,2000);return()=>clearTimeout(timer);},[isAdmin]);useEffect(()=>{// Reset data when switching clusters to avoid showing old data
// NS: Always reset first, even if no cluster selected (prevents cross-cluster leaks)
setClusterMetrics({});setClusterResources([]);setTasks([]);setKnownNodes({});// NS: Clear known nodes when switching clusters
setNodeAlerts({});// Also clear node alerts
setGlobalSnapshots([]);setResourcesSubTab('management');setSnapshotFilterDate('');setSnapshotSortBy('age');setSnapshotSortDir('desc');if(selectedCluster){// Fetch new data
fetchClusterMetrics(selectedCluster.id);fetchClusterResources(selectedCluster.id);fetchMigrationLogs(selectedCluster.id);fetchTasks(selectedCluster.id);// Auto-refresh polling
// NS: If SSE is connected, we poll less frequently as backup only
// SSE provides real-time updates, polling is just a fallback
const taskInterval=setInterval(()=>{// Skip polling if SSE just updated us (within last 3 seconds)
if(Date.now()-taskUpdateTimestamp.current<3000){return;}fetchTasks(selectedCluster.id);},5000);const resourceInterval=setInterval(()=>{fetchClusterMetrics(selectedCluster.id);fetchClusterResources(selectedCluster.id);},15000);const logsInterval=setInterval(()=>{fetchMigrationLogs(selectedCluster.id);},30000);return()=>{clearInterval(taskInterval);clearInterval(resourceInterval);clearInterval(logsInterval);};}},[selectedCluster?.id]);const fetchClusters=async()=>{try{const response=await authFetch(`${API_URL}/clusters`);if(response&&response.ok){const data=await response.json();setClusters(data);// NS: Use ref to avoid stale closure overriding "Alle Cluster" (null) selection
const currentSelected=selectedClusterRef.current;if(currentSelected){const updated=data.find(c=>c.id===currentSelected.id);if(updated)setSelectedCluster(updated);}// fetch status for all clusters (overview)
const connectedClusters=data.filter(c=>c.connected);const allGuests=[];for(const cluster of connectedClusters){try{// datacenter status
const statusResp=await authFetch(`${API_URL}/clusters/${cluster.id}/datacenter/status`);if(statusResp&&statusResp.ok){const statusData=await statusResp.json();setAllClusterMetrics(prev=>({...prev,[cluster.id]:{data:statusData,lastUpdate:new Date()}}));}// get vms/cts for the top guests table
const resourcesResp=await authFetch(`${API_URL}/clusters/${cluster.id}/resources`);if(resourcesResp&&resourcesResp.ok){const resources=await resourcesResp.json();resources.filter(r=>r.type==='qemu'||r.type==='lxc').forEach(r=>{allGuests.push({...r,cluster_id:cluster.id,cluster_name:cluster.display_name||cluster.name});});}}catch(e){console.log(`Failed to fetch data for cluster ${cluster.id}:`,e);}}// sort by combined cpu+ram usage
const runningGuests=allGuests.filter(g=>g.status==='running');runningGuests.sort((a,b)=>{const aScore=(a.cpu||0)*100+(a.maxmem>0?a.mem/a.maxmem*100:0);const bScore=(b.cpu||0)*100+(b.maxmem>0?b.mem/b.maxmem*100:0);return bScore-aScore;});setTopGuests(runningGuests.slice(0,10));}}catch(error){console.error('fetching clusters:',error);}};// NS Jan 2026 - fetch cluster groups for sidebar display
const fetchClusterGroups=async()=>{try{const response=await authFetch(`${API_URL}/cluster-groups`);if(response&&response.ok){setClusterGroups(await response.json());}}catch(error){console.error('fetching cluster groups:',error);}};const fetchClusterMetrics=async clusterId=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/metrics`);if(response&&response.ok){const data=await response.json();// Don't update if we got an error response
if(data.error){console.warn('Metrics returned error:',data.error);return;// Keep old data
}setClusterMetrics(data);// NS: Also update knownNodes when fetching metrics
setKnownNodes(prev=>{const updated={...prev};const now=new Date().toISOString();// Mark all nodes in metrics as online
Object.keys(data||{}).forEach(nodeName=>{// Skip error keys
if(nodeName==='error'||nodeName==='offline')return;updated[nodeName]={status:'online',lastSeen:now,metrics:data[nodeName]};});// DON'T mark nodes as offline just because they're missing from metrics
// This could be a temporary connection issue - let HA events handle this
return updated;});}else if(response&&response.status===503){// Cluster temporarily offline - don't clear data
console.warn('Cluster temporarily offline, keeping cached data');}}catch(error){console.error('fetching metrics:',error);// Don't update state on error - keep old data
}};const fetchClusterResources=async clusterId=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/resources`);if(response&&response.ok){const data=await response.json();setClusterResources(data);// MK: Store in window for access from ConfigModal reassign feature
window.pegaproxVmList=data;setLastUpdate(new Date());// NS: Also track nodes from resources - this includes offline nodes!
const nodeResources=(data||[]).filter(r=>r.type==='node');if(nodeResources.length>0){setKnownNodes(prev=>{const updated={...prev};const now=new Date().toISOString();nodeResources.forEach(nodeRes=>{const nodeName=nodeRes.node;const isOnline=nodeRes.status==='online';if(isOnline){updated[nodeName]={status:'online',lastSeen:now,resourceData:nodeRes};}else if(!updated[nodeName]||updated[nodeName].status==='online'){// Node went offline or is new and offline
updated[nodeName]={...updated[nodeName],status:'offline',offlineSince:updated[nodeName]?.lastSeen||now,resourceData:nodeRes};}});return updated;});}}}catch(error){// silently fail, will retry on next interval
}};// LW: Feb 2026 - fetch metrics+resources for sidebar expansion of non-selected clusters
const fetchSidebarClusterData=async clusterId=>{try{const[metricsRes,resourcesRes]=await Promise.all([authFetch(`${API_URL}/clusters/${clusterId}/metrics`),authFetch(`${API_URL}/clusters/${clusterId}/resources`)]);const metrics=metricsRes&&metricsRes.ok?await metricsRes.json():{};const resources=resourcesRes&&resourcesRes.ok?await resourcesRes.json():[];setSidebarClusterData(prev=>({...prev,[clusterId]:{metrics,resources}}));}catch(e){console.error('sidebar fetch:',e);}};// LW: Feb 2026 - toggle sidebar cluster expansion
const toggleSidebarCluster=clusterId=>{setExpandedSidebarClusters(prev=>{const next={...prev};if(next[clusterId]){delete next[clusterId];}else{next[clusterId]=true;// Fetch data if not the selected cluster (selected has data from clusterMetrics)
if(!selectedCluster||selectedCluster.id!==clusterId){fetchSidebarClusterData(clusterId);}}return next;});};const fetchMigrationLogs=async clusterId=>{try{const response=await authFetch(`${API_URL}/clusters/${clusterId}/migrations`);if(response&&response.ok){const data=await response.json();setMigrationLogs(data);}}catch(e){}// dont care if this fails
};const handleAddCluster=async config=>{setLoading(true);setError(null);try{const response=await authFetch(`${API_URL}/clusters`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(config)});if(response&&response.ok){await fetchClusters();setShowAddModal(false);addToast(t('clusterAdded')||'Cluster added successfully');}else{const err=await response.json();setError(err.error||t('connectionFailed'));}}catch(error){setError(t('connectionError')+': '+error.message);}setLoading(false);};const handleDeleteCluster=async clusterId=>{if(!window.confirm(t('deleteClusterConfirm')))return;try{const response=await authFetch(`${API_URL}/clusters/${clusterId}`,{method:'DELETE'});if(response&&response.ok){await fetchClusters();if(selectedCluster?.id===clusterId)setSelectedCluster(null);addToast(t('clusterDeleted')||'Cluster deleted');}}catch(error){addToast(t('deleteError')||'Delete error','error');}};// Debounced config update - batches rapid changes
const pendingConfigUpdates=useRef({});const configUpdateTimer=useRef(null);const updateConfig=(key,value)=>{if(!selectedCluster)return;// Special handling for HA enable/disable
if(key==='ha_enabled'){handleHAToggle(value);return;}// update local state immediately for responsive UI
setSelectedCluster(prev=>prev?{...prev,[key]:value}:prev);// Batch the update
pendingConfigUpdates.current[key]=value;// Debounce the API call
if(configUpdateTimer.current){clearTimeout(configUpdateTimer.current);}configUpdateTimer.current=setTimeout(async()=>{const updates={...pendingConfigUpdates.current};pendingConfigUpdates.current={};try{const response=await authFetch(`${API_URL}/clusters/${selectedCluster.id}/config`,{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify(updates)});if(response&&response.ok){// Don't refetch - we already updated local state
addToast(t('settingsSaved')||'Settings saved');}else{// Revert on error
fetchClusters();addToast(t('saveError')||'Error saving','error');}}catch(error){fetchClusters();addToast(t('saveError')||'Error saving','error');}},500);// Wait 500ms after last change before saving
};const handleHAToggle=async enable=>{if(!selectedCluster)return;try{const endpoint=enable?'enable':'disable';const response=await authFetch(`${API_URL}/clusters/${selectedCluster.id}/ha/${endpoint}`,{method:'POST'});if(response&&response.ok){setSelectedCluster(prev=>prev?{...prev,ha_enabled:enable}:prev);addToast(enable?t('haEnabled'):t('haDisabled'));// Also update the clusters list
setClusters(prev=>prev.map(c=>c.id===selectedCluster.id?{...c,ha_enabled:enable}:c));}else{const err=await response?.json();addToast(err?.error||t('operationFailed'),'error');}}catch(error){addToast(t('operationFailed'),'error');}};const handleMaintenanceToggle=async(nodeName,enable)=>{if(!selectedCluster)return;try{if(enable){addToast(`${t('startingMaintenanceMode')||'Starting maintenance mode'}: ${nodeName}...`,'info');const response=await authFetch(`${API_URL}/clusters/${selectedCluster.id}/nodes/${nodeName}/maintenance`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({enable:true})});if(response&&response.ok){addToast(`${t('maintenanceModeEnabled')||'Maintenance mode enabled'}: ${nodeName}`);await fetchClusterMetrics(selectedCluster.id);}else{const err=await response.json();addToast(err.error||t('activationError')||'Activation error','error');}}else{const response=await authFetch(`${API_URL}/clusters/${selectedCluster.id}/nodes/${nodeName}/maintenance`,{method:'DELETE'});if(response&&response.ok){addToast(`${t('nodeMaintenanceExited')||'Maintenance mode exited'}: ${nodeName}`);await fetchClusterMetrics(selectedCluster.id);}else{const err=await response.json();addToast(err.error||t('deactivationError')||'Deactivation error','error');}}}catch(error){addToast(t('connectionError'),'error');}};const handleStartUpdate=async(nodeName,reboot)=>{if(!selectedCluster)return;try{addToast(t('startingUpdateFor')+` ${nodeName}...`,'info');const response=await authFetch(`${API_URL}/clusters/${selectedCluster.id}/nodes/${nodeName}/update`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({reboot})});if(response&&response.ok){addToast(t('updateStartedFor')+` ${nodeName}`);await fetchClusterMetrics(selectedCluster.id);}else{const err=await response.json();addToast(err.error||t('errorStartingUpdate'),'error');}}catch(error){addToast(t('connectionError'),'error');}};const handleNodeAction=async(nodeName,action)=>{if(!selectedCluster)return;try{const actionText=action==='reboot'?t('rebootNode'):t('shutdownNode');addToast(`${actionText}: ${nodeName}...`,'info');const response=await authFetch(`${API_URL}/clusters/${selectedCluster.id}/nodes/${nodeName}/action/${action}`,{method:'POST',headers:{'Content-Type':'application/json'}});if(response&&response.ok){addToast(`${nodeName} ${action==='reboot'?t('rebootInitiated'):t('shutdownInitiated')}`,'success');await fetchClusterMetrics(selectedCluster.id);}else{const err=await response.json();if(err.error?.includes('sudo')){addToast(t('sudoNotAvailable'),'error');}else{addToast(err.error||t('nodeActionFailed'),'error');}}}catch(error){addToast(t('connectionError'),'error');}};const handleVmAction=async(resource,action)=>{const cId=resource._clusterId||selectedCluster?.id;if(!cId)return;// LW: Optimistic UI update - show expected status immediately
// This makes the UI feel much snappier while we wait for Proxmox
const expectedStatus={'start':'running','stop':'stopped','shutdown':'stopped','reboot':'running','reset':'running','suspend':'suspended','resume':'running'};if(expectedStatus[action]){setClusterResources(prev=>prev.map(r=>r.vmid===resource.vmid&&r.node===resource.node?{...r,status:expectedStatus[action],_optimistic:true}:r));}// LW: Feb 2026 - track task for corporate panel
const taskId=addRecentTask(`${action} VM`,resource.name||`VM ${resource.vmid}`,'running');try{const response=await fetch(`${API_URL}/clusters/${cId}/vms/${resource.node}/${resource.type}/${resource.vmid}/${action}`,{method:'POST'});if(response&&response.ok){addToast(`${action} ${t('successful')||'successful'}: ${resource.name||resource.vmid}`);updateRecentTask(taskId,'completed');// NS: SSE push_immediate_update will send real status within 500ms
// No need for backup fetch anymore - SSE is reliable
}else{const err=await response.json();addToast(err.error||`${action} ${t('actionFailed')}`,'error');updateRecentTask(taskId,'failed');// Revert optimistic update on error
fetchClusterResources(selectedCluster.id);}}catch(error){addToast(t('connectionError'),'error');updateRecentTask(taskId,'failed');// Revert optimistic update on error
fetchClusterResources(selectedCluster.id);}};const handleMigrate=async(vm,targetNode,online,options={})=>{const cId=vm._clusterId||selectedCluster?.id;if(!cId)return;// NS: Feb 2026 - Track migration task
const taskId=addRecentTask('Migrate VM',`${vm.name||vm.vmid} â†’ ${targetNode}`,'running');try{addToast(t('startingMigration')+` ${vm.name||vm.vmid}...`);const response=await fetch(`${API_URL}/clusters/${cId}/vms/${vm.node}/${vm.type}/${vm.vmid}/migrate`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({target:targetNode,online,targetstorage:options.targetStorage||null,'with-local-disks':options.withLocalDisks||false,force:options.forceConntrack||false})});if(response&&response.ok){addToast(t('migrationStarted')+` ${vm.name||vm.vmid} â†‘ ${targetNode}`);updateRecentTask(taskId,'completed');// NS: SSE push_immediate_update will send real status within 500ms
}else{const err=await response.json();addToast(err.error||t('migrationFailed'),'error');updateRecentTask(taskId,'failed');}}catch(error){addToast(t('connectionError'),'error');updateRecentTask(taskId,'failed');}};const handleBulkMigrate=async(vms,targetNode,online)=>{if(!selectedCluster)return;try{addToast(`${t('startingBulkMigration')} ${vms.length} VMs...`);const response=await fetch(`${API_URL}/clusters/${selectedCluster.id}/vms/bulk-migrate`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({vms,target:targetNode,online})});if(response&&response.ok){const result=await response.json();addToast(`${result.successful}/${result.total} ${t('migrationsStarted')||'migrations started'}`);setTimeout(()=>fetchClusterResources(selectedCluster.id),3000);}else{const err=await response.json();addToast(err.error||t('bulkMigrationFailed'),'error');}}catch(error){addToast(t('connectionError'),'error');}};const handleCreateVm=async(vmType,node,config)=>{if(!selectedCluster)return;try{const endpoint=vmType==='qemu'?'qemu':'lxc';const response=await fetch(`${API_URL}/clusters/${selectedCluster.id}/nodes/${node}/${endpoint}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(config)});if(response&&response.ok){const result=await response.json();addToast(`${vmType==='qemu'?'VM':'Container'} ${result.vmid} ${t('created')||'created'}`);setShowCreateVm(null);setTimeout(()=>fetchClusterResources(selectedCluster.id),2000);}else{const err=await response.json();addToast(err.error||t('creationFailed'),'error');}}catch(error){addToast(t('connectionError'),'error');}};const handleDeleteVm=async(vm,options={})=>{const cId=vm._clusterId||selectedCluster?.id;if(!cId)return;try{const response=await fetch(`${API_URL}/clusters/${cId}/vms/${vm.node}/${vm.type}/${vm.vmid}`,{method:'DELETE',headers:{'Content-Type':'application/json'},body:JSON.stringify(options)});if(response&&response.ok){const result=await response.json();addToast(result.message||`${vm.type==='qemu'?'VM':'Container'} ${vm.vmid} deleted`);setTimeout(()=>fetchClusterResources(selectedCluster.id),2000);}else{const err=await response.json();addToast(err.error||'Delete failed','error');}}catch(error){addToast(t('connectionError'),'error');}};const handleCloneVm=async(vm,cloneConfig)=>{const cId=vm._clusterId||selectedCluster?.id;if(!cId)return;try{const response=await fetch(`${API_URL}/clusters/${cId}/vms/${vm.node}/${vm.type}/${vm.vmid}/clone`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({newid:parseInt(cloneConfig.newid),name:cloneConfig.name,full:cloneConfig.full,target_node:cloneConfig.target_node,description:cloneConfig.description})});if(response&&response.ok){const result=await response.json();addToast(result.message||`${t('cloneStarted')||'Clone started'}: ${vm.vmid} â†‘ ${cloneConfig.newid}`);setShowCloneModal(null);setTimeout(()=>fetchClusterResources(selectedCluster.id),3000);}else{const err=await response.json();addToast(err.error||t('cloneFailed'),'error');}}catch(error){addToast(t('connectionError'),'error');}};const handleForceStop=async resource=>{const cId=resource._clusterId||selectedCluster?.id;if(!cId)return;if(!confirm(`${resource.name||resource.vmid} ${t('forceStopConfirm')}`))return;setActionLoading(prev=>({...prev,[`${resource.vmid}-stop`]:true}));const url=`${API_URL}/clusters/${cId}/vms/${resource.node}/${resource.type}/${resource.vmid}/stop`;console.log('Force Stop URL:',url);console.log('Force Stop body:',JSON.stringify({force:true}));try{const response=await authFetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({force:true})});console.log('Force Stop response:',response);if(response&&response.ok){addToast(`${resource.name||resource.vmid} ${t('forceStopping')}`);setTimeout(()=>fetchClusterResources(selectedCluster.id),2000);}else if(response){const err=await response.json();console.log('Force Stop error:',err);addToast(err.error||t('forceStopFailed'),'error');}else{console.log('No response from authFetch');addToast(t('connectionFailed'),'error');}}catch(error){console.error('Force Stop exception:',error);addToast(t('connectionError'),'error');}setActionLoading(prev=>({...prev,[`${resource.vmid}-stop`]:false}));};const handleCrossClusterMigrate=async migrationConfig=>{try{const response=await authFetch(`${API_URL}/cross-cluster-migrate`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(migrationConfig)});if(response&&response.ok){const result=await response.json();addToast(result.message||t('crossClusterStarted'));setTimeout(()=>fetchClusterResources(selectedCluster.id),5000);}else if(response){const err=await response.json();addToast(err.error||t('crossClusterFailed'),'error');}}catch(error){addToast(t('connectionError'),'error');}};const[consoleVm,setConsoleVm]=useState(null);const[consoleInfo,setConsoleInfo]=useState(null);const[corpMetricsVm,setCorpMetricsVm]=useState(null);// LW: Feb 2026 - metrics modal for corporate view
const[configVm,setConfigVm]=useState(null);const[configNode,setConfigNode]=useState(null);const[showRemoveNodeDash,setShowRemoveNodeDash]=useState(false);const[nodeToRemoveDash,setNodeToRemoveDash]=useState(null);const[showMoveNodeDash,setShowMoveNodeDash]=useState(false);const[nodeToMoveDash,setNodeToMoveDash]=useState(null);const handleOpenConsole=async resource=>{const cId=resource._clusterId||selectedCluster?.id;if(!cId)return;// NS: Feb 2026 - Use correct cluster's host for cross-cluster console
const cluster=clusters.find(c=>c.id===cId)||selectedCluster;setConsoleInfo({vmid:resource.vmid,node:resource.node,type:resource.type,host:cluster?.host});setConsoleVm(resource);};const handleCloseConsole=()=>{setConsoleVm(null);setConsoleInfo(null);};const handleOpenConfig=resource=>{setConfigVm(resource);};const handleCloseConfig=()=>{// NS: Feb 2026 - Refresh correct cluster's resources after config changes
const cId=configVm?._clusterId||selectedCluster?.id;setConfigVm(null);if(cId)fetchClusterResources(cId);};return/*#__PURE__*/React.createElement("div",{className:"min-h-screen bg-proxmox-darker text-white"},/*#__PURE__*/React.createElement(PasswordExpiryBanner,{onChangePassword:()=>setShowProfile(true)}),/*#__PURE__*/React.createElement(NodeAlertBanner,{alerts:nodeAlerts,currentClusterId:selectedCluster?.id,onDismiss:nodeName=>setNodeAlerts(prev=>{const newAlerts={...prev};delete newAlerts[nodeName];return newAlerts;})}),!isCorporate&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 gradient-mesh pointer-events-none"}),/*#__PURE__*/React.createElement("header",{className:`sticky top-0 z-30 border-b border-proxmox-border ${isCorporate?'bg-proxmox-darker':'bg-proxmox-dark/80 backdrop-blur-xl'}`},/*#__PURE__*/React.createElement("div",{className:`${isCorporate?'max-w-full px-3 py-1.5':'max-w-[1600px] mx-auto px-6 py-4'}`},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setSelectedCluster(null);setSelectedPBS(null);setSelectedVMware(null);},className:`flex items-center ${isCorporate?'gap-2':'gap-4'} hover:opacity-80 transition-opacity`,title:t('allClustersOverview')||'All Clusters Overview'},/*#__PURE__*/React.createElement("img",{src:"/images/pegaprox.png",alt:"PegaProx",className:`${isCorporate?'w-6 h-6':'w-10 h-10 rounded-xl'} object-contain`,onError:e=>{e.target.style.display='none';e.target.nextSibling.style.display='flex';}}),/*#__PURE__*/React.createElement("div",{className:`${isCorporate?'w-6 h-6 bg-proxmox-orange':'w-10 h-10 rounded-xl bg-gradient-to-br from-proxmox-orange to-orange-600 shadow-lg glow-orange'} items-center justify-center hidden`},/*#__PURE__*/React.createElement("svg",{viewBox:"0 0 24 24",className:`${isCorporate?'w-3.5 h-3.5':'w-6 h-6'} text-white`,fill:"currentColor"},/*#__PURE__*/React.createElement("path",{d:"M12 2C9.5 2 7 3.5 6 6c-1.5 0-3 1-3 3 0 1.5 1 2.5 2 3l1 6c0 1 1 2 2 2h8c1 0 2-1 2-2l1-6c1-.5 2-1.5 2-3 0-2-1.5-3-3-3-1-2.5-3.5-4-6-4zm0 2c2 0 3.5 1 4 3H8c.5-2 2-3 4-3zM5 9h14c.5 0 1 .5 1 1s-.5 1.5-1 2l-1 5H6l-1-5c-.5-.5-1-1-1-2s.5-1 1-1zm7 1a2 2 0 100 4 2 2 0 000-4z"}))),isCorporate?/*#__PURE__*/React.createElement("span",{className:"text-sm font-semibold"},"PegaProx"):/*#__PURE__*/React.createElement("div",{className:"text-left"},/*#__PURE__*/React.createElement("h1",{className:"text-xl font-bold"},"PegaProx"),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},t('clusterManagement')))),isCorporate&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1 text-[13px] text-gray-400 ml-1 border-l border-proxmox-border pl-3"},/*#__PURE__*/React.createElement("span",{className:"hover:text-white cursor-pointer",onClick:()=>{setSelectedCluster(null);setSelectedPBS(null);setSelectedVMware(null);setSelectedGroup(null);}},t('breadcrumbAll')||'All'),(selectedGroup||selectedCluster||selectedPBS||selectedVMware)&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Icons.ChevronRight,{className:"w-3 h-3 text-gray-600"}),/*#__PURE__*/React.createElement("span",{className:selectedCluster||selectedPBS||selectedVMware?'hover:text-white cursor-pointer':'text-gray-200'},selectedGroup?.name||selectedCluster?.name||selectedPBS?.name||selectedVMware?.name)),selectedCluster&&selectedGroup&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Icons.ChevronRight,{className:"w-3 h-3 text-gray-600"}),/*#__PURE__*/React.createElement("span",{className:"text-gray-200"},selectedCluster.name)),activeTab&&selectedCluster&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Icons.ChevronRight,{className:"w-3 h-3 text-gray-600"}),/*#__PURE__*/React.createElement("span",{className:selectedSidebarVm||selectedSidebarNode?'hover:text-white cursor-pointer':'text-gray-300',onClick:()=>{if(selectedSidebarVm)setSelectedSidebarVm(null);if(selectedSidebarNode)setSelectedSidebarNode(null);}},t(activeTab))),selectedSidebarVm&&activeTab==='resources'&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Icons.ChevronRight,{className:"w-3 h-3 text-gray-600"}),/*#__PURE__*/React.createElement("span",{className:"text-gray-200"},selectedSidebarVm.name||`VM ${selectedSidebarVm.vmid}`)),selectedSidebarNode&&activeTab==='overview'&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Icons.ChevronRight,{className:"w-3 h-3 text-gray-600"}),/*#__PURE__*/React.createElement("span",{className:"text-gray-200"},selectedSidebarNode.name)))),/*#__PURE__*/React.createElement("div",{className:`flex items-center ${isCorporate?'gap-2 flex-1 justify-end':'gap-3'}`},/*#__PURE__*/React.createElement("div",{className:`relative ${isCorporate?'flex-1':''}`},/*#__PURE__*/React.createElement("div",{className:`flex items-center ${isCorporate?'bg-[#17242b]':'bg-proxmox-dark'} border border-proxmox-border rounded-lg overflow-hidden focus-within:border-proxmox-orange/50 transition-colors`},/*#__PURE__*/React.createElement(Icons.Search,{className:"w-4 h-4 ml-3 text-gray-500 flex-shrink-0"}),/*#__PURE__*/React.createElement("input",{ref:globalSearchRef,type:"text",placeholder:isCorporate?t('searchAllInventories')||'Search in all inventories...':t('searchAllClusters')||'Search all clusters...',value:globalSearchQuery,onChange:e=>{setGlobalSearchQuery(e.target.value);debouncedSearch(e.target.value);},onFocus:()=>setShowGlobalSearch(true),onKeyDown:e=>{const items=globalSearchResults?.results||[];if(e.key==='ArrowDown'){e.preventDefault();setGlobalSearchIndex(prev=>Math.min(prev+1,Math.min(items.length-1,19)));}else if(e.key==='ArrowUp'){e.preventDefault();setGlobalSearchIndex(prev=>Math.max(prev-1,0));}else if(e.key==='Enter'&&items.length>0){e.preventDefault();navigateToResult(items[globalSearchIndex]);}else if(e.key==='Escape'){setShowGlobalSearch(false);e.target.blur();}},className:`${isCorporate?'w-48 md:w-72 lg:w-96 px-2 py-1.5':'w-48 md:w-72 lg:w-80 px-2 py-2'} bg-transparent text-white placeholder-gray-500 focus:outline-none text-sm`}),globalSearchLoading?/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-4 h-4 mr-3 text-gray-400 animate-spin flex-shrink-0"}):/*#__PURE__*/React.createElement("kbd",{className:"hidden md:inline-flex mr-3 px-1.5 py-0.5 text-xs text-gray-500 bg-proxmox-secondary rounded border border-proxmox-border flex-shrink-0"},navigator.platform?.includes('Mac')?'âŒ˜':'Ctrl+',"K")),showGlobalSearch&&globalSearchResults&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-40",onClick:()=>setShowGlobalSearch(false)}),/*#__PURE__*/React.createElement("div",{className:"absolute top-full right-0 md:left-0 mt-2 w-[28rem] max-h-[32rem] overflow-y-auto bg-proxmox-card border border-proxmox-border rounded-xl shadow-2xl z-50"},/*#__PURE__*/React.createElement("div",{className:"p-3 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-400"},globalSearchResults.count," ",t('results')||'results',globalSearchResults.query?.startsWith('tag:')&&' (Tag-Suche)'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowGlobalSearch(false),className:"text-gray-500 hover:text-white"},/*#__PURE__*/React.createElement(Icons.X,{className:"w-4 h-4"}))),globalSearchResults.tag_suggestions?.length>0&&!globalSearchQuery.startsWith('tag:')&&/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-1 mt-2"},/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 mr-1"},"Tags:"),globalSearchResults.tag_suggestions.slice(0,6).map((tag,i)=>/*#__PURE__*/React.createElement("button",{key:i,onClick:()=>{setGlobalSearchQuery(`tag:${tag}`);performGlobalSearch(`tag:${tag}`);},className:"px-1.5 py-0.5 text-xs rounded bg-proxmox-orange/20 text-proxmox-orange hover:bg-proxmox-orange/30 transition-colors"},tag)))),globalSearchResults.results.length===0?/*#__PURE__*/React.createElement("div",{className:"p-6 text-center text-gray-500"},/*#__PURE__*/React.createElement(Icons.Search,{className:"mx-auto mb-2 opacity-50"}),/*#__PURE__*/React.createElement("p",null,t('noResults')||'No results'),/*#__PURE__*/React.createElement("p",{className:"text-xs mt-2 text-gray-600"},"Tipp: tag:web, node:pve1, ip:192.168")):/*#__PURE__*/React.createElement("div",{className:"divide-y divide-proxmox-border"},globalSearchResults.results.slice(0,20).map((result,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:`p-3 hover:bg-proxmox-hover cursor-pointer flex items-center gap-3 transition-colors ${idx===globalSearchIndex?'bg-proxmox-orange/10 border-l-2 border-proxmox-orange':'border-l-2 border-transparent'}`,onClick:()=>navigateToResult(result),onMouseEnter:()=>setGlobalSearchIndex(idx)},/*#__PURE__*/React.createElement("span",{className:"text-lg flex-shrink-0"},result.type==='node'?'ðŸ–§':result.type==='ct'?'ðŸ“¦':'ðŸ–¥ï¸'),/*#__PURE__*/React.createElement("div",{className:"flex-1 min-w-0"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 flex-wrap"},/*#__PURE__*/React.createElement("span",{className:"font-medium truncate"},result.name),result.vmid&&/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},"#",result.vmid),/*#__PURE__*/React.createElement("span",{className:`px-1.5 py-0.5 text-xs rounded ${result.status==='running'?'bg-green-500/20 text-green-400':result.status==='stopped'?'bg-gray-500/20 text-gray-400':'bg-yellow-500/20 text-yellow-400'}`},result.status),result.match_field==='tag'&&/*#__PURE__*/React.createElement("span",{className:"px-1.5 py-0.5 text-xs rounded bg-purple-500/20 text-purple-400"},"Tag-Match")),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 flex items-center gap-2 mt-0.5"},/*#__PURE__*/React.createElement("span",null,result.cluster_name),result.node&&/*#__PURE__*/React.createElement("span",null,"\u2022 ",result.node),result.ip&&/*#__PURE__*/React.createElement("span",null,"\u2022 ",result.ip)),result.tags&&/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-1 mt-1"},result.tags.split(';').filter(t=>t.trim()).slice(0,4).map((tag,i)=>/*#__PURE__*/React.createElement("span",{key:i,className:`px-1.5 py-0.5 text-xs rounded ${globalSearchQuery.toLowerCase().replace('tag:','').split(',').some(q=>tag.trim().toLowerCase().includes(q.trim()))?'bg-proxmox-orange/30 text-proxmox-orange ring-1 ring-proxmox-orange/50':'bg-proxmox-dark text-gray-400'}`},tag.trim())),result.tags.split(';').filter(t=>t.trim()).length>4&&/*#__PURE__*/React.createElement("span",{className:"px-1.5 py-0.5 text-xs rounded bg-proxmox-dark text-gray-500"},"+",result.tags.split(';').filter(t=>t.trim()).length-4))),/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();toggleFavorite(result.type,result.cluster_id,result.vmid,result.type==='vm'?'qemu':'lxc',result.name);},className:"p-1 hover:bg-proxmox-dark rounded text-gray-500 hover:text-yellow-400 flex-shrink-0",title:t('toggleFavorite')||'Toggle favorite'},/*#__PURE__*/React.createElement(Icons.Star,{className:`w-4 h-4 ${isFavorite(result.type,result.cluster_id,result.vmid,result.name)?'fill-yellow-400 text-yellow-400':''}`}))))),globalSearchResults.results.length>0&&/*#__PURE__*/React.createElement("div",{className:"p-2 border-t border-proxmox-border text-xs text-gray-500 flex items-center gap-3"},/*#__PURE__*/React.createElement("span",{className:"flex items-center gap-1"},/*#__PURE__*/React.createElement("kbd",{className:"px-1 py-0.5 bg-proxmox-dark rounded text-gray-400"},"\u2191\u2193"),"navigate"),/*#__PURE__*/React.createElement("span",{className:"flex items-center gap-1"},/*#__PURE__*/React.createElement("kbd",{className:"px-1.5 py-0.5 bg-proxmox-dark rounded text-gray-400"},"\u21B5"),t('pressEnterToOpen')||'jump to VM'),/*#__PURE__*/React.createElement("span",{className:"flex items-center gap-1"},/*#__PURE__*/React.createElement("kbd",{className:"px-1 py-0.5 bg-proxmox-dark rounded text-gray-400"},"esc"),"close")),globalSearchResults.results.length>0&&/*#__PURE__*/React.createElement("div",{className:"p-2 border-t border-proxmox-border text-xs text-gray-500 flex items-center gap-2"},/*#__PURE__*/React.createElement("kbd",{className:"px-1.5 py-0.5 bg-proxmox-dark rounded text-gray-400"},"\u2191\xB5"),/*#__PURE__*/React.createElement("span",null,t('pressEnterToOpen')||'Press Enter to jump to VM'))))),/*#__PURE__*/React.createElement(LanguageSwitcher,null),isAdmin&&/*#__PURE__*/React.createElement("button",{onClick:()=>setShowSettings(true),className:`${isCorporate?'p-1.5':'p-2.5'} bg-proxmox-dark border border-proxmox-border rounded-lg hover:border-proxmox-orange/50 transition-colors text-gray-400 hover:text-white`,title:t('pegaproxSettings')},/*#__PURE__*/React.createElement(Icons.Settings,{className:isCorporate?'w-4 h-4':undefined})),!isCorporate&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg",title:wsConnected?'Live-Updates aktiv':'Polling-Modus'},/*#__PURE__*/React.createElement("div",{className:`w-2 h-2 rounded-full ${wsConnected?'bg-green-500 animate-pulse':'bg-yellow-500'}`}),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-400 hidden sm:inline"},wsConnected?'Live':'Polling')),!isCorporate&&isAdmin&&/*#__PURE__*/React.createElement("div",{className:"relative"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddDropdown(!showAddDropdown),className:"flex items-center gap-2 px-4 py-2.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg font-medium transition-all hover:shadow-lg hover:shadow-proxmox-orange/25"},/*#__PURE__*/React.createElement(Icons.Plus,null),/*#__PURE__*/React.createElement("span",null,t('addCluster')),/*#__PURE__*/React.createElement(Icons.ChevronDown,{className:"w-3.5 h-3.5 ml-0.5 opacity-70"})),showAddDropdown&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-40",onClick:()=>setShowAddDropdown(false)}),/*#__PURE__*/React.createElement("div",{className:"absolute right-0 top-full mt-2 w-64 bg-proxmox-card border border-proxmox-border rounded-xl shadow-2xl z-50 overflow-hidden animate-scale-in"},[{id:'proxmox',label:'Proxmox VE',desc:t('pveClusterDesc')||'Virtual machines & containers',icon:Icons.Server,color:'text-orange-400',bg:'bg-orange-500/10'},{id:'pbs',label:'Proxmox Backup Server',desc:t('pbsDesc')||'Backup management',icon:Icons.Shield,color:'text-blue-400',bg:'bg-blue-500/10'},{id:'vmware',label:'ESXi',desc:t('vmwareDesc')||'ESXi infrastructure',icon:Icons.Cloud,color:'text-emerald-400',bg:'bg-emerald-500/10'}].map(item=>/*#__PURE__*/React.createElement("button",{key:item.id,onClick:()=>{setAddClusterType(item.id);setShowAddDropdown(false);setShowAddModal(true);},className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-proxmox-dark/80 transition-colors text-left"},/*#__PURE__*/React.createElement("div",{className:`p-2 rounded-lg ${item.bg}`},/*#__PURE__*/React.createElement(item.icon,{className:`w-4 h-4 ${item.color}`})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-sm font-medium text-white"},item.label),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},item.desc))))))),false&&!showTaskBar&&tasks.length>0&&/*#__PURE__*/React.createElement("button",{onClick:()=>setShowTaskBar(true),className:"relative flex items-center gap-2 px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg hover:border-proxmox-orange/50 transition-colors",title:t('tasks')},/*#__PURE__*/React.createElement(Icons.Layers,null),tasks.filter(task=>task&&task.status==='running').length>0&&/*#__PURE__*/React.createElement("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-500 rounded-full text-xs flex items-center justify-center animate-pulse"},tasks.filter(task=>task&&task.status==='running').length),tasks.filter(task=>task&&(task.status==='failed'||task.status==='error')).length>0&&/*#__PURE__*/React.createElement("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full text-xs flex items-center justify-center"},tasks.filter(task=>task&&(task.status==='failed'||task.status==='error')).length)),/*#__PURE__*/React.createElement("div",{className:"relative z-50"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowUserMenu(!showUserMenu),className:`flex items-center gap-2 ${isCorporate?'px-2 py-1':'px-3 py-2'} bg-proxmox-dark border border-proxmox-border rounded-lg hover:border-proxmox-orange/50 transition-colors`},/*#__PURE__*/React.createElement("div",{className:`${isCorporate?'w-6 h-6 text-[11px]':'w-8 h-8'} rounded-full bg-proxmox-orange/20 flex items-center justify-center text-proxmox-orange font-semibold`},user?.username?.[0]?.toUpperCase()||'U'),!isCorporate&&/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300 hidden sm:inline"},user?.display_name||user?.username),/*#__PURE__*/React.createElement(Icons.ChevronDown,{className:isCorporate?'w-3 h-3':undefined})),showUserMenu&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-40",onClick:()=>setShowUserMenu(false)}),/*#__PURE__*/React.createElement("div",{className:"absolute right-0 top-full mt-2 w-56 bg-proxmox-card border border-proxmox-border rounded-xl shadow-xl z-50 overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-3 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("p",{className:"font-medium text-white"},user?.display_name||user?.username),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-400"},user?.role==='admin'?t('roleAdmin'):user?.role==='user'?t('roleUser'):t('roleViewer'))),/*#__PURE__*/React.createElement("div",{className:"py-1"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowUserMenu(false);setShowProfile(true);},className:"w-full px-4 py-2 text-left text-gray-300 hover:bg-proxmox-hover transition-colors flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.User,null),t('myProfile')),isAdmin&&/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowUserMenu(false);setShowSettings(true);},className:"w-full px-4 py-2 text-left text-gray-300 hover:bg-proxmox-hover transition-colors flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Settings,null),t('pegaproxSettings')),/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowUserMenu(false);logout();},className:"w-full px-4 py-2 text-left text-red-400 hover:bg-red-500/10 transition-colors flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.LogOut,null),t('logout')))))))))),isCorporate&&!warningBannerDismissed&&(()=>{const alertMessages=[];const offlineAlerts=Object.values(nodeAlerts||{}).filter(a=>a.status==='offline');if(offlineAlerts.length>0)alertMessages.push(`${offlineAlerts.length} node(s) offline`);const disconnected=clusters.filter(c=>c.connected===false);if(disconnected.length>0)alertMessages.push(`${disconnected.length} cluster(s) disconnected`);if(alertMessages.length===0)return null;return/*#__PURE__*/React.createElement("div",{className:"corp-warning-banner"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4 flex-shrink-0",style:{color:'#efc006'}}),/*#__PURE__*/React.createElement("span",null,alertMessages.join(' | '))),/*#__PURE__*/React.createElement("button",{className:"corp-warning-dismiss",onClick:()=>setWarningBannerDismissed(true)},t('dismiss')||'DISMISS'));})(),/*#__PURE__*/React.createElement("div",{className:`relative ${isCorporate?'max-w-full mx-0 px-0 py-0':'max-w-[1600px] mx-auto px-6 py-6'}`},/*#__PURE__*/React.createElement("div",{className:`flex ${isCorporate?'gap-0':'gap-6'}`},/*#__PURE__*/React.createElement("div",{className:`${isCorporate?'flex-shrink-0 corporate-sidebar':'w-72 flex-shrink-0'}`,style:isCorporate?{width:sidebarWidth+'px'}:undefined},/*#__PURE__*/React.createElement("div",{className:`sticky top-6 ${isCorporate?'space-y-0.5 px-1 py-2':'space-y-3 pr-1'} pb-4`,style:{maxHeight:'calc(100vh - 3rem)',overflowY:'auto',overflowX:'hidden',scrollbarWidth:'thin',scrollbarColor:'#4a4a4a transparent'}},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between px-1"},/*#__PURE__*/React.createElement("h2",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider"},t('clusters')),isAdmin&&(isCorporate?/*#__PURE__*/React.createElement("button",{onClick:()=>{setAddClusterType('proxmox');setShowAddModal(true);},className:"p-0.5 text-gray-600 hover:text-gray-300 transition-colors",title:t('addCluster')||'Add Cluster'},/*#__PURE__*/React.createElement(Icons.Plus,{className:"w-3 h-3"})):/*#__PURE__*/React.createElement("button",{onClick:()=>setShowGroupManager(true),className:"p-1 text-gray-500 hover:text-proxmox-orange rounded transition-colors",title:t('manageGroups')||'Manage Groups'},/*#__PURE__*/React.createElement(Icons.FolderPlus,{className:"w-4 h-4"})))),clusters.length===0?/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-6 text-center"},/*#__PURE__*/React.createElement("div",{className:"w-12 h-12 mx-auto mb-3 rounded-full bg-proxmox-dark flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Server,null)),/*#__PURE__*/React.createElement("p",{className:"text-gray-400 text-sm"},t('noClusterSelected')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddModal(true),className:"mt-3 text-proxmox-orange text-sm hover:underline"},t('addFirstCluster'))):/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setSelectedCluster(null);setSelectedPBS(null);setSelectedVMware(null);setSelectedGroup(null);},className:`w-full flex items-center ${isCorporate?'gap-1.5 pl-1 pr-2 py-0.5 text-[13px] leading-5':`gap-3 px-3 py-2.5 rounded-xl transition-all ${!selectedCluster&&!selectedPBS&&!selectedVMware&&!selectedGroup?'bg-gradient-to-r from-proxmox-orange/20 to-orange-600/10 border border-proxmox-orange/30 text-white':'bg-proxmox-card border border-proxmox-border hover:border-proxmox-orange/30 text-gray-300 hover:text-white'}`}`,style:isCorporate?!selectedCluster&&!selectedPBS&&!selectedVMware&&!selectedGroup?{background:'#324f61',color:'#e9ecef'}:{color:'#adbbc4'}:undefined,onMouseEnter:isCorporate?e=>{if(selectedCluster||selectedPBS||selectedVMware||selectedGroup){e.currentTarget.style.background='#29414e';e.currentTarget.style.color='#e9ecef';}}:undefined,onMouseLeave:isCorporate?e=>{if(selectedCluster||selectedPBS||selectedVMware||selectedGroup){e.currentTarget.style.background='';e.currentTarget.style.color='#adbbc4';}}:undefined},isCorporate?/*#__PURE__*/React.createElement(Icons.Database,{className:"w-3.5 h-3.5 flex-shrink-0",style:{color:'#49afd9'}}):/*#__PURE__*/React.createElement("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${!selectedCluster&&!selectedPBS&&!selectedVMware&&!selectedGroup?'bg-proxmox-orange/20':'bg-proxmox-dark'}`},/*#__PURE__*/React.createElement(Icons.Grid,{className:"w-4 h-4"})),/*#__PURE__*/React.createElement("span",{className:isCorporate?'flex-1 text-left truncate':'flex-1 text-left'},isCorporate?t('allClusters')||'All Clusters':/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-sm font-medium"},t('allClusters')||'All Clusters'),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},clusters.length," ",t('clusters').toLowerCase()))),!isCorporate&&!selectedCluster&&!selectedPBS&&!selectedVMware&&!selectedGroup&&/*#__PURE__*/React.createElement("div",{className:"w-2 h-2 rounded-full bg-proxmox-orange"})),clusterGroups.map(group=>{const groupClusters=clusters.filter(c=>c.group_id===group.id);if(groupClusters.length===0)return null;const isCollapsed=collapsedGroups[group.id];return/*#__PURE__*/React.createElement("div",{key:group.id,className:"space-y-2"},/*#__PURE__*/React.createElement("div",{className:`w-full flex items-center gap-2 px-2 ${isCorporate?'py-1':'py-1.5 rounded-lg'} hover:bg-proxmox-hover transition-colors ${selectedGroup?.id===group.id?isCorporate?'bg-proxmox-hover text-white':'bg-proxmox-orange/5 border-l-2 border-l-proxmox-orange':''}`},/*#__PURE__*/React.createElement("button",{onClick:()=>setCollapsedGroups(prev=>({...prev,[group.id]:!prev[group.id]})),className:"w-4 h-4 flex items-center justify-center text-gray-500 hover:text-white"},isCollapsed?/*#__PURE__*/React.createElement(Icons.ChevronRight,{className:"w-3 h-3"}):/*#__PURE__*/React.createElement(Icons.ChevronDown,{className:"w-3 h-3"})),/*#__PURE__*/React.createElement("button",{onClick:()=>{setSelectedGroup(group);setSelectedCluster(null);setSelectedPBS(null);setSelectedVMware(null);},className:`flex items-center gap-2 flex-1 text-left ${selectedGroup?.id===group.id?'text-white':'text-gray-300 hover:text-white'}`},/*#__PURE__*/React.createElement(Icons.Folder,{className:"w-4 h-4",style:{color:group.color||'#E86F2D'}}),/*#__PURE__*/React.createElement("span",{className:"text-sm flex-1"},group.name)),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},groupClusters.length)),!isCollapsed&&/*#__PURE__*/React.createElement("div",{className:isCorporate?'ml-5 space-y-0':'ml-4 space-y-1.5'},groupClusters.map((cluster,idx)=>/*#__PURE__*/React.createElement(React.Fragment,{key:cluster.id},/*#__PURE__*/React.createElement(ClusterSidebarItem,{cluster:cluster,idx:idx,selectedCluster:selectedCluster,setSelectedCluster:setSelectedCluster,nodeAlerts:nodeAlerts,clusterGroups:clusterGroups,isAdmin:isAdmin,handleDeleteCluster:handleDeleteCluster,setShowAssignGroup:setShowAssignGroup,t:t,getAuthHeaders:getAuthHeaders,fetchClusters:fetchClusters,addToast:addToast,isCorporate:isCorporate,expandedSidebarClusters:expandedSidebarClusters,toggleSidebarCluster:toggleSidebarCluster}),renderInlineNodeTree(cluster.id)))));}),(()=>{const ungroupedClusters=clusters.filter(c=>!c.group_id||!clusterGroups.find(g=>g.id===c.group_id));if(ungroupedClusters.length===0)return null;return/*#__PURE__*/React.createElement("div",{className:isCorporate?'space-y-0':'space-y-1.5'},clusterGroups.length>0&&/*#__PURE__*/React.createElement("div",{className:`flex items-center gap-2 px-2 ${isCorporate?'py-0.5':'py-1.5'} text-gray-500`},/*#__PURE__*/React.createElement(Icons.Server,{className:isCorporate?'w-3.5 h-3.5':'w-4 h-4'}),/*#__PURE__*/React.createElement("span",{className:"text-xs uppercase tracking-wider"},t('ungrouped'))),ungroupedClusters.map((cluster,idx)=>/*#__PURE__*/React.createElement(React.Fragment,{key:cluster.id},/*#__PURE__*/React.createElement(ClusterSidebarItem,{cluster:cluster,idx:idx,selectedCluster:selectedCluster,setSelectedCluster:setSelectedCluster,nodeAlerts:nodeAlerts,clusterGroups:clusterGroups,isAdmin:isAdmin,handleDeleteCluster:handleDeleteCluster,setShowAssignGroup:setShowAssignGroup,t:t,getAuthHeaders:getAuthHeaders,fetchClusters:fetchClusters,addToast:addToast,isCorporate:isCorporate,expandedSidebarClusters:expandedSidebarClusters,toggleSidebarCluster:toggleSidebarCluster}),renderInlineNodeTree(cluster.id))));})())),pbsServers.length>0&&/*#__PURE__*/React.createElement("div",{className:"mt-4 pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between px-1 mb-2"},/*#__PURE__*/React.createElement("h2",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider"},"Backup Servers"),isAdmin&&/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddPBS(true),className:"p-1 text-gray-500 hover:text-proxmox-orange rounded transition-colors",title:"Add PBS"},/*#__PURE__*/React.createElement(Icons.Plus,{className:"w-4 h-4"}))),/*#__PURE__*/React.createElement("div",{className:"space-y-1.5"},pbsServers.map(pbs=>/*#__PURE__*/React.createElement("button",{key:pbs.id,onClick:()=>{setSelectedPBS(pbs);setSelectedCluster(null);setSelectedVMware(null);setPbsActiveTab('dashboard');setPbsSelectedStore(null);},className:isCorporate?'w-full flex items-center gap-1.5 pl-3 pr-2 py-0.5 text-[13px] leading-5':`w-full flex items-center gap-3 px-3 py-2 rounded-xl transition-all ${selectedPBS?.id===pbs.id&&!selectedCluster?'bg-gradient-to-r from-blue-500/20 to-blue-600/10 border border-blue-500/30 text-white':'bg-proxmox-card border border-proxmox-border hover:border-blue-500/30 text-gray-300 hover:text-white'}`,style:isCorporate?selectedPBS?.id===pbs.id&&!selectedCluster?{background:'#324f61',color:'#e9ecef'}:{color:'#adbbc4'}:undefined,onMouseEnter:isCorporate?e=>{if(!(selectedPBS?.id===pbs.id&&!selectedCluster)){e.currentTarget.style.background='#29414e';e.currentTarget.style.color='#e9ecef';}}:undefined,onMouseLeave:isCorporate?e=>{if(!(selectedPBS?.id===pbs.id&&!selectedCluster)){e.currentTarget.style.background='';e.currentTarget.style.color='#adbbc4';}}:undefined},isCorporate?/*#__PURE__*/React.createElement(Icons.Shield,{className:"w-3.5 h-3.5 flex-shrink-0",style:{color:'#49afd9'}}):/*#__PURE__*/React.createElement("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${selectedPBS?.id===pbs.id&&!selectedCluster?'bg-blue-500/20':'bg-proxmox-dark'}`},/*#__PURE__*/React.createElement(Icons.Shield,{className:"w-4 h-4 text-blue-400"})),/*#__PURE__*/React.createElement("div",{className:"flex-1 text-left min-w-0"},/*#__PURE__*/React.createElement("div",{className:`${isCorporate?'text-[13px]':'text-sm'} font-medium truncate`},pbs.name),!isCorporate&&/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 truncate"},pbs.host,":",pbs.port)),/*#__PURE__*/React.createElement("div",{className:"w-1.5 h-1.5 rounded-full shrink-0",style:{background:pbs.connected?'#60b515':'#f54f47'}}))))),!isCorporate&&pbsServers.length===0&&isAdmin&&/*#__PURE__*/React.createElement("div",{className:"mt-4 pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAddPBS(true),className:"w-full flex items-center gap-2 px-3 py-2 rounded-xl bg-proxmox-card border border-dashed border-proxmox-border text-gray-500 hover:text-blue-400 hover:border-blue-500/30 transition-all text-sm"},/*#__PURE__*/React.createElement(Icons.Shield,{className:"w-4 h-4"}),/*#__PURE__*/React.createElement("span",null,"Add Backup Server"))),vmwareServers.length>0&&/*#__PURE__*/React.createElement("div",{className:"mt-4 pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between px-1 mb-2"},/*#__PURE__*/React.createElement("h2",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider"},"ESXi"),isAdmin&&/*#__PURE__*/React.createElement("button",{onClick:()=>{setEditingVMware(null);setVmwareForm({name:'',host:'',port:443,username:'root',password:'',ssl_verify:false,notes:''});setShowAddVMware(true);},className:"p-1 text-gray-500 hover:text-proxmox-orange rounded transition-colors",title:"Add ESXi Server"},/*#__PURE__*/React.createElement(Icons.Plus,{className:"w-4 h-4"}))),/*#__PURE__*/React.createElement("div",{className:"space-y-1.5"},vmwareServers.map(vmw=>{const vmwSelected=selectedVMware?.id===vmw.id&&!selectedCluster&&!selectedPBS;return/*#__PURE__*/React.createElement("button",{key:vmw.id,onClick:()=>{setSelectedVMware(vmw);setSelectedCluster(null);setSelectedPBS(null);setVmwareActiveTab('vms');setVmwareSelectedVm(null);},className:isCorporate?'w-full flex items-center gap-1.5 pl-3 pr-2 py-0.5 text-[13px] leading-5':`w-full flex items-center gap-3 px-3 py-2 rounded-xl transition-all ${vmwSelected?'bg-gradient-to-r from-emerald-500/20 to-green-600/10 border border-emerald-500/30 text-white':'bg-proxmox-card border border-proxmox-border hover:border-emerald-500/30 text-gray-300 hover:text-white'}`,style:isCorporate?vmwSelected?{background:'#324f61',color:'#e9ecef'}:{color:'#adbbc4'}:undefined,onMouseEnter:isCorporate?e=>{if(!vmwSelected){e.currentTarget.style.background='#29414e';e.currentTarget.style.color='#e9ecef';}}:undefined,onMouseLeave:isCorporate?e=>{if(!vmwSelected){e.currentTarget.style.background='';e.currentTarget.style.color='#adbbc4';}}:undefined},isCorporate?/*#__PURE__*/React.createElement(Icons.Cloud,{className:"w-3.5 h-3.5 flex-shrink-0",style:{color:'#49afd9'}}):/*#__PURE__*/React.createElement("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${vmwSelected?'bg-emerald-500/20':'bg-proxmox-dark'}`},/*#__PURE__*/React.createElement(Icons.Cloud,{className:"w-4 h-4 text-emerald-400"})),/*#__PURE__*/React.createElement("div",{className:"flex-1 text-left min-w-0"},/*#__PURE__*/React.createElement("div",{className:`${isCorporate?'text-[13px]':'text-sm'} font-medium truncate`},vmw.name||vmw.host),!isCorporate&&/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 truncate"},vmw.host)),/*#__PURE__*/React.createElement("div",{className:"w-1.5 h-1.5 rounded-full shrink-0",style:{background:vmw.connected!==false?'#60b515':'#f54f47'}}));}))),isCorporate&&selectedVMware&&(vmwareHosts.length>0||vmwareVms.length>0)&&/*#__PURE__*/React.createElement("div",{className:"mt-2 pt-2 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between px-1 mb-1"},/*#__PURE__*/React.createElement("h2",{className:"text-[11px] font-semibold uppercase tracking-wider",style:{color:'#728b9a'}},"Hosts"),/*#__PURE__*/React.createElement("span",{className:"text-[11px]",style:{color:'#728b9a'}},vmwareHosts.length)),/*#__PURE__*/React.createElement("div",{className:"space-y-0"},vmwareHosts.sort((a,b)=>(a.name||'').localeCompare(b.name||'')).map(host=>{const hostVms=vmwareVms.filter(vm=>{const vmHost=(vm.host||vm.host_name||'').split('.')[0];const hName=(host.name||'').split('.')[0];return vmHost===hName;});const isExpanded=expandedVmwareSidebarHosts[host.host_id||host.name];const hostOnline=host.connection_state==='CONNECTED'||host.connection_state==='connected';return/*#__PURE__*/React.createElement("div",{key:host.host_id||host.name},/*#__PURE__*/React.createElement("div",{className:"flex items-center"},/*#__PURE__*/React.createElement("button",{onClick:()=>setExpandedVmwareSidebarHosts(prev=>({...prev,[host.host_id||host.name]:!prev[host.host_id||host.name]})),className:"w-4 h-4 flex items-center justify-center flex-shrink-0",style:{color:'#728b9a'}},hostVms.length>0?isExpanded?/*#__PURE__*/React.createElement(Icons.ChevronDown,{className:"w-3 h-3"}):/*#__PURE__*/React.createElement(Icons.ChevronRight,{className:"w-3 h-3"}):/*#__PURE__*/React.createElement("span",{className:"w-3"})),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1.5 flex-1 pl-0.5 pr-2 py-0.5 text-[13px] leading-5 cursor-default",style:{color:hostOnline?'#adbbc4':'#728b9a'}},/*#__PURE__*/React.createElement(Icons.Server,{className:"w-3.5 h-3.5 flex-shrink-0",style:{color:hostOnline?'#49afd9':'#f54f47'}}),/*#__PURE__*/React.createElement("span",{className:"truncate flex-1"},(host.name||'Unknown').split('.')[0]),/*#__PURE__*/React.createElement("span",{className:"text-[11px] flex-shrink-0",style:{color:'#728b9a'}},hostVms.length))),isExpanded&&hostVms.length>0&&/*#__PURE__*/React.createElement("div",{className:"ml-4 border-l",style:{borderColor:'#485764'}},hostVms.sort((a,b)=>(a.name||'').localeCompare(b.name||'')).map(vm=>{const vmId=vm.vm||vm.vm_id||vm.id;const isOn=vm.power_state==='POWERED_ON';const isSuspended=vm.power_state==='SUSPENDED';const isVmSelected=vmwareSelectedVm===vmId;return/*#__PURE__*/React.createElement("div",{key:vmId,onClick:()=>{setVmwareSelectedVm(vmId);setVmwareActiveTab('vms');},className:"flex items-center gap-1.5 pl-3 pr-2 py-px text-[12px] leading-4 cursor-pointer",style:isVmSelected?{background:'#324f61',color:'#e9ecef'}:{color:'#adbbc4'},onMouseEnter:e=>{if(!isVmSelected){e.currentTarget.style.background='#29414e';e.currentTarget.style.color='#e9ecef';}},onMouseLeave:e=>{if(!isVmSelected){e.currentTarget.style.background='';e.currentTarget.style.color='#adbbc4';}}},/*#__PURE__*/React.createElement("span",{className:"relative flex-shrink-0",style:{width:'14px',height:'14px'}},/*#__PURE__*/React.createElement(Icons.Monitor,{className:"w-3 h-3",style:{color:isOn?'#60b515':isSuspended?'#efc006':'#728b9a'}}),isOn&&/*#__PURE__*/React.createElement("span",{className:"absolute -top-0.5 -right-0.5 w-1.5 h-1.5 rounded-full",style:{background:'#60b515'}})),/*#__PURE__*/React.createElement("span",{className:"truncate flex-1"},vm.name||`VM ${vmId}`),/*#__PURE__*/React.createElement("span",{className:"text-[10px] flex-shrink-0",style:{color:'#728b9a'}},isOn?'ON':isSuspended?'SUS':'OFF'));})));}),(()=>{const orphanVms=vmwareVms.filter(vm=>{const vmHost=(vm.host||vm.host_name||'').split('.')[0];return!vmHost||!vmwareHosts.some(h=>(h.name||'').split('.')[0]===vmHost);});if(orphanVms.length===0)return null;return/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1.5 pl-5 pr-2 py-0.5 text-[12px] leading-5",style:{color:'#728b9a'}},/*#__PURE__*/React.createElement(Icons.Monitor,{className:"w-3 h-3 flex-shrink-0"}),/*#__PURE__*/React.createElement("span",{className:"truncate flex-1 uppercase text-[11px] tracking-wider"},"Unassigned (",orphanVms.length,")")),/*#__PURE__*/React.createElement("div",{className:"ml-4 border-l",style:{borderColor:'#485764'}},orphanVms.sort((a,b)=>(a.name||'').localeCompare(b.name||'')).map(vm=>{const vmId=vm.vm||vm.vm_id||vm.id;const isOn=vm.power_state==='POWERED_ON';const isSuspended=vm.power_state==='SUSPENDED';const isVmSelected=vmwareSelectedVm===vmId;return/*#__PURE__*/React.createElement("div",{key:vmId,onClick:()=>{setVmwareSelectedVm(vmId);setVmwareActiveTab('vms');},className:"flex items-center gap-1.5 pl-3 pr-2 py-px text-[12px] leading-4 cursor-pointer",style:isVmSelected?{background:'#324f61',color:'#e9ecef'}:{color:'#adbbc4'},onMouseEnter:e=>{if(!isVmSelected){e.currentTarget.style.background='#29414e';e.currentTarget.style.color='#e9ecef';}},onMouseLeave:e=>{if(!isVmSelected){e.currentTarget.style.background='';e.currentTarget.style.color='#adbbc4';}}},/*#__PURE__*/React.createElement("span",{className:"relative flex-shrink-0",style:{width:'14px',height:'14px'}},/*#__PURE__*/React.createElement(Icons.Monitor,{className:"w-3 h-3",style:{color:isOn?'#60b515':isSuspended?'#efc006':'#728b9a'}}),isOn&&/*#__PURE__*/React.createElement("span",{className:"absolute -top-0.5 -right-0.5 w-1.5 h-1.5 rounded-full",style:{background:'#60b515'}})),/*#__PURE__*/React.createElement("span",{className:"truncate flex-1"},vm.name||`VM ${vmId}`),/*#__PURE__*/React.createElement("span",{className:"text-[10px] flex-shrink-0",style:{color:'#728b9a'}},isOn?'ON':isSuspended?'SUS':'OFF'));})));})())),!isCorporate&&vmwareServers.length===0&&isAdmin&&/*#__PURE__*/React.createElement("div",{className:"mt-4 pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setEditingVMware(null);setVmwareForm({name:'',host:'',port:443,username:'root',password:'',ssl_verify:false,notes:''});setShowAddVMware(true);},className:"w-full flex items-center gap-2 px-3 py-2 rounded-xl bg-proxmox-card border border-dashed border-proxmox-border text-gray-500 hover:text-emerald-400 hover:border-emerald-500/30 transition-all text-sm"},/*#__PURE__*/React.createElement(Icons.Cloud,{className:"w-4 h-4"}),/*#__PURE__*/React.createElement("span",null,"Add ESXi Server")))),isCorporate&&/*#__PURE__*/React.createElement("div",{className:"corp-resize-handle",onMouseDown:handleSidebarResizeStart,title:"Drag to resize"}),/*#__PURE__*/React.createElement("div",{className:`flex-1 min-w-0 ${isCorporate?'px-4 py-3':''}`},selectedCluster?/*#__PURE__*/React.createElement("div",{className:isCorporate?'space-y-3':'space-y-6'},/*#__PURE__*/React.createElement("div",{className:isCorporate?'flex items-center border-b border-proxmox-border':'flex items-center gap-1 p-1 bg-proxmox-card border border-proxmox-border rounded-xl w-fit flex-wrap'},[{id:'overview',labelKey:'overview',icon:Icons.Activity},{id:'resources',labelKey:'resources',icon:Icons.Server},{id:'datacenter',labelKey:'datacenter',icon:Icons.HardDrive},{id:'datastore',labelKey:'datastore',icon:Icons.Database},{id:'automation',labelKey:'automation',icon:Icons.Zap},{id:'reports',labelKey:'reports',icon:Icons.BarChart},{id:'settings',labelKey:'settings',icon:Icons.Settings}].map(tab=>/*#__PURE__*/React.createElement("button",{key:tab.id,onClick:()=>setActiveTab(tab.id),className:isCorporate?`flex items-center gap-1 px-3 py-1.5 text-[13px] border-b-2 -mb-px ${activeTab===tab.id?'border-blue-500 text-white font-medium':'border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-600'}`:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${activeTab===tab.id?'bg-proxmox-orange text-white':'text-gray-400 hover:text-white hover:bg-proxmox-hover'}`},/*#__PURE__*/React.createElement(tab.icon,{className:isCorporate?'w-3 h-3':undefined}),t(tab.labelKey)))),activeTab==='overview'&&(isCorporate&&selectedSidebarNode?/*#__PURE__*/React.createElement(CorporateNodeDetailView,{node:selectedSidebarNode.name,clusterId:selectedSidebarNode.clusterId,clusterMetrics:selectedSidebarNode.clusterId===selectedCluster?.id?clusterMetrics:sidebarClusterData[selectedSidebarNode.clusterId]?.metrics||{},clusterResources:selectedSidebarNode.clusterId===selectedCluster?.id?clusterResources:sidebarClusterData[selectedSidebarNode.clusterId]?.resources||[],onBack:()=>setSelectedSidebarNode(null),onOpenNodeConfig:nodeName=>setConfigNode(nodeName),onMaintenanceToggle:handleMaintenanceToggle,onNodeAction:handleNodeAction,onStartUpdate:handleStartUpdate,onSelectVm:vm=>{setSelectedSidebarVm({...vm,_clusterId:selectedSidebarNode.clusterId});setSelectedSidebarNode(null);setActiveTab('resources');setResourcesSubTab('management');},addToast:addToast}):/*#__PURE__*/React.createElement("div",{className:isCorporate?'space-y-3':'grid grid-cols-1 xl:grid-cols-3 gap-6'},/*#__PURE__*/React.createElement("div",{className:isCorporate?'':'xl:col-span-2 space-y-6'},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:`font-semibold text-gray-400 uppercase tracking-wider ${isCorporate?'text-xs mb-2':'text-sm mb-4'}`},t('nodes')),isCorporate?/*#__PURE__*/React.createElement("div",{className:"border border-proxmox-border bg-proxmox-card"},Object.entries(clusterMetrics).sort(([a],[b])=>a.localeCompare(b)).map(([node,metrics])=>/*#__PURE__*/React.createElement(NodeCompactRow,{key:node,name:node,metrics:metrics,clusterId:selectedCluster.id,onOpenNodeConfig:nodeName=>setConfigNode(nodeName),onMaintenanceToggle:handleMaintenanceToggle,onStartUpdate:handleStartUpdate,onNodeAction:handleNodeAction,onRemoveNode:nodeName=>{setNodeToRemoveDash({name:nodeName});setShowRemoveNodeDash(true);},onMoveNode:nodeName=>{setNodeToMoveDash(nodeName);setShowMoveNodeDash(true);}})),Object.entries(knownNodes).filter(([nodeName,nodeData])=>nodeData.status==='offline'&&!clusterMetrics[nodeName]).map(([nodeName])=>/*#__PURE__*/React.createElement(NodeCompactRow,{key:`offline-${nodeName}`,name:nodeName,metrics:null,clusterId:selectedCluster.id})),Object.entries(nodeAlerts).filter(([nodeName,alert])=>alert.cluster_id===selectedCluster.id&&!clusterMetrics[nodeName]&&!knownNodes[nodeName]?.status).map(([nodeName])=>/*#__PURE__*/React.createElement(NodeCompactRow,{key:`alert-${nodeName}`,name:nodeName,metrics:null,clusterId:selectedCluster.id}))):/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},Object.entries(clusterMetrics).sort(([a],[b])=>a.localeCompare(b)).map(([node,metrics],idx)=>/*#__PURE__*/React.createElement(NodeCard,{key:node,name:node,metrics:metrics,index:idx,clusterId:selectedCluster.id,onMaintenanceToggle:handleMaintenanceToggle,onStartUpdate:handleStartUpdate,onOpenNodeConfig:nodeName=>setConfigNode(nodeName),onNodeAction:handleNodeAction,onRemoveNode:nodeName=>{setNodeToRemoveDash({name:nodeName});setShowRemoveNodeDash(true);},onMoveNode:nodeName=>{setNodeToMoveDash(nodeName);setShowMoveNodeDash(true);}})),Object.entries(knownNodes).filter(([nodeName,nodeData])=>nodeData.status==='offline'&&!clusterMetrics[nodeName]).map(([nodeName,nodeData],idx)=>/*#__PURE__*/React.createElement("div",{key:`offline-${nodeName}`,className:"relative bg-proxmox-card border-2 border-red-500/50 rounded-xl p-4"},/*#__PURE__*/React.createElement("div",{className:"absolute top-2 right-2"},/*#__PURE__*/React.createElement("span",{className:"px-2 py-1 bg-red-500 text-white text-xs font-bold rounded animate-pulse"},"OFFLINE")),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3 mb-4"},/*#__PURE__*/React.createElement("div",{className:"p-2 bg-red-500/20 rounded-lg"},/*#__PURE__*/React.createElement(Icons.Server,{className:"text-red-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"font-semibold text-white"},nodeName),/*#__PURE__*/React.createElement("p",{className:"text-xs text-red-400"},t('nodeUnreachable')||'Node unreachable'))),/*#__PURE__*/React.createElement("div",{className:"space-y-3 opacity-50"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-xs mb-1"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"CPU"),/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"--")),/*#__PURE__*/React.createElement("div",{className:"h-2 bg-proxmox-dark rounded-full"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-xs mb-1"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"RAM"),/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"--")),/*#__PURE__*/React.createElement("div",{className:"h-2 bg-proxmox-dark rounded-full"}))),/*#__PURE__*/React.createElement("div",{className:"mt-4 pt-3 border-t border-red-500/30 text-xs text-red-400"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"inline w-3 h-3 mr-1"}),t('offlineSince')||'Offline since',": ",nodeData.offlineSince?new Date(nodeData.offlineSince).toLocaleTimeString():'Unknown'),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mt-2"},t('lastSeen')||'Last seen',": ",nodeData.lastSeen?new Date(nodeData.lastSeen).toLocaleString():'Unknown'))),Object.entries(nodeAlerts).filter(([nodeName,alert])=>alert.cluster_id===selectedCluster.id&&!clusterMetrics[nodeName]&&!knownNodes[nodeName]?.status).map(([nodeName,alert],idx)=>/*#__PURE__*/React.createElement("div",{key:`alert-${nodeName}`,className:"relative bg-proxmox-card border-2 border-red-500/50 rounded-xl p-4 animate-pulse"},/*#__PURE__*/React.createElement("div",{className:"absolute top-2 right-2"},/*#__PURE__*/React.createElement("span",{className:"px-2 py-1 bg-red-500 text-white text-xs font-bold rounded animate-pulse"},"OFFLINE")),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3 mb-4"},/*#__PURE__*/React.createElement("div",{className:"p-2 bg-red-500/20 rounded-lg"},/*#__PURE__*/React.createElement(Icons.Server,{className:"text-red-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"font-semibold text-white"},nodeName),/*#__PURE__*/React.createElement("p",{className:"text-xs text-red-400"},t('nodeUnreachable')||'Node unreachable'))),/*#__PURE__*/React.createElement("div",{className:"space-y-3 opacity-50"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-xs mb-1"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"CPU"),/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"--")),/*#__PURE__*/React.createElement("div",{className:"h-2 bg-proxmox-dark rounded-full"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-xs mb-1"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"RAM"),/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"--")),/*#__PURE__*/React.createElement("div",{className:"h-2 bg-proxmox-dark rounded-full"}))),/*#__PURE__*/React.createElement("div",{className:"mt-4 pt-3 border-t border-red-500/30 text-xs text-red-400"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"inline w-3 h-3 mr-1"}),t('offlineSince')||'Offline since',": ",new Date(alert.timestamp).toLocaleTimeString())))),Object.keys(clusterMetrics).length===0&&Object.keys(nodeAlerts).length===0&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-8 text-center"},connectionError?/*#__PURE__*/React.createElement("div",{className:"text-red-400"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"mx-auto mb-2"}),/*#__PURE__*/React.createElement("p",{className:"font-medium"},t('connectionError')||'Connection Error'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-500 mt-1"},connectionError),/*#__PURE__*/React.createElement("button",{onClick:()=>{setConnectionError(null);fetchClusterMetrics(selectedCluster.id);},className:"mt-3 px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm text-white"},t('retry')||'Retry')):/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"mx-auto mb-2 animate-spin text-gray-500"}),/*#__PURE__*/React.createElement("p",{className:"text-gray-500"},t('loadingMetrics')||'Loading metrics...'))))),/*#__PURE__*/React.createElement("div",{className:isCorporate?'space-y-3':'space-y-6'},/*#__PURE__*/React.createElement(ClusterHealth,{metrics:clusterMetrics,isCorporate:isCorporate}),/*#__PURE__*/React.createElement("div",{className:isCorporate?'bg-proxmox-card border border-proxmox-border p-3':'bg-proxmox-card border border-proxmox-border rounded-xl p-5'},/*#__PURE__*/React.createElement("h3",{className:`font-semibold text-gray-400 uppercase tracking-wider ${isCorporate?'text-xs mb-2':'text-sm mb-4'}`},t('lastMigrations')),/*#__PURE__*/React.createElement(MigrationHistory,{logs:migrationLogs}))))),activeTab==='resources'&&/*#__PURE__*/React.createElement("div",{className:isCorporate?'space-y-2':'space-y-4'},isCorporate&&selectedSidebarVm?/*#__PURE__*/React.createElement(CorporateVmDetailView,{vm:selectedSidebarVm,clusterId:selectedSidebarVm._clusterId||selectedCluster.id,onAction:handleVmAction,onOpenConsole:handleOpenConsole,onOpenConfig:handleOpenConfig,onBack:()=>setSelectedSidebarVm(null),onMigrate:handleMigrate,onClone:handleCloneVm,onForceStop:handleForceStop,onDelete:handleDeleteVm,onCrossClusterMigrate:handleCrossClusterMigrate,showCrossCluster:clusters.length>1,actionLoading:actionLoading,onShowMetrics:vm=>setCorpMetricsVm(vm),addToast:addToast}):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:`flex items-center ${isCorporate?'border-b border-proxmox-border':'gap-1 border-b border-proxmox-border pb-2'}`},/*#__PURE__*/React.createElement("button",{onClick:()=>setResourcesSubTab('management'),className:isCorporate?'flex items-center gap-1 px-3 py-1.5 text-[13px] border-b-2 -mb-px':`flex items-center gap-2 px-4 py-2 rounded-lg text-sm transition-colors ${resourcesSubTab==='management'?'bg-proxmox-orange text-white':'text-gray-400 hover:text-white hover:bg-proxmox-hover'}`,style:isCorporate?resourcesSubTab==='management'?{borderColor:'#49afd9',color:'#e9ecef',fontWeight:500}:{borderColor:'transparent',color:'#adbbc4'}:undefined},/*#__PURE__*/React.createElement(Icons.Server,{className:isCorporate?'w-3 h-3':'w-4 h-4'}),t('resourcesLabel')||'Resources'),/*#__PURE__*/React.createElement("button",{onClick:()=>{setResourcesSubTab('snapshots');fetchGlobalSnapshots(selectedCluster.id);},className:isCorporate?'flex items-center gap-1 px-3 py-1.5 text-[13px] border-b-2 -mb-px':`flex items-center gap-2 px-4 py-2 rounded-lg text-sm transition-colors ${resourcesSubTab==='snapshots'?'bg-proxmox-orange text-white':'text-gray-400 hover:text-white hover:bg-proxmox-hover'}`,style:isCorporate?resourcesSubTab==='snapshots'?{borderColor:'#49afd9',color:'#e9ecef',fontWeight:500}:{borderColor:'transparent',color:'#adbbc4'}:undefined},/*#__PURE__*/React.createElement(Icons.Camera,{className:isCorporate?'w-3 h-3':'w-4 h-4'}),t('snapshotsOverview')||'Snapshot Overview')),resourcesSubTab==='management'&&/*#__PURE__*/React.createElement("div",{className:isCorporate?'p-0':'bg-proxmox-card border border-proxmox-border rounded-xl p-6'},/*#__PURE__*/React.createElement(ResourceTable,{resources:clusterResources,clusterId:selectedCluster.id,clusters:clusters,sourceCluster:selectedCluster,onVmAction:handleVmAction,onOpenConsole:handleOpenConsole,onOpenConfig:handleOpenConfig,onMigrate:handleMigrate,onBulkMigrate:handleBulkMigrate,onDelete:handleDeleteVm,onClone:handleCloneVm,onForceStop:handleForceStop,onCrossClusterMigrate:handleCrossClusterMigrate,nodes:Object.keys(clusterMetrics),onOpenTags:resource=>{loadVmTags(selectedCluster.id,resource.vmid);loadClusterTags(selectedCluster.id);setShowTagEditor({clusterId:selectedCluster.id,vmid:resource.vmid,vmName:resource.name||`VM ${resource.vmid}`});},highlightedVm:highlightedVm,addToast:addToast}),/*#__PURE__*/React.createElement("div",{className:`flex gap-3 ${isCorporate?'mt-2':'mt-4'}`},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowCreateVm('qemu'),className:isCorporate?'flex items-center gap-1.5 px-3 py-1.5 bg-blue-600 text-[13px] text-white hover:bg-blue-700 border border-blue-700':'flex items-center gap-2 px-4 py-2 bg-blue-600 rounded-lg text-white hover:bg-blue-700 transition-colors'},/*#__PURE__*/React.createElement(Icons.Plus,{className:isCorporate?'w-3 h-3':''}),t('createVm')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowCreateVm('lxc'),className:isCorporate?'flex items-center gap-1.5 px-3 py-1.5 bg-purple-600 text-[13px] text-white hover:bg-purple-700 border border-purple-700':'flex items-center gap-2 px-4 py-2 bg-purple-600 rounded-lg text-white hover:bg-purple-700 transition-colors'},/*#__PURE__*/React.createElement(Icons.Plus,{className:isCorporate?'w-3 h-3':''}),t('createContainer')))),resourcesSubTab==='snapshots'&&/*#__PURE__*/React.createElement("div",{className:isCorporate?'bg-proxmox-card border border-proxmox-border p-4 space-y-3':'bg-proxmox-card border border-proxmox-border rounded-xl p-6 space-y-4'},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold text-white"},t('snapshotsOverview')||'Snapshot Overview'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mt-1"},t('snapshotsDesc')||'Overview of the oldest snapshots in this cluster')),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("input",{type:"date",value:snapshotFilterDate,onChange:e=>setSnapshotFilterDate(e.target.value),className:"rounded-lg bg-proxmox-dark border border-proxmox-border px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-proxmox-orange"}),/*#__PURE__*/React.createElement("button",{onClick:()=>applySnapshotFilter(selectedCluster.id),disabled:!snapshotFilterDate,className:"rounded-lg bg-proxmox-orange px-4 py-2 text-sm font-medium text-white hover:bg-proxmox-orange/90 disabled:opacity-50 disabled:cursor-not-allowed"},t('filter')||'Filter'),/*#__PURE__*/React.createElement("button",{onClick:()=>fetchGlobalSnapshots(selectedCluster.id),className:"p-2 rounded-lg bg-proxmox-dark border border-proxmox-border text-gray-400 hover:text-white",title:"Refresh"},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-4 h-4"})))),!Array.isArray(sortedSnapshots)||sortedSnapshots.length===0?/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-xl p-8 text-center"},/*#__PURE__*/React.createElement(Icons.Camera,{className:"mx-auto mb-3 w-10 h-10 text-gray-600"}),/*#__PURE__*/React.createElement("p",{className:"text-gray-500"},t('noSnapshots')||'No snapshots found'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-600 mt-2"},t('snapshotsHint')||'Create snapshots on VMs to see them listed here')):/*#__PURE__*/React.createElement("div",{className:"overflow-x-auto bg-proxmox-dark rounded-xl border border-gray-800"},/*#__PURE__*/React.createElement("table",{className:"min-w-full text-sm"},/*#__PURE__*/React.createElement("thead",{className:"bg-black/40 text-gray-400"},/*#__PURE__*/React.createElement("tr",null,/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left cursor-pointer hover:text-white",onClick:()=>toggleSnapshotSort('vmid')},"VM ID ",snapshotSortBy==='vmid'&&(snapshotSortDir==='asc'?'â†‘':'â†“')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left cursor-pointer hover:text-white",onClick:()=>toggleSnapshotSort('vm_name')},"VM Name ",snapshotSortBy==='vm_name'&&(snapshotSortDir==='asc'?'â†‘':'â†“')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left cursor-pointer hover:text-white",onClick:()=>toggleSnapshotSort('vm_type')},t('snapshotsType')||'Type'," ",snapshotSortBy==='vm_type'&&(snapshotSortDir==='asc'?'â†‘':'â†“')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left cursor-pointer hover:text-white",onClick:()=>toggleSnapshotSort('node')},"Node ",snapshotSortBy==='node'&&(snapshotSortDir==='asc'?'â†‘':'â†“')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left cursor-pointer hover:text-white",onClick:()=>toggleSnapshotSort('snapshot_name')},"Snapshot ",snapshotSortBy==='snapshot_name'&&(snapshotSortDir==='asc'?'â†‘':'â†“')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left cursor-pointer hover:text-white",onClick:()=>toggleSnapshotSort('snapshot_date')},t('snapshotsDate')||'Created'," ",snapshotSortBy==='snapshot_date'&&(snapshotSortDir==='asc'?'â†‘':'â†“')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-left cursor-pointer hover:text-white",onClick:()=>toggleSnapshotSort('age')},t('snapshotsAge')||'Age'," ",snapshotSortBy==='age'&&(snapshotSortDir==='asc'?'â†‘':'â†“')),/*#__PURE__*/React.createElement("th",{className:"px-4 py-3 text-right w-12"},t('snapshotsAction')||'Action'))),/*#__PURE__*/React.createElement("tbody",{className:"divide-y divide-gray-800"},sortedSnapshots.map((snap,idx)=>/*#__PURE__*/React.createElement("tr",{key:`${snap.vmid}-${snap.snapshot_name}-${idx}`,className:"group hover:bg-white/5 transition-colors"},/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-gray-300"},snap.vmid??'-'),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-gray-200"},snap.vm_name??'-'),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-1 rounded text-xs ${snap.vm_type==='qemu'?'bg-blue-500/20 text-blue-400':'bg-purple-500/20 text-purple-400'}`},snap.vm_type==='qemu'?'VM':'CT')),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-gray-300"},snap.node??'-'),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 font-mono text-gray-200"},snap.snapshot_name??'-'),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-gray-300"},snap.snapshot_date??'-'),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-yellow-400"},snap.age??'-'),/*#__PURE__*/React.createElement("td",{className:"px-4 py-3 text-right"},/*#__PURE__*/React.createElement("button",{onClick:()=>deleteGlobalSnapshot(snap,selectedCluster.id),className:"opacity-0 group-hover:opacity-100 transition text-red-500 hover:text-red-400",title:"Delete snapshot"},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-4 h-4"}))))))))))),activeTab==='datacenter'&&/*#__PURE__*/React.createElement(DatacenterTab,{clusterId:selectedCluster.id,addToast:addToast}),activeTab==='datastore'&&/*#__PURE__*/React.createElement(DatastoreTab,{clusterId:selectedCluster.id,addToast:addToast}),activeTab==='automation'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:isCorporate?'flex items-center border-b border-proxmox-border':'flex items-center gap-1 border-b border-proxmox-border pb-2'},[{id:'schedules',label:t('scheduledActions')||'Schedules',icon:Icons.Clock},{id:'tags',label:t('tagsLabels')||'Tags',icon:Icons.Tag},{id:'alerts',label:t('alerts')||'Alerts',icon:Icons.Bell},{id:'affinity',label:t('affinityRules')||'Affinity',icon:Icons.Link},{id:'scripts',label:t('customScripts')||'Scripts',icon:Icons.Terminal}].map(sub=>/*#__PURE__*/React.createElement("button",{key:sub.id,onClick:()=>setAutomationSubTab(sub.id),className:isCorporate?`flex items-center gap-1 px-3 py-1.5 text-[13px] border-b-2 -mb-px ${automationSubTab===sub.id?'border-blue-500 text-white font-medium':'border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-600'}`:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm transition-colors ${automationSubTab===sub.id?'bg-proxmox-orange text-white':'text-gray-400 hover:text-white hover:bg-proxmox-hover'}`},/*#__PURE__*/React.createElement(sub.icon,{className:isCorporate?'w-3 h-3':'w-4 h-4'}),sub.label))),automationSubTab==='schedules'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center"},/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},t('schedulesDesc')||'Automatically start, stop, reboot or snapshot VMs on a schedule'),/*#__PURE__*/React.createElement("button",{onClick:()=>{setEditingSchedule(null);setShowScheduleModal(true);},className:"flex items-center gap-2 px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm"},/*#__PURE__*/React.createElement(Icons.Plus,null)," ",t('newSchedule')||'New Schedule')),schedules.filter(s=>s.cluster_id===selectedCluster?.id).length===0?/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-xl p-8 text-center"},/*#__PURE__*/React.createElement(Icons.Clock,{className:"mx-auto mb-3 w-10 h-10 text-gray-600"}),/*#__PURE__*/React.createElement("p",{className:"text-gray-500"},t('noSchedules')||'No scheduled actions for this cluster')):/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",{className:"bg-proxmox-dark"},/*#__PURE__*/React.createElement("tr",{className:"text-left text-xs text-gray-500 uppercase"},/*#__PURE__*/React.createElement("th",{className:"p-3"},t('status')||'Status'),/*#__PURE__*/React.createElement("th",{className:"p-3"},t('name')||'Name'),/*#__PURE__*/React.createElement("th",{className:"p-3"},"VM"),/*#__PURE__*/React.createElement("th",{className:"p-3"},t('action')||'Action'),/*#__PURE__*/React.createElement("th",{className:"p-3"},t('schedule')||'Schedule'),/*#__PURE__*/React.createElement("th",{className:"p-3"},t('lastRun')||'Last Run'),/*#__PURE__*/React.createElement("th",{className:"p-3 w-16"}))),/*#__PURE__*/React.createElement("tbody",{className:"divide-y divide-proxmox-border"},schedules.filter(s=>s.cluster_id===selectedCluster?.id).map(schedule=>/*#__PURE__*/React.createElement("tr",{key:schedule.id,className:"hover:bg-proxmox-hover"},/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("button",{onClick:()=>toggleScheduleEnabled(schedule.id,!schedule.enabled),className:`w-9 h-5 rounded-full relative transition-colors ${schedule.enabled?'bg-green-500':'bg-gray-600'}`},/*#__PURE__*/React.createElement("span",{className:`absolute top-0.5 w-4 h-4 bg-white rounded-full transition-transform ${schedule.enabled?'left-4':'left-0.5'}`}))),/*#__PURE__*/React.createElement("td",{className:"p-3 font-medium"},schedule.name),/*#__PURE__*/React.createElement("td",{className:"p-3 text-sm"},schedule.vm_type==='lxc'?'ðŸ“¦':'ðŸ–¥ï¸'," ",schedule.vmid),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-1 rounded text-xs ${schedule.action==='start'?'bg-green-500/20 text-green-400':schedule.action==='stop'?'bg-red-500/20 text-red-400':schedule.action==='snapshot'?'bg-blue-500/20 text-blue-400':'bg-yellow-500/20 text-yellow-400'}`},schedule.action)),/*#__PURE__*/React.createElement("td",{className:"p-3 text-sm text-gray-400"},schedule.time," \u2022 ",schedule.schedule_type==='daily'?t('daily')||'Daily':schedule.schedule_type==='weekdays'?t('weekdays')||'Weekdays':schedule.schedule_type==='weekends'?t('weekends')||'Weekends':schedule.schedule_type==='weekly'?(schedule.days||[]).join(', '):schedule.date),/*#__PURE__*/React.createElement("td",{className:"p-3 text-xs text-gray-500"},schedule.last_run||'-',schedule.run_count>0&&` (${schedule.run_count}x)`),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("button",{onClick:()=>deleteSchedule(schedule.id),className:"p-1 hover:bg-red-500/20 rounded text-gray-500 hover:text-red-400"},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-4 h-4"}))))))))),automationSubTab==='tags'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},t('tagsDesc')||'Organize VMs with tags. Click the tag icon on any VM to add tags.'),clusterTags.length===0?/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-xl p-8 text-center"},/*#__PURE__*/React.createElement(Icons.Tag,{className:"mx-auto mb-3 w-10 h-10 text-gray-600"}),/*#__PURE__*/React.createElement("p",{className:"text-gray-500"},t('noTagsInCluster')||'No tags in this cluster yet'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-600 mt-2"},t('addTagHint')||'Use the tag button on VMs in the Resources tab')):/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-2"},clusterTags.map((tag,idx)=>/*#__PURE__*/React.createElement("span",{key:idx,className:"flex items-center gap-2 px-3 py-1.5 rounded-full border",style:{backgroundColor:(tag.color||'#6b7280')+'20',borderColor:tag.color||'#6b7280',color:tag.color||'#9ca3af'}},tag.name,/*#__PURE__*/React.createElement("span",{className:"text-xs opacity-60"},"(",tag.count||0,")")))),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},clusterTags.length," ",t('tagsTotal')||'tags'," \u2022 ",t('clickVmTag')||'Click tag icon on VMs to manage'))),automationSubTab==='alerts'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center"},/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},t('alertsDesc')||'Get notified when resources exceed thresholds'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAlertModal(true),className:"flex items-center gap-2 px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm"},/*#__PURE__*/React.createElement(Icons.Plus,null)," ",t('newAlert')||'New Alert')),clusterAlerts.length===0?/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-xl p-8 text-center"},/*#__PURE__*/React.createElement(Icons.Bell,{className:"mx-auto mb-3 w-10 h-10 text-gray-600"}),/*#__PURE__*/React.createElement("p",{className:"text-gray-500"},t('noAlertsCluster')||'No alerts for this cluster')):/*#__PURE__*/React.createElement("div",{className:"space-y-2"},clusterAlerts.map(alert=>/*#__PURE__*/React.createElement("div",{key:alert.id,className:`flex items-center justify-between p-3 rounded-lg border ${alert.enabled?'bg-proxmox-dark border-proxmox-border':'bg-proxmox-darker border-proxmox-darker opacity-60'}`},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("button",{onClick:()=>toggleAlertEnabled(alert.id,!alert.enabled),className:`w-9 h-5 rounded-full relative transition-colors ${alert.enabled?'bg-green-500':'bg-gray-600'}`},/*#__PURE__*/React.createElement("span",{className:`absolute top-0.5 w-4 h-4 bg-white rounded-full transition-transform ${alert.enabled?'left-4':'left-0.5'}`})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"font-medium flex items-center gap-2"},alert.name,/*#__PURE__*/React.createElement("span",{className:`px-1.5 py-0.5 text-xs rounded ${alert.target_type==='vm'?'bg-blue-500/20 text-blue-400':alert.target_type==='node'?'bg-purple-500/20 text-purple-400':'bg-gray-500/20 text-gray-400'}`},alert.target_type==='vm'?`VM ${alert.target_id||''}`:alert.target_type==='node'?`Node ${alert.target_id||''}`:t('cluster')||'Cluster')),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},alert.metric?.toUpperCase()," ",alert.operator," ",alert.threshold,"%"))),/*#__PURE__*/React.createElement("button",{onClick:()=>deleteClusterAlert(alert.id),className:"p-1.5 hover:bg-red-500/20 rounded text-gray-500 hover:text-red-400"},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-4 h-4"})))))),automationSubTab==='affinity'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center"},/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},t('affinityDesc')||'Keep VMs together or separate across nodes'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAffinityModal(true),className:"flex items-center gap-2 px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm"},/*#__PURE__*/React.createElement(Icons.Plus,null)," ",t('newRule')||'New Rule')),clusterAffinityRules.length===0?/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-xl p-8 text-center"},/*#__PURE__*/React.createElement(Icons.Link,{className:"mx-auto mb-3 w-10 h-10 text-gray-600"}),/*#__PURE__*/React.createElement("p",{className:"text-gray-500"},t('noAffinityCluster')||'No affinity rules for this cluster')):/*#__PURE__*/React.createElement("div",{className:"space-y-2"},clusterAffinityRules.map(rule=>/*#__PURE__*/React.createElement("div",{key:rule.id,className:"flex items-center justify-between p-3 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-1 rounded text-xs ${rule.type==='together'?'bg-green-500/20 text-green-400':'bg-red-500/20 text-red-400'}`},rule.type==='together'?t('together')||'Together':t('separate')||'Separate'),rule.enforce&&/*#__PURE__*/React.createElement("span",{className:"px-1.5 py-0.5 text-xs bg-yellow-500/20 text-yellow-400 rounded"},t('enforced')||'Enforced'),/*#__PURE__*/React.createElement("span",{className:"text-sm text-white font-medium"},rule.name||rule.id),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-400"},"VMs: ",(rule.vm_ids||rule.vms||[]).join(', '))),/*#__PURE__*/React.createElement("button",{onClick:()=>deleteClusterAffinityRule(rule.id),className:"p-1.5 hover:bg-red-500/20 rounded text-gray-500 hover:text-red-400"},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-4 h-4"})))))),automationSubTab==='scripts'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center"},/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},t('scriptsDesc')||'Run custom .sh or .py scripts on cluster nodes with permission control'),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>loadCustomScripts(selectedCluster?.id),className:"flex items-center gap-1 px-3 py-2 bg-proxmox-dark hover:bg-proxmox-hover rounded-lg text-sm text-gray-400",title:t('refresh')||'Refresh'},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-4 h-4"})),/*#__PURE__*/React.createElement("button",{onClick:()=>{setEditingScript(null);setShowScriptModal(true);},className:"flex items-center gap-2 px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-sm"},/*#__PURE__*/React.createElement(Icons.Plus,null)," ",t('newScript')||'New Script'))),!customScripts||customScripts.length===0?/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-xl p-8 text-center"},/*#__PURE__*/React.createElement(Icons.Terminal,{className:"mx-auto mb-3 w-10 h-10 text-gray-600"}),/*#__PURE__*/React.createElement("p",{className:"text-gray-500"},t('noScripts')||'No custom scripts configured'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-600 mt-2"},t('scriptsInfo')||'Create scripts to automate tasks across your cluster nodes')):/*#__PURE__*/React.createElement("div",{className:"space-y-3"},customScripts.map(script=>/*#__PURE__*/React.createElement("div",{key:script.id,className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${script.type==='python'?'bg-blue-500/20 text-blue-400':'bg-green-500/20 text-green-400'}`},script.type==='python'?'ðŸ':'ðŸ“œ'),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},script.name),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},script.type==='python'?'Python':'Bash'," \u2022 ",script.target_nodes==='all'?'All Nodes':script.target_nodes,script.created_by&&/*#__PURE__*/React.createElement("span",{className:"ml-2"},"\u2022 Created by ",script.created_by)))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowScriptRunModal(script),className:"p-2 rounded-lg bg-green-500/20 text-green-400 hover:bg-green-500/30",title:t('runScript')||'Run Script',disabled:!script.enabled},/*#__PURE__*/React.createElement(Icons.Play,{className:"w-4 h-4"})),script.last_run&&/*#__PURE__*/React.createElement("button",{onClick:async()=>{try{const res=await authFetch(`${API_URL}/clusters/${selectedCluster.id}/scripts/${script.id}/output`);if(res.ok){const data=await res.json();setScriptOutput({name:data.name,output:data.output,last_run:data.last_run,last_status:data.last_status});}}catch(e){addToast('Error loading output','error');}},className:"p-2 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30",title:t('viewOutput')||'View Last Output'},/*#__PURE__*/React.createElement(Icons.FileText,{className:"w-4 h-4"})),/*#__PURE__*/React.createElement("button",{onClick:()=>{setEditingScript(script);setShowScriptModal(true);},className:"p-2 rounded-lg bg-proxmox-dark text-gray-400 hover:bg-proxmox-hover hover:text-white"},/*#__PURE__*/React.createElement(Icons.Edit,{className:"w-4 h-4"})),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!confirm(t('confirmDeleteScript')||'Delete this script? It will be permanently removed after 20 days.'))return;try{const res=await authFetch(`${API_URL}/clusters/${selectedCluster.id}/scripts/${script.id}`,{method:'DELETE'});if(res.ok){const result=await res.json();addToast(result.message||t('scriptMarkedForDeletion')||'Script marked for deletion (20 days)','success');setCustomScripts(prev=>prev.filter(s=>s.id!==script.id));}}catch(e){addToast('Error deleting script','error');}},className:"p-2 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30"},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-4 h-4"})))),script.description&&/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mt-2"},script.description),script.last_run&&/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-600 mt-2"},"Last run: ",new Date(script.last_run).toLocaleString()," -",/*#__PURE__*/React.createElement("span",{className:script.last_status==='success'?'text-green-400 ml-1':script.last_status==='partial'?'text-yellow-400 ml-1':'text-red-400 ml-1'},script.last_status))))),/*#__PURE__*/React.createElement("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-3"},/*#__PURE__*/React.createElement(Icons.Shield,{className:"text-blue-400 w-5 h-5 mt-0.5"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h4",{className:"font-medium text-blue-300"},t('scriptPermissions')||'Script Permissions'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mt-1"},t('scriptPermissionsDesc')||'Scripts require SSH access to nodes. Configure SSH key in cluster settings. Scripts run with the SSH user\'s permissions.')))))),activeTab==='reports'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center"},/*#__PURE__*/React.createElement("h2",{className:"text-lg font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.BarChart,null),t('reportsAnalytics')||'Reports & Analytics',": ",selectedCluster?.name),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},['hour','day','week'].map(p=>/*#__PURE__*/React.createElement("button",{key:p,onClick:()=>setReportPeriod(p),className:isCorporate?`px-3 py-1 text-[13px] border ${reportPeriod===p?'border-blue-500 bg-blue-500/10 text-white':'border-proxmox-border text-gray-400 hover:text-white hover:border-gray-500'}`:`px-3 py-1.5 rounded-lg text-sm ${reportPeriod===p?'bg-proxmox-orange text-white':'bg-proxmox-dark text-gray-400 hover:text-white'}`},p==='hour'?t('lastHour')||'Last Hour':p==='day'?t('last24h')||'Last 24h':t('lastWeek')||'Last Week')),/*#__PURE__*/React.createElement("button",{onClick:()=>{loadReportSummary(reportPeriod);loadTopVms();},className:"p-2 hover:bg-proxmox-hover rounded-lg text-gray-400 hover:text-white"},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:reportLoading?'animate-spin':''})))),reportLoading?/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-center py-12"},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"animate-spin w-8 h-8 text-gray-500"})):/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4 text-center"},/*#__PURE__*/React.createElement("div",{className:"text-3xl font-bold text-blue-400"},reportData?.cpu?.current||reportData?.live?.cpu_percent||0,"%"),/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-500"},"CPU"),reportData?.data_points>0&&/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-600 mt-1"},"avg: ",reportData?.cpu?.avg||0,"%")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4 text-center"},/*#__PURE__*/React.createElement("div",{className:"text-3xl font-bold text-green-400"},reportData?.memory?.current||reportData?.live?.mem_percent||0,"%"),/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-500"},"Memory"),reportData?.data_points>0&&/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-600 mt-1"},"avg: ",reportData?.memory?.avg||0,"%")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4 text-center"},/*#__PURE__*/React.createElement("div",{className:"text-3xl font-bold text-orange-400"},reportData?.live?.vms_running||reportData?.vms_running?.current||0),/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-500"},"VMs")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4 text-center"},/*#__PURE__*/React.createElement("div",{className:"text-3xl font-bold text-purple-400"},reportData?.live?.cts_running||0),/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-500"},"Container"))),reportData?.data_points>0&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold mb-3 text-sm text-gray-400"},t('historicalRange')||'Historical Range'),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-xs text-gray-500 mb-1"},/*#__PURE__*/React.createElement("span",null,"CPU"),/*#__PURE__*/React.createElement("span",null,reportData.cpu?.min||0,"% - ",reportData.cpu?.max||0,"%")),/*#__PURE__*/React.createElement("div",{className:"h-2 bg-proxmox-dark rounded-full overflow-hidden relative"},/*#__PURE__*/React.createElement("div",{className:"absolute h-full bg-blue-500/30",style:{left:`${reportData.cpu?.min||0}%`,width:`${(reportData.cpu?.max||0)-(reportData.cpu?.min||0)}%`}}),/*#__PURE__*/React.createElement("div",{className:"absolute h-full w-1 bg-blue-400",style:{left:`${reportData.cpu?.current||0}%`}}))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-xs text-gray-500 mb-1"},/*#__PURE__*/React.createElement("span",null,"Memory"),/*#__PURE__*/React.createElement("span",null,reportData.memory?.min||0,"% - ",reportData.memory?.max||0,"%")),/*#__PURE__*/React.createElement("div",{className:"h-2 bg-proxmox-dark rounded-full overflow-hidden relative"},/*#__PURE__*/React.createElement("div",{className:"absolute h-full bg-green-500/30",style:{left:`${reportData.memory?.min||0}%`,width:`${(reportData.memory?.max||0)-(reportData.memory?.min||0)}%`}}),/*#__PURE__*/React.createElement("div",{className:"absolute h-full w-1 bg-green-400",style:{left:`${reportData.memory?.current||0}%`}})))),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-600 text-center mt-3"},reportData.data_points," ",t('dataPoints')||'data points'," \u2022 ",reportData.period)),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold mb-3 flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement(Icons.Cpu,{className:"text-blue-400 w-4 h-4"}),t('topVmsCpu')||'Highest CPU Usage'),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},topVms.length>0?topVms.slice(0,5).map((vm,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"flex items-center gap-2 p-2 bg-proxmox-dark rounded-lg text-sm"},/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 w-4"},idx+1),/*#__PURE__*/React.createElement("span",null,vm.type==='lxc'?'ðŸ“¦':'ðŸ–¥ï¸'),/*#__PURE__*/React.createElement("span",{className:"flex-1 truncate"},vm.name||`VM ${vm.vmid}`),/*#__PURE__*/React.createElement("div",{className:"w-16 h-1.5 bg-proxmox-hover rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"h-full bg-blue-500",style:{width:`${Math.min((vm.cpu||0)*100,100)}%`}})),/*#__PURE__*/React.createElement("span",{className:"font-mono text-xs w-10 text-right"},((vm.cpu||0)*100).toFixed(0),"%"))):/*#__PURE__*/React.createElement("p",{className:"text-gray-500 text-center py-4 text-sm"},t('noRunningVms')||'No running VMs'))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold mb-3 flex items-center gap-2 text-sm"},/*#__PURE__*/React.createElement(Icons.HardDrive,{className:"text-green-400 w-4 h-4"}),t('topVmsMem')||'Highest Memory Usage'),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},topVms.length>0?[...topVms].sort((a,b)=>(b.mem_percent||0)-(a.mem_percent||0)).slice(0,5).map((vm,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"flex items-center gap-2 p-2 bg-proxmox-dark rounded-lg text-sm"},/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 w-4"},idx+1),/*#__PURE__*/React.createElement("span",null,vm.type==='lxc'?'ðŸ“¦':'ðŸ–¥ï¸'),/*#__PURE__*/React.createElement("span",{className:"flex-1 truncate"},vm.name||`VM ${vm.vmid}`),/*#__PURE__*/React.createElement("div",{className:"w-16 h-1.5 bg-proxmox-hover rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"h-full bg-green-500",style:{width:`${Math.min(vm.mem_percent||0,100)}%`}})),/*#__PURE__*/React.createElement("span",{className:"font-mono text-xs w-10 text-right"},(vm.mem_percent||0).toFixed(0),"%"))):/*#__PURE__*/React.createElement("p",{className:"text-gray-500 text-center py-4 text-sm"},t('noRunningVms')||'No running VMs')))))),activeTab==='settings'&&/*#__PURE__*/React.createElement("div",{className:`grid grid-cols-1 lg:grid-cols-2 ${isCorporate?'gap-3':'gap-6'}`},/*#__PURE__*/React.createElement("div",{className:isCorporate?'border border-proxmox-border p-4 space-y-4':'bg-proxmox-card border border-proxmox-border rounded-xl p-6 space-y-6'},/*#__PURE__*/React.createElement("h3",{className:isCorporate?'font-semibold text-sm':'font-semibold'},t('balancingConfig')),/*#__PURE__*/React.createElement(Slider,{label:t('migrationThreshold'),description:t('migrationThresholdDesc'),value:selectedCluster.migration_threshold,onChange:v=>updateConfig('migration_threshold',v),min:5,max:100}),/*#__PURE__*/React.createElement(Slider,{label:t('checkInterval'),description:t('intervalBetweenChecks'),value:selectedCluster.check_interval,onChange:v=>updateConfig('check_interval',v),min:60,max:3600,step:60,unit:"s"}),/*#__PURE__*/React.createElement("div",{className:"pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-gray-400 mb-3 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Ban,{className:"w-4 h-4 text-red-400"}),t('excludedNodes')||'Excluded Nodes'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mb-3"},t('excludedNodesDesc')||'These nodes will never be targets for automatic VM balancing.'),(selectedCluster.excluded_nodes||[]).length>0?/*#__PURE__*/React.createElement("div",{className:"space-y-2 mb-3"},(selectedCluster.excluded_nodes||[]).map(nodeName=>/*#__PURE__*/React.createElement("div",{key:nodeName,className:"flex items-center justify-between bg-proxmox-dark rounded-lg p-2"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Server,{className:"w-4 h-4 text-red-400"}),/*#__PURE__*/React.createElement("span",{className:"text-sm"},nodeName)),/*#__PURE__*/React.createElement("button",{onClick:async()=>{try{const res=await fetch(`${API_URL}/clusters/${selectedCluster.id}/excluded-nodes/${nodeName}`,{method:'DELETE',credentials:'include',headers:getAuthHeaders()});if(res.ok){fetchClusters();addToast(`${nodeName} ${t('reincludedInBalancing')||'re-included in balancing'}`,'success');}}catch(e){console.error(e);}},className:"text-xs text-green-400 hover:text-green-300"},t('include')||'Include')))):/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-600 mb-3 p-2 bg-proxmox-dark rounded-lg"},t('noExcludedNodes')||'No nodes excluded'),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("select",{id:"excludeNodeSelect",className:"flex-1 bg-proxmox-dark border border-proxmox-border rounded-lg px-3 py-2 text-sm",defaultValue:""},/*#__PURE__*/React.createElement("option",{value:"",disabled:true},t('selectNodeToExclude')||'Select node to exclude...'),Object.keys(clusterMetrics||{}).filter(n=>!(selectedCluster.excluded_nodes||[]).includes(n)).map(nodeName=>/*#__PURE__*/React.createElement("option",{key:nodeName,value:nodeName},nodeName))),/*#__PURE__*/React.createElement("button",{onClick:async()=>{const select=document.getElementById('excludeNodeSelect');const nodeName=select?.value;if(!nodeName)return;try{const res=await fetch(`${API_URL}/clusters/${selectedCluster.id}/excluded-nodes/${nodeName}`,{method:'POST',credentials:'include',headers:getAuthHeaders()});if(res.ok){fetchClusters();addToast(`${nodeName} ${t('excludedFromBalancing')||'excluded from balancing'}`,'success');select.value='';}}catch(e){console.error(e);}},className:"px-3 py-2 bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30 text-sm flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.Ban,{className:"w-4 h-4"}),t('exclude')||'Exclude'))),/*#__PURE__*/React.createElement("div",{className:"pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-gray-400 mb-3 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Monitor,{className:"w-4 h-4 text-red-400"}),t('excludedVMs')||'Excluded VMs'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mb-3"},t('excludedVMsDesc')||'These VMs will never be automatically migrated during load balancing.'),/*#__PURE__*/React.createElement(ExcludedVMsList,{clusterId:selectedCluster.id,clusterMetrics:clusterMetrics,addToast:addToast,getAuthHeaders:getAuthHeaders}))),/*#__PURE__*/React.createElement("div",{className:isCorporate?'border border-proxmox-border p-4 space-y-4':'bg-proxmox-card border border-proxmox-border rounded-xl p-6 space-y-6'},/*#__PURE__*/React.createElement("h3",{className:isCorporate?'font-semibold text-sm':'font-semibold'},t('optionsTitle')),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement(Toggle,{checked:selectedCluster.enabled,onChange:v=>updateConfig('enabled',v),label:t('balancingEnabled')}),/*#__PURE__*/React.createElement(Toggle,{checked:selectedCluster.auto_migrate,onChange:v=>updateConfig('auto_migrate',v),label:t('autoMigrate')}),/*#__PURE__*/React.createElement(Toggle,{checked:selectedCluster.dry_run,onChange:v=>updateConfig('dry_run',v),label:t('dryRun')}),/*#__PURE__*/React.createElement("div",{className:"pt-3 border-t border-gray-700/50"},/*#__PURE__*/React.createElement(Toggle,{checked:selectedCluster.balance_containers||false,onChange:v=>updateConfig('balance_containers',v),label:t('balanceContainers')}),selectedCluster.balance_containers&&/*#__PURE__*/React.createElement("div",{className:"mt-2 ml-12 p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-2"},/*#__PURE__*/React.createElement("span",{className:"text-yellow-500"},"\u26A0\uFE0F"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-yellow-200"},t('containerBalanceWarning'))))),/*#__PURE__*/React.createElement("div",{className:"pt-3 border-t border-gray-700/50"},/*#__PURE__*/React.createElement(Toggle,{checked:selectedCluster.balance_local_disks||false,onChange:v=>updateConfig('balance_local_disks',v),label:t('balanceLocalDisks')}),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 pl-12 mt-1"},t('balanceLocalDisksDesc')),selectedCluster.balance_local_disks&&/*#__PURE__*/React.createElement("div",{className:"mt-2 ml-12 p-3 bg-orange-500/10 border border-orange-500/30 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-2"},/*#__PURE__*/React.createElement("span",{className:"text-orange-500"},"\uD83D\uDCBE"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-orange-200"},t('localDiskBalanceWarning')))))),/*#__PURE__*/React.createElement("div",{className:"pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-gray-400 mb-3"},t('highAvailability')),/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement(Toggle,{checked:selectedCluster.ha_enabled||false,onChange:v=>updateConfig('ha_enabled',v),label:t('haEnabled')}),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 pl-12"},t('haMonitorDesc')),selectedCluster.ha_enabled&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"ml-12 p-3 bg-green-500/10 border border-green-500/20 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-green-400 text-sm"},/*#__PURE__*/React.createElement("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),t('haMonitorActive'))),/*#__PURE__*/React.createElement("div",{className:"ml-12 mt-3 p-3 bg-proxmox-dark rounded-lg border border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-400 mb-2"},t('fallbackHostsAuto')),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},t('primary'),":"),/*#__PURE__*/React.createElement("span",{className:"font-mono text-sm text-white"},selectedCluster.host),selectedCluster.current_host&&selectedCluster.current_host!==selectedCluster.host&&/*#__PURE__*/React.createElement("span",{className:"text-yellow-400 text-xs"},"(",t('fallback'),")")),selectedCluster.fallback_hosts&&selectedCluster.fallback_hosts.length>0?/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 mt-1"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},t('fallbacks'),":"),/*#__PURE__*/React.createElement("span",{className:"font-mono text-sm text-gray-300"},selectedCluster.fallback_hosts.join(', '))):/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-600 mt-1"},t('noFallbackHosts')))),selectedCluster.ha_enabled&&/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowHaSettings(true);fetchHAStatus(selectedCluster.id);},className:"ml-12 mt-2 text-xs text-proxmox-orange hover:text-orange-400 flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.Settings,{className:"w-3 h-3"}),t('splitBrainPrevention')," (",t('important2NodeCluster'),")"))),/*#__PURE__*/React.createElement("div",{className:"pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-gray-400 mb-3"},t('proxmoxNativeHa')),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-3"},t('nativeHaDesc')),/*#__PURE__*/React.createElement(ProxmoxHaSection,{clusterId:selectedCluster.id})),/*#__PURE__*/React.createElement("div",{className:"pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("h4",{className:"text-sm font-medium text-gray-400 mb-3"},t('clusterInfo')),/*#__PURE__*/React.createElement("div",{className:"space-y-2 text-sm"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},t('primaryHost')),/*#__PURE__*/React.createElement("span",{className:"font-mono"},selectedCluster.host)),selectedCluster.current_host&&selectedCluster.current_host!==selectedCluster.host&&/*#__PURE__*/React.createElement("div",{className:"flex justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},t('connectedTo')),/*#__PURE__*/React.createElement("span",{className:"font-mono text-yellow-400"},selectedCluster.current_host," (",t('fallback'),")")),selectedCluster.fallback_hosts&&selectedCluster.fallback_hosts.length>0&&/*#__PURE__*/React.createElement("div",{className:"flex justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},t('fallbackHosts')),/*#__PURE__*/React.createElement("span",{className:"font-mono text-xs text-gray-400"},selectedCluster.fallback_hosts.length," ",t('configured'))),/*#__PURE__*/React.createElement("div",{className:"flex justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},t('status')),/*#__PURE__*/React.createElement("span",{className:selectedCluster.status==='running'?'text-green-400':'text-gray-400'},selectedCluster.status==='running'?t('running'):selectedCluster.status)),selectedCluster.last_run&&/*#__PURE__*/React.createElement("div",{className:"flex justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},t('lastCheck')),/*#__PURE__*/React.createElement("span",null,new Date(selectedCluster.last_run).toLocaleString()))))),/*#__PURE__*/React.createElement("div",{className:"lg:col-span-2"},/*#__PURE__*/React.createElement(UpdateManagerSection,{key:selectedCluster.id,clusterId:selectedCluster.id,addToast:addToast})),/*#__PURE__*/React.createElement("div",{className:`lg:col-span-2 ${isCorporate?'border border-proxmox-border p-4':'bg-proxmox-card border border-proxmox-border rounded-xl p-6'}`},/*#__PURE__*/React.createElement(SmbiosAutoConfigSection,{clusterId:selectedCluster?.id,selectedCluster:selectedCluster,updateConfig:updateConfig,addToast:addToast})),/*#__PURE__*/React.createElement("div",{className:`lg:col-span-2 ${isCorporate?'border border-proxmox-border p-4':'bg-proxmox-card border border-proxmox-border rounded-xl p-6'}`},/*#__PURE__*/React.createElement("h3",{className:"font-semibold mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Palette,{className:"w-5 h-5"}),t('appearance')||'Appearance'),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("div",{className:"w-16 h-16 rounded-xl relative overflow-hidden flex-shrink-0",style:{background:PEGAPROX_THEMES[user?.theme||'proxmoxDark']?.colors?.darker||'#080B0E',border:`2px solid ${PEGAPROX_THEMES[user?.theme||'proxmoxDark']?.colors?.border||'#30363D'}`}},/*#__PURE__*/React.createElement("div",{className:"absolute left-0 top-0 bottom-0 w-3",style:{background:PEGAPROX_THEMES[user?.theme||'proxmoxDark']?.colors?.dark||'#0F1419'}}),/*#__PURE__*/React.createElement("div",{className:"absolute right-1 top-1 bottom-1 left-4 rounded",style:{background:PEGAPROX_THEMES[user?.theme||'proxmoxDark']?.colors?.card||'#161B22'}},/*#__PURE__*/React.createElement("div",{className:"w-2/3 h-1 rounded-full m-1",style:{background:PEGAPROX_THEMES[user?.theme||'proxmoxDark']?.colors?.primary||'#E57000'}}))),/*#__PURE__*/React.createElement("div",{className:"flex-1"},/*#__PURE__*/React.createElement("p",{className:"text-white font-medium flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:"text-xl"},PEGAPROX_THEMES[user?.theme||'proxmoxDark']?.icon||'ðŸŒ™'),PEGAPROX_THEMES[user?.theme||'proxmoxDark']?.name||'Proxmox Dark'),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mt-1"},t('themeInProfile')||'Change your theme in My Profile (click your username in the top right)')))))):selectedPBS?/*#__PURE__*//* LW: Feb 2026 - PBS view */React.createElement("div",{className:isCorporate?'space-y-4':'space-y-6'},/*#__PURE__*/React.createElement("div",{className:`flex items-center justify-between ${isCorporate?'px-4 py-3 border-b':''}`,style:isCorporate?{borderColor:'#485764',background:'#22343c'}:{}},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},isCorporate?/*#__PURE__*/React.createElement(Icons.Shield,{className:"w-5 h-5 flex-shrink-0",style:{color:'#49afd9'}}):/*#__PURE__*/React.createElement("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500/20 to-cyan-500/10 border border-blue-500/30 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Shield,{className:"w-6 h-6 text-blue-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h1",{className:isCorporate?'text-[15px] font-medium':'text-2xl font-bold',style:{color:'#e9ecef'}},selectedPBS.name),/*#__PURE__*/React.createElement("div",{className:`flex items-center gap-3 ${isCorporate?'text-[12px]':'text-sm'}`,style:{color:'#adbbc4'}},/*#__PURE__*/React.createElement("span",null,selectedPBS.host,":",selectedPBS.port),/*#__PURE__*/React.createElement("span",{className:"flex items-center gap-1",style:{color:selectedPBS.connected?'#60b515':'#f54f47'}},/*#__PURE__*/React.createElement("span",{className:"w-2 h-2 rounded-full",style:{background:selectedPBS.connected?'#60b515':'#f54f47'}}),selectedPBS.connected?'Connected':'Disconnected'),pbsStatus?.version&&/*#__PURE__*/React.createElement("span",null,"v",pbsStatus.version.version)))),/*#__PURE__*/React.createElement("div",{className:isCorporate?'corp-toolbar flex items-center gap-1':'flex items-center gap-2'},isAdmin&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("button",{onClick:()=>{setEditingPBS(selectedPBS);setPbsForm({name:selectedPBS.name,host:selectedPBS.host,port:selectedPBS.port,user:selectedPBS.user,password:'********',api_token_id:selectedPBS.api_token_id||'',api_token_secret:selectedPBS.using_api_token?'********':'',fingerprint:selectedPBS.fingerprint||'',ssl_verify:selectedPBS.ssl_verify||false,linked_clusters:selectedPBS.linked_clusters||[],notes:selectedPBS.notes||''});setShowAddPBS(true);},className:isCorporate?'':'px-3 py-2 rounded-lg bg-proxmox-card border border-proxmox-border text-gray-400 hover:text-white hover:border-blue-500/30 transition-all text-sm flex items-center gap-2'},/*#__PURE__*/React.createElement(Icons.Edit,{className:"w-4 h-4"})," Edit"),/*#__PURE__*/React.createElement("button",{onClick:()=>handleDeletePBS(selectedPBS.id),className:isCorporate?'':'px-3 py-2 rounded-lg bg-proxmox-card border border-proxmox-border text-gray-400 hover:text-red-400 hover:border-red-500/30 transition-all text-sm flex items-center gap-2'},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-4 h-4"})," Delete")),/*#__PURE__*/React.createElement("button",{onClick:()=>{fetchPBSStatus(selectedPBS.id);fetchPBSDatastores(selectedPBS.id);fetchPBSTasks(selectedPBS.id);fetchPBSJobs(selectedPBS.id);},className:isCorporate?'':'px-3 py-2 rounded-lg bg-proxmox-card border border-proxmox-border text-gray-400 hover:text-white hover:border-proxmox-orange/30 transition-all text-sm flex items-center gap-2'},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:`w-4 h-4 ${pbsLoading?'animate-spin':''}`})," Refresh"))),/*#__PURE__*/React.createElement("div",{className:isCorporate?'flex items-center border-b border-proxmox-border':'flex items-center gap-1 p-1 bg-proxmox-card border border-proxmox-border rounded-xl w-fit'},[{id:'dashboard',label:'Dashboard',icon:Icons.Activity},{id:'datastores',label:'Datastores',icon:Icons.Database},{id:'tasks',label:'Tasks',icon:Icons.ClipboardList},{id:'jobs',label:'Jobs',icon:Icons.Clock}].map(tab=>/*#__PURE__*/React.createElement("button",{key:tab.id,onClick:()=>setPbsActiveTab(tab.id),className:isCorporate?`flex items-center gap-1 px-3 py-1.5 text-[13px] border-b-2 -mb-px ${pbsActiveTab===tab.id?'border-blue-500 text-white font-medium':'border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-600'}`:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${pbsActiveTab===tab.id?'bg-blue-500 text-white':'text-gray-400 hover:text-white hover:bg-proxmox-hover'}`},/*#__PURE__*/React.createElement(tab.icon,{className:isCorporate?'w-3 h-3':undefined})," ",tab.label))),pbsActiveTab==='dashboard'&&pbsStatus&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4"},(()=>{const srv=pbsStatus.server||{};const cpuPct=((srv.cpu||0)*100).toFixed(1);const memUsed=srv.memory?.used||0;const memTotal=srv.memory?.total||1;const memPct=(memUsed/memTotal*100).toFixed(1);const rootUsed=srv.root?.used||0;const rootTotal=srv.root?.total||1;const rootPct=(rootUsed/rootTotal*100).toFixed(1);const uptime=srv.uptime||0;const days=Math.floor(uptime/86400);const hours=Math.floor(uptime%86400/3600);const mins=Math.floor(uptime%3600/60);// LW: corporate Clarity gauge cards
const cardCls=isCorporate?'p-3 border-b':'bg-proxmox-card border border-proxmox-border rounded-xl p-4';const cardStyle=isCorporate?{borderColor:'#37474f',background:'#22343c'}:{};const barBg=isCorporate?'#1b2a32':undefined;const barRadius=isCorporate?'1px':undefined;const barH=isCorporate?'h-1.5':'h-2';const barRound=isCorporate?'':'rounded-full';const pbsBarColor=(pct,threshHigh,threshMid,colorLow)=>{if(parseFloat(pct)>threshHigh)return isCorporate?'#f54f47':undefined;if(parseFloat(pct)>threshMid)return isCorporate?'#efc006':undefined;return isCorporate?colorLow:undefined;};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:cardCls,style:cardStyle},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("span",{className:isCorporate?'text-[12px]':'text-sm',style:{color:'#adbbc4'}},"CPU"),/*#__PURE__*/React.createElement("span",{className:isCorporate?'text-[14px] font-medium':'text-lg font-bold',style:{color:'#e9ecef'}},cpuPct,"%")),/*#__PURE__*/React.createElement("div",{className:`w-full ${barH} ${isCorporate?'':'bg-proxmox-dark'} ${barRound} overflow-hidden`,style:barBg?{background:barBg,borderRadius:barRadius}:{}},/*#__PURE__*/React.createElement("div",{className:`h-full ${barRound} transition-all ${!isCorporate?parseFloat(cpuPct)>80?'bg-red-500':parseFloat(cpuPct)>50?'bg-yellow-500':'bg-blue-500':''}`,style:{width:`${cpuPct}%`,...(isCorporate?{background:pbsBarColor(cpuPct,80,50,'#49afd9'),borderRadius:barRadius}:{})}})),/*#__PURE__*/React.createElement("div",{className:"text-xs mt-2",style:{color:'#728b9a'}},srv.cpuinfo?.cpus||'?'," CPUs - ",srv.cpuinfo?.model||'')),/*#__PURE__*/React.createElement("div",{className:cardCls,style:cardStyle},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("span",{className:isCorporate?'text-[12px]':'text-sm',style:{color:'#adbbc4'}},"Memory"),/*#__PURE__*/React.createElement("span",{className:isCorporate?'text-[14px] font-medium':'text-lg font-bold',style:{color:'#e9ecef'}},memPct,"%")),/*#__PURE__*/React.createElement("div",{className:`w-full ${barH} bg-proxmox-dark ${barRound} overflow-hidden`,style:barBg?{background:barBg,borderRadius:barRadius}:{}},/*#__PURE__*/React.createElement("div",{className:`h-full ${barRound} transition-all ${parseFloat(memPct)>80?'bg-red-500':parseFloat(memPct)>50?'bg-yellow-500':'bg-green-500'}`,style:isCorporate?{width:`${memPct}%`,background:pbsBarColor(memPct,80,50,'#49afd9'),borderRadius:barRadius}:{width:`${memPct}%`}})),/*#__PURE__*/React.createElement("div",{className:"text-xs mt-2",style:{color:'#728b9a'}},formatBytes(memUsed)," / ",formatBytes(memTotal))),/*#__PURE__*/React.createElement("div",{className:cardCls,style:cardStyle},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("span",{className:isCorporate?'text-[12px]':'text-sm',style:{color:'#adbbc4'}},"Root Disk"),/*#__PURE__*/React.createElement("span",{className:isCorporate?'text-[14px] font-medium':'text-lg font-bold',style:{color:'#e9ecef'}},rootPct,"%")),/*#__PURE__*/React.createElement("div",{className:`w-full ${barH} bg-proxmox-dark ${barRound} overflow-hidden`,style:barBg?{background:barBg,borderRadius:barRadius}:{}},/*#__PURE__*/React.createElement("div",{className:`h-full ${barRound} transition-all ${parseFloat(rootPct)>85?'bg-red-500':parseFloat(rootPct)>60?'bg-yellow-500':'bg-cyan-500'}`,style:isCorporate?{width:`${rootPct}%`,background:pbsBarColor(rootPct,85,60,'#49afd9'),borderRadius:barRadius}:{width:`${rootPct}%`}})),/*#__PURE__*/React.createElement("div",{className:"text-xs mt-2",style:{color:'#728b9a'}},formatBytes(rootUsed)," / ",formatBytes(rootTotal))),/*#__PURE__*/React.createElement("div",{className:cardCls,style:cardStyle},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("span",{className:isCorporate?'text-[12px]':'text-sm',style:{color:'#adbbc4'}},"Uptime"),/*#__PURE__*/React.createElement(Icons.Clock,{className:"w-4 h-4",style:{color:'#728b9a'}})),/*#__PURE__*/React.createElement("div",{className:isCorporate?'text-[14px] font-medium':'text-lg font-bold',style:{color:'#e9ecef'}},days,"d ",hours,"h ",mins,"m"),/*#__PURE__*/React.createElement("div",{className:"text-xs mt-2",style:{color:'#728b9a'}},"Load: ",(srv.loadavg||[0,0,0]).map(v=>v.toFixed(2)).join(', '))));})()),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:isCorporate?'corp-section-header':'text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4'},"Datastores (",pbsDatastores.length,")"),/*#__PURE__*/React.createElement("div",{className:isCorporate?'space-y-0':'grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4'},pbsDatastores.map(ds=>{const used=ds.used||0;const total=ds.total||ds.avail?(ds.used||0)+(ds.avail||0):1;const pct=total>0?(used/total*100).toFixed(1):0;const detail=ds.detail||{};const gcStatus=detail['gc-status']||{};const pctColor=isCorporate?parseFloat(pct)>85?'#f54f47':parseFloat(pct)>60?'#efc006':'#60b515':undefined;return/*#__PURE__*/React.createElement("div",{key:ds.name||ds.store,className:isCorporate?'flex items-center gap-3 px-3 py-2 cursor-pointer':'bg-proxmox-card border border-proxmox-border rounded-xl p-4 hover:border-blue-500/30 transition-all cursor-pointer',style:isCorporate?{borderBottom:'1px solid #37474f'}:{},onClick:()=>{setPbsActiveTab('datastores');setPbsSelectedStore(ds.name||ds.store);},onMouseEnter:isCorporate?e=>{e.currentTarget.style.background='#29414e';}:undefined,onMouseLeave:isCorporate?e=>{e.currentTarget.style.background='';}:undefined},isCorporate?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Icons.Database,{className:"w-3.5 h-3.5 flex-shrink-0",style:{color:'#49afd9'}}),/*#__PURE__*/React.createElement("span",{className:"text-[13px] font-medium w-32 truncate",style:{color:'#e9ecef'}},ds.name||ds.store),/*#__PURE__*/React.createElement("div",{className:"flex-1 h-1.5 overflow-hidden",style:{background:'#1b2a32',borderRadius:'1px'}},/*#__PURE__*/React.createElement("div",{className:"h-full",style:{width:`${pct}%`,background:pctColor,borderRadius:'1px'}})),/*#__PURE__*/React.createElement("span",{className:"text-[12px] w-12 text-right",style:{color:pctColor}},pct,"%"),/*#__PURE__*/React.createElement("span",{className:"text-[11px]",style:{color:'#728b9a'}},formatBytes(used)," / ",formatBytes(total)),gcStatus.index&&/*#__PURE__*/React.createElement("span",{className:"text-[11px]",style:{color:'#49afd9'}},(gcStatus['dedup-factor']||1).toFixed(1),"x")):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Database,{className:"w-5 h-5 text-blue-400"}),/*#__PURE__*/React.createElement("span",{className:"font-semibold text-white"},ds.name||ds.store)),/*#__PURE__*/React.createElement("span",{className:`text-sm font-bold ${parseFloat(pct)>85?'text-red-400':parseFloat(pct)>60?'text-yellow-400':'text-green-400'}`},pct,"%")),/*#__PURE__*/React.createElement("div",{className:"w-full h-2 bg-proxmox-dark rounded-full overflow-hidden mb-3"},/*#__PURE__*/React.createElement("div",{className:`h-full rounded-full ${parseFloat(pct)>85?'bg-red-500':parseFloat(pct)>60?'bg-yellow-500':'bg-blue-500'}`,style:{width:`${pct}%`}})),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-2 text-xs"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Used:")," ",/*#__PURE__*/React.createElement("span",{className:"text-gray-300"},formatBytes(used))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Total:")," ",/*#__PURE__*/React.createElement("span",{className:"text-gray-300"},formatBytes(total))),gcStatus.index&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Dedup:")," ",/*#__PURE__*/React.createElement("span",{className:"text-cyan-400"},(gcStatus['dedup-factor']||1).toFixed(2),"x")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Chunks:")," ",/*#__PURE__*/React.createElement("span",{className:"text-gray-300"},(gcStatus['disk-chunks']||0).toLocaleString()))),detail['total-snapshots']!==undefined&&/*#__PURE__*/React.createElement("div",{className:"col-span-2"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Snapshots:")," ",/*#__PURE__*/React.createElement("span",{className:"text-gray-300"},detail['total-snapshots']))),isAdmin&&/*#__PURE__*/React.createElement("div",{className:"flex gap-2 mt-3 pt-3 border-t border-proxmox-border/50"},/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();setPbsActionLoading(p=>({...p,[`gc-${ds.name||ds.store}`]:true}));pbsAction('gc',ds.name||ds.store).finally(()=>setPbsActionLoading(p=>({...p,[`gc-${ds.name||ds.store}`]:false})));},className:"flex-1 px-2 py-1 rounded bg-proxmox-dark text-xs text-gray-400 hover:text-white hover:bg-blue-500/20 transition-all",disabled:pbsActionLoading[`gc-${ds.name||ds.store}`]},pbsActionLoading[`gc-${ds.name||ds.store}`]?'Starting...':'GC'),/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();pbsAction('verify',ds.name||ds.store);},className:"flex-1 px-2 py-1 rounded bg-proxmox-dark text-xs text-gray-400 hover:text-white hover:bg-green-500/20 transition-all"},"Verify"))));}))),pbsDisks.length>0&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:isCorporate?'corp-section-header':'text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4'},"Disks (",pbsDisks.length,")"),/*#__PURE__*/React.createElement("div",{className:isCorporate?'overflow-hidden':'bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden'},/*#__PURE__*/React.createElement("table",{className:isCorporate?'corp-datagrid':'w-full text-sm'},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",{className:isCorporate?'':'border-b border-proxmox-border text-gray-500 text-xs'},/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3'},"Device"),/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3'},"Type"),/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3'},"Size"),/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3'},"Model"),/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3'},"Status"))),/*#__PURE__*/React.createElement("tbody",null,pbsDisks.map((disk,i)=>/*#__PURE__*/React.createElement("tr",{key:i,className:"border-b border-proxmox-border/50"},/*#__PURE__*/React.createElement("td",{className:"p-3 text-white font-medium font-mono text-xs"},disk.devpath||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},disk.disk_type||disk['disk-type']||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300"},disk.size?formatBytes(disk.size):'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400 truncate max-w-[200px]"},disk.model||disk.vendor||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs ${disk.health==='PASSED'||disk.health==='OK'?'bg-green-500/20 text-green-400':disk.health==='UNKNOWN'?'bg-gray-500/20 text-gray-400':'bg-red-500/20 text-red-400'}`},disk.health||disk.wearout||'N/A')))))))),pbsTasks.length>0&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:isCorporate?'corp-section-header':'text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4'},"Recent Tasks"),/*#__PURE__*/React.createElement("div",{className:isCorporate?'overflow-hidden':'bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden'},/*#__PURE__*/React.createElement("table",{className:isCorporate?'corp-datagrid':'w-full text-sm'},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",{className:isCorporate?'':'border-b border-proxmox-border text-gray-500 text-xs'},/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3'},"Type"),/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3'},"Status"),/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3'},"Started"),/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3'},"Duration"),/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3'},"Worker"))),/*#__PURE__*/React.createElement("tbody",null,pbsTasks.slice(0,10).map((task,i)=>/*#__PURE__*/React.createElement("tr",{key:i,className:"border-b border-proxmox-border/50 hover:bg-proxmox-hover/30 cursor-pointer",onClick:()=>viewPBSTaskLog(task.upid)},/*#__PURE__*/React.createElement("td",{className:"p-3 text-white font-medium"},task.worker_type||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${task.status==='OK'||task.status==='ok'?'bg-green-500/20 text-green-400':task.status&&task.status.startsWith&&task.status.startsWith('WARNINGS')?'bg-yellow-500/20 text-yellow-400':!task.endtime?'bg-blue-500/20 text-blue-400':'bg-red-500/20 text-red-400'}`},!task.endtime?'running':task.status||'?')),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},task.starttime?new Date(task.starttime*1000).toLocaleString():'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},task.starttime?pbsFormatDuration(task.starttime,task.endtime):'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-500 truncate max-w-[200px]"},task.worker_id||'-'))))))),selectedPBS.linked_clusters&&selectedPBS.linked_clusters.length>0&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4"},"Linked PVE Clusters"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 flex-wrap"},selectedPBS.linked_clusters.map(cid=>{const cl=clusters.find(c=>c.id===cid);return cl?/*#__PURE__*/React.createElement("button",{key:cid,onClick:()=>{setSelectedCluster(cl);setSelectedPBS(null);},className:"px-3 py-2 rounded-lg bg-proxmox-card border border-proxmox-border text-sm text-gray-300 hover:text-white hover:border-proxmox-orange/30 transition-all flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Server,{className:"w-4 h-4 text-proxmox-orange"}),cl.name):null;}))),pbsTrafficControl&&pbsTrafficControl.length>0&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:isCorporate?'corp-section-header':'text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4'},"Traffic Control"),/*#__PURE__*/React.createElement("div",{className:isCorporate?'overflow-hidden':'bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden'},/*#__PURE__*/React.createElement("table",{className:isCorporate?'corp-datagrid':'w-full text-sm'},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",{className:isCorporate?'':'border-b border-proxmox-border text-gray-500 text-xs'},/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3'},"Name"),/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3'},"Rate In"),/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3'},"Rate Out"),/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3'},"Burst In"),/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3'},"Burst Out"),/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3'},"Network"),/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3'},"Timeframe"))),/*#__PURE__*/React.createElement("tbody",null,pbsTrafficControl.map((tc,i)=>/*#__PURE__*/React.createElement("tr",{key:i,className:"border-b border-proxmox-border/50 hover:bg-proxmox-hover/30"},/*#__PURE__*/React.createElement("td",{className:"p-3 text-white font-medium"},tc.name||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-cyan-400"},tc['rate-in']?formatBytes(tc['rate-in'])+'/s':'unlimited'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-cyan-400"},tc['rate-out']?formatBytes(tc['rate-out'])+'/s':'unlimited'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},tc['burst-in']?formatBytes(tc['burst-in']):'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},tc['burst-out']?formatBytes(tc['burst-out']):'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},(tc.network||[]).join(', ')||'all'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-500"},tc.timeframe||'always'))))))),pbsNotifications&&(pbsNotifications.targets?.length>0||pbsNotifications.matchers?.length>0)&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4"},"Notifications"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},pbsNotifications.targets?.length>0&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-medium text-gray-300 mb-3 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Bell,{className:"w-4 h-4 text-blue-400"}),"Targets (",pbsNotifications.targets.length,")"),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},pbsNotifications.targets.map((t,i)=>/*#__PURE__*/React.createElement("div",{key:i,className:"flex items-center justify-between p-2 rounded bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${t.type==='sendmail'?'bg-green-500/20 text-green-400':t.type==='smtp'?'bg-blue-500/20 text-blue-400':t.type==='gotify'?'bg-purple-500/20 text-purple-400':t.type==='webhook'?'bg-orange-500/20 text-orange-400':'bg-gray-500/20 text-gray-400'}`},t.type||'unknown'),/*#__PURE__*/React.createElement("span",{className:"text-white text-sm"},t.name||t.endpoint||'-')),t.disable&&/*#__PURE__*/React.createElement("span",{className:"text-xs text-red-400"},"disabled"))))),pbsNotifications.matchers?.length>0&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-medium text-gray-300 mb-3 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Filter,{className:"w-4 h-4 text-yellow-400"}),"Matchers (",pbsNotifications.matchers.length,")"),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},pbsNotifications.matchers.map((m,i)=>/*#__PURE__*/React.createElement("div",{key:i,className:"flex items-center justify-between p-2 rounded bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-white text-sm"},m.name||'-'),m.target&&/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 ml-2"},"to: ",Array.isArray(m.target)?m.target.join(', '):m.target)),m.disable&&/*#__PURE__*/React.createElement("span",{className:"text-xs text-red-400"},"disabled"))))))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-4"},/*#__PURE__*/React.createElement("h2",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider"},"System Log"),/*#__PURE__*/React.createElement("button",{onClick:()=>fetchPBSSyslog(selectedPBS.id,200),className:"text-xs text-gray-500 hover:text-white transition-colors flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-3 h-3"}),"Load More")),pbsSyslog.length>0?/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl p-3 max-h-64 overflow-y-auto font-mono text-xs"},pbsSyslog.map((entry,i)=>/*#__PURE__*/React.createElement("div",{key:i,className:`py-0.5 ${(entry.t||entry.n||'').toLowerCase().includes('error')?'text-red-400':(entry.t||entry.n||'').toLowerCase().includes('warn')?'text-yellow-400':'text-gray-400'}`},entry.t||entry.n||JSON.stringify(entry)))):/*#__PURE__*/React.createElement("button",{onClick:()=>fetchPBSSyslog(selectedPBS.id),className:"w-full text-center py-6 text-gray-500 bg-proxmox-card border border-proxmox-border rounded-xl hover:border-blue-500/30 transition-all cursor-pointer"},/*#__PURE__*/React.createElement(Icons.Terminal,{className:"w-6 h-6 mx-auto mb-2 opacity-30"}),/*#__PURE__*/React.createElement("span",{className:"text-sm"},"Click to load syslog")))),pbsActiveTab==='datastores'&&/*#__PURE__*/React.createElement("div",{className:"flex gap-6"},/*#__PURE__*/React.createElement("div",{className:"w-64 shrink-0 space-y-2"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider mb-2"},"Datastores"),pbsDatastores.map(ds=>{const name=ds.name||ds.store;const used=ds.used||0;const total=ds.used&&ds.avail?ds.used+ds.avail:1;const pct=total>0?(used/total*100).toFixed(0):0;return/*#__PURE__*/React.createElement("button",{key:name,onClick:()=>{setPbsSelectedStore(name);setPbsSelectedGroup(null);},className:`w-full text-left px-3 py-2.5 rounded-xl transition-all ${pbsSelectedStore===name?'bg-blue-500/20 border border-blue-500/30 text-white':'bg-proxmox-card border border-proxmox-border text-gray-300 hover:border-blue-500/20'}`},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-sm font-medium truncate"},name),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},pct,"%")),/*#__PURE__*/React.createElement("div",{className:"w-full h-1 bg-proxmox-dark rounded-full mt-1.5 overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"h-full bg-blue-500 rounded-full",style:{width:`${pct}%`}})));})),/*#__PURE__*/React.createElement("div",{className:"flex-1 min-w-0 space-y-6"},pbsSelectedStore?/*#__PURE__*/React.createElement(React.Fragment,null,isAdmin&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 flex-wrap"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setPbsActionLoading(p=>({...p,gc:true}));pbsAction('gc',pbsSelectedStore).finally(()=>setPbsActionLoading(p=>({...p,gc:false})));},disabled:pbsActionLoading.gc,className:"px-3 py-2 rounded-lg bg-proxmox-card border border-proxmox-border text-sm text-gray-300 hover:text-white hover:border-blue-500/30 transition-all flex items-center gap-2 disabled:opacity-50"},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-4 h-4"})," ",pbsActionLoading.gc?'Starting...':'Garbage Collection'),/*#__PURE__*/React.createElement("button",{onClick:()=>{setPbsActionLoading(p=>({...p,verify:true}));pbsAction('verify',pbsSelectedStore).finally(()=>setPbsActionLoading(p=>({...p,verify:false})));},disabled:pbsActionLoading.verify,className:"px-3 py-2 rounded-lg bg-proxmox-card border border-proxmox-border text-sm text-gray-300 hover:text-white hover:border-green-500/30 transition-all flex items-center gap-2 disabled:opacity-50"},/*#__PURE__*/React.createElement(Icons.CheckCircle,{className:"w-4 h-4"})," ",pbsActionLoading.verify?'Starting...':'Verify'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowPbsPrune(pbsSelectedStore),className:"px-3 py-2 rounded-lg bg-proxmox-card border border-proxmox-border text-sm text-gray-300 hover:text-white hover:border-yellow-500/30 transition-all flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Archive,{className:"w-4 h-4"})," Prune")),(()=>{const currentDs=pbsDatastores.find(d=>(d.name||d.store)===pbsSelectedStore);const gcStatus=currentDs?.detail?.['gc-status']||{};return/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-4 items-start"},pbsNamespaces.length>0&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-3 flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},"Namespace:"),/*#__PURE__*/React.createElement("select",{className:"bg-proxmox-dark border border-proxmox-border rounded px-2 py-1 text-sm text-white",defaultValue:""},/*#__PURE__*/React.createElement("option",{value:""},"Root"),pbsNamespaces.map((ns,i)=>/*#__PURE__*/React.createElement("option",{key:i,value:ns.ns||ns.name},ns.ns||ns.name)))),gcStatus['last-run-endtime']&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-3 flex-1 min-w-[300px]"},/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 block mb-1.5"},"Garbage Collection"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Last GC:"),/*#__PURE__*/React.createElement("span",{className:"text-gray-300"},new Date(gcStatus['last-run-endtime']*1000).toLocaleString()),/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Duration:"),/*#__PURE__*/React.createElement("span",{className:"text-gray-300"},gcStatus['last-run-duration']?`${Math.floor(gcStatus['last-run-duration']/60)}m ${gcStatus['last-run-duration']%60}s`:'-'),/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Dedup Factor:"),/*#__PURE__*/React.createElement("span",{className:"text-cyan-400 font-medium"},(gcStatus['dedup-factor']||1).toFixed(2),"x"),/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Disk Chunks:"),/*#__PURE__*/React.createElement("span",{className:"text-gray-300"},(gcStatus['disk-chunks']||0).toLocaleString()),/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Disk Bytes:"),/*#__PURE__*/React.createElement("span",{className:"text-gray-300"},formatBytes(gcStatus['disk-bytes']||0)),gcStatus['pending-chunks']>0&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Pending:"),/*#__PURE__*/React.createElement("span",{className:"text-yellow-400"},gcStatus['pending-chunks']," chunks (",formatBytes(gcStatus['pending-bytes']||0),")")),gcStatus['removed-chunks']>0&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},"Removed:"),/*#__PURE__*/React.createElement("span",{className:"text-green-400"},gcStatus['removed-chunks']," chunks (",formatBytes(gcStatus['removed-bytes']||0),")")))));})(),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3"},"Backup Groups (",pbsGroups.length,")"),pbsGroups.length>0?/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("table",{className:"w-full text-sm"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",{className:"border-b border-proxmox-border text-gray-500 text-xs"},/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Type"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"ID"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Backups"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Last Backup"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Size"),/*#__PURE__*/React.createElement("th",{className:"text-right p-3"},"Notes"))),/*#__PURE__*/React.createElement("tbody",null,pbsGroups.sort((a,b)=>`${a['backup-type']}/${a['backup-id']}`.localeCompare(`${b['backup-type']}/${b['backup-id']}`)).map((grp,i)=>/*#__PURE__*/React.createElement("tr",{key:i,className:`border-b border-proxmox-border/50 hover:bg-proxmox-hover/30 cursor-pointer ${pbsSelectedGroup===`${grp['backup-type']}/${grp['backup-id']}`?'bg-blue-500/10':''}`,onClick:()=>setPbsSelectedGroup(`${grp['backup-type']}/${grp['backup-id']}`)},/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${grp['backup-type']==='vm'?'bg-blue-500/20 text-blue-400':grp['backup-type']==='ct'?'bg-green-500/20 text-green-400':'bg-purple-500/20 text-purple-400'}`},grp['backup-type'])),/*#__PURE__*/React.createElement("td",{className:"p-3 text-white font-medium"},grp['backup-id']),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300"},grp['backup-count']||grp.count||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},grp['last-backup']?new Date(grp['last-backup']*1000).toLocaleString():'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},grp.size?formatBytes(grp.size):'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-right",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("button",{onClick:()=>{setPbsEditingNotes({type:'group',params:{'backup-type':grp['backup-type'],'backup-id':grp['backup-id']},label:`${grp['backup-type']}/${grp['backup-id']}`});setPbsNotesText(grp.comment||grp.notes||'');},className:"px-2 py-1 rounded text-xs text-gray-500 hover:text-cyan-400 hover:bg-cyan-500/10 transition-all",title:"Group Notes"},/*#__PURE__*/React.createElement(Icons.FileText,{className:"w-3.5 h-3.5"})))))))):/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500 bg-proxmox-card border border-proxmox-border rounded-xl"},"No backup groups found")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-3"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider"},"Snapshots ",pbsSelectedGroup?`- ${pbsSelectedGroup}`:`(All)`),pbsSelectedGroup&&/*#__PURE__*/React.createElement("button",{onClick:()=>setPbsSelectedGroup(null),className:"text-xs text-gray-500 hover:text-white transition-colors"},"Show All")),(()=>{const filtered=pbsSelectedGroup?pbsSnapshots.filter(s=>`${s['backup-type']}/${s['backup-id']}`===pbsSelectedGroup):pbsSnapshots;const sorted=[...filtered].sort((a,b)=>(b['backup-time']||0)-(a['backup-time']||0));return sorted.length>0?/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("table",{className:"w-full text-sm"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",{className:"border-b border-proxmox-border text-gray-500 text-xs"},/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Type/ID"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Time"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Size"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Verified"),/*#__PURE__*/React.createElement("th",{className:"text-center p-3"},"Protected"),/*#__PURE__*/React.createElement("th",{className:"text-right p-3"},"Actions"))),/*#__PURE__*/React.createElement("tbody",null,sorted.slice(0,50).map((snap,i)=>/*#__PURE__*/React.createElement("tr",{key:i,className:"border-b border-proxmox-border/50 hover:bg-proxmox-hover/30"},/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:"text-white"},snap['backup-type'],"/",snap['backup-id'])),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300"},snap['backup-time']?new Date(snap['backup-time']*1000).toLocaleString():'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},snap.size?formatBytes(snap.size):'-'),/*#__PURE__*/React.createElement("td",{className:"p-3"},snap.verification?/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs ${snap.verification.state==='ok'?'bg-green-500/20 text-green-400':'bg-red-500/20 text-red-400'}`},snap.verification.state):/*#__PURE__*/React.createElement("span",{className:"text-gray-600"},"-")),/*#__PURE__*/React.createElement("td",{className:"p-3 text-center"},/*#__PURE__*/React.createElement("button",{onClick:()=>isAdmin&&pbsToggleProtected(snap),className:`px-2 py-0.5 rounded text-xs transition-all ${snap.protected?'bg-yellow-500/20 text-yellow-400 border border-yellow-500/30':'bg-proxmox-dark text-gray-600 border border-proxmox-border'} ${isAdmin?'cursor-pointer hover:opacity-80':'cursor-default'}`,title:isAdmin?'Toggle protection':snap.protected?'Protected':'Unprotected'},snap.protected?Icons.Shield?/*#__PURE__*/React.createElement(Icons.Shield,{className:"w-3.5 h-3.5 inline"}):'Yes':'-')),/*#__PURE__*/React.createElement("td",{className:"p-3 text-right flex items-center justify-end gap-1"},snap['backup-type']==='host'?/*#__PURE__*/React.createElement("button",{onClick:()=>pbsOpenFileBrowser(snap),className:"px-2 py-1 rounded text-xs text-gray-500 hover:text-blue-400 hover:bg-blue-500/10 transition-all",title:"Browse Files"},Icons.FolderOpen?/*#__PURE__*/React.createElement(Icons.FolderOpen,{className:"w-3.5 h-3.5"}):/*#__PURE__*/React.createElement(Icons.Folder,{className:"w-3.5 h-3.5"})):/*#__PURE__*/React.createElement("button",{onClick:()=>pbsOpenFileBrowser(snap),className:"px-2 py-1 rounded text-xs text-gray-600 hover:text-blue-400 hover:bg-blue-500/10 transition-all",title:"Browse Catalog (if available)"},/*#__PURE__*/React.createElement(Icons.Folder,{className:"w-3.5 h-3.5"})),/*#__PURE__*/React.createElement("button",{onClick:()=>{setPbsEditingNotes({type:'snapshot',params:{'backup-type':snap['backup-type'],'backup-id':snap['backup-id'],'backup-time':snap['backup-time']},label:`${snap['backup-type']}/${snap['backup-id']}`});setPbsNotesText(snap.comment||snap.notes||'');},className:"px-2 py-1 rounded text-xs text-gray-500 hover:text-cyan-400 hover:bg-cyan-500/10 transition-all",title:"Notes"},/*#__PURE__*/React.createElement(Icons.FileText,{className:"w-3.5 h-3.5"})),isAdmin&&/*#__PURE__*/React.createElement("button",{onClick:()=>{if(confirm(`Delete snapshot ${snap['backup-type']}/${snap['backup-id']} @ ${new Date(snap['backup-time']*1000).toLocaleString()}?`))pbsAction('delete-snapshot',pbsSelectedStore,{backup_type:snap['backup-type'],backup_id:snap['backup-id'],backup_time:snap['backup-time']});},className:"px-2 py-1 rounded text-xs text-gray-500 hover:text-red-400 hover:bg-red-500/10 transition-all",title:"Delete"},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-3.5 h-3.5"}))))))),sorted.length>50&&/*#__PURE__*/React.createElement("div",{className:"text-center py-2 text-xs text-gray-500"},"Showing 50 of ",sorted.length," snapshots")):/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500 bg-proxmox-card border border-proxmox-border rounded-xl"},"No snapshots found");})())):/*#__PURE__*/React.createElement("div",{className:"text-center py-16 text-gray-500"},/*#__PURE__*/React.createElement(Icons.Database,{className:"w-12 h-12 mx-auto mb-4 opacity-30"}),/*#__PURE__*/React.createElement("p",null,"Select a datastore to view details")))),pbsActiveTab==='tasks'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider"},"Tasks (",pbsTasks.length,")"),/*#__PURE__*/React.createElement("button",{onClick:()=>fetchPBSTasks(selectedPBS.id),className:"text-xs text-gray-500 hover:text-white transition-colors flex items-center gap-1"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-3 h-3"})," Refresh")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("table",{className:"w-full text-sm"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",{className:"border-b border-proxmox-border text-gray-500 text-xs"},/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Type"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Worker ID"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Status"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Started"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Duration"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"User"))),/*#__PURE__*/React.createElement("tbody",null,pbsTasks.map((task,i)=>/*#__PURE__*/React.createElement("tr",{key:i,className:`border-b border-proxmox-border/50 hover:bg-proxmox-hover/30 cursor-pointer ${pbsTaskLog?.upid===task.upid?'bg-blue-500/10':''}`,onClick:()=>viewPBSTaskLog(task.upid)},/*#__PURE__*/React.createElement("td",{className:"p-3 text-white font-medium"},task.worker_type||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300 truncate max-w-[200px]"},task.worker_id||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${task.status==='OK'||task.status==='ok'?'bg-green-500/20 text-green-400':task.status&&task.status.startsWith&&task.status.startsWith('WARNINGS')?'bg-yellow-500/20 text-yellow-400':!task.endtime?'bg-blue-500/20 text-blue-400 animate-pulse':'bg-red-500/20 text-red-400'}`},!task.endtime?'running':task.status||'?')),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},task.starttime?new Date(task.starttime*1000).toLocaleString():'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},task.starttime?pbsFormatDuration(task.starttime,task.endtime):'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-500"},task.user||'-'))))),pbsTasks.length===0&&/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},"No tasks found")),pbsTaskLog&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between p-3 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("span",{className:"text-sm font-medium text-white"},"Task Log"),/*#__PURE__*/React.createElement("button",{onClick:()=>setPbsTaskLog(null),className:"text-gray-500 hover:text-white"},/*#__PURE__*/React.createElement(Icons.X,{className:"w-4 h-4"}))),/*#__PURE__*/React.createElement("div",{className:"p-3"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-2"},"Status: ",/*#__PURE__*/React.createElement("span",{className:pbsTaskLog.status?.status==='stopped'?'text-green-400':'text-blue-400'},pbsTaskLog.status?.status||'?'),pbsTaskLog.status?.exitstatus&&/*#__PURE__*/React.createElement("span",null," | Exit: ",pbsTaskLog.status.exitstatus)),/*#__PURE__*/React.createElement("pre",{className:"text-xs text-gray-300 font-mono bg-proxmox-dark rounded p-3 max-h-64 overflow-auto whitespace-pre-wrap"},(pbsTaskLog.log||[]).map(l=>l.t||l.d||'').join('\n')||'No log output')))),pbsActiveTab==='jobs'&&/*#__PURE__*/React.createElement("div",{className:"space-y-6"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3"},"Sync Jobs (",(pbsJobs.sync||[]).length,")"),(pbsJobs.sync||[]).length>0?/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("table",{className:"w-full text-sm"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",{className:"border-b border-proxmox-border text-gray-500 text-xs"},/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"ID"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Store"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Remote"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Schedule"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Last Run"),isAdmin&&/*#__PURE__*/React.createElement("th",{className:"text-right p-3"},"Actions"))),/*#__PURE__*/React.createElement("tbody",null,(pbsJobs.sync||[]).map((job,i)=>/*#__PURE__*/React.createElement("tr",{key:i,className:"border-b border-proxmox-border/50 hover:bg-proxmox-hover/30"},/*#__PURE__*/React.createElement("td",{className:"p-3 text-white font-medium"},job.id),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300"},job.store),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},job.remote||'-'," / ",job['remote-store']||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},job.schedule||'manual'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-500"},job['last-run-endtime']?new Date(job['last-run-endtime']*1000).toLocaleString():'-'),isAdmin&&/*#__PURE__*/React.createElement("td",{className:"p-3 text-right"},/*#__PURE__*/React.createElement("button",{onClick:()=>pbsRunJob('sync',job.id),className:"px-2 py-1 rounded text-xs bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 transition-all flex items-center gap-1 ml-auto"},/*#__PURE__*/React.createElement(Icons.Play,{className:"w-3 h-3"})," Run"))))))):/*#__PURE__*/React.createElement("div",{className:"text-center py-6 text-gray-500 bg-proxmox-card border border-proxmox-border rounded-xl text-sm"},"No sync jobs configured")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3"},"Verify Jobs (",(pbsJobs.verify||[]).length,")"),(pbsJobs.verify||[]).length>0?/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("table",{className:"w-full text-sm"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",{className:"border-b border-proxmox-border text-gray-500 text-xs"},/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"ID"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Store"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Schedule"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Ignore Verified"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Last Run"),isAdmin&&/*#__PURE__*/React.createElement("th",{className:"text-right p-3"},"Actions"))),/*#__PURE__*/React.createElement("tbody",null,(pbsJobs.verify||[]).map((job,i)=>/*#__PURE__*/React.createElement("tr",{key:i,className:"border-b border-proxmox-border/50 hover:bg-proxmox-hover/30"},/*#__PURE__*/React.createElement("td",{className:"p-3 text-white font-medium"},job.id),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300"},job.store),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},job.schedule||'manual'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},job['ignore-verified']?'Yes':'No'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-500"},job['last-run-endtime']?new Date(job['last-run-endtime']*1000).toLocaleString():'-'),isAdmin&&/*#__PURE__*/React.createElement("td",{className:"p-3 text-right"},/*#__PURE__*/React.createElement("button",{onClick:()=>pbsRunJob('verify',job.id),className:"px-2 py-1 rounded text-xs bg-green-500/20 text-green-400 hover:bg-green-500/30 transition-all flex items-center gap-1 ml-auto"},/*#__PURE__*/React.createElement(Icons.Play,{className:"w-3 h-3"})," Run"))))))):/*#__PURE__*/React.createElement("div",{className:"text-center py-6 text-gray-500 bg-proxmox-card border border-proxmox-border rounded-xl text-sm"},"No verify jobs configured")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3"},"Prune Jobs (",(pbsJobs.prune||[]).length,")"),(pbsJobs.prune||[]).length>0?/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("table",{className:"w-full text-sm"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",{className:"border-b border-proxmox-border text-gray-500 text-xs"},/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"ID"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Store"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Schedule"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Retention"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Last Run"),isAdmin&&/*#__PURE__*/React.createElement("th",{className:"text-right p-3"},"Actions"))),/*#__PURE__*/React.createElement("tbody",null,(pbsJobs.prune||[]).map((job,i)=>/*#__PURE__*/React.createElement("tr",{key:i,className:"border-b border-proxmox-border/50 hover:bg-proxmox-hover/30"},/*#__PURE__*/React.createElement("td",{className:"p-3 text-white font-medium"},job.id),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300"},job.store),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},job.schedule||'manual'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400 text-xs"},[job['keep-last']&&`L:${job['keep-last']}`,job['keep-daily']&&`D:${job['keep-daily']}`,job['keep-weekly']&&`W:${job['keep-weekly']}`,job['keep-monthly']&&`M:${job['keep-monthly']}`,job['keep-yearly']&&`Y:${job['keep-yearly']}`].filter(Boolean).join(' ')||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-500"},job['last-run-endtime']?new Date(job['last-run-endtime']*1000).toLocaleString():'-'),isAdmin&&/*#__PURE__*/React.createElement("td",{className:"p-3 text-right"},/*#__PURE__*/React.createElement("button",{onClick:()=>pbsRunJob('prune',job.id),className:"px-2 py-1 rounded text-xs bg-yellow-500/20 text-yellow-400 hover:bg-yellow-500/30 transition-all flex items-center gap-1 ml-auto"},/*#__PURE__*/React.createElement(Icons.Play,{className:"w-3 h-3"})," Run"))))))):/*#__PURE__*/React.createElement("div",{className:"text-center py-6 text-gray-500 bg-proxmox-card border border-proxmox-border rounded-xl text-sm"},"No prune jobs configured")),pbsRemotes.length>0&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3"},"Remotes (",pbsRemotes.length,")"),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("table",{className:"w-full text-sm"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",{className:"border-b border-proxmox-border text-gray-500 text-xs"},/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Name"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Host"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Auth ID"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3"},"Fingerprint"))),/*#__PURE__*/React.createElement("tbody",null,pbsRemotes.map((remote,i)=>/*#__PURE__*/React.createElement("tr",{key:i,className:"border-b border-proxmox-border/50"},/*#__PURE__*/React.createElement("td",{className:"p-3 text-white font-medium"},remote.name),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-300"},remote.host||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400"},remote['auth-id']||remote.userid||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-500 font-mono text-xs truncate max-w-[200px]"},remote.fingerprint?remote.fingerprint.substring(0,23)+'...':'-')))))))),showPbsPrune&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-2xl shadow-2xl w-full max-w-md animate-scale-in"},/*#__PURE__*/React.createElement("div",{className:"p-6"},/*#__PURE__*/React.createElement("h2",{className:"text-xl font-bold text-white mb-1"},"Prune Datastore"),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mb-4"},showPbsPrune),/*#__PURE__*/React.createElement("div",{className:"space-y-3"},[{k:'keep_last',l:'Keep Last'},{k:'keep_daily',l:'Keep Daily'},{k:'keep_weekly',l:'Keep Weekly'},{k:'keep_monthly',l:'Keep Monthly'},{k:'keep_yearly',l:'Keep Yearly'}].map(f=>/*#__PURE__*/React.createElement("div",{key:f.k,className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-300"},f.l),/*#__PURE__*/React.createElement("input",{type:"number",min:"0",max:"365",value:pbsPruneForm[f.k]||'',onChange:e=>setPbsPruneForm(p=>({...p,[f.k]:parseInt(e.target.value)||0})),className:"w-20 bg-proxmox-dark border border-proxmox-border rounded px-2 py-1 text-sm text-white text-center"}))),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between pt-2"},/*#__PURE__*/React.createElement("label",{className:"text-sm text-gray-300"},"Dry Run (preview only)"),/*#__PURE__*/React.createElement("button",{onClick:()=>setPbsPruneForm(p=>({...p,dry_run:!p.dry_run})),className:`w-10 h-5 rounded-full transition-all ${pbsPruneForm.dry_run?'bg-blue-500':'bg-red-500'}`},/*#__PURE__*/React.createElement("div",{className:`w-4 h-4 bg-white rounded-full transition-transform ${pbsPruneForm.dry_run?'translate-x-5':'translate-x-0.5'}`}))),!pbsPruneForm.dry_run&&/*#__PURE__*/React.createElement("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-3 text-xs text-red-400"},"Warning: This will permanently delete backups that don't match the retention policy!")),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-2 mt-6"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowPbsPrune(null),className:"px-4 py-2 rounded-lg bg-proxmox-dark text-gray-400 hover:text-white transition-colors text-sm"},"Cancel"),/*#__PURE__*/React.createElement("button",{onClick:()=>{pbsAction('prune',showPbsPrune,pbsPruneForm);setShowPbsPrune(null);},className:`px-4 py-2 rounded-lg text-white text-sm font-medium ${pbsPruneForm.dry_run?'bg-blue-500 hover:bg-blue-600':'bg-red-500 hover:bg-red-600'}`},pbsPruneForm.dry_run?'Preview Prune':'Execute Prune')))))):selectedVMware?/*#__PURE__*//* VMware Server Management View */React.createElement("div",{className:isCorporate?'space-y-4':'space-y-6'},/*#__PURE__*/React.createElement("div",{className:`flex items-center justify-between ${isCorporate?'px-4 py-3 border-b':''}`,style:isCorporate?{borderColor:'#485764',background:'#22343c'}:{}},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},isCorporate?/*#__PURE__*/React.createElement(Icons.Cloud,{className:"w-5 h-5 flex-shrink-0",style:{color:'#49afd9'}}):/*#__PURE__*/React.createElement("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500/20 to-green-500/10 border border-emerald-500/30 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Cloud,{className:"w-6 h-6 text-emerald-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h1",{className:isCorporate?'text-[15px] font-medium':'text-2xl font-bold',style:{color:'#e9ecef'}},selectedVMware.name||selectedVMware.host),/*#__PURE__*/React.createElement("div",{className:`flex items-center gap-3 ${isCorporate?'text-[12px]':'text-sm'}`,style:{color:'#adbbc4'}},/*#__PURE__*/React.createElement("span",null,selectedVMware.host,":",selectedVMware.port||443),/*#__PURE__*/React.createElement("span",null,"\u2022"),/*#__PURE__*/React.createElement("span",null,vmwareVms.length," VMs"),/*#__PURE__*/React.createElement("span",null,"\u2022"),/*#__PURE__*/React.createElement("span",null,vmwareHosts.length," Hosts"),/*#__PURE__*/React.createElement("span",null,"\u2022"),/*#__PURE__*/React.createElement("span",null,vmwareDatastores.length," Datastores")))),/*#__PURE__*/React.createElement("div",{className:isCorporate?'corp-toolbar flex items-center gap-1':'flex items-center gap-2'},isAdmin&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("button",{onClick:()=>{setEditingVMware(selectedVMware);setVmwareForm({name:selectedVMware.name||'',host:selectedVMware.host,port:selectedVMware.port||443,username:selectedVMware.username||'root',password:'',ssl_verify:selectedVMware.ssl_verify||false,notes:selectedVMware.notes||''});setShowAddVMware(true);},className:isCorporate?'':'px-3 py-2 rounded-lg bg-proxmox-card border border-proxmox-border text-gray-400 hover:text-white text-sm'},/*#__PURE__*/React.createElement(Icons.Settings,{className:"w-4 h-4"})),/*#__PURE__*/React.createElement("button",{onClick:()=>handleDeleteVMware(selectedVMware.id),className:isCorporate?'':'px-3 py-2 rounded-lg bg-proxmox-card border border-proxmox-border text-red-400 hover:text-red-300 text-sm'},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-4 h-4"}))),/*#__PURE__*/React.createElement("button",{onClick:()=>fetchVMwareVms(selectedVMware.id),className:isCorporate?'':'px-3 py-2 rounded-lg bg-proxmox-card border border-proxmox-border text-gray-400 hover:text-white text-sm'},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:`w-4 h-4 ${vmwareLoading?'animate-spin':''}`})))),/*#__PURE__*/React.createElement("div",{className:isCorporate?'flex items-center border-b border-proxmox-border':'flex items-center gap-1 p-1 bg-proxmox-card border border-proxmox-border rounded-xl w-fit'},[{id:'vms',label:'Virtual Machines',icon:Icons.Monitor},{id:'hosts',label:'Hosts',icon:Icons.Server},{id:'datastores',label:'Datastores',icon:Icons.Database},{id:'networks',label:'Networks',icon:Icons.Globe},{id:'clusters',label:'Clusters',icon:Icons.Layers},{id:'tasks',label:'Tasks & Events',icon:Icons.ClipboardList}].map(tab=>/*#__PURE__*/React.createElement("button",{key:tab.id,onClick:()=>{setVmwareActiveTab(tab.id);setVmwareSelectedVm(null);setVmwareSelectedDs(null);},className:isCorporate?`flex items-center gap-1 px-3 py-1.5 text-[13px] border-b-2 -mb-px ${vmwareActiveTab===tab.id?'border-blue-500 text-white font-medium':'border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-600'}`:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${vmwareActiveTab===tab.id?'bg-emerald-500 text-white':'text-gray-400 hover:text-white hover:bg-proxmox-hover'}`},/*#__PURE__*/React.createElement(tab.icon,{className:isCorporate?'w-3 h-3':'w-4 h-4'}),tab.label))),!vmwareConnectionOk&&/*#__PURE__*/React.createElement("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-3 flex items-center gap-3"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-5 h-5 text-yellow-400 flex-shrink-0"}),/*#__PURE__*/React.createElement("div",{className:"flex-1"},/*#__PURE__*/React.createElement("span",{className:"text-yellow-300 text-sm font-medium"},"Connection lost"),/*#__PURE__*/React.createElement("span",{className:"text-yellow-400/70 text-sm ml-2"},"Session expired - data may be stale")),/*#__PURE__*/React.createElement("button",{onClick:()=>{fetchVMwareVms(selectedVMware.id);fetchVMwareHosts(selectedVMware.id);fetchVMwareDatastores(selectedVMware.id);},className:"px-3 py-1.5 bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-300 rounded-lg text-xs font-medium"},"Reconnect")),vmwareActiveTab==='vms'&&!vmwareSelectedVm&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"flex-1 relative"},/*#__PURE__*/React.createElement(Icons.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4",style:{color:'#728b9a'}}),/*#__PURE__*/React.createElement("input",{value:vmwareSearch,onChange:e=>setVmwareSearch(e.target.value),placeholder:"Search VMs...",className:isCorporate?'w-full pl-10 pr-4 py-2 text-[13px] text-white placeholder-gray-500 focus:outline-none':'w-full pl-10 pr-4 py-2.5 bg-proxmox-card border border-proxmox-border rounded-xl text-white placeholder-gray-500 focus:outline-none focus:border-emerald-500/50 text-sm',style:isCorporate?{background:'#22343c',border:'1px solid #485764',borderRadius:'2px'}:{}})),/*#__PURE__*/React.createElement("div",{className:isCorporate?'flex items-center gap-0':'flex items-center gap-1 p-1 bg-proxmox-card border border-proxmox-border rounded-xl',style:isCorporate?{border:'1px solid #485764',borderRadius:'2px'}:{}},['all','running','stopped'].map(f=>/*#__PURE__*/React.createElement("button",{key:f,onClick:()=>setVmwareFilter(f),className:isCorporate?`px-3 py-1.5 text-[12px] font-medium ${vmwareFilter===f?'text-white':'hover:text-white'}`:`px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${vmwareFilter===f?'bg-emerald-500/20 text-emerald-400':'text-gray-500 hover:text-white'}`,style:isCorporate?{color:vmwareFilter===f?'#e9ecef':'#728b9a',background:vmwareFilter===f?'#324f61':'transparent',borderRight:'1px solid #485764'}:{}},f==='all'?`All (${vmwareVms.length})`:f==='running'?`Running (${vmwareVms.filter(v=>v.power_state==='POWERED_ON').length})`:`Stopped (${vmwareVms.filter(v=>v.power_state!=='POWERED_ON').length})`)))),vmwareLoading&&vmwareVms.length===0?/*#__PURE__*/React.createElement("div",{className:"text-center py-12 text-gray-500"},"Loading VMs..."):/*#__PURE__*/React.createElement("div",{className:isCorporate?'overflow-hidden':'bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden'},/*#__PURE__*/React.createElement("table",{className:isCorporate?'corp-datagrid':'w-full'},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",{className:isCorporate?'':'border-b border-proxmox-border'},/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3 text-xs font-semibold text-gray-500 uppercase'},"Status"),/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3 text-xs font-semibold text-gray-500 uppercase'},"Name"),/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3 text-xs font-semibold text-gray-500 uppercase'},"Guest OS"),/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3 text-xs font-semibold text-gray-500 uppercase'},"CPUs"),/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3 text-xs font-semibold text-gray-500 uppercase'},"Memory"),/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3 text-xs font-semibold text-gray-500 uppercase'},"IP Address"),/*#__PURE__*/React.createElement("th",{className:isCorporate?'':'text-left p-3 text-xs font-semibold text-gray-500 uppercase'},"Host"),/*#__PURE__*/React.createElement("th",{className:isCorporate?'text-right':'text-right p-3 text-xs font-semibold text-gray-500 uppercase'},"Actions"))),/*#__PURE__*/React.createElement("tbody",null,vmwareVms.filter(vm=>{if(vmwareFilter==='running')return vm.power_state==='POWERED_ON';if(vmwareFilter==='stopped')return vm.power_state!=='POWERED_ON';return true;}).filter(vm=>!vmwareSearch||(vm.name||'').toLowerCase().includes(vmwareSearch.toLowerCase())||(vm.guest_os||'').toLowerCase().includes(vmwareSearch.toLowerCase())).sort((a,b)=>{if(vmwareSortBy==='status')return(a.power_state||'').localeCompare(b.power_state||'');return(a.name||'').localeCompare(b.name||'');}).map(vm=>{const isOn=vm.power_state==='POWERED_ON';const isSuspended=vm.power_state==='SUSPENDED';const memGB=vm.memory_size_MiB?(vm.memory_size_MiB/1024).toFixed(1):vm.memory_mb?(vm.memory_mb/1024).toFixed(1):'-';const ip=vm.guest_info?.ip_address||vm.ip_address||vm.guest_ip||'-';const actionLoading=vmwareActionLoading[vm.vm||vm.vm_id||vm.id];return/*#__PURE__*/React.createElement("tr",{key:vm.vm||vm.vm_id||vm.id,className:"border-b border-proxmox-border/50 hover:bg-proxmox-hover/50 cursor-pointer transition-colors",onClick:()=>setVmwareSelectedVm(vm.vm||vm.vm_id||vm.id)},/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("div",{className:`w-3 h-3 rounded-full ${isOn?'bg-green-400 shadow-lg shadow-green-400/30':isSuspended?'bg-yellow-400':'bg-gray-500'}`,title:vm.power_state})),/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("div",{className:"font-medium text-white text-sm"},vm.name)),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400 text-sm"},(vm.guest_OS||vm.guest_os||'-').replace('Guest','').replace('_',' ').substring(0,25)),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400 text-sm"},vm.cpu_count||vm.num_cpu||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400 text-sm"},memGB," GB"),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400 text-sm font-mono text-xs"},ip),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400 text-sm"},(vm.host||vm.host_name||'-').split('.')[0]),/*#__PURE__*/React.createElement("td",{className:"p-3 text-right",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-end gap-1"},!isOn?/*#__PURE__*/React.createElement("button",{onClick:()=>vmwarePowerAction(vm.vm||vm.vm_id||vm.id,'start'),disabled:!!actionLoading,className:"p-1.5 rounded-lg text-green-400 hover:bg-green-500/10 disabled:opacity-50",title:"Start"},actionLoading==='start'?/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-4 h-4 animate-spin"}):/*#__PURE__*/React.createElement(Icons.Play,{className:"w-4 h-4"})):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("button",{onClick:()=>vmwarePowerAction(vm.vm||vm.vm_id||vm.id,'stop'),disabled:!!actionLoading,className:"p-1.5 rounded-lg text-red-400 hover:bg-red-500/10 disabled:opacity-50",title:"Shutdown"},actionLoading==='stop'?/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-4 h-4 animate-spin"}):/*#__PURE__*/React.createElement(Icons.Square,{className:"w-4 h-4"})),/*#__PURE__*/React.createElement("button",{onClick:()=>vmwarePowerAction(vm.vm||vm.vm_id||vm.id,'reset'),disabled:!!actionLoading,className:"p-1.5 rounded-lg text-yellow-400 hover:bg-yellow-500/10 disabled:opacity-50",title:"Reset"},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-4 h-4"})),/*#__PURE__*/React.createElement("button",{onClick:()=>vmwarePowerAction(vm.vm||vm.vm_id||vm.id,'suspend'),disabled:!!actionLoading,className:"p-1.5 rounded-lg text-blue-400 hover:bg-blue-500/10 disabled:opacity-50",title:"Suspend"},/*#__PURE__*/React.createElement(Icons.Pause,{className:"w-4 h-4"}))))));}))),vmwareVms.length===0&&!vmwareLoading&&/*#__PURE__*/React.createElement("div",{className:"text-center py-12 text-gray-500"},"No virtual machines found"))),vmwareActiveTab==='vms'&&vmwareSelectedVm&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setVmwareSelectedVm(null);setVmwareVmTab('overview');},className:"flex items-center gap-2 text-gray-400 hover:text-white text-sm"},/*#__PURE__*/React.createElement("span",{style:{display:"inline-block",transform:"rotate(180deg)"}},/*#__PURE__*/React.createElement(Icons.ChevronRight,{className:"w-4 h-4"}))," Back to VM List"),vmwareVmDetail?(()=>{const vm=vmwareVmDetail;const isOn=vm.power_state==='POWERED_ON';const isSuspended=vm.power_state==='SUSPENDED';const memMiB=vm.memory?.size_MiB||vm.memory_size_MiB||vm.memory_mb||0;const memGB=memMiB?(memMiB/1024).toFixed(1):'-';const cpuCount=vm.cpu?.count||vm.cpu_count||vm.num_cpu||0;const guestOS=vm.guest_OS||vm.guest_os||'-';const toolsStatus=vm.guest_info?.tools_status||vm.vmware_tools_status||'';const ipAddr=vm.guest_info?.ip_address||vm.ip_address||vm.guest_ip||'';const hostName=vm.guest_info?.host_name||vm.hostname||'';const hwVersion=vm.hardware?.version||'';const disksList=vm.disks?Array.isArray(vm.disks)?vm.disks:Object.values(vm.disks):[];const netsList=vm.networks?Array.isArray(vm.networks)?vm.networks:Object.values(vm.networks):[];const snapsList=vm.snapshots&&Array.isArray(vm.snapshots)?vm.snapshots:[];const totalDiskGB=disksList.reduce((sum,d)=>sum+(d.capacity?d.capacity/(1024*1024*1024):d.capacity_gb||0),0);return/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-5"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("div",{className:`w-14 h-14 rounded-xl flex items-center justify-center ${isOn?'bg-green-500/10 border border-green-500/30':isSuspended?'bg-yellow-500/10 border border-yellow-500/30':'bg-gray-500/10 border border-gray-500/30'}`},/*#__PURE__*/React.createElement(Icons.Monitor,{className:`w-7 h-7 ${isOn?'text-green-400':isSuspended?'text-yellow-400':'text-gray-500'}`})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("h2",{className:"text-xl font-bold text-white"},vm.name),/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs font-semibold ${isOn?'bg-green-500/20 text-green-400':isSuspended?'bg-yellow-500/20 text-yellow-400':'bg-gray-500/20 text-gray-400'}`},isOn?'ON':isSuspended?'SUSPENDED':'OFF'),hwVersion&&/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-600"},hwVersion)),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4 text-xs text-gray-500 mt-1"},/*#__PURE__*/React.createElement("span",null,guestOS),cpuCount>0&&/*#__PURE__*/React.createElement("span",null,cpuCount," vCPU"),memGB!=='-'&&/*#__PURE__*/React.createElement("span",null,memGB," GB RAM"),totalDiskGB>0&&/*#__PURE__*/React.createElement("span",null,totalDiskGB.toFixed(0)," GB Disk"),toolsStatus&&/*#__PURE__*/React.createElement("span",{className:toolsStatus.includes('Not')?'text-yellow-500':'text-gray-500'},"Tools: ",toolsStatus.replace('toolsStatus','').replace('tools',''))))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},!isOn?/*#__PURE__*/React.createElement("button",{onClick:()=>vmwarePowerAction(vmwareSelectedVm,'start'),className:"px-4 py-2 rounded-lg bg-green-500/20 text-green-400 hover:bg-green-500/30 text-sm font-medium flex items-center gap-1.5"},/*#__PURE__*/React.createElement(Icons.Play,{className:"w-4 h-4"})," Start"):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("button",{onClick:()=>vmwarePowerAction(vmwareSelectedVm,'stop'),className:"px-3 py-2 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30 text-sm font-medium flex items-center gap-1.5"},/*#__PURE__*/React.createElement(Icons.Square,{className:"w-3.5 h-3.5"})," Stop"),/*#__PURE__*/React.createElement("button",{onClick:()=>vmwarePowerAction(vmwareSelectedVm,'reset'),className:"p-2 rounded-lg bg-yellow-500/10 text-yellow-400 hover:bg-yellow-500/20",title:"Reset"},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-4 h-4"})),/*#__PURE__*/React.createElement("button",{onClick:()=>vmwarePowerAction(vmwareSelectedVm,'suspend'),className:"p-2 rounded-lg bg-blue-500/10 text-blue-400 hover:bg-blue-500/20",title:"Suspend"},/*#__PURE__*/React.createElement(Icons.Pause,{className:"w-4 h-4"}))),/*#__PURE__*/React.createElement("div",{className:"w-px h-8 bg-proxmox-border mx-1"}),isOn&&/*#__PURE__*/React.createElement("button",{onClick:()=>openVmwareConsole(vmwareSelectedVm),className:"p-2 rounded-lg bg-purple-500/10 text-purple-400 hover:bg-purple-500/20",title:"Console (VMRC)"},/*#__PURE__*/React.createElement(Icons.Terminal,{className:"w-4 h-4"})),/*#__PURE__*/React.createElement("div",{className:"relative group"},/*#__PURE__*/React.createElement("button",{className:"p-2 rounded-lg bg-proxmox-dark border border-proxmox-border text-gray-400 hover:text-white"},/*#__PURE__*/React.createElement(Icons.Settings,{className:"w-4 h-4"})),/*#__PURE__*/React.createElement("div",{className:"absolute right-0 top-full mt-1 w-48 bg-proxmox-card border border-proxmox-border rounded-xl shadow-xl z-50 hidden group-hover:block"},/*#__PURE__*/React.createElement("div",{className:"py-1"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setVmwareRenameName(vm.name||'');setShowVmwareRename(true);},className:"w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-proxmox-hover flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Edit,{className:"w-3.5 h-3.5"})," Rename"),/*#__PURE__*/React.createElement("button",{onClick:()=>{setVmwareCloneName(`${vm.name}-clone`);setShowVmwareClone(true);},className:"w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-proxmox-hover flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Copy,{className:"w-3.5 h-3.5"})," Clone"),/*#__PURE__*/React.createElement("button",{onClick:()=>{fetchMigrationPlan(vmwareSelectedVm);},className:"w-full text-left px-4 py-2 text-sm text-emerald-400 hover:bg-proxmox-hover flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.FolderInput,{className:"w-3.5 h-3.5"})," Migrate to Proxmox"),/*#__PURE__*/React.createElement("div",{className:"border-t border-proxmox-border my-1"}),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowVmwareDelete(true),disabled:isOn,className:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-proxmox-hover flex items-center gap-2 disabled:opacity-30 disabled:cursor-not-allowed"},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-3.5 h-3.5"})," Delete VM ",isOn?'(stop first)':''))))))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-1 border-b border-proxmox-border"},[{id:'overview',label:'Overview'},{id:'settings',label:'Settings'},{id:'config',label:'Hardware'},{id:'snapshots',label:`Snapshots (${snapsList.length})`},{id:'migrate',label:'Migration'}].map(tab=>/*#__PURE__*/React.createElement("button",{key:tab.id,onClick:()=>setVmwareVmTab(tab.id),className:`px-4 py-2.5 text-sm font-medium border-b-2 transition-all ${vmwareVmTab===tab.id?'border-emerald-400 text-emerald-400':'border-transparent text-gray-500 hover:text-gray-300'}`},tab.label))),vmwareVmTab==='overview'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 xl:grid-cols-4 gap-3"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-2"},/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 uppercase font-semibold"},"CPU"),/*#__PURE__*/React.createElement(Icons.Cpu,{className:"w-4 h-4 text-blue-400"})),/*#__PURE__*/React.createElement("div",{className:"text-2xl font-bold text-white"},cpuCount),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"vCPUs")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-2"},/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 uppercase font-semibold"},"Memory"),/*#__PURE__*/React.createElement(Icons.Memory,{className:"w-4 h-4 text-purple-400"})),/*#__PURE__*/React.createElement("div",{className:"text-2xl font-bold text-white"},memGB),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"GB RAM")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-2"},/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 uppercase font-semibold"},"Storage"),/*#__PURE__*/React.createElement(Icons.HardDrive,{className:"w-4 h-4 text-emerald-400"})),/*#__PURE__*/React.createElement("div",{className:"text-2xl font-bold text-white"},totalDiskGB>0?totalDiskGB.toFixed(0):'-'),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"GB (",disksList.length," disks)")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-2"},/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 uppercase font-semibold"},"Network"),/*#__PURE__*/React.createElement(Icons.Globe,{className:"w-4 h-4 text-cyan-400"})),/*#__PURE__*/React.createElement("div",{className:"text-lg font-mono font-bold text-white"},ipAddr||'-'),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},hostName||`${netsList.length} adapters`))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase mb-3"},"VM Information"),/*#__PURE__*/React.createElement("div",{className:"space-y-2 text-sm"},[['VM ID',vm.vm||vmwareSelectedVm],['Guest OS',guestOS],['Hardware Version',hwVersion||'-'],['Guest Tools',toolsStatus||'Not installed'],['Power State',vm.power_state||'-'],['IP Address',ipAddr||'N/A'],['Hostname',hostName||'N/A']].map(([label,value])=>/*#__PURE__*/React.createElement("div",{key:label,className:"flex justify-between"},/*#__PURE__*/React.createElement("span",{className:"text-gray-500"},label),/*#__PURE__*/React.createElement("span",{className:"text-white font-mono text-xs"},value))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase mb-3"},"Disks"),disksList.length>0?/*#__PURE__*/React.createElement("div",{className:"space-y-2"},disksList.map((disk,idx)=>{const capGB=disk.capacity?(disk.capacity/(1024*1024*1024)).toFixed(1):disk.capacity_gb||'?';return/*#__PURE__*/React.createElement("div",{key:idx,className:"flex items-center justify-between p-2.5 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.HardDrive,{className:"w-4 h-4 text-gray-500"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-sm text-white"},disk.label||`Disk ${idx}`),disk.backing?.thin_provisioned&&/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-600"},"Thin provisioned"))),/*#__PURE__*/React.createElement("div",{className:"text-right"},/*#__PURE__*/React.createElement("div",{className:"text-sm text-white font-medium"},capGB," GB"),disk.backing?.datastore&&/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-600"},disk.backing.datastore)));})):/*#__PURE__*/React.createElement("div",{className:"text-gray-600 text-sm"},"No disks found"))),netsList.length>0&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase mb-3"},"Network Adapters"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2"},netsList.map((nic,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"flex items-center justify-between p-2.5 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Globe,{className:"w-4 h-4 text-gray-500"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-white"},nic.label||nic.name||`NIC ${idx}`)),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-400 font-mono"},nic.mac_address||'-')))))),vmwareVmTab==='settings'&&(()=>{// Initialize edit form from VM detail
const initCpu=vmwareConfigEdit.cpu||cpuCount||1;const initMem=vmwareConfigEdit.memory||memGB*1024||2048;const initNotes=vmwareConfigEdit.notes!==undefined&&vmwareConfigEdit.notes!==''?vmwareConfigEdit.notes:vm.annotation||vm.notes||vm.config?.annotation||'';const perfData=vm.performance||{};return/*#__PURE__*/React.createElement("div",{className:"space-y-4"},isOn&&/*#__PURE__*/React.createElement("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-xl p-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-yellow-400 text-sm"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"w-4 h-4"}),/*#__PURE__*/React.createElement("span",null,"VM is powered on - some changes (CPU, Memory) may require the VM to be powered off or need hot-add enabled."))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Cpu,{className:"w-4 h-4"})," Compute Resources"),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-500 mb-1.5"},"vCPUs"),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("input",{type:"number",min:"1",max:"128",value:vmwareConfigEdit.cpu||cpuCount||'',onChange:e=>setVmwareConfigEdit(p=>({...p,cpu:e.target.value})),className:"flex-1 bg-proxmox-dark border border-proxmox-border rounded-lg px-3 py-2 text-white text-sm"}),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 w-16"},"cores"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-500 mb-1.5"},"Memory (MB)"),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("input",{type:"number",min:"256",step:"256",value:vmwareConfigEdit.memory||memGB*1024||'',onChange:e=>setVmwareConfigEdit(p=>({...p,memory:e.target.value})),className:"flex-1 bg-proxmox-dark border border-proxmox-border rounded-lg px-3 py-2 text-white text-sm"}),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 w-16"},"MB")),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 mt-1"},[1024,2048,4096,8192,16384].map(v=>/*#__PURE__*/React.createElement("button",{key:v,onClick:()=>setVmwareConfigEdit(p=>({...p,memory:String(v)})),className:`px-2 py-0.5 rounded text-xs ${parseInt(vmwareConfigEdit.memory||memGB*1024)===v?'bg-emerald-500/20 text-emerald-400':'bg-proxmox-dark text-gray-500 hover:text-white'}`},v>=1024?`${v/1024}G`:`${v}M`)))),/*#__PURE__*/React.createElement("div",{className:"pt-2 border-t border-proxmox-border/50 space-y-2"},/*#__PURE__*/React.createElement("label",{className:"flex items-center justify-between cursor-pointer"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-400"},"CPU Hot-Add"),/*#__PURE__*/React.createElement("div",{onClick:()=>setVmwareConfigEdit(p=>({...p,cpu_hot_add:!p.cpu_hot_add})),className:`w-10 h-5 rounded-full transition-colors cursor-pointer flex items-center ${vmwareConfigEdit.cpu_hot_add?'bg-emerald-500':'bg-gray-700'}`},/*#__PURE__*/React.createElement("div",{className:`w-4 h-4 rounded-full bg-white shadow transition-transform ${vmwareConfigEdit.cpu_hot_add?'translate-x-5':'translate-x-0.5'}`}))),/*#__PURE__*/React.createElement("label",{className:"flex items-center justify-between cursor-pointer"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-400"},"Memory Hot-Add"),/*#__PURE__*/React.createElement("div",{onClick:()=>setVmwareConfigEdit(p=>({...p,memory_hot_add:!p.memory_hot_add})),className:`w-10 h-5 rounded-full transition-colors cursor-pointer flex items-center ${vmwareConfigEdit.memory_hot_add?'bg-emerald-500':'bg-gray-700'}`},/*#__PURE__*/React.createElement("div",{className:`w-4 h-4 rounded-full bg-white shadow transition-transform ${vmwareConfigEdit.memory_hot_add?'translate-x-5':'translate-x-0.5'}`})))))),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.FileText,{className:"w-4 h-4"})," Notes"),/*#__PURE__*/React.createElement("textarea",{value:vmwareConfigEdit.notes!==undefined&&vmwareConfigEdit.notes!==''?vmwareConfigEdit.notes:vm.annotation||vm.notes||vm.config?.annotation||'',onChange:e=>setVmwareConfigEdit(p=>({...p,notes:e.target.value})),placeholder:"VM description / notes...",rows:4,className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg px-3 py-2 text-white text-sm resize-none"})),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Play,{className:"w-4 h-4"})," Boot Order"),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},[{key:'disk',label:'Hard Disk',icon:'ðŸ’¾'},{key:'cdrom',label:'CD-ROM',icon:'ðŸ’¿'},{key:'net',label:'Network (PXE)',icon:'ðŸŒ'}].map((item,idx)=>/*#__PURE__*/React.createElement("div",{key:item.key,className:"flex items-center gap-3 p-2.5 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 w-5"},idx+1,"."),/*#__PURE__*/React.createElement("span",null,item.icon),/*#__PURE__*/React.createElement("span",{className:"text-sm text-white flex-1"},item.label))),/*#__PURE__*/React.createElement("button",{onClick:()=>handleVmwareBootOrderSave(vmwareSelectedVm,['disk','cdrom','net']),className:"text-xs text-gray-500 hover:text-emerald-400 transition-colors"},"Reset to default (Disk \u2192 CD \u2192 Network)"))),netsList.length>0&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase mb-4 flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Globe,{className:"w-4 h-4"})," Network Adapters"),/*#__PURE__*/React.createElement("div",{className:"space-y-3"},netsList.map((nic,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"p-3 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-2"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-white font-medium"},nic.label||`NIC ${idx+1}`),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 font-mono"},nic.mac_address||'')),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("select",{value:nic.network||nic.backing?.network_name||'',onChange:e=>handleVmwareNetworkChange(vmwareSelectedVm,nic.key||0,e.target.value),className:"flex-1 bg-proxmox-card border border-proxmox-border rounded px-2 py-1.5 text-sm text-gray-300"},/*#__PURE__*/React.createElement("option",{value:nic.network||nic.backing?.network_name||''},nic.network||nic.backing?.network_name||'Current Network'),vmwareNetworks.filter(n=>n.name!==(nic.network||nic.backing?.network_name)).map(n=>/*#__PURE__*/React.createElement("option",{key:n.network||n.name,value:n.name},n.name)))))))))),perfData.cpu_usage_mhz!==undefined&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase mb-3"},"Live Performance"),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-3 text-center"},/*#__PURE__*/React.createElement("div",{className:"text-lg font-bold text-blue-400"},perfData.cpu_usage_mhz||0," MHz"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"CPU Usage")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-3 text-center"},/*#__PURE__*/React.createElement("div",{className:"text-lg font-bold text-purple-400"},perfData.memory_usage_mb||0," MB"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"Memory Used")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-3 text-center"},/*#__PURE__*/React.createElement("div",{className:"text-lg font-bold text-emerald-400"},perfData.disk_committed?(perfData.disk_committed/1024**3).toFixed(1):'0'," GB"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"Disk Used")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-3 text-center"},/*#__PURE__*/React.createElement("div",{className:"text-lg font-bold text-cyan-400"},perfData.uptime_seconds?Math.floor(perfData.uptime_seconds/3600)+'h':'0h'),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"Uptime")))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3"},/*#__PURE__*/React.createElement("button",{onClick:()=>setVmwareConfigEdit({cpu:'',memory:'',notes:'',cpu_hot_add:false,memory_hot_add:false}),className:"px-4 py-2 rounded-lg bg-proxmox-card border border-proxmox-border text-gray-400 hover:text-white text-sm"},"Reset"),/*#__PURE__*/React.createElement("button",{onClick:()=>handleVmwareConfigSave(vmwareSelectedVm),disabled:vmwareConfigSaving,className:"px-6 py-2 rounded-lg bg-emerald-500 hover:bg-emerald-600 text-white text-sm font-medium disabled:opacity-50 flex items-center gap-2"},vmwareConfigSaving?/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-4 h-4 animate-spin"}):/*#__PURE__*/React.createElement(Icons.Check,{className:"w-4 h-4"}),"Save Changes")));})(),vmwareVmTab==='config'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-xl p-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 text-blue-400 text-sm"},/*#__PURE__*/React.createElement(Icons.Info,{className:"w-4 h-4"}),/*#__PURE__*/React.createElement("span",null,"Hardware overview (read-only). Use the Settings tab to change CPU, Memory, and Network."))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase mb-4"},"Current Configuration"),/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between p-3 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"w-8 h-8 rounded-lg bg-blue-500/10 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Cpu,{className:"w-4 h-4 text-blue-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-sm text-white font-medium"},"CPU"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"Virtual CPUs"))),/*#__PURE__*/React.createElement("div",{className:"text-lg font-bold text-white"},cpuCount)),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between p-3 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"w-8 h-8 rounded-lg bg-purple-500/10 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Memory,{className:"w-4 h-4 text-purple-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-sm text-white font-medium"},"Memory"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"RAM allocation"))),/*#__PURE__*/React.createElement("div",{className:"text-lg font-bold text-white"},memGB," GB")),disksList.map((disk,idx)=>{const capGB=disk.capacity?(disk.capacity/(1024*1024*1024)).toFixed(1):disk.capacity_gb||'?';return/*#__PURE__*/React.createElement("div",{key:idx,className:"flex items-center justify-between p-3 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"w-8 h-8 rounded-lg bg-emerald-500/10 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.HardDrive,{className:"w-4 h-4 text-emerald-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-sm text-white font-medium"},disk.label||`Disk ${idx}`),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},disk.backing?.thin_provisioned?'Thin':'Thick'," - ",disk.backing?.datastore||''))),/*#__PURE__*/React.createElement("div",{className:"text-lg font-bold text-white"},capGB," GB"));}),netsList.map((nic,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"flex items-center justify-between p-3 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"w-8 h-8 rounded-lg bg-cyan-500/10 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Globe,{className:"w-4 h-4 text-cyan-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-sm text-white font-medium"},nic.label||nic.name||`NIC ${idx}`),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 font-mono"},nic.mac_address||''))),/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-400"},nic.network||nic.name||''))))),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},vm.hardware&&(vm.hardware.firmware||vm.hardware.scsi_controller)&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase mb-4"},"Hardware Details"),/*#__PURE__*/React.createElement("div",{className:"space-y-2 text-sm"},/*#__PURE__*/React.createElement("div",{className:"flex justify-between p-2 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"Firmware"),/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},(vm.hardware.firmware||'BIOS').toUpperCase())),/*#__PURE__*/React.createElement("div",{className:"flex justify-between p-2 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"SCSI Controller"),/*#__PURE__*/React.createElement("div",{className:"text-right"},/*#__PURE__*/React.createElement("div",{className:"text-white font-medium"},vm.hardware.scsi_controller||'N/A'),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"\u2192 Proxmox: ",vm.hardware.scsi_controller_pve||'auto'))),/*#__PURE__*/React.createElement("div",{className:"flex justify-between p-2 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"Network Adapter"),/*#__PURE__*/React.createElement("div",{className:"text-right"},/*#__PURE__*/React.createElement("div",{className:"text-white font-medium"},vm.hardware.nic_type||'N/A'),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"\u2192 Proxmox: ",vm.hardware.nic_type_pve||'auto'))),/*#__PURE__*/React.createElement("div",{className:"flex justify-between p-2 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"Disk Bus"),/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},(vm.hardware.disk_bus||'SCSI').toUpperCase())),vm.hardware.version&&/*#__PURE__*/React.createElement("div",{className:"flex justify-between p-2 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},"HW Version"),/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},vm.hardware.version)))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase mb-4"},"Quick Actions"),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setVmwareRenameName(vm.name||'');setShowVmwareRename(true);},className:"w-full flex items-center gap-3 p-3 bg-proxmox-dark rounded-lg hover:bg-proxmox-hover transition-colors text-left"},/*#__PURE__*/React.createElement(Icons.Edit,{className:"w-5 h-5 text-blue-400"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-sm text-white"},"Rename VM"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"Change the display name"))),/*#__PURE__*/React.createElement("button",{onClick:()=>{setVmwareCloneName(`${vm.name}-clone`);setShowVmwareClone(true);},className:"w-full flex items-center gap-3 p-3 bg-proxmox-dark rounded-lg hover:bg-proxmox-hover transition-colors text-left"},/*#__PURE__*/React.createElement(Icons.Copy,{className:"w-5 h-5 text-green-400"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-sm text-white"},"Clone VM"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"Create an identical copy"))),/*#__PURE__*/React.createElement("button",{onClick:()=>fetchMigrationPlan(vmwareSelectedVm),disabled:vmwareMigrateLoading,className:"w-full flex items-center gap-3 p-3 bg-proxmox-dark rounded-lg hover:bg-proxmox-hover transition-colors text-left"},/*#__PURE__*/React.createElement(Icons.FolderInput,{className:"w-5 h-5 text-emerald-400"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-sm text-white"},"Migrate to Proxmox"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"Near-zero downtime V2P migration"))),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowVmwareDelete(true),disabled:isOn,className:"w-full flex items-center gap-3 p-3 bg-proxmox-dark rounded-lg hover:bg-red-500/5 transition-colors text-left disabled:opacity-40"},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-5 h-5 text-red-400"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-sm text-red-400"},"Delete VM"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},isOn?'Power off first to delete':'Permanently remove this VM')))))))),vmwareVmTab==='snapshots'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400"},"Snapshots (",snapsList.length,")"),/*#__PURE__*/React.createElement("button",{onClick:async()=>{const name=prompt('Snapshot name:');if(name){await vmwareSnapshotAction(vmwareSelectedVm,'create',{name,description:''});fetchVMwareVmDetail(selectedVMware.id,vmwareSelectedVm);}},className:"px-3 py-1.5 rounded-lg bg-emerald-500/20 text-emerald-400 hover:bg-emerald-500/30 text-sm font-medium"},"+ Create Snapshot")),snapsList.length>0?/*#__PURE__*/React.createElement("div",{className:"space-y-2"},snapsList.map((snap,idx)=>/*#__PURE__*/React.createElement("div",{key:idx,className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4 flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"w-8 h-8 rounded-lg bg-blue-500/10 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Camera,{className:"w-4 h-4 text-blue-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-sm font-medium text-white"},snap.name),snap.description&&/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},snap.description),snap.created&&/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-600"},new Date(snap.created).toLocaleString()))),/*#__PURE__*/React.createElement("button",{onClick:()=>vmwareSnapshotAction(vmwareSelectedVm,'delete',{snapshot_id:snap.id||snap.snapshot}),className:"p-2 text-red-400 hover:bg-red-500/10 rounded-lg",title:"Delete snapshot"},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-4 h-4"}))))):/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-8 text-center text-gray-500"},/*#__PURE__*/React.createElement(Icons.Camera,{className:"w-8 h-8 mx-auto mb-2 opacity-30"}),/*#__PURE__*/React.createElement("div",{className:"text-sm"},"No snapshots. Create one to save the current VM state."))),vmwareVmTab==='migrate'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-5"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3 mb-4"},/*#__PURE__*/React.createElement("div",{className:"w-10 h-10 rounded-xl bg-emerald-500/10 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.FolderInput,{className:"w-5 h-5 text-emerald-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-white font-semibold"},"Migrate to Proxmox VE"),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},"Near-zero downtime ESXi to Proxmox migration using block-level delta sync"))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-3 mb-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-3 text-center"},/*#__PURE__*/React.createElement("div",{className:"text-lg font-bold text-white"},totalDiskGB.toFixed(0)," GB"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"Total Disk")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-3 text-center"},/*#__PURE__*/React.createElement("div",{className:"text-lg font-bold text-emerald-400"},"~",Math.max(2,Math.round(totalDiskGB*0.08))," min"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"Est. Downtime")),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-3 text-center"},/*#__PURE__*/React.createElement("div",{className:"text-lg font-bold text-white"},disksList.length),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"Disks to Transfer"))),/*#__PURE__*/React.createElement("div",{className:"space-y-2 mb-4 text-xs text-gray-500"},/*#__PURE__*/React.createElement("div",{className:"font-semibold text-gray-400 mb-1"},"How it works:"),/*#__PURE__*/React.createElement("div",null,"1. Pre-sync: Full disk copy via HTTPS while VM runs (no downtime)"),/*#__PURE__*/React.createElement("div",null,"2. Pre-compute: Proxmox block checksums while VM still runs"),/*#__PURE__*/React.createElement("div",null,"3. Stop VM: Brief downtime starts, VMDKs unlock"),/*#__PURE__*/React.createElement("div",null,"4. Delta sync: Only changed blocks transferred via SSH (fast!)"),/*#__PURE__*/React.createElement("div",null,"5. Start on Proxmox: VM boots, downtime ends")),/*#__PURE__*/React.createElement("button",{onClick:()=>fetchMigrationPlan(vmwareSelectedVm),disabled:vmwareMigrateLoading,className:"w-full py-2.5 rounded-lg bg-emerald-500 text-white font-medium hover:bg-emerald-600 disabled:opacity-50 text-sm"},vmwareMigrateLoading?'Loading Migration Plan...':'Start Migration Wizard')),vmwareMigrations.length>0&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase mb-3"},"Active Migrations"),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},vmwareMigrations.map(m=>/*#__PURE__*/React.createElement("div",{key:m.id,className:"p-3 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-2"},/*#__PURE__*/React.createElement("span",{className:"text-sm text-white font-medium"},m.vm_name||m.id),/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${m.status==='completed'?'bg-green-500/20 text-green-400':m.status==='failed'?'bg-red-500/20 text-red-400':m.status==='running'?'bg-blue-500/20 text-blue-400':'bg-gray-500/20 text-gray-400'}`},m.status)),m.progress!==undefined&&/*#__PURE__*/React.createElement("div",{className:"w-full h-1.5 bg-proxmox-dark rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"h-full bg-emerald-400 rounded-full transition-all",style:{width:`${m.progress}%`}})),m.current_step&&/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mt-1"},m.current_step)))))));})():/*#__PURE__*/React.createElement("div",{className:"text-center py-12 text-gray-500"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-6 h-6 mx-auto mb-2 animate-spin opacity-30"}),"Loading VM details..."),showVmwareClone&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",onClick:()=>setShowVmwareClone(false)},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-2xl p-6 w-full max-w-md",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-bold text-white mb-4"},"Clone VM"),/*#__PURE__*/React.createElement("input",{value:vmwareCloneName,onChange:e=>setVmwareCloneName(e.target.value),placeholder:"Clone name...",className:"w-full px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-xl text-white mb-4 focus:outline-none focus:border-emerald-500/50"}),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowVmwareClone(false),className:"px-4 py-2 rounded-lg bg-proxmox-dark text-gray-400 text-sm"},"Cancel"),/*#__PURE__*/React.createElement("button",{onClick:()=>handleVmwareClone(vmwareSelectedVm,vmwareCloneName),disabled:!vmwareCloneName.trim(),className:"px-4 py-2 rounded-lg bg-emerald-500 text-white text-sm font-medium disabled:opacity-50"},"Clone")))),showVmwareRename&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",onClick:()=>setShowVmwareRename(false)},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-2xl p-6 w-full max-w-md",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-bold text-white mb-4"},"Rename VM"),/*#__PURE__*/React.createElement("input",{value:vmwareRenameName,onChange:e=>setVmwareRenameName(e.target.value),placeholder:"New name...",className:"w-full px-4 py-2.5 bg-proxmox-dark border border-proxmox-border rounded-xl text-white mb-4 focus:outline-none focus:border-emerald-500/50"}),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowVmwareRename(false),className:"px-4 py-2 rounded-lg bg-proxmox-dark text-gray-400 text-sm"},"Cancel"),/*#__PURE__*/React.createElement("button",{onClick:()=>handleVmwareRename(vmwareSelectedVm,vmwareRenameName),disabled:!vmwareRenameName.trim(),className:"px-4 py-2 rounded-lg bg-blue-500 text-white text-sm font-medium disabled:opacity-50"},"Rename")))),showVmwareDelete&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",onClick:()=>setShowVmwareDelete(false)},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-red-500/30 rounded-2xl p-6 w-full max-w-md",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-bold text-red-400 mb-2"},"Delete VM"),/*#__PURE__*/React.createElement("p",{className:"text-gray-400 text-sm mb-4"},"Are you sure you want to permanently delete ",/*#__PURE__*/React.createElement("strong",{className:"text-white"},vmwareVmDetail?.name),"? This action cannot be undone."),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowVmwareDelete(false),className:"px-4 py-2 rounded-lg bg-proxmox-dark text-gray-400 text-sm"},"Cancel"),/*#__PURE__*/React.createElement("button",{onClick:()=>handleVmwareDeleteVm(vmwareSelectedVm),className:"px-4 py-2 rounded-lg bg-red-500 text-white text-sm font-medium"},"Delete VM")))),showVmwareMigrate&&vmwareMigrationPlan&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",onClick:()=>setShowVmwareMigrate(false)},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-emerald-500/30 rounded-2xl p-6 w-full max-w-lg max-h-[80vh] overflow-y-auto",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-bold text-white mb-1"},"Migrate to Proxmox"),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mb-4"},"Method: ",vmwareMigrationPlan.method||'HTTPS + Delta Sync'),/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-xs text-gray-500 mb-1 block"},"Target Cluster"),/*#__PURE__*/React.createElement("select",{value:vmwareMigrateForm.target_cluster,onChange:e=>{setVmwareMigrateForm({...vmwareMigrateForm,target_cluster:e.target.value,target_node:'',target_storage:''});},className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Select cluster..."),(vmwareMigrationPlan.targets||[]).map(t=>/*#__PURE__*/React.createElement("option",{key:t.cluster_id,value:t.cluster_id},t.cluster_name)))),vmwareMigrateForm.target_cluster&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-xs text-gray-500 mb-1 block"},"Target Node"),/*#__PURE__*/React.createElement("select",{value:vmwareMigrateForm.target_node,onChange:e=>{setVmwareMigrateForm({...vmwareMigrateForm,target_node:e.target.value,target_storage:''});},className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Select node..."),((vmwareMigrationPlan.targets||[]).find(t=>t.cluster_id===vmwareMigrateForm.target_cluster)?.nodes||[]).map(n=>/*#__PURE__*/React.createElement("option",{key:n,value:n},n)))),vmwareMigrateForm.target_node&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-xs text-gray-500 mb-1 block"},"Target Storage"),/*#__PURE__*/React.createElement("select",{value:vmwareMigrateForm.target_storage,onChange:e=>setVmwareMigrateForm({...vmwareMigrateForm,target_storage:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:""},"Select storage..."),((vmwareMigrationPlan.targets||[]).find(t=>t.cluster_id===vmwareMigrateForm.target_cluster)?.storages?.[vmwareMigrateForm.target_node]||[]).map(s=>/*#__PURE__*/React.createElement("option",{key:s,value:s},s)))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-xs text-gray-500 mb-1 block"},"ESXi Root Password (for SSH access)"),/*#__PURE__*/React.createElement("input",{type:"password",value:vmwareMigrateForm.esxi_password,onChange:e=>setVmwareMigrateForm({...vmwareMigrateForm,esxi_password:e.target.value}),placeholder:"ESXi root password",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-xs text-gray-500 mb-1 block"},"Network Bridge"),/*#__PURE__*/React.createElement("input",{value:vmwareMigrateForm.network_bridge,onChange:e=>setVmwareMigrateForm({...vmwareMigrateForm,network_bridge:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"text-xs text-gray-500 mb-1 block"},"Transfer Mode"),/*#__PURE__*/React.createElement("select",{value:vmwareMigrateForm.transfer_mode,onChange:e=>setVmwareMigrateForm({...vmwareMigrateForm,transfer_mode:e.target.value}),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm"},/*#__PURE__*/React.createElement("option",{value:"auto"},"Auto (Pre-Sync + Delta)"),/*#__PURE__*/React.createElement("option",{value:"sshfs_boot"},"QEMU SSH Boot + Live Copy (Near-Zero Downtime)"),/*#__PURE__*/React.createElement("option",{value:"offline"},"Offline Copy (Full Downtime)")),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-600 mt-1"},vmwareMigrateForm.transfer_mode==='auto'&&'Tries pre-sync while VM runs, falls back to QEMU SSH boot if locked',vmwareMigrateForm.transfer_mode==='sshfs_boot'&&'Boots Proxmox VM via QEMU SSH driver (~15s downtime), copies disks in background while VM runs. Recommended: max. 1 VM at a time.',vmwareMigrateForm.transfer_mode==='offline'&&'Stops VM, copies disks via SSH, then starts on Proxmox (full downtime)')),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-400"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:vmwareMigrateForm.start_after,onChange:e=>setVmwareMigrateForm({...vmwareMigrateForm,start_after:e.target.checked}),className:"rounded"}),"Start VM after migration"),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 text-sm text-gray-400"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:vmwareMigrateForm.remove_source,onChange:e=>setVmwareMigrateForm({...vmwareMigrateForm,remove_source:e.target.checked}),className:"rounded"}),"Remove source VM")),vmwareMigrationPlan.requirements&&/*#__PURE__*/React.createElement("div",{className:"bg-yellow-500/5 border border-yellow-500/20 rounded-lg p-3"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-yellow-400 font-semibold mb-1"},"Requirements:"),vmwareMigrationPlan.requirements.map((r,i)=>/*#__PURE__*/React.createElement("div",{key:i,className:"text-xs text-yellow-400/70"},"- ",r)))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end mt-4"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowVmwareMigrate(false),className:"px-4 py-2 rounded-lg bg-proxmox-dark text-gray-400 text-sm"},"Cancel"),/*#__PURE__*/React.createElement("button",{onClick:()=>startVmwareMigration(vmwareSelectedVm),disabled:!vmwareMigrateForm.target_cluster||!vmwareMigrateForm.target_node||!vmwareMigrateForm.target_storage||!vmwareMigrateForm.esxi_password||vmwareMigrateLoading,className:"px-4 py-2 rounded-lg bg-emerald-500 text-white text-sm font-medium disabled:opacity-50"},vmwareMigrateLoading?'Starting...':'Start Migration'))))),vmwareActiveTab==='hosts'&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",{className:"border-b border-proxmox-border"},/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-xs font-semibold text-gray-500 uppercase"},"Status"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-xs font-semibold text-gray-500 uppercase"},"Name"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-xs font-semibold text-gray-500 uppercase"},"Model"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-xs font-semibold text-gray-500 uppercase"},"CPUs"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-xs font-semibold text-gray-500 uppercase"},"Memory"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-xs font-semibold text-gray-500 uppercase"},"VMs"))),/*#__PURE__*/React.createElement("tbody",null,vmwareHosts.map(host=>/*#__PURE__*/React.createElement("tr",{key:host.host_id||host.name,className:"border-b border-proxmox-border/50 hover:bg-proxmox-hover/50"},/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("div",{className:`w-3 h-3 rounded-full ${host.connection_state==='CONNECTED'||host.connection_state==='connected'?'bg-green-400':'bg-red-400'}`})),/*#__PURE__*/React.createElement("td",{className:"p-3 text-white text-sm font-medium"},host.name),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400 text-sm"},host.model||'-'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400 text-sm"},/*#__PURE__*/React.createElement("div",null,host.cpu_cores||host.num_cpu_cores||'-'," cores"),host.cpu_usage!==undefined&&/*#__PURE__*/React.createElement("div",{className:"w-20 h-1.5 bg-proxmox-dark rounded-full mt-1 overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:`h-full rounded-full ${host.cpu_usage>80?'bg-red-400':host.cpu_usage>60?'bg-yellow-400':'bg-emerald-400'}`,style:{width:`${Math.min(100,host.cpu_usage||0)}%`}}))),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400 text-sm"},/*#__PURE__*/React.createElement("div",null,host.memory_gb?`${host.memory_gb} GB`:host.memory_bytes?`${(host.memory_bytes/(1024*1024*1024)).toFixed(0)} GB`:'-'),host.memory_usage_pct!==undefined&&/*#__PURE__*/React.createElement("div",{className:"w-20 h-1.5 bg-proxmox-dark rounded-full mt-1 overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:`h-full rounded-full ${host.memory_usage_pct>80?'bg-red-400':host.memory_usage_pct>60?'bg-yellow-400':'bg-purple-400'}`,style:{width:`${Math.min(100,host.memory_usage_pct||0)}%`}}))),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400 text-sm"},host.vm_count||'-'))))),vmwareHosts.length===0&&/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},"No hosts found")),vmwareActiveTab==='datastores'&&!vmwareSelectedDs&&/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4"},vmwareDatastores.map(ds=>{const capGB=ds.capacity?(ds.capacity/(1024*1024*1024)).toFixed(1):ds.capacity_gb||0;const freeGB=ds.free_space?(ds.free_space/(1024*1024*1024)).toFixed(1):ds.free_gb||0;const usedGB=capGB&&freeGB?(capGB-freeGB).toFixed(1):0;const pct=ds.capacity&&ds.free_space?((1-ds.free_space/ds.capacity)*100).toFixed(0):null;return/*#__PURE__*/React.createElement("div",{key:ds.datastore_id||ds.datastore||ds.name,onClick:()=>setVmwareSelectedDs(ds),className:"bg-proxmox-card border border-proxmox-border rounded-xl p-4 hover:border-emerald-500/30 cursor-pointer transition-all group"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3 mb-3"},/*#__PURE__*/React.createElement("div",{className:"w-10 h-10 rounded-xl bg-blue-500/10 border border-blue-500/20 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Database,{className:"w-5 h-5 text-blue-400"})),/*#__PURE__*/React.createElement("div",{className:"flex-1 min-w-0"},/*#__PURE__*/React.createElement("div",{className:"text-sm font-semibold text-white truncate group-hover:text-emerald-400 transition-colors"},ds.name),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},ds.type||'VMFS'))),pct!==null&&/*#__PURE__*/React.createElement("div",{className:"mb-2"},/*#__PURE__*/React.createElement("div",{className:"h-2 bg-proxmox-dark rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:`h-full rounded-full ${parseInt(pct)>85?'bg-red-400':parseInt(pct)>65?'bg-yellow-400':'bg-emerald-400'}`,style:{width:`${pct}%`}})),/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-xs text-gray-500 mt-1"},/*#__PURE__*/React.createElement("span",null,usedGB," GB used"),/*#__PURE__*/React.createElement("span",null,freeGB," GB free / ",capGB," GB"))));}),vmwareDatastores.length===0&&/*#__PURE__*/React.createElement("div",{className:"col-span-3 text-center py-12 text-gray-500"},"No datastores found")),vmwareActiveTab==='datastores'&&vmwareSelectedDs&&(()=>{const ds=vmwareSelectedDs;const detail=vmwareDsDetail||{};const capGB=ds.capacity||detail.capacity?((ds.capacity||detail.capacity)/(1024*1024*1024)).toFixed(1):ds.capacity_gb||0;const freeGB=ds.free_space||detail.free_space?((ds.free_space||detail.free_space)/(1024*1024*1024)).toFixed(1):ds.free_gb||0;const usedGB=capGB&&freeGB?(capGB-freeGB).toFixed(1):0;const pct=(ds.capacity||detail.capacity)&&(ds.free_space||detail.free_space)?((1-(ds.free_space||detail.free_space)/(ds.capacity||detail.capacity))*100).toFixed(0):0;// Use server-side VMs if available, else client-side filter
const dsVms=detail.vms&&detail.vms.length>0?detail.vms:vmwareVms.filter(v=>{const vmDs=(v.datastore||'').toLowerCase();return vmDs.includes((ds.name||'').toLowerCase());});const dsHosts=detail.hosts||[];return/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setVmwareSelectedDs(null);setVmwareDsDetail(null);},className:"flex items-center gap-2 text-gray-400 hover:text-white text-sm"},/*#__PURE__*/React.createElement("span",{style:{display:"inline-block",transform:"rotate(180deg)"}},/*#__PURE__*/React.createElement(Icons.ChevronRight,{className:"w-4 h-4"}))," Back to Datastores"),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-5"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4 mb-4"},/*#__PURE__*/React.createElement("div",{className:"w-14 h-14 rounded-xl bg-blue-500/10 border border-blue-500/30 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Database,{className:"w-7 h-7 text-blue-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:"text-xl font-bold text-white"},ds.name),/*#__PURE__*/React.createElement("div",{className:"text-sm text-gray-500"},ds.type||detail.type||'VMFS'," \u2022 ",capGB," GB total",detail.multiple_host_access?' â€¢ Shared':''))),/*#__PURE__*/React.createElement("div",{className:"mb-4"},/*#__PURE__*/React.createElement("div",{className:"h-4 bg-proxmox-dark rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:`h-full rounded-full ${parseInt(pct)>85?'bg-red-400':parseInt(pct)>65?'bg-yellow-400':'bg-emerald-400'}`,style:{width:`${pct}%`}})),/*#__PURE__*/React.createElement("div",{className:"flex justify-between mt-1 text-sm"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},usedGB," GB used (",pct,"%)"),/*#__PURE__*/React.createElement("span",{className:"text-emerald-400"},freeGB," GB free"))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-4 gap-3"},[['Capacity',capGB,'text-white'],['Used',usedGB,'text-white'],['Free',freeGB,'text-emerald-400'],['VMs',dsVms.length,'text-white']].map(([l,v,c])=>/*#__PURE__*/React.createElement("div",{key:l,className:"bg-proxmox-dark rounded-lg p-3 text-center"},/*#__PURE__*/React.createElement("div",{className:`text-lg font-bold ${c}`},v),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},l==='VMs'?l:`GB ${l}`))))),dsHosts.length>0&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase"},"Connected Hosts (",dsHosts.length,")")),/*#__PURE__*/React.createElement("div",{className:"divide-y divide-proxmox-border/50"},dsHosts.map(h=>/*#__PURE__*/React.createElement("div",{key:h.host||h.name,className:"px-4 py-2.5 flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"w-2 h-2 rounded-full bg-green-400"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-white"},h.name))))),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase"},"VMs on ",ds.name," (",dsVms.length,")")),dsVms.length>0?/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",{className:"border-b border-proxmox-border"},/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-xs font-semibold text-gray-500 uppercase"},"Status"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-xs font-semibold text-gray-500 uppercase"},"Name"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-xs font-semibold text-gray-500 uppercase"},"OS"))),/*#__PURE__*/React.createElement("tbody",null,dsVms.map(vm=>/*#__PURE__*/React.createElement("tr",{key:vm.vm||vm.vm_id||vm.name,className:"border-b border-proxmox-border/50 hover:bg-proxmox-hover/50 cursor-pointer",onClick:()=>{setVmwareActiveTab('vms');setVmwareSelectedVm(vm.vm||vm.vm_id);setVmwareSelectedDs(null);}},/*#__PURE__*/React.createElement("td",{className:"p-3"},/*#__PURE__*/React.createElement("div",{className:`w-3 h-3 rounded-full ${vm.power_state==='POWERED_ON'?'bg-green-400':'bg-gray-500'}`})),/*#__PURE__*/React.createElement("td",{className:"p-3 text-white text-sm font-medium"},vm.name),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400 text-sm"},(vm.guest_OS||vm.guest_os||'-').substring(0,25)))))):/*#__PURE__*/React.createElement("div",{className:"p-8 text-center text-gray-500 text-sm"},"No VMs on this datastore")));})(),vmwareActiveTab==='networks'&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("table",{className:"w-full"},/*#__PURE__*/React.createElement("thead",null,/*#__PURE__*/React.createElement("tr",{className:"border-b border-proxmox-border"},/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-xs font-semibold text-gray-500 uppercase"},"Name"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-xs font-semibold text-gray-500 uppercase"},"Type"),/*#__PURE__*/React.createElement("th",{className:"text-left p-3 text-xs font-semibold text-gray-500 uppercase"},"VLAN"))),/*#__PURE__*/React.createElement("tbody",null,vmwareNetworks.map(net=>/*#__PURE__*/React.createElement("tr",{key:net.network_id||net.name,className:"border-b border-proxmox-border/50 hover:bg-proxmox-hover/50"},/*#__PURE__*/React.createElement("td",{className:"p-3 text-white text-sm font-medium"},net.name),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400 text-sm"},net.type||'Standard'),/*#__PURE__*/React.createElement("td",{className:"p-3 text-gray-400 text-sm"},net.vlan_id||'-'))))),vmwareNetworks.length===0&&/*#__PURE__*/React.createElement("div",{className:"text-center py-8 text-gray-500"},"No networks found")),vmwareActiveTab==='clusters'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},vmwareClusters.length===0?/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl p-8 text-center text-gray-500"},/*#__PURE__*/React.createElement(Icons.Layers,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),/*#__PURE__*/React.createElement("p",null,"No compute clusters found"),/*#__PURE__*/React.createElement("p",{className:"text-xs mt-1"},"Clusters are only available on vCenter (not standalone ESXi)")):vmwareClusters.map(cl=>/*#__PURE__*/React.createElement("div",{key:cl.cluster||cl.name,className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Layers,{className:"w-5 h-5 text-purple-400"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-white font-semibold"},cl.name),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},cl.num_hosts||0," Hosts \u2022 ",cl.cluster))),/*#__PURE__*/React.createElement("button",{onClick:()=>fetchVMwareClusters(selectedVMware.id),className:"text-gray-500 hover:text-white"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-4 h-4"})))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-4 p-4 border-b border-proxmox-border/50"},/*#__PURE__*/React.createElement("div",{className:"text-center"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"CPU"),/*#__PURE__*/React.createElement("div",{className:"text-sm text-white font-medium"},cl.total_cpu?(cl.total_cpu/1000).toFixed(1)+' GHz':'N/A')),/*#__PURE__*/React.createElement("div",{className:"text-center"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"Memory"),/*#__PURE__*/React.createElement("div",{className:"text-sm text-white font-medium"},cl.total_memory?(cl.total_memory/1024**3).toFixed(0)+' GB':'N/A')),/*#__PURE__*/React.createElement("div",{className:"text-center"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},"Hosts"),/*#__PURE__*/React.createElement("div",{className:"text-sm text-white font-medium"},cl.num_hosts||0))),/*#__PURE__*/React.createElement("div",{className:"p-4 space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between p-3 rounded-lg bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${cl.drs_enabled?'bg-blue-500/20':'bg-gray-800'}`},/*#__PURE__*/React.createElement(Icons.RotateCw,{className:`w-4 h-4 ${cl.drs_enabled?'text-blue-400':'text-gray-600'}`})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-sm text-white font-medium"},"DRS (Distributed Resource Scheduler)"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},cl.drs_enabled?`Active - ${(cl.drs_automation||'MANUAL').replace(/_/g,' ').toLowerCase()}`:'Disabled'))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},cl.drs_enabled&&/*#__PURE__*/React.createElement("select",{value:cl.drs_automation||'MANUAL',onChange:e=>toggleVMwareDRS(selectedVMware.id,cl.cluster,true,e.target.value),className:"bg-proxmox-card border border-proxmox-border rounded px-2 py-1 text-xs text-gray-300"},/*#__PURE__*/React.createElement("option",{value:"FULLY_AUTOMATED"},"Fully Automated"),/*#__PURE__*/React.createElement("option",{value:"PARTIALLY_AUTOMATED"},"Partially Automated"),/*#__PURE__*/React.createElement("option",{value:"MANUAL"},"Manual")),/*#__PURE__*/React.createElement("button",{onClick:()=>toggleVMwareDRS(selectedVMware.id,cl.cluster,!cl.drs_enabled),className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors ${cl.drs_enabled?'bg-red-500/20 text-red-400 hover:bg-red-500/30':'bg-blue-500/20 text-blue-400 hover:bg-blue-500/30'}`},cl.drs_enabled?'Disable':'Enable'))),/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between p-3 rounded-lg bg-proxmox-dark/50"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${cl.ha_enabled?'bg-green-500/20':'bg-gray-800'}`},/*#__PURE__*/React.createElement(Icons.Shield,{className:`w-4 h-4 ${cl.ha_enabled?'text-green-400':'text-gray-600'}`})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",{className:"text-sm text-white font-medium"},"HA (High Availability)"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500"},cl.ha_enabled?`Active${cl.ha_admission_control?' - Admission Control enabled':''}`:'Disabled'))),/*#__PURE__*/React.createElement("button",{onClick:()=>toggleVMwareHA(selectedVMware.id,cl.cluster,!cl.ha_enabled),className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors ${cl.ha_enabled?'bg-red-500/20 text-red-400 hover:bg-red-500/30':'bg-green-500/20 text-green-400 hover:bg-green-500/30'}`},cl.ha_enabled?'Disable':'Enable')),cl.hosts&&cl.hosts.length>0&&/*#__PURE__*/React.createElement("div",{className:"mt-2"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 mb-2 font-semibold uppercase"},"Cluster Hosts"),/*#__PURE__*/React.createElement("div",{className:"space-y-1"},cl.hosts.map(h=>/*#__PURE__*/React.createElement("div",{key:h.host||h.name,className:"flex items-center justify-between py-1.5 px-2 rounded bg-proxmox-dark/30"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("div",{className:`w-2 h-2 rounded-full ${h.connection_state==='CONNECTED'?'bg-green-400':'bg-red-400'}`}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},h.name)),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},h.maintenance&&/*#__PURE__*/React.createElement("span",{className:"text-xs bg-yellow-500/20 text-yellow-400 px-1.5 py-0.5 rounded"},"Maintenance"),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},h.connection_state)))))))))),vmwareActiveTab==='tasks'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex items-center justify-between"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.FolderInput,{className:"w-4 h-4 text-emerald-400"})," Migrations (",vmwareMigrations.length,")"),/*#__PURE__*/React.createElement("button",{onClick:fetchVmwareMigrations,className:"text-xs text-gray-500 hover:text-white"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:"w-3.5 h-3.5"}))),vmwareMigrations.length>0?/*#__PURE__*/React.createElement("div",{className:"divide-y divide-proxmox-border/50"},vmwareMigrations.map(m=>{const isActive=m.status==='running';const phaseLabel={planning:'Planning',pre_sync:'Pre-Sync',delta_sync:'Delta Sync',cutover:'Cutover',verify:'Verify',cleanup:'Cleanup',completed:'Done',failed:'Failed'};return/*#__PURE__*/React.createElement("div",{key:m.id,className:`p-4 hover:bg-proxmox-hover/30 cursor-pointer ${vmwareSelectedMigration===m.id?'bg-emerald-500/5 border-l-2 border-l-emerald-400':''}`,onClick:()=>setVmwareSelectedMigration(vmwareSelectedMigration===m.id?null:m.id)},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-2"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:`w-2.5 h-2.5 rounded-full ${isActive?'bg-blue-400 animate-pulse':m.status==='completed'?'bg-green-400':m.status==='failed'?'bg-red-400':'bg-gray-500'}`}),/*#__PURE__*/React.createElement("span",{className:"text-sm font-medium text-white"},m.vm_name||m.vm_id),/*#__PURE__*/React.createElement("span",{className:"text-xs px-1.5 py-0.5 rounded bg-proxmox-dark text-gray-400"},phaseLabel[m.phase]||m.phase)),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},m.total_downtime_seconds!=null&&/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},"Downtime: ",m.total_downtime_seconds,"s"),/*#__PURE__*/React.createElement("span",{className:`px-2 py-0.5 rounded text-xs font-semibold ${m.status==='completed'?'bg-green-500/20 text-green-400':m.status==='failed'?'bg-red-500/20 text-red-400':'bg-blue-500/20 text-blue-400'}`},m.status))),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3 mb-1"},/*#__PURE__*/React.createElement("div",{className:"flex-1 h-1.5 bg-proxmox-dark rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:`h-full rounded-full transition-all duration-500 ${m.status==='failed'?'bg-red-400':m.status==='completed'?'bg-green-400':'bg-emerald-400'}`,style:{width:`${m.progress||0}%`}})),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 w-8 text-right"},m.progress||0,"%")),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-4 text-xs text-gray-600"},/*#__PURE__*/React.createElement("span",null,"\u2192 ",m.target_node,"/",m.target_storage),m.started_at&&/*#__PURE__*/React.createElement("span",null,new Date(m.started_at).toLocaleString()),m.proxmox_vmid&&/*#__PURE__*/React.createElement("span",null,"PVE: ",m.proxmox_vmid)),m.phase_times&&Object.keys(m.phase_times).length>1&&/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-0.5 mt-2"},['planning','pre_sync','delta_sync','cutover','verify','cleanup','completed'].map((ph,idx)=>{const pt=m.phase_times[ph];const isCur=m.phase===ph;const isDone=pt&&pt.end;return/*#__PURE__*/React.createElement(React.Fragment,{key:ph},idx>0&&/*#__PURE__*/React.createElement("div",{className:`flex-1 h-px ${isDone?'bg-emerald-500':isCur?'bg-emerald-500/40':'bg-proxmox-border'}`}),/*#__PURE__*/React.createElement("div",{title:`${ph}${pt?.duration?` (${pt.duration}s)`:''}`,className:`w-5 h-5 rounded-full flex items-center justify-center text-[8px] font-bold border ${isDone?'bg-emerald-500/20 border-emerald-500 text-emerald-400':isCur?'bg-blue-500/20 border-blue-400 text-blue-400 animate-pulse':'bg-proxmox-dark border-proxmox-border text-gray-600'}`},isDone?'âœ“':idx+1));})));})):/*#__PURE__*/React.createElement("div",{className:"p-8 text-center text-gray-600 text-sm"},"No migrations yet. Start one from a VM's Migration tab.")),vmwareSelectedMigration&&vmwareMigrationDetail&&/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex items-center justify-between"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-white"},"Migration Log - ",vmwareMigrationDetail.vm_name," ",/*#__PURE__*/React.createElement("span",{className:"text-gray-500 font-normal"},"(",vmwareSelectedMigration,")")),/*#__PURE__*/React.createElement("button",{onClick:()=>setVmwareSelectedMigration(null),className:"text-xs text-gray-500 hover:text-white px-2 py-1 rounded bg-proxmox-dark"},"Close")),vmwareMigrationDetail.disk_progress&&Object.keys(vmwareMigrationDetail.disk_progress).length>0&&/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border/50 space-y-2"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 uppercase font-semibold"},"Disk Transfer"),Object.entries(vmwareMigrationDetail.disk_progress).map(([key,dp])=>/*#__PURE__*/React.createElement("div",{key:key},/*#__PURE__*/React.createElement("div",{className:"flex justify-between text-xs text-gray-400 mb-0.5"},/*#__PURE__*/React.createElement("span",null,key),/*#__PURE__*/React.createElement("span",null,dp.pct,"% - ",(dp.copied/(1024*1024*1024)).toFixed(1),"/",(dp.total/(1024*1024*1024)).toFixed(1)," GB")),/*#__PURE__*/React.createElement("div",{className:"h-2 bg-proxmox-dark rounded-full overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"h-full bg-emerald-400 rounded-full transition-all",style:{width:`${dp.pct}%`}}))))),/*#__PURE__*/React.createElement("div",{className:"p-3 bg-black/30 max-h-60 overflow-y-auto font-mono text-xs leading-relaxed"},(vmwareMigrationDetail.log||[]).map((line,i)=>/*#__PURE__*/React.createElement("div",{key:i,className:line.includes('FAIL')||line.includes('ERROR')?'text-red-400':line.includes('Phase:')?'text-emerald-400 font-bold':line.includes('===')?'text-blue-400':'text-gray-500'},line))),vmwareMigrationDetail.error&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-red-500/10 border-t border-red-500/20 text-red-400 text-xs"},"Error: ",vmwareMigrationDetail.error),vmwareMigrationDetail.status==='completed'&&/*#__PURE__*/React.createElement("div",{className:"p-3 bg-green-500/10 border-t border-green-500/20 text-green-400 text-xs"},"\u2713 Completed! VMID: ",vmwareMigrationDetail.proxmox_vmid,vmwareMigrationDetail.total_downtime_seconds?` - Downtime: ${vmwareMigrationDetail.total_downtime_seconds}s`:'')),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex items-center justify-between"},/*#__PURE__*/React.createElement("h3",{className:"text-sm font-semibold text-gray-400 uppercase flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.FileText,{className:"w-4 h-4 text-blue-400"})," Recent ESXi Events"),/*#__PURE__*/React.createElement("button",{onClick:fetchVmwareEvents,disabled:vmwareEventsLoading,className:"text-xs text-gray-500 hover:text-white"},/*#__PURE__*/React.createElement(Icons.RefreshCw,{className:`w-3.5 h-3.5 ${vmwareEventsLoading?'animate-spin':''}`}))),vmwareEvents.filter(e=>(e.action||'').includes('vmware')).length>0?/*#__PURE__*/React.createElement("div",{className:"divide-y divide-proxmox-border/50 max-h-96 overflow-y-auto"},vmwareEvents.filter(e=>(e.action||'').includes('vmware')).slice(0,50).map((evt,i)=>{const a=evt.action||'';const iconMap={start:'â–¶',stop:'â– ',reset:'â†»',suspend:'â¸',cloned:'â§‰',deleted:'Ã—',renamed:'âœŽ','snapshot.created':'ðŸ“¸','snapshot.deleted':'ðŸ—‘','migration.started':'â†’',added:'+',updated:'â†‘'};const colorMap={start:'text-green-400',stop:'text-red-400',reset:'text-yellow-400',suspend:'text-blue-400',cloned:'text-cyan-400',deleted:'text-red-400',renamed:'text-blue-400','snapshot.created':'text-purple-400','snapshot.deleted':'text-orange-400','migration.started':'text-emerald-400'};const actionKey=Object.keys(iconMap).find(k=>a.includes(k))||'';const icon=iconMap[actionKey]||'â€¢';const color=colorMap[actionKey]||'text-gray-400';const label=a.split('.').pop()||a;return/*#__PURE__*/React.createElement("div",{key:i,className:"px-4 py-2.5 hover:bg-proxmox-hover/30 flex items-start gap-3"},/*#__PURE__*/React.createElement("span",{className:`text-sm leading-none mt-0.5 ${color}`},icon),/*#__PURE__*/React.createElement("div",{className:"flex-1 min-w-0"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("span",{className:`text-xs font-semibold ${color}`},label),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-600"},evt.user||'system')),/*#__PURE__*/React.createElement("div",{className:"text-xs text-gray-500 truncate"},evt.details||'-')),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-600 whitespace-nowrap"},evt.timestamp?new Date(evt.timestamp).toLocaleString():''));})):/*#__PURE__*/React.createElement("div",{className:"p-8 text-center text-gray-600 text-sm"},vmwareEventsLoading?'Loading...':'No ESXi events in audit log')))):selectedGroup?/*#__PURE__*/// LW: Feb 2026 - folder overlay for group
React.createElement(GroupOverview,{group:selectedGroup,clusters:clusters,allMetrics:allClusterMetrics,clusterGroups:clusterGroups,topGuests:topGuests,onSelectCluster:cluster=>{setSelectedGroup(null);setSelectedCluster(cluster);},onSelectVm:(cluster,vmid,node)=>{setSelectedGroup(null);setSelectedCluster(cluster);setHighlightedVm({vmid,node});setTimeout(()=>setHighlightedVm(null),5000);},onOpenSettings:()=>setShowGroupSettings(selectedGroup),authFetch:authFetch,API_URL:API_URL}):/*#__PURE__*/React.createElement(AllClustersOverview,{clusters:clusters,allMetrics:allClusterMetrics,clusterGroups:clusterGroups,topGuests:topGuests,onSelectCluster:setSelectedCluster,onSelectVm:(cluster,vmid,node)=>{// jump to vm
setSelectedCluster(cluster);setHighlightedVm({vmid,node});setTimeout(()=>setHighlightedVm(null),5000);}})))),showAddPBS&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-2xl shadow-2xl w-full max-w-lg animate-scale-in max-h-[90vh] overflow-y-auto"},/*#__PURE__*/React.createElement("div",{className:"p-6"},/*#__PURE__*/React.createElement("h2",{className:"text-xl font-bold text-white mb-4"},editingPBS?'Edit PBS Server':'Add Proxmox Backup Server'),/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Name *"),/*#__PURE__*/React.createElement("input",{value:pbsForm.name,onChange:e=>setPbsForm(p=>({...p,name:e.target.value})),placeholder:"My PBS Server",className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2.5 text-sm text-white"})),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-3"},/*#__PURE__*/React.createElement("div",{className:"col-span-2"},/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Host *"),/*#__PURE__*/React.createElement("input",{value:pbsForm.host,onChange:e=>setPbsForm(p=>({...p,host:e.target.value})),placeholder:"pbs.example.com",className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2.5 text-sm text-white"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Port"),/*#__PURE__*/React.createElement("input",{type:"number",value:pbsForm.port,onChange:e=>setPbsForm(p=>({...p,port:parseInt(e.target.value)||8007})),className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2.5 text-sm text-white"}))),/*#__PURE__*/React.createElement("div",{className:"border-t border-proxmox-border pt-4"},/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mb-3"},"Provide either Username + Password OR API Token (recommended)"),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Username"),/*#__PURE__*/React.createElement("input",{value:pbsForm.user,onChange:e=>setPbsForm(p=>({...p,user:e.target.value})),placeholder:"root@pam",className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2.5 text-sm text-white"})),/*#__PURE__*/React.createElement("div",{className:"mt-3"},/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Password"),/*#__PURE__*/React.createElement("input",{type:"password",value:pbsForm.password,onChange:e=>setPbsForm(p=>({...p,password:e.target.value})),placeholder:"Password",className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2.5 text-sm text-white"})),/*#__PURE__*/React.createElement("div",{className:"mt-3"},/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"API Token ID"),/*#__PURE__*/React.createElement("input",{value:pbsForm.api_token_id,onChange:e=>setPbsForm(p=>({...p,api_token_id:e.target.value})),placeholder:"user@pam!tokenname",className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2.5 text-sm text-white"})),/*#__PURE__*/React.createElement("div",{className:"mt-3"},/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"API Token Secret"),/*#__PURE__*/React.createElement("input",{type:"password",value:pbsForm.api_token_secret,onChange:e=>setPbsForm(p=>({...p,api_token_secret:e.target.value})),placeholder:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2.5 text-sm text-white"}))),/*#__PURE__*/React.createElement("div",{className:"border-t border-proxmox-border pt-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Fingerprint (optional)"),/*#__PURE__*/React.createElement("input",{value:pbsForm.fingerprint,onChange:e=>setPbsForm(p=>({...p,fingerprint:e.target.value})),placeholder:"AA:BB:CC:...",className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2.5 text-sm text-white font-mono text-xs"})),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3 mt-3"},/*#__PURE__*/React.createElement("button",{onClick:()=>setPbsForm(p=>({...p,ssl_verify:!p.ssl_verify})),className:`w-10 h-5 rounded-full transition-all ${pbsForm.ssl_verify?'bg-green-500':'bg-gray-600'}`},/*#__PURE__*/React.createElement("div",{className:`w-4 h-4 bg-white rounded-full transition-transform ${pbsForm.ssl_verify?'translate-x-5':'translate-x-0.5'}`})),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},"Verify SSL Certificate"))),clusters.length>0&&/*#__PURE__*/React.createElement("div",{className:"border-t border-proxmox-border pt-4"},/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-2"},"Link to PVE Clusters"),/*#__PURE__*/React.createElement("div",{className:"space-y-1.5"},clusters.map(cl=>/*#__PURE__*/React.createElement("label",{key:cl.id,className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-proxmox-dark hover:bg-proxmox-hover cursor-pointer transition-colors"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:(pbsForm.linked_clusters||[]).includes(cl.id),onChange:e=>{const linked=pbsForm.linked_clusters||[];setPbsForm(p=>({...p,linked_clusters:e.target.checked?[...linked,cl.id]:linked.filter(id=>id!==cl.id)}));},className:"rounded border-proxmox-border"}),/*#__PURE__*/React.createElement(Icons.Server,{className:"w-4 h-4 text-proxmox-orange"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-300"},cl.name))))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Notes"),/*#__PURE__*/React.createElement("textarea",{value:pbsForm.notes,onChange:e=>setPbsForm(p=>({...p,notes:e.target.value})),rows:2,placeholder:"Optional notes...",className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg p-2.5 text-sm text-white resize-none"})),pbsTestResult&&/*#__PURE__*/React.createElement("div",{className:`p-3 rounded-lg text-sm ${pbsTestResult.success?'bg-green-500/10 border border-green-500/30 text-green-400':'bg-red-500/10 border border-red-500/30 text-red-400'}`},pbsTestResult.success?/*#__PURE__*/React.createElement("span",null,"Connection successful! PBS v",pbsTestResult.version?.version," - ",pbsTestResult.datastores," datastore(s)"):/*#__PURE__*/React.createElement("span",null,"Connection failed: ",pbsTestResult.error))),/*#__PURE__*/React.createElement("div",{className:"flex justify-between mt-6"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{setPbsTestLoading(true);setPbsTestResult(null);const result=await handleTestPBS(pbsForm);setPbsTestResult(result);setPbsTestLoading(false);},disabled:pbsTestLoading||!pbsForm.host,className:"px-4 py-2 rounded-lg bg-proxmox-dark border border-proxmox-border text-gray-300 hover:text-white text-sm flex items-center gap-2 disabled:opacity-50"},pbsTestLoading?/*#__PURE__*/React.createElement(Icons.Loader,{className:"w-4 h-4 animate-spin"}):/*#__PURE__*/React.createElement(Icons.Zap,{className:"w-4 h-4"}),"Test Connection"),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowAddPBS(false);setEditingPBS(null);setPbsTestResult(null);setPbsForm({name:'',host:'',port:8007,user:'root@pam',password:'',api_token_id:'',api_token_secret:'',fingerprint:'',ssl_verify:false,linked_clusters:[],notes:''});},className:"px-4 py-2 rounded-lg bg-proxmox-dark text-gray-400 hover:text-white transition-colors text-sm"},"Cancel"),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!pbsForm.name||!pbsForm.host){addToast('Name and host are required','error');return;}if(!pbsForm.api_token_id&&!pbsForm.password){addToast('Provide password or API token','error');return;}let result;if(editingPBS){result=await handleUpdatePBS(editingPBS.id,pbsForm);}else{result=await handleAddPBS(pbsForm);}if(result?.success){setShowAddPBS(false);setEditingPBS(null);setPbsTestResult(null);setPbsForm({name:'',host:'',port:8007,user:'root@pam',password:'',api_token_id:'',api_token_secret:'',fingerprint:'',ssl_verify:false,linked_clusters:[],notes:''});}else if(result?.error){addToast(result.error,'error');}},disabled:!pbsForm.name||!pbsForm.host,className:"px-4 py-2 rounded-lg bg-blue-500 hover:bg-blue-600 text-white text-sm font-medium disabled:opacity-50"},editingPBS?'Save Changes':'Add Server')))))),pbsEditingNotes&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm",onClick:()=>setPbsEditingNotes(null)},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-2xl shadow-2xl max-w-lg w-full animate-scale-in",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"p-6"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-4"},/*#__PURE__*/React.createElement("h2",{className:"text-lg font-bold text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.FileText,{className:"w-5 h-5 text-cyan-400"}),pbsEditingNotes.type==='snapshot'?'Snapshot':'Group'," Notes"),/*#__PURE__*/React.createElement("button",{onClick:()=>setPbsEditingNotes(null),className:"text-gray-500 hover:text-white transition-colors"},/*#__PURE__*/React.createElement(Icons.X,{className:"w-5 h-5"}))),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mb-3"},pbsEditingNotes.label),/*#__PURE__*/React.createElement("textarea",{value:pbsNotesText,onChange:e=>setPbsNotesText(e.target.value),className:"w-full h-40 p-3 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm resize-y focus:outline-none focus:border-cyan-500/50",placeholder:"Enter notes..."}),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 mt-4"},/*#__PURE__*/React.createElement("button",{onClick:()=>setPbsEditingNotes(null),className:"px-4 py-2 rounded-lg bg-proxmox-dark text-gray-400 hover:text-white transition-colors text-sm"},"Cancel"),/*#__PURE__*/React.createElement("button",{onClick:()=>pbsSaveNotes(pbsEditingNotes.type,pbsEditingNotes.params),className:"px-4 py-2 rounded-lg bg-cyan-600 hover:bg-cyan-500 text-white transition-colors text-sm font-medium"},"Save Notes"))))),showPbsFileBrowser&&pbsCatalogSnapshot&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm",onClick:()=>setShowPbsFileBrowser(false)},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-2xl shadow-2xl max-w-3xl w-full max-h-[80vh] flex flex-col animate-scale-in",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex items-center justify-between shrink-0"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:"text-lg font-bold text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Folder,{className:"w-5 h-5 text-blue-400"}),"File Browser"),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},pbsCatalogSnapshot['backup-type'],"/",pbsCatalogSnapshot['backup-id']," @ ",new Date(pbsCatalogSnapshot['backup-time']*1000).toLocaleString())),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowPbsFileBrowser(false),className:"text-gray-500 hover:text-white transition-colors"},/*#__PURE__*/React.createElement(Icons.X,{className:"w-5 h-5"}))),/*#__PURE__*/React.createElement("div",{className:"px-4 py-2 border-b border-proxmox-border/50 flex items-center gap-1 text-sm bg-proxmox-dark/50 shrink-0 overflow-x-auto"},/*#__PURE__*/React.createElement("button",{onClick:()=>pbsNavigateCatalog('/'),className:"text-blue-400 hover:text-blue-300 transition-colors"},"/"),pbsCatalogPath.split('/').filter(Boolean).map((seg,i,arr)=>{const path='/'+arr.slice(0,i+1).join('/');return/*#__PURE__*/React.createElement("span",{key:i,className:"flex items-center gap-1"},/*#__PURE__*/React.createElement("span",{className:"text-gray-600"},"/"),/*#__PURE__*/React.createElement("button",{onClick:()=>pbsNavigateCatalog(path),className:"text-blue-400 hover:text-blue-300 transition-colors"},seg));})),/*#__PURE__*/React.createElement("div",{className:"flex-1 overflow-y-auto p-2"},pbsCatalogPath!=='/'&&/*#__PURE__*/React.createElement("div",{onClick:()=>{const parts=pbsCatalogPath.split('/').filter(Boolean);parts.pop();pbsNavigateCatalog('/'+parts.join('/'));},className:"flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-proxmox-hover/30 cursor-pointer text-sm text-gray-400 hover:text-white transition-all"},/*#__PURE__*/React.createElement(Icons.ArrowLeft,{className:"w-4 h-4"}),/*#__PURE__*/React.createElement("span",null,"..")),pbsCatalog.length>0?pbsCatalog.sort((a,b)=>{// Directories first, then files
const aDir=a.type==='Directory'||a.type==='d'?0:1;const bDir=b.type==='Directory'||b.type==='d'?0:1;if(aDir!==bDir)return aDir-bDir;return(a.text||a.filename||'').localeCompare(b.text||b.filename||'');}).map((entry,i)=>{const name=entry.text||entry.filename||entry.name||'-';const isDir=entry.type==='Directory'||entry.type==='d';const size=entry.size||entry.leaf_size||0;const mtime=entry.mtime?new Date(entry.mtime*1000).toLocaleString():'';const fullPath=(pbsCatalogPath==='/'?'/':pbsCatalogPath+'/')+name;return/*#__PURE__*/React.createElement("div",{key:i,onClick:()=>isDir?pbsNavigateCatalog(fullPath):null,className:`flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-proxmox-hover/30 text-sm transition-all ${isDir?'cursor-pointer':''}`},isDir?/*#__PURE__*/React.createElement(Icons.Folder,{className:"w-4 h-4 text-yellow-400 shrink-0"}):/*#__PURE__*/React.createElement(Icons.File,{className:"w-4 h-4 text-gray-500 shrink-0"}),/*#__PURE__*/React.createElement("span",{className:`flex-1 truncate ${isDir?'text-white':'text-gray-300'}`},name),!isDir&&size>0&&/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 shrink-0"},formatBytes(size)),mtime&&/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-600 shrink-0"},mtime),!isDir&&/*#__PURE__*/React.createElement("button",{onClick:e=>{e.stopPropagation();pbsDownloadFile(fullPath);},className:"px-2 py-1 rounded text-xs text-gray-500 hover:text-green-400 hover:bg-green-500/10 transition-all shrink-0",title:"Download"},/*#__PURE__*/React.createElement(Icons.Download,{className:"w-3.5 h-3.5"})));}):/*#__PURE__*/React.createElement("div",{className:"text-center py-12 text-gray-500"},/*#__PURE__*/React.createElement(Icons.Folder,{className:"w-8 h-8 mx-auto mb-3 opacity-30"}),/*#__PURE__*/React.createElement("p",{className:"text-sm"},"No files found or catalog unavailable"),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-600 mt-1"},"File browsing is only available for host/file-level (pxar) backups"))))),showUpdateNotification&&pendingUpdate&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-2xl shadow-2xl max-w-md w-full animate-scale-in overflow-hidden"},/*#__PURE__*/React.createElement("div",{className:"p-6 text-center"},/*#__PURE__*/React.createElement("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-br from-green-500/20 to-emerald-500/20 flex items-center justify-center"},/*#__PURE__*/React.createElement(Icons.Download,{className:"w-8 h-8 text-green-400"})),/*#__PURE__*/React.createElement("h2",{className:"text-xl font-bold text-white mb-2"},t('newVersionAvailable')||'New Version Available!'),/*#__PURE__*/React.createElement("p",{className:"text-gray-400 mb-2"},t('updateTo')||'Update to'," ",/*#__PURE__*/React.createElement("span",{className:"text-green-400 font-semibold"},pendingUpdate.latest_version)),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-500 mb-6"},t('currentVersion')||'Current version',": ",pendingUpdate.current_version),/*#__PURE__*/React.createElement("div",{className:"flex gap-3"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowUpdateNotification(false),className:"flex-1 px-4 py-2.5 bg-proxmox-dark hover:bg-proxmox-hover border border-proxmox-border rounded-lg text-gray-300 transition-colors"},t('later')||'Later'),/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowUpdateNotification(false);setShowSettings(true);// Small delay to let settings modal open, then navigate to updates tab
setTimeout(()=>{const event=new CustomEvent('pegaprox-navigate-updates');window.dispatchEvent(event);},100);},className:"flex-1 px-4 py-2.5 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 rounded-lg text-white font-medium transition-all"},t('viewUpdate')||'View Update'))))),configVm&&(configVm._clusterId||selectedCluster)&&/*#__PURE__*/React.createElement(ConfigModal,{vm:configVm,clusterId:configVm._clusterId||selectedCluster.id,allClusters:clusters,dashboardAuthFetch:authFetch,onClose:handleCloseConfig,addToast:addToast}),configNode&&selectedCluster&&/*#__PURE__*/React.createElement(NodeModal,{node:configNode,clusterId:selectedCluster.id,onClose:()=>setConfigNode(null),addToast:addToast}),showRemoveNodeDash&&nodeToRemoveDash&&selectedCluster&&/*#__PURE__*/React.createElement(RemoveNodeConfirmModal,{isOpen:showRemoveNodeDash,onClose:()=>{setShowRemoveNodeDash(false);setNodeToRemoveDash(null);},node:nodeToRemoveDash,clusterId:selectedCluster.id,onSuccess:()=>{fetchClusterMetrics(selectedCluster.id);fetchClusterResources(selectedCluster.id);},addToast:addToast}),showMoveNodeDash&&nodeToMoveDash&&selectedCluster&&/*#__PURE__*/React.createElement(MoveNodeModal,{isOpen:showMoveNodeDash,onClose:()=>{setShowMoveNodeDash(false);setNodeToMoveDash(null);},nodeName:nodeToMoveDash,currentClusterId:selectedCluster.id,clusters:clusters,onSuccess:()=>{fetchClusterMetrics(selectedCluster.id);fetchClusterResources(selectedCluster.id);},addToast:addToast}),showCreateVm&&selectedCluster&&/*#__PURE__*/React.createElement(CreateVmModal,{vmType:showCreateVm,clusterId:selectedCluster.id,nodes:Object.keys(clusterMetrics),onCreate:handleCreateVm,onClose:()=>setShowCreateVm(null)}),showAddVMware&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-2xl w-full max-w-lg shadow-2xl"},/*#__PURE__*/React.createElement("div",{className:"p-6 border-b border-proxmox-border flex items-center justify-between"},/*#__PURE__*/React.createElement("h2",{className:"text-lg font-bold text-white"},editingVMware?'Edit ESXi Server':'Add ESXi Server'),/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowAddVMware(false);setEditingVMware(null);setVmwareTestResult(null);},className:"p-1 text-gray-500 hover:text-white rounded"},/*#__PURE__*/React.createElement(Icons.X,{className:"w-5 h-5"}))),/*#__PURE__*/React.createElement("div",{className:"p-6 space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Name"),/*#__PURE__*/React.createElement("input",{value:vmwareForm.name,onChange:e=>setVmwareForm(f=>({...f,name:e.target.value})),placeholder:"My ESXi Host",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-emerald-500/50"})),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-3"},/*#__PURE__*/React.createElement("div",{className:"col-span-2"},/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Host"),/*#__PURE__*/React.createElement("input",{value:vmwareForm.host,onChange:e=>setVmwareForm(f=>({...f,host:e.target.value})),placeholder:"192.168.1.100",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-emerald-500/50"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Port"),/*#__PURE__*/React.createElement("input",{type:"number",value:vmwareForm.port,onChange:e=>setVmwareForm(f=>({...f,port:parseInt(e.target.value)||443})),className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-emerald-500/50"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Username"),/*#__PURE__*/React.createElement("input",{value:vmwareForm.username,onChange:e=>setVmwareForm(f=>({...f,username:e.target.value})),placeholder:"root",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-emerald-500/50"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Password"),/*#__PURE__*/React.createElement("input",{type:"password",value:vmwareForm.password,onChange:e=>setVmwareForm(f=>({...f,password:e.target.value})),placeholder:editingVMware?'(unchanged)':'Password',className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-emerald-500/50"}))),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:vmwareForm.ssl_verify,onChange:e=>setVmwareForm(f=>({...f,ssl_verify:e.target.checked})),className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-gray-400"},"Verify SSL certificate")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"Notes"),/*#__PURE__*/React.createElement("textarea",{value:vmwareForm.notes,onChange:e=>setVmwareForm(f=>({...f,notes:e.target.value})),rows:2,className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-white text-sm focus:outline-none focus:border-emerald-500/50 resize-none"})),/*#__PURE__*/React.createElement("div",{className:"bg-blue-500/5 border border-blue-500/20 rounded-lg p-3"},/*#__PURE__*/React.createElement("div",{className:"text-xs text-blue-400 font-semibold mb-1"},"Requirements"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-blue-400/70"},"- SSH must be enabled on the ESXi host"),/*#__PURE__*/React.createElement("div",{className:"text-xs text-blue-400/70"},"- ESXi root credentials are required for VM migration")),vmwareTestResult&&/*#__PURE__*/React.createElement("div",{className:`p-3 rounded-lg text-sm ${vmwareTestResult.error?'bg-red-500/10 border border-red-500/30 text-red-400':'bg-green-500/10 border border-green-500/30 text-green-400'}`},vmwareTestResult.error?`Connection failed: ${vmwareTestResult.error}`:'Connection successful!')),/*#__PURE__*/React.createElement("div",{className:"p-6 border-t border-proxmox-border flex items-center justify-between"},/*#__PURE__*/React.createElement("button",{onClick:()=>handleTestVMware(vmwareForm),disabled:vmwareTestLoading||!vmwareForm.host,className:"px-4 py-2 rounded-lg bg-proxmox-dark border border-proxmox-border text-gray-400 hover:text-white text-sm disabled:opacity-50"},vmwareTestLoading?'Testing...':'Test Connection'),/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowAddVMware(false);setEditingVMware(null);setVmwareTestResult(null);},className:"px-4 py-2 rounded-lg text-gray-400 hover:text-white text-sm"},"Cancel"),/*#__PURE__*/React.createElement("button",{onClick:()=>editingVMware?handleUpdateVMware(editingVMware.id,vmwareForm):handleAddVMware(vmwareForm),disabled:!vmwareForm.host||!editingVMware&&!vmwareForm.password,className:"px-4 py-2 rounded-lg bg-emerald-500 text-white text-sm font-medium hover:bg-emerald-600 disabled:opacity-50"},editingVMware?'Update':'Add Server'))))),consoleVm&&consoleInfo&&/*#__PURE__*/React.createElement(ConsoleModal,{vm:consoleVm,consoleInfo:consoleInfo,clusterId:consoleVm._clusterId||selectedCluster?.id,onClose:handleCloseConsole}),corpMetricsVm&&selectedCluster&&/*#__PURE__*/React.createElement(VmMetricsModal,{vm:corpMetricsVm,clusterId:selectedCluster.id,onClose:()=>setCorpMetricsVm(null)}),showHaSettings&&selectedCluster&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",onClick:()=>setShowHaSettings(false)},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-xl max-h-[85vh] overflow-hidden",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"flex justify-between items-center p-4 border-b border-proxmox-border bg-proxmox-dark"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h2",{className:"text-lg font-semibold text-white flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Shield,{className:"text-green-400"}),t('splitBrainProtection')),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-500"},selectedCluster.name)),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowHaSettings(false),className:"p-2 hover:bg-proxmox-hover rounded-lg"},/*#__PURE__*/React.createElement(Icons.X,null))),/*#__PURE__*/React.createElement("div",{className:"p-4 overflow-y-auto",style:{maxHeight:'calc(85vh - 140px)'}},/*#__PURE__*/React.createElement("div",{className:"p-4 bg-green-500/10 border border-green-500/30 rounded-xl mb-4"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-2 mb-3"},/*#__PURE__*/React.createElement("span",{className:"text-2xl"},"\uD83D\uDEE1\uFE0F"),/*#__PURE__*/React.createElement("h4",{className:"text-green-400 font-medium"},t('selfFenceProtection')),/*#__PURE__*/React.createElement("span",{className:"px-2 py-1 rounded text-xs bg-green-500/20 text-green-400 ml-auto"},t('recommended'))),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-300 mb-3"},t('selfFenceExplain')),haStatus?.self_fence_installed?/*#__PURE__*/React.createElement("div",{className:"p-3 bg-green-500/20 rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("p",{className:"text-green-400 font-medium"},"\u2705 ",t('selfFenceActive')),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-400 mt-1"},t('agentInstalledOnNodes'),": ",haStatus.self_fence_nodes?.join(', ')||t('allNodes'))),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!confirm(t('confirmUninstallAgent')))return;try{const res=await authFetch(`${API_URL}/clusters/${selectedCluster.id}/ha/uninstall-self-fence`,{method:'POST'});if(res.ok){addToast(t('selfFenceUninstalling'),'success');setTimeout(()=>fetchHAStatus(selectedCluster.id),3000);}}catch(e){addToast(t('error')+': '+e.message,'error');}},className:"px-3 py-1 text-xs bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-lg"},t('uninstall')))):/*#__PURE__*/React.createElement("div",{className:"space-y-3"},/*#__PURE__*/React.createElement("div",{className:"p-3 bg-yellow-500/20 rounded-lg"},/*#__PURE__*/React.createElement("p",{className:"text-yellow-400 font-medium"},"\u26A1 ",t('selfFenceNotInstalled')),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-300 mt-1"},t('selfFenceInstallHint'))),/*#__PURE__*/React.createElement("button",{onClick:async()=>{try{const res=await authFetch(`${API_URL}/clusters/${selectedCluster.id}/ha/install-self-fence`,{method:'POST'});if(res.ok){addToast(t('selfFenceInstalling'),'success');setTimeout(()=>fetchHAStatus(selectedCluster.id),5000);}}catch(e){addToast(t('error')+': '+e.message,'error');}},className:"w-full px-4 py-2 bg-green-600 hover:bg-green-500 rounded-lg text-white font-medium"},"\uD83D\uDEE1\uFE0F ",t('installSelfFenceAgent'))),/*#__PURE__*/React.createElement("div",{className:"mt-3 text-xs text-gray-400"},"\u2713 ",t('noSharedStorageNeeded')," \u2022 \u2713 ",t('worksWithLvmIscsi'))),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-3 p-3 bg-proxmox-dark border border-proxmox-border rounded-xl mb-4 cursor-pointer hover:border-proxmox-orange/50"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:haSettings.two_node_mode,onChange:e=>setHaSettings({...haSettings,two_node_mode:e.target.checked}),className:"w-5 h-5 rounded border-proxmox-border bg-proxmox-darker text-proxmox-orange"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},t('enable2NodeMode')),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},t('twoNodeModeDesc')))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4 mb-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('recoveryDelay')),/*#__PURE__*/React.createElement("input",{type:"number",min:"10",max:"300",value:haSettings.recovery_delay,onChange:e=>setHaSettings({...haSettings,recovery_delay:parseInt(e.target.value)||30}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg px-3 py-2 text-white"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('recoveryDelayHint'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('failureThreshold')),/*#__PURE__*/React.createElement("input",{type:"number",min:"1",max:"10",value:haSettings.failure_threshold,onChange:e=>setHaSettings({...haSettings,failure_threshold:parseInt(e.target.value)||3}),className:"w-full bg-proxmox-dark border border-proxmox-border rounded-lg px-3 py-2 text-white"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('failureThresholdHint')))),/*#__PURE__*/React.createElement("details",{className:"bg-proxmox-dark border border-proxmox-border rounded-xl overflow-hidden"},/*#__PURE__*/React.createElement("summary",{className:"p-3 cursor-pointer hover:bg-proxmox-hover flex items-center justify-between text-sm"},/*#__PURE__*/React.createElement("span",{className:"text-gray-400"},t('advancedSettings')),/*#__PURE__*/React.createElement(Icons.ChevronDown,{className:"w-4 h-4 text-gray-400"})),/*#__PURE__*/React.createElement("div",{className:"p-3 pt-0 space-y-3 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3"},/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 p-2 bg-proxmox-darker rounded-lg"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:haSettings.self_fence_enabled,onChange:e=>setHaSettings({...haSettings,self_fence_enabled:e.target.checked}),className:"w-4 h-4 rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-white"},t('selfFencing'))),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 p-2 bg-proxmox-darker rounded-lg"},/*#__PURE__*/React.createElement("input",{type:"checkbox",checked:haSettings.verify_network,onChange:e=>setHaSettings({...haSettings,verify_network:e.target.checked}),className:"w-4 h-4 rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm text-white"},t('networkCheck')))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('additionalQuorumHosts')),/*#__PURE__*/React.createElement("input",{type:"text",value:haSettings.quorum_hosts,onChange:e=>setHaSettings({...haSettings,quorum_hosts:e.target.value}),placeholder:"8.8.8.8, 1.1.1.1",className:"w-full bg-proxmox-darker border border-proxmox-border rounded-lg px-3 py-2 text-white text-sm"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-xs text-gray-400 mb-1"},t('gatewayIp')),/*#__PURE__*/React.createElement("input",{type:"text",value:haSettings.quorum_gateway,onChange:e=>setHaSettings({...haSettings,quorum_gateway:e.target.value}),placeholder:"192.168.1.1",className:"w-full bg-proxmox-darker border border-proxmox-border rounded-lg px-3 py-2 text-white text-sm"}))))),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-2 p-4 border-t border-proxmox-border bg-proxmox-dark"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowHaSettings(false),className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover border border-proxmox-border rounded-lg"},t('cancel')),/*#__PURE__*/React.createElement("button",{onClick:handleSaveHASettings,className:"flex items-center gap-2 px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg"},/*#__PURE__*/React.createElement(Icons.Save,{className:"w-4 h-4"}),t('saveSettings'))))),/*#__PURE__*/React.createElement("footer",{className:"border-t border-proxmox-border bg-proxmox-dark/50 mt-8"},/*#__PURE__*/React.createElement("div",{className:"max-w-[800px] mx-auto px-6 py-6"},/*#__PURE__*/React.createElement("div",{className:"text-center mb-4"},/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400"},"\u2764\uFE0F ",t('thanksToSponsors')||'Thanks to our Sponsors')),/*#__PURE__*/React.createElement("div",{className:"flex justify-center gap-3 flex-wrap"},[1,2,3,4,5,6,7,8].map(num=>/*#__PURE__*/React.createElement(SponsorSlot,{key:num,num:num}))),/*#__PURE__*/React.createElement("div",{className:"text-center mt-4 text-xs text-gray-600"},/*#__PURE__*/React.createElement("p",null,"PegaProx ",PEGAPROX_VERSION," \u2022 ",t('madeWithLove')||'Made with â¤ï¸ for the Proxmox community')))),/*#__PURE__*/React.createElement("div",{className:"fixed bottom-6 right-6 z-50 space-y-2"},toasts.map(toast=>/*#__PURE__*/React.createElement(Toast,{key:toast.id,message:toast.message,type:toast.type,onClose:()=>removeToast(toast.id)}))),showScheduleModal&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-md"},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold"},editingSchedule?t('editSchedule')||'Edit Schedule':t('newSchedule')||'New Schedule'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowScheduleModal(false),className:"p-1 hover:bg-proxmox-hover rounded"},/*#__PURE__*/React.createElement(Icons.X,null))),/*#__PURE__*/React.createElement("form",{onSubmit:async e=>{e.preventDefault();const form=e.target;const data={cluster_id:selectedCluster?.id,vmid:parseInt(form.vmid.value),vm_type:form.vm_type.value,action:form.action.value,schedule_type:form.schedule_type.value,time:form.time.value,name:form.name.value||`${form.action.value} VM ${form.vmid.value}`,date:form.date?.value,days:Array.from(form.querySelectorAll('input[name="days"]:checked')).map(cb=>cb.value)};const success=await createSchedule(data);if(success)setShowScheduleModal(false);},className:"p-4 space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('name')||'Name'),/*#__PURE__*/React.createElement("input",{name:"name",type:"text",placeholder:t('optionalName')||'Optional name',className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"})),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"VMID"),/*#__PURE__*/React.createElement("input",{name:"vmid",type:"number",required:true,className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('type')||'Type'),/*#__PURE__*/React.createElement("select",{name:"vm_type",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"},/*#__PURE__*/React.createElement("option",{value:"qemu"},"VM (QEMU)"),/*#__PURE__*/React.createElement("option",{value:"lxc"},"Container (LXC)")))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('action')||'Action'),/*#__PURE__*/React.createElement("select",{name:"action",required:true,className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"},/*#__PURE__*/React.createElement("option",{value:"start"},t('start')||'Start'),/*#__PURE__*/React.createElement("option",{value:"stop"},t('stop')||'Stop'),/*#__PURE__*/React.createElement("option",{value:"shutdown"},t('shutdown')||'Shutdown'),/*#__PURE__*/React.createElement("option",{value:"reboot"},t('reboot')||'Reboot'),/*#__PURE__*/React.createElement("option",{value:"snapshot"},t('snapshot')||'Snapshot'))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('scheduleType')||'Schedule Type'),/*#__PURE__*/React.createElement("select",{name:"schedule_type",required:true,className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"},/*#__PURE__*/React.createElement("option",{value:"daily"},t('daily')||'Daily'),/*#__PURE__*/React.createElement("option",{value:"weekdays"},t('weekdays')||'Weekdays'),/*#__PURE__*/React.createElement("option",{value:"weekends"},t('weekends')||'Weekends'),/*#__PURE__*/React.createElement("option",{value:"weekly"},t('weekly')||'Weekly'),/*#__PURE__*/React.createElement("option",{value:"once"},t('once')||'Once'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('time')||'Time'),/*#__PURE__*/React.createElement("input",{name:"time",type:"time",required:true,className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"}))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('date')||'Date'," (",t('forOnce')||'for once',")"),/*#__PURE__*/React.createElement("input",{name:"date",type:"date",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('days')||'Days'," (",t('forWeekly')||'for weekly',")"),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-2"},['monday','tuesday','wednesday','thursday','friday','saturday','sunday'].map(day=>/*#__PURE__*/React.createElement("label",{key:day,className:"flex items-center gap-1 text-sm"},/*#__PURE__*/React.createElement("input",{type:"checkbox",name:"days",value:day,className:"rounded"}),day.slice(0,3))))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end pt-2"},/*#__PURE__*/React.createElement("button",{type:"button",onClick:()=>setShowScheduleModal(false),className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover rounded-lg"},t('cancel')||'Cancel'),/*#__PURE__*/React.createElement("button",{type:"submit",className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg"},t('save')||'Save'))))),showTagEditor&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",onClick:()=>setShowTagEditor(null)},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-sm",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"font-semibold flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Tag,null),t('manageTags')||'Manage Tags',": ",showTagEditor.vmName)),/*#__PURE__*/React.createElement("div",{className:"p-4 space-y-4"},/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-2"},getVmTags(showTagEditor.clusterId,showTagEditor.vmid).map((tag,idx)=>/*#__PURE__*/React.createElement("span",{key:idx,className:"flex items-center gap-1 px-2 py-1 rounded-full text-xs",style:{backgroundColor:(tag.color||'#6b7280')+'30',color:tag.color||'#9ca3af'}},tag.name||tag,/*#__PURE__*/React.createElement("button",{onClick:()=>removeTagFromVm(showTagEditor.clusterId,showTagEditor.vmid,tag.name||tag),className:"hover:text-red-400"},/*#__PURE__*/React.createElement(Icons.X,{className:"w-3 h-3"})))),getVmTags(showTagEditor.clusterId,showTagEditor.vmid).length===0&&/*#__PURE__*/React.createElement("span",{className:"text-gray-500 text-sm"},t('noTags')||'No tags')),/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"text",value:newTagName,onChange:e=>setNewTagName(e.target.value),onKeyDown:async e=>{if(e.key==='Enter'&&newTagName.trim()){await addTagToVm(showTagEditor.clusterId,showTagEditor.vmid,newTagName.trim());setNewTagName('');}},placeholder:t('newTag')||'New tag...',className:"flex-1 px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg text-sm"}),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(newTagName.trim()){await addTagToVm(showTagEditor.clusterId,showTagEditor.vmid,newTagName.trim());setNewTagName('');}},className:"px-3 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg"},/*#__PURE__*/React.createElement(Icons.Plus,{className:"w-4 h-4"}))),clusterTags.length>0&&/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mb-2"},t('existingTags')||'Existing tags',":"),/*#__PURE__*/React.createElement("div",{className:"flex flex-wrap gap-1"},clusterTags.filter(t=>!getVmTags(showTagEditor.clusterId,showTagEditor.vmid).some(vt=>(vt.name||vt)===t.name)).slice(0,10).map((tag,idx)=>/*#__PURE__*/React.createElement("button",{key:idx,onClick:()=>addTagToVm(showTagEditor.clusterId,showTagEditor.vmid,tag.name,tag.color),className:"px-2 py-0.5 rounded-full text-xs hover:opacity-80",style:{backgroundColor:(tag.color||'#6b7280')+'30',color:tag.color||'#9ca3af'}},"+ ",tag.name))))),/*#__PURE__*/React.createElement("div",{className:"p-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("button",{onClick:()=>setShowTagEditor(null),className:"w-full px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover rounded-lg"},t('close')||'Close')))),showAlertModal&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",onClick:()=>setShowAlertModal(false)},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-md",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold"},t('newAlert')||'New Alert'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAlertModal(false),className:"p-1 hover:bg-proxmox-hover rounded"},/*#__PURE__*/React.createElement(Icons.X,null))),/*#__PURE__*/React.createElement("form",{onSubmit:async e=>{e.preventDefault();const form=e.target;await createClusterAlert({name:form.name.value,target_type:form.target_type.value,target_id:form.target_id.value||null,metric:form.metric.value,operator:form.operator.value,threshold:parseInt(form.threshold.value),action:form.action.value,enabled:true});},className:"p-4 space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('name')||'Name'),/*#__PURE__*/React.createElement("input",{name:"name",required:true,placeholder:"High CPU Alert",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"})),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('targetType')||'Apply to'),/*#__PURE__*/React.createElement("select",{name:"target_type",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"},/*#__PURE__*/React.createElement("option",{value:"cluster"},t('entireCluster')||'Entire Cluster'),/*#__PURE__*/React.createElement("option",{value:"node"},t('specificNode')||'Specific Node'),/*#__PURE__*/React.createElement("option",{value:"vm"},t('specificVm')||'Specific VM'))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('targetId')||'Target'," ",/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-600"},"(",t('optional')||'optional',")")),/*#__PURE__*/React.createElement("input",{name:"target_id",placeholder:"node1 or VMID",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"}))),/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-3 gap-3"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('metric')||'Metric'),/*#__PURE__*/React.createElement("select",{name:"metric",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"},/*#__PURE__*/React.createElement("option",{value:"cpu"},"CPU"),/*#__PURE__*/React.createElement("option",{value:"memory"},"Memory"),/*#__PURE__*/React.createElement("option",{value:"disk"},"Disk"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('condition')||'Condition'),/*#__PURE__*/React.createElement("select",{name:"operator",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"},/*#__PURE__*/React.createElement("option",{value:">"},"> above"),/*#__PURE__*/React.createElement("option",{value:"<"},"< below"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('threshold')||'Threshold'," %"),/*#__PURE__*/React.createElement("input",{name:"threshold",type:"number",min:"0",max:"100",defaultValue:"80",required:true,className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"}))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('action')||'Action'),/*#__PURE__*/React.createElement("select",{name:"action",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"},/*#__PURE__*/React.createElement("option",{value:"log"},"Log Only"),/*#__PURE__*/React.createElement("option",{value:"email"},"Email"))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end pt-2"},/*#__PURE__*/React.createElement("button",{type:"button",onClick:()=>setShowAlertModal(false),className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover rounded-lg"},t('cancel')||'Cancel'),/*#__PURE__*/React.createElement("button",{type:"submit",className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg"},t('create')||'Create'))))),showAffinityModal&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",onClick:()=>setShowAffinityModal(false)},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-md",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"p-4 border-b border-proxmox-border flex justify-between items-center"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold"},t('newRule')||'New Affinity Rule'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAffinityModal(false),className:"p-1 hover:bg-proxmox-hover rounded"},/*#__PURE__*/React.createElement(Icons.X,null))),/*#__PURE__*/React.createElement("form",{onSubmit:async e=>{e.preventDefault();const form=e.target;const vmIds=form.vm_ids.value.split(',').map(id=>parseInt(id.trim())).filter(Boolean);await createClusterAffinityRule({name:form.rule_name.value||'New Rule',type:form.type.value,vm_ids:vmIds,enforce:form.enforce.checked});},className:"p-4 space-y-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('ruleName')||'Rule Name'),/*#__PURE__*/React.createElement("input",{name:"rule_name",placeholder:"e.g. DB Cluster Affinity",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('ruleType')||'Rule Type'),/*#__PURE__*/React.createElement("select",{name:"type",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"},/*#__PURE__*/React.createElement("option",{value:"together"},t('together')||'Together'," - VMs/CTs on same node"),/*#__PURE__*/React.createElement("option",{value:"separate"},t('separate')||'Separate'," - VMs/CTs on different nodes"))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},"VM/CT IDs (",t('commaSeparated')||'comma-separated',")"),/*#__PURE__*/React.createElement("input",{name:"vm_ids",required:true,placeholder:"100, 101, 102",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"})),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},/*#__PURE__*/React.createElement("input",{name:"enforce",type:"checkbox",className:"rounded"}),/*#__PURE__*/React.createElement("span",{className:"text-sm"},t('enforced')||'Enforce'),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500"},"(",t('enforceHint')||'Block migrations that violate rule',")")),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end pt-2"},/*#__PURE__*/React.createElement("button",{type:"button",onClick:()=>setShowAffinityModal(false),className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover rounded-lg"},t('cancel')||'Cancel'),/*#__PURE__*/React.createElement("button",{type:"submit",className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg"},t('create')||'Create'))))),showScriptRunModal&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",onClick:()=>setShowScriptRunModal(null)},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-md",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold"},t('runScript')||'Run Script'),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowScriptRunModal(null),className:"p-1 hover:bg-proxmox-hover rounded"},/*#__PURE__*/React.createElement(Icons.X,{className:"w-5 h-5"}))),/*#__PURE__*/React.createElement("form",{className:"p-4 space-y-4",onSubmit:async e=>{e.preventDefault();const password=e.target.password.value;if(!password)return;try{const res=await authFetch(`${API_URL}/clusters/${selectedCluster.id}/scripts/${showScriptRunModal.id}/run`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({password})});if(res&&res.ok){const data=await res.json();addToast(data.message||t('scriptStarted')||'Script execution started','success');setShowScriptRunModal(null);// Reload scripts to show last_run update
setTimeout(()=>loadCustomScripts(selectedCluster.id),1000);}else{const err=await res.json().catch(()=>({}));addToast(err.error||'Failed to run script','error');}}catch(e){addToast('Error: '+e.message,'error');}}},/*#__PURE__*/React.createElement("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg text-yellow-300 text-sm"},/*#__PURE__*/React.createElement("strong",null,t('warning')||'Warning',":")," ",t('scriptWarning')||'Scripts run with SSH user permissions. Ensure scripts are safe before running.'),/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-dark rounded-lg p-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${showScriptRunModal.type==='python'?'bg-blue-500/20 text-blue-400':'bg-green-500/20 text-green-400'}`},showScriptRunModal.type==='python'?'ðŸ':'ðŸ“œ'),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h4",{className:"font-medium text-white"},showScriptRunModal.name),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},showScriptRunModal.description||'No description')))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('confirmPassword')||'Confirm your password'," *"),/*#__PURE__*/React.createElement("input",{name:"password",type:"password",required:true,autoFocus:true,placeholder:t('enterPassword')||'Enter your password',className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mt-1"},t('passwordRequiredForScripts')||'Password confirmation required for security')),/*#__PURE__*/React.createElement("div",{className:"flex justify-end gap-3 pt-2"},/*#__PURE__*/React.createElement("button",{type:"button",onClick:()=>setShowScriptRunModal(null),className:"px-4 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg hover:bg-proxmox-hover"},t('cancel')||'Cancel'),/*#__PURE__*/React.createElement("button",{type:"submit",className:"px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg flex items-center gap-2"},/*#__PURE__*/React.createElement(Icons.Play,{className:"w-4 h-4"}),t('runScript')||'Run Script'))))),scriptOutput&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",onClick:()=>setScriptOutput(null)},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-3xl max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold"},scriptOutput.name," - ",t('output')||'Output'),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},t('lastRun')||'Last run',": ",scriptOutput.last_run?new Date(scriptOutput.last_run).toLocaleString():t('never')||'Never',scriptOutput.last_status&&/*#__PURE__*/React.createElement("span",{className:`ml-2 px-2 py-0.5 rounded text-xs ${scriptOutput.last_status==='success'?'bg-green-500/20 text-green-400':scriptOutput.last_status==='partial'?'bg-yellow-500/20 text-yellow-400':'bg-red-500/20 text-red-400'}`},scriptOutput.last_status))),/*#__PURE__*/React.createElement("button",{onClick:()=>setScriptOutput(null),className:"p-1 hover:bg-proxmox-hover rounded"},/*#__PURE__*/React.createElement(Icons.X,{className:"w-5 h-5"}))),/*#__PURE__*/React.createElement("div",{className:"p-4 flex-1 overflow-auto"},/*#__PURE__*/React.createElement("pre",{className:"bg-proxmox-dark p-4 rounded-lg text-sm font-mono whitespace-pre-wrap text-gray-300 max-h-[60vh] overflow-auto"},scriptOutput.output||t('noOutput')||'No output available')),/*#__PURE__*/React.createElement("div",{className:"p-4 border-t border-proxmox-border flex justify-end"},/*#__PURE__*/React.createElement("button",{onClick:()=>setScriptOutput(null),className:"px-4 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg hover:bg-proxmox-hover"},t('close')||'Close')))),showScriptModal&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",onClick:()=>{setShowScriptModal(false);setEditingScript(null);}},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation()},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between p-4 border-b border-proxmox-border"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold"},editingScript?t('editScript')||'Edit Script':t('newScript')||'New Script'),/*#__PURE__*/React.createElement("button",{onClick:()=>{setShowScriptModal(false);setEditingScript(null);},className:"p-1 hover:bg-proxmox-hover rounded"},/*#__PURE__*/React.createElement(Icons.X,{className:"w-5 h-5"}))),/*#__PURE__*/React.createElement("form",{className:"p-4 space-y-4",onSubmit:async e=>{e.preventDefault();const form=e.target;const data={name:form.name.value,description:form.description.value,type:form.type.value,content:form.content.value,target_nodes:form.target_nodes.value,enabled:form.enabled.checked};try{const url=editingScript?`${API_URL}/clusters/${selectedCluster.id}/scripts/${editingScript.id}`:`${API_URL}/clusters/${selectedCluster.id}/scripts`;console.log('[Script] Saving to:',url,'Data:',data);const res=await authFetch(url,{method:editingScript?'PUT':'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});console.log('[Script] Response:',res?.status,res?.ok);if(res&&res.ok){addToast(editingScript?t('scriptUpdated')||'Script updated':t('scriptCreated')||'Script created','success');setShowScriptModal(false);setEditingScript(null);// Reload scripts
loadCustomScripts(selectedCluster.id);}else{const err=await res.json().catch(()=>({}));console.error('[Script] Error response:',err);addToast(err.error||'Failed to save script','error');}}catch(e){console.error('[Script] Exception:',e);addToast('Error saving script: '+e.message,'error');}}},/*#__PURE__*/React.createElement("div",{className:"grid grid-cols-2 gap-4"},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('name')||'Name'," *"),/*#__PURE__*/React.createElement("input",{name:"name",required:true,defaultValue:editingScript?.name||'',placeholder:"my-script",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('type')||'Type'),/*#__PURE__*/React.createElement("select",{name:"type",defaultValue:editingScript?.type||'bash',className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"},/*#__PURE__*/React.createElement("option",{value:"bash"},"Bash (.sh)"),/*#__PURE__*/React.createElement("option",{value:"python"},"Python (.py)")))),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('description')||'Description'),/*#__PURE__*/React.createElement("input",{name:"description",defaultValue:editingScript?.description||'',placeholder:"What does this script do?",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"})),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('targetNodes')||'Target Nodes'),/*#__PURE__*/React.createElement("input",{name:"target_nodes",defaultValue:editingScript?.target_nodes||'all',placeholder:"all or node1,node2",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg"}),/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-600 mt-1"},"Use \"all\" for all nodes or comma-separated node names")),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{className:"block text-sm text-gray-400 mb-1"},t('scriptContent')||'Script Content'," *"),/*#__PURE__*/React.createElement("textarea",{name:"content",required:true,rows:12,defaultValue:editingScript?.content||(editingScript?.type==='python'?'#!/usr/bin/env python3\n# Your script here\n\nprint("Hello from PegaProx!")':'#!/bin/bash\n# Your script here\n\necho "Hello from PegaProx!"'),placeholder:"#!/bin/bash",className:"w-full px-3 py-2 bg-proxmox-dark border border-proxmox-border rounded-lg font-mono text-sm"})),/*#__PURE__*/React.createElement("label",{className:"flex items-center gap-2"},/*#__PURE__*/React.createElement("input",{type:"checkbox",name:"enabled",defaultChecked:editingScript?.enabled!==false,className:"w-4 h-4 rounded"}),/*#__PURE__*/React.createElement("span",null,t('enabled')||'Enabled')),/*#__PURE__*/React.createElement("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-3"},/*#__PURE__*/React.createElement("div",{className:"flex items-start gap-2"},/*#__PURE__*/React.createElement(Icons.AlertTriangle,{className:"text-yellow-500 w-5 h-5 mt-0.5"}),/*#__PURE__*/React.createElement("div",{className:"text-sm text-yellow-200"},/*#__PURE__*/React.createElement("strong",null,t('warning')||'Warning',":")," ",t('scriptWarning')||'Scripts run with SSH user permissions. Ensure scripts are safe before running.'))),/*#__PURE__*/React.createElement("div",{className:"flex gap-2 justify-end pt-2"},/*#__PURE__*/React.createElement("button",{type:"button",onClick:()=>{setShowScriptModal(false);setEditingScript(null);},className:"px-4 py-2 bg-proxmox-dark hover:bg-proxmox-hover rounded-lg"},t('cancel')||'Cancel'),/*#__PURE__*/React.createElement("button",{type:"submit",className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded-lg"},editingScript?t('update')||'Update':t('create')||'Create'))))),/*#__PURE__*/React.createElement(AddClusterModal,{isOpen:showAddModal,initialType:addClusterType,onClose:()=>{setShowAddModal(false);setError(null);},onSubmit:handleAddCluster,onAddPBS:async config=>{const result=await handleAddPBS(config);if(result!==false){setShowAddModal(false);setError(null);}},onAddVMware:async config=>{const result=await handleAddVMware(config);if(result!==false){setShowAddModal(false);setError(null);}},loading:loading,error:error}),/*#__PURE__*/React.createElement(UserProfileModal,{isOpen:showProfile,onClose:()=>setShowProfile(false),addToast:addToast}),/*#__PURE__*/React.createElement(PegaProxSettingsModal,{isOpen:showSettings,onClose:()=>setShowSettings(false),addToast:addToast}),showGroupManager&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-lg p-6 max-h-[80vh] overflow-auto"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-4"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold"},t('clusterGroups')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowGroupManager(false),className:"text-gray-400 hover:text-white"},/*#__PURE__*/React.createElement(Icons.X,null))),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mb-4"},t('clusterGroupsDesc')),/*#__PURE__*/React.createElement("div",{className:"mb-4 p-3 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex gap-2"},/*#__PURE__*/React.createElement("input",{type:"text",placeholder:t('groupName')+'...',id:"newGroupName",className:"flex-1 px-3 py-2 bg-proxmox-darker border border-proxmox-border rounded text-white text-sm"}),/*#__PURE__*/React.createElement("input",{type:"color",defaultValue:"#E86F2D",id:"newGroupColor",className:"w-10 h-10 rounded cursor-pointer"}),/*#__PURE__*/React.createElement("button",{onClick:async()=>{const name=document.getElementById('newGroupName').value;const color=document.getElementById('newGroupColor').value;if(!name)return;try{const r=await fetch(`${API_URL}/cluster-groups`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({name,color})});if(r.ok){document.getElementById('newGroupName').value='';fetchClusterGroups();addToast(t('groupCreated'),'success');}}catch(e){}},className:"px-4 py-2 bg-proxmox-orange hover:bg-orange-600 rounded text-sm font-medium"},t('add')))),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},clusterGroups.length===0?/*#__PURE__*/React.createElement("p",{className:"text-gray-500 text-center py-4"},t('noGroupsYet')):clusterGroups.map(group=>{const groupClusters=clusters.filter(c=>c.group_id===group.id);const tenant=group.tenant_id?// We don't have tenants here, show ID
group.tenant_id:null;return/*#__PURE__*/React.createElement("div",{key:group.id,className:"flex items-center justify-between p-3 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:group.color||'#E86F2D'}}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},group.name),/*#__PURE__*/React.createElement("span",{className:"text-xs text-gray-500 ml-2"},"(",groupClusters.length," clusters)"),tenant&&/*#__PURE__*/React.createElement("span",{className:"ml-2 px-1.5 py-0.5 text-[10px] bg-blue-500/20 text-blue-400 rounded"},"Tenant: ",tenant))),/*#__PURE__*/React.createElement("button",{onClick:async()=>{if(!confirm(`Delete group "${group.name}"?`))return;try{const r=await fetch(`${API_URL}/cluster-groups/${group.id}`,{method:'DELETE',credentials:'include',headers:getAuthHeaders()});if(r.ok){fetchClusterGroups();fetchClusters();addToast('Group deleted','success');}}catch(e){}},className:"p-1 text-red-400 hover:bg-red-500/20 rounded"},/*#__PURE__*/React.createElement(Icons.Trash,{className:"w-4 h-4"})));})),/*#__PURE__*/React.createElement("div",{className:"mt-4 pt-4 border-t border-proxmox-border"},/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500"},t('groupsTip'))))),showAssignGroup&&/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-sm p-6"},/*#__PURE__*/React.createElement("div",{className:"flex items-center justify-between mb-4"},/*#__PURE__*/React.createElement("h3",{className:"text-lg font-semibold"},t('assignToGroup')),/*#__PURE__*/React.createElement("button",{onClick:()=>setShowAssignGroup(null),className:"text-gray-400 hover:text-white"},/*#__PURE__*/React.createElement(Icons.X,null))),/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-400 mb-4"},t('assignToGroup'),": ",/*#__PURE__*/React.createElement("span",{className:"text-white font-medium"},showAssignGroup.name)),/*#__PURE__*/React.createElement("div",{className:"space-y-2"},/*#__PURE__*/React.createElement("button",{onClick:async()=>{try{const r=await fetch(`${API_URL}/clusters/${showAssignGroup.id}/group`,{method:'PUT',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({group_id:null})});if(r.ok){fetchClusters();setShowAssignGroup(null);addToast(t('removeFromGroup'),'success');}}catch(e){}},className:`w-full p-3 rounded-lg text-left transition-colors ${!showAssignGroup.group_id?'bg-proxmox-orange/20 border border-proxmox-orange':'bg-proxmox-dark hover:bg-proxmox-hover border border-transparent'}`},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement(Icons.Server,{className:"w-4 h-4 text-gray-400"}),/*#__PURE__*/React.createElement("span",{className:"text-gray-300"},t('noGroup')," (",t('ungrouped'),")"))),clusterGroups.map(group=>/*#__PURE__*/React.createElement("button",{key:group.id,onClick:async()=>{try{const r=await fetch(`${API_URL}/clusters/${showAssignGroup.id}/group`,{method:'PUT',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({group_id:group.id})});if(r.ok){fetchClusters();setShowAssignGroup(null);addToast(t('groupUpdated'),'success');}}catch(e){}},className:`w-full p-3 rounded-lg text-left transition-colors ${showAssignGroup.group_id===group.id?'bg-proxmox-orange/20 border border-proxmox-orange':'bg-proxmox-dark hover:bg-proxmox-hover border border-transparent'}`},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3"},/*#__PURE__*/React.createElement(Icons.Folder,{className:"w-4 h-4",style:{color:group.color||'#E86F2D'}}),/*#__PURE__*/React.createElement("span",{className:"text-gray-300"},group.name))))),clusterGroups.length===0&&/*#__PURE__*/React.createElement("p",{className:"text-sm text-gray-500 text-center mt-4"},t('createGroupFirst')))),showGroupSettings&&(()=>{// local state via closure - keeps it simple without extra component
const grp=showGroupSettings;return/*#__PURE__*/React.createElement(GroupSettingsModal,{group:grp,groupClusters:clusters.filter(c=>c.group_id===grp.id),authFetch:authFetch,addToast:addToast,onClose:()=>setShowGroupSettings(null),onSave:async updatedFields=>{try{const r=await authFetch(`${API_URL}/cluster-groups/${grp.id}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(updatedFields)});if(r&&r.ok){fetchClusterGroups();// update selectedGroup if it's the same one
if(selectedGroup?.id===grp.id){setSelectedGroup(prev=>({...prev,...updatedFields}));}addToast('Group settings saved','success');setShowGroupSettings(null);}else{addToast('Failed to save group settings','error');}}catch(e){addToast('Error saving group settings','error');}}});})(),showTaskBar&&/*#__PURE__*/React.createElement(TaskBar,{tasks:tasks,onClear:clearCompletedTasks,onClose:()=>setShowTaskBar(false),onCancel:cancelTask,onRefresh:()=>selectedCluster&&fetchTasks(selectedCluster.id),clusterId:selectedCluster?.id,autoExpandEnabled:user?.taskbar_auto_expand!==false}));}// Main App with Auth Check
// NS: Feb 2026 - Forced 2FA setup modal (shown when admin requires 2FA and user hasn't set it up yet)
function Force2FASetupModal(){const{t}=useTranslation();const{getAuthHeaders,setRequires2FASetup}=useAuth();const[step,setStep]=useState('intro');// intro, scan, verify
const[qrData,setQrData]=useState(null);const[verifyCode,setVerifyCode]=useState('');const[error,setError]=useState('');const[loading,setLoading]=useState(false);const startSetup=async()=>{setLoading(true);setError('');try{const r=await fetch(`${API_URL}/auth/2fa/setup`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'}});const data=await r.json();if(r.ok){setQrData(data);setStep('scan');}else{setError(data.error||'Failed to start 2FA setup');}}catch(e){setError(e.message);}setLoading(false);};const verifySetup=async()=>{if(!verifyCode||verifyCode.length!==6)return;setLoading(true);setError('');try{const r=await fetch(`${API_URL}/auth/2fa/verify`,{method:'POST',credentials:'include',headers:{...getAuthHeaders(),'Content-Type':'application/json'},body:JSON.stringify({code:verifyCode})});const data=await r.json();if(r.ok&&data.success){setRequires2FASetup(false);}else{setError(data.error||t('invalid2FACode')||'Invalid code');setVerifyCode('');}}catch(e){setError(e.message);}setLoading(false);};return/*#__PURE__*/React.createElement("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-[100] p-4"},/*#__PURE__*/React.createElement("div",{className:"bg-proxmox-card border border-proxmox-border rounded-xl w-full max-w-md shadow-2xl"},/*#__PURE__*/React.createElement("div",{className:"p-6"},/*#__PURE__*/React.createElement("div",{className:"flex items-center gap-3 mb-4"},/*#__PURE__*/React.createElement("div",{className:"p-2 bg-proxmox-orange/20 rounded-lg"},/*#__PURE__*/React.createElement(Icons.Shield,{className:"w-6 h-6 text-proxmox-orange"})),/*#__PURE__*/React.createElement("h2",{className:"text-lg font-semibold text-white"},t('force2FASetupTitle')||'2FA Setup Required')),step==='intro'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("p",{className:"text-gray-400 text-sm"},t('force2FASetupDesc')||'Your administrator has made Two-Factor Authentication mandatory. Please set up 2FA to continue.'),/*#__PURE__*/React.createElement("button",{onClick:startSetup,disabled:loading,className:"w-full px-4 py-3 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-white font-medium transition-colors disabled:opacity-50 flex items-center justify-center gap-2"},loading?/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-4 h-4 animate-spin"}):/*#__PURE__*/React.createElement(Icons.Shield,{className:"w-4 h-4"}),t('setup2FA')||'Setup 2FA')),step==='scan'&&qrData&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("p",{className:"text-gray-400 text-sm"},t('scan2FACode')||'Scan QR code with authenticator app'),/*#__PURE__*/React.createElement("div",{className:"flex justify-center p-4 bg-white rounded-lg"},/*#__PURE__*/React.createElement("img",{src:qrData.qr_code,alt:"QR Code",className:"w-48 h-48"})),/*#__PURE__*/React.createElement("div",{className:"p-3 bg-proxmox-dark rounded-lg"},/*#__PURE__*/React.createElement("p",{className:"text-xs text-gray-500 mb-1"},t('secretKey')||'Secret Key',":"),/*#__PURE__*/React.createElement("code",{className:"text-sm text-proxmox-orange break-all select-all"},qrData.secret)),/*#__PURE__*/React.createElement("button",{onClick:()=>setStep('verify'),className:"w-full px-4 py-2.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-white font-medium transition-colors"},t('next')||'Next')),step==='verify'&&/*#__PURE__*/React.createElement("div",{className:"space-y-4"},/*#__PURE__*/React.createElement("p",{className:"text-gray-400 text-sm"},t('enter2FACode')||'Enter 6-digit code'),/*#__PURE__*/React.createElement("input",{type:"text",value:verifyCode,onChange:e=>setVerifyCode(e.target.value.replace(/\D/g,'').slice(0,6)),onKeyDown:e=>e.key==='Enter'&&verifySetup(),placeholder:"000000",className:"w-full text-center text-2xl tracking-[0.5em] bg-proxmox-dark border border-proxmox-border rounded-lg p-3 text-white font-mono",autoFocus:true}),/*#__PURE__*/React.createElement("button",{onClick:verifySetup,disabled:loading||verifyCode.length!==6,className:"w-full px-4 py-2.5 bg-proxmox-orange hover:bg-orange-600 rounded-lg text-white font-medium transition-colors disabled:opacity-50 flex items-center justify-center gap-2"},loading&&/*#__PURE__*/React.createElement(Icons.RotateCw,{className:"w-4 h-4 animate-spin"}),t('verify2FA')||'Verify')),error&&/*#__PURE__*/React.createElement("div",{className:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg"},/*#__PURE__*/React.createElement("p",{className:"text-sm text-red-400"},error)))));}function App(){const{user,loading,requires2FASetup}=useAuth();if(loading){return/*#__PURE__*/React.createElement("div",{className:"min-h-screen bg-proxmox-darker flex items-center justify-center"},/*#__PURE__*/React.createElement("div",{className:"text-center"},/*#__PURE__*/React.createElement("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-proxmox-orange mb-4"},/*#__PURE__*/React.createElement("svg",{className:"w-8 h-8 text-white animate-spin",fill:"none",viewBox:"0 0 24 24"},/*#__PURE__*/React.createElement("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),/*#__PURE__*/React.createElement("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"}))),/*#__PURE__*/React.createElement("p",{className:"text-gray-400"},"Loading...")));}if(!user){return/*#__PURE__*/React.createElement(LoginScreen,null);}// NS: Block access until 2FA is set up (if admin requires it)
if(requires2FASetup){return/*#__PURE__*/React.createElement("div",{className:"min-h-screen bg-proxmox-darker"},/*#__PURE__*/React.createElement(Force2FASetupModal,null));}return/*#__PURE__*/React.createElement(PegaProxDashboard,null);}ReactDOM.render(/*#__PURE__*/React.createElement(LanguageProvider,null,/*#__PURE__*/React.createElement(AuthProvider,null,/*#__PURE__*/React.createElement(App,null))),document.getElementById('root'));// LW: Hide loading screen after React renders
const loadingScreen=document.getElementById('loading-screen');if(loadingScreen){loadingScreen.style.opacity='0';loadingScreen.style.transition='opacity 0.3s ease';setTimeout(()=>loadingScreen.remove(),300);}

})();
    </script>

</body>
</html>
